<Issue id="27435" key="IS-561" number="561" project="10401" reporter="avkrishnan" assignee="viswa0269" creator="avkrishnan" type="10006" summary="Need a 32-bit build of libindy which has overflow check disabled" priority="3" resolution="10000" status="10001" created="2018-02-05 20:25:35.0" updated="2018-03-12 21:18:50.0" resolutiondate="2018-03-01 05:16:28.0" votes="0" watches="3" workflowId="51250"> <description><! CDATA The issue is captured in the conversation below:  khagesh  2:32 PM  @vyacheslav.gudkov @sminaev We are facing issue with iphone 5 ios 10.3.1 that we are not able to establish connection with pool. This is the error that we get ``` Pool create callback is triggered. INFO|indy::commands                |                src/commands/mod.rs:107 | PoolCommand command received INFO|pool_command_executor         |               src/commands/pool.rs:62  | Open command received thread '<unnamed>' panicked at 'attempt to multiply with overflow', /Users/DSR/.cargo/registry/src/github.com-1ecc6299db9ec823/amcl-0.1.2/src/big.rs:974:42 note: Some details are omitted, run with `RUST_BACKTRACE=full` for a verbose backtrace. stack backtrace: 0: std::sys::imp::backtrace::tracing::imp::unwind_backtrace 1: std::panicking::default_hook::{{closure}} 2: std::panicking::default_hook 3: std::panicking::rust_panic_with_hook 4: std::panicking::begin_panic 5: std::panicking::begin_panic_fmt 6: rust_begin_unwind 7: core::panicking::panic_fmt 8: core::panicking::panic 9: amcl::big::BIG::monty 10: amcl::big::BIG::modulo 11: amcl::fp::FP::mul 12: amcl::fp2::FP2::sqr 13: amcl::ecp2::ECP2::rhs 14: amcl::ecp2::ECP2::new_fp2s 15: amcl::ecp2::ECP2::frombytes 16: indy_crypto::pair::PointG2::from_bytes 17: indy_crypto::bls::VerKey::from_bytes 18: indy::services::pool::<impl indy::services::pool::types::RemoteNode>::new 19: indy::services::pool::PoolWorker::connect_to_known_nodes 20: indy::services::pool::PoolWorker::init_catchup 21: indy::services::pool::PoolWorker::_run 22: indy::services::pool::PoolWorker::run 23: indy::services::pool::Pool::new::{{closure}} DEBUG|zmq_pw                        |/Users/DSR/.cargo/registry/src/github.com-1ecc6299db9ec823/zmq-pw-0.9.8/src/lib.rs:367 | context dropped DEBUG|zmq_pw                        |/Users/DSR/.cargo/registry/src/github.com-1ecc6299db9ec823/zmq-pw-0.9.8/src/lib.rs:460 | socket dropped INFO|indy::commands                |                src/commands/mod.rs:115 | WalletCommand command received INFO|wallet_command_executor       |             src/commands/wallet.rs:75  | Create command received TRACE|indy::services::wallet::default|     src/services/wallet/default.rs:147 | DefaultWalletType.create >> connectMeWallet, with config None and credentials None TRACE|indy::services::wallet::default|     src/services/wallet/default.rs:157 | DefaultWalletType.create << 2018-01-31 14:29:15.341 ConnectMe-demo 24596:7921005  CMWalletObject::CreateAndOpen - Received create wallet callback with error: 0 ``` You can reproduce it by cloning master branch of `http://github.com/evernym/connect-me-indy-wrapper/` and running test `testWalletAndPool`. This works fine with iphone 5s and above but for iphone5 and iphone5c it breaks with above error  vyacheslav.gudkov  2:51 PM  @khagesh Do you use debug build of libindy? As warkaround you can switch to release build.  sminaev  2:57 PM  @khagesh I'm not familar with iOS devices, could you confirm please: iphone5 and 5c is 32bit and iphone 5s and later is 64 bit?  sminaev  2:59 PM  the workaround mentoined above is possible, we can switch to  release build without arithmetic checks. But we should understand the reason of the problem to avoid possible issues. (edited)  vyacheslav.gudkov  3:00 PM  iphone 5 is 32bit  khagesh  3:00 PM  yes both iphone 5 and 5c are 32 bit  vyacheslav.gudkov  3:00 PM  As result bignums use different math  We fixed amcl debug builds only for 64bit platforms  Do we really need to support iphone 5? It seams like a totally dead platform.   khagesh  3:03 PM  @tyler :this: Libindy team needs to do some extra stuff to support iphone 5 & iphone 5c. Do we need it? @vyacheslav.gudkov how much effort do you think it will take to fix this bug.  vyacheslav.gudkov  3:07 PM  In theory we support 32bit already, but you need to use release build without overflow checks included.  For debug builds support we will need spend few days as we need to release amcl, indy crypto and libindy  @sminaev do we have release build of libindy for iOS?  sminaev  3:13 PM  right now libindy is built as debug and included to release iOS indy wrapper. As result with math containing arithmetic checks (edited)  vyacheslav.gudkov  3:13 PM  May be just re-build it in release in the background?  sminaev  3:15 PM  I'm not sure that current error is just unnecessary overflow check. It may be real problem in 32bit math  vyacheslav.gudkov  3:29 PM  @sminaev I suggest to add task about 32bit platforms support. We can add it to our next sprint. If Tyler will decide that it isn't big problem for us we can postpone it.  sminaev  3:33 PM  After brief review this particular error seems like unnecessary overflow check. So we can try to re-build release variant of the pod  ></description> </Issue>
