<Action id="66729" issue="44008" author="ianco" type="comment" created="2020-01-16 22:43:37.0" updateauthor="ianco" updated="2020-01-16 22:43:37.0"> <body><! CDATA To fix, change the order the WQL sub-sueries are appended to the internal Vec() structure in the anoncreds extend_proof_request_restrictions() method   ></body> </Action>
<Action id="66776" issue="44008" author="ianco" type="comment" created="2020-01-17 19:05:19.0" updateauthor="ianco" updated="2020-01-17 19:07:25.0"> <body><! CDATA Existing WQL and query: 70-80 msec  Sample for an OrgBook proof request:  wql_to_sql() =>  {code} WQL: And( Eq(EncryptedTagName( 171, 119, 38, 199, 192, 233, 195, 39, 187, 111, 236, 134, 246, 11, 189, 89, 199, 11, 80, 0, 148, 18, 14, 76, 25, 244, 24, 233, 0, 221, 105, 98, 93, 96, 104, 199, 44, 170, 15, 124, 58, 95, 240, 82, 177, 118, 27, 219, 90, 82, 110, 196, 162, 106, 51, 41, 188, 100, 180, 131, 17, 133, 28, 30, 34, 89, 219, 82, 220, 110, 207, 6 ), Encrypted( 253, 42, 9, 220, 99, 14, 252, 67, 186, 231, 231, 73, 148, 185, 2, 152, 177, 110, 85, 225, 39, 73, 210, 200, 16, 4, 154, 189, 150 )),  Eq(EncryptedTagName( 180, 97, 53, 224, 109, 166, 135, 240, 202, 6, 177, 57, 162, 149, 173, 30, 253, 20, 220, 113, 66, 145, 105, 167, 20, 127, 150, 65, 31, 208, 209, 80, 126, 136, 124, 102, 10, 176, 29, 145, 131, 220, 86, 218, 192, 91, 175, 88, 71, 178, 203, 196, 198, 157, 225, 226, 4, 218, 227 ), Encrypted( 253, 42, 9, 220, 99, 14, 252, 67, 186, 231, 231, 73, 148, 185, 2, 152, 177, 110, 85, 225, 39, 73, 210, 200, 16, 4, 154, 189, 150 )),  Eq(EncryptedTagName( 230, 16, 157, 170, 134, 168, 35, 223, 159, 251, 1, 32, 33, 202, 82, 101, 197, 69, 37, 250, 205, 78, 184, 119, 206, 247, 101, 214, 147, 225, 126, 2, 250, 37, 161, 124, 97, 65, 108, 62, 238, 229, 13, 216, 152, 62, 108, 157, 162, 160, 251, 204, 98, 170, 95 ), Encrypted( 253, 42, 9, 220, 99, 14, 252, 67, 186, 231, 231, 73, 148, 185, 2, 152, 177, 110, 85, 225, 39, 73, 210, 200, 16, 4, 154, 189, 150 )),  Eq(EncryptedTagName( 39, 0, 198, 57, 155, 90, 129, 45, 18, 88, 218, 238, 40, 102, 83, 190, 187, 53, 71, 17, 97, 238, 77, 36, 170, 90, 136, 106, 162, 207, 25, 5, 202, 19, 36, 188, 176, 192, 124, 175, 222, 150, 46, 34, 153, 124, 20, 153, 223, 25, 159, 114, 253, 20, 55, 2, 242, 55, 196 ), Encrypted( 253, 42, 9, 220, 99, 14, 252, 67, 186, 231, 231, 73, 148, 185, 2, 152, 177, 110, 85, 225, 39, 73, 210, 200, 16, 4, 154, 189, 150 )),  Eq(EncryptedTagName( 46, 241, 187, 55, 159, 194, 211, 226, 174, 88, 139, 64, 126, 16, 65, 81, 80, 175, 239, 94, 174, 118, 148, 137, 244, 203, 91, 13, 210, 162, 147, 124, 72, 77, 80, 169, 222, 112, 55, 254, 44, 166, 23, 207, 208, 3, 238, 179, 45, 164, 62, 171, 213 ), Encrypted( 253, 42, 9, 220, 99, 14, 252, 67, 186, 231, 231, 73, 148, 185, 2, 152, 177, 110, 85, 225, 39, 73, 210, 200, 16, 4, 154, 189, 150 )),  Eq(EncryptedTagName( 227, 43, 123, 136, 94, 191, 231, 123, 227, 151, 60, 128, 209, 81, 143, 105, 146, 179, 212, 230, 97, 232, 33, 41, 119, 79, 34, 84, 216, 226, 187, 166, 216, 215, 79, 70, 67, 102, 52, 90, 68, 45, 95, 102, 59, 155, 161, 9, 21, 167, 77, 105, 194, 145, 102, 78, 189, 131, 86, 227, 141 ), Encrypted( 253, 42, 9, 220, 99, 14, 252, 67, 186, 231, 231, 73, 148, 185, 2, 152, 177, 110, 85, 225, 39, 73, 210, 200, 16, 4, 154, 189, 150 )),  Eq(EncryptedTagName( 50, 30, 138, 4, 251, 169, 194, 163, 2, 51, 97, 130, 235, 6, 123, 242, 184, 84, 177, 198, 223, 43, 121, 31, 36, 211, 127, 253, 165, 100, 173, 163, 201, 196, 222, 193, 31, 115, 240, 37, 221, 210, 159, 231, 77, 57, 206, 107, 218, 180, 255, 116, 60, 54, 149, 152, 9, 113, 197, 148, 238, 29, 84, 178, 240, 45, 92, 78, 90 ), Encrypted( 253, 42, 9, 220, 99, 14, 252, 67, 186, 231, 231, 73, 148, 185, 2, 152, 177, 110, 85, 225, 39, 73, 210, 200, 16, 4, 154, 189, 150 )),  Eq(EncryptedTagName( 150, 165, 99, 176, 6, 184, 59, 151, 65, 25, 224, 86, 229, 40, 189, 206, 59, 91, 205, 211, 110, 46, 98, 160, 230, 9, 208, 141, 132, 83, 236, 37, 56, 217, 162, 212, 224, 149, 99, 169, 231, 89, 17, 186, 6, 182, 82, 97, 17, 65, 128, 249, 36, 201, 150, 17, 165, 75, 205, 166, 71, 81, 4, 166, 163 ), Encrypted( 253, 42, 9, 220, 99, 14, 252, 67, 186, 231, 231, 73, 148, 185, 2, 152, 177, 110, 85, 225, 39, 73, 210, 200, 16, 4, 154, 189, 150 )),  Eq(EncryptedTagName( 49, 170, 247, 88, 135, 35, 71, 65, 188, 19, 125, 109, 236, 250, 145, 51, 177, 241, 160, 168, 102, 80, 235, 160, 42, 184, 213, 17, 89, 205, 71, 47, 157, 213, 240, 153, 151, 105, 40, 126, 80, 56, 100, 85, 222, 166, 92, 52, 89, 137, 159, 244, 205, 136, 200, 40, 169, 58, 184, 66, 199, 184, 225 ), Encrypted( 253, 42, 9, 220, 99, 14, 252, 67, 186, 231, 231, 73, 148, 185, 2, 152, 177, 110, 85, 225, 39, 73, 210, 200, 16, 4, 154, 189, 150 )),  Eq(EncryptedTagName( 65, 73, 175, 64, 124, 2, 120, 42, 234, 131, 220, 201, 32, 245, 124, 190, 126, 3, 254, 165, 144, 155, 152, 28, 118, 2, 166, 57, 51, 113, 206, 19, 143, 143, 238, 61, 53, 94, 195, 179, 61, 56, 220, 251, 119, 47, 138, 45, 33, 116, 38, 2, 199, 183, 107, 159, 122, 52, 231, 181, 112, 8, 133, 142, 247, 175, 101, 109, 52, 125, 125, 82, 112, 137, 133 ), Encrypted( 253, 42, 9, 220, 99, 14, 252, 67, 186, 231, 231, 73, 148, 185, 2, 152, 177, 110, 85, 225, 39, 73, 210, 200, 16, 4, 154, 189, 150 )),  Eq(EncryptedTagName( 237, 106, 205, 251, 20, 52, 138, 32, 165, 131, 43, 16, 251, 92, 196, 37, 106, 29, 4, 235, 209, 133, 186, 249, 222, 191, 100, 242, 206, 66, 49, 109, 253, 158, 91, 236, 97, 65, 168, 12, 94, 79, 225, 249, 127, 29, 98, 92, 15, 51, 94, 238, 68, 248, 155, 118, 72, 115, 155, 30, 186, 223, 29, 67, 27, 46, 131, 161, 132, 205, 161 ), Encrypted( 253, 42, 9, 220, 99, 14, 252, 67, 186, 231, 231, 73, 148, 185, 2, 152, 177, 110, 85, 225, 39, 73, 210, 200, 16, 4, 154, 189, 150 )),  Eq(EncryptedTagName( 158, 91, 124, 205, 133, 162, 116, 183, 157, 29, 26, 16, 69, 212, 13, 123, 252, 192, 158, 198, 15, 248, 59, 55, 39, 152, 230, 222, 193, 199, 150, 65, 76, 78, 167, 108, 34, 212, 255, 229, 244, 253, 96, 188, 239, 200, 95, 41, 27, 133, 255, 159, 88 ), Encrypted( 253, 42, 9, 220, 99, 14, 252, 67, 186, 231, 231, 73, 148, 185, 2, 152, 177, 110, 85, 225, 39, 73, 210, 200, 16, 4, 154, 189, 150 )),  Eq(EncryptedTagName( 246, 190, 246, 202, 223, 19, 146, 3, 42, 207, 100, 179, 156, 182, 169, 169, 82, 166, 170, 47, 220, 73, 58, 243, 136, 135, 77, 158, 77, 231, 142, 3, 123, 102, 29, 106, 0, 69, 204, 9, 254, 163, 33, 148, 65, 243, 106, 159, 101, 67, 200, 157, 33 ), Encrypted( 253, 42, 9, 220, 99, 14, 252, 67, 186, 231, 231, 73, 148, 185, 2, 152, 177, 110, 85, 225, 39, 73, 210, 200, 16, 4, 154, 189, 150 )),  Eq(EncryptedTagName( 104, 149, 182, 30, 196, 38, 247, 82, 21, 73, 6, 170, 38, 140, 69, 13, 152, 146, 126, 212, 251, 41, 42, 224, 190, 253, 213, 73, 131, 229, 72, 216, 161, 216, 249, 99, 207, 178, 183, 30, 250, 66, 81, 238, 29, 225, 63, 21, 126, 91, 110, 35, 8, 186, 29, 172, 171, 57, 183, 15, 242, 48, 220, 179, 208, 198 ), Encrypted( 253, 42, 9, 220, 99, 14, 252, 67, 186, 231, 231, 73, 148, 185, 2, 152, 177, 110, 85, 225, 39, 73, 210, 200, 16, 4, 154, 189, 150 )),  Eq(EncryptedTagName( 243, 203, 231, 101, 198, 34, 193, 207, 177, 157, 251, 211, 40, 180, 43, 228, 244, 231, 52, 20, 235, 191, 165, 173, 140, 225, 214, 26, 179, 151, 153, 56, 59, 94, 9, 102, 228, 61, 210, 254, 228, 124, 133, 221, 191, 165, 133, 209, 81, 225, 36, 54, 112, 118, 161, 200, 114 ), Encrypted( 253, 42, 9, 220, 99, 14, 252, 67, 186, 231, 231, 73, 148, 185, 2, 152, 177, 110, 85, 225, 39, 73, 210, 200, 16, 4, 154, 189, 150 )),  Eq(EncryptedTagName( 61, 23, 211, 240, 205, 43, 245, 140, 210, 236, 110, 162, 207, 208, 9, 116, 133, 3, 210, 58, 162, 9, 20, 157, 238, 253, 18, 60, 167, 84, 72, 217, 226, 27, 187, 28, 239, 61, 205, 198, 232, 215, 128, 143, 60, 66, 79, 4, 148, 168, 142, 120, 175, 165, 105, 254, 188, 146, 67, 195 ), Encrypted( 253, 42, 9, 220, 99, 14, 252, 67, 186, 231, 231, 73, 148, 185, 2, 152, 177, 110, 85, 225, 39, 73, 210, 200, 16, 4, 154, 189, 150 )),  Eq(EncryptedTagName( 115, 219, 92, 204, 169, 66, 183, 88, 49, 212, 106, 179, 156, 193, 91, 100, 209, 207, 215, 235, 173, 182, 108, 35, 175, 225, 8, 247, 67, 170, 45, 24, 195, 120, 15, 10, 4, 68, 147, 49, 120, 48, 92, 113, 182, 68, 2, 89, 48, 251, 190, 101, 80, 201, 151, 117, 177, 137, 78, 66, 254, 31, 79, 77, 154 ), Encrypted( 253, 42, 9, 220, 99, 14, 252, 67, 186, 231, 231, 73, 148, 185, 2, 152, 177, 110, 85, 225, 39, 73, 210, 200, 16, 4, 154, 189, 150 )),  Eq(EncryptedTagName( 142, 64, 253, 173, 29, 4, 232, 70, 158, 62, 215, 228, 67, 93, 21, 107, 43, 174, 223, 43, 204, 90, 138, 217, 63, 4, 223, 31, 212, 252, 252, 28, 112, 56, 143, 137, 227, 252, 25, 95, 91, 153, 253, 41, 62, 63, 161, 111, 32, 64, 174, 151, 19, 247, 112, 9 ), Encrypted( 253, 42, 9, 220, 99, 14, 252, 67, 186, 231, 231, 73, 148, 185, 2, 152, 177, 110, 85, 225, 39, 73, 210, 200, 16, 4, 154, 189, 150 )),  Eq(EncryptedTagName( 245, 226, 195, 83, 181, 69, 145, 22, 67, 59, 48, 222, 42, 101, 71, 14, 236, 146, 70, 248, 90, 200, 201, 68, 153, 221, 207, 228, 118, 64, 163, 20, 96, 40, 0, 87, 85, 206, 173, 181, 194, 240, 247, 96, 202, 37, 23, 50, 117, 170, 3, 88, 177, 147, 189, 20, 53, 129, 96 ), Encrypted( 253, 42, 9, 220, 99, 14, 252, 67, 186, 231, 231, 73, 148, 185, 2, 152, 177, 110, 85, 225, 39, 73, 210, 200, 16, 4, 154, 189, 150 )),  Or( And( Eq(EncryptedTagName( 87, 198, 124, 63, 62, 106, 105, 238, 167, 147, 72, 87, 107, 208, 134, 100, 75, 226, 210, 119, 135, 196, 2, 10, 209, 68, 187, 18, 20, 51, 156, 221, 121, 181, 53, 227, 114, 3, 16, 234, 239, 220, 78, 122, 223, 29, 79, 41, 133, 223, 68, 231, 114, 99, 55 ), Encrypted( 227, 166, 86, 195, 245, 54, 126, 120, 105, 98, 104, 117, 58, 80, 210, 154, 105, 92, 111, 253, 135, 19, 49, 224, 31, 135, 152, 101, 204, 188, 173, 169, 66, 115, 142, 13, 204, 65, 242, 114, 249, 174, 186, 235, 149, 89, 127, 198, 249, 48, 107, 59, 248 )),  Eq(EncryptedTagName( 239, 190, 224, 130, 210, 169, 148, 12, 50, 224, 246, 65, 138, 255, 139, 228, 215, 160, 97, 161, 15, 196, 190, 216, 177, 46, 96, 109, 65, 30, 194, 83, 3, 191, 253, 24, 108, 197, 108, 110, 133, 107, 194, 102, 177, 145, 39, 89, 10, 58, 234, 51, 224, 67, 37, 142 ), Encrypted( 129, 46, 177, 30, 126, 22, 97, 193, 171, 169, 170, 235, 106, 176, 167, 159, 36, 44, 53, 176, 228, 36, 224, 178, 85, 20, 40, 224, 227, 223, 57, 80, 78, 52, 17, 96, 217 )) ) ) );  {code} {code} SQL: "SELECT i.id, i.name, i.value, i.key, i.type FROM items as i WHERE i.type = $1  AND ((i.id in (SELECT item_id FROM tags_encrypted WHERE name = $2 AND value = $3))  AND (i.id in (SELECT item_id FROM tags_encrypted WHERE name = $4 AND value = $5))  AND (i.id in (SELECT item_id FROM tags_encrypted WHERE name = $6 AND value = $7))  AND (i.id in (SELECT item_id FROM tags_encrypted WHERE name = $8 AND value = $9))  AND (i.id in (SELECT item_id FROM tags_encrypted WHERE name = $10 AND value = $11))  AND (i.id in (SELECT item_id FROM tags_encrypted WHERE name = $12 AND value = $13))  AND (i.id in (SELECT item_id FROM tags_encrypted WHERE name = $14 AND value = $15))  AND (i.id in (SELECT item_id FROM tags_encrypted WHERE name = $16 AND value = $17))  AND (i.id in (SELECT item_id FROM tags_encrypted WHERE name = $18 AND value = $19))  AND (i.id in (SELECT item_id FROM tags_encrypted WHERE name = $20 AND value = $21))  AND (i.id in (SELECT item_id FROM tags_encrypted WHERE name = $22 AND value = $23))  AND (i.id in (SELECT item_id FROM tags_encrypted WHERE name = $24 AND value = $25))  AND (i.id in (SELECT item_id FROM tags_encrypted WHERE name = $26 AND value = $27))  AND (i.id in (SELECT item_id FROM tags_encrypted WHERE name = $28 AND value = $29))  AND (i.id in (SELECT item_id FROM tags_encrypted WHERE name = $30 AND value = $31))  AND (i.id in (SELECT item_id FROM tags_encrypted WHERE name = $32 AND value = $33))  AND (i.id in (SELECT item_id FROM tags_encrypted WHERE name = $34 AND value = $35))  AND (i.id in (SELECT item_id FROM tags_encrypted WHERE name = $36 AND value = $37))  AND (i.id in (SELECT item_id FROM tags_encrypted WHERE name = $38 AND value = $39))  AND (((i.id in (SELECT item_id FROM tags_encrypted WHERE name = $40 AND value = $41))  AND (i.id in (SELECT item_id FROM tags_encrypted WHERE name = $42 AND value = $43)))))" {code}   ></body> </Action>
<Action id="66777" issue="44008" author="ianco" type="comment" created="2020-01-17 19:08:44.0" updateauthor="ianco" updated="2020-01-17 19:08:44.0"> <body><! CDATA Updated WQL and query: 0.35 msec  wql_to_sql() =>  {code} WQL: And( Or( And( Eq(EncryptedTagName( 34, 229, 80, 83, 13, 55, 33, 199, 126, 223, 244, 165, 89, 20, 255, 124, 255, 64, 236, 105, 157, 226, 242, 144, 18, 182, 75, 5, 65, 129, 217, 213, 116, 237, 195, 6, 164, 145, 197, 105, 183, 46, 171, 51, 192, 128, 81, 200, 118, 99, 206, 32, 14, 88, 196 ), Encrypted( 210, 46, 47, 88, 97, 150, 244, 175, 61, 45, 164, 69, 75, 47, 75, 100, 151, 114, 91, 117, 188, 17, 22, 151, 9, 202, 58, 193, 128, 225, 213, 63, 49, 213, 26, 51, 164, 123, 141, 233, 145, 173, 254, 144, 124, 241, 127, 232, 238, 77, 121, 26, 191 )),  Eq(EncryptedTagName( 32, 224, 208, 253, 97, 70, 224, 143, 16, 144, 178, 204, 40, 77, 46, 8, 183, 124, 179, 161, 199, 230, 240, 79, 176, 164, 19, 116, 173, 21, 195, 40, 187, 234, 211, 92, 45, 58, 157, 12, 128, 251, 58, 219, 187, 169, 83, 33, 209, 180, 159, 33, 193, 0, 211, 244 ), Encrypted( 103, 145, 139, 249, 171, 126, 33, 29, 11, 94, 81, 47, 122, 69, 74, 55, 112, 249, 41, 202, 23, 21, 116, 200, 55, 117, 86, 14, 39, 91, 109, 47, 142, 214, 153, 8, 195 )) ) ),  Eq(EncryptedTagName( 220, 232, 201, 69, 47, 36, 75, 225, 80, 31, 21, 10, 90, 96, 196, 116, 133, 108, 240, 1, 73, 98, 27, 12, 230, 138, 116, 224, 242, 74, 128, 81, 117, 251, 65, 10, 55, 91, 8, 142, 187, 255, 179, 135, 101, 188, 180, 53, 198, 232, 249, 240, 14 ), Encrypted( 95, 72, 106, 30, 239, 146, 213, 111, 106, 29, 101, 129, 189, 94, 57, 193, 243, 111, 37, 36, 98, 5, 236, 120, 180, 197, 96, 56, 254 )),  Eq(EncryptedTagName( 241, 128, 133, 3, 17, 0, 219, 15, 96, 45, 12, 162, 205, 241, 73, 85, 119, 228, 17, 121, 186, 100, 65, 162, 221, 30, 68, 107, 61, 209, 204, 196, 108, 159, 74, 118, 84, 17, 109, 27, 113, 14, 121, 31, 236, 203, 235, 86, 64, 218, 128, 46, 188, 193, 158, 117, 119, 154, 168, 189, 189, 133, 11, 207, 234, 128, 21, 55, 126, 205, 213 ), Encrypted( 95, 72, 106, 30, 239, 146, 213, 111, 106, 29, 101, 129, 189, 94, 57, 193, 243, 111, 37, 36, 98, 5, 236, 120, 180, 197, 96, 56, 254 )),  Eq(EncryptedTagName( 90, 148, 229, 179, 200, 145, 182, 161, 62, 126, 107, 236, 104, 107, 75, 99, 104, 252, 100, 204, 2, 141, 210, 206, 152, 224, 165, 215, 26, 25, 234, 116, 32, 182, 80, 241, 43, 0, 202, 137, 219, 132, 126, 21, 141, 60, 227, 166, 122, 226, 119, 87, 139, 68, 156, 127, 208, 95, 129 ), Encrypted( 95, 72, 106, 30, 239, 146, 213, 111, 106, 29, 101, 129, 189, 94, 57, 193, 243, 111, 37, 36, 98, 5, 236, 120, 180, 197, 96, 56, 254 )),  Eq(EncryptedTagName( 15, 228, 184, 12, 203, 61, 153, 186, 229, 99, 192, 57, 147, 112, 230, 100, 170, 223, 156, 64, 230, 115, 224, 90, 72, 219, 250, 188, 199, 115, 159, 202, 13, 97, 41, 255, 166, 71, 186, 101, 53, 240, 98, 7, 161, 208, 236, 139, 127, 214, 225, 18, 185, 134, 62, 234, 13, 242, 105, 225 ), Encrypted( 95, 72, 106, 30, 239, 146, 213, 111, 106, 29, 101, 129, 189, 94, 57, 193, 243, 111, 37, 36, 98, 5, 236, 120, 180, 197, 96, 56, 254 )),  Eq(EncryptedTagName( 47, 200, 133, 69, 37, 91, 106, 181, 153, 200, 45, 183, 32, 136, 204, 159, 18, 43, 89, 38, 30, 156, 52, 34, 239, 225, 184, 42, 98, 136, 228, 229, 68, 80, 205, 12, 124, 81, 84, 70, 79, 44, 36, 82, 66, 3, 47, 187, 216, 200, 16, 19, 28 ), Encrypted( 95, 72, 106, 30, 239, 146, 213, 111, 106, 29, 101, 129, 189, 94, 57, 193, 243, 111, 37, 36, 98, 5, 236, 120, 180, 197, 96, 56, 254 )),  Eq(EncryptedTagName( 86, 60, 49, 4, 86, 197, 32, 167, 5, 162, 124, 55, 44, 168, 1, 176, 186, 250, 205, 181, 124, 183, 106, 96, 136, 74, 8, 168, 160, 195, 29, 75, 126, 123, 170, 24, 171, 204, 120, 110, 87, 159, 193, 58, 156, 75, 235, 106, 101, 71, 173, 110, 178, 110, 141 ), Encrypted( 95, 72, 106, 30, 239, 146, 213, 111, 106, 29, 101, 129, 189, 94, 57, 193, 243, 111, 37, 36, 98, 5, 236, 120, 180, 197, 96, 56, 254 )),  Eq(EncryptedTagName( 240, 164, 135, 122, 93, 87, 236, 28, 119, 155, 191, 96, 195, 5, 19, 199, 149, 167, 150, 214, 150, 1, 179, 70, 191, 147, 47, 214, 189, 32, 114, 192, 168, 134, 165, 72, 214, 253, 162, 184, 23, 43, 173, 139, 216, 221, 123, 9, 212, 145, 151, 235, 184, 198, 238, 137 ), Encrypted( 95, 72, 106, 30, 239, 146, 213, 111, 106, 29, 101, 129, 189, 94, 57, 193, 243, 111, 37, 36, 98, 5, 236, 120, 180, 197, 96, 56, 254 )),  Eq(EncryptedTagName( 5, 174, 243, 83, 224, 163, 130, 87, 53, 39, 253, 215, 31, 47, 91, 154, 111, 189, 245, 88, 175, 165, 163, 70, 177, 234, 21, 41, 199, 53, 89, 191, 47, 61, 254, 222, 240, 154, 76, 193, 233, 76, 76, 239, 66, 37, 33, 161, 207, 77, 249, 4, 154, 147, 9, 45, 213, 226, 175 ), Encrypted( 95, 72, 106, 30, 239, 146, 213, 111, 106, 29, 101, 129, 189, 94, 57, 193, 243, 111, 37, 36, 98, 5, 236, 120, 180, 197, 96, 56, 254 )),  Eq(EncryptedTagName( 165, 25, 68, 6, 183, 183, 185, 165, 183, 33, 3, 107, 164, 169, 96, 140, 99, 24, 161, 37, 146, 246, 108, 218, 130, 177, 141, 170, 129, 128, 231, 0, 222, 43, 21, 215, 69, 81, 53, 98, 148, 87, 104, 193, 147, 169, 237, 174, 169, 63, 43, 155, 15, 94, 180, 249, 66, 53, 45, 252, 209, 44, 144, 41, 66, 172 ), Encrypted( 95, 72, 106, 30, 239, 146, 213, 111, 106, 29, 101, 129, 189, 94, 57, 193, 243, 111, 37, 36, 98, 5, 236, 120, 180, 197, 96, 56, 254 )),  Eq(EncryptedTagName( 190, 245, 198, 216, 157, 19, 87, 5, 26, 78, 8, 110, 39, 237, 9, 111, 61, 25, 125, 24, 215, 239, 115, 115, 25, 232, 109, 189, 119, 188, 230, 87, 108, 17, 105, 207, 200, 138, 87, 162, 21, 224, 90, 252, 196, 108, 126, 167, 140, 24, 136, 139, 116 ), Encrypted( 95, 72, 106, 30, 239, 146, 213, 111, 106, 29, 101, 129, 189, 94, 57, 193, 243, 111, 37, 36, 98, 5, 236, 120, 180, 197, 96, 56, 254 )),  Eq(EncryptedTagName( 129, 54, 236, 19, 184, 179, 32, 26, 59, 34, 183, 180, 52, 19, 175, 221, 151, 148, 11, 121, 202, 174, 99, 46, 99, 4, 13, 25, 143, 214, 65, 18, 251, 0, 87, 31, 168, 50, 151, 101, 86, 90, 94, 16, 28, 238, 245, 121, 212, 212, 248, 191, 112, 2, 23, 190, 48, 159, 195, 192, 74, 129, 163, 86, 11 ), Encrypted( 95, 72, 106, 30, 239, 146, 213, 111, 106, 29, 101, 129, 189, 94, 57, 193, 243, 111, 37, 36, 98, 5, 236, 120, 180, 197, 96, 56, 254 )),  Eq(EncryptedTagName( 150, 228, 250, 252, 243, 161, 142, 140, 196, 251, 107, 31, 254, 0, 119, 104, 230, 195, 171, 60, 211, 63, 96, 102, 248, 58, 95, 186, 95, 108, 55, 72, 105, 18, 118, 200, 169, 5, 252, 245, 176, 218, 182, 120, 156, 245, 179, 152, 251, 164, 52, 178, 35, 9, 42, 240, 79, 167, 184 ), Encrypted( 95, 72, 106, 30, 239, 146, 213, 111, 106, 29, 101, 129, 189, 94, 57, 193, 243, 111, 37, 36, 98, 5, 236, 120, 180, 197, 96, 56, 254 )),  Eq(EncryptedTagName( 43, 210, 111, 122, 23, 163, 114, 243, 110, 54, 180, 54, 104, 121, 65, 11, 248, 18, 168, 230, 162, 73, 78, 240, 0, 53, 254, 218, 20, 37, 165, 57, 185, 21, 241, 67, 255, 27, 204, 144, 176, 69, 186, 10, 36, 201, 42, 123, 146, 106, 62, 175, 50, 62, 130, 82, 108, 21, 114, 149, 153, 197, 5, 117, 121, 0, 25, 84, 211, 234, 235, 89, 251, 76, 68 ), Encrypted( 95, 72, 106, 30, 239, 146, 213, 111, 106, 29, 101, 129, 189, 94, 57, 193, 243, 111, 37, 36, 98, 5, 236, 120, 180, 197, 96, 56, 254 )),  Eq(EncryptedTagName( 58, 141, 171, 239, 17, 245, 55, 9, 159, 167, 250, 16, 183, 118, 25, 235, 119, 77, 64, 115, 35, 49, 255, 199, 217, 253, 252, 4, 19, 135, 33, 134, 140, 158, 8, 153, 21, 21, 238, 207, 29, 121, 238, 182, 174, 250, 154, 126, 11, 195, 187, 203, 23, 191, 27, 126, 83 ), Encrypted( 95, 72, 106, 30, 239, 146, 213, 111, 106, 29, 101, 129, 189, 94, 57, 193, 243, 111, 37, 36, 98, 5, 236, 120, 180, 197, 96, 56, 254 )),  Eq(EncryptedTagName( 225, 234, 217, 45, 219, 5, 19, 111, 102, 211, 41, 53, 131, 184, 184, 39, 51, 67, 28, 127, 58, 200, 10, 31, 45, 136, 249, 156, 106, 253, 156, 255, 200, 85, 71, 209, 167, 200, 74, 45, 217, 172, 58, 90, 35, 59, 127, 245, 28, 236, 82, 150, 238, 253, 54, 113, 151, 247, 108, 247, 205, 66, 193, 133, 73, 219, 162, 137, 188, 130, 120, 86 ), Encrypted( 95, 72, 106, 30, 239, 146, 213, 111, 106, 29, 101, 129, 189, 94, 57, 193, 243, 111, 37, 36, 98, 5, 236, 120, 180, 197, 96, 56, 254 )),  Eq(EncryptedTagName( 122, 248, 126, 180, 251, 251, 34, 209, 139, 176, 18, 100, 93, 93, 14, 152, 189, 61, 246, 42, 175, 149, 138, 30, 150, 38, 190, 65, 200, 194, 98, 216, 186, 41, 206, 248, 37, 245, 146, 248, 17, 153, 247, 33, 177, 18, 178, 235, 243, 25, 7, 139, 124, 5, 147, 152, 29, 182, 69, 44, 211, 11, 150 ), Encrypted( 95, 72, 106, 30, 239, 146, 213, 111, 106, 29, 101, 129, 189, 94, 57, 193, 243, 111, 37, 36, 98, 5, 236, 120, 180, 197, 96, 56, 254 )),  Eq(EncryptedTagName( 246, 239, 253, 233, 140, 228, 207, 10, 143, 2, 235, 5, 109, 237, 209, 225, 123, 85, 238, 30, 229, 165, 86, 140, 146, 249, 175, 86, 252, 242, 104, 28, 67, 52, 53, 22, 201, 19, 237, 134, 39, 246, 94, 59, 162, 179, 9, 29, 106, 80, 150, 22, 38, 55, 52, 229, 255, 176, 40, 61, 123, 49, 50, 37, 158 ), Encrypted( 95, 72, 106, 30, 239, 146, 213, 111, 106, 29, 101, 129, 189, 94, 57, 193, 243, 111, 37, 36, 98, 5, 236, 120, 180, 197, 96, 56, 254 )),  Eq(EncryptedTagName( 164, 211, 233, 162, 196, 80, 196, 155, 178, 54, 7, 243, 164, 107, 211, 188, 10, 250, 222, 116, 205, 67, 161, 49, 196, 5, 161, 123, 5, 195, 105, 80, 155, 69, 139, 167, 241, 0, 29, 209, 9, 186, 67, 126, 131, 2, 122, 6, 164, 183, 246, 142, 238, 183, 119, 70, 209, 113, 106, 109, 120 ), Encrypted( 95, 72, 106, 30, 239, 146, 213, 111, 106, 29, 101, 129, 189, 94, 57, 193, 243, 111, 37, 36, 98, 5, 236, 120, 180, 197, 96, 56, 254 )),  Eq(EncryptedTagName( 218, 36, 86, 42, 163, 137, 71, 50, 170, 217, 16, 133, 194, 154, 171, 24, 72, 12, 120, 8, 135, 19, 195, 94, 207, 132, 246, 119, 30, 147, 126, 44, 103, 146, 223, 16, 11, 115, 70, 201, 5, 41, 159, 5, 114, 123, 194, 42, 208, 245, 189, 184, 183, 210, 43, 114, 63, 97, 117, 148, 46, 239, 216, 192, 126, 252, 61, 149, 65 ), Encrypted( 95, 72, 106, 30, 239, 146, 213, 111, 106, 29, 101, 129, 189, 94, 57, 193, 243, 111, 37, 36, 98, 5, 236, 120, 180, 197, 96, 56, 254 )) );  {code} {code} SQL: "SELECT i.id, i.name, i.value, i.key, i.type FROM items as i WHERE i.type = $1  AND ((((i.id in (SELECT item_id FROM tags_encrypted WHERE name = $2 AND value = $3))  AND (i.id in (SELECT item_id FROM tags_encrypted WHERE name = $4 AND value = $5))))  AND (i.id in (SELECT item_id FROM tags_encrypted WHERE name = $6 AND value = $7))  AND (i.id in (SELECT item_id FROM tags_encrypted WHERE name = $8 AND value = $9))  AND (i.id in (SELECT item_id FROM tags_encrypted WHERE name = $10 AND value = $11))  AND (i.id in (SELECT item_id FROM tags_encrypted WHERE name = $12 AND value = $13))  AND (i.id in (SELECT item_id FROM tags_encrypted WHERE name = $14 AND value = $15))  AND (i.id in (SELECT item_id FROM tags_encrypted WHERE name = $16 AND value = $17))  AND (i.id in (SELECT item_id FROM tags_encrypted WHERE name = $18 AND value = $19))  AND (i.id in (SELECT item_id FROM tags_encrypted WHERE name = $20 AND value = $21))  AND (i.id in (SELECT item_id FROM tags_encrypted WHERE name = $22 AND value = $23))  AND (i.id in (SELECT item_id FROM tags_encrypted WHERE name = $24 AND value = $25))  AND (i.id in (SELECT item_id FROM tags_encrypted WHERE name = $26 AND value = $27))  AND (i.id in (SELECT item_id FROM tags_encrypted WHERE name = $28 AND value = $29))  AND (i.id in (SELECT item_id FROM tags_encrypted WHERE name = $30 AND value = $31))  AND (i.id in (SELECT item_id FROM tags_encrypted WHERE name = $32 AND value = $33))  AND (i.id in (SELECT item_id FROM tags_encrypted WHERE name = $34 AND value = $35))  AND (i.id in (SELECT item_id FROM tags_encrypted WHERE name = $36 AND value = $37))  AND (i.id in (SELECT item_id FROM tags_encrypted WHERE name = $38 AND value = $39))  AND (i.id in (SELECT item_id FROM tags_encrypted WHERE name = $40 AND value = $41))  AND (i.id in (SELECT item_id FROM tags_encrypted WHERE name = $42 AND value = $43)))" {code}   ></body> </Action>
<Action id="66793" issue="44008" author="sergey.minaev" type="comment" body=" ~ianco  thanks for details. Seems like a translator is very similar to default one. I have one more question: Have you considered an option to replace subqueries and &quot;in&quot; by JOINs? I&apos;ve asked Artem to do some testing around that, but may be you already have some results" created="2020-01-20 10:44:23.0" updateauthor="sergey.minaev" updated="2020-01-20 10:44:23.0"/>
<Action id="66809" issue="44008" author="ianco" type="comment" created="2020-01-20 17:26:14.0" updateauthor="ianco" updated="2020-01-20 17:26:14.0"> <body><! CDATA Hi  ~sergey.minaev  thanks for the suggestion re using JOINs.  I haven't tested this yet but I will.  I was worried about making significant changes to the parser since it is used generally for all queries to the wallet.  Yes I used the default WQL parser as the initial code for the postgres plug-in.  ></body> </Action>
<Action id="66830" issue="44008" author="ianco" type="comment" created="2020-01-21 03:19:49.0" updateauthor="ianco" updated="2020-01-21 03:19:49.0"> <body><! CDATA I took a quick look at the query using JOINs.  It has the same issue as the existing IN with subqueries, in that it needs to JOIN first on the subquery with the smallest set of records, and the only way to pass this "hint" into the SQL parser is to order the WQL with the most restrictive subquery first.  Unfortunately with the design of the storage plug-in, the only "hints" we can pass in are with how we order the WQL that we pass in.   ></body> </Action>
<Action id="66887" issue="44008" author="artemkaaas" type="comment" created="2020-01-22 10:25:19.0" updateauthor="artemkaaas" updated="2020-01-22 10:25:19.0"> <body><! CDATA Hi,  ~ianco  Thank you for work. I also did some testing regarding the issue you reported. I'd like to share the results I got. I used this  script| https://github.com/hyperledger/indy-sdk/blob/master/experimental/plugins/postgres_storage/start_postgres.sh   to run Postgres in docker (without any additional configuration). I used python wrapper to issue 300_000 credentials which all relate to the same Schema and CredentialDefinition but the requested value is unique. Here are restrictions I used for the reqesuted attribute: {code:java} "attr::age::value": "1568",  "cred_def_id": cred_def_id,  "schema_id": schema_id,  "schema_name": GVT_SCHEMA_NAME,  "issuer_did": ISSUER_DID  {code}  I tried the following cases: * Old `marker` Order + In operator for restrictions * New `marker` Order + In operator for restrictions * Old `marker` Order + JOIN operator for restrictions * New `marker` Order + JOIN operator for restrictions  I didn't get any difference in changing restrictions order but I got 2 times speedup of using JOIN instead.  I attached the file with detailed results. Maybe I missed something but it likely matters the actual DB configuration/structure/data types/amount of data...lots of factors.  It is really good that the order changing helped you. And I see the sensible explanation of why it helped.  One more note:  To do testing of Join I just prepared the required SQL and replaced it in the plugin. I didn't update wql_to_sql anyhow. But it seems real to do it.  (maybe I miss something)     ></body> </Action>
