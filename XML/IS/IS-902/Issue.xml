<Issue id="33063" key="IS-902" number="902" project="10401" reporter="nemanja.veskovic" creator="nemanja.veskovic" type="10004" summary="Default wallet does not close opened sqlite files" environment="EC2 instance" priority="1" resolution="10200" status="10001" created="2018-08-21 09:32:53.0" updated="2019-03-29 20:57:25.0" resolutiondate="2019-03-29 20:57:25.0" votes="0" watches="1" workflowId="51515"> <description><! CDATA In a longevity test for wallet I have a scenario where N threads creates X wallets ( where N>1, X>1 and N < X) and performs this set of actions  Each of N threads performs actions on a distinct subset of range  1, X  each having X/N wallets in a range # Pick random wallet from a range X~n~ , X~n+1~ - 1Â where X~n~ is first wallet from range for that thread and X~n+1~ - 1 is the last wallet from the range # Create wallet if not already created # Add some item # Search items # Update item # Sometimes delete item # Close wallet # Repeat steps 1-7  Expected result: wallet storage files should be closed after step 7. and at every point of test run there should be a maximum of N storage files opened (maximum 1 storage per thread)  Â   Actual result: wallet storage files remains opened causing system to get in state where there are too many files opened  Â   In my test N = 25 X = 4000 count for each X~n~ , X~n+1~ - 1Â = 1600  Here is the result of number of opened files for java process (pid is 19033) {code:java}  ec2-user@ip-10-31-2-197 libindy $ lsof -p 19033 | grep "/home/ec2-user/.indy_client/wallet/WalletLongevityTest" | wc -l 64  ec2-user@ip-10-31-2-197 libindy $ lsof -p 19033 | grep "/home/ec2-user/.indy_client/wallet/WalletLongevityTest" | wc -l 80  ec2-user@ip-10-31-2-197 libindy $ lsof -p 19033 | grep "/home/ec2-user/.indy_client/wallet/WalletLongevityTest" | wc -l 92  ec2-user@ip-10-31-2-197 libindy $ lsof -p 19033 | grep "/home/ec2-user/.indy_client/wallet/WalletLongevityTest" | wc -l 96  ec2-user@ip-10-31-2-197 libindy $ lsof -p 19033 | grep "/home/ec2-user/.indy_client/wallet/WalletLongevityTest" | wc -l 100  ec2-user@ip-10-31-2-197 libindy $ lsof -p 19033 | grep "/home/ec2-user/.indy_client/wallet/WalletLongevityTest" | wc -l 100  ec2-user@ip-10-31-2-197 libindy $ lsof -p 19033 | grep "/home/ec2-user/.indy_client/wallet/WalletLongevityTest" | wc -l 100  ec2-user@ip-10-31-2-197 libindy $ lsof -p 19033 | grep "/home/ec2-user/.indy_client/wallet/WalletLongevityTest" | wc -l 100  ec2-user@ip-10-31-2-197 libindy $ lsof -p 19033 | grep "/home/ec2-user/.indy_client/wallet/WalletLongevityTest" | wc -l 100  ec2-user@ip-10-31-2-197 libindy $ lsof -p 19033 | grep "/home/ec2-user/.indy_client/wallet/WalletLongevityTest" | wc -l 100  ec2-user@ip-10-31-2-197 libindy $ lsof -p 19033 | grep "/home/ec2-user/.indy_client/wallet/WalletLongevityTest" | wc -l 100  ec2-user@ip-10-31-2-197 libindy $ lsof -p 19033 | grep "/home/ec2-user/.indy_client/wallet/WalletLongevityTest" | wc -l 100  ec2-user@ip-10-31-2-197 libindy $ lsof -p 19033 | grep "/home/ec2-user/.indy_client/wallet/WalletLongevityTest" | wc -l 100  ec2-user@ip-10-31-2-197 libindy $ lsof -p 19033 | grep "/home/ec2-user/.indy_client/wallet/WalletLongevityTest" | wc -l 100  ec2-user@ip-10-31-2-197 libindy $ lsof -p 19033 | grep "/home/ec2-user/.indy_client/wallet/WalletLongevityTest" | wc -l 104  ec2-user@ip-10-31-2-197 libindy $ lsof -p 19033 | grep "/home/ec2-user/.indy_client/wallet/WalletLongevityTest" | wc -l 108  ec2-user@ip-10-31-2-197 libindy $ lsof -p 19033 | grep "/home/ec2-user/.indy_client/wallet/WalletLongevityTest" | wc -l 140  ec2-user@ip-10-31-2-197 libindy $ lsof -p 19033 | grep "/home/ec2-user/.indy_client/wallet/WalletLongevityTest" | wc -l 164  ec2-user@ip-10-31-2-197 libindy $ lsof -p 19033 | grep "/home/ec2-user/.indy_client/wallet/WalletLongevityTest" | wc -l 188 {code}  ></description> </Issue>
