<Issue id="31524" key="IS-800" number="800" project="10401" reporter="smithbk" assignee="ashcherbakov" creator="smithbk" type="10004" summary="Ledger merkle tree doesn\&apos;t acceptable for current tree" priority="2" resolution="10200" status="10001" created="2018-07-02 02:30:15.0" updated="2019-03-29 20:57:35.0" resolutiondate="2019-03-29 20:57:35.0" votes="0" watches="5" workflowId="51446"> <description><! CDATA I get the following error when trying to open the pool ledger file. {code:java} DEBUG:indy.libindy:do_call: Function indy_open_pool_ledger returned err: 0 DEBUG:indy.libindy:do_call: <<< <Future pending> INFO|indy::services::pool          |           src/services/pool/mod.rs:549 | RemoteNode::send_str Node3 pi INFO|indy::services::pool          |           src/services/pool/mod.rs:549 | RemoteNode::send_str Node2 pi INFO|indy::services::pool          |           src/services/pool/mod.rs:549 | RemoteNode::send_str Node1 pi INFO|indy::services::pool          |           src/services/pool/mod.rs:549 | RemoteNode::send_str Node4 pi TRACE|indy::services::pool          |           src/services/pool/mod.rs:238 | zmq poll loop >> TRACE|indy::services::pool          |           src/services/pool/mod.rs:346 | get_zmq_poll_timeout first_event Tm { tm_sec: 57, tm_min: 12, tm_hour: 2, tm_mday: 2, tm_mon: 6, tm_year: 118, tm_wday: 1, tm_yday: 182, tm_isdst: 0, tm_utcoff: 0, tm_nsec: 275673370 } TRACE|indy::services::pool          |           src/services/pool/mod.rs:347 | get_zmq_poll_timeout now_utc Tm { tm_sec: 7, tm_min: 12, tm_hour: 2, tm_mday: 2, tm_mon: 6, tm_year: 118, tm_wday: 1, tm_yday: 182, tm_isdst: 0, tm_utcoff: 0, tm_nsec: 278826921 } TRACE|indy::services::pool          |           src/services/pool/mod.rs:349 | get_zmq_poll_timeout diff Duration Duration { secs: 49, nanos: 996846449 } TRACE|indy::services::pool          |           src/services/pool/mod.rs:351 | get_zmq_poll_timeout diff ms 49996 TRACE|indy::services::pool          |           src/services/pool/mod.rs:291 | zmq poll 1 INFO|indy::services::pool          |           src/services/pool/mod.rs:543 | RemoteNode::recv_msg Node3 po INFO|indy::services::pool          |           src/services/pool/mod.rs:549 | RemoteNode::send_str Node3 {"op":"LEDGER_STATUS","txnSeqNo":4,"merkleRoot":"9fz6UuY8gaGyiRFsKykhKtZrtZrgVKJxEdhwqTMUWyeX","ledgerId":0,"ppSeqNo":null,"viewNo":null} TRACE|indy::services::pool          |           src/services/pool/mod.rs:244 | zmq poll loop << TRACE|indy::services::pool          |           src/services/pool/mod.rs:238 | zmq poll loop >> TRACE|indy::services::pool          |           src/services/pool/mod.rs:346 | get_zmq_poll_timeout first_event Tm { tm_sec: 57, tm_min: 12, tm_hour: 2, tm_mday: 2, tm_mon: 6, tm_year: 118, tm_wday: 1, tm_yday: 182, tm_isdst: 0, tm_utcoff: 0, tm_nsec: 275673370 } TRACE|indy::services::pool          |           src/services/pool/mod.rs:347 | get_zmq_poll_timeout now_utc Tm { tm_sec: 7, tm_min: 12, tm_hour: 2, tm_mday: 2, tm_mon: 6, tm_year: 118, tm_wday: 1, tm_yday: 182, tm_isdst: 0, tm_utcoff: 0, tm_nsec: 310223078 } TRACE|indy::services::pool          |           src/services/pool/mod.rs:349 | get_zmq_poll_timeout diff Duration Duration { secs: 49, nanos: 965450292 } TRACE|indy::services::pool          |           src/services/pool/mod.rs:351 | get_zmq_poll_timeout diff ms 49965 TRACE|indy::services::pool          |           src/services/pool/mod.rs:291 | zmq poll 1 INFO|indy::services::pool          |           src/services/pool/mod.rs:543 | RemoteNode::recv_msg Node2 po INFO|indy::services::pool          |           src/services/pool/mod.rs:549 | RemoteNode::send_str Node2 {"op":"LEDGER_STATUS","txnSeqNo":4,"merkleRoot":"9fz6UuY8gaGyiRFsKykhKtZrtZrgVKJxEdhwqTMUWyeX","ledgerId":0,"ppSeqNo":null,"viewNo":null} TRACE|indy::services::pool          |           src/services/pool/mod.rs:244 | zmq poll loop << TRACE|indy::services::pool          |           src/services/pool/mod.rs:238 | zmq poll loop >> TRACE|indy::services::pool          |           src/services/pool/mod.rs:346 | get_zmq_poll_timeout first_event Tm { tm_sec: 57, tm_min: 12, tm_hour: 2, tm_mday: 2, tm_mon: 6, tm_year: 118, tm_wday: 1, tm_yday: 182, tm_isdst: 0, tm_utcoff: 0, tm_nsec: 275673370 } TRACE|indy::services::pool          |           src/services/pool/mod.rs:347 | get_zmq_poll_timeout now_utc Tm { tm_sec: 7, tm_min: 12, tm_hour: 2, tm_mday: 2, tm_mon: 6, tm_year: 118, tm_wday: 1, tm_yday: 182, tm_isdst: 0, tm_utcoff: 0, tm_nsec: 317435273 } TRACE|indy::services::pool          |           src/services/pool/mod.rs:349 | get_zmq_poll_timeout diff Duration Duration { secs: 49, nanos: 958238097 } TRACE|indy::services::pool          |           src/services/pool/mod.rs:351 | get_zmq_poll_timeout diff ms 49958 TRACE|indy::services::pool          |           src/services/pool/mod.rs:291 | zmq poll 1 INFO|indy::services::pool          |           src/services/pool/mod.rs:543 | RemoteNode::recv_msg Node2 {"ledgerId":0,"merkleRoot":"AsBGPwMzHjDGhpjtLwpqF4wfvNGLsm4516Ybz3py5XiF","op":"LEDGER_STATUS","viewNo":null,"ppSeqNo":null,"txnSeqNo":4} TRACE|indy::services::pool          |           src/services/pool/mod.rs:244 | zmq poll loop << TRACE|indy::services::pool          |           src/services/pool/mod.rs:238 | zmq poll loop >> TRACE|indy::services::pool          |           src/services/pool/mod.rs:346 | get_zmq_poll_timeout first_event Tm { tm_sec: 57, tm_min: 12, tm_hour: 2, tm_mday: 2, tm_mon: 6, tm_year: 118, tm_wday: 1, tm_yday: 182, tm_isdst: 0, tm_utcoff: 0, tm_nsec: 275673370 } TRACE|indy::services::pool          |           src/services/pool/mod.rs:347 | get_zmq_poll_timeout now_utc Tm { tm_sec: 7, tm_min: 12, tm_hour: 2, tm_mday: 2, tm_mon: 6, tm_year: 118, tm_wday: 1, tm_yday: 182, tm_isdst: 0, tm_utcoff: 0, tm_nsec: 328726453 } TRACE|indy::services::pool          |           src/services/pool/mod.rs:349 | get_zmq_poll_timeout diff Duration Duration { secs: 49, nanos: 946946917 } TRACE|indy::services::pool          |           src/services/pool/mod.rs:351 | get_zmq_poll_timeout diff ms 49946 TRACE|indy::services::pool          |           src/services/pool/mod.rs:291 | zmq poll 3 INFO|indy::services::pool          |           src/services/pool/mod.rs:543 | RemoteNode::recv_msg Node3 {"merkleRoot":"AsBGPwMzHjDGhpjtLwpqF4wfvNGLsm4516Ybz3py5XiF","txnSeqNo":4,"op":"LEDGER_STATUS","ledgerId":0,"ppSeqNo":null,"viewNo":null} INFO|indy::services::pool          |           src/services/pool/mod.rs:543 | RemoteNode::recv_msg Node1 po INFO|indy::services::pool          |           src/services/pool/mod.rs:543 | RemoteNode::recv_msg Node4 po INFO|indy::services::pool          |           src/services/pool/mod.rs:549 | RemoteNode::send_str Node1 {"op":"LEDGER_STATUS","txnSeqNo":4,"merkleRoot":"9fz6UuY8gaGyiRFsKykhKtZrtZrgVKJxEdhwqTMUWyeX","ledgerId":0,"ppSeqNo":null,"viewNo":null} INFO|indy::services::pool          |           src/services/pool/mod.rs:549 | RemoteNode::send_str Node4 {"op":"LEDGER_STATUS","txnSeqNo":4,"merkleRoot":"9fz6UuY8gaGyiRFsKykhKtZrtZrgVKJxEdhwqTMUWyeX","ledgerId":0,"ppSeqNo":null,"viewNo":null} TRACE|indy::services::pool          |           src/services/pool/mod.rs:244 | zmq poll loop << TRACE|indy::services::pool          |           src/services/pool/mod.rs:238 | zmq poll loop >> TRACE|indy::services::pool          |           src/services/pool/mod.rs:346 | get_zmq_poll_timeout first_event Tm { tm_sec: 57, tm_min: 12, tm_hour: 2, tm_mday: 2, tm_mon: 6, tm_year: 118, tm_wday: 1, tm_yday: 182, tm_isdst: 0, tm_utcoff: 0, tm_nsec: 275673370 } TRACE|indy::services::pool          |           src/services/pool/mod.rs:347 | get_zmq_poll_timeout now_utc Tm { tm_sec: 7, tm_min: 12, tm_hour: 2, tm_mday: 2, tm_mon: 6, tm_year: 118, tm_wday: 1, tm_yday: 182, tm_isdst: 0, tm_utcoff: 0, tm_nsec: 339145907 } TRACE|indy::services::pool          |           src/services/pool/mod.rs:349 | get_zmq_poll_timeout diff Duration Duration { secs: 49, nanos: 936527463 } TRACE|indy::services::pool          |           src/services/pool/mod.rs:351 | get_zmq_poll_timeout diff ms 49936 TRACE|indy::services::pool          |           src/services/pool/mod.rs:291 | zmq poll 1 INFO|indy::services::pool          |           src/services/pool/mod.rs:543 | RemoteNode::recv_msg Node4 {"txnSeqNo":4,"viewNo":null,"op":"LEDGER_STATUS","merkleRoot":"AsBGPwMzHjDGhpjtLwpqF4wfvNGLsm4516Ybz3py5XiF","ledgerId":0,"ppSeqNo":null} TRACE|indy::services::pool          |           src/services/pool/mod.rs:242 | process_actions - Invalid library state: Ledger merkle tree doesn't acceptable for current tree. ERROR|indy::services::pool          |           src/services/pool/mod.rs:428 | Pool worker thread finished with error CommonError(InvalidState("Ledger merkle tree doesn\'t acceptable for current tree.")) INFO|indy::commands                |                src/commands/mod.rs:108 | PoolCommand command received INFO|indy::commands::pool          |               src/commands/pool.rs:67  | OpenAck handle 1, pool_id 2, result Err(CommonError(InvalidState("Ledger merkle tree doesn\'t acceptable for current tree."))) ERROR|indy::errors::indy            |                 src/errors/indy.rs:68  | Casting error to ErrorCode: Invalid library state: Ledger merkle tree doesn't acceptable for current tree. DEBUG:indy.libindy:_indy_callback: >>> command_handle: 1, err 112, args: (0,) DEBUG:indy.libindy:_indy_callback: <<< DEBUG:indy.libindy:_indy_loop_callback: >>> command_handle: 1, err 112, args: (0,) WARNING:indy.libindy:_indy_loop_callback: Function returned error 112 {code} The following is the pool_transactions_genesis file. I confirmed this file is the same on both the nodes and the client where this error is occurring. And I am also able to connect from my client machine to port 9711 (and others) of 172.30.201.215. {code:java} # cat pool_transactions_genesis  {"data":{"alias":"Node1","blskey":"4N8aUNHSgjQVgkpm8nhNEfDf6txHznoYREg9kirmJrkivgL4oSEimFF6nsQ6M41QvhM2Z33nves5vfSn9n1UwNFJBYtWVnHYMATn76vLuL3zU88KyeAYcHfsih3He6UHcXDxcaecHVz6jhCYz1P2UZn2bDVruL5wXpehgBfBaLKm3Ba","client_ip":"172.30.201.215","client_port":9712,"node_ip":"172.30.201.215","node_port":9711,"services": "VALIDATOR" },"dest":"Gw6pDLhcBcoQesN72qfotTgFa7cbuqZpkX3Xo6pLhPhv","identifier":"Th7MpTaRZVRYnPiabds81Y","txnId":"fea82e10e894419fe2bea7d96296a6d46f50f93f9eeda954ec461b2ed2950b62","type":"0"} {"data":{"alias":"Node2","blskey":"37rAPpXVoxzKhz7d9gkUe52XuXryuLXoM6P6LbWDB7LSbG62Lsb33sfG7zqS8TK1MXwuCHj1FKNzVpsnafmqLG1vXN88rt38mNFs9TENzm4QHdBzsvCuoBnPH7rpYYDo9DZNJePaDvRvqJKByCabubJz3XXKbEeshzpz4Ma5QYpJqjk","client_ip":"172.30.201.215","client_port":9714,"node_ip":"172.30.201.215","node_port":9713,"services": "VALIDATOR" },"dest":"8ECVSk179mjsjKRLWiQtssMLgp6EPhWXtaYyStWPSGAb","identifier":"EbP4aYNeTHL6q385GuVpRV","txnId":"1ac8aece2a18ced660fef8694b61aac3af08ba875ce3026a160acbc3a3af35fc","type":"0"} {"data":{"alias":"Node3","blskey":"3WFpdbg7C5cnLYZwFZevJqhubkFALBfCBBok15GdrKMUhUjGsk3jV6QKj6MZgEubF7oqCafxNdkm7eswgA4sdKTRc82tLGzZBd6vNqU8dupzup6uYUf32KTHTPQbuUM8Yk4QFXjEf2Usu2TJcNkdgpyeUSX42u5LqdDDpNSWUK5deC5","client_ip":"172.30.201.215","client_port":9716,"node_ip":"172.30.201.215","node_port":9715,"services": "VALIDATOR" },"dest":"DKVxG2fXXTU8yT5N7hGEbXB3dfdAnYv1JczDUHpmDxya","identifier":"4cU41vWW82ArfxJxHkzXPG","txnId":"7e9f355dffa78ed24668f0e0e369fd8c224076571c51e2ea8be5f26479edebe4","type":"0"} {"data":{"alias":"Node4","blskey":"2zN3bHM1m4rLz54MJHYSwvqzPchYp8jkHswveCLAEJVcX6Mm1wHQD1SkPYMzUDTZvWvhuE6VNAkK3KxVeEmsanSmvjVkReDeBEMxeDaayjcZjFGPydyey1qxBHmTvAnBKoPydvuTAqx5f7YNNRAdeLmUi99gERUU7TD8KfAa6MpQ9bw","client_ip":"172.30.201.215","client_port":9718,"node_ip":"172.30.201.215","node_port":9717,"services": "VALIDATOR" },"dest":"4PS3EDQ3dW1tci1Bp6543CfuuebjFrg36kLAUcskGfaA","identifier":"TWwCRQRZ2ZHMJFn9TzLp7W","txnId":"aa5e817d7cc626170eca175822029339a444eb0ee8f0bd20d3b0b76e566fb008","type":"0"} {code} Release info from my pool container is: {code:java} # apt list | grep indy  WARNING: apt does not have a stable CLI interface. Use with caution in scripts.  indy-anoncreds/xenial,now 1.0.11 amd64  installed,automatic  indy-node/xenial,now 1.3.62 amd64  installed,automatic  indy-plenum/xenial,now 1.2.42 amd64  installed,automatic  libindy-crypto/xenial,now 0.4.0 amd64  installed,automatic  libindy-crypto-dev/xenial 0.1.6 amd64 python3-indy-crypto/xenial,now 0.4.1 amd64  installed,automatic  xindy/xenial 2.4-1.3 amd64 xindy-rules/xenial 2.4-1.3 all {code} And release info from my client is: {code:java} jj{code}  ></description> </Issue>
