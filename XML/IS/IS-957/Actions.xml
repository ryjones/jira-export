<Action id="50584" issue="33836" author="vladimirwork" type="comment" created="2018-09-18 09:56:59.0" updateauthor="vladimirwork" updated="2018-09-18 09:58:32.0"> <body><! CDATA Build Info: libindy / indy-cli 1.6.6 (stable)  Actual Results: indy> wallet import imported key=key export_path=/home/indy/ConnectMe.wallet export_key=673093c329ca555a {noformat} TRACE|indy_cli::commands::wallet::import_command|             src/commands/wallet.rs:351 | execute >> ctx CommandContext { main_prompt: RefCell { value: "indy" }, sub_prompts: RefCell { value: {} }, is_exit: RefCell { value: false }, int_values: RefCell { value: {} }, string_values: RefCell { value: {} }, plugins: RefCell { value: {} } } params "_" TRACE|indy_cli::commands::wallet::import_command|             src/commands/wallet.rs:365 | Wallet::import_wallet try: config {"id":"imported","storage_config":null,"storage_type":null}, import_config {"key":"673093c329ca555a","path":"/home/indy/ConnectMe.wallet"} TRACE|indy::api::wallet             |                  src/api/wallet.rs:429 | indy_import_wallet: <<< res: Success INFO|command_executor              |                src/commands/mod.rs:75  | Worker thread started INFO|indy::commands                |                src/commands/mod.rs:123 | WalletCommand command received DEBUG|wallet_command_executor       |             src/commands/wallet.rs:116 | Import command received TRACE|indy::commands::wallet        |             src/commands/wallet.rs:226 | _import >>> config: Config { id: "imported", storage_type: None, storage_config: None }, credentials: "_", import_config: "_" TRACE|indy::services::wallet        |         src/services/wallet/mod.rs:451 | import_wallet >>> config: Config { id: "imported", storage_type: None, storage_config: None }, credentials: "_", export_config: "_" TRACE|indy::services::wallet        |         src/services/wallet/mod.rs:101 | create_wallet >>> config: Config { id: "imported", storage_type: None, storage_config: None }, credentials: "_" TRACE|indy::services::wallet        |         src/services/wallet/mod.rs:193 | open_wallet >>> config: Config { id: "imported", storage_type: None, storage_config: None }, credentials: "_" TRACE|indy::services::wallet        |         src/services/wallet/mod.rs:246 | open_wallet <<< res: 1 TRACE|indy::services::wallet        |         src/services/wallet/mod.rs:251 | close_wallet >>> handle: 1 TRACE|indy::services::wallet        |         src/services/wallet/mod.rs:258 | close_wallet <<< TRACE|indy::services::wallet        |         src/services/wallet/mod.rs:139 | delete_wallet >>> config: Config { id: "imported", storage_type: None, storage_config: None }, credentials: "_" TRACE|indy::services::wallet        |         src/services/wallet/mod.rs:188 | delete_wallet <<< TRACE|indy::services::wallet        |         src/services/wallet/mod.rs:480 | import_wallet <<< ERROR|indy::errors::indy            |                 src/errors/indy.rs:73  | Casting error to ErrorCode: Invalid structure: Invalid export file format TRACE|indy::api::wallet             |                  src/api/wallet.rs:423 | indy_import_wallet: cb command_handle: 1, err: CommonInvalidStructure TRACE|indy_cli::commands::wallet::import_command|             src/commands/wallet.rs:372 | Wallet::import_wallet return: Err(CommonInvalidStructure) Can not import Wallet: Invalid file format or encryption key TRACE|indy_cli::commands::wallet::import_command|             src/commands/wallet.rs:386 | execute << Err(()) {noformat}   ></body> </Action>
<Action id="50594" issue="33836" author="vladimirwork" type="comment" created="2018-09-18 13:03:18.0" updateauthor="vladimirwork" updated="2018-09-18 13:03:18.0"> <body><! CDATA Some extended logging for the same steps: {noformat} 2018-09-18T10:58:20.143916566+00:00  indy::api::logger  TRACE indy::api::logger:indy_set_logger: <<< res: Success 2018-09-18T10:58:46.155096422+00:00  indy_cli::commands::wallet::import_command  TRACE indy_cli::commands::wallet::import_command:execute >> ctx CommandContext { main_prompt: RefCell { value: "indy" }, sub_prompts: RefCell { value: {} }, is_exit: RefCell { value: false }, int_values: RefCell { value: {} }, string_values: RefCell { value: {} }, plugins: RefCell { value: {} } } params {"export_key": "673093c329ca555a", "export_path": "./ConnectMe.wallet", "key": "key", "name": "imported"} 2018-09-18T10:58:46.155524049+00:00  indy_cli::commands::wallet::import_command  TRACE indy_cli::commands::wallet::import_command:Wallet::import_wallet try: config {"id":"imported","storage_config":null,"storage_type":null}, import_config {"key":"673093c329ca555a","path":"./ConnectMe.wallet"} 2018-09-18T10:58:46.155706865+00:00  indy::api::wallet  TRACE indy::api::wallet:indy_import_wallet: >>> command_handle: 1, config: 0x7fb1cc24fa00, credentials: 0x7fb1cc24fa40, import_config: 0x7fb1cc24fa80, cb: Some(0x55c21b94bf50) 2018-09-18T10:58:46.155926858+00:00  indy::api::wallet  TRACE indy::api::wallet:indy_import_wallet: params config: Config { id: "imported", storage_type: None, storage_config: None }, credentials: Credentials { key: "key", rekey: None, storage_credentials: None, key_derivation_method: ARGON2I_MOD, rekey_derivation_method: ARGON2I_MOD }, import_config: ExportConfig { key: "673093c329ca555a", path: "./ConnectMe.wallet", key_derivation_method: ARGON2I_MOD } 2018-09-18T10:58:46.156289010+00:00  indy::api::wallet  TRACE indy::api::wallet:indy_import_wallet: <<< res: Success 2018-09-18T10:58:46.156392709+00:00  command_executor  INFO indy::commands:Worker thread started 2018-09-18T10:58:46.156799843+00:00  indy::commands  INFO indy::commands:WalletCommand command received 2018-09-18T10:58:46.156852562+00:00  wallet_command_executor  DEBUG indy::commands::wallet:Import command received 2018-09-18T10:58:46.156952415+00:00  indy::commands::wallet  TRACE indy::commands::wallet:_import >>> config: Config { id: "imported", storage_type: None, storage_config: None }, credentials: Credentials { key: "key", rekey: None, storage_credentials: None, key_derivation_method: ARGON2I_MOD, rekey_derivation_method: ARGON2I_MOD }, import_config: ExportConfig { key: "673093c329ca555a", path: "./ConnectMe.wallet", key_derivation_method: ARGON2I_MOD } 2018-09-18T10:58:46.157047836+00:00  indy::services::wallet  TRACE indy::services::wallet:import_wallet >>> config: Config { id: "imported", storage_type: None, storage_config: None }, credentials: ExportConfig { key: "673093c329ca555a", path: "./ConnectMe.wallet", key_derivation_method: ARGON2I_MOD }, export_config: ExportConfig { key: "673093c329ca555a", path: "./ConnectMe.wallet", key_derivation_method: ARGON2I_MOD } 2018-09-18T10:58:46.157147058+00:00  indy::services::wallet  TRACE indy::services::wallet:create_wallet >>> config: Config { id: "imported", storage_type: None, storage_config: None }, credentials: Credentials { key: "key", rekey: None, storage_credentials: None, key_derivation_method: ARGON2I_MOD, rekey_derivation_method: ARGON2I_MOD } 2018-09-18T10:58:47.101866480+00:00  indy::services::wallet  TRACE indy::services::wallet:open_wallet >>> config: Config { id: "imported", storage_type: None, storage_config: None }, credentials: Credentials { key: "key", rekey: None, storage_credentials: None, key_derivation_method: ARGON2I_MOD, rekey_derivation_method: ARGON2I_MOD } 2018-09-18T10:58:48.069435451+00:00  indy::services::wallet  TRACE indy::services::wallet:open_wallet <<< res: 1 2018-09-18T10:58:48.977934223+00:00  indy::services::wallet::export_import  TRACE indy::services::wallet::export_import:Invalid data in crypto chunk 2018-09-18T10:58:48.978224522+00:00  indy::services::wallet  TRACE indy::services::wallet:close_wallet >>> handle: 1 2018-09-18T10:58:48.978756259+00:00  indy::services::wallet  TRACE indy::services::wallet:close_wallet <<< 2018-09-18T10:58:48.978848176+00:00  indy::services::wallet  TRACE indy::services::wallet:delete_wallet >>> config: Config { id: "imported", storage_type: None, storage_config: None }, credentials: Credentials { key: "key", rekey: None, storage_credentials: None, key_derivation_method: ARGON2I_MOD, rekey_derivation_method: ARGON2I_MOD } 2018-09-18T10:58:49.884286109+00:00  indy::services::wallet  TRACE indy::services::wallet:delete_wallet <<< 2018-09-18T10:58:49.884507485+00:00  indy::services::wallet  TRACE indy::services::wallet:import_wallet <<< 2018-09-18T10:58:49.884628431+00:00  indy::errors::indy  ERROR indy::errors::indy:Casting error to ErrorCode: Invalid structure: Invalid export file format 2018-09-18T10:58:49.884704159+00:00  indy::api::wallet  TRACE indy::api::wallet:indy_import_wallet: cb command_handle: 1, err: CommonInvalidStructure 2018-09-18T10:58:49.884872870+00:00  indy_cli::commands::wallet::import_command  TRACE indy_cli::commands::wallet::import_command:Wallet::import_wallet return: Err(CommonInvalidStructure) 2018-09-18T10:58:49.884975356+00:00  indy_cli::commands::wallet::import_command  TRACE indy_cli::commands::wallet::import_command:execute << Err(()) {noformat}   ></body> </Action>
<Action id="50665" issue="33836" author="sergey.minaev" type="comment" created="2018-09-19 14:22:43.0" updateauthor="sergey.minaev" updated="2018-09-19 14:22:43.0"> <body><! CDATA  ~ryanmarsh  could you clarify phrase {quote} This wallet can be imported on ios but fails on android and on a libvcx unit test (linux). {quote}  Do you mean that this wallet + mentioned in this ticket passphrase can be imported on iOS as run of libvcx unit test? Or it's mean that some original user passphrase (consisting with a few words spitted by spaces) can be imported by ConnectMe on iOS?  ></body> </Action>
<Action id="50674" issue="33836" author="sergey.minaev" type="comment" created="2018-09-19 14:53:24.0" updateauthor="sergey.minaev" updated="2018-09-19 14:55:03.0"> <body><! CDATA  ~ryanmarsh  I can't import attached wallet with passphrase "673093c329ca555a" in IndySDK test on iOS (tried on emulator and hw phone).  From my side it seems like attached file or passphrase is incorrect.  ></body> </Action>
<Action id="50675" issue="33836" author="ryanmarsh" type="comment" created="2018-09-19 15:12:36.0" updateauthor="ryanmarsh" updated="2018-09-19 15:12:36.0"> <body><! CDATA  ~sergey.minaev  A connect.me user can export a wallet with a backup key generated by "a few words split by spaces". They can then import that wallet on another ios device. The exported wallet cannot be imported by an android device or by a libvcx unit test run on linux. In the past, an ios device could export a wallet and an android device could import it.  Norm mentioned yesterday in a chat that he thought it could be differences in libraries such as libsodium. Android is using 1.0.14 and ios is using 1.0.16.  I will discuss the potential of a bad passphrase (673093c329ca555a) with some members of the connect.me team.  ></body> </Action>
<Action id="50679" issue="33836" author="gudkov" type="comment" created="2018-09-19 15:16:46.0" updateauthor="gudkov" updated="2018-09-19 15:16:46.0"> <body><! CDATA  ~ryanmarsh   We tried all settings on different platforms and with different libsodium. All works fine. We noticed that ConnectMe uses internal key derivation function. We tried to open wallet on iOS with credentials you provided and it fails too. As result it is possible that ConnectMe key derivation function produces different results on different platforms.   ></body> </Action>
<Action id="50680" issue="33836" author="ryanmarsh" type="comment" body=" ~gudkov  I will pass this information back to the app team. " created="2018-09-19 15:22:23.0" updateauthor="ryanmarsh" updated="2018-09-19 15:22:23.0"/>
<Action id="50693" issue="33836" author="sergey.minaev" type="comment" body=" ~ryanmarsh  one more check from libindy side: I&apos;ve exported wallet from IndySDK iOS tests on emulator and can import it on linux (via indy-cli). In other words reverse direction also works well at the top of IndySDK artifacts. I suggest try to reproduce issue at the top of libvcx artifacts" created="2018-09-19 16:14:42.0" updateauthor="sergey.minaev" updated="2018-09-19 16:14:42.0"/>
<Action id="50715" issue="33836" author="ryanmarsh" type="comment" body=" ~sergey.minaev , Norm and I will write a simple ios integration test around libvcx. I will try to reproduce it on that. I will pass this issue back to the app team if we are unable to reproduce it in our tests." created="2018-09-19 17:19:33.0" updateauthor="ryanmarsh" updated="2018-09-19 17:19:33.0"/>
<Action id="50731" issue="33836" author="ryanmarsh" type="comment" created="2018-09-19 17:58:06.0" updateauthor="ryanmarsh" updated="2018-09-19 17:58:06.0"> <body><! CDATA  ~sergey.minaev   ~gudkov  We (Norm and I) created a simple ios integration test around libvcx (does not use connect.me). We were able to import the wallet posted in this ticket. We also wrote a test that exported and imported a file on ios which also worked. I then ran that exported wallet through a libvcx import unit test (linux) and it failed with the same error posted above. Libvcx wallet functionality is nothing more than a wrapper. We don't change the data.  The assumption that we came to is that the libvcx.a file produced in the pipeline statically links libsodium, libzmq, openssl which may be different versions than the ones libindy is using. My linux machine uses 1.0.14 of libsodium but the ios artifact uses 1.0.16. I know that  ~gudkov  said that different versions of these dependencies shouldn't matter but its the only possibility that we can think of  ></body> </Action>
<Action id="50812" issue="33836" author="ryanmarsh" type="comment" created="2018-09-20 00:09:59.0" updateauthor="ryanmarsh" updated="2018-09-20 00:09:59.0"> <body><! CDATA Norm pulled down libindy tests that  ~sergey.minaev  provided and confirmed that libindy failed with libsodium 1.0.16 but passed with a wallet exported by 1.0.14.   ~sergey.minaev   ~gudkov  we were able to get import and export to work with connect.me after changing the version of libsodium from 1.0.16 to 1.0.14. I'm not sure why 1.0.16 doesn't work for us. I will update IS-957. Norm was able to export a wallet from ios and import it on Android. I was also able to import it from a libvcx unit test (linux).  ></body> </Action>
<Action id="50831" issue="33836" author="nsivraj" type="comment" body="I believe this issue can be closed now or moved to testing." created="2018-09-20 12:22:45.0" updateauthor="nsivraj" updated="2018-09-20 12:22:45.0"/>
<Action id="50866" issue="33836" author="sergey.minaev" type="comment" created="2018-09-20 16:11:00.0" updateauthor="sergey.minaev" updated="2018-09-20 16:11:00.0"> <body><! CDATA I'm able to import attached wallet on modified libindy 1.6.6 with sodium 1.0.16 on my desktop.  But to be able to do it I have reverted important changes which was included into 1.6.5 libindy. In other words I modify 1.6.6 libindy and replace logic for importing wallet by code from 1.6.4. It means what this wallet has been produced by older libindy (<1.6.5) + libsodium 1.0.16.  Also I can confirm that wallet 1.6.4 libindy + libsodium 1.0.16 isn't compatible with other combinations.  ></body> </Action>
<Action id="50887" issue="33836" author="ryanmarsh" type="comment" body="The libvcx artifact links against libsovtoken 0.9.2. Libsovtoken statically links against libindy 1.6.4 which is causing the problem. When libsovtoken 0.9.3 is released, it should fix the problem. " created="2018-09-20 19:47:01.0" updateauthor="ryanmarsh" updated="2018-09-20 19:47:01.0"/>
<Action id="50900" issue="33836" author="sergey.minaev" type="comment" body=" ~ryanmarsh  I&apos;ve moved ticket to &quot;validate&quot;. Please update status after new version will be tested. If it works please move it to done. " created="2018-09-21 06:59:07.0" updateauthor="sergey.minaev" updated="2018-09-21 06:59:07.0"/>
