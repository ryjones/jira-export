<Action id="66331" issue="43674" author="artemkaaas" type="comment" created="2019-12-20 09:17:32.0" updateauthor="artemkaaas" updated="2019-12-20 09:19:11.0"> <body><! CDATA Hello,  ~fabienpe   The revocation works well but there is a limitation connected to the preparation data for proof building in you case.  If you want to use two credentials with the same cred_def and revocation_registry_id you must use different timestamps within the proof for these credentials.  Why:   - you create revocation state ( `anoncreds.create_revocation_state` ) for each credential  - put them into a common map (`revoc_states_for_job_application`)  - this map has the following structure  {code:java} rev_states_json = { 'rev_reg_def_id' : {'timestamp' : 'rev_state1' }, .... }{code}  - in your case `rev_reg_def_id` and `timestamp` are the same for both credentials. So, the second revocation state overwrites the first. This value will be used for both credentials but actually revocation states are different.   - as the result the invalid proof is built and verification failed as expected.  ></body> </Action>
<Action id="66740" issue="43674" author="sergey.minaev" type="comment" body="I think we can change the referencing model in rev reg states from rev_reg_id + ts to cred_id + ts" created="2020-01-17 13:36:17.0" updateauthor="sergey.minaev" updated="2020-01-17 13:36:17.0"/>
<Action id="66758" issue="43674" author="artemkaaas" type="comment" created="2020-01-17 14:57:26.0" updateauthor="artemkaaas" updated="2020-01-17 14:57:26.0"> <body><! CDATA Changes:  Did support of two formats for rev_state_json: {code:java} 1)  { rev_reg_id: { timestamp: rev_reg_state, .. }, ... } 2) {  credential_id: { timestamp: rev_reg_state, ... }, ... } {code}  You need to use the second format to pass your case.   PR: https://github.com/hyperledger/indy-sdk/pull/2042     ></body> </Action>
<Action id="67685" issue="43674" author="artemkaaas" type="comment" body=" ~fabienpe  Could you validate it?" created="2020-01-28 05:57:30.0" updateauthor="artemkaaas" updated="2020-01-28 05:57:30.0"/>
<Action id="67729" issue="43674" author="sergey.minaev" type="comment" body="Available in master 1.14.1 1467" created="2020-01-30 12:58:26.0" updateauthor="sergey.minaev" updated="2020-01-30 12:58:26.0"/>
<Action id="67780" issue="43674" author="sergey.minaev" type="comment" body="Covered by integration tests.  ~fabienpe  i&apos;m closing the issue now, fill free to re-open it or create new on if you see any followups  " created="2020-02-03 09:16:32.0" updateauthor="sergey.minaev" updated="2020-02-03 09:16:32.0"/>
