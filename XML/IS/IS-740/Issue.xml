<Issue id="30741" key="IS-740" number="740" project="10401" reporter="ozheregelya" assignee="vladimirwork" creator="ozheregelya" type="10004" summary="Indy-cli can&apos;t connect to the pool after changes in transactions format" priority="1" resolution="10000" status="10001" created="2018-05-30 13:13:29.0" updated="2018-06-04 13:50:47.0" resolutiondate="2018-06-04 13:50:47.0" votes="0" watches="4" workflowId="51404"> <description><! CDATA *Environment:* indy-cli 1.4.0~536 (also reproduces with 1.4.0~539 versions) libindy 1.4.0~536 indy-node 1.3.433 (docker pool)  *Steps to Reproduce:* 1. Setup the docker pool. 2. Copy genesis file from the pool to the client machine. 3. Run the indy-cli. 4. Create pool with copied genesis file pool create p1 gen_txn_file=/var/lib/indy/sandbox/pool_transactions_genesis => Pool successfully created. 5. Try to connect to the pool.  *Actual Result:* Error message appear: Indy SDK error occurred CommonInvalidState  *Expected Result:* Pool connect should work.  *Additional Information:* {code:java} indy> pool connect p2 TRACE|indy::api::pool | src/api/pool.rs:111 | indy_open_pool_ledger: <<< res: Success INFO|indy::commands | src/commands/mod.rs:118 | PoolCommand command received DEBUG|indy::commands::pool | src/commands/pool.rs:153 | open >>> name: "p2", config: None DEBUG|indy::commands::pool | src/commands/pool.rs:168 | open <<< INFO|indy::services::pool | src/services/pool/mod.rs:552 | RemoteNode::send_str Node1 pi INFO|indy::services::pool | src/services/pool/mod.rs:552 | RemoteNode::send_str Node2 pi INFO|indy::services::pool | src/services/pool/mod.rs:552 | RemoteNode::send_str Node3 pi INFO|indy::services::pool | src/services/pool/mod.rs:552 | RemoteNode::send_str Node4 pi TRACE|indy::services::pool | src/services/pool/mod.rs:241 | zmq poll loop >> TRACE|indy::services::pool | src/services/pool/mod.rs:349 | get_zmq_poll_timeout first_event Tm { tm_sec: 34, tm_min: 47, tm_hour: 12, tm_mday: 30, tm_mon: 4, tm_year: 118, tm_wday: 3, tm_yday: 149, tm_isdst: 0, tm_utcoff: 0, tm_nsec: 878073092 } TRACE|indy::services::pool | src/services/pool/mod.rs:350 | get_zmq_poll_timeout now_utc Tm { tm_sec: 44, tm_min: 46, tm_hour: 12, tm_mday: 30, tm_mon: 4, tm_year: 118, tm_wday: 3, tm_yday: 149, tm_isdst: 0, tm_utcoff: 0, tm_nsec: 881199387 } TRACE|indy::services::pool | src/services/pool/mod.rs:352 | get_zmq_poll_timeout diff Duration Duration { secs: 49, nanos: 996873705 } TRACE|indy::services::pool | src/services/pool/mod.rs:354 | get_zmq_poll_timeout diff ms 49996 TRACE|indy::services::pool | src/services/pool/mod.rs:294 | zmq poll 1 INFO|indy::services::pool | src/services/pool/mod.rs:546 | RemoteNode::recv_msg Node4 po INFO|indy::services::pool | src/services/pool/mod.rs:552 | RemoteNode::send_str Node4 {"op":"LEDGER_STATUS","txnSeqNo":4,"merkleRoot":"5cmY3S5wAi1Ns5Yv4kKAsQf9vch9D416sFbHjYwPU3Nz","ledgerId":0,"ppSeqNo":null,"viewNo":null} TRACE|indy::services::pool | src/services/pool/mod.rs:247 | zmq poll loop << TRACE|indy::services::pool | src/services/pool/mod.rs:241 | zmq poll loop >> TRACE|indy::services::pool | src/services/pool/mod.rs:349 | get_zmq_poll_timeout first_event Tm { tm_sec: 34, tm_min: 47, tm_hour: 12, tm_mday: 30, tm_mon: 4, tm_year: 118, tm_wday: 3, tm_yday: 149, tm_isdst: 0, tm_utcoff: 0, tm_nsec: 878073092 } TRACE|indy::services::pool | src/services/pool/mod.rs:350 | get_zmq_poll_timeout now_utc Tm { tm_sec: 44, tm_min: 46, tm_hour: 12, tm_mday: 30, tm_mon: 4, tm_year: 118, tm_wday: 3, tm_yday: 149, tm_isdst: 0, tm_utcoff: 0, tm_nsec: 922781589 } TRACE|indy::services::pool | src/services/pool/mod.rs:352 | get_zmq_poll_timeout diff Duration Duration { secs: 49, nanos: 955291503 } TRACE|indy::services::pool | src/services/pool/mod.rs:354 | get_zmq_poll_timeout diff ms 49955 TRACE|indy::services::pool | src/services/pool/mod.rs:294 | zmq poll 1 INFO|indy::services::pool | src/services/pool/mod.rs:546 | RemoteNode::recv_msg Node2 po INFO|indy::services::pool | src/services/pool/mod.rs:552 | RemoteNode::send_str Node2 {"op":"LEDGER_STATUS","txnSeqNo":4,"merkleRoot":"5cmY3S5wAi1Ns5Yv4kKAsQf9vch9D416sFbHjYwPU3Nz","ledgerId":0,"ppSeqNo":null,"viewNo":null} TRACE|indy::services::pool | src/services/pool/mod.rs:247 | zmq poll loop << TRACE|indy::services::pool | src/services/pool/mod.rs:241 | zmq poll loop >> TRACE|indy::services::pool | src/services/pool/mod.rs:349 | get_zmq_poll_timeout first_event Tm { tm_sec: 34, tm_min: 47, tm_hour: 12, tm_mday: 30, tm_mon: 4, tm_year: 118, tm_wday: 3, tm_yday: 149, tm_isdst: 0, tm_utcoff: 0, tm_nsec: 878073092 } TRACE|indy::services::pool | src/services/pool/mod.rs:350 | get_zmq_poll_timeout now_utc Tm { tm_sec: 44, tm_min: 46, tm_hour: 12, tm_mday: 30, tm_mon: 4, tm_year: 118, tm_wday: 3, tm_yday: 149, tm_isdst: 0, tm_utcoff: 0, tm_nsec: 927656565 } TRACE|indy::services::pool | src/services/pool/mod.rs:352 | get_zmq_poll_timeout diff Duration Duration { secs: 49, nanos: 950416527 } TRACE|indy::services::pool | src/services/pool/mod.rs:354 | get_zmq_poll_timeout diff ms 49950 TRACE|indy::services::pool | src/services/pool/mod.rs:294 | zmq poll 1 INFO|indy::services::pool | src/services/pool/mod.rs:546 | RemoteNode::recv_msg Node3 po INFO|indy::services::pool | src/services/pool/mod.rs:552 | RemoteNode::send_str Node3 {"op":"LEDGER_STATUS","txnSeqNo":4,"merkleRoot":"5cmY3S5wAi1Ns5Yv4kKAsQf9vch9D416sFbHjYwPU3Nz","ledgerId":0,"ppSeqNo":null,"viewNo":null} TRACE|indy::services::pool | src/services/pool/mod.rs:247 | zmq poll loop << TRACE|indy::services::pool | src/services/pool/mod.rs:241 | zmq poll loop >> TRACE|indy::services::pool | src/services/pool/mod.rs:349 | get_zmq_poll_timeout first_event Tm { tm_sec: 34, tm_min: 47, tm_hour: 12, tm_mday: 30, tm_mon: 4, tm_year: 118, tm_wday: 3, tm_yday: 149, tm_isdst: 0, tm_utcoff: 0, tm_nsec: 878073092 } TRACE|indy::services::pool | src/services/pool/mod.rs:350 | get_zmq_poll_timeout now_utc Tm { tm_sec: 44, tm_min: 46, tm_hour: 12, tm_mday: 30, tm_mon: 4, tm_year: 118, tm_wday: 3, tm_yday: 149, tm_isdst: 0, tm_utcoff: 0, tm_nsec: 931918010 } TRACE|indy::services::pool | src/services/pool/mod.rs:352 | get_zmq_poll_timeout diff Duration Duration { secs: 49, nanos: 946155082 } TRACE|indy::services::pool | src/services/pool/mod.rs:354 | get_zmq_poll_timeout diff ms 49946 TRACE|indy::services::pool | src/services/pool/mod.rs:294 | zmq poll 1 INFO|indy::services::pool | src/services/pool/mod.rs:546 | RemoteNode::recv_msg Node1 po INFO|indy::services::pool | src/services/pool/mod.rs:552 | RemoteNode::send_str Node1 {"op":"LEDGER_STATUS","txnSeqNo":4,"merkleRoot":"5cmY3S5wAi1Ns5Yv4kKAsQf9vch9D416sFbHjYwPU3Nz","ledgerId":0,"ppSeqNo":null,"viewNo":null} TRACE|indy::services::pool | src/services/pool/mod.rs:247 | zmq poll loop << TRACE|indy::services::pool | src/services/pool/mod.rs:241 | zmq poll loop >> TRACE|indy::services::pool | src/services/pool/mod.rs:349 | get_zmq_poll_timeout first_event Tm { tm_sec: 34, tm_min: 47, tm_hour: 12, tm_mday: 30, tm_mon: 4, tm_year: 118, tm_wday: 3, tm_yday: 149, tm_isdst: 0, tm_utcoff: 0, tm_nsec: 878073092 } TRACE|indy::services::pool | src/services/pool/mod.rs:350 | get_zmq_poll_timeout now_utc Tm { tm_sec: 44, tm_min: 46, tm_hour: 12, tm_mday: 30, tm_mon: 4, tm_year: 118, tm_wday: 3, tm_yday: 149, tm_isdst: 0, tm_utcoff: 0, tm_nsec: 932148363 } TRACE|indy::services::pool | src/services/pool/mod.rs:352 | get_zmq_poll_timeout diff Duration Duration { secs: 49, nanos: 945924729 } TRACE|indy::services::pool | src/services/pool/mod.rs:354 | get_zmq_poll_timeout diff ms 49945 TRACE|indy::services::pool | src/services/pool/mod.rs:294 | zmq poll 1 INFO|indy::services::pool | src/services/pool/mod.rs:546 | RemoteNode::recv_msg Node4 {"ledgerId":0,"viewNo":null,"op":"LEDGER_STATUS","merkleRoot":"CfUGd4gvKyGT3SgCUEaxEDxrWd5CSh8f5iJsQ5dJmFSZ","txnSeqNo":4,"ppSeqNo":null} TRACE|indy::services::pool | src/services/pool/mod.rs:247 | zmq poll loop << TRACE|indy::services::pool | src/services/pool/mod.rs:241 | zmq poll loop >> TRACE|indy::services::pool | src/services/pool/mod.rs:349 | get_zmq_poll_timeout first_event Tm { tm_sec: 34, tm_min: 47, tm_hour: 12, tm_mday: 30, tm_mon: 4, tm_year: 118, tm_wday: 3, tm_yday: 149, tm_isdst: 0, tm_utcoff: 0, tm_nsec: 878073092 } TRACE|indy::services::pool | src/services/pool/mod.rs:350 | get_zmq_poll_timeout now_utc Tm { tm_sec: 44, tm_min: 46, tm_hour: 12, tm_mday: 30, tm_mon: 4, tm_year: 118, tm_wday: 3, tm_yday: 149, tm_isdst: 0, tm_utcoff: 0, tm_nsec: 937027787 } TRACE|indy::services::pool | src/services/pool/mod.rs:352 | get_zmq_poll_timeout diff Duration Duration { secs: 49, nanos: 941045305 } TRACE|indy::services::pool | src/services/pool/mod.rs:354 | get_zmq_poll_timeout diff ms 49941 TRACE|indy::services::pool | src/services/pool/mod.rs:294 | zmq poll 1 INFO|indy::services::pool | src/services/pool/mod.rs:546 | RemoteNode::recv_msg Node2 {"ledgerId":0,"txnSeqNo":4,"merkleRoot":"CfUGd4gvKyGT3SgCUEaxEDxrWd5CSh8f5iJsQ5dJmFSZ","op":"LEDGER_STATUS","ppSeqNo":null,"viewNo":null} TRACE|indy::services::pool | src/services/pool/mod.rs:247 | zmq poll loop << TRACE|indy::services::pool | src/services/pool/mod.rs:241 | zmq poll loop >> TRACE|indy::services::pool | src/services/pool/mod.rs:349 | get_zmq_poll_timeout first_event Tm { tm_sec: 34, tm_min: 47, tm_hour: 12, tm_mday: 30, tm_mon: 4, tm_year: 118, tm_wday: 3, tm_yday: 149, tm_isdst: 0, tm_utcoff: 0, tm_nsec: 878073092 } TRACE|indy::services::pool | src/services/pool/mod.rs:350 | get_zmq_poll_timeout now_utc Tm { tm_sec: 44, tm_min: 46, tm_hour: 12, tm_mday: 30, tm_mon: 4, tm_year: 118, tm_wday: 3, tm_yday: 149, tm_isdst: 0, tm_utcoff: 0, tm_nsec: 940978955 } TRACE|indy::services::pool | src/services/pool/mod.rs:352 | get_zmq_poll_timeout diff Duration Duration { secs: 49, nanos: 937094137 } TRACE|indy::services::pool | src/services/pool/mod.rs:354 | get_zmq_poll_timeout diff ms 49937 TRACE|indy::services::pool | src/services/pool/mod.rs:294 | zmq poll 1 INFO|indy::services::pool | src/services/pool/mod.rs:546 | RemoteNode::recv_msg Node3 {"ledgerId":0,"op":"LEDGER_STATUS","merkleRoot":"CfUGd4gvKyGT3SgCUEaxEDxrWd5CSh8f5iJsQ5dJmFSZ","viewNo":null,"txnSeqNo":4,"ppSeqNo":null} TRACE|indy::services::pool | src/services/pool/mod.rs:245 | process_actions - Invalid library state: Ledger merkle tree doesn't acceptable for current tree. INFO|indy::commands | src/commands/mod.rs:118 | PoolCommand command received INFO|indy::commands::pool | src/commands/pool.rs:67 | OpenAck handle 1, pool_id 2, result Err(CommonError(InvalidState("Ledger merkle tree doesn\'t acceptable for current tree."))) ERROR|indy::errors::indy | src/errors/indy.rs:73 | Casting error to ErrorCode: Invalid library state: Ledger merkle tree doesn't acceptable for current tree. TRACE|indy::api::pool | src/api/pool.rs:104 | indy_open_pool_ledger: pool_handle: 0 Indy SDK error occurred CommonInvalidState indy> ERROR|indy::services::pool | src/services/pool/mod.rs:431 | Pool worker thread finished with error CommonError(InvalidState("Ledger merkle tree doesn\'t acceptable for current tree.")){code}  ></description> </Issue>
