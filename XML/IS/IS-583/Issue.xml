<Issue id="28332" key="IS-583" number="583" project="10401" reporter="tobowers" assignee="tobowers" creator="tobowers" type="10004" summary="Indy Crypto: Success and verified for bad signature from libindy-crypto" priority="3" resolution="10000" status="10001" created="2018-03-09 07:52:52.0" updated="2018-03-13 10:05:37.0" resolutiondate="2018-03-13 10:04:43.0" votes="0" watches="2" workflowId="51265"> <description><! CDATA I'm not a crypto expert and so I can't look at these bytes and see what's immediately wrong, however...  I'm in the process of wrapping BLS from libindy-crypto to Go. During that process I had my pointer arithmetic messed up and was getting bad bytes from all the *_as_bytes methods. I have since corrected my pointers and everything is working as expected.  HOWEVER, there was a period of time when I was passing in these bytes to the indy_crypto_bsl_verify  sic  function and getting a success error code *and* a *true* for verified... Here's the trace from rust:  {{ 2018/03/07 21:53:21 verify   sig: 0xf02be0040000000010004e00000000500200000000000000208777adff7f000010e335adff7f000000000000000000000300000000000000808777adff7f0000007176adff7f000050cd34adff7f00000200000000000000f8061cadff7f0000c0b335adff7f00000000000000000200000008800700000008cd34adff7f0000    msg: 0x0000000000000000000000000000000000000000000000000000000000616263  2018/03/07 21:53:21 len sig: 128  TRACE:indy_crypto::ffi::bls: indy_crypto_bls_signature_from_bytes: >>> bytes: 0x4e02d90, bytes_len: 128, signature_p: 0xc42007eec0  TRACE:indy_crypto::ffi::bls: indy_crypto_bls_signature_from_bytes: bytes:  240, 43, 224, 4, 0, 0, 0, 0, 16, 0, 78, 0, 0, 0, 0, 80, 2, 0, 0, 0, 0, 0, 0, 0, 32, 135, 119, 173, 255, 127, 0, 0, 16, 227, 53, 173, 255, 127, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 3, 0, 0, 0, 0, 0, 0, 0, 128, 135, 119, 173, 255, 127, 0, 0, 0, 113, 118, 173, 255, 127, 0, 0, 80, 205, 52, 173, 255, 127, 0, 0, 2, 0, 0, 0, 0, 0, 0, 0, 248, 6, 28, 173, 255, 127, 0, 0, 192, 179, 53, 173, 255, 127, 0, 0, 0, 0, 0, 0, 0, 0, 2, 0, 0, 0, 8, 128, 7, 0, 0, 0, 8, 205, 52, 173, 255, 127, 0, 0   TRACE:indy_crypto::ffi::bls: indy_crypto_bls_signature_from_bytes: signature: Signature \{ point: PointG1 \{ point: ECP:   true, FP:   BIG:   0000000000000000000000000000000000000000000000000000000000000000    , FP:   BIG:   0000000000000000000000000000000000000000000000000000000000000000    , FP:   BIG:   0000000000000000000000000000000000000000000000000000000000000000       }, bytes:  240, 43, 224, 4, 0, 0, 0, 0, 16, 0, 78, 0, 0, 0, 0, 80, 2, 0, 0, 0, 0, 0, 0, 0, 32, 135, 119, 173, 255, 127, 0, 0, 16, 227, 53, 173, 255, 127, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 3, 0, 0, 0, 0, 0, 0, 0, 128, 135, 119, 173, 255, 127, 0, 0, 0, 113, 118, 173, 255, 127, 0, 0, 80, 205, 52, 173, 255, 127, 0, 0, 2, 0, 0, 0, 0, 0, 0, 0, 248, 6, 28, 173, 255, 127, 0, 0, 192, 179, 53, 173, 255, 127, 0, 0, 0, 0, 0, 0, 0, 0, 2, 0, 0, 0, 8, 128, 7, 0, 0, 0, 8, 205, 52, 173, 255, 127, 0, 0  }  TRACE:indy_crypto::ffi::bls: indy_crypto_bls_signature_from_bytes: *signature_p: 0x4e02fd0  TRACE:indy_crypto::ffi::bls: indy_crypto_bls_signature_from_bytes: <<< res: Success  TRACE:indy_crypto::ffi::bls: indy_crypto_bls_ver_key_from_bytes: >>> bytes: 0x4e02d90, bytes_len: 128, gen_p: 0xc42007eed0  TRACE:indy_crypto::ffi::bls: indy_crypto_bls_ver_key_from_bytes: bytes:  16, 45, 224, 4, 0, 0, 0, 0, 16, 0, 78, 0, 0, 0, 0, 80, 2, 0, 0, 0, 0, 0, 0, 0, 32, 135, 119, 173, 255, 127, 0, 0, 16, 227, 53, 173, 255, 127, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 3, 0, 0, 0, 0, 0, 0, 0, 128, 135, 119, 173, 255, 127, 0, 0, 0, 113, 118, 173, 255, 127, 0, 0, 80, 205, 52, 173, 255, 127, 0, 0, 2, 0, 0, 0, 0, 0, 0, 0, 248, 6, 28, 173, 255, 127, 0, 0, 192, 179, 53, 173, 255, 127, 0, 0, 0, 0, 0, 0, 0, 0, 2, 0, 0, 0, 8, 128, 7, 0, 0, 0, 8, 205, 52, 173, 255, 127, 0, 0   TRACE:indy_crypto::ffi::bls: indy_crypto_bls_ver_key_from_bytes: sign_key: VerKey \{ point: PointG2 \{ point: ECP2:   true, FP2:   FP:   BIG:   0000000000000000000000000000000000000000000000000000000000000000    , FP:   BIG:   0000000000000000000000000000000000000000000000000000000000000000      , FP2:   FP:   BIG:   07E6F76F165764AD98AB3478094261FA156D008584AD2360D09B23526966FD16    , FP:   BIG:   0A0D351AC4013C6357BA2583B6A69FEB7E0A5F548B9CA64AE777E482E281CA51      , FP2:   FP:   BIG:   095E45DDF417D05FB10933FFC63D474548B7FFFF7888802F07FFFFFF7D07A8A8    , FP:   BIG:   0000000000000000000000000000000000000000000000000000000000000000         }, bytes:  16, 45, 224, 4, 0, 0, 0, 0, 16, 0, 78, 0, 0, 0, 0, 80, 2, 0, 0, 0, 0, 0, 0, 0, 32, 135, 119, 173, 255, 127, 0, 0, 16, 227, 53, 173, 255, 127, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 3, 0, 0, 0, 0, 0, 0, 0, 128, 135, 119, 173, 255, 127, 0, 0, 0, 113, 118, 173, 255, 127, 0, 0, 80, 205, 52, 173, 255, 127, 0, 0, 2, 0, 0, 0, 0, 0, 0, 0, 248, 6, 28, 173, 255, 127, 0, 0, 192, 179, 53, 173, 255, 127, 0, 0, 0, 0, 0, 0, 0, 0, 2, 0, 0, 0, 8, 128, 7, 0, 0, 0, 8, 205, 52, 173, 255, 127, 0, 0  }  TRACE:indy_crypto::ffi::bls: indy_crypto_bls_ver_key_from_bytes: *ver_key_p: 0x4e032f0  TRACE:indy_crypto::ffi::bls: indy_crypto_bls_ver_key_from_bytes: <<< res: Success  2018/03/07 21:53:21 verkey: 0xc42007eed0  TRACE:indy_crypto::ffi::bls: indy_crypto_bls_generator_from_bytes: >>> bytes: 0x4e02d90, bytes_len: 128, gen_p: 0xc42007eee0  TRACE:indy_crypto::ffi::bls: indy_crypto_bls_generator_from_bytes: bytes:  176, 192, 176, 4, 0, 0, 0, 0, 134, 3, 75, 0, 0, 0, 0, 192, 6, 0, 0, 0, 0, 0, 0, 0, 168, 79, 78, 173, 255, 127, 0, 0, 136, 136, 77, 173, 255, 127, 0, 0, 248, 13, 80, 179, 255, 127, 0, 0, 88, 66, 150, 174, 255, 127, 0, 0, 80, 249, 27, 173, 255, 127, 0, 0, 152, 203, 119, 173, 255, 127, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 8, 128, 7, 0, 0, 0, 144, 232, 115, 173, 255, 127, 0, 0, 225, 35, 176, 4, 0, 0, 0, 0, 120, 232, 115, 173, 255, 127, 0, 0, 88, 232, 115, 173, 255, 127, 0, 0, 144, 230, 54, 173, 255, 127, 0, 0   TRACE:indy_crypto::ffi::bls: indy_crypto_bls_generator_from_bytes: gen: Generator \{ point: PointG2 \{ point: ECP2:   true, FP2:   FP:   BIG:   0000000000000000000000000000000000000000000000000000000000000000    , FP:   BIG:   0000000000000000000000000000000000000000000000000000000000000000      , FP2:   FP:   BIG:   11FD10E5965EBAF383C578A68C080E9170FA7CAD449FB4841A5E8EEDE1EDFB5D    , FP:   BIG:   0AA2B7203C4B336A8760B4AE1542A6593AA1BE5F4186FAC7F6F5A7540E207A35      , FP2:   FP:   BIG:   095E45DDF417D05FB10933FFC63D474548B7FFFF7888802F07FFFFFF7D07A8A8    , FP:   BIG:   0000000000000000000000000000000000000000000000000000000000000000         }, bytes:  176, 192, 176, 4, 0, 0, 0, 0, 134, 3, 75, 0, 0, 0, 0, 192, 6, 0, 0, 0, 0, 0, 0, 0, 168, 79, 78, 173, 255, 127, 0, 0, 136, 136, 77, 173, 255, 127, 0, 0, 248, 13, 80, 179, 255, 127, 0, 0, 88, 66, 150, 174, 255, 127, 0, 0, 80, 249, 27, 173, 255, 127, 0, 0, 152, 203, 119, 173, 255, 127, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 8, 128, 7, 0, 0, 0, 144, 232, 115, 173, 255, 127, 0, 0, 225, 35, 176, 4, 0, 0, 0, 0, 120, 232, 115, 173, 255, 127, 0, 0, 88, 232, 115, 173, 255, 127, 0, 0, 144, 230, 54, 173, 255, 127, 0, 0  }  TRACE:indy_crypto::ffi::bls: indy_crypto_bls_generator_from_bytes: *gen_p: 0x4e03480  TRACE:indy_crypto::ffi::bls: indy_crypto_bls_generator_from_bytes: <<< res: Success  2018/03/07 21:53:21 isVerified: false  TRACE:indy_crypto::ffi::bls: indy_crypto_bsl_verify: >>> signature: 0x4e02fd0, message: 0x4e01080, message_len: 32, ver_key: 0x4e032f0, gen: 0x4e03480, valid_p: 0xc42008a758  TRACE:indy_crypto::ffi::bls: indy_crypto_bsl_verify: signature: Signature \{ point: PointG1 \{ point: ECP:   true, FP:   BIG:   0000000000000000000000000000000000000000000000000000000000000000    , FP:   BIG:   0000000000000000000000000000000000000000000000000000000000000000    , FP:   BIG:   0000000000000000000000000000000000000000000000000000000000000000       }, bytes:  240, 43, 224, 4, 0, 0, 0, 0, 16, 0, 78, 0, 0, 0, 0, 80, 2, 0, 0, 0, 0, 0, 0, 0, 32, 135, 119, 173, 255, 127, 0, 0, 16, 227, 53, 173, 255, 127, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 3, 0, 0, 0, 0, 0, 0, 0, 128, 135, 119, 173, 255, 127, 0, 0, 0, 113, 118, 173, 255, 127, 0, 0, 80, 205, 52, 173, 255, 127, 0, 0, 2, 0, 0, 0, 0, 0, 0, 0, 248, 6, 28, 173, 255, 127, 0, 0, 192, 179, 53, 173, 255, 127, 0, 0, 0, 0, 0, 0, 0, 0, 2, 0, 0, 0, 8, 128, 7, 0, 0, 0, 8, 205, 52, 173, 255, 127, 0, 0  }, message:  0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 97, 98, 99 , ver_key: VerKey \{ point: PointG2 \{ point: ECP2:   true, FP2:   FP:   BIG:   0000000000000000000000000000000000000000000000000000000000000000    , FP:   BIG:   0000000000000000000000000000000000000000000000000000000000000000      , FP2:   FP:   BIG:   07E6F76F165764AD98AB3478094261FA156D008584AD2360D09B23526966FD16    , FP:   BIG:   0A0D351AC4013C6357BA2583B6A69FEB7E0A5F548B9CA64AE777E482E281CA51      , FP2:   FP:   BIG:   095E45DDF417D05FB10933FFC63D474548B7FFFF7888802F07FFFFFF7D07A8A8    , FP:   BIG:   0000000000000000000000000000000000000000000000000000000000000000         }, bytes:  16, 45, 224, 4, 0, 0, 0, 0, 16, 0, 78, 0, 0, 0, 0, 80, 2, 0, 0, 0, 0, 0, 0, 0, 32, 135, 119, 173, 255, 127, 0, 0, 16, 227, 53, 173, 255, 127, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 3, 0, 0, 0, 0, 0, 0, 0, 128, 135, 119, 173, 255, 127, 0, 0, 0, 113, 118, 173, 255, 127, 0, 0, 80, 205, 52, 173, 255, 127, 0, 0, 2, 0, 0, 0, 0, 0, 0, 0, 248, 6, 28, 173, 255, 127, 0, 0, 192, 179, 53, 173, 255, 127, 0, 0, 0, 0, 0, 0, 0, 0, 2, 0, 0, 0, 8, 128, 7, 0, 0, 0, 8, 205, 52, 173, 255, 127, 0, 0  }, gen: Generator \{ point: PointG2 \{ point: ECP2:   true, FP2:   FP:   BIG:   0000000000000000000000000000000000000000000000000000000000000000    , FP:   BIG:   0000000000000000000000000000000000000000000000000000000000000000      , FP2:   FP:   BIG:   11FD10E5965EBAF383C578A68C080E9170FA7CAD449FB4841A5E8EEDE1EDFB5D    , FP:   BIG:   0AA2B7203C4B336A8760B4AE1542A6593AA1BE5F4186FAC7F6F5A7540E207A35      , FP2:   FP:   BIG:   095E45DDF417D05FB10933FFC63D474548B7FFFF7888802F07FFFFFF7D07A8A8    , FP:   BIG:   0000000000000000000000000000000000000000000000000000000000000000         }, bytes:  176, 192, 176, 4, 0, 0, 0, 0, 134, 3, 75, 0, 0, 0, 0, 192, 6, 0, 0, 0, 0, 0, 0, 0, 168, 79, 78, 173, 255, 127, 0, 0, 136, 136, 77, 173, 255, 127, 0, 0, 248, 13, 80, 179, 255, 127, 0, 0, 88, 66, 150, 174, 255, 127, 0, 0, 80, 249, 27, 173, 255, 127, 0, 0, 152, 203, 119, 173, 255, 127, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 8, 128, 7, 0, 0, 0, 144, 232, 115, 173, 255, 127, 0, 0, 225, 35, 176, 4, 0, 0, 0, 0, 120, 232, 115, 173, 255, 127, 0, 0, 88, 232, 115, 173, 255, 127, 0, 0, 144, 230, 54, 173, 255, 127, 0, 0  }  TRACE:indy_crypto::ffi::bls: indy_crypto_bsl_verify: valid: true  TRACE:indy_crypto::ffi::bls: indy_crypto_bls_sign: <<< res: Success  2018/03/07 21:53:21 isVerified: true  TRACE:indy_crypto::ffi::bls: indy_crypto_bls_generator_free: >>> gen: 0x4e03480  TRACE:indy_crypto::ffi::bls: indy_crypto_bls_generator_free: <<< res: Success  TRACE:indy_crypto::ffi::bls: indy_crypto_bls_ver_key_free: >>> ver_key: 0x4e032f0  TRACE:indy_crypto::ffi::bls: indy_crypto_bls_ver_key_free: <<< res: Success  TRACE:indy_crypto::ffi::bls: indy_crypto_bls_signature_free: >>> signature: 0x4e02fd0  TRACE:indy_crypto::ffi::bls: indy_crypto_bls_signature_free: <<< res: Success  --- FAIL: TestVerKey_Verify (0.01s)          Error Trace:    bls_test.go:79  Error:       Should be false  Test:        TestVerKey_Verify  FAIL  FAIL  github.com/quorumcontrol/qc3/bls|http://github.com/quorumcontrol/qc3/bls  0.041s }}    ></description> </Issue>
