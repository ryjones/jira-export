<Issue id="41320" key="IS-1323" number="1323" project="10401" reporter="lbendixsen" creator="lbendixsen" type="10004" summary="The CLI command &apos;did rotate-key&apos; fails the first time it is run " priority="3" resolution="10000" status="10001" created="2019-07-19 00:24:26.0" updated="2019-08-19 10:20:56.0" resolutiondate="2019-08-13 07:40:37.0" votes="0" watches="5" workflowId="54325"> <description><! CDATA _Environment_:  Indy CLI v1.10.1 running on a Mac (self built) against the Sovrin BuilderNet running Sovrin version 1.1.50 (indy-node version 1.9.0)     _Steps to Reproduce_:  # Using a Steward DID run from the CLI  >did rotate-key  (with or without fees, it fails) # The first time it runs it returns "InsufficientCorrectSignatures" # run it again, (this time with resume=true) # Success occurs after the second time running it # see notes below for a "screenshot" of sequential commands.  Node logs seem to have no significant data to share.  # Using resume=true the first time you run the command also fails (as expected)     _Expected Behavior_:   Should be successful the first time it is run     _Observed Behavior_:   Takes 2 times to get it to work (essentially the same command each time, doing nothing in between)  _Notes_:  The first attempt below is with fees and the second was without fees.  Easy to replicate.  pool(buildernet):wallet(junk2):did(FvN...x1p):indy> did rotate-key fees_inputs=txo:sov:3x42qH8UkJac1BuorqjSEvuVjvYkVVLdWJM2CWsSaX5sCgpHJYLDpodZfpzBqpoeNd9APC8QxEQXPGxZrZDF6yhsVrEzAxESJVfdLxCSkv6NcrQBNcvvqT fees_outputs=(pay:sov:kg6EyqjTRqbaPZztLCBfgH9n5sm4A97LeFRrsxR2HChR69gzB,195000000000)  *Transaction has been rejected: client request invalid: InsufficientCorrectSignatures(0, 1)*  pool(buildernet):wallet(junk2):did(FvN...x1p):indy> did rotate-key fees_inputs=txo:sov:3x42qH8UkJac1BuorqjSEvuVjvYkVVLdWJM2CWsSaX5sCgpHJYLDpodZfpzBqpoeNd9APC8QxEQXPGxZrZDF6yhsVrEzAxESJVfdLxCSkv6NcrQBNcvvqT fees_outputs=(pay:sov:kg6EyqjTRqbaPZztLCBfgH9n5sm4A97LeFRrsxR2HChR69gzB,195000000000)  *Error: Wallet item already exists*    *Caused by: Wallet item already exists with type: Indy::TemporaryDid, id: FvNxKSeAXgsYj6TEjsfx1p*     pool(buildernet):wallet(junk2):did(FvN...x1p):indy> did rotate-key fees_inputs=txo:sov:3x42qH8UkJac1BuorqjSEvuVjvYkVVLdWJM2CWsSaX5sCgpHJYLDpodZfpzBqpoeNd9APC8QxEQXPGxZrZDF6yhsVrEzAxESJVfdLxCSkv6NcrQBNcvvqT fees_outputs=(pay:sov:kg6EyqjTRqbaPZztLCBfgH9n5sm4A97LeFRrsxR2HChR69gzB,195000000000) resume=true  *Verkey on ledger: ycDDp4HyCgUqh9r7VqBJz95D3mi73XGX4shxiJXCtrd*  *Current verkey in wallet: 9kkJnwXRXjF6RJyuMRnHTDXJFHVhDyGdJtb88c4Qkcg6*  *Temp verkey in wallet: ycDDp4HyCgUqh9r7VqBJz95D3mi73XGX4shxiJXCtrd*  *Verkey for did "FvNxKSeAXgsYj6TEjsfx1p" has been updated*  *New verkey is "ycDDp4HyCgUqh9r7VqBJz95D3mi73XGX4shxiJXCtrd"*  pool(buildernet):wallet(junk2):did(FvN...x1p):indy> did rotate-key  *Transaction has been rejected: client request invalid: InsufficientCorrectSignatures(0, 1)*  pool(buildernet):wallet(junk2):did(FvN...x1p):indy> did rotate-key resume=true  *Verkey on ledger: 99SsxyjTjZBch1pGbJBG4aTh3LrFZojJ2cVPPwhDFkrK*  *Current verkey in wallet: ycDDp4HyCgUqh9r7VqBJz95D3mi73XGX4shxiJXCtrd*  *Temp verkey in wallet: 99SsxyjTjZBch1pGbJBG4aTh3LrFZojJ2cVPPwhDFkrK*  *Verkey for did "FvNxKSeAXgsYj6TEjsfx1p" has been updated*  *New verkey is "99SsxyjTjZBch1pGbJBG4aTh3LrFZojJ2cVPPwhDFkrK"*     And here is the rotate-key auth_rule on the BuilderNet (formatted to be more readable)*:* |NYM               |EDIT  |verkey     | *            | *            |  {                               "auth_constraints":        {           "constraint_id": "ROLE",           "metadata": {},                    "need_to_be_owner": true,          "role": "0",                       "sig_count": 1                   },                                 {                                    "constraint_id": "ROLE",           "metadata": {},                    "need_to_be_owner": true,          "role": "2",                       "sig_count": 1                   },                                 {                                    "constraint_id": "ROLE",           "metadata": {},                    "need_to_be_owner": true,          "role": "101",                      "sig_count": 1                   },                                 {                                    "constraint_id": "ROLE",            "metadata":  {                        "fees": "key_rotation"          }  ,                                "need_to_be_owner": true,          "role": "*",                       "sig_count": 1                    }                                 ,                                 "constraint_id": "OR"            }                                     ></description> </Issue>
