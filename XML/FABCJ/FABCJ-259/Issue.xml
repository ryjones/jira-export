<Issue id="43663" key="FABCJ-259" number="259" project="11208" reporter="mbwhite" assignee="mbwhite" creator="mbwhite" type="10004" summary="getStateByRangeWithPagination fails." priority="3" resolution="10000" status="6" created="2019-12-10 12:43:12.0" updated="2020-01-07 13:31:19.0" resolutiondate="2020-01-07 13:31:19.0" votes="0" watches="2" workflowId="57514"> <description><! CDATA Report from rocket-chat  https://chat.hyperledger.org/channel/fabric-java-chaincode?msg=M2N3CXegB5BwtFqkf  ----  I am trying to use <ctx.getStub().getStateByRangeWithPagination> core v1.4.4, but it doesn't work. chaincode command is   1) peer chaincode invoke -o orderer.example.com:7050 -C mychannel -n fabcar -c '{"Args": "initLedger" }' and then 2) peer chaincode query -C mychannel -n fabcar -c '{"Args": "queryAllCarsByRangeWithPageTest", "CAR001", "CAR009", "3", "" }'  and I found some logs below ------------------------------------------------------ 01:54:39:073 INFO org.hyperledger.fabric.shim.impl.ChaincodeInnvocationTask invoke Sending message to the peer CAR009 01:54:39:073 FINE org.hyperledger.fabric.shim.impl.ChaincodeSupportClient$2 accept > sendToPeer CAR009 01:54:39:082 FINE org.hyperledger.fabric.shim.impl.InnvocationTaskManager onChaincodeMessage  CAR009    { "type": "ERROR", "payload": "R0VUX1NUQVRFX0JZX1JBTkdFIGZhaWxlZDogdHJhbnNhY3Rpb24gSUQ6IENBUjAwOTogbm8gbGVkZ2VyIGNvbnRleHQ=", "txid": "CAR009", "channelId": "CAR001" }  01:54:39:082 FINE org.hyperledger.fabric.shim.impl.InnvocationTaskManager handleMsg  CAR009   Received ERROR 01:54:39:083 FINE org.hyperledger.fabric.shim.impl.InnvocationTaskManager sendToTask > sendToTask CAR009 01:54:39:082 FINE org.hyperledger.fabric.shim.impl.ChaincodeSupportClient$2 accept < sendToPeer CAR009 ----------------------------------------------------------------------  So I track to org.hyperledger.fabric.shim.impl.InnvocationStubImpl and comparing to two methods..  ---------------------------------------------------------------------- private QueryResultsIteratorWithMetadataImpl<KeyValue> executeGetStateByRangeWithMetadata(String collection, String startKey, String endKey, ByteString metadata)  { ByteString payload = GetStateByRange.newBuilder().setCollection(collection).setStartKey(startKey) .setEndKey(endKey).setMetadata(metadata).build().toByteString(); ChaincodeMessage requestMessage = ChaincodeMessageFactory.newEventMessage(GET_STATE_BY_RANGE, startKey, endKey, payload); ByteString response = this.handler.invoke(requestMessage); return new QueryResultsIteratorWithMetadataImpl<>(this.handler, getChannelId(), getTxId(), response, queryResultBytesToKv.andThen(KeyValueImpl::new)); }  private QueryResultsIterator<KeyValue> executeGetStateByRange(String collection, String startKey, String endKey)  { ByteString requestPayload = GetStateByRange.newBuilder().setCollection(collection).setStartKey(startKey) .setEndKey(endKey).build().toByteString(); ChaincodeMessage requestMessage = ChaincodeMessageFactory.newEventMessage(GET_STATE_BY_RANGE, channelId, txId, requestPayload); ByteString response = handler.invoke(requestMessage); return new QueryResultsIteratorImpl<KeyValue>(this.handler, channelId, txId, response, queryResultBytesToKv.andThen(KeyValueImpl::new)); }  ------------------------------------------------------------- ChaincodeMessageFactory.newEventMessage 's input parameter are different each other.  Thank You and Merry Christmas!     ></description> </Issue>
