<Issue id="38813" key="FABC-832" number="832" project="10607" reporter="nyet" creator="nyet" type="10004" summary="Certificates enrolled within 5 minutes of the CA-server root cert notBefore are considered invalid" priority="3" resolution="10000" status="6" created="2019-03-27 21:09:02.0" updated="2021-03-06 17:00:36.0" resolutiondate="2020-12-14 14:56:02.0" votes="1" watches="5" workflowId="50463"> <description><! CDATA When using a cert which was enrolled within 5 minutes of the CA-server's root cert's {{notBefore}}: {code:java} 2019-03-27 20:36:24.946 UTC  main  InitCmd -> ERRO 02e Cannot run peer because error when setting up MSP of type bccsp from directory /var/hyperledger/msp: the supplied identity is not valid: x509: certificate has expired or is not yet valid{code} On the peer: {code:java} $ for i in `sudo find msp -name \*.pem`; do ls -al $i;  sudo  openssl x509 -noout -dates -in $i; done -rw-r--r-- 1 enode enode 981 Mar 27 19:35 msp/signcerts/cert.pem notBefore=Mar 27 19:30:00 2019 GMT notAfter=Mar 26 19:35:00 2020 GMT -rw-r--r-- 1 enode enode 977 Mar 27 19:35 msp/cacerts/ca-server.pem notBefore=Mar 27 19:34:14 2019 GMT notAfter=Mar 24 19:34:14 2029 GMT {code} Note that the ca cert isn't valid until {{19:34}}, but the other certs were created at {{19:30}}. Openssl thinks things are fine: {code:java} $ openssl verify -CAfile msp/cacerts/ca-server.pem msp/signcerts/cert.pem msp/signcerts/cert.pem: OK {code} Also note that the {{admincerts/cert.pem}}'s {{notBefore}} of {{19:30}} is backdated from the actual file creation time of {{19:35}}  On the server itself, it is not backdated (since it is generated by {{openssl}}, and not {{ca-server}}) {code:java} $ ls -al ca-cert.pem -rw-rw-r-- 1 enode enode 977 Mar 27 19:34 ca-cert.pem $ openssl x509 -noout -dates -in ca-cert.pem notBefore=Mar 27 19:34:14 2019 GMT notAfter=Mar 24 19:34:14 2029 GMT {code} One possible solution is to backdate on ca-cert creation using {{faketime}}? haven't tried it yet.  Is this cert chain actually invalid? Is there anything that says the signing cert's {{notBefore}} can't be later than the signed {{notBefore}}?  As far as I know, there is no "create" date built into certificates, so it doesn't seem reasonable to assume anything about relative {{notBefore}} dates between signer and signed certs.  ></description> </Issue>
