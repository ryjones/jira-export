<Issue id="17714" key="FABC-187" number="187" project="10607" reporter="dbshah" assignee="mastersingh24" creator="dbshah" type="10004" summary="Simultaneous enroll calls to CA with same identity gives auth failure" priority="3" resolution="10000" status="6" created="2017-06-09 21:21:28.0" updated="2018-07-18 22:03:48.0" resolutiondate="2017-06-11 15:43:46.0" votes="0" watches="2" timeoriginalestimate="28800" timeestimate="0" timespent="18000" workflowId="32367" security="10001"> <description><! CDATA I understand that most of people won't have this usecase, but making same call to the ca-server for enrolling same identity gives auth failure.     server logs:  ```  Subject:<nil> Profile: CRLOverride: Label: Serial:<nil> Extensions:  } CAName:OrdererCA}  2017/06/09 21:19:46  DEBUG  CSR request received  2017/06/09 21:19:46  INFO  signed certificate with serial number 647958746413884118987967127947150263520187116627  2017/06/09 21:19:46  DEBUG  DB: Insert Certificate  2017/06/09 21:19:46  DEBUG  Saved serial number as hex 717f799ef0437d70c17287653c34b65ce6bfec53  2017/06/09 21:19:46  DEBUG  DB: Login user adminOrderer with max enrollments of -1 and state of 29  2017/06/09 21:19:46  DEBUG  Failed to login 'adminOrderer': No rows were affected when updating the state of identity adminOrderer  2017/06/09 21:19:46  DEBUG  DB: Login user adminOrderer with max enrollments of -1 and state of 29  2017/06/09 21:19:46  DEBUG  saved certificate with serial number 647958746413884118987967127947150263520187116627  2017/06/09 21:19:46  INFO  172.21.0.16:35696 - "POST /enroll" 200  2017/06/09 21:19:46  DEBUG  Successfully incremented state for identity adminOrderer to 30  2017/06/09 21:19:46  DEBUG  DB: identity adminOrderer successfully logged in  2017/06/09 21:19:46  DEBUG  Identity/Pass was correct  2017/06/09 21:19:46  DEBUG  Received request for endpoint enroll  2017/06/09 21:19:46  DEBUG  Enrollment request: \{SignRequest:\{Hosts: orderer-0a  Request:-----BEGIN CERTIFICATE REQUEST-----  MIIBRjCB7gIBADBkMQswCQYDVQQGEwJVUzEXMBUGA1UECBMOTm9ydGggQ2Fyb2xp  bmExFDASBgNVBAoTC0h5cGVybGVkZ2VyMQ8wDQYDVQQLEwZGYWJyaWMxFTATBgNV  BAMTDGFkbWluT3JkZXJlcjBZMBMGByqGSM49AgEGCCqGSM49AwEHA0IABGQ8s0Tc  UWc+vYmY/jJDPDDGWIz3CIQF4zdqf3onl4WsslE7cvDJkB8wIUBy5uigaUcDSO/D  g8UtFxsdMlqhiWGgKDAmBgkqhkiG9w0BCQ4xGTAXMBUGA1UdEQQOMAyCCm9yZGVy  ZXItMGEwCgYIKoZIzj0EAwIDRwAwRAIgBy7TZqLpHSZ/vPqSTCCO0s8giwfoEDHF  THzQmoDv42gCIGYTgwxmeKMUlIvvdfkgcsOWgBSEjWALFhpDKYE/cqWH  -----END CERTIFICATE REQUEST-----  Subject:<nil> Profile: CRLOverride: Label: Serial:<nil> Extensions:  } CAName:OrdererCA}  2017/06/09 21:19:46  DEBUG  CSR request received  2017/06/09 21:19:46  INFO  signed certificate with serial number 43592689707977878056505920289569209744596843305  2017/06/09 21:19:46  DEBUG  DB: Insert Certificate  2017/06/09 21:19:46  DEBUG  Saved serial number as hex 7a2c38938e1961a8a3bbb49bf25ed7e1546bb29  2017/06/09 21:19:46  DEBUG  Failed to login 'adminOrderer': No rows were affected when updating the state of identity adminOrderer  2017/06/09 21:19:47  DEBUG  saved certificate with serial number 43592689707977878056505920289569209744596843305  2017/06/09 21:19:47  INFO  172.21.0.16:35698 - "POST /enroll" 200  ```     client logs:  ```  2017/06/09 21:19:46  INFO  User provided config file: /root/.fabric-ca-client/fabric-ca-client-config.yaml  2017/06/09 21:19:46  INFO  generating key: &\{A:ecdsa S:256}  2017/06/09 21:19:46  INFO  User provided config file: /root/.fabric-ca-client/fabric-ca-client-config.yaml  2017/06/09 21:19:46  INFO  generating key: &\{A:ecdsa S:256}  2017/06/09 21:19:46  INFO  User provided config file: /root/.fabric-ca-client/fabric-ca-client-config.yaml  2017/06/09 21:19:46  INFO  User provided config file: /root/.fabric-ca-client/fabric-ca-client-config.yaml  2017/06/09 21:19:46  INFO  generating key: &\{A:ecdsa S:256}  2017/06/09 21:19:46  INFO  generating key: &\{A:ecdsa S:256}  2017/06/09 21:19:46  INFO  encoded CSR  2017/06/09 21:19:46  INFO  TLS Enabled  2017/06/09 21:19:46  INFO  encoded CSR  2017/06/09 21:19:46  INFO  TLS Enabled  2017/06/09 21:19:46  INFO  encoded CSR  2017/06/09 21:19:46  INFO  TLS Enabled  2017/06/09 21:19:46  INFO  encoded CSR  2017/06/09 21:19:46  INFO  TLS Enabled  Error: Error response from server was: Authorization failure  2017/06/09 21:19:46  INFO  Stored client certificate at /root/.fabric-ca-client/msp/signcerts/cert.pem  2017/06/09 21:19:46  INFO  Stored CA certificate chain at /root/.fabric-ca-client/msp/cacerts/fabric-ca-0a-net_blockchain-com-7054-OrdererCA.pem  Error: Error response from server was: Authorization failure  ```     Note: we are using mysql as database.     The error should not be auth failure.     ></description> </Issue>
