<Action id="60643" issue="40188" author="angelo.decaro" type="comment" body=" ~irmman , could you give me a bit more context about your setup, please? :)" created="2019-06-04 12:15:14.0" updateauthor="angelo.decaro" updated="2019-06-04 12:15:14.0"/>
<Action id="60663" issue="40188" author="irmman" type="comment" created="2019-06-04 17:58:05.0" updateauthor="irmman" updated="2019-06-04 18:04:47.0"> <body><! CDATA  ~angelo.decaro   here is my configuration for the setup https://drive.google.com/file/d/1eFf13Y4W4kx3IS56NOveRFmrQYPzgh5B/view?usp=sharing  ></body> </Action>
<Action id="60855" issue="40188" author="angelo.decaro" type="comment" created="2019-06-11 07:53:46.0" updateauthor="angelo.decaro" updated="2019-06-11 07:53:46.0"> <body><! CDATA  ~irmman , if the file *ca/postgres/postgresql.conf* represents the configuration you are using for your Postgres server, there is something wrong there. The ssl section does not point to the proper certificate files. {code:java} ssl = on #ssl_ca_file = '' #ssl_cert_file = 'server.crt' #ssl_crl_file = '' #ssl_key_file = 'server.key' #ssl_ciphers = 'HIGH:MEDIUM:+3DES:!aNULL' # allowed SSL ciphers #ssl_prefer_server_ciphers = on #ssl_ecdh_curve = 'prime256v1' #ssl_dh_params_file = '' #ssl_passphrase_command = '' #ssl_passphrase_command_supports_reload = off {code}  Am I missing something?  ></body> </Action>
<Action id="60984" issue="40188" author="irmman" type="comment" created="2019-06-13 19:26:13.0" updateauthor="irmman" updated="2019-06-13 19:29:12.0"> <body><! CDATA  ~angelo.decaro  there is default value for the certificate files in *postgresql.conf*, and my certificate files are coresponding  to the default names.     the bug is obvious in the code, so I explain it in detail:    h3. the bug in mummary:    # There is a postgres with tsl enabled # A fabric ca instance is going to be initiated with a tls connection to the postgres # the CA instance creates a database # when CA creates tables, it gives this error:  Error occurred initializing database: Failed to create Postgres tables: Error creating users table: x509: certificate signed by unknown authority    h3. first observation from log:  A connection string with tls parameters: 2019/05/28 12:23:33  DEBUG  Connecting to PostgreSQL server, using connection string: host=postgres port=5432 user=**** password=**** dbname=fabric_ca sslmode=verify-ca sslrootcert=/etc/hyperledger/fabric-ca-server/root-postgresql.crt sslcert=/etc/hyperledger/fabric-ca-server/postgresql.crt sslkey=/etc/hyperledger/fabric-ca-server/postgresql.key A connection string without tls parameters: 2019/05/28 12:23:33  DEBUG  Connecting to database 'fabric_ca', using connection string: 'host=postgres port=5432 user=**** password=**** dbname=fabric_ca sslmode=verify-ca' h3. first inference from log:  there are two connections for connecting to the postgres that is tsl enable. One connection with tls and one connection without tls, so this is a bug. h3.    Check the inference in the code:  all related codes are in *postgres.go* and tag *v1.4.1* h4. creating database steps:  1. create connection string with tls parameters in _Connect_ method, lines 60 to 70  2. connect to postgres and create database : createDatabase method and line 151 h4.    creating tables steps:  1. create tables: method _CreateTables_ that is called in line 111 {code:java} err = p.CreateTables(){code} h3. where is bug?     in method _CreateDatabase_  after creation of database in line 122, sqlxdb is initiated with a new connection string without tls parameters, see line 128. {code:java} sqlxdb, err := sqlx.Open("postgres", datasource){code} this newly initiated sqlxdb without tls parameters, is used in _createTables_ method for creating tables and naturally it throws an error because there is not tls parameters in the connection string.  Bug is in line 128.  why is *SqlxDB*  initiated wrongly again, while it is already initiated correctly in _Connect_ method?  Fix: removing lines 127 to 132, or reuse line 60 to 70 for appending tls parameters to sqlxdb that is used fo creating new *SqlxDB*.                 ></body> </Action>
<Action id="61038" issue="40188" author="irmman" type="comment" created="2019-06-16 11:04:16.0" updateauthor="irmman" updated="2019-06-16 11:04:16.0"> <body><! CDATA briefly the bug is in postgres.go tag v.1.4.1  line 128     sqlxdb, err := sqlx.Open("postgres", datasource)   where there are not tls parameters in _*datasource*_ .e.g sslrootcert        ></body> </Action>
<Action id="61494" issue="40188" author="mastersingh24" type="comment" created="2019-07-05 18:21:02.0" updateauthor="mastersingh24" updated="2019-07-05 18:21:02.0"> <body><! CDATA master:   https://gerrit.hyperledger.org/r/32203 release-1.4:  https://gerrit.hyperledger.org/r/32198  ></body> </Action>
