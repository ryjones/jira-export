<Issue id="12415" key="FABC-612" number="612" project="10607" reporter="clayton sims" assignee="smithbk" creator="clayton sims" type="10001" summary="As a adminstrator, I need to be able to revoke a certificate" priority="1" resolution="10000" status="6" created="2016-08-16 18:27:07.0" updated="2018-07-20 19:15:41.0" resolutiondate="2017-01-07 14:58:45.0" votes="0" watches="5" workflowId="34578"> <description><! CDATA  There are typically three broad reasons for revoking a cert: # The rightful owner of the cert is abusing it. Typically this would be a sub-CA who is issuing certificates they shouldn't. Their cert gets revoked to tell the world not to trust them anymore. # The server is decommissioned, or the cert is no longer needed for whatever reason. # Key compromise of the private key corresponding to the certificate. We can no longer trust anything signed by, or encrypted for this cert because we no longer know if we're talking to the rightful owner or the hacker.  As a result of revoking a certificate, two things happen: # Any request to the COP server which uses the revoked certificate will be denied.  This includes certificate renewal via the "cop client reenroll" command, getting a new batch of tcerts, or any other command other than "cop client enroll" which uses basic auth. # Any request to a peer which uses the revoked certificate will be denied.   The COP server adds the revoked certificate (actually, a unique ID for the cert) to the CRL of the ledger via a config update.  This allows the VSCC (Validating System ChainCode) in peers to deterministically reject transactions signed by the revoked certificate.  There are two types of certificates which can be revoked: ecerts (enrollment certificates) and tcerts (transaction certificates). # Revoking an ecert is performed by the same identity that registers the identity.   This is accomplished by the following command: {quote} cop client revoke -id  <enrollmentID> {quote} This adds all non-expired certificates associated with the identity to the CRL list of both the COP server and the ledger.  # Revoking a tcert adds the ID (<serial number, COP ID>) of the tcert to the CRL list of the COP server and the CRL list of the ledger, thus preventing it's use by the COP server or the peer in a transaction context.  Who can revoke a certificate?   We may have configurable policies as needed in the future, but the current plan is to simply allow either of the following to revoke a certificate: # The root CA or intermediate CA(s) associated with the issuer chain of the certificate. # The registrar of the identity; that is, the one who registered the identity which allowed them to be issued the certificate in the first place.  When revoking an ecert, the enrollment ID as being revoked, keep it in the COP DB, and not allow the name to be reused. For now, I will assume "b" only.  Another consideration involves pruning of the CRL list.  When the COP server determines that the certificate on the CRL has expired at some time in the past, it can be removed from the CRL list since the request would be rejected anyway.  The COP server will have a delta time to allow for some clock skew, but as soon as the expiration + delta has passed, the COP server will remove the CRL from it's DB and also remove it from the fabric's CRL.  Revocation consists of the following 4 pieces of work. # Revoke a single certificate identified by serial number, adding to CRL list of COP server only. # Revoke all certificates associated with an enrollment ID (COP server only) and disable the enrollment ID. # Add revoked certificate serial numbers to the ledger's CRL list. # Prune the ledger's CRL list for certificates that have expired  See https://gerrit.hyperledger.org/r/#/c/2843/ for the change set for the 1st of these 4.   ></description> </Issue>
