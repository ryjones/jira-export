<Issue id="14491" key="FABC-292" number="292" project="10607" reporter="rennman" assignee="smithbk" creator="rennman" type="10004" summary="fabric-ca registrar &apos;leaks&apos; authority to delegates" priority="3" resolution="10000" status="6" created="2017-02-01 17:28:41.0" updated="2018-07-18 22:04:10.0" resolutiondate="2017-05-26 23:32:22.0" votes="1" watches="4" workflowId="32472"> <description><! CDATA In reference to 'Added test for registrar delegation' https://gerrit.hyperledger.org/r/#/c/5025/  I think the mis-spelling is actually a degenerate case of a larger problem, in which 'hf.Registrar.DelegateRoles' is not set  I'm basically working of the premise that: -admin may register users -admin may register registrars -delegate may register users -delegate may register registrars -registrar may register users -registrar may not register registrars -users may not register anyone  Registrar role is set/Delegate not set User is allowed to register user of only the type specified: Fail case works as expected:  {"name":"hf.Registrar.Roles","value":"peer,validator,auditor"}  Error response from server was 'User 'A_client' may not register type 'client'' for request:  However, in the successful case, the potential proagated authority is too broad. An admin that can only register 'clients' is allowed to delagate anything: {"id":"A_client","type":"client","group":"bank_a","attrs": {"name":"hf.Registrar.Roles","value":"client"} }  Received request to register user with id: D_clientclient, group: bank_a, attributes:  {hf.Registrar.Roles client,peer,validator,auditor} {hf.Registrar.DelegateRoles client,peer,validator,auditor} , registrar: A_client canRegister - Check to see if user A_client can register User D_clientclient inserted into database successfully  D_clientclient may now surpass (and propagate) 'A_client's authority Received request to register user with id: E_clientclientclient, group: bank_a, attributes:  {hf.Registrar.Roles client,peer,validator,auditor} , registrar: D_clientclient canRegister - Check to see if user D_clientclient can register User E_clientclientclient inserted into database successfully  Registrar role is not set/Delegate set User is not allowed to register anyone Fail case Works as expected: Error response from server was 'User 'A_client' may not register type 'client'' for request:  Similar to above, the proagated authority is too broad. A_client|HbaYvYqQrYrU|client|bank_a| {"name":"hf.Registrar.Roles","value":"client"} |1|1  A_client may register delegate, who in turn *should* only reigster client; however, A_client registers: D_clientclient|xRBPwVjaziqI|client|bank_a| {"name":"hf.Registrar.Roles","value":"client"},{"name":"hf.Registrar.DelegateRoles","value":"client"} |1|1  Who in turn, registers a client with very broad authority indeed E_clientclientclient|hWDkNNWSAAyI|client|bank_a| {"name":"hf.Registrar.Roles","value":"client,peer,validator,auditor"},{"name":"hf.Registrar.DelegateRoles","value":"client,peer,validator,auditor"} |1|1   ></description> </Issue>
