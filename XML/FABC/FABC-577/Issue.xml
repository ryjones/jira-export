<Issue id="30326" key="FABC-577" number="577" project="10607" reporter="davidkhala" assignee="aambati" creator="davidkhala" type="10004" summary="fabric-ca as docker image:FABRIC_CA_SERVER_CSR_CN not working" priority="3" resolution="10001" status="6" created="2018-05-17 01:43:50.0" updated="2018-09-17 14:06:23.0" resolutiondate="2018-09-17 14:05:55.0" votes="0" watches="3" workflowId="34537"> <description><! CDATA docker container command:  ``fabric-ca-server start -d -b Admin:adminpw``  docker environment : "Env":                   "GODEBUG=netdns=go",                 "FABRIC_CA_SERVER_CSR_CN=ca.ASTRI.Delphi.com",                 "PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin",                 "FABRIC_CA_HOME=/etc/hyperledger/fabric-ca-server"              , docker logs (bootstrap section) ``` 2018/05/17 01:35:32  INFO  Created default configuration file at /etc/hyperledger/fabric-ca-server/fabric-ca-server-config.yaml 2018/05/17 01:35:32  INFO  Starting server in home directory: /etc/hyperledger/fabric-ca-server 2018/05/17 01:35:32  INFO  Server Version: 1.1.0 2018/05/17 01:35:32  INFO  Server Levels: &{Identity:1 Affiliation:1 Certificate:1} 2018/05/17 01:35:32  DEBUG  Making server filenames absolute 2018/05/17 01:35:32  DEBUG  Initializing default CA in directory /etc/hyperledger/fabric-ca-server 2018/05/17 01:35:32  DEBUG  Init CA with home /etc/hyperledger/fabric-ca-server and config {Version:1.1.0 Cfg:{Identities:{AllowRemove:false} Affiliations:{AllowRemove:false}} CA:{Name: Keyfile: Certfile:ca-cert.pem Chainfile:ca-chain.pem} Signing:0xc420322750 CSR:{CN:ca.ASTRI.Delphi.com Names: {C:US ST:North Carolina L: O:Hyperledger OU:Fabric SerialNumber:}  Hosts: 3a9ae93e96f7 localhost  KeyRequest:<nil> CA:0xc4202f3e20 SerialNumber:} Registry:{MaxEnrollments:-1 Identities: { Name:**** Pass:**** Type:client Affiliation: MaxEnrollments:0 Attrs:map hf.Registrar.Attributes:* hf.AffiliationMgr:1 hf.Registrar.Roles:peer,orderer,client,user hf.Registrar.DelegateRoles:peer,orderer,client,user hf.Revoker:1 hf.IntermediateCA:1 hf.GenCRL:1   } } Affiliations:map org2: department1  org1: department1 department2   LDAP:{ Enabled:false URL:ldap://****:****@<host>:<port>/<base> UserFilter:(uid=%s) GroupFilter:(memberUid=%s) Attribute:{ uid member   { }  map groups: { }  } TLS:{false    { }}  } DB:{ Type:sqlite3 Datasource:fabric-ca-server.db TLS:{false    { }}  } CSP:0xc4202f5260 Client:<nil> Intermediate:{ParentServer:{ URL: CAName:  } TLS:{Enabled:false CertFiles:   Client:{KeyFile: CertFile:}} Enrollment:{ Name: Secret:**** Profile: Label: CSR:<nil> CAName: AttrReqs:    }} CRL:{Expiry:24h0m0s}} 2018/05/17 01:35:32  DEBUG  CA Home Directory: /etc/hyperledger/fabric-ca-server 2018/05/17 01:35:32  DEBUG  Checking configuration file version '1.1.0' against server version: '1.1.0' 2018/05/17 01:35:32  DEBUG  Initializing BCCSP: &{ProviderName:SW SwOpts:0xc4202f52c0 PluginOpts:<nil> Pkcs11Opts:<nil>} 2018/05/17 01:35:32  DEBUG  Initializing BCCSP with software options &{SecLevel:256 HashFamily:SHA2 Ephemeral:false FileKeystore:0xc420315a50 DummyKeystore:<nil>} 2018/05/17 01:35:32  DEBUG  Initialize key material 2018/05/17 01:35:32  DEBUG  Making CA filenames absolute 2018/05/17 01:35:32  INFO  The CA key and certificate files already exist 2018/05/17 01:35:32  INFO  Key file location: /etc/hyperledger/fabric-ca-server/ca-key.pem 2018/05/17 01:35:32  INFO  Certificate file location: /etc/hyperledger/fabric-ca-server/ca-cert.pem 2018/05/17 01:35:32  DEBUG  Validating the CA certificate and key 2018/05/17 01:35:32  DEBUG  Check CA certificate for valid dates 2018/05/17 01:35:32  DEBUG  Check CA certificate for valid usages 2018/05/17 01:35:32  DEBUG  Check CA certificate for valid IsCA value 2018/05/17 01:35:32  DEBUG  Check that key type is supported 2018/05/17 01:35:32  DEBUG  Check that key size is of appropriate length 2018/05/17 01:35:32  DEBUG  Check that public key and private key match 2018/05/17 01:35:32  DEBUG  Validation of CA certificate and key successful 2018/05/17 01:35:32  DEBUG  Loading CN from existing enrollment information 2018/05/17 01:35:32  DEBUG  Initializing DB 2018/05/17 01:35:32  DEBUG  Initializing 'sqlite3' database at '/etc/hyperledger/fabric-ca-server/fabric-ca-server.db' 2018/05/17 01:35:32  DEBUG  Using sqlite database, connect to database in home (/etc/hyperledger/fabric-ca-server/fabric-ca-server.db) directory 2018/05/17 01:35:32  DEBUG  Creating SQLite database (/etc/hyperledger/fabric-ca-server/fabric-ca-server.db) if it does not exist... 2018/05/17 01:35:32  DEBUG  Creating users table if it does not exist 2018/05/17 01:35:32  DEBUG  Creating affiliations table if it does not exist 2018/05/17 01:35:32  DEBUG  Creating certificates table if it does not exist 2018/05/17 01:35:32  DEBUG  Creating properties table if it does not exist 2018/05/17 01:35:32  DEBUG  Successfully opened sqlite3 DB 2018/05/17 01:35:32  DEBUG  Checking database schema... 2018/05/17 01:35:32  DEBUG  Update SQLite schema, if using outdated schema 2018/05/17 01:35:32  DEBUG  Upgrade identities table 2018/05/17 01:35:32  DEBUG  Creating users table if it does not exist 2018/05/17 01:35:33  DEBUG  Upgrade affiliation table 2018/05/17 01:35:33  DEBUG  Creating affiliations table if it does not exist 2018/05/17 01:35:33  DEBUG  Upgrade certificates table 2018/05/17 01:35:33  DEBUG  Creating certificates table if it does not exist 2018/05/17 01:35:33  DEBUG  Initializing identity registry 2018/05/17 01:35:33  DEBUG  Initialized DB identity registry 2018/05/17 01:35:33  DEBUG  DB: Get properties  identity.level affiliation.level certificate.level  2018/05/17 01:35:33  DEBUG  Checking database levels 'map affiliation.level:0 certificate.level:0 identity.level:0 ' against server levels '&{Identity:1 Affiliation:1 Certificate:1}' 2018/05/17 01:35:33  DEBUG  Loading identity table 2018/05/17 01:35:33  DEBUG  Loading identity 'Admin' 2018/05/17 01:35:33  DEBUG  DB: Getting identity Admin 2018/05/17 01:35:33  DEBUG  Max enrollment value verification - User specified max enrollment: 0, CA max enrollment: -1 2018/05/17 01:35:33  DEBUG  DB: Add identity Admin 2018/05/17 01:35:34  DEBUG  Successfully added identity Admin to the database 2018/05/17 01:35:34  DEBUG  Registered identity: { Name:**** Pass:**** Type:client Affiliation: MaxEnrollments:-1 Attrs:map hf.AffiliationMgr:1 hf.Registrar.Roles:peer,orderer,client,user hf.Registrar.DelegateRoles:peer,orderer,client,user hf.Revoker:1 hf.IntermediateCA:1 hf.GenCRL:1 hf.Registrar.Attributes:*   } 2018/05/17 01:35:34  DEBUG  Successfully loaded identity table 2018/05/17 01:35:34  DEBUG  Loading affiliations table 2018/05/17 01:35:34  DEBUG  DB: Add affiliation org1 2018/05/17 01:35:34  DEBUG  Affiliation 'org1' added 2018/05/17 01:35:34  DEBUG  DB: Add affiliation org1.department1 2018/05/17 01:35:34  DEBUG  Affiliation 'org1.department1' added 2018/05/17 01:35:34  DEBUG  DB: Add affiliation org1.department2 2018/05/17 01:35:34  DEBUG  Affiliation 'org1.department2' added 2018/05/17 01:35:34  DEBUG  DB: Add affiliation org2 2018/05/17 01:35:34  DEBUG  Affiliation 'org2' added 2018/05/17 01:35:34  DEBUG  DB: Add affiliation org2.department1 2018/05/17 01:35:35  DEBUG  Affiliation 'org2.department1' added 2018/05/17 01:35:35  DEBUG  Successfully loaded affiliations table 2018/05/17 01:35:35  DEBUG  Checking and performing migration, if needed 2018/05/17 01:35:35  DEBUG  Updating database level to &{Identity:1 Affiliation:1 Certificate:1} 2018/05/17 01:35:35  INFO  Initialized sqlite3 database at /etc/hyperledger/fabric-ca-server/fabric-ca-server.db 2018/05/17 01:35:35  DEBUG  Initializing enrollment signer 2018/05/17 01:35:35  DEBUG  No key found in BCCSP keystore, attempting fallback 2018/05/17 01:35:35  DEBUG  validating configuration 2018/05/17 01:35:35  DEBUG  validate local profile 2018/05/17 01:35:35  DEBUG  profile is valid 2018/05/17 01:35:35  DEBUG  validate local profile 2018/05/17 01:35:35  DEBUG  profile is valid 2018/05/17 01:35:35  DEBUG  validate local profile 2018/05/17 01:35:35  DEBUG  profile is valid 2018/05/17 01:35:35  DEBUG  CA initialization successful 2018/05/17 01:35:35  INFO  Home directory for default CA: /etc/hyperledger/fabric-ca-server 2018/05/17 01:35:35  DEBUG  1 CA instance(s) running on server 2018/05/17 01:35:35  INFO  Listening on http://0.0.0.0:7054 ```  docker logs (the next enroll request section) ``` 2018/05/17 01:35:40  DEBUG  Received request for /api/v1/enroll 2018/05/17 01:35:40  DEBUG  ca.Config: &{Version:1.1.0 Cfg:{Identities:{AllowRemove:false} Affiliations:{AllowRemove:false}} CA:{Name: Keyfile:/etc/hyperledger/fabric-ca-server/ca-key.pem Certfile:/etc/hyperledger/fabric-ca-server/ca-cert.pem Chainfile:/etc/hyperledger/fabric-ca-server/ca-chain.pem} Signing:0xc420322750 CSR:{CN:example.com Names: {C:US ST:North Carolina L: O:Hyperledger OU:Fabric SerialNumber:}  Hosts: 3a9ae93e96f7 localhost  KeyRequest:<nil> CA:0xc4202f3e20 SerialNumber:} Registry:{MaxEnrollments:-1 Identities: { Name:**** Pass:**** Type:client Affiliation: MaxEnrollments:0 Attrs:map hf.Revoker:1 hf.IntermediateCA:1 hf.GenCRL:1 hf.Registrar.Attributes:* hf.AffiliationMgr:1 hf.Registrar.Roles:peer,orderer,client,user hf.Registrar.DelegateRoles:peer,orderer,client,user   } } Affiliations:map org1: department1 department2  org2: department1   LDAP:{ Enabled:false URL:ldap://****:****@<host>:<port>/<base> UserFilter:(uid=%s) GroupFilter:(memberUid=%s) Attribute:{ uid member   { }  map groups: { }  } TLS:{false    { }}  } DB:{ Type:sqlite3 Datasource:/etc/hyperledger/fabric-ca-server/fabric-ca-server.db TLS:{false    { }}  } CSP:0xc4202f5260 Client:<nil> Intermediate:{ParentServer:{ URL: CAName:  } TLS:{Enabled:false CertFiles:   Client:{KeyFile: CertFile:}} Enrollment:{ Name: Secret:**** Profile: Label: CSR:<nil> CAName: AttrReqs:    }} CRL:{Expiry:24h0m0s}} 2018/05/17 01:35:40  DEBUG  DB: Getting identity Admin 2018/05/17 01:35:40  DEBUG  DB: Login user Admin with max enrollments of -1 and state of 0 2018/05/17 01:35:41  DEBUG  DB: identity Admin successfully logged in 2018/05/17 01:35:41  DEBUG  Processing sign request: id=Admin, CommonName=Admin, Subject=<nil> 2018/05/17 01:35:41  DEBUG  Request is not for a CA signing certificate 2018/05/17 01:35:41  DEBUG  Checking CSR fields to make sure that they do not exceed maximum character limits 2018/05/17 01:35:41  DEBUG  DB: Getting identity Admin 2018/05/17 01:35:41  DEBUG  Finished processing sign request 2018/05/17 01:35:41  DEBUG  DB: Getting identity Admin 2018/05/17 01:35:41  INFO  signed certificate with serial number 185835457939206331652819697991237202606727113262 2018/05/17 01:35:41  DEBUG  DB: Insert Certificate 2018/05/17 01:35:41  DEBUG  Saved serial number as hex 208d266f799b373d68951d185eaf55296a802a2e 2018/05/17 01:35:41  DEBUG  saved certificate with serial number 185835457939206331652819697991237202606727113262 2018/05/17 01:35:41  DEBUG  Successfully incremented state for identity Admin to 1 ```      ></description> </Issue>
