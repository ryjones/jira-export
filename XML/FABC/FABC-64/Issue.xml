<Issue id="19422" key="FABC-64" number="64" project="10607" reporter="rennman" creator="rennman" type="10002" summary="fabric-ca server intermediate CA +TLS + BCCSP fails with panic" priority="3" status="10000" created="2017-07-21 20:41:29.0" updated="2019-07-27 14:59:57.0" votes="0" watches="5" workflowId="32244"> <description><! CDATA Using the following bccsp config: BCCSP:    Default: PKCS11   PKCS11:     Library: /usr/lib/x86_64-linux-gnu/softhsm/libsofthsm2.so     Pin: '98765432'     Label: 'ForFabric'     Hash: SHA2     Security: 256     FileKeyStore:         # The directory used for the software file-based keystore         KeyStore: msp/keystore  An intermediate CA attempting to connect via TLS to a root CA encounters a fatal error:   2017/07/21 20:38:06 http: panic serving 127.0.0.1:60342: Key type not recognized -  &\{ski: 79 159 26 253 154 53 190 250 107 159 119 178 16 43 144 66 124 163 150 138 41 154 88 120 66 162 202 194 193 154 158 241  pub:0xc420411240}   &pkcs11.ecdsaPublicKey\{ski:  uint8\{0x4f, 0x9f, 0x1a, 0xfd, 0x9a, 0x35, 0xbe, 0xfa, 0x6b, 0x9f, 0x77, 0xb2, 0x10, 0x2b, 0x90, 0x42, 0x7c, 0xa3, 0x96, 0x8a, 0x29, 0x9a, 0x58, 0x78, 0x42, 0xa2, 0xca, 0xc2, 0xc1, 0x9a, 0x9e, 0xf1}, pub:(*ecdsa.PublicKey)(0xc420411240)}   *pkcs11.ecdsaPublicKey   *pkcs11.ecdsaPublicKey  goroutine 21  running : net/http.(*conn).serve.func1(0xc42040c480) /opt/go/src/net/http/server.go:1491 +0x12a panic(0xa40de0, 0xc4204130b0) /opt/go/src/runtime/panic.go:458 +0x243 github.com/hyperledger/fabric-ca/vendor/github.com/hyperledger/fabric/bccsp/pkcs11.(*impl).Sign(0xc4201c16d0, 0xfd7d60, 0xc420411260, 0xc420411dc0, 0x20, 0x20, 0x7ff3174ad108, 0xc420413068, 0xc420413068, 0xc42003a708, ...) /opt/gopath/src/github.com/hyperledger/fabric-ca/vendor/github.com/hyperledger/fabric/bccsp/pkcs11/impl.go:722 +0x4df github.com/hyperledger/fabric-ca/vendor/github.com/hyperledger/fabric/bccsp/signer.(*bccspCryptoSigner).Sign(0xc4203fb7d0, 0xfcdfa0, 0xc420018330, 0xc420411dc0, 0x20, 0x20, 0xfd0020, 0xc420413068, 0x0, 0x0, ...) /opt/gopath/src/github.com/hyperledger/fabric-ca/vendor/github.com/hyperledger/fabric/bccsp/signer/signer.go:88 +0xd0 crypto/tls.(*ecdheKeyAgreement).generateServerKeyExchange(0xc420351e40, 0xc420296160, 0xc42035eae0, 0xc42040a640, 0xc420404b60, 0x32a, 0x0, 0x0) /opt/go/src/crypto/tls/key_agreement.go:255 +0x67c crypto/tls.(*serverHandshakeState).doFullHandshake(0xc42004bbd8, 0xc42003ab00, 0x0) /opt/go/src/crypto/tls/handshake_server.go:397 +0x3de crypto/tls.(*Conn).serverHandshake(0xc42031fc00, 0xb49be8, 0xc42031fd08) /opt/go/src/crypto/tls/handshake_server.go:86 +0x316 crypto/tls.(*Conn).Handshake(0xc42031fc00, 0x0, 0x0) /opt/go/src/crypto/tls/conn.go:1262 +0x2c3 net/http.(*conn).serve(0xc42040c480, 0xfd68e0, 0xc4203fbe00) /opt/go/src/net/http/server.go:1507 +0x121 created by net/http.(*Server).Serve /opt/go/src/net/http/server.go:2293 +0x44d Error: POST failure  Post https://localhost:17054/enroll: EOF ; not sending POST https://localhost:17054/enroll  ></description> </Issue>
