<Issue id="15591" key="FABC-178" number="178" project="10607" reporter="skarim" assignee="skarim" creator="skarim" type="10004" summary="Fix max enrollment checking logic" priority="3" resolution="10000" status="6" created="2017-04-05 21:46:56.0" updated="2018-07-18 22:03:46.0" resolutiondate="2017-06-02 00:17:41.0" votes="5" watches="6" workflowId="32358"> <description><! CDATA The max enrollment configuration setting is not implemented correctly.  It should work as follows.  Let *ca**MaxEnrollments* be the globally configured max enrollments for the CA, and *user**MaxEnrollments* be the per-user/identity max enrollments setting.  The userMaxEnrollments setting is part of the registration request for a user/identity.**  The valid values (and semantics) for *ca**MaxEnrollments* are: {code:java} -1: Infinite number of enrollments (i.e. no limit) 0: Enrollments disabled globally >0: Maximum number of enrollments allowed globally{code} The valid values (and semantics) for *user**MaxEnrollments* are: {code:java} -1: Infinite number of enrollments (i.e. no limit) 0: Use the caMaxEnrollments value >0: Maximum number of enrollments{code}    When a registration request is received which contains a userMaxEnrollments setting, an error is returned if:  1) userMaxEnrollments is -1 (infinite) and caMaxEnrollments is not -1  2) userMaxEnrollments > 0 and userMaxEnrollments > caMaxEnrollments  If userMaxEnrollments is 0 (the default value), the userMaxEnrollments value is set to the current value of caMaxEnrollments.     Keep in mind that the caMaxEnrollments setting may change between the time that a user is registered and when that user enrolls (multiple times).     When an enrollment request is received for a particular user/identity, the current max enrollment ** setting for that user which is enforced is calculated as the minimum of the current caMaxEnrollments setting (if not -1) and the userMaxEnrollments setting for that user.     This allows the caMaxEnrollment setting to always act as a backstop for max enrollments.  For example, the following scenarios are supported:  1) caMaxEnrollments set to 0 means enrollment is temporarily disabled for the CA  2) caMaxEnrollments set to 1 means all passwords are treated as a OTP (One-Time Password)  3) caMaxEnrollments set to -1 means registrars are in *complete* control of managing the max enrollments settings on a per user basis.  4) caMaxEnrollments > 1 means registrars have *partial* control of managing the max enrollments setting on a per user basis.     ></description> </Issue>
