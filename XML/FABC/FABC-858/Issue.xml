<Issue id="41434" key="FABC-858" number="858" project="10607" reporter="vieiramanoel" creator="vieiramanoel" type="10004" summary="PKCS11 won&apos;t work in docker container (HSM)" priority="3" resolution="10201" status="6" created="2019-07-25 18:22:40.0" updated="2019-07-27 12:30:41.0" resolutiondate="2019-07-27 10:04:55.0" votes="1" watches="5" workflowId="54451"> <description><! CDATA Last days I've been working in integrate fabric-ca with a vendor HSM, and pkcs11 lib has been failed to initialize over and over, even that all variables were set and vendor's driver (pkcs11 lib) was available for fabric-ca to load.  Then I investigated until I found which go library was responsible for loading pkcs11.so lib into ca's code.   The lib is miekg's  pkcs11lib|https://github.com/miekg/pkcs11 .  Running it's sample code (present at miekg's repo Read.me) the string is successfully digest by hsm.  So I built fabric-ca image from repository adding necessary packages (git, gcc, libc-dev and golang) and tried to run pkcs11.go (miekg's sample) code inside it, the error I got:   {code:java} panic: runtime error: invalid memory address or nil pointer dereference  signal SIGSEGV: segmentation violation code=0x1 addr=0x0 pc=0x49b1a2   goroutine 1  running : github.com/miekg/pkcs11.(*Ctx).Initialize.func1(0x0, 0xc0000a2020) /go/pkg/mod/github.com/miekg/pkcs11@v1.0.2/pkcs11.go:805 +0x22 github.com/miekg/pkcs11.(*Ctx).Initialize(0x0, 0x12, 0x0) /go/pkg/mod/github.com/miekg/pkcs11@v1.0.2/pkcs11.go:805 +0x2b main.main() /hsm-test/pcks11.go:19 +0x164 exit status 2 {code}  This process is well decribed in this  issue|https://github.com/miekg/pkcs11/issues/120 .  When reported in miekg's repository (see issue above) his reply was:  "dont use alpine"  as if the problem was the linux distro itself. So this morning I tried to run miekg's code from an ubuntu image inside docker too (described in linked issue as well). Same error. So the library itself has some problem with running inside dockers or something like that. The problem is not with vendor's library once the code works at host machine perfectly.   My question is, what could we do in fabric-ca in order to solve this problem?     ></description> </Issue>
