<Action id="18784" issue="12367" author="christopherferris" type="comment" created="2016-09-05 20:58:22.0" updateauthor="christopherferris" updated="2016-09-05 20:58:22.0"> <body><! CDATA Description  When a registration fails the internal data structure are left in an inconsistent state at the client and at the membership service side. For instance, trying to register the second time with the same credentials will succeed by saying that the node has been already registered.  Describe How to Reproduce  The following test try to register a client with an enrollID that correspond to a validator at the membership service. The first call fails as expected but second doesn't. The client is in an inconsistent state.  func TestDoubleRegistrationWithDifferentRoles(t * testing.T) { err := RegisterClient("validator", nil, "validator", "9gvZQRwhUq9q") if err == nil { t.Fatal("Init should fail") }  err = RegisterClient("validator", nil, "validator", "9gvZQRwhUq9q") if err == nil { t.Fatal("Init should fail") } } The following test try to register a client with an enrollID that correspond to a validator at the membership service. The first call fails as expected but second should succeed. The membership service is in an inconsistent state.  func TestDoubleRegistration(t * testing.T) { // Wrong type err := RegisterClient("validator", nil, "validator", "9gvZQRwhUq9q") if err == nil { t.Fatalf("RegisterValidator should fail") }  // Right type err = RegisterValidator("validator", nil, "validator", "9gvZQRwhUq9q") if err != nil { t.Fatalf("RegisterValidator should succed  %s ", err) } } Actually, the above test is really subtle because the failure of the first RegisterClient happens at very end of the protocol when the RegisterClient parses the latest message sent by the MS. So, from the MS point of view, the protocol has been successfully run. One solution would be then to modify to registration protocol to notify immediately the MS about which kind of registration the client is trying to do. Other solutions are possible. @JonathanLevi what do you think?  ></body> </Action>
<Action id="21793" issue="12367" author="mastersingh24" type="comment" body="There is no longer active development on v0.6 so closing this" created="2017-04-02 12:21:12.0" updateauthor="mastersingh24" updated="2017-04-02 12:21:12.0"/>
