<Action id="32504" issue="22026" author="mastersingh24" type="comment" body=" ~rennman  - Why exactly do we care?  " created="2017-10-16 10:39:36.0" updateauthor="mastersingh24" updated="2017-10-16 10:39:36.0"/>
<Action id="32529" issue="22026" author="rennman" type="comment" created="2017-10-16 17:58:51.0" updateauthor="rennman" updated="2017-10-16 17:58:51.0"> <body><! CDATA I would think we want to honor what the user configured, but at any rate it's more convoluted.  We have three relevant vars: {code:java} datasource dbName connStr{code}   datasource is the raw value taken straight from the configuration. dbName is extracted from datasource.  In NewUserRegistryMySQL(), we instantiate the DB obejct by making a call to DB.Open() using a generic connection string, which *should* be the datasource minus the dbName. e.g., if {code:java}    datasource: root:mysql@tcp(localhost:3306)/fabric_ca2?parseTime=true{code}  then it follows that {code:java}    dbName="fabric_ca2"    connStr="root:mysql@tcp(localhost:3306)/?parseTime=true"{code}   We do extract the DB name correctly (correctly, in the sense that we allow literally anything that is not forward slash '/', or colon ':'). However, because we are inconsistent with the rules that build the initial connStr, in the current code we essentially stop when we  see any character that is not in the set the set  a-zA-z , so datasource is transmuted into:    connStr="root:mysql@tcp(localhost:3306)/{color:#ff0000}*2*{color}?parseTime=true"   Consequently, when we attempt to instantiate the DB object, we try to connect to a database that doesn't (or with extremely high probability) exist: {code:java} 2017/10/16 17:10:20  DEBUG  Connecting to MySQL server, using connection string: ****:****@tcp(localhost:3306)/2?parseTime=true 2017/10/16 17:10:20  ERROR  Error occurred initializing database: Failed to create user registry for MySQL: Failed to connect to MySQL database: Error 1049: Unknown database '2'{code} Because we return immediately with an error, we skip the call to createMySQLDatabase() altogether (which ironically, probably would have succeeded since the call to createMySQLDatabase() is made with the raw datasource)  At a minimum, we should allow the same character set for the DB name when building the connStr, as we allow in getDBName, namely    anything not in the set  /: . Ideally, we would use the restrictions from the documentation:     0-9,a-z,A-Z$_   ></body> </Action>
<Action id="32904" issue="22026" author="skarim" type="comment" body="This will be resolved in  FAB-6508 . https://gerrit.hyperledger.org/r/#/c/14715/" created="2017-10-19 20:18:43.0" updateauthor="skarim" updated="2017-10-19 20:18:43.0"/>
