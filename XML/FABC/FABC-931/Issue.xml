<Issue id="46956" key="FABC-931" number="931" project="10607" reporter="denyeart" assignee="JIRAUSER20406" creator="denyeart" type="10001" summary="Re-enroll with existing key even if certificate is expired" priority="3" resolution="10000" status="6" created="2021-06-18 05:37:19.0" updated="2021-07-26 13:43:41.0" resolutiondate="2021-07-26 13:43:41.0" votes="0" watches="1" workflowId="60868" archived="N"> <description><! CDATA With Fabric CA client it is possible to reenroll to get a new certificate with updated expiration. As of Fabric CA v1.4.9 it is possible to reenroll with the existing private/public key pair when passing --csr.keyrequest.reusekey. This is advantageous especially for TLS certs since it means an orderer identity can get a certificate with updated expiration without the channel configuration needing to be updated (as of Fabric v1.4.9 and v2.2.1 when TLS certs are verified between channel members only the key is checked, not the entire certificate).  However, if the certificate is already expired, Fabric CA currently returns an error and does not allow the identity to reenroll to receive a new cert.  If the identity is not revoked but only has an expired certificate, they should still be allowed to receive a new certificate.  This story will add a yaml config option to allow Fabric CA to reenroll with same key even if the identity's certificate has expired.  Example of the issue when using an identity that has an expired certificate: {code:java} fabric-ca-client reenroll -u https://user1:user1pw@localhost:7054 --caname ca-org1 -M "${PWD}/organizations/peerOrganizations/org1.example.com/users/User1@org1.example.com/msp" --tls.certfiles "${PWD}/organizations/fabric-ca/org1/tls-cert.pem" --csr.keyrequest.reusekey{code} Fabric CA client receives error: {code:java} Error: Failed to reenroll 'user1': Response from server: Error Code: 20 - Authentication failure{code} Fabric CA server log INFO statement: {code:java} 2021/06/17 22:27:24  INFO  172.25.0.1:35980 POST /reenroll 401 26 "Untrusted certificate: Failed to verify certificate: x509: certificate has expired or is not yet valid: current time 2021-06-17T22:27:24Z is after 2021-06-17T22:27:00Z"{code}    Notes - * You can set expiration time (e.g. 1 minute instead of 1 year) by overriding yaml config with FABRIC_CA_SERVER_SIGNING_DEFAULT_EXPIRY=1m. * For full set of config options see  https://hyperledger-fabric-ca.readthedocs.io/en/main/serverconfig.html  * The example used a client MSP identity and signing expiry, but orderer TLS certificate works the same way. * The original register/enroll commands can be found in test-network,e.g.  https://github.com/hyperledger/fabric-samples/blob/main/test-network/organizations/fabric-ca/registerEnroll.sh#L70  * There is not yet a release branch for release-1.5... v1.5.x releases are cut from the main branch.        ></description> </Issue>
