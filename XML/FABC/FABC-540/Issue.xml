<Issue id="15413" key="FABC-540" number="540" project="10607" reporter="rennman" assignee="skarim" creator="rennman" type="10001" summary="Remove -c option from documentation and usage message and add -H option" priority="3" resolution="10000" status="6" created="2017-03-20 21:47:07.0" updated="2018-07-20 19:16:40.0" resolutiondate="2017-09-16 17:16:48.0" votes="0" watches="6" workflowId="32722"> <description><! CDATA This JIRA item was originally a bug with a summary of:       "fabric-ca-client requires username:password for revoke cmd".  It turns out that it isn't strictly a bug, but is certainly a usability and serviceability problem that will cause headaches in the future if we don't address it now.   The problem is as follows ...  If a custom configuration file is used to enroll a user, commands executed after this initial enroll require that the name of the configuration file always be specified via command line. Take for example the simple scenario below.  1) {code:java} export FABRIC_CA_CLIENT_HOME=/tmp/clienthome  fabric-ca-client enroll -c /tmp/clienthome/enrolladmin.yaml -u http://admin:adminpw@localhost:7054{code} 2) {code:java} fabric-ca-client -d revoke --revoke.name admin{code} The following error is seen: {code:java} 2017/05/23 21:34:01  INFO  User provided config file: /tmp/clienthome/fabric-ca-client-config.yaml Error: Failed to create default configuration file: No username and password provided as part of URL{code} This occurs because if no configuration file is provided via the command line flags (-c) it looks to use the default file name (fabric-ca-client-config.yaml) for the client configuration file. However, in this case the enroll command executed in the beginning used a custom file name (enrolladmin.yaml), so the revoke command or any subsequent non enroll command will fail due to lack of existing configuration file.  The is not great from a usability point of view as users will not understand why it is not picking up configuration file that was already created and exists in the client home directory. Users would have to always specify the config file via -c flag for any subsequent command after the enroll, which also is not great from a usability perspective. A static configuration file name should be used but client home directory should be customizable from the command line.  So the proposal is to remove support for the –      -c configFile  option and replace it with      -H homeDirectory  option.  We already allow the home directory to be specified via env variables, and that will not change.     For history, here is the original description of this JIRA item:  -------------------------------------------------------------------------------  While testing the hf.Revoker attribute, I got an error from the revoke command:  FATAL  Failed to create default configuration file: No username and password provided as part of URL The same test had not previously required user:pass for revoke  Note that I did pass the '-u' option, but got the same result when I did not: root@e8282fda8229:/opt/gopath/src/github.com/hyperledger/fabric-ca# /opt/gopath/src/github.com/hyperledger/fabric-ca/bin/fabric-ca-client -d revoke -u  http://localhost:8888|http://localhost:8888/  --eid admin2 2017/03/20 21:45:29  FATAL  Failed to create default configuration file: No username and password provided as part of URL  root@e8282fda8229:/opt/gopath/src/github.com/hyperledger/fabric-ca# /opt/gopath/src/github.com/hyperledger/fabric-ca/bin/fabric-ca-client -d revoke --eid admin2 2017/03/20 21:45:54  FATAL  Failed to create default configuration file: No username and password provided as part of URL  The exact sequence of commands were as follows: + export CA_CFG_PATH FABRIC_CA_CLIENT_HOME FABRIC_CA_ENROLLMENT_DIR FABRIC_CA_CERT_FILE FABRIC_CA_KEY_FILE + CA_CFG_PATH=/tmp/revoke_test + FABRIC_CA_ENROLLMENT_DIR=/tmp/revoke_test/admin + FABRIC_CA_CERT_FILE='/tmp/revoke_test/admin/msp/signcerts/cert.pem' + FABRIC_CA_KEY_FILE='/tmp/revoke_test/admin/msp/keystore/key.pem' + /opt/gopath/src/github.com/hyperledger/fabric-ca/bin/fabric-ca-client enroll -u  http://admin:adminpw@localhost:8888|http://admin:adminpw@localhost:8888/  -c /tmp/revoke_test/admin/enroll.yaml --csr.cn admin --tls.certfiles /opt/gopath/src/github.com/hyperledger/fabric-ca/testdata/root.pem --enrollment.hosts admin@fab-client.raleigh.ibm.com,admin.fabric.raleigh.ibm.com,127.0.0.2  + export CA_CFG_PATH FABRIC_CA_ENROLLMENT_DIR FABRIC_CA_CERT_FILE FABRIC_CA_KEY_FILE + CA_CFG_PATH=/tmp/revoke_test + FABRIC_CA_ENROLLMENT_DIR=/tmp/revoke_test/admin2 + FABRIC_CA_CERT_FILE='/tmp/revoke_test/admin2/msp/signcerts/cert.pem' + FABRIC_CA_KEY_FILE='/tmp/revoke_test/admin2/msp/keystore/key.pem' + /opt/gopath/src/github.com/hyperledger/fabric-ca/bin/fabric-ca-client enroll -u  http://admin2:adminpw2@localhost:8888|http://admin2:adminpw2@localhost:8888/  -c /tmp/revoke_test/admin2/enroll.yaml --csr.cn admin2 --tls.certfiles /opt/gopath/src/github.com/hyperledger/fabric-ca/testdata/root.pem --enrollment.hosts admin2@fab-client.raleigh.ibm.com,admin2.fabric.raleigh.ibm.com,127.0.0.2  + export CA_CFG_PATH FABRIC_CA_ENROLLMENT_DIR FABRIC_CA_CERT_FILE FABRIC_CA_KEY_FILE + CA_CFG_PATH=/tmp/revoke_test + FABRIC_CA_ENROLLMENT_DIR=/tmp/revoke_test/notadmin + FABRIC_CA_CERT_FILE='/tmp/revoke_test/notadmin/msp/signcerts/cert.pem' + FABRIC_CA_KEY_FILE='/tmp/revoke_test/notadmin/msp/keystore/key.pem' + /opt/gopath/src/github.com/hyperledger/fabric-ca/bin/fabric-ca-client enroll -u  http://notadmin:pass@localhost:8888|http://notadmin:pass@localhost:8888/  -c /tmp/revoke_test/notadmin/enroll.yaml --csr.cn notadmin --tls.certfiles /opt/gopath/src/github.com/hyperledger/fabric-ca/testdata/root.pem --enrollment.hosts notadmin@fab-client.raleigh.ibm.com,notadmin.fabric.raleigh.ibm.com,127.0.0.2  + FABRIC_CA_CLIENT_HOME=/tmp/revoke_test/notadmin + FABRIC_CA_ENROLLMENT_DIR=/tmp/revoke_test/notadmin + FABRIC_CA_CERT_FILE=/tmp/revoke_test/notadmin/msp/signcerts/cert.pem + FABRIC_CA_KEY_FILE=/tmp/revoke_test/notadmin/msp/keystore/key.pem + /opt/gopath/src/github.com/hyperledger/fabric-ca/bin/fabric-ca-client -d revoke --eid admin2  ></description> </Issue>
