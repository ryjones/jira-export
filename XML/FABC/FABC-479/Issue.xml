<Issue id="27362" key="FABC-479" number="479" project="10607" reporter="smithbk" assignee="skarim" creator="smithbk" type="10001" summary="Make 2 DB queries into 1" priority="3" resolution="10000" status="6" created="2018-02-02 10:30:16.0" updated="2018-07-20 19:16:02.0" resolutiondate="2018-07-09 19:23:24.0" votes="0" watches="4" workflowId="32661"> <description><! CDATA In lib/dbaccessor.go, line 359, the following code can be optimized to be a single DB query:  {code} 	query := "SELECT * FROM users WHERE (affiliation = ?)" 	ids :=   UserRecord{} 	err = tx.Select(&ids, tx.Rebind(query), name) 	if err != nil { 		return nil, newHTTPErr(500, ErrRemoveAffDB, "Failed to select users with affiliation '%s': %s", name, err) 	}  	subAffName := name + ".%" 	query = "SELECT * FROM users WHERE (affiliation LIKE ?)" 	subAffIds :=   UserRecord{} 	err = tx.Select(&subAffIds, tx.Rebind(query), subAffName) 	if err != nil { 		return nil, newHTTPErr(500, ErrRemoveAffDB, "Failed to select users with sub-affiliation of '%s': %s", name, err) 	} {code}  There are probably other operations which could be joined as well, such as deleting all affiliations at once rather than separately deleting the subaffiliations and affiliation.  ></description> </Issue>
