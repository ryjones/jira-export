<Issue id="21752" key="FABC-177" number="177" project="10607" reporter="lehors" assignee="lehors" creator="lehors" type="10004" summary="CA DB is left open in error case" environment="vagrant 1.9.5 / Windows 7" priority="3" resolution="10000" status="6" created="2017-10-10 09:28:12.0" updated="2018-07-18 22:03:46.0" resolutiondate="2017-10-20 16:32:07.0" votes="0" watches="1" workflowId="32357"> <description><! CDATA In case an error occurs NewCA returns an error and nil, leaving the CA DB open with no way to access it anymore. {code:java} func NewCA(caFile string, config *CAConfig, server *Server, renew bool) (*CA, error) { ca := new(CA) ca.ConfigFilePath = caFile err := initCA(ca, filepath.Dir(caFile), config, server, renew) if err != nil { return nil, err } return ca, nil } {code} This makes it impossible to delete the DB file on Windows (file is "busy"), which then makes TestCAloadUsersTable fail: {code:java} --- FAIL: TestCAloadUsersTable (0.25s) ca_test.go:708: ca.newCA error: Failed to load identity table: Code: 34 - Configuration Error: Max enrollment in registration request may not be less than -1, but was -10 ca_test.go:722: Remove failed: remove ../testdata/fabric-ca-server.db: text file busy FAIL exit status 1 FAIL github.com/hyperledger/fabric-ca/lib 0.088s  {code}  ></description> </Issue>
