<Issue id="21005" key="FABC-223" number="223" project="10607" reporter="rennman" assignee="skarim" creator="rennman" type="10004" summary="fabric-ca-server index out of range for serverregister" priority="3" resolution="10000" status="6" created="2017-09-26 17:26:08.0" updated="2018-07-18 22:03:56.0" resolutiondate="2017-10-19 19:28:47.0" votes="0" watches="1" workflowId="32403"> <description><! CDATA When handling register request, we aren't checking that hf.Registrar.Roles exists, only that no error is returned from ctx.GetUserInfo() : registrarRolesAttr, registrarAffiliation, err := ctx.GetUserInfo(  string\{"hf.Registrar.Roles"}) if err != nil \{ return "", fmt.Errorf("Failed to get user info for registrar: %s", err) }  Consequently, if hf.Registrar.Roles is not defined for the ID making the request, the servers panics:    2017/09/26 17:15:40 http: panic serving 127.0.0.1:57152: runtime error: index out of range goroutine 20  running : net/http.(*conn).serve.func1(0xc42041e500)     /opt/go/src/net/http/server.go:1491 +0x12a panic(0xab8d20, 0xc420016110)     /opt/go/src/runtime/panic.go:458 +0x243 github.com/hyperledger/fabric-ca/lib.registerHandler(0xc42041e700, 0xc42041e700, 0x0, 0x0, 0x1)     /opt/gopath/src/github.com/hyperledger/fabric-ca/lib/serverregister.go:65 +0x445 github.com/hyperledger/fabric-ca/lib.(*serverEndpoint).ServeHTTP(0xc42042a0f0, 0x10777c0, 0xc4203fcf70, 0xc42041a1e0)     /opt/gopath/src/github.com/hyperledger/fabric-ca/lib/serverendpoint.go:44 +0xc93 net/http.(*ServeMux).ServeHTTP(0xc42042a030, 0x10777c0, 0xc4203fcf70, 0xc42041a1e0)     /opt/go/src/net/http/server.go:2022 +0x7f net/http.serverHandler.ServeHTTP(0xc42041e480, 0x10777c0, 0xc4203fcf70, 0xc42041a1e0)     /opt/go/src/net/http/server.go:2202 +0x7d net/http.(*conn).serve(0xc42041e500, 0x1078180, 0xc420426300)     /opt/go/src/net/http/server.go:1579 +0x4b7 created by net/http.(*Server).Serve     /opt/go/src/net/http/server.go:2293 +0x44d     A potential fix is to check that registrarRolesAttr isn't nil before using it:  registrarRolesAttr, registrarAffiliation, err := ctx.GetUserInfo(  string\{"hf.Registrar.Roles"}) ...  + if len(registrarRolesAttr) >=0 \{ + return "", fmt.Errorf("Failed to get roles info for registrar: %s", callerID) + }  ></description> </Issue>
