<Issue id="20083" key="FABC-273" number="273" project="10607" reporter="ptippett" assignee="ptippett" creator="ptippett" type="10004" summary="Cannot verify signature. Error is: Wrong key usage using Java SDK" priority="3" resolution="10000" status="6" created="2017-08-09 19:57:19.0" updated="2018-07-18 22:04:06.0" resolutiondate="2017-10-18 18:00:13.0" votes="0" watches="4" workflowId="32453"> <description><! CDATA From everything I'm seeing it's looking like Java isn't having a good time with the certs it's getting from the fabric CA. The "Wrong key usage" is thrown in the `Signature.initVerify()` method in the JDK which apparently complains if the certificate is marked as not being appropriate for signing (see line 473 of http://www.atetric.com/atetric/javadoc/openjdk/jdk/7u79/src-html/java/security/Signature.html). I'm getting this error on both a Linux VM using OpenJDK and on my Mac with the IBM JDK.  I managed to get the info of the certificate the SDK was erroring on. (I had to do a little fiddling with it because the cert as displayed in the Java exception was giving me `-----BEGIN -----` instead of `-----BEGIN CERTIFICATE-----`, like wise for `END`). It's looking like the cert I'm getting from the Bluemix instance of the ledger when trying to send a transaction proposal in fact does not support digital signatures (though it supports certificate signing).     Here's the stack trace from Java:  ERROR 2017-08-09 14:12:19,717 7222 org.hyperledger.fabric.sdk.security.CryptoPrimitives  main  Cannot verify signature. Error is: Wrong key usage Certificate: 2D2D...2D0A org.hyperledger.fabric.sdk.exception.CryptoException: Cannot verify signature. Error is: Wrong key usage Certificate: 2D2D...2D0A at org.hyperledger.fabric.sdk.security.CryptoPrimitives.verify(CryptoPrimitives.java:187) at org.hyperledger.fabric.sdk.ProposalResponse.verify(ProposalResponse.java:106) at org.hyperledger.fabric.sdk.Channel.sendProposalToPeers(Channel.java:2040) at org.hyperledger.fabric.sdk.Channel.sendProposal(Channel.java:1955) at org.hyperledger.fabric.sdk.Channel.sendTransactionProposal(Channel.java:1889) at com.ibm.hyperledger.HyperledgerClient.storeDocument(HyperledgerClient.java:134) at com.ibm.hyperledger.Main.testCommunications(Main.java:72) at com.ibm.hyperledger.Main.main(Main.java:22) Caused by: java.security.InvalidKeyException: Wrong key usage at java.security.Signature.initVerify(Signature.java:501) at org.hyperledger.fabric.sdk.security.CryptoPrimitives.verify(CryptoPrimitives.java:180) ... 7 more ERROR 2017-08-09 14:12:19,718 7223 org.hyperledger.fabric.sdk.ProposalResponse  main  verify: Cannot retrieve peer identity from ProposalResponse. Error is: Cannot verify signature. Error is: Wrong key usage Certificate: 2D2D...2D0A org.hyperledger.fabric.sdk.exception.CryptoException: Cannot verify signature. Error is: Wrong key usage Certificate: 2D2D...2D0A at org.hyperledger.fabric.sdk.security.CryptoPrimitives.verify(CryptoPrimitives.java:187) at org.hyperledger.fabric.sdk.ProposalResponse.verify(ProposalResponse.java:106) at org.hyperledger.fabric.sdk.Channel.sendProposalToPeers(Channel.java:2040) at org.hyperledger.fabric.sdk.Channel.sendProposal(Channel.java:1955) at org.hyperledger.fabric.sdk.Channel.sendTransactionProposal(Channel.java:1889) at com.ibm.hyperledger.HyperledgerClient.storeDocument(HyperledgerClient.java:134) at com.ibm.hyperledger.Main.testCommunications(Main.java:72) at com.ibm.hyperledger.Main.main(Main.java:22) Caused by: java.security.InvalidKeyException: Wrong key usage at java.security.Signature.initVerify(Signature.java:501) at org.hyperledger.fabric.sdk.security.CryptoPrimitives.verify(CryptoPrimitives.java:180) ... 7 more ERROR 2017-08-09 14:12:19,719 7224 main  main  Main errored. java.lang.Exception: Invoke transaction proposal failed at com.ibm.hyperledger.HyperledgerClient.storeDocument(HyperledgerClient.java:143) at com.ibm.hyperledger.Main.testCommunications(Main.java:72) at com.ibm.hyperledger.Main.main(Main.java:22)     ></description> </Issue>
