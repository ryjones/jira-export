<Action id="53229" issue="35231" author="mastersingh24" type="comment" created="2018-11-08 17:31:30.0" updateauthor="mastersingh24" updated="2018-11-08 17:31:30.0"> <body><! CDATA You should mount your host volume to  {noformat} /opt/couchdb/etc/default.d/{noformat}  ></body> </Action>
<Action id="53293" issue="35231" author="rhegde" type="comment" created="2018-11-12 01:11:03.0" updateauthor="rhegde" updated="2018-11-12 01:11:37.0"> <body><! CDATA I did the same for couch database v1.0.6 image -    # Created  a folder named couchdb01.xxx.cit.clsnet_etc_default.d # added the following host volume mount to compose        - ./mount/couchdb01.xxx.cit.clsnet_etc_default.d:/opt/couchdb/etc/default.d/  However couch database instance exits with following error. {code:java} onfig,{set,\"admins\",\"clsnet\",\"-pbkdf2-57349ae9c7a83bfc2e5c476d359bee98614c4b58,0a36556009421f380d875a3c37152eb2,10\",true,nil} }}}}}},{couch_app,start, normal,   }}}"} Crash dump was written to: erl_crash.dump Kernel pid terminated (application_controller) ({application_start_failure,couch,{{shutdown,{failed_to_start_child,couch_primary_services,{shutdown,{failed_to_start_child,couch_server,{{{badmatch,{e  {code}    I did also try adding local.d following however with the same exit status.  ./mount/couchdb01.xxx.cit.clsnet_etc_local.d:/opt/couchdb/etc/local.d/  Following is folder content after couch database was exited.  {code:java} couchdb01.xxx.cit.clsnet_etc_default.d: couchdb01.xxx.cit.clsnet_etc_local.d: docker.ini {code}    Can you please suggest.   ></body> </Action>
<Action id="56521" issue="35231" author="clayton sims" type="comment" body="Chris can you take a look as this one.    ~denyeart  fyi" created="2019-02-01 20:53:30.0" updateauthor="clayton sims" updated="2019-02-01 20:53:30.0"/>
<Action id="57055" issue="35231" author="rhegde" type="comment" body=" ~Clayton Sims  - can we have this change back ported to v.1.2 release." created="2019-02-14 21:29:44.0" updateauthor="rhegde" updated="2019-02-14 21:29:44.0"/>
<Action id="57079" issue="35231" author="denyeart" type="comment" created="2019-02-15 16:01:57.0" updateauthor="denyeart" updated="2019-02-17 17:47:54.0"> <body><! CDATA CouchDB official docker image  https://github.com/apache/couchdb-docker  recommends all user overrides to CouchDB container config should go in directory /opt/couchdb/etc/local.d.  CR  https://gerrit.hyperledger.org/r/#/c/29346/  adds volume:  VOLUME  "/opt/couchdb/etc/local.d"   Users can then mount a host directory to maintain config overrides as follows (in docker compose syntax): {code:java} volumes: - <HOST_DIRECTORY>:/opt/couchdb/etc/local.d{code}     ~rhegde  Please test in your environment and confirm this will work for you.  ></body> </Action>
<Action id="58001" issue="35231" author="denyeart" type="comment" body=" ~rhegde  Haven&apos;t heard back from you... we&apos;d like you to confirm the approach before it is merged." created="2019-03-08 13:55:29.0" updateauthor="denyeart" updated="2019-03-08 13:55:29.0"/>
<Action id="58026" issue="35231" author="rhegde" type="comment" created="2019-03-10 23:11:04.0" updateauthor="rhegde" updated="2019-03-10 23:11:04.0"> <body><! CDATA Hello  ~denyeart  - I am not able to verify it at this point of time as the couch database fabric image version  (0.4.14) does not stand-up with data persistence enabled. This looks like a reported issue as of now via FAB-13475.  Data persistence is enabled in our complete setup and would like both the issues to be fixed in the next release of couch database docker image version release.  ></body> </Action>
<Action id="58045" issue="35231" author="denyeart" type="comment" created="2019-03-11 13:03:47.0" updateauthor="denyeart" updated="2019-03-11 13:03:47.0"> <body><! CDATA  ~rhegde  Ok, we will investigate FAB-13475 today.  Note on the original request... I found out that you don't need any changes from Fabric. You can mount a directory to local.d even with the existing couchdb images, for example:   {code:java} docker run --publish 5984:5984 --name couchdb -e COUCHDB_USER=admin -e COUCHDB_PASSWORD=password -v /local_host_dir/couchdb_data:/opt/couchdb/data -v /local_host_dir/couchdb_config:/opt/couchdb/etc/local.d -d hyperledger/fabric-couchdb {code}       ></body> </Action>
<Action id="58167" issue="35231" author="rhegde" type="comment" created="2019-03-14 23:53:57.0" updateauthor="rhegde" updated="2019-03-14 23:54:57.0"> <body><! CDATA Hello Dave,  If I add the couch database host volume mount, the peer fails to connect to couch database. {code:java} ./mount/config:/opt/couchdb/etc/local.d/{code}  Here is the error from peer {code:java} 2019-03-14 23:40:56.400 UTC  couchdb  VerifyCouchConfig -> DEBU 054 Entering VerifyCouchConfig() 2019-03-14 23:40:56.400 UTC  couchdb  handleRequest -> DEBU 055 Entering handleRequest()  method=GET  url=http://couchdb01xxx.cit.clsnet:5984/ 2019-03-14 23:40:56.400 UTC  couchdb  handleRequest -> DEBU 056 HTTP Request: GET / HTTP/1.1 | Host: couchdb01xxx.cit.clsnet:5984 | User-Agent: Go-http-client/1.1 | Accept: multipart/related | Accept-Encoding: gzip |  | 2019-03-14 23:40:56.401 UTC  couchdb  handleRequest -> WARN 057 Retrying couchdb request in 125ms. Attempt:1  Error:Get http://couchdb01xxx.cit.clsnet:5984/: dial tcp 172.18.0.8:5984: connect: connection refused{code}  Following is added to local.d/log.ini which take effect in couch database log {code:java}  log  level = debug{code}   This takes effect to debug level log. {code:java}  debug  2019-03-14T23:45:58.189672Z nonode@nohost <0.241.0> -------- Fragmentation for database `shards/80000000-9fffffff/public_lscc.1552606171` is 0%, estimated space for compaction is 4240 bytes.  debug  2019-03-14T23:45:58.190897Z nonode@nohost <0.241.0> -------- Fragmentation for database `shards/80000000-9fffffff/public_public.1552606171` is 0%, estimated space for compaction is 8374 bytes.{code}   Execution of CURL on the host port also get's refused. {code:java}  rhegde@dusd1devrhap040 mount $ curl -X GET http://dusd1devrhap040.dev.local:40002/ curl: (7) Failed connect to dusd1devrhap040.dev.local:40002; Connection refused{code}   Here is the docker ps status {code:java}  rhegde@dusd1devrhap040 mount $ docker ps CONTAINER ID        IMAGE                                   COMMAND                  CREATED             STATUS              PORTS                                              NAMES 1fbabf399e9c        ibmblockchain/fabric-couchdb:0.4.10     "tini -- /docker-e..."   11 minutes ago      Up 11 minutes       4369/tcp, 9100/tcp, 0.0.0.0:40002->5984/tcp        {code}  Do I need to add anything in *.ini file as the documentation say only the item added to *.ini gets overridden?  ></body> </Action>
<Action id="58225" issue="35231" author="denyeart" type="comment" created="2019-03-16 07:15:18.0" updateauthor="denyeart" updated="2019-03-16 07:15:31.0"> <body><! CDATA  ~rhegde   If I add an ini file within host directory mounted to local.d, with the following content: {code:java}  log  level = debug{code} it works for me. CouchDB comes up in debug mode and I am able to connect at port 5984 like usual.  Please try to connect at port 5984 and provide your couchdb log.  ></body> </Action>
<Action id="58516" issue="35231" author="rhegde" type="comment" created="2019-03-25 15:21:12.0" updateauthor="rhegde" updated="2019-03-25 15:21:12.0"> <body><! CDATA Hello David - my comment (https://jira.hyperledger.org/browse/FABB-116?focusedCommentId=58167&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-58167) is for v0.4.10 and have not tried this change by merging the same to 0.4.14.  Is your last comment - 16th March also for 0.4.10?  ></body> </Action>
<Action id="58526" issue="35231" author="denyeart" type="comment" created="2019-03-25 19:42:54.0" updateauthor="denyeart" updated="2019-03-25 19:42:54.0"> <body><! CDATA  ~rhegde  You're right - it is not working on 0.4.10.  It is working on later releases, specifically 0.4.14 (October 2018 release) and 0.4.15 (March 2019 release).  I believe you also need FAB-13475 (merged in FABB-115), which is also in 0.4.15.  So I would suggest test with Fabric's CouchDB image 0.4.15 using the -v volume mounting from my prior comment.  ></body> </Action>
