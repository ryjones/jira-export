<Issue id="42125" key="FGJ-43" number="43" project="11000" reporter="yuriiuhlanov" creator="yuriiuhlanov" type="10004" summary="Thread is blocked for 3 seconds times eventing peers during each submit" priority="3" resolution="10203" status="6" created="2019-08-29 16:48:50.0" updated="2020-11-19 15:39:45.0" resolutiondate="2020-11-19 15:39:45.0" votes="1" watches="3" workflowId="55169"> <description><! CDATA  here|https://github.com/hyperledger/fabric-gateway-java/blob/master/src/main/java/org/hyperledger/fabric/gateway/impl/NetworkImpl.java#L180  channel shutdown is called with argument force=false that leads to  the thread being blocked for 3 seconds| https://github.com/hyperledger/fabric-sdk-java/blob/8044bac1bfe9baf9d6360b067e0d6b5445cc953d/src/main/java/org/hyperledger/fabric/sdk/PeerEventServiceClient.java#L142   each time an eventing peer is shut down.     logs: {code:java} 2019-08-29 12:33:29.880 TRACE 15 ---  pool-5-thread-1  org.hyperledger.fabric.sdk.Channel       : Sending block event 'Channel my-channel eventqueue got block event with block number: 3 for channel: my-channel, from Peer{ id: 19, name: peer1-org1, channelName: my-channel, url: grpcs://peer1-org1:7051, mspid: org1MSP}' to block listener BLOCK_LISTENER_HANDLEa5f477f1-0feb-43c6-9921-8d4ed7c3318eBLOCK_LISTENER_HANDLE 2019-08-29 12:33:29.881 TRACE 15 ---  nio-9090-exec-3  o.h.fabric.sdk.ServiceDiscovery          : Service discovery shutdown. 2019-08-29 12:33:29.881 DEBUG 15 ---  nio-9090-exec-3  org.hyperledger.fabric.sdk.Channel       : RemovePeerInternal Peer{ id: 17, name: peer1-org1, channelName: my-channel, url: grpcs://peer1-org1:7051, mspid: org1MSP} from channel Channel{id: 14, name: my-channel} 2019-08-29 12:33:29.881 DEBUG 15 ---  nio-9090-exec-3  org.hyperledger.fabric.sdk.Channel       : Channel my-channel removing mapping peer Peer{ id: 17, name: peer1-org1, channelName: my-channel, url: grpcs://peer1-org1:7051, mspid: org1MSP} to mspid org1MSP 2019-08-29 12:33:29.881 DEBUG 15 ---  nio-9090-exec-3  org.hyperledger.fabric.sdk.Peer          : Peer{ id: 17, name: peer1-org1, channelName: my-channel, url: grpcs://peer1-org1:7051, mspid: org1MSP} unset Channel{id: 14, name: my-channel} 2019-08-29 12:33:29.881 DEBUG 15 ---  nio-9090-exec-3  org.hyperledger.fabric.sdk.Peer          : Peer{ id: 17, name: peer1-org1, channelName: my-channel, url: grpcs://peer1-org1:7051, mspid: org1MSP} is shutting down. 2019-08-29 12:33:29.881 TRACE 15 ---  nio-9090-exec-3  o.hyperledger.fabric.sdk.EndorserClient  : EndorserClient{id: 18, channel: my-channel, name:peer1-org1, url: grpcs://peer1-org1:7051} grpc channel isActive: true, isShutdown: false, isTerminated: false, state: READY  2019-08-29 12:33:29.882 DEBUG 15 ---  nio-9090-exec-3  org.hyperledger.fabric.sdk.Peer          : Peer Peer{ id: 17, name: peer1-org1, channelName: my-channel, url: grpcs://peer1-org1:7051, mspid: org1MSP} removing endorser client EndorserClient{id: 18, channel: my-channel, name:peer1-org1, url: grpcs://peer1-org1:7051}, isActive: true 2019-08-29 12:33:29.882 TRACE 15 ---  nio-9090-exec-3  o.hyperledger.fabric.sdk.EndorserClient  : EndorserClient{id: 18, channel: my-channel, name:peer1-org1, url: grpcs://peer1-org1:7051} shutdown called force: false, shutdown: false, managedChannel: ManagedChannelOrphanWrapper{delegate=ManagedChannelImpl{logId=25, target=peer1-org1:7051}} 2019-08-29 12:33:29.884 DEBUG 15 ---  nio-9090-exec-3  org.hyperledger.fabric.sdk.Peer          : Peer{ id: 17, name: peer1-org1, channelName: my-channel, url: grpcs://peer1-org1:7051, mspid: org1MSP} is shutting down PeerEventServiceClient{id: 23, channel: my-channel, peerName: peer1-org1, url: grpcs://peer1-org1:7051} 2019-08-29 12:33:29.884 DEBUG 15 ---  nio-9090-exec-3  o.h.fabric.sdk.PeerEventServiceClient    : PeerEventServiceClient{id: 23, channel: my-channel, peerName: peer1-org1, url: grpcs://peer1-org1:7051} is shutting down. 2019-08-29 12:33:29.884 DEBUG 15 ---  nio-9090-exec-3  o.h.fabric.sdk.PeerEventServiceClient    : DeliverResponse onCompleted PeerEventServiceClient{id: 23, channel: my-channel, peerName: peer1-org1, url: grpcs://peer1-org1:7051} setting done. 2019-08-29 12:33:32.885 DEBUG 15 ---  nio-9090-exec-3  o.h.fabric.sdk.PeerEventServiceClient    : PeerEventServiceClient{id: 23, channel: my-channel, peerName: peer1-org1, url: grpcs://peer1-org1:7051} is down. 2019-08-29 12:33:32.885 DEBUG 15 ---  nio-9090-exec-3  org.hyperledger.fabric.sdk.Peer          : Peer{ id: 17, name: peer1-org1, channelName: my-channel, url: grpcs://peer1-org1:7051, mspid: org1MSP} is shut down. 2019-08-29 12:33:35.889 DEBUG 15 ---  nio-9090-exec-3  org.hyperledger.fabric.sdk.Orderer       : Shutting down Orderer{id: 15, channelName: my-channel, name:orderer1-org1, url: grpcs://orderer1-org1:7050} 2019-08-29 12:33:35.889 TRACE 15 ---  nio-9090-exec-3  o.hyperledger.fabric.sdk.OrdererClient   : OrdererClient{id: 26, channel: my-channel, name: orderer1-org1, url: grpcs://orderer1-org1:7050} grpc channel isActive: true, isShutdown: false, isTerminated: false, state: READY  2019-08-29 12:33:35.889 DEBUG 15 ---  nio-9090-exec-3  org.hyperledger.fabric.sdk.Orderer       : Channel my-channel removing orderer client Orderer{id: 15, channelName: my-channel, name:orderer1-org1, url: grpcs://orderer1-org1:7050}, isActive: true 2019-08-29 12:33:35.889 TRACE 15 ---  nio-9090-exec-3  o.hyperledger.fabric.sdk.OrdererClient   : OrdererClient{id: 26, channel: my-channel, name: orderer1-org1, url: grpcs://orderer1-org1:7050} shutdown called force: true, shutdown: false, managedChannel: ManagedChannelOrphanWrapper{delegate=ManagedChannelImpl{logId=45, target=orderer1-org1:7050}} 2019-08-29 12:33:35.890 DEBUG 15 ---  nio-9090-exec-3  org.hyperledger.fabric.sdk.Orderer       : Shutting down Orderer{id: 16, channelName: my-channel, name:orderer1-org2, url: grpcs://orderer1-org2:7050} 2019-08-29 12:33:35.890  INFO 15 ---  pool-5-thread-1  org.hyperledger.fabric.sdk.Channel       : Channel my-channel eventThread shutting down. shutdown: true  thread: pool-5-thread-1  {code} you can see a jump from 29 to 32 seconds in the middle. The other peer logs were removed for simplicity, but it added another 3 seconds from 32 to 35.        ></description> </Issue>
