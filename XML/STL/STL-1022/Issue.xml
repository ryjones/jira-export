<Issue id="27092" key="STL-1022" number="1022" project="10001" reporter="adamludvik" assignee="pschwarz" creator="adamludvik" type="10004" summary="Close connection file descriptor leak" priority="1" resolution="10000" status="10001" created="2018-01-25 23:20:34.0" updated="2018-03-09 21:47:56.0" resolutiondate="2018-03-09 21:47:56.0" votes="0" watches="1" workflowId="27094"> <description><! CDATA Following a long series of logging messages from the permission_verifier that a connection was closed due to a missing public key, the validator occasionally logs that it has run out of file descriptors. This is probably related to a file descriptor leak in the code that closes connections or the permission verifier.     Thread-14          permission_verifier No public key found, 4b1915e503b565  80d0c3da6cb45ece42432282edc9e59383d3c2eb97ce2b5a60cc227048ec271becba69d5fd25baf3bddc614b17c2bcf7c1bdcf9b47dbabbb28 is not permitted. Close connection.     Jan 23 08:57:58 ec2-54-237-202-181.compute-1.amazonaws.com  psimlr1-node8     ERROR             ConnectionManager                       gossip Unhandled exception during peer refresh#012Traceback (most recent call last):#012  File "/usr/lib/python3/dist-packages/sawtooth_validator/gossip/gossip.py", line 734, in _get_peers_of_endpoints#012  File "/usr/lib/python3/dist-packages/sawtooth_validator/networking/interconnect.py", line 1053, in get_connection_id_by_endpoint#012KeyError#012#012During handling of the above exception, another exception occurred:#012#012Traceback (most recent call last):#012  File "/usr/lib/python3/dist-packages/sawtooth_validator/gossip/gossip.py", line 460, in run#012  File "/usr/lib/python3/dist-packages/sawtooth_validator/gossip/gossip.py", line 541, in retry_dynamic_peering#012  File "/usr/lib/python3/dist-packages/sawtooth_validator/gossip/gossip.py", line 747, in _get_peers_of_endpoints#012  File "/usr/lib/python3/dist-packages/sawtooth_validator/networking/interconnect.py", line 806, in add_outbound_connection#012  File "/usr/lib/python3/dist-packages/sawtooth_validator/networking/interconnect.py", line 1331, in start#012  File "/usr/lib/python3.5/threading.py", line 914, in _bootstrap_inner#012  File "/usr/lib/python3.5/threading.py", line 862, in run#012  File "/usr/lib/python3/dist-packages/sawtooth_validator/networking/interconnect.py", line 471, in setup#012  File "/usr/lib/python3/dist-packages/zmq/asyncio.py", line 310, in __init__#012  File "/usr/lib/python3.5/asyncio/unix_events.py", line 49, in __init__#012  File "/usr/lib/python3.5/asyncio/selector_events.py", line 55, in __init__#012  File "/usr/lib/python3.5/asyncio/selector_events.py", line 116, in _make_self_pipe#012  File "/usr/lib/python3.5/asyncio/unix_events.py", line 53, in _socketpair#012  File "/usr/lib/python3.5/socket.py", line 478, in socketpair#012OSError:  Errno 24  Too many open files  ></description> </Issue>
