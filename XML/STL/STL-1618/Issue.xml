<Issue id="40602" key="STL-1618" number="1618" project="10001" reporter="andrew-scantrust" assignee="mfford" creator="andrew-scantrust" type="10004" summary="AWS Marketplace image can&apos;t process transactions" priority="3" status="10100" created="2019-06-17 03:37:11.0" updated="2019-06-17 03:37:11.0" votes="0" watches="1" workflowId="53552"> <environment><! CDATA AWS Marketplace 1.1.4 AMI  ></environment> <description><! CDATA A default, out of the box AWS marketplace based sawtooth instance (v1.1.4) is unable to process transactions.  I have repeated this process on 3 separate nodes, with the same results.   It is possible to fix this by opening up the sawtooth ports to the local subnet and rebooting the box. * NO configuration has been created or modified (in /etc/sawtooth) * Using ami-092d2d11e82fbf971 in ap-northeast-2 * launch new instance, allowing only ssh  {code:java} ssh ubuntu@public-ip sawtooth transaction list # shows 1 transaction sudo -H -u sawtooth intket set mykey 100 sawtooth transaction list # shows 1 transaction curl http://127.0.0.1:8008/batch_statuses?id=... > "pending" {code} After opening 4004/5050/8800/8008 and rebooting, *transactions are processed*.  However, the transactions submitted previously are gone (they were always in pending, I'm guessing that is why)  !image-2019-06-17-11-07-25-793.png!   In related news, after rebooting I have errors like this in the logs which make it feel like the unit files don't depend on each other properly and shutdown out of order.   {code} # cat rest_api-error.log  02:49:46.385  MainThread  base_events ERROR  Task was destroyed but it is pending! task: <Task pending coro=<StateDeltaSubscriberHandler._handle_disconnect() running at /usr/lib/python3/dist-packages/sawtooth_rest_api/state_delta_subscription_handler.py:175>>  # cast validator-error.log  02:54:31.835  MainThread  (unknown file) ERROR  error executing main Traceback (most recent call last): File "/usr/lib/python3/dist-packages/sawtooth_validator/server/cli.py", line 290, in main validator.stop() File "/usr/lib/python3/dist-packages/sawtooth_validator/server/core.py", line 489, in stop if not t.is_alive(): File "/usr/lib/python3.5/threading.py", line 1113, in is_alive self._wait_for_tstate_lock(False) File "/usr/lib/python3.5/threading.py", line 1069, in _wait_for_tstate_lock assert self._is_stopped AssertionError {code} h2. Upgrading to v1.1.5  Attempting to upgrade the base 1.1.4 image to 1.1.5 goes smoothly from the package side.  However, I haven't found any way to get any transactions to process on it.   There are no errors in the validator/rest-api logs (except for the same error it shows on reboot).  !image-2019-06-17-11-28-47-204.png!  ></description> </Issue>
