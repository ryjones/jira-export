<Issue id="26737" key="STL-989" number="989" project="10001" reporter="askmish" assignee="achenette" creator="askmish" type="10004" summary="lmdb.ReadonlyError when running sawtooth-validator as a service" priority="3" resolution="10000" status="10001" created="2018-01-11 09:50:31.0" updated="2018-01-23 17:21:52.0" resolutiondate="2018-01-23 17:21:52.0" votes="0" watches="3" workflowId="26737"> <environment><! CDATA example@example-desktop:~$ sawtooth --version sawtooth-cli (Hyperledger Sawtooth) version 1.0.0rc7.dev20 example@example-desktop:~$ uname -a Linux example-desktop 4.10.0-28-generic #32~16.04.2-Ubuntu SMP Thu Jul 20 10:19:48 UTC 2017 x86_64 x86_64 x86_64 GNU/Linux example@example-desktop:~$  ></environment> <description><! CDATA example@example-desktop:/etc/sawtooth$ sudo systemctl status sawtooth-validator ● sawtooth-validator.service - Sawtooth Validator Server Loaded: loaded (/lib/systemd/system/sawtooth-validator.service; disabled; vendor preset: enabled) Active: inactive (dead) example@example-desktop:/etc/sawtooth$ sudo systemctl start sawtooth-validator example@example-desktop:/etc/sawtooth$ sudo systemctl status sawtooth-validator ● sawtooth-validator.service - Sawtooth Validator Server Loaded: loaded (/lib/systemd/system/sawtooth-validator.service; disabled; vendor preset: enabled) Active: active (running) since Thu 2018-01-11 10:53:05 IST; 1s ago Main PID: 15932 (sawtooth-valida) CGroup: /system.slice/sawtooth-validator.service └─15932 /usr/bin/python3 /usr/bin/sawtooth-validator  Jan 11 10:53:05 example-desktop systemd 1 : Started Sawtooth Validator Server. Jan 11 10:53:05 example-desktop sawtooth-validator 15932 :  2018-01-11 10:53:05.368 WARNING  validator  /etc/sawtooth/policy/policy.example does not exist. transactor.transaction_signer will not be set. Jan 11 10:53:05 example-desktop sawtooth-validator 15932 :  2018-01-11 10:53:05.368 WARNING  validator  /etc/sawtooth/policy/policy.example does not exist. transactor will not be set. example@example-desktop:/etc/sawtooth$ sudo systemctl start sawtooth-rest-api example@example-desktop:/etc/sawtooth$ sudo systemctl status sawtooth-rest-api ● sawtooth-rest-api.service - Sawtooth REST API Loaded: loaded (/lib/systemd/system/sawtooth-rest-api.service; disabled; vendor preset: enabled) Active: active (running) since Thu 2018-01-11 10:53:16 IST; 3s ago Main PID: 15989 (sawtooth-rest-a) CGroup: /system.slice/sawtooth-rest-api.service └─15989 /usr/bin/python3 /usr/bin/sawtooth-rest-api  Jan 11 10:53:16 example-desktop systemd 1 : Started Sawtooth REST API. example@example-desktop:/etc/sawtooth$  example@example-desktop:/etc/sawtooth$  example@example-desktop:/etc/sawtooth$ sudo systemctl start sawtooth-intkey-tp-python example@example-desktop:/etc/sawtooth$ sudo systemctl status sawtooth-intkey-tp-python ● sawtooth-intkey-tp-python.service - Sawtooth Intkey TP Python Loaded: loaded (/lib/systemd/system/sawtooth-intkey-tp-python.service; disabled; vendor preset: enabled) Active: active (running) since Thu 2018-01-11 10:53:29 IST; 3s ago Main PID: 16025 (intkey-tp-pytho) CGroup: /system.slice/sawtooth-intkey-tp-python.service └─16025 /usr/bin/python3 /usr/bin/intkey-tp-python -C tcp://localhost:4004  Jan 11 10:53:29 example-desktop systemd 1 : Started Sawtooth Intkey TP Python. example@example-desktop:/etc/sawtooth$ sudo systemctl start sawtooth-poet-validator-registry-tp example@example-desktop:/etc/sawtooth$ sudo systemctl status sawtooth-poet-validator-registry-tp ● sawtooth-poet-validator-registry-tp.service - Sawtooth PoET TP Validator Registry Loaded: loaded (/lib/systemd/system/sawtooth-poet-validator-registry-tp.service; disabled; vendor preset: enabled) Active: active (running) since Thu 2018-01-11 10:53:41 IST; 4s ago Main PID: 16059 (poet-validator-) CGroup: /system.slice/sawtooth-poet-validator-registry-tp.service └─16059 /usr/bin/python3 /usr/bin/poet-validator-registry-tp -C tcp://localhost:4004  Jan 11 10:53:41 example-desktop systemd 1 : Started Sawtooth PoET TP Validator Registry. example@example-desktop:/etc/sawtooth$ sudo systemctl start sawtooth-settings-tp example@example-desktop:/etc/sawtooth$ sudo systemctl status sawtooth-settings-tp ● sawtooth-settings-tp.service - Sawtooth TP Settings Loaded: loaded (/lib/systemd/system/sawtooth-settings-tp.service; disabled; vendor preset: enabled) Active: active (running) since Thu 2018-01-11 10:53:57 IST; 3s ago Main PID: 16093 (settings-tp) CGroup: /system.slice/sawtooth-settings-tp.service └─16093 /usr/bin/python3 /usr/bin/settings-tp -C tcp://localhost:4004  Jan 11 10:53:57 example-desktop systemd 1 : Started Sawtooth TP Settings. example@example-desktop:/etc/sawtooth$  example@example-desktop:/etc/sawtooth$  example@example-desktop:/etc/sawtooth$ sudo systemctl status sawtooth-validator ● sawtooth-validator.service - Sawtooth Validator Server Loaded: loaded (/lib/systemd/system/sawtooth-validator.service; disabled; vendor preset: enabled) Active: active (running) since Thu 2018-01-11 10:53:05 IST; 1min 21s ago Main PID: 15932 (sawtooth-valida) CGroup: /system.slice/sawtooth-validator.service └─15932 /usr/bin/python3 /usr/bin/sawtooth-validator  Jan 11 10:53:58 example-desktop sawtooth-validator 15932 :     self._build_candidate_block(chain_head) Jan 11 10:53:58 example-desktop sawtooth-validator 15932 :   File "/usr/lib/python3/dist-packages/sawtooth_validator/journal/publisher.py", line 562, in _build_candidate_block Jan 11 10:53:58 example-desktop sawtooth-validator 15932 :     validator_id=public_key) Jan 11 10:53:58 example-desktop sawtooth-validator 15932 :   File "/usr/lib/python3/dist-packages/sawtooth_poet/poet_consensus/poet_block_publisher.py", line 115, in __init__ Jan 11 10:53:58 example-desktop sawtooth-validator 15932 :     validator_id=self._validator_id) Jan 11 10:53:58 example-desktop sawtooth-validator 15932 :   File "/usr/lib/python3/dist-packages/sawtooth_poet/poet_consensus/poet_key_state_store.py", line 113, in __init__ Jan 11 10:53:58 example-desktop sawtooth-validator 15932 :     flag='c') Jan 11 10:53:58 example-desktop sawtooth-validator 15932 :   File "/usr/lib/python3/dist-packages/sawtooth_validator/database/lmdb_nolock_database.py", line 57, in __init__ Jan 11 10:53:58 example-desktop sawtooth-validator 15932 :     lock=True) Jan 11 10:53:58 example-desktop sawtooth-validator 15932 : lmdb.ReadonlyError: /var/lib/sawtooth/poet-key-state-0395e5ec.lmdb: Permission denied  root@example-desktop:/var/log/sawtooth# cd /var/lib/sawtooth/ root@example-desktop:/var/lib/sawtooth# ls -al total 220 drwxr-x---  2 sawtooth sawtooth          4096 Jan 11 12:19 . drwxr-xr-x 68 root     root              4096 Jan 10 15:38 .. -rw-r--r--  1 sawtooth sawtooth 1099511627776 Jan 11 12:19 block-00.lmdb -rw-r--r--  1 sawtooth sawtooth          8192 Jan 11 12:19 block-00.lmdb-lock -rw-r--r--  1 sawtooth sawtooth           128 Jan 11 10:53 block-chain-id -rw-r--r--  1 sawtooth sawtooth 1099511627776 Jan 11 12:19 merkle-00.lmdb -rw-r--r--  1 sawtooth sawtooth          8192 Jan 11 12:19 merkle-00.lmdb-lock -rw-r--r--  1 sawtooth sawtooth 1099511627776 Jan 11 12:19 poet_consensus_state-0395e5ec.lmdb -rw-r--r--  1 sawtooth sawtooth          8192 Jan 11 12:19 poet_consensus_state-0395e5ec.lmdb-lock -rw-r--r--  1 sawtooth sawtooth          8192 Jan 11 10:53 poet_consensus_state-0395e5ec.lmdb-lock-backup -rw-r--r--  1 root     root     1099511627776 Jan 10 18:01 poet-key-state-0395e5ec.lmdb -rw-r--r--  1 root     root              8192 Jan 10 18:01 poet-key-state-0395e5ec.lmdb-lock -rw-r--r--  1 sawtooth sawtooth 1099511627776 Jan 11 12:19 txn_receipts-00.lmdb -rw-r--r--  1 sawtooth sawtooth          8192 Jan 11 12:19 txn_receipts-00.lmdb-lock  Suspected problem area: poet-key-state-0395e5ec.lmdb file has inaccurate perms.  -rw-r--r--  1 root     root     1099511627776 Jan 10 18:01 poet-key-state-0395e5ec.lmdb -rw-r--r--  1 root     root              8192 Jan 10 18:01 poet-key-state-0395e5ec.lmdb-lock  Workaround: root@example-desktop:/etc/sawtooth# chown sawtooth:sawtooth /var/lib/sawtooth/poet-key-state-0395e5ec.lmdb root@example-desktop:/etc/sawtooth# ls -al /var/lib/sawtooth/ total 220 drwxr-x---  2 sawtooth sawtooth          4096 Jan 11 12:21 . drwxr-xr-x 68 root     root              4096 Jan 10 15:38 .. -rw-r--r--  1 sawtooth sawtooth 1099511627776 Jan 11 12:21 block-00.lmdb -rw-r--r--  1 sawtooth sawtooth          8192 Jan 11 12:21 block-00.lmdb-lock -rw-r--r--  1 sawtooth sawtooth           128 Jan 11 10:53 block-chain-id -rw-r--r--  1 sawtooth sawtooth 1099511627776 Jan 11 12:21 merkle-00.lmdb -rw-r--r--  1 sawtooth sawtooth          8192 Jan 11 12:21 merkle-00.lmdb-lock -rw-r--r--  1 sawtooth sawtooth 1099511627776 Jan 11 12:21 poet_consensus_state-0395e5ec.lmdb -rw-r--r--  1 sawtooth sawtooth          8192 Jan 11 12:21 poet_consensus_state-0395e5ec.lmdb-lock -rw-r--r--  1 sawtooth sawtooth          8192 Jan 11 10:53 poet_consensus_state-0395e5ec.lmdb-lock-backup -rw-r--r--  1 sawtooth sawtooth 1099511627776 Jan 10 18:01 poet-key-state-0395e5ec.lmdb -rw-r--r--  1 sawtooth sawtooth          8192 Jan 11 12:21 poet-key-state-0395e5ec.lmdb-lock -rw-r--r--  1 sawtooth sawtooth 1099511627776 Jan 11 12:21 txn_receipts-00.lmdb -rw-r--r--  1 sawtooth sawtooth          8192 Jan 11 12:21 txn_receipts-00.lmdb-lock  example@example-desktop:/etc/sawtooth$ sudo systemctl restart sawtooth-validator example@example-desktop:/etc/sawtooth$ sudo systemctl status sawtooth-validator ● sawtooth-validator.service - Sawtooth Validator Server Loaded: loaded (/lib/systemd/system/sawtooth-validator.service; disabled; vendor preset: enabled) Active: active (running) since Thu 2018-01-11 12:23:56 IST; 2s ago Main PID: 17696 (sawtooth-valida) CGroup: /system.slice/sawtooth-validator.service └─17696 /usr/bin/python3 /usr/bin/sawtooth-validator  Jan 11 12:23:56 example-desktop systemd 1 : Started Sawtooth Validator Server. Jan 11 12:23:57 example-desktop sawtooth-validator 17696 :  2018-01-11 12:23:57.162 WARNING  validator  /etc/sawtooth/policy/policy.example does not exist. transactor.transaction_signer will not be set. Jan 11 12:23:57 example-desktop sawtooth-validator 17696 :  2018-01-11 12:23:57.162 WARNING  validator  /etc/sawtooth/policy/policy.example does not exist. transactor will not be set.  ></description> </Issue>
