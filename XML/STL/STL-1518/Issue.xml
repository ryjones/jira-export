<Issue id="39341" key="STL-1518" number="1518" project="10001" reporter="awbacker" assignee="amundson" creator="awbacker" type="10004" summary="Validator Panic after TxP removed from network" priority="3" status="10100" created="2019-04-16 06:01:17.0" updated="2019-05-21 14:33:52.0" votes="0" watches="1" workflowId="52220"> <description><! CDATA I have some buggy code in my TxP which is crashing.  This isn't unexpected right now, its new, but it could happen at any time.  I notice that this seems to somehow crash the Validator as well though.    {{My TxP crash:}}  {{myapp.txp                     |  2019-04-05 11:48:40 +0000   1   ERROR  Processor Error}} {{myapp.txp                     | Traceback (most recent call last):}} {{myapp.txp                     |   File "/app/processor.py", line 36, in main}} {{myapp.txp                     |     processor.start()}} {{myapp.txp                     |   File "/usr/local/lib/python3.6/site-packages/sawtooth_sdk/processor/core.py", line 265, in start}} {{myapp.txp                     |     self._process_future(fut)}} {{myapp.txp                     |   File "/usr/local/lib/python3.6/site-packages/sawtooth_sdk/processor/core.py", line 216, in _process_future}} {{myapp.txp                     |     self._process(msg)}} {{myapp.txp                     |   File "/usr/local/lib/python3.6/site-packages/sawtooth_sdk/processor/core.py", line 130, in _process}} {{myapp.txp                     |     handler.apply(request, state)}} {{myapp.txp                     |   File "/app/handler.py", line 119, in apply}} {{myapp.txp                     |     MyAppEventHandler(transaction, context).process()}} {{myapp.txp                     |   File "/app/handler.py", line 60, in process}} {{myapp.txp                     |      logger.info|http://logger.info/ ("Writing Event Record data_event:%s", data 'id' )  # oops, data was a string}} {{myapp.txp                     | TypeError: string indices must be integers}} {{sawtooth.settings             |  2019-04-05 11:48:40.255 DEBUG    core  received message of type: PING_REQUEST}} {{myapp.txp exited with code 0}}   At this point it seems I can get the sawtooth validator to crash:   {{sawtooth.validator            |  2019-04-05 11:48:50.260 WARNING  executor  0cf3ba26ab14f6649f55a59141c84aad71eca2e230412b37b61b13e55d2aa6b227840250c1f0118d480907f0bd0679f6e4c64843e8f3dd7d851657745d4227d2 did not respond to the Ping, removing transaction processor.}} {{sawtooth.validator            |  2019-04-05 11:48:50.261 ERROR    executor  Unhandled exception while checking connections}} {{sawtooth.validator            | Traceback (most recent call last):}} {{sawtooth.validator            |   File "/usr/lib/python3/dist-packages/sawtooth_validator/execution/executor.py", line 469, in _check_connections}} {{sawtooth.validator            |     fut.result(timeout=10)}} {{sawtooth.validator            |   File "/usr/lib/python3/dist-packages/sawtooth_validator/networking/future.py", line 59, in result}} {{sawtooth.validator            |     raise FutureTimeoutError('Future timed out')}} {{sawtooth.validator            | sawtooth_validator.networking.future.FutureTimeoutError: Future timed out}} {{sawtooth.validator            |}} {{sawtooth.validator            | During handling of the above exception, another exception occurred:}} {{sawtooth.validator            |}} {{sawtooth.validator            | Traceback (most recent call last):}} {{sawtooth.validator            |   File "/usr/lib/python3/dist-packages/sawtooth_validator/execution/executor.py", line 474, in _check_connections}} {{sawtooth.validator            |     self._remove_broken_connection(futures fut )}} {{sawtooth.validator            |   File "/usr/lib/python3/dist-packages/sawtooth_validator/execution/executor.py", line 480, in _remove_broken_connection}} {{sawtooth.validator            |     t.remove_broken_connection(connection_id)}} {{sawtooth.validator            |   File "/usr/lib/python3/dist-packages/sawtooth_validator/execution/executor.py", line 371, in remove_broken_connection}} {{sawtooth.validator            |     self._future_done_callback(fut.request, result)}} {{sawtooth.validator            |   File "/usr/lib/python3/dist-packages/sawtooth_validator/execution/executor.py", line 113, in _future_done_callback}} {{sawtooth.validator            |     self._processor_manager processor_type .get_processor(}} {{sawtooth.validator            |   File "/usr/lib/python3/dist-packages/sawtooth_validator/execution/processor_manager.py", line 53, in __getitem__}} {{sawtooth.validator            |     return self._processors item }} {{sawtooth.validator            | KeyError: myapp: 1.0}}  ></description> </Issue>
