<Issue id="27088" key="STL-1019" number="1019" project="10001" reporter="adamludvik" assignee="drozd" creator="adamludvik" type="10004" summary="Expected attributes missing from objects" priority="3" resolution="10000" status="10001" created="2018-01-25 21:18:52.0" updated="2019-04-22 12:57:15.0" resolutiondate="2019-04-22 12:57:15.0" votes="0" watches="2" workflowId="27090"> <description><! CDATA Occasionally exceptions occur which seem to indicate that an object which normal has an attribute no longer has an attribute. One theory is that there is some sort of stack corruption or data race occurring. The issue seems to occur more frequently when the validator is under load, however there is currently no known way to consistently reproduce the same error.     Jan  4 02:51:53 ec2-184-72-89-73.compute-1.amazonaws.com  psimlr1-node1     ERROR                     Thread-26                   threadpool (Component) Unhandled exception during execution of task TpStat  eGetHandler.handle#012Traceback (most recent call last):#012  File "/usr/lib/python3/dist-packages/sawtooth_validator/concurrent/threadpool.py", line 85, in wrapper#012    return_value = fn(*args, **kwargs)#012  File "/usr/lib/python3/dist-packages/sawtooth_validator/execution/tp_state_handlers.py", line 36, in handle#012    get_request.context_id, list(get_request.addresses))#012  File "/usr/lib/python3/dist-packages/sawtooth_validator/execution/context_manager.py", line 295, in get#012    values = context.get(addresses_in_ctx)#012  File "/usr/lib/python3/dist-packages/sawtooth_validator/execution/execution_context.py", line 142, in get#012    results.append(self._get(add))#012  File "/usr/lib/python3/dist-packages/sawtooth_validator/execution/execution_context.py", line 95, in _get#012    value = self._state address .result()#012  File "/usr/lib/python3/dist-packages/sawtooth_validator/execution/execution_context.py", line 453, in result#012    self._condition.wait_for(#012AttributeError: 'TimerContext' object has no attribute 'wait_for'     root@psimlr1-node8:/var/log/sawtooth# cat psimlr1-node8-validator-error.log   2018-01-17 19:06:50.110  Thread-48  threadpool ERROR  (Component) Unhandled exception during execution of task TpStateGetHandler.handle  Traceback (most recent call last):   File "/usr/lib/python3/dist-packages/sawtooth_validator/concurrent/threadpool.py", line 85, in wrapper     return_value = fn(*args, **kwargs)   File "/usr/lib/python3/dist-packages/sawtooth_validator/execution/tp_state_handlers.py", line 36, in handle     get_request.context_id, list(get_request.addresses))   File "/usr/lib/python3/dist-packages/sawtooth_validator/execution/context_manager.py", line 295, in get     values = context.get(addresses_in_ctx)   File "/usr/lib/python3/dist-packages/sawtooth_validator/execution/execution_context.py", line 142, in get     results.append(self._get(add))   File "/usr/lib/python3/dist-packages/sawtooth_validator/execution/execution_context.py", line 95, in _get     value = self._state address .result()  AttributeError: 'PredecessorTreeNode' object has no attribute 'result'     From a local run of poet liveness:     validator-2_1                   |  2018-01-04 22:05:58.049 ERROR    threadpool  (Component) Unhandled exception during execution of task TpStateGetHandler.handle  validator-2_1                   | Traceback (most recent call last):  validator-2_1                   |   File "/project/sawtooth-core/validator/sawtooth_validator/concurrent/threadpool.py", line 84, in wrapper  validator-2_1                   |     return_value = fn(*args, **kwargs)  validator-2_1                   |   File "/project/sawtooth-core/validator/sawtooth_validator/execution/tp_state_handlers.py", line 36, in handle  validator-2_1                   |     get_request.context_id, list(get_request.addresses))  validator-2_1                   |   File "/project/sawtooth-core/validator/sawtooth_validator/execution/context_manager.py", line 295, in get  validator-2_1                   |     values = context.get(addresses_in_ctx)  validator-2_1                   |   File "/project/sawtooth-core/validator/sawtooth_validator/execution/execution_context.py", line 142, in get  validator-2_1                   |     results.append(self._get(add))  validator-2_1                   |   File "/project/sawtooth-core/validator/sawtooth_validator/execution/execution_context.py", line 95, in _get  validator-2_1                   |     value = self._state address .result()  validator-2_1                   | AttributeError: 'ExecutionContext' object has no attribute 'result'      These are stack traces that might be related to the problem, but might also be unrelated. These are also from local poet liveness runs.     validator-4_1                   |  2018-01-04 17:47:36.272 ERROR    base_events  Exception in callback run_coroutine_threadsafe.<locals>.callback() at /usr/lib/python3.5/asyncio/tasks.py:729  validator-4_1                   | handle: <Handle run_coroutine_threadsafe.<locals>.callback() at /usr/lib/python3.5/asyncio/tasks.py:729>  validator-4_1                   | Traceback (most recent call last):  validator-4_1                   |   File "/usr/lib/python3.5/asyncio/tasks.py", line 731, in callback  validator-4_1                   |     futures._chain_future(ensure_future(coro, loop=loop), future)  validator-4_1                   |   File "/usr/lib/python3.5/asyncio/futures.py", line 421, in _chain_future  validator-4_1                   |     raise TypeError('A future is required for destination argument')  validator-4_1                   | TypeError: A future is required for destination argument  validator-4_1                   |   validator-4_1                   | During handling of the above exception, another exception occurred:  validator-4_1                   |   validator-4_1                   | Traceback (most recent call last):  validator-4_1                   |   File "/usr/lib/python3.5/asyncio/events.py", line 125, in _run  validator-4_1                   |     self._callback(*self._args)  validator-4_1                   |   File "/usr/lib/python3.5/asyncio/tasks.py", line 733, in callback  validator-4_1                   |     if future.set_running_or_notify_cancel():  validator-4_1                   | AttributeError: 'list_iterator' object has no attribute 'set_running_or_notify_cancel'      validator-4_1                   |  2018-01-04 18:34:51.762 ERROR    dispatch  Unhandled exception while determining next  validator-4_1                   | Traceback (most recent call last):  validator-4_1                   |   File "/project/sawtooth-core/validator/sawtooth_validator/networking/dispatch.py", line 188, in do_next  validator-4_1                   |     self._determine_next(message_id, future)  validator-4_1                   |   File "/project/sawtooth-core/validator/sawtooth_validator/networking/dispatch.py", line 214, in _determine_next  validator-4_1                   |     self._process(message_id)  validator-4_1                   |   File "/project/sawtooth-core/validator/sawtooth_validator/networking/dispatch.py", line 179, in _process  validator-4_1                   |     handler_manager = next(collection)  validator-4_1                   | TypeError: 'Condition' object is not an iterator  ></description> </Issue>
