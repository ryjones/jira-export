<Issue id="16324" key="STL-88" number="88" project="10001" reporter="amundson" assignee="jsmitchell" creator="amundson" type="10004" summary="&quot;ZMQError: Address already in use&quot; results in unfriendly traceback" priority="3" resolution="10000" status="10001" created="2017-05-04 14:15:36.0" updated="2017-06-09 21:25:46.0" resolutiondate="2017-06-09 21:25:46.0" votes="0" watches="1" workflowId="16324"> <description><! CDATA It is possible to get an "Address already in use" error when the validator shuts down unclean and is restarted quickly.  The current error handling results in an unfriendly traceback being printed.  {noformat} ubuntu@ubuntu-xenial:/project/sawtooth-core$ ./bin/validator -vv --public-uri tcp://localhost:8800/  14:12:33.190 INFO     path  Skipping path loading from non-existent config file: /home/ubuntu/sawtooth/etc/path.toml  14:12:33.190 INFO     keys  Loading signing key: /home/ubuntu/sawtooth/keys/validator.priv  14:12:33.191 INFO     cli  config  path : config_dir = "/home/ubuntu/sawtooth/etc"  14:12:33.192 INFO     cli  config  path : key_dir = "/home/ubuntu/sawtooth/keys"  14:12:33.192 INFO     cli  config  path : data_dir = "/home/ubuntu/sawtooth/data"  14:12:33.192 INFO     cli  config  path : log_dir = "/home/ubuntu/sawtooth/logs"  14:12:33.193 DEBUG    core  database file is /home/ubuntu/sawtooth/data/merkle-00.lmdb  14:12:33.193 DEBUG    core  state delta store file is /home/ubuntu/sawtooth/data/state-deltas-00.lmdb  14:12:33.194 DEBUG    core  block store file is /home/ubuntu/sawtooth/data/block-00.lmdb  14:12:33.197 DEBUG    selector_events  Using selector: ZMQSelector Exception in thread InterconnectThread-5: Traceback (most recent call last): File "/usr/lib/python3.5/threading.py", line 914, in _bootstrap_inner self.run() File "/usr/lib/python3.5/threading.py", line 862, in run self._target(*self._args, **self._kwargs) File "/project/sawtooth-core/validator/sawtooth_validator/networking/interconnect.py", line 348, in setup self._socket.bind(self._address) File "zmq/backend/cython/socket.pyx", line 487, in zmq.backend.cython.socket.Socket.bind (zmq/backend/cython/socket.c:5156) File "zmq/backend/cython/checkrc.pxd", line 25, in zmq.backend.cython.checkrc._check_rc (zmq/backend/cython/socket.c:7535) zmq.error.ZMQError: Address already in use   14:12:33.198 ERROR    cli  Address already in use Traceback (most recent call last): File "/project/sawtooth-core/validator/sawtooth_validator/server/cli.py", line 214, in main validator.start() File "/project/sawtooth-core/validator/sawtooth_validator/server/core.py", line 458, in start self._service.start() File "/project/sawtooth-core/validator/sawtooth_validator/networking/interconnect.py", line 597, in start raise err File "/usr/lib/python3.5/threading.py", line 914, in _bootstrap_inner self.run() File "/usr/lib/python3.5/threading.py", line 862, in run self._target(*self._args, **self._kwargs) File "/project/sawtooth-core/validator/sawtooth_validator/networking/interconnect.py", line 348, in setup self._socket.bind(self._address) File "zmq/backend/cython/socket.pyx", line 487, in zmq.backend.cython.socket.Socket.bind (zmq/backend/cython/socket.c:5156) File "zmq/backend/cython/checkrc.pxd", line 25, in zmq.backend.cython.checkrc._check_rc (zmq/backend/cython/socket.c:7535) zmq.error.ZMQError: Address already in use  14:12:33.205 DEBUG    dispatch  Attempted to remove send_message function for connection ServerThread, but no send_message function was registered  14:12:33.205 DEBUG    dispatch  Attempted to remove send_message function for connection ServerThread, but no send_message function was registered  14:12:33.206 INFO     core  remaining threads: Thread-1 (_ContextReader), Thread-2 (_ContextWriter), Thread-3 (Dispatcher)  14:12:35.209 INFO     core  All threads have been stopped and joined {noformat}  This error should be cleaned up so we aren't showing a traceback.  Could we avoid this error experience by retrying the ZMQ in a loop for a (short) duration of time?  ></description> </Issue>
