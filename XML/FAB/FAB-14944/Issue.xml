<Issue id="38932" key="FAB-14944" number="14944" project="10002" reporter="sykesm" assignee="yacovm" creator="sykesm" type="10004" summary="Data race in orderer/common/cluster_test TestSend" priority="3" resolution="10000" status="6" created="2019-04-02 00:44:23.0" updated="2019-04-07 14:12:25.0" resolutiondate="2019-04-07 14:12:25.0" votes="0" watches="2" workflowId="51790"> <description><! CDATA https://jenkins.hyperledger.org/job/fabric-verify-unit-tests-x86_64/11211/consoleFull  {code} 22:24:36 ================== 22:24:36 WARNING: DATA RACE 22:24:36 Write at 0x00c0002d6d68 by goroutine 90: 22:24:36   sync/atomic.CompareAndSwapInt32() 22:24:36       /opt/go/go1.11.5.linux.amd64/src/runtime/race_amd64.s:293 +0xb 22:24:36   sync.(*Mutex).Lock() 22:24:36       /opt/go/go1.11.5.linux.amd64/src/sync/mutex.go:74 +0x4d 22:24:36   github.com/hyperledger/fabric/vendor/github.com/stretchr/testify/mock.(*Mock).MethodCalled() 22:24:36       /w/workspace/fabric-verify-unit-tests-x86_64/gopath/src/github.com/hyperledger/fabric/vendor/github.com/stretchr/testify/mock/mock.go:394 +0x4e3 22:24:36   github.com/hyperledger/fabric/vendor/github.com/stretchr/testify/mock.(*Mock).Called() 22:24:36       /w/workspace/fabric-verify-unit-tests-x86_64/gopath/src/github.com/hyperledger/fabric/vendor/github.com/stretchr/testify/mock/mock.go:333 +0x18c 22:24:36   github.com/hyperledger/fabric/orderer/common/cluster/mocks.(*StepClient).Send() 22:24:36       /w/workspace/fabric-verify-unit-tests-x86_64/gopath/src/github.com/hyperledger/fabric/orderer/common/cluster/mocks/step_client.go:107 +0xa0 22:24:36   github.com/hyperledger/fabric/orderer/common/cluster.(*Stream).sendMessage.func2() 22:24:36       /w/workspace/fabric-verify-unit-tests-x86_64/gopath/src/github.com/hyperledger/fabric/orderer/common/cluster/comm.go:545 +0x157 22:24:36   github.com/hyperledger/fabric/orderer/common/cluster.(*Stream).operateWithTimeout.func1() 22:24:36       /w/workspace/fabric-verify-unit-tests-x86_64/gopath/src/github.com/hyperledger/fabric/orderer/common/cluster/comm.go:600 +0x76 22:24:36  22:24:36 Previous write at 0x00c0002d6d68 by goroutine 155: 22:24:36   github.com/hyperledger/fabric/orderer/common/cluster_test.TestSend.func1() 22:24:36       /w/workspace/fabric-verify-unit-tests-x86_64/gopath/src/github.com/hyperledger/fabric/orderer/common/cluster/rpc_test.go:128 +0x9b 22:24:36   github.com/hyperledger/fabric/orderer/common/cluster_test.TestSend.func4() 22:24:36       /w/workspace/fabric-verify-unit-tests-x86_64/gopath/src/github.com/hyperledger/fabric/orderer/common/cluster/rpc_test.go:255 +0xc46 22:24:36   testing.tRunner() 22:24:36       /opt/go/go1.11.5.linux.amd64/src/testing/testing.go:827 +0x162 22:24:36  22:24:36 Goroutine 90 (running) created at: 22:24:36   github.com/hyperledger/fabric/orderer/common/cluster.(*Stream).operateWithTimeout() 22:24:36       /w/workspace/fabric-verify-unit-tests-x86_64/gopath/src/github.com/hyperledger/fabric/orderer/common/cluster/comm.go:598 +0x17a 22:24:36   github.com/hyperledger/fabric/orderer/common/cluster.(*Stream).sendMessage() 22:24:36       /w/workspace/fabric-verify-unit-tests-x86_64/gopath/src/github.com/hyperledger/fabric/orderer/common/cluster/comm.go:550 +0x184 22:24:36   github.com/hyperledger/fabric/orderer/common/cluster.(*Stream).serviceStream() 22:24:36       /w/workspace/fabric-verify-unit-tests-x86_64/gopath/src/github.com/hyperledger/fabric/orderer/common/cluster/comm.go:559 +0x10a 22:24:36   github.com/hyperledger/fabric/orderer/common/cluster.(*RemoteContext).NewStream.func4() 22:24:36       /w/workspace/fabric-verify-unit-tests-x86_64/gopath/src/github.com/hyperledger/fabric/orderer/common/cluster/comm.go:715 +0x9b 22:24:36  22:24:36 Goroutine 155 (finished) created at: 22:24:36   testing.(*T).Run() 22:24:36       /opt/go/go1.11.5.linux.amd64/src/testing/testing.go:878 +0x659 22:24:36   github.com/hyperledger/fabric/orderer/common/cluster_test.TestSend() 22:24:36       /w/workspace/fabric-verify-unit-tests-x86_64/gopath/src/github.com/hyperledger/fabric/orderer/common/cluster/rpc_test.go:198 +0x1148 22:24:36   testing.tRunner() 22:24:36       /opt/go/go1.11.5.linux.amd64/src/testing/testing.go:827 +0x162 22:24:36 ================== 22:24:36 2019-04-01 22:22:57.123 UTC  orderer.common.cluster.step  checkExpiration -> WARN 309 Certificate of unidentified node from  for channel  expires in less than -2562047h47m16.854775808s 22:24:36 2019-04-01 22:22:57.130 UTC  test  handleMessage -> WARN 30a Stream read from  failed: oops 22:24:36 --- FAIL: TestSend (0.01s) 22:24:36     --- FAIL: TestSend/Send_step_fails (0.00s) 22:24:36         testing.go:771: race detected during execution of test {code}  ></description> </Issue>
