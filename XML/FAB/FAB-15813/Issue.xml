<Issue id="40795" key="FAB-15813" number="15813" project="10002" reporter="vijaypunugubati" assignee="sykesm" creator="vijaypunugubati" type="10004" summary="Chaincode deployment/instantiation fails in daily test suite" priority="2" resolution="10000" status="6" created="2019-06-25 15:51:33.0" updated="2019-07-08 20:54:51.0" resolutiondate="2019-07-08 20:54:51.0" votes="0" watches="3" workflowId="53750"> <description><! CDATA Many tests in fabric-test behave daily test suite started failing around June 19 with the same type of error, possibly at instantiation step. Note: manual retesting confirmed: * tests {color:#00875A}passed{color} using *fabric* commit b44cb18af07ee4e3a74570ee831cb118a80e61d4 (last one merged June 18 EDT) * tests {color:#DE350B}failed{color} using *fabric* commit 7a2dffa7944da6b9c9ac136508027665eaa6d159 (last one merged June 19 into fabric) * Refer to the attached peer log files for comparison.  The error was because the chaincode (named mycc or other) was found missing and not defined on the channel (e.g. mychannel or behavesystest channel). The framework does not halt when it sends the instantiation request, but the error typically shows up in the subsequent step like invoke or query.  Here is a sample sequence of install/instantiation/invoke commands, as seen in the behave_test.log for the first test error (7251): {code:java}  sh -c "CORE_PEER_MSPCONFIGPATH=/var/hyperledger/configs/1c7e663c948e11e9a66efa163eba0777/peerOrganizations/org2.example.com/users/Admin@org2.example.com/msp CORE_PEER_LOCALMSPID=org2.example.com CORE_PEER_ID=peer1.org2.example.com CORE_PEER_ADDRESS=peer1.org2.example.com:7051 peer chaincode install --name mycc1 --version 0 --lang GOLANG --path github.com/hyperledger/fabric-samples/chaincode/marbles02/go --orderer orderer0.example.com:7050 " : {'peer1.org2.example.com': '', 'peer0.org1.example.com': '', 'peer0.org2.example.com': '', 'peer1.org1.example.com': ''}  sh -c "CORE_PEER_MSPCONFIGPATH=/var/hyperledger/configs/1c7e663c948e11e9a66efa163eba0777/peerOrganizations/org1.example.com/users/Admin@org1.example.com/msp CORE_PEER_LOCALMSPID=org1.example.com CORE_PEER_ID=peer0.org1.example.com CORE_PEER_ADDRESS=peer0.org1.example.com:7051 peer chaincode instantiate --name mycc1 --version 0 --lang GOLANG --channelID mychannel1 --ctor '{\"Args\":  \"\" }' --orderer orderer0.example.com:7050 " : {'peer0.org1.example.com': ''} Error occurred  u'docker exec cli sh -c "CORE_PEER_MSPCONFIGPATH=/var/hyperledger/configs/1c7e663c948e11e9a66efa163eba0777/peerOrganizations/org1.example.com/users/User1@org1.example.com/msp CORE_PEER_LOCALMSPID=org1.example.com CORE_PEER_ID=peer0.org1.example.com CORE_PEER_ADDRESS=peer0.org1.example.com:7051 peer chaincode invoke --name mycc1 --orderer orderer0.example.com:7050 --ctor \'{\\"Args\\":  \\"initMarble\\",\\"marble100\\",\\"red\\",\\"5\\",\\"cassey\\" }\' --waitForEvent --channelID mychannel1 --peerAddresses peer0.org1.example.com:7051 "' :  36m2019-06-22 01:37:55.075 UTC  bccsp_sw  openKeyStore -> DEBU 001 0m KeyStore opened at  /var/hyperledger/configs/1c7e663c948e11e9a66efa163eba0777/peerOrganizations/org1.example.com/users/User1@org1.example.com/msp/keystore ...done {code}  *Error snippet from behave test output log:* {code:java} / And an admin deploys chaincode at path "github.com/hyperledger/fabric-samples/chaincode/marbles02/go" with args  ""  with name "mycc1" with language "GOLANG" on channel "mychannel1"                                                                                                                                 # steps/endorser_impl.py:119 And an admin deploys chaincode at path "github.com/hyperledger/fabric-samples/chaincode/marbles02/go" with args  ""  with name "mycc2" with language "GOLANG" on channel "mychannel2"                                                                                                                                 # steps/endorser_impl.py:119 And an admin deploys chaincode at path "github.com/hyperledger/fabric-samples/chaincode/marbles02/go" with args  ""  with name "mycc3" with language "GOLANG" on channel "mychannel3"                                                                                                                                 # steps/endorser_impl.py:119 When a user invokes on the channel "mychannel1" using chaincode named "mycc1" with args  "initMarble","marble1","green","10","matt"  on "peer0.org1.example.com"                                                                                                                                                      # steps/endorser_impl.py:634 And a user invokes on the channel "mychannel2" using chaincode named "mycc2" with args  "initMarble","marble2","yellow","20","alex"  on "peer0.org1.example.com"                                                                                                                                                      # steps/endorser_impl.py:634 And a user invokes on the channel "mychannel3" using chaincode named "mycc3" with args  "initMarble","marble3","red","5","jose"  on "peer0.org1.example.com"                                                                                                                                                          # steps/endorser_impl.py:634 When a user queries on the channel "mychannel1" using chaincode named "mycc1" with args  "queryMarbles", "{\\"selector\\":{\\"docType\\":\\"marble\\",\\"owner\\":\\"matt\\", \\"color\\":\\"green\\"}, \\"use_index\\": \\"_design/indexdoc_behave_test\\", \\"index_behave_test\\" }"  on "peer0.org1.example.com"  # steps/endorser_impl.py:466 Then a user receives a response containing "owner":"matt"                                                                                                                                                                                                                                                             # steps/endorser_impl.py:1228 Assertion Failed: Expected response was "owner":"matt"; received Error occurred  u'docker exec peer0.org1.example.com sh -c "CORE_PEER_MSPCONFIGPATH=/var/hyperledger/configs/d46f5f6c948e11e9a66efa163eba0777/peerOrganizations/org1.example.com/users/User1@org1.example.com/msp CORE_PEER_LOCALMSPID=org1.example.com CORE_PEER_ID=peer0.org1.example.com CORE_PEER_ADDRESS=peer0.org1.example.com:7051 peer chaincode query --name mycc1 --ctor \'{\\"Args\\":  \\"queryMarbles\\", \\"{\\\\\\"selector\\\\\\":{\\\\\\"docType\\\\\\":\\\\\\"marble\\\\\\",\\\\\\"owner\\\\\\":\\\\\\"matt\\\\\\", \\\\\\"color\\\\\\":\\\\\\"green\\\\\\"}, \\\\\\"use_index\\\\\\": \\\\\\"_design/indexdoc_behave_test\\\\\\", \\\\\\"index_behave_test\\\\\\" }\\" }\' --channelID mychannel1 "' : Error: endorsement failure during query. response: status:500 message:"make sure the chaincode mycc1 has been successfully defined on channel mychannel1 and try again: chaincode mycc1 not found"  / code placeholder {code} It's common error found on almost all test-cases that were broke in the behave-test feature on master.  *Error snippet in peer logs* (this peer happened to become the channel leader for its org, and you can see it immediately encounters errors whereas those errors normally would not occur. Also this was the peer from which we would do the next query - although that happens later on): {code:java} / gossip.election  beLeader -> INFO 03e 0m 67a858c5f86674ad9c5100fed92c9ad5294f1eae4594e01ada8079a2a230d9ba : Becoming a leader  34m2019-06-22 03:15:28.628 UTC  gossip.service  func1 -> INFO 03f 0m Elected as a leader, starting delivery service for channel behavesystest  31m2019-06-22 03:15:28.629 UTC  comm  GetDeliverServiceCredentials -> ERRO 040 0m Attempted to obtain root CA certs of an unknown channel: behavesystest  31m2019-06-22 03:15:28.629 UTC  ConnProducer  NewConnection -> ERRO 041 0m Failed connecting to orderer0.example.com:7050 , error: failed obtaining credentials for channel behavesystest: didn't find any root CA certs for channel behavesystest  31m2019-06-22 03:15:28.629 UTC  ConnProducer  NewConnection -> ERRO 042 0m Could not connect to any of the endpoints:  orderer0.example.com:7050   31m2019-06-22 03:15:28.629 UTC  deliveryClient  connect -> ERRO 043 0m Failed obtaining connection: could not connect to any of the endpoints:  orderer0.example.com:7050   33m2019-06-22 03:15:28.629 UTC  deliveryClient  try -> WARN 044 0m Got error: could not connect to any of the endpoints:  orderer0.example.com:7050  , at 1 attempt. Retrying in 1s  31m2019-06-22 03:15:29.629 UTC  comm  GetDeliverServiceCredentials -> ERRO 045 0m Attempted to obtain root CA certs of an unknown channel: behavesystest  31m2019-06-22 03:15:29.629 UTC  ConnProducer  NewConnection -> ERRO 046 0m Failed connecting to orderer0.example.com:7050 , error: failed obtaining credentials for channel behavesystest: didn't find any root CA certs for channel behavesystest  31m2019-06-22 03:15:29.629 UTC  ConnProducer  NewConnection -> ERRO 047 0m Could not connect to any of the endpoints:  orderer0.example.com:7050   31m2019-06-22 03:15:29.630 UTC  deliveryClient  connect -> ERRO 048 0m Failed obtaining connection: could not connect to any of the endpoints:  orderer0.example.com:7050   33m2019-06-22 03:15:29.630 UTC  deliveryClient  try -> WARN 049 0m Got error: could not connect to any of the endpoints:  orderer0.example.com:7050  , at 2 attempt. Retrying in 2s  31m2019-06-22 03:15:31.630 UTC  comm  GetDeliverServiceCredentials -> ERRO 04a 0m Attempted to obtain root CA certs of an unknown channel: behavesystest  31m2019-06-22 03:15:31.630 UTC  ConnProducer  NewConnection -> ERRO 04b 0m Failed connecting to orderer0.example.com:7050 , error: failed obtaining credentials for channel behavesystest: didn't find any root CA certs for channel behavesystest  31m2019-06-22 03:15:31.630 UTC  ConnProducer  NewConnection -> ERRO 04c 0m Could not connect to any of the endpoints:  orderer0.example.com:7050   31m2019-06-22 03:15:31.630 UTC  deliveryClient  connect -> ERRO 04d 0m Failed obtaining connection: could not connect to any of the endpoints:  orderer0.example.com:7050   33m2019-06-22 03:15:31.630 UTC  deliveryClient  try -> WARN 04e 0m Got error: could not connect to any of the endpoints:  orderer0.example.com:7050  , at 3 attempt. Retrying in 4s  31m2019-06-22 03:15:35.630 UTC  comm  GetDeliverServiceCredentials -> ERRO 04f 0m Attempted to obtain root CA certs of an unknown channel: behavesystest  31m2019-06-22 03:15:35.630 UTC  ConnProducer  NewConnection -> ERRO 050 0m Failed connecting to orderer0.example.com:7050 , error: failed obtaining credentials for channel behavesystest: didn't find any root CA certs for channel behavesystest  31m2019-06-22 03:15:35.630 UTC  ConnProducer  NewConnection -> ERRO 051 0m Could not connect to any of the endpoints:  orderer0.example.com:7050   31m2019-06-22 03:15:35.630 UTC  deliveryClient  connect -> ERRO 052 0m Failed obtaining connection: could not connect to any of the endpoints:  orderer0.example.com:7050   33m2019-06-22 03:15:35.631 UTC  deliveryClient  try -> WARN 053 0m Got error: could not connect to any of the endpoints:  orderer0.example.com:7050  , at 4 attempt. Retrying in 8s  36m2019-06-22 03:15:43.509 UTC  endorser  ProcessProposal -> DEBU 054 0m Entering: request from 192.168.144.10:57614  36m2019-06-22 03:15:43.510 UTC  endorser  preProcess -> DEBU 055 0m    383456c0  processing txid: 383456c0ef74735882e86b31ce64958333cd425a50e6a6936ec67a384b1aad30  36m2019-06-22 03:15:43.510 UTC  endorser  SimulateProposal -> DEBU 056 0m    383456c0  Entry chaincode: name:"lscc"   34m2019-06-22 03:15:43.510 UTC  endorser  callChaincode -> INFO 057 0m    383456c0  Entry chaincode: name:"lscc"   34m2019-06-22 03:15:43.511 UTC  lscc  executeInstall -> INFO 058 0m Installed Chaincode  mycc  Version  0  to peer  34m2019-06-22 03:15:43.511 UTC  endorser  callChaincode -> INFO 059 0m    383456c0  Exit chaincode: name:"lscc"  (1ms)  36m2019-06-22 03:15:43.511 UTC  endorser  SimulateProposal -> DEBU 05a 0m    383456c0  Exit/ code placeholder {code} *All Build logs:* Go here to select _behave_tests.log_  or other fabric node logs for individual tests. * https://jenkins.hyperledger.org/view/fabric-test/job/fabric-test-daily-behave-master-x86_64/284/artifact/gopath/src/github.com/hyperledger/fabric-test/feature/ *  * https://jenkins.hyperledger.org/view/fabric-test/job/fabric-test-daily-behave-master-x86_64/284/artifact/gopath/src/github.com/hyperledger/fabric-test/feature/peer0.org1.example.com_FAB-11808%3A_Test_the_use_of_the_network_model_API_to_successfully_commit_to_the_ledger_–_@1.1_.log|https://jenkins.hyperledger.org/view/fabric-test/job/fabric-test-daily-behave-master-x86_64/284/artifact/gopath/src/github.com/hyperledger/fabric-test/feature/peer0.org1.example.com_FAB-11808%3A_Test_the_use_of_the_network_model_API_to_successfully_commit_to_the_ledger_--_@1.1_.log *    ></description> </Issue>
