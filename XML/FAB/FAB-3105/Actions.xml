<Action id="22328" issue="15692" author="mastersingh24" type="comment" created="2017-04-13 11:43:56.0" updateauthor="mastersingh24" updated="2017-04-14 09:23:53.0"> <body><! CDATA Hopefully this will be straightforward as we already do something similar for connecting to the orderer here:  https://github.com/hyperledger/fabric/blob/master/core/comm/connection.go#L89  The proposal to fix this would be to add a {{GetGossipServiceCredentials()}} method which does the same thing as {{GetDeliverServiceCredentials()}} except it will return the app (aka peer) roots rather than the orderer roots  ></body> </Action>
<Action id="22329" issue="15692" author="yacovm" type="comment" created="2017-04-13 11:59:25.0" updateauthor="yacovm" updated="2017-04-13 12:00:15.0"> <body><! CDATA It's a bit more complicated than that in my opinion: in: https://github.com/hyperledger/fabric/blob/master/gossip/comm/comm_impl.go#L153 we have opts   grpc.DialOption that are used both in production and in test code. The peer also works in cases where no TLS is used, but in tests- we have our own self-signed TLS certs that are generated in the tests (to test running with TLS)  Now, the dial options are set here: https://github.com/hyperledger/fabric/blob/master/gossip/service/gossip_service.go#L134-L139  I suggest that instead of dialOptions, we would have a callback that returns dialOptions on demand, and in all places in *gossip/comm/comm_impl*, that callback would be called instead of referencing the *opts* variable.  This way- it'll work both for test code, both for non-TLS, and both for TLS code.  What do you think?  ~mastersingh24   ~C0rWin   ></body> </Action>
<Action id="22428" issue="15692" author="mastersingh24" type="comment" created="2017-04-14 09:39:04.0" updateauthor="mastersingh24" updated="2017-04-14 09:39:04.0"> <body><! CDATA  ~yacovm  I see what you are saying here, but  https://github.com/hyperledger/fabric/blob/master/gossip/service/gossip_service.go#L134-L139 was the only place I found that used {{InitTLSFor Peer()}} (as you stated above) and it seems that should be the only call we need to replace.  It seems it would also be the least invasive in the code and should solve the problem for non-test scenarios.    ></body> </Action>
<Action id="22429" issue="15692" author="yacovm" type="comment" created="2017-04-14 10:01:54.0" updateauthor="yacovm" updated="2017-04-14 10:01:54.0"> <body><! CDATA I don't think it'll work. DialOptions is immutable, isn't it? This is set on startup, but peers join channels at runtime.  Maybe I'm missing something though  ></body> </Action>
<Action id="23206" issue="15692" author="mastersingh24" type="comment" body="https://gerrit.hyperledger.org/r/#/c/8777/" created="2017-04-30 17:22:19.0" updateauthor="mastersingh24" updated="2017-04-30 17:22:19.0"/>
