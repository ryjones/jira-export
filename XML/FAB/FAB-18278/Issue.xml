<Issue id="46218" key="FAB-18278" number="18278" project="10002" reporter="denyeart" assignee="manish-sethi" creator="denyeart" type="10003" summary="Update Service Discovery to get config from state instead of config block" priority="3" resolution="10000" status="6" created="2020-10-19 17:42:41.0" updated="2020-10-22 04:51:35.0" resolutiondate="2020-10-22 04:51:25.0" votes="0" watches="3" workflowId="60128" archived="N"> <description><! CDATA Service Discovery config query (e.g. for retrieving orderer endpoints) doesn't work against peers bootstrapped from a snapshot when there are no config blocks after the snapshot: {code:java} $ discover --configFile conf.yaml config --channel mychannel --server 127.0.0.1:7057 failed fetching config for channel mychannel{code}    CSCC and Service Discovery both get the config block.  For peers joined from snapshot, there may not be a latest config block. Therefore, consumers should get the latest config from state, instead of from the latest config block.  The consumers are CSCC and Service Discovery, based on grep results: {code:java} core/scc/cscc/configure.go:294: block, err := peer.ConfigBlockFromLedger(channel.Ledger()) internal/peer/node/start.go:963: block, err := peer.ConfigBlockFromLedger(channel.Ledger()){code}    Since CSCC GetConfigBlock() is an external API, this one can't be changed and consumers will have to deal with the error "failed fetching config".  That leaves Service Discovery. It should be updated to get latest config from state.  ></description> </Issue>
