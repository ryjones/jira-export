<Action id="59673" issue="39575" author="yacovm" type="comment" body="Thanks  ~ales , nice find. " created="2019-05-02 11:12:28.0" updateauthor="yacovm" updated="2019-05-02 11:12:28.0"/>
<Action id="59674" issue="39575" author="yacovm" type="comment" body=" ~manish-sethi   ~mastersingh24  Since we have a pointer at each block to the last config sequence, what is the benefit of using the stateDB-persisted config over having the peer populate the config at starup by fetching the last config block according to the last block? " created="2019-05-02 11:21:41.0" updateauthor="yacovm" updated="2019-05-02 11:21:41.0"/>
<Action id="59677" issue="39575" author="yacovm" type="comment" created="2019-05-02 13:12:18.0" updateauthor="yacovm" updated="2019-05-02 13:12:18.0"> <body><! CDATA Also, the old lifecycle is the only thing that has gone substantial rewrite, but since the last security review (in 1.0 timeframe) lots of other code has been added to the fabric core.  I think this calls for the thorough (internal) security reviews of other components.   ~ales  what do you think?   ></body> </Action>
<Action id="59678" issue="39575" author="ales" type="comment" body="Absolutely  ~yacovm  - we have various priorities on various fronts (hygiene, testing, flakes) - we should make sure security is also one of them." created="2019-05-02 13:19:13.0" updateauthor="ales" updated="2019-05-02 13:19:13.0"/>
<Action id="59696" issue="39575" author="manish-sethi" type="comment" created="2019-05-03 00:07:20.0" updateauthor="manish-sethi" updated="2019-05-03 00:07:20.0"> <body><! CDATA  ~yacovm  On the background of this - the change for persisting channel config was added in 1.1 when the support for something called resource config was being developed. Resource config support was finally not shipped and persistence of channel config stayed as is.  In terms of benefits, as far as loading at boot time is concerned, I agree with you that since we load full config in memory at boot time there is not much difference between pulling from statedb v/s last config block. However, I feel that having this in state will saves us from handling this as a special _state_ when we implement checkpointing. Since, then the block with last config may have been gone as a result of pruning.  Regardless, this additional entry in lscc transaction that gets unchecked is really scary.  ></body> </Action>
<Action id="59699" issue="39575" author="ales" type="comment" created="2019-05-03 06:13:54.0" updateauthor="ales" updated="2019-05-03 06:13:54.0"> <body><! CDATA {quote}Regardless, this additional entry in lscc transaction that gets unchecked is really scary. {quote} Just to be clear, this attack does not use the additional read-write set in LSCC transactions, it simply deploys the empty namespace via a normal deploy tx.  ></body> </Action>
<Action id="61320" issue="39575" author="caod" type="comment" created="2019-06-27 17:49:17.0" updateauthor="caod" updated="2019-06-27 17:49:17.0"> <body><! CDATA Logs for v1.4 fix:  ```  e  peer-channel-info  2019-06-27 13:41:36.890 EDT  channelCmd  InitCmdFactory -> INFO 001 Endorser and orderer connections initialized  e  org1.peer2  2019-06-27 13:41:36.891 EDT  endorser  callChaincode -> INFO 050    bccf305b  Entry chaincode: name:"qscc"  e  org1.peer2  2019-06-27 13:41:36.892 EDT  endorser  callChaincode -> INFO 051    bccf305b  Exit chaincode: name:"qscc" (1ms)  e  org1.peer2  2019-06-27 13:41:36.892 EDT  comm.grpc.server  1 -> INFO 052 unary call completed grpc.service=protos.Endorser grpc.method=ProcessProposal grpc.peer_address=127.0.0.1:53168 grpc.code=OK grpc.call_duration=1.26901ms  o  peer-channel-info  Blockchain info: \{"height":3,"currentBlockHash":"4gCTOmQnmPePSXcRcnEVqwZmuYpvraGaxX6XAR8lXWo=","previousBlockHash":"Hha9Umnyf6UIU//thEovCIPUzinZljBg8/aETomys4E="}  e  orderer-org.orderer0  2019-06-27 13:41:36.905 EDT  comm.grpc.server  1 -> INFO 01d streaming call completed grpc.service=orderer.AtomicBroadcast grpc.method=Broadcast grpc.peer_address=127.0.0.1:53164 grpc.code=OK grpc.call_duration=543.152µs  e  org2.peer1  2019-06-27 13:41:36.920 EDT  gossip.privdata  StoreBlock -> INFO 045  testchannel  Received block  3  from buffer  e  org1.peer1  2019-06-27 13:41:36.920 EDT  gossip.privdata  StoreBlock -> INFO 055  testchannel  Received block  3  from buffer  e  org2.peer2  2019-06-27 13:41:36.920 EDT  gossip.privdata  StoreBlock -> INFO 04c  testchannel  Received block  3  from buffer  e  org1.peer2  2019-06-27 13:41:36.920 EDT  gossip.privdata  StoreBlock -> INFO 053  testchannel  Received block  3  from buffer  e  org2.peer1  2019-06-27 13:41:36.921 EDT  vscc  Validate -> ERRO 046 VSCC error: ValidateLSCCInvocation failed, err invalid chaincode name ''  e  org1.peer2  2019-06-27 13:41:36.921 EDT  vscc  Validate -> ERRO 054 VSCC error: ValidateLSCCInvocation failed, err invalid chaincode name ''  e  org2.peer1  2019-06-27 13:41:36.921 EDT  committer.txvalidator  validateTx -> ERRO 047 VSCCValidateTx for transaction txId = 0768d46632e4ccadcec6b7d60dd7a937166cbd6893fabf3281dd02ae2fc6680a returned error: invalid chaincode name ''  e  org1.peer1  2019-06-27 13:41:36.921 EDT  vscc  Validate -> ERRO 056 VSCC error: ValidateLSCCInvocation failed, err invalid chaincode name ''  e  org2.peer1  2019-06-27 13:41:36.921 EDT  committer.txvalidator  Validate -> INFO 048  testchannel  Validated block  3  in 1ms  e  org1.peer2  2019-06-27 13:41:36.921 EDT  committer.txvalidator  validateTx -> ERRO 055 VSCCValidateTx for transaction txId = 0768d46632e4ccadcec6b7d60dd7a937166cbd6893fabf3281dd02ae2fc6680a returned error: invalid chaincode name ''  e  org1.peer2  2019-06-27 13:41:36.921 EDT  committer.txvalidator  Validate -> INFO 056  testchannel  Validated block  3  in 1ms  e  org1.peer1  2019-06-27 13:41:36.921 EDT  committer.txvalidator  validateTx -> ERRO 057 VSCCValidateTx for transaction txId = 0768d46632e4ccadcec6b7d60dd7a937166cbd6893fabf3281dd02ae2fc6680a returned error: invalid chaincode name ''  e  org1.peer1  2019-06-27 13:41:36.921 EDT  committer.txvalidator  Validate -> INFO 058  testchannel  Validated block  3  in 1ms  e  org2.peer1  2019-06-27 13:41:36.921 EDT  valimpl  preprocessProtoBlock -> WARN 049 Channel  testchannel : Block  3  Transaction index  0  TxId  0768d46632e4ccadcec6b7d60dd7a937166cbd6893fabf3281dd02ae2fc6680a  marked as invalid by committer. Reason code  ENDORSEMENT_POLICY_FAILURE   e  org1.peer2  2019-06-27 13:41:36.921 EDT  valimpl  preprocessProtoBlock -> WARN 057 Channel  testchannel : Block  3  Transaction index  0  TxId  0768d46632e4ccadcec6b7d60dd7a937166cbd6893fabf3281dd02ae2fc6680a  marked as invalid by committer. Reason code  ENDORSEMENT_POLICY_FAILURE   e  org1.peer1  2019-06-27 13:41:36.921 EDT  valimpl  preprocessProtoBlock -> WARN 059 Channel  testchannel : Block  3  Transaction index  0  TxId  0768d46632e4ccadcec6b7d60dd7a937166cbd6893fabf3281dd02ae2fc6680a  marked as invalid by committer. Reason code  ENDORSEMENT_POLICY_FAILURE   e  org2.peer2  2019-06-27 13:41:36.921 EDT  vscc  Validate -> ERRO 04d VSCC error: ValidateLSCCInvocation failed, err invalid chaincode name ''  e  org2.peer2  2019-06-27 13:41:36.921 EDT  committer.txvalidator  validateTx -> ERRO 04e VSCCValidateTx for transaction txId = 0768d46632e4ccadcec6b7d60dd7a937166cbd6893fabf3281dd02ae2fc6680a returned error: invalid chaincode name ''  e  org2.peer2  2019-06-27 13:41:36.921 EDT  committer.txvalidator  Validate -> INFO 04f  testchannel  Validated block  3  in 1ms  e  org2.peer2  2019-06-27 13:41:36.921 EDT  valimpl  preprocessProtoBlock -> WARN 050 Channel  testchannel : Block  3  Transaction index  0  TxId  0768d46632e4ccadcec6b7d60dd7a937166cbd6893fabf3281dd02ae2fc6680a  marked as invalid by committer. Reason code  ENDORSEMENT_POLICY_FAILURE   ```  ></body> </Action>
<Action id="61321" issue="39575" author="caod" type="comment" body="Attached `channelconfigattack.4.patch` file with 1.4 backported repro case" created="2019-06-27 17:55:21.0" updateauthor="caod" updated="2019-06-27 17:55:21.0"/>
<Action id="61322" issue="39575" author="caod" type="comment" created="2019-06-27 19:07:56.0" updateauthor="caod" updated="2019-06-27 19:07:56.0"> <body><! CDATA Verified fix for 2.0 master branch:  ```   e  peer-channel-info  2019-06-27 15:05:55.176 EDT  channelCmd  InitCmdFactory -> INFO 001 Endorser and orderer connections initialized  e  org1.peer2  2019-06-27 15:05:55.177 EDT  endorser  callChaincode -> INFO 04a    74191515  Entry chaincode: name:"qscc"  e  org1.peer2  2019-06-27 15:05:55.178 EDT  endorser  callChaincode -> INFO 04b    74191515  Exit chaincode: name:"qscc" (1ms)  e  org1.peer2  2019-06-27 15:05:55.178 EDT  comm.grpc.server  1 -> INFO 04c unary call completed grpc.service=protos.Endorser grpc.method=ProcessProposal grpc.peer_address=127.0.0.1:49561 grpc.code=OK grpc.call_duration=1.797886ms  o  peer-channel-info  Blockchain info: \{"height":3,"currentBlockHash":"kgIHrH6OsMFJXG/OlfH2RVh0He0utf8tnOyUxqCevs4=","previousBlockHash":"kQXdT6lMpnZu8EbiGoOUoOcw6ezOywUPIi42XCu4+7Y="}  e  orderer-org.orderer0  2019-06-27 15:05:55.192 EDT  comm.grpc.server  1 -> INFO 01d streaming call completed grpc.service=orderer.AtomicBroadcast grpc.method=Broadcast grpc.peer_address=127.0.0.1:49557 grpc.code=OK grpc.call_duration=736.127µs  e  org2.peer2  2019-06-27 15:05:55.202 EDT  gossip.privdata  StoreBlock -> INFO 046  testchannel  Received block  3  from buffer  e  org2.peer1  2019-06-27 15:05:55.202 EDT  gossip.privdata  StoreBlock -> INFO 040  testchannel  Received block  3  from buffer  e  org1.peer1  2019-06-27 15:05:55.202 EDT  gossip.privdata  StoreBlock -> INFO 04f  testchannel  Received block  3  from buffer  e  org1.peer2  2019-06-27 15:05:55.202 EDT  gossip.privdata  StoreBlock -> INFO 04d  testchannel  Received block  3  from buffer  e  org1.peer1  2019-06-27 15:05:55.203 EDT  vscc  Validate -> ERRO 050 VSCC error: ValidateLSCCInvocation failed, err invalid chaincode name ''  e  org1.peer2  2019-06-27 15:05:55.203 EDT  vscc  Validate -> ERRO 04e VSCC error: ValidateLSCCInvocation failed, err invalid chaincode name ''  e  org1.peer1  2019-06-27 15:05:55.203 EDT  committer.txvalidator  validateTx -> ERRO 051 VSCCValidateTx for transaction txId = 7d6396cb0bbc12781d9e81f48e4b4cb1d016791c04e5d02ddacc4c15f58c3353 returned error: invalid chaincode name ''  e  org2.peer1  2019-06-27 15:05:55.203 EDT  vscc  Validate -> ERRO 041 VSCC error: ValidateLSCCInvocation failed, err invalid chaincode name ''  e  org1.peer2  2019-06-27 15:05:55.203 EDT  committer.txvalidator  validateTx -> ERRO 04f VSCCValidateTx for transaction txId = 7d6396cb0bbc12781d9e81f48e4b4cb1d016791c04e5d02ddacc4c15f58c3353 returned error: invalid chaincode name ''  e  org1.peer1  2019-06-27 15:05:55.203 EDT  committer.txvalidator  Validate -> INFO 052  testchannel  Validated block  3  in 1ms  e  org2.peer1  2019-06-27 15:05:55.203 EDT  committer.txvalidator  validateTx -> ERRO 042 VSCCValidateTx for transaction txId = 7d6396cb0bbc12781d9e81f48e4b4cb1d016791c04e5d02ddacc4c15f58c3353 returned error: invalid chaincode name ''  e  org2.peer1  2019-06-27 15:05:55.203 EDT  committer.txvalidator  Validate -> INFO 043  testchannel  Validated block  3  in 1ms  e  org1.peer2  2019-06-27 15:05:55.203 EDT  committer.txvalidator  Validate -> INFO 050  testchannel  Validated block  3  in 1ms  e  org1.peer1  2019-06-27 15:05:55.203 EDT  valimpl  preprocessProtoBlock -> WARN 053 Channel  testchannel : Block  3  Transaction index  0  TxId  7d6396cb0bbc12781d9e81f48e4b4cb1d016791c04e5d02ddacc4c15f58c3353  marked as invalid by committer. Reason code  ENDORSEMENT_POLICY_FAILURE   e  org2.peer2  2019-06-27 15:05:55.203 EDT  vscc  Validate -> ERRO 047 VSCC error: ValidateLSCCInvocation failed, err invalid chaincode name ''  e  org1.peer2  2019-06-27 15:05:55.203 EDT  valimpl  preprocessProtoBlock -> WARN 051 Channel  testchannel : Block  3  Transaction index  0  TxId  7d6396cb0bbc12781d9e81f48e4b4cb1d016791c04e5d02ddacc4c15f58c3353  marked as invalid by committer. Reason code  ENDORSEMENT_POLICY_FAILURE   e  org2.peer1  2019-06-27 15:05:55.203 EDT  valimpl  preprocessProtoBlock -> WARN 044 Channel  testchannel : Block  3  Transaction index  0  TxId  7d6396cb0bbc12781d9e81f48e4b4cb1d016791c04e5d02ddacc4c15f58c3353  marked as invalid by committer. Reason code  ENDORSEMENT_POLICY_FAILURE   e  org2.peer2  2019-06-27 15:05:55.203 EDT  committer.txvalidator  validateTx -> ERRO 048 VSCCValidateTx for transaction txId = 7d6396cb0bbc12781d9e81f48e4b4cb1d016791c04e5d02ddacc4c15f58c3353 returned error: invalid chaincode name ''  e  org2.peer2  2019-06-27 15:05:55.203 EDT  committer.txvalidator  Validate -> INFO 049  testchannel  Validated block  3  in 1ms  e  org2.peer2  2019-06-27 15:05:55.203 EDT  valimpl  preprocessProtoBlock -> WARN 04a Channel  testchannel : Block  3  Transaction index  0  TxId  7d6396cb0bbc12781d9e81f48e4b4cb1d016791c04e5d02ddacc4c15f58c3353  marked as invalid by committer. Reason code  ENDORSEMENT_POLICY_FAILURE   ```  ></body> </Action>
<Action id="61381" issue="39575" author="denyeart" type="comment" body="https://gerrit.hyperledger.org/r/#/c/fabric/+/32116/" created="2019-07-01 11:41:43.0" updateauthor="denyeart" updated="2019-07-01 11:41:43.0"/>
<Action id="62702" issue="39575" author="denyeart" type="comment" body="Addressed via FAB-15845" created="2019-08-07 19:45:29.0" updateauthor="denyeart" updated="2019-08-07 19:45:29.0"/>
