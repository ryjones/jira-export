<Issue id="44278" key="FAB-17479" number="17479" project="10002" reporter="ptippett" assignee="yacovm" creator="ptippett" type="10004" summary="Orderer Crash if orderer not added to consenter block for all channels." priority="3" resolution="10000" status="6" created="2020-02-06 19:00:24.0" updated="2020-02-13 09:19:30.0" resolutiondate="2020-02-13 09:19:30.0" votes="0" watches="4" workflowId="58179" archived="N"> <description><! CDATA To Reproduce: * Start with a blockchain environment with a system channel and 1 or more application channels that are using Kafka consensus. * Convert the environment to RAFT consensus and turn off kafka/zookeeper containers. * Add a new orderer to the Orderer cluster. * However, only add that orderer to the consenter set of the system channel and some of the application channels. * The orderer will synch data for the channels where it is a member of the consenter set. * In the logs (see below) you'll see it start raft based consensus but it will also try to start kafka based consensus for the channel it is not a member of. * Note that in our case, the kafka brokers were left in the kafka broker list in the channel info, but consensus type is etcdraft.  Here's the error we saw:  ``` 36m2020-01-24 13:22:00.827 UTC  orderer.consensus.kafka  try -> DEBU 7e6 0m  channel: go  Need to retry because process failed = error creating topic  go ; failed to retrieve metadata for the cluster  36m2020-01-24 13:22:05.356 UTC  orderer.common.server  replicateDisabledChains -> DEBU 7e7 0m No inactive chains to try to replicate  36m2020-01-24 13:22:05.651 UTC  orderer.consensus.kafka  try -> DEBU 7e8 0m  channel: go  Creating Kafka topic  go  for channel  go/0   36m2020-01-24 13:22:05.652 UTC  orderer.consensus.kafka.sarama  Open -> DEBU 7e9 0m ClientID is the default of 'sarama', you should consider setting it to something application-specific.  36m2020-01-24 13:22:05.687 UTC  orderer.consensus.kafka.sarama  withRecover -> DEBU 7ea 0m Failed to connect to broker ash-zbc15a.4.secure.blockchain.ibm.com:10900: dial tcp 169.47.130.222:10900: connect: connection refused  36m2020-01-24 13:22:05.687 UTC  orderer.consensus.kafka.sarama  Open -> DEBU 7eb 0m ClientID is the default of 'sarama', you should consider setting it to something application-specific.  36m2020-01-24 13:22:05.722 UTC  orderer.consensus.kafka.sarama  withRecover -> DEBU 7ec 0m Failed to connect to broker ash-zbc15b.4.secure.blockchain.ibm.com:10900: dial tcp 169.47.135.215:10900: connect: connection refused  36m2020-01-24 13:22:05.722 UTC  orderer.consensus.kafka.sarama  Open -> DEBU 7ed 0m ClientID is the default of 'sarama', you should consider setting it to something application-specific.  36m2020-01-24 13:22:05.760 UTC  orderer.consensus.kafka.sarama  withRecover -> DEBU 7ee 0m Failed to connect to broker ash-zbc15c.4.secure.blockchain.ibm.com:10900: dial tcp 169.47.135.219:10900: connect: connection refused  36m2020-01-24 13:22:05.761 UTC  orderer.consensus.kafka.sarama  Open -> DEBU 7ef 0m ClientID is the default of 'sarama', you should consider setting it to something application-specific.  36m2020-01-24 13:22:05.797 UTC  orderer.consensus.kafka.sarama  withRecover -> DEBU 7f0 0m Failed to connect to broker ash-zbc15d.4.secure.blockchain.ibm.com:10900: dial tcp 169.47.135.217:10900: connect: connection refused  36m2020-01-24 13:22:05.797 UTC  orderer.consensus.kafka.sarama  Open -> DEBU 7f1 0m ClientID is the default of 'sarama', you should consider setting it to something application-specific.  36m2020-01-24 13:22:05.830 UTC  orderer.consensus.kafka.sarama  withRecover -> DEBU 7f2 0m Failed to connect to broker ash-zbc15e.4.secure.blockchain.ibm.com:10900: dial tcp 169.47.135.218:10900: connect: connection refused  36m2020-01-24 13:22:05.830 UTC  orderer.consensus.kafka  try -> DEBU 7f3 0m  channel: go  Need to retry because process failed = error creating topic  go ; failed to retrieve metadata for the cluster panic: runtime error: invalid memory address or nil pointer dereference   signal SIGSEGV: segmentation violation code=0x1 addr=0x20 pc=0x1101470 ```  ></description> </Issue>
