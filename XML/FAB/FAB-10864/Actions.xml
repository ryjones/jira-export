<Action id="46532" issue="31368" author="denyeart" type="comment" created="2018-06-26 11:45:46.0" updateauthor="denyeart" updated="2018-06-26 11:45:46.0"> <body><! CDATA Need a couple things in order to troubleshoot:  1) Debug log, generate by setting docker environment variables:        - CORE_LOGGING_LEVEL=DEBUG       - CORE_LOGGING_GOSSIP=DEBUG  2) Need the client to get the proposal response "message" text that corresponds to the 500 status.  This message is not printed in the peer logs as it is specific to the chaincode application.  ></body> </Action>
<Action id="46553" issue="31368" author="rlalgowdar" type="comment" created="2018-06-26 16:21:56.0" updateauthor="rlalgowdar" updated="2018-06-26 16:24:44.0"> <body><! CDATA  ^peer.debug.log.10q.2.jun26.log.zip  Debug logs zip      31m2018-06-26 16:17:28.263 UTC  chaincode  HandleTransaction -> ERRO e4b3^  0m  242f8c07  Failed to handle GET_STATE. error: Private data matching public hash version is not available. Public hash version = &version.Height\{BlockNum:0x2, TxNum:0x0}, Private data version = (*version.Height)(nil) github.com/hyperledger/fabric/core/chaincode.(*Handler).HandleGetState         /opt/gopath/src/github.com/hyperledger/fabric/core/chaincode/handler.go:545 github.com/hyperledger/fabric/core/chaincode.(*Handler).HandleGetState-fm         /opt/gopath/src/github.com/hyperledger/fabric/core/chaincode/handler.go:197 github.com/hyperledger/fabric/core/chaincode.(*Handler).HandleTransaction         /opt/gopath/src/github.com/hyperledger/fabric/core/chaincode/handler.go:242 runtime.goexit         /opt/go/src/runtime/asm_amd64.s:2361 GET_STATE failed: transaction ID: 242f8c07955811cb2b6b27affc6efb6a20b078ac15a7c7f39c96b2f887ee5dd5 github.com/hyperledger/fabric/core/chaincode.(*Handler).HandleTransaction         /opt/gopath/src/github.com/hyperledger/fabric/core/chaincode/handler.go:246 runtime.goexit         /opt/go/src/runtime/asm_amd64.s:2361  ></body> </Action>
<Action id="46563" issue="31368" author="denyeart" type="comment" created="2018-06-26 17:04:38.0" updateauthor="denyeart" updated="2018-06-26 17:15:00.0"> <body><! CDATA I see what’s happening now: {code:java} 2018-06-26 16:15:14.049 UTC  gossip/privdata  fetchFromPeers -> DEBU babd {a87cdf388c9206b27d45cabdc59162b115c841ac4b35aaabf415b8d1aae34594 0 marbles02_private_go_ch1 collectionMarblePrivateDetails 9cad126ab41af988c028cadf25072360e351c4c3170fb8bf33e5a2d6964cdd67} was purged or will soon be purged, skipping fetch{code} Since your blockToLive is 3, the private data executed in peer0 is either purged or will soon be purged, so peer1 doesn’t pull it. Then upon query on peer1 you get a 500 error with message “Private data matching public hash version is not available”. This is as-designed.  Increase your block to live to something like 100, and you should see the private data for the newer ‘fresh’ blocks.  For the data in expired blocks, you will get a 500 error with chaincode message "Marble private details does not exist”.      ~C0rWin  I think the above message needs to be a Warning so that people notice the reason for the missing private data.  Let's use this JIRA item to make that change.  There is a related (good) warning when peer cannot fetch private data: {code:java} Could not fetch all missing collection private write sets from remote peers. Will commit block with missing private write sets:{code} I think the ‘skipping fetch’ message should look similar…. Warn people that “will commit block with missing private write sets” (I often grep for things like "missing", so would be good to keep the message somewhat consistent).  ></body> </Action>
<Action id="46571" issue="31368" author="c0rwin" type="comment" created="2018-06-26 20:03:33.0" updateauthor="c0rwin" updated="2018-06-26 20:06:55.0"> <body><! CDATA {quote} Artem Barger I think the above message needs to be a Warning so that people notice the reason for the missing private data.  Let's use this JIRA item to make that change. {quote}  yes, I'd agree, well produce CR,  ~denyeart   ></body> </Action>
<Action id="46588" issue="31368" author="c0rwin" type="comment" body="Created sub-task (FAB-10888), since log message is not related to the current ticket directly." created="2018-06-27 10:36:36.0" updateauthor="c0rwin" updated="2018-06-27 10:36:36.0"/>
<Action id="46722" issue="31368" author="denyeart" type="comment" created="2018-06-28 22:16:41.0" updateauthor="denyeart" updated="2018-06-28 22:16:41.0"> <body><! CDATA Sub-task has been merged.  I will close the main Bug as Invalid since this was working as designed... the improved Warning from the sub-task should help people understand it in the future.  ></body> </Action>
