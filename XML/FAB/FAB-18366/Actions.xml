<Action id="70908" issue="46388" author="yacovm" type="comment" created="2020-12-04 15:43:15.0" updateauthor="yacovm" updated="2020-12-04 15:43:15.0"> <body><! CDATA {code:java} channel1  channel2 org1: peer0     peer0,peer1 org2: peer0 org3:           peer0,peer1 {code} This should not be possible. In order for peer0.org2 to want to connect to peer1.org1 it needs to be able to validate its identity, but as you said - these peers are from foreign organizations and they do not share a channel.  Can you provide logs that show this?  ></body> </Action>
<Action id="70916" issue="46388" author="zerppen" type="comment" created="2020-12-07 06:46:22.0" updateauthor="zerppen" updated="2020-12-07 06:46:22.0"> <body><! CDATA Validating failed but peer0 of org2 will handshake peer1of org1 all time that is the problem.  this is the peer0 of org2's logs:  ```  2020-12-03 21:22:49.085 UTC  gossip.comm  sendToEndpoint -> WARN 17c14 Failed obtaining connection for peer1.org1.example.com:8051, PKIid:d6c39d583be44e86f2ced0e83392259d216f2eed60182f46b8f2a5d21f764177 reason: timed out waiting for connection message from 172.19.69.63:8051 2020-12-03 21:22:49.085 UTC  gossip.discovery  expireDeadMembers -> WARN 17c15 Entering  d6c39d583be44e86f2ced0e83392259d216f2eed60182f46b8f2a5d21f764177  2020-12-03 21:22:49.085 UTC  gossip.discovery  expireDeadMembers -> WARN 17c16 Closing connection to Endpoint: peer1.org1.example.com:8051, InternalEndpoint: , PKI-ID: d6c39d583be44e86f2ced0e83392259d216f2eed60182f46b8f2a5d21f764177, Metadata:  2020-12-03 21:22:49.085 UTC  gossip.discovery  expireDeadMembers -> WARN 17c17 Exiting 2020-12-03 21:22:50.080 UTC  gossip.comm  authenticateRemotePeer -> WARN 17c18 Failed reading messge from 172.19.69.63:8051, reason: timed out waiting for connection message from 172.19.69.63:8051 2020-12-03 21:22:50.080 UTC  gossip.comm  createConnection -> WARN 17c19 Authentication failed: timed out waiting for connection message from 172.19.69.63:8051 github.com/hyperledger/fabric/gossip/comm.readWithTimeout /opt/gopath/src/github.com/hyperledger/fabric/gossip/comm/comm_impl.go:618 github.com/hyperledger/fabric/gossip/comm.(*commImpl).authenticateRemotePeer /opt/gopath/src/github.com/hyperledger/fabric/gossip/comm/comm_impl.go:431 github.com/hyperledger/fabric/gossip/comm.(*commImpl).createConnection /opt/gopath/src/github.com/hyperledger/fabric/gossip/comm/comm_impl.go:163 github.com/hyperledger/fabric/gossip/comm.(*connectionStore).getConnection /opt/gopath/src/github.com/hyperledger/fabric/gossip/comm/conn.go:89 github.com/hyperledger/fabric/gossip/comm.(*commImpl).sendToEndpoint /opt/gopath/src/github.com/hyperledger/fabric/gossip/comm/comm_impl.go:230 github.com/hyperledger/fabric/gossip/comm.(*commImpl).Send.func1 /opt/gopath/src/github.com/hyperledger/fabric/gossip/comm/comm_impl.go:217 runtime.goexit /opt/go/src/runtime/asm_amd64.s:1333  ```  this is the peer1 of org1's log:  ```  uthentication failed: No TLS certificate 2020-12-03 12:12:30.145 UTC  comm.grpc.server  1 -> INFO 47ca streaming call completed grpc.service=gossip.Gossip grpc.method=GossipStream grpc.peer_address=172.28.0.1:41912 error="No TLS certificate" grpc.code=Unknown grpc.call_duration=128.105µs 2020-12-03 12:12:31.138 UTC  comm.grpc.server  1 -> INFO 47cb unary call completed grpc.service=gossip.Gossip grpc.method=Ping grpc.request_deadline=2020-12-03T12:12:33.138Z grpc.peer_address=172.28.0.1:41918 grpc.code=OK grpc.call_duration=59.598µs 2020-12-03 12:12:31.139 UTC  gossip.comm  authenticateRemotePeer -> WARN 47cc 172.28.0.1:41918 didn't send TLS certificate 2020-12-03 12:12:31.139 UTC  gossip.comm  GossipStream -> ERRO 47cd Authentication failed: No TLS certificate 2020-12-03 12:12:31.139 UTC  comm.grpc.server  1 -> INFO 47ce streaming call completed grpc.service=gossip.Gossip grpc.method=GossipStream grpc.peer_address=172.28.0.1:41918 error="No TLS certificate" grpc.code=Unknown grpc.call_duration=126.54µs 2020-12-03 12:12:31.673 UTC  peer.gossip.mcs  Verify -> ERRO 47cf Failed getting validated identity from peer identity  Peer Identity  0a 09 5a 68 75 68 61 69 4d 53 50 12 92 06 2d 2d 2d 2d 2d 42 45 47 49 4e 20 43 45 52 54 49 46 49 43 41 54 45 2d 2d 2d 2d 2d 0a 4d 49 49 43 46 7a 43 43 41 62 32 67 41 77 49 42 41 67 49 52 41 4c 49 6b 58 67 38 39 65 6a 73 31 79 70 4e 30 32 70 72 68 36 49 4d 77 43 67 59 49 4b 6f 5a 49 7a 6a 30 45 41 77 49 77 5a 7a 45 4c 0a 4d 41 6b 47 41 31 55 45 42 68 4d 43 56 56 4d 78 45 7a 41 52 42 67 4e 56 42 41 67 54 43 6b 4e 68 62 47 6c 6d 62 33 4a 75 61 57 45 78 46 6a 41 55 42 67 4e 56 42 41 63 54 44 56 4e 68 62 69 42 47 0a 63 6d 46 75 59 32 6c 7a 59 32 38 78 45 7a 41 52 42 67 4e 56 42 41 6f 54 43 6e 70 6f 64 57 68 68 61 53 35 6a 62 32 30 78 46 6a 41 55 42 67 4e 56 42 41 4d 54 44 57 4e 68 4c 6e 70 6f 64 57 68 68 0a 61 53 35 6a 62 32 30 77 48 68 63 4e 4d 6a 41 78 4d 6a 41 78 4d 44 55 31 4e 54 41 77 57 68 63 4e 4d 7a 41 78 4d 54 49 35 4d 44 55 31 4e 54 41 77 57 6a 42 6b 4d 51 73 77 43 51 59 44 56 51 51 47 0a 45 77 4a 56 55 7a 45 54 4d 42 45 47 41 31 55 45 43 42 4d 4b 51 32 46 73 61 57 5a 76 63 6d 35 70 59 54 45 57 4d 42 51 47 41 31 55 45 42 78 4d 4e 55 32 46 75 49 45 5a 79 59 57 35 6a 61 58 4e 6a 0a 62 7a 45 4e 4d 41 73 47 41 31 55 45 43 78 4d 45 63 47 56 6c 63 6a 45 5a 4d 42 63 47 41 31 55 45 41 78 4d 51 63 47 56 6c 63 6a 41 75 65 6d 68 31 61 47 46 70 4c 6d 4e 76 62 54 42 5a 4d 42 4d 47 0a 42 79 71 47 53 4d 34 39 41 67 45 47 43 43 71 47 53 4d 34 39 41 77 45 48 41 30 49 41 42 4a 72 75 2b 79 70 46 6c 58 39 76 55 2f 50 30 4a 61 6f 6d 64 34 77 6a 32 35 66 67 58 46 36 53 6d 49 39 33 0a 32 75 63 37 4f 4f 64 54 56 34 43 77 35 76 7a 44 59 4d 65 37 4a 53 33 4e 42 79 39 7a 35 68 43 42 48 72 56 66 30 48 70 42 2b 68 64 75 49 6e 44 46 59 79 57 6a 54 54 42 4c 4d 41 34 47 41 31 55 64 0a 44 77 45 42 2f 77 51 45 41 77 49 48 67 44 41 4d 42 67 4e 56 48 52 4d 42 41 66 38 45 41 6a 41 41 4d 43 73 47 41 31 55 64 49 77 51 6b 4d 43 4b 41 49 46 49 73 30 36 2b 37 6d 41 69 6f 73 41 78 39 0a 64 4a 4b 67 4e 43 70 50 44 39 43 5a 4c 54 44 4e 75 72 57 6c 36 6b 54 4c 5a 4f 79 76 4d 41 6f 47 43 43 71 47 53 4d 34 39 42 41 4d 43 41 30 67 41 4d 45 55 43 49 51 43 55 4e 33 4e 59 4a 58 6a 4c 0a 4d 43 70 48 4d 38 6f 5a 77 43 44 42 4e 7a 74 53 42 44 34 58 72 74 50 30 68 61 71 61 65 36 4d 67 36 41 49 67 58 57 31 2f 67 2f 4e 71 51 55 77 55 79 42 48 42 6b 4d 6f 49 67 5a 64 75 75 52 68 4e 0a 66 74 49 41 74 6f 76 70 38 45 50 57 77 59 49 3d 0a 2d 2d 2d 2d 2d 45 4e 44 20 43 45 52 54 49 46 49 43 41 54 45 2d 2d 2d 2d 2d 0a  cannot be validated. No MSP found able to do that.  2020-12-03 12:12:31.673 UTC  gossip.gossip  handleMessage -> WARN 47d0 Failed validating identity message: Peer Identity  0a 09 5a 68 75 68 61 69 4d 53 50 12 92 06 2d 2d 2d 2d 2d 42 45 47 49 4e 20 43 45 52 54 49 46 49 43 41 54 45 2d 2d 2d 2d 2d 0a 4d 49 49 43 46 7a 43 43 41 62 32 67 41 77 49 42 41 67 49 52 41 4c 49 6b 58 67 38 39 65 6a 73 31 79 70 4e 30 32 70 72 68 36 49 4d 77 43 67 59 49 4b 6f 5a 49 7a 6a 30 45 41 77 49 77 5a 7a 45 4c 0a 4d 41 6b 47 41 31 55 45 42 68 4d 43 56 56 4d 78 45 7a 41 52 42 67 4e 56 42 41 67 54 43 6b 4e 68 62 47 6c 6d 62 33 4a 75 61 57 45 78 46 6a 41 55 42 67 4e 56 42 41 63 54 44 56 4e 68 62 69 42 47 0a 63 6d 46 75 59 32 6c 7a 59 32 38 78 45 7a 41 52 42 67 4e 56 42 41 6f 54 43 6e 70 6f 64 57 68 68 61 53 35 6a 62 32 30 78 46 6a 41 55 42 67 4e 56 42 41 4d 54 44 57 4e 68 4c 6e 70 6f 64 57 68 68 0a 61 53 35 6a 62 32 30 77 48 68 63 4e 4d 6a 41 78 4d 6a 41 78 4d 44 55 31 4e 54 41 77 57 68 63 4e 4d 7a 41 78 4d 54 49 35 4d 44 55 31 4e 54 41 77 57 6a 42 6b 4d 51 73 77 43 51 59 44 56 51 51 47 0a 45 77 4a 56 55 7a 45 54 4d 42 45 47 41 31 55 45 43 42 4d 4b 51 32 46 73 61 57 5a 76 63 6d 35 70 59 54 45 57 4d 42 51 47 41 31 55 45 42 78 4d 4e 55 32 46 75 49 45 5a 79 59 57 35 6a 61 58 4e 6a 0a 62 7a 45 4e 4d 41 73 47 41 31 55 45 43 78 4d 45 63 47 56 6c 63 6a 45 5a 4d 42 63 47 41 31 55 45 41 78 4d 51 63 47 56 6c 63 6a 41 75 65 6d 68 31 61 47 46 70 4c 6d 4e 76 62 54 42 5a 4d 42 4d 47 0a 42 79 71 47 53 4d 34 39 41 67 45 47 43 43 71 47 53 4d 34 39 41 77 45 48 41 30 49 41 42 4a 72 75 2b 79 70 46 6c 58 39 76 55 2f 50 30 4a 61 6f 6d 64 34 77 6a 32 35 66 67 58 46 36 53 6d 49 39 33 0a 32 75 63 37 4f 4f 64 54 56 34 43 77 35 76 7a 44 59 4d 65 37 4a 53 33 4e 42 79 39 7a 35 68 43 42 48 72 56 66 30 48 70 42 2b 68 64 75 49 6e 44 46 59 79 57 6a 54 54 42 4c 4d 41 34 47 41 31 55 64 0a 44 77 45 42 2f 77 51 45 41 77 49 48 67 44 41 4d 42 67 4e 56 48 52 4d 42 41 66 38 45 41 6a 41 41 4d 43 73 47 41 31 55 64 49 77 51 6b 4d 43 4b 41 49 46 49 73 30 36 2b 37 6d 41 69 6f 73 41 78 39 0a 64 4a 4b 67 4e 43 70 50 44 39 43 5a 4c 54 44 4e 75 72 57 6c 36 6b 54 4c 5a 4f 79 76 4d 41 6f 47 43 43 71 47 53 4d 34 39 42 41 4d 43 41 30 67 41 4d 45 55 43 49 51 43 55 4e 33 4e 59 4a 58 6a 4c 0a 4d 43 70 48 4d 38 6f 5a 77 43 44 42 4e 7a 74 53 42 44 34 58 72 74 50 30 68 61 71 61 65 36 4d 67 36 41 49 67 58 57 31 2f 67 2f 4e 71 51 55 77 55 79 42 48 42 6b 4d 6f 49 67 5a 64 75 75 52 68 4e 0a 66 74 49 41 74 6f 76 70 38 45 50 57 77 59 49 3d 0a 2d 2d 2d 2d 2d 45 4e 44 20 43 45 52 54 49 46 49 43 41 54 45 2d 2d 2d 2d 2d 0a  cannot be validated. No MSP found able to do that. Failed verifying message github.com/hyperledger/fabric/gossip/gossip.(*certStore).validateIdentityMsg /opt/gopath/src/github.com/hyperledger/fabric/gossip/gossip/certstore.go:104 github.com/hyperledger/fabric/gossip/gossip.(*certStore).handleMessage /opt/gopath/src/github.com/hyperledger/fabric/gossip/gossip/certstore.go:76 github.com/hyperledger/fabric/gossip/gossip.(*gossipServiceImpl).handleMessage /opt/gopath/src/github.com/hyperledger/fabric/gossip/gossip/gossip_impl.go:405 github.com/hyperledger/fabric/gossip/gossip.(*gossipServiceImpl).acceptMessages /opt/gopath/src/github.com/hyperledger/fabric/gossip/gossip/gossip_impl.go:332 runtime.goexit /opt/go/src/runtime/asm_amd64.s:1333 github.com/hyperledger/fabric/gossip/gossip.(*certStore).handleMessage /opt/gopath/src/github.com/hyperledger/fabric/gossip/gossip/certstore.go:77 github.com/hyperledger/fabric/gossip/gossip.(*gossipServiceImpl).handleMessage /opt/gopath/src/github.com/hyperledger/fabric/gossip/gossip/gossip_impl.go:405 github.com/hyperledger/fabric/gossip/gossip.(*gossipServiceImpl).acceptMessages /opt/gopath/src/github.com/hyperledger/fabric/gossip/gossip/gossip_impl.go:332 runtime.goexit  ```  ></body> </Action>
<Action id="70917" issue="46388" author="yacovm" type="comment" body="Looks like your peer is behind a gRPC terminating proxy. Fabric doesn&apos;t support that" created="2020-12-07 08:10:47.0" updateauthor="yacovm" updated="2020-12-07 08:10:47.0"/>
<Action id="70918" issue="46388" author="zerppen" type="comment" created="2020-12-07 08:38:44.0" updateauthor="zerppen" updated="2020-12-07 08:39:53.0"> <body><! CDATA This problem is MembershipStore of gossipDiscoveryImpl should consider channel  isolation.  Then we can't connect Member that don't belong the channel.  ></body> </Action>
<Action id="70919" issue="46388" author="yacovm" type="comment" body="Please provide full logs of the peer when gossip is in debug." created="2020-12-07 08:56:47.0" updateauthor="yacovm" updated="2020-12-07 08:56:47.0"/>
<Action id="70920" issue="46388" author="zerppen" type="comment" created="2020-12-07 09:27:46.0" updateauthor="zerppen" updated="2020-12-07 09:27:46.0"> <body><! CDATA It's easy to repeat it and you can get all logs you want.  And what's more important is when executing  _NewDiscoveryService()_ should consider channel name.  ></body> </Action>
