<Issue id="31179" key="FAB-10714" number="10714" project="10002" reporter="sykesm" creator="sykesm" type="10003" summary="Data race between read and set of grpc.EnableTracing in deliver service" priority="4" resolution="10000" status="6" created="2018-06-19 16:00:04.0" updated="2018-07-20 14:16:59.0" resolutiondate="2018-07-02 12:06:40.0" votes="0" watches="1" workflowId="42483"> <description><! CDATA The connection factory is setting exported package level variable at a point in the process lifecycle without determinism. Other gRPC clients and/or servers may be running at the time the connection factory is called. {code:java} WARNING: DATA RACE Read at 0x00000583d002 by goroutine 64:   github.com/hyperledger/fabric/vendor/google.golang.org/grpc.NewServer()       /Users/sykesm/workspace/fabric/src/github.com/hyperledger/fabric/vendor/google.golang.org/grpc/server.go:342 +0x456   github.com/hyperledger/fabric/core/deliverservice/mocks.NewOrderer()       /Users/sykesm/workspace/fabric/src/github.com/hyperledger/fabric/core/deliverservice/mocks/orderer.go:34 +0x54   github.com/hyperledger/fabric/core/deliverservice.TestDeliverServiceRestart()       /Users/sykesm/workspace/fabric/src/github.com/hyperledger/fabric/core/deliverservice/deliveryclient_test.go:169 +0x5db   testing.tRunner()       /usr/local/Cellar/go/1.10.3/libexec/src/testing/testing.go:777 +0x16d  Previous write at 0x00000583d002 by goroutine 80:   github.com/hyperledger/fabric/core/deliverservice.DefaultConnectionFactory.func1()       /Users/sykesm/workspace/fabric/src/github.com/hyperledger/fabric/core/deliverservice/deliveryclient.go:265 +0x6b2   github.com/hyperledger/fabric/core/comm.(*connProducer).NewConnection()       /Users/sykesm/workspace/fabric/src/github.com/hyperledger/fabric/core/comm/producer.go:76 +0x477   github.com/hyperledger/fabric/core/deliverservice.(*broadcastClient).connect()       /Users/sykesm/workspace/fabric/src/github.com/hyperledger/fabric/core/deliverservice/client.go:139 +0xe4   github.com/hyperledger/fabric/core/deliverservice.(*broadcastClient).doAction()       /Users/sykesm/workspace/fabric/src/github.com/hyperledger/fabric/core/deliverservice/client.go:114 +0x106   github.com/hyperledger/fabric/core/deliverservice.(*broadcastClient).try()       /Users/sykesm/workspace/fabric/src/github.com/hyperledger/fabric/core/deliverservice/client.go:91 +0x18b   github.com/hyperledger/fabric/core/deliverservice.(*broadcastClient).Recv()       /Users/sykesm/workspace/fabric/src/github.com/hyperledger/fabric/core/deliverservice/client.go:58 +0x7b   github.com/hyperledger/fabric/core/deliverservice/blocksprovider.(*blocksProviderImpl).DeliverBlocks()       /Users/sykesm/workspace/fabric/src/github.com/hyperledger/fabric/core/deliverservice/blocksprovider/blocksprovider.go:131 +0xeb   github.com/hyperledger/fabric/core/deliverservice.(*deliverServiceImpl).launchBlockProvider()       /Users/sykesm/workspace/fabric/src/github.com/hyperledger/fabric/core/deliverservice/deliveryclient.go:179 +0x26f  Goroutine 64 (running) created at:   testing.(*T).Run()       /usr/local/Cellar/go/1.10.3/libexec/src/testing/testing.go:824 +0x564   testing.runTests.func1()       /usr/local/Cellar/go/1.10.3/libexec/src/testing/testing.go:1063 +0xa4   testing.tRunner()       /usr/local/Cellar/go/1.10.3/libexec/src/testing/testing.go:777 +0x16d   testing.runTests()       /usr/local/Cellar/go/1.10.3/libexec/src/testing/testing.go:1061 +0x4e1   testing.(*M).Run()       /usr/local/Cellar/go/1.10.3/libexec/src/testing/testing.go:978 +0x2cd   main.main()       _testmain.go:94 +0x22a  Goroutine 80 (running) created at:   github.com/hyperledger/fabric/core/deliverservice.(*deliverServiceImpl).StartDeliverForChannel()       /Users/sykesm/workspace/fabric/src/github.com/hyperledger/fabric/core/deliverservice/deliveryclient.go:166 +0x8b4   github.com/hyperledger/fabric/core/deliverservice.TestDeliverServiceRestart()       /Users/sykesm/workspace/fabric/src/github.com/hyperledger/fabric/core/deliverservice/deliveryclient_test.go:158 +0x3db   testing.tRunner()       /usr/local/Cellar/go/1.10.3/libexec/src/testing/testing.go:777 +0x16d{code} This can be resolved by moving the code that enables tracing.  ></description> </Issue>
