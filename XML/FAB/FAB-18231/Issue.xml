<Issue id="46106" key="FAB-18231" number="18231" project="10002" reporter="JIRAUSER20808" creator="JIRAUSER20808" type="10001" summary="getting an error while deploy chaincode " priority="3" resolution="10200" status="6" created="2020-09-14 10:03:43.0" updated="2020-09-15 13:18:42.0" resolutiondate="2020-09-15 13:18:42.0" votes="0" watches="2" workflowId="60006" archived="N"> <description><! CDATA Hi,  I got error message: Error: proposal failed with status: 500 - failed to invoke backing implementation of 'ApproveChaincodeDefinitionForMyOrg': could not fetch uncommitted definition: could not query metadata for namespace namespaces/mychaincode#1: GET_STATE failed: transaction ID: 7a7e278d77a527c946cb4dfd7bfe4b90f03cb7f6790cef27e5780fa2898d2b10: error handling CouchDB request. Error:not_found, Status Code:404, Reason:Database does not exist.  I deployed hf-v2.2.0 test-network on two hosts: * host1: ca-orderer, ca-org1, orderer, peer0.org1, couchdb * host2: ca-org2, peer0.org2, couchdb  Here is logs: {code:java} 2020-09-14 08:54:20.696 UTC  dockercontroller  buildImage -> DEBU e56c81 Created image: dev-peer0.org1.example.com-mychaincode_1-db86121c572e1fb07f27281fe56bcc5f1356661d46d6fa044602842312d1ed3c-4dca42a28922a40fe4217468d257da7925f8789c49717a2d88d7d8445a3e323e 2020-09-14 08:54:20.698 UTC  lifecycle  ProcessInstallEvent -> DEBU e56c82 ProcessInstallEvent() - localChaincode = &{mychaincode_1:db86121c572e1fb07f27281fe56bcc5f1356661d46d6fa044602842312d1ed3c golang wisekeycerts mychaincode_1} 2020-09-14 08:54:20.699 UTC  lifecycle  Work -> DEBU e56c83 skipping build of chaincode 'mychaincode_1:db86121c572e1fb07f27281fe56bcc5f1356661d46d6fa044602842312d1ed3c' as it is already in progress 2020-09-14 08:54:20.833 UTC  ccprovider  MetadataAsTarEntries -> DEBU e56c84 Created metadata tar 2020-09-14 08:54:20.833 UTC  lifecycle  InstallChaincode -> INFO e56c85 Successfully installed chaincode with package ID 'mychaincode_1:db86121c572e1fb07f27281fe56bcc5f1356661d46d6fa044602842312d1ed3c' 2020-09-14 08:54:20.833 UTC  chaincode  handleMessage -> DEBU e56c86  e511072a  Fabric side handling ChaincodeMessage of type: COMPLETED in state ready 2020-09-14 08:54:20.834 UTC  chaincode  Notify -> DEBU e56c87  e511072a  notifying Txid:e511072aa75b4d588c32a98956ec6d59e8b0d56d13ed25907eb7778b3dd6402c, channelID: 2020-09-14 08:54:20.834 UTC  chaincode  Execute -> DEBU e56c88 Exit 2020-09-14 08:54:20.834 UTC  endorser  callChaincode -> INFO e56c89 finished chaincode: _lifecycle duration: 23556ms channel= txID=e511072a 2020-09-14 08:54:20.834 UTC  comm.grpc.server  1 -> INFO e56c8a unary call completed grpc.service=protos.Endorser grpc.method=ProcessProposal grpc.peer_address=172.18.0.1:47662 grpc.code=OK grpc.call_duration=23.578819518s 2020-09-14 08:54:20.890 UTC  grpc  infof -> DEBU e56c8b transport: loopyWriter.run returning. connection error: desc = "transport is closing" 2020-09-14 08:54:20.894 UTC  grpc  infof -> DEBU e56c8c transport: loopyWriter.run returning. connection error: desc = "transport is closing" ...... 2020-09-14 08:54:43.649 UTC  statecouchdb  GetState -> DEBU e57141 GetState(). ns=_lifecycle, key=namespaces/metadata/mychaincode 2020-09-14 08:54:43.650 UTC  couchdb  readDoc -> DEBU e57142  mychannel__lifecycle  Entering ReadDoc()  id= namespaces/metadata/mychaincode  2020-09-14 08:54:43.650 UTC  couchdb  handleRequest -> DEBU e57143 Entering handleRequest()  method=GET  url=http://couchdb1:5984  dbName=mychannel__lifecycle 2020-09-14 08:54:43.651 UTC  couchdb  handleRequest -> DEBU e57144 Request URL: http://couchdb1:5984/mychannel__lifecycle/namespaces%2Fmetadata%2Fmychaincode?attachments=true 2020-09-14 08:54:43.660 UTC  couchdb  handleRequest -> DEBU e57145 Error handling CouchDB request. Error:not_found,  Status Code:404,  Reason:Database does not exist. 2020-09-14 08:54:43.663 UTC  couchdb  readDoc -> DEBU e57146  mychannel__lifecycle  Document not found (404), returning nil value instead of 404 error 2020-09-14 08:54:43.664 UTC  statecouchdb  GetState -> DEBU e57147 GetState(). ns=lscc, key=mychaincode 2020-09-14 08:54:43.664 UTC  couchdb  createDatabaseIfNotExist -> DEBU e57148  mychannel_lscc  Entering CreateDatabaseIfNotExist() 2020-09-14 08:54:43.664 UTC  couchdb  handleRequest -> DEBU e57149 Entering handleRequest()  method=GET  url=http://couchdb1:5984  dbName=mychannel_lscc 2020-09-14 08:54:43.664 UTC  couchdb  handleRequest -> DEBU e5714a Request URL: http://couchdb1:5984/mychannel_lscc 2020-09-14 08:54:43.667 UTC  couchdb  handleRequest -> DEBU e5714b Error handling CouchDB request. Error:not_found,  Status Code:404,  Reason:Database does not exist. 2020-09-14 08:54:43.667 UTC  couchdb  createDatabaseIfNotExist -> DEBU e5714c  mychannel_lscc  Database does not exist. 2020-09-14 08:54:43.667 UTC  couchdb  handleRequest -> DEBU e5714d Entering handleRequest()  method=PUT  url=http://couchdb1:5984  dbName=mychannel_lscc 2020-09-14 08:54:43.667 UTC  couchdb  handleRequest -> DEBU e5714e Request URL: http://couchdb1:5984/mychannel_lscc 2020-09-14 08:54:43.718 UTC  gossip.gossip  handleMessage -> DEBU e5714f Entering, 10.0.1.134:34862 43c2d606b286c081fb27ef65ddf7a04ec195eb66a2c0e3cc69ecf07a9d13bc13 sent us GossipMessage: Channel: , nonce: 0, tag: CHAN_OR_ORG state_info_pull_req: Channel MAC:36531ebb9d59de386d5ec3d779852120c966d93da8bc7fc335bb0df5e83a0ed0, Envelope: 39 bytes, Signature: 0 bytes 2020-09-14 08:54:43.718 UTC  msp  DeserializeIdentity -> DEBU e57150 Obtaining identity 2020-09-14 08:54:43.718 UTC  msp  DeserializeIdentity -> DEBU e57151 Obtaining identity 2020-09-14 08:54:43.719 UTC  gossip.gossip  handleMessage -> DEBU e57152 Exiting 2020-09-14 08:54:43.752 UTC  couchdb  handleRequest -> DEBU e57153 Exiting handleRequest() 2020-09-14 08:54:43.753 UTC  couchdb  createDatabaseIfNotExist -> INFO e57154 Created state database mychannel_lscc 2020-09-14 08:54:43.753 UTC  couchdb  applyDatabaseSecurity -> DEBU e57155  mychannel_lscc  Entering ApplyDatabaseSecurity() 2020-09-14 08:54:43.753 UTC  couchdb  applyDatabaseSecurity -> DEBU e57156  mychannel_lscc  Applying security to database: {"admins":{"names": "admin" ,"roles":  },"members":{"names": "admin" ,"roles":  }} 2020-09-14 08:54:43.753 UTC  couchdb  handleRequest -> DEBU e57157 Entering handleRequest()  method=PUT  url=http://couchdb1:5984  dbName=mychannel_lscc 2020-09-14 08:54:43.753 UTC  couchdb  handleRequest -> DEBU e57158 Request URL: http://couchdb1:5984/mychannel_lscc/_security 2020-09-14 08:54:43.795 UTC  couchdb  handleRequest -> DEBU e57159 Exiting handleRequest() 2020-09-14 08:54:43.796 UTC  couchdb  applyDatabaseSecurity -> DEBU e5715a  mychannel_lscc  Exiting ApplyDatabaseSecurity() 2020-09-14 08:54:43.796 UTC  couchdb  createDatabaseIfNotExist -> DEBU e5715b  mychannel_lscc  Exiting CreateDatabaseIfNotExist() 2020-09-14 08:54:43.796 UTC  couchdb  readDoc -> DEBU e5715c  mychannel_lscc  Entering ReadDoc()  id= mychaincode  2020-09-14 08:54:43.796 UTC  couchdb  handleRequest -> DEBU e5715d Entering handleRequest()  method=GET  url=http://couchdb1:5984  dbName=mychannel_lscc 2020-09-14 08:54:43.796 UTC  couchdb  handleRequest -> DEBU e5715e Request URL: http://couchdb1:5984/mychannel_lscc/mychaincode?attachments=true 2020-09-14 08:54:43.798 UTC  couchdb  handleRequest -> DEBU e5715f Error handling CouchDB request. Error:not_found,  Status Code:404,  Reason:missing 2020-09-14 08:54:43.798 UTC  couchdb  readDoc -> DEBU e57160  mychannel_lscc  Document not found (404), returning nil value instead of 404 error 2020-09-14 08:54:43.804 UTC  lifecycle  ApproveChaincodeDefinitionForMyOrg -> DEBU e57161 received invocation of ApproveChaincodeDefinitionForMyOrg on channel 'mychannel' for definition 'sequence: 1, endorsement info: (version: '1', plugin: '', init required: true), validation info: (plugin: '', policy: ''), collections: ()' 2020-09-14 08:54:43.805 UTC  chaincode  handleMessage -> DEBU e57162  7a7e278d  Fabric side handling ChaincodeMessage of type: GET_STATE in state ready 2020-09-14 08:54:43.805 UTC  chaincode  HandleTransaction -> DEBU e57163  7a7e278d  handling GET_STATE from chaincode 2020-09-14 08:54:43.805 UTC  chaincode  HandleGetState -> DEBU e57164  7a7e278d  getting state for chaincode _lifecycle, key namespaces/fields/mychaincode/Sequence, channel mychannel 2020-09-14 08:54:43.805 UTC  statecouchdb  GetState -> DEBU e57165 GetState(). ns=_lifecycle, key=namespaces/fields/mychaincode/Sequence 2020-09-14 08:54:43.805 UTC  couchdb  readDoc -> DEBU e57166  mychannel__lifecycle  Entering ReadDoc()  id= namespaces/fields/mychaincode/Sequence  2020-09-14 08:54:43.806 UTC  couchdb  handleRequest -> DEBU e57167 Entering handleRequest()  method=GET  url=http://couchdb1:5984  dbName=mychannel__lifecycle 2020-09-14 08:54:43.806 UTC  couchdb  handleRequest -> DEBU e57168 Request URL: http://couchdb1:5984/mychannel__lifecycle/namespaces%2Ffields%2Fmychaincode%2FSequence?attachments=true 2020-09-14 08:54:43.807 UTC  couchdb  handleRequest -> DEBU e57169 Error handling CouchDB request. Error:not_found,  Status Code:404,  Reason:Database does not exist. 2020-09-14 08:54:43.808 UTC  couchdb  readDoc -> DEBU e5716a  mychannel__lifecycle  Document not found (404), returning nil value instead of 404 error 2020-09-14 08:54:43.808 UTC  chaincode  HandleGetState -> DEBU e5716b  7a7e278d  No state associated with key: namespaces/fields/mychaincode/Sequence. Sending RESPONSE with an empty payload 2020-09-14 08:54:43.808 UTC  chaincode  HandleTransaction -> DEBU e5716c  7a7e278d  Completed GET_STATE. Sending RESPONSE 2020-09-14 08:54:43.808 UTC  chaincode  handleMessage -> DEBU e5716d  7a7e278d  Fabric side handling ChaincodeMessage of type: GET_STATE in state ready 2020-09-14 08:54:43.809 UTC  chaincode  HandleTransaction -> DEBU e5716e  7a7e278d  handling GET_STATE from chaincode 2020-09-14 08:54:43.809 UTC  chaincode  HandleGetState -> DEBU e5716f  7a7e278d  getting state for chaincode _lifecycle, key namespaces/metadata/mychaincode#1, channel mychannel 2020-09-14 08:54:43.810 UTC  msp  GetManagerForChain -> DEBU e57170 Returning existing manager for channel 'mychannel' 2020-09-14 08:54:43.811 UTC  lockbasedtxmgr  retrieveCollConfigFromStateDB -> DEBU e57171 retrieveCollConfigFromStateDB() begin - ns= _lifecycle  2020-09-14 08:54:43.814 UTC  lockbasedtxmgr  retrieveCollConfigFromStateDB -> DEBU e57172 retrieveCollConfigFromStateDB() successfully retrieved - ns= _lifecycle , confPkg= config:<static_collection_config:<name:"_implicit_org_Org2MSP" member_orgs_policy:<signature_policy:<rule:<n_out_of:<n:1 rules:<signed_by:0 > > > identities:<principal:"\n\007Org2MSP" > > > > > config:<static_collection_config:<name:"_implicit_org_Org1MSP" member_orgs_policy:<signature_policy:<rule:<n_out_of:<n:1 rules:<signed_by:0 > > > identities:<principal:"\n\007Org1MSP" > > > maximum_peer_count:1 > >   2020-09-14 08:54:43.815 UTC  statecouchdb  GetState -> DEBU e57173 GetState(). ns=_lifecycle$$p_implicit_org_Org1MSP, key=namespaces/metadata/mychaincode#1 2020-09-14 08:54:43.815 UTC  statecouchdb  getNamespaceDBHandle -> DEBU e57174  mychannel  add namespaceDBInfo for namespace _lifecycle$$p_implicit_org_Org1MSP 2020-09-14 08:54:43.815 UTC  couchdb  saveDoc -> DEBU e57175  mychannel_  Entering SaveDoc() id= channel_metadata  2020-09-14 08:54:43.816 UTC  couchdb  readDoc -> DEBU e57176  mychannel_  Entering ReadDoc()  id= channel_metadata  2020-09-14 08:54:43.816 UTC  couchdb  handleRequest -> DEBU e57177 Entering handleRequest()  method=GET  url=http://couchdb1:5984  dbName=mychannel_ 2020-09-14 08:54:43.816 UTC  couchdb  handleRequest -> DEBU e57178 Request URL: http://couchdb1:5984/mychannel_/channel_metadata?attachments=true 2020-09-14 08:54:43.817 UTC  couchdb  handleRequest -> DEBU e57179 Error handling CouchDB request. Error:not_found,  Status Code:404,  Reason:Database does not exist. 2020-09-14 08:54:43.817 UTC  couchdb  readDoc -> DEBU e5717a  mychannel_  Document not found (404), returning nil value instead of 404 error 2020-09-14 08:54:43.817 UTC  couchdb  handleRequest -> DEBU e5717b Entering handleRequest()  method=PUT  url=http://couchdb1:5984  dbName=mychannel_ 2020-09-14 08:54:43.818 UTC  couchdb  handleRequest -> DEBU e5717c Request URL: http://couchdb1:5984/mychannel_/channel_metadata 2020-09-14 08:54:43.819 UTC  couchdb  handleRequest -> DEBU e5717d Error handling CouchDB request. Error:not_found,  Status Code:404,  Reason:Database does not exist. 2020-09-14 08:54:43.820 UTC  chaincode  HandleTransaction -> ERRO e5717e  7a7e278d  Failed to handle GET_STATE. error: error handling CouchDB request. Error:not_found,  Status Code:404,  Reason:Database does not exist. github.com/hyperledger/fabric/core/ledger/kvledger/txmgmt/statedb/statecouchdb.(*couchInstance).handleRequest 	/go/src/github.com/hyperledger/fabric/core/ledger/kvledger/txmgmt/statedb/statecouchdb/couchdb.go:1812 github.com/hyperledger/fabric/core/ledger/kvledger/txmgmt/statedb/statecouchdb.(*couchDatabase).handleRequestWithRevisionRetry 	/go/src/github.com/hyperledger/fabric/core/ledger/kvledger/txmgmt/statedb/statecouchdb/couchdb.go:1596 github.com/hyperledger/fabric/core/ledger/kvledger/txmgmt/statedb/statecouchdb.(*couchDatabase).saveDoc 	/go/src/github.com/hyperledger/fabric/core/ledger/kvledger/txmgmt/statedb/statecouchdb/couchdb.go:579 github.com/hyperledger/fabric/core/ledger/kvledger/txmgmt/statedb/statecouchdb.(*VersionedDB).writeChannelMetadata 	/go/src/github.com/hyperledger/fabric/core/ledger/kvledger/txmgmt/statedb/statecouchdb/statecouchdb.go:831 github.com/hyperledger/fabric/core/ledger/kvledger/txmgmt/statedb/statecouchdb.(*VersionedDB).getNamespaceDBHandle 	/go/src/github.com/hyperledger/fabric/core/ledger/kvledger/txmgmt/statedb/statecouchdb/statecouchdb.go:252 github.com/hyperledger/fabric/core/ledger/kvledger/txmgmt/statedb/statecouchdb.(*VersionedDB).readFromDB 	/go/src/github.com/hyperledger/fabric/core/ledger/kvledger/txmgmt/statedb/statecouchdb/statecouchdb.go:439 github.com/hyperledger/fabric/core/ledger/kvledger/txmgmt/statedb/statecouchdb.(*VersionedDB).GetState 	/go/src/github.com/hyperledger/fabric/core/ledger/kvledger/txmgmt/statedb/statecouchdb/statecouchdb.go:419 github.com/hyperledger/fabric/core/ledger/kvledger/txmgmt/privacyenabledstate.(*DB).GetPrivateData 	/go/src/github.com/hyperledger/fabric/core/ledger/kvledger/txmgmt/privacyenabledstate/db.go:186 github.com/hyperledger/fabric/core/ledger/kvledger/txmgmt/txmgr.(*queryExecutor).GetPrivateData 	/go/src/github.com/hyperledger/fabric/core/ledger/kvledger/txmgmt/txmgr/query_executor.go:205 github.com/hyperledger/fabric/core/chaincode.(*Handler).HandleGetState 	/go/src/github.com/hyperledger/fabric/core/chaincode/handler.go:613 github.com/hyperledger/fabric/core/chaincode.(*Handler).HandleTransaction 	/go/src/github.com/hyperledger/fabric/core/chaincode/handler.go:244 runtime.goexit 	/usr/local/go/src/runtime/asm_amd64.s:1373 github.com/hyperledger/fabric/core/chaincode.(*Handler).HandleGetState 	/go/src/github.com/hyperledger/fabric/core/chaincode/handler.go:618 github.com/hyperledger/fabric/core/chaincode.(*Handler).HandleTransaction 	/go/src/github.com/hyperledger/fabric/core/chaincode/handler.go:244 runtime.goexit 	/usr/local/go/src/runtime/asm_amd64.s:1373 GET_STATE failed: transaction ID: 7a7e278d77a527c946cb4dfd7bfe4b90f03cb7f6790cef27e5780fa2898d2b10 github.com/hyperledger/fabric/core/chaincode.(*Handler).HandleTransaction 	/go/src/github.com/hyperledger/fabric/core/chaincode/handler.go:248 runtime.goexit 	/usr/local/go/src/runtime/asm_amd64.s:1373 2020-09-14 08:54:43.820 UTC  chaincode  HandleTransaction -> DEBU e5717f  7a7e278d  Completed GET_STATE. Sending ERROR 2020-09-14 08:54:43.820 UTC  chaincode  handleMessage -> DEBU e57180  7a7e278d  Fabric side handling ChaincodeMessage of type: COMPLETED in state ready 2020-09-14 08:54:43.820 UTC  chaincode  Notify -> DEBU e57181  7a7e278d  notifying Txid:7a7e278d77a527c946cb4dfd7bfe4b90f03cb7f6790cef27e5780fa2898d2b10, channelID:mychannel 2020-09-14 08:54:43.820 UTC  chaincode  Execute -> DEBU e57182 Exit 2020-09-14 08:54:43.821 UTC  endorser  callChaincode -> INFO e57183 finished chaincode: _lifecycle duration: 175ms channel=mychannel txID=7a7e278d {code}   What i did wrong?  ></description> </Issue>
