<Issue id="43950" key="FAB-17372" number="17372" project="10002" reporter="wlahti" assignee="wlahti" creator="wlahti" type="10004" summary="lifecycle cache should remove local chaincode reference when new definition is committed with new chaincode package" priority="3" resolution="10000" status="6" created="2020-01-10 14:38:17.0" updated="2020-01-15 14:35:29.0" resolutiondate="2020-01-15 14:35:29.0" votes="0" watches="2" workflowId="57811"> <description><! CDATA When installing a chaincode package "my_simple_chaincode", committing a definition with name "mycc" and version "0.0", I see the expected output from the "queryinstalled" command, which gets its data from the lifecycle cache:  {code:java}  o  peer-lifecycle-chaincode-queryinstalled  {  o  peer-lifecycle-chaincode-queryinstalled  	"installed_chaincodes":    o  peer-lifecycle-chaincode-queryinstalled  		{  o  peer-lifecycle-chaincode-queryinstalled  			"package_id": "my_simple_chaincode:ab63d153fc8ac7ceb225cf365b6e8021a1e8086b773e0004fb0f629ba10ee169",  o  peer-lifecycle-chaincode-queryinstalled  			"label": "my_simple_chaincode",  o  peer-lifecycle-chaincode-queryinstalled  			"references": {  o  peer-lifecycle-chaincode-queryinstalled  				"testchannel": {  o  peer-lifecycle-chaincode-queryinstalled  					"chaincodes":    o  peer-lifecycle-chaincode-queryinstalled  						{  o  peer-lifecycle-chaincode-queryinstalled  							"name": "mycc",  o  peer-lifecycle-chaincode-queryinstalled  							"version": "0.0"  o  peer-lifecycle-chaincode-queryinstalled  						}  o  peer-lifecycle-chaincode-queryinstalled  					   o  peer-lifecycle-chaincode-queryinstalled  				}  o  peer-lifecycle-chaincode-queryinstalled  			}  o  peer-lifecycle-chaincode-queryinstalled  		},  o  peer-lifecycle-chaincode-queryinstalled  		{  o  peer-lifecycle-chaincode-queryinstalled  			"package_id": "my_simple_chaincode_updated:7ec88ede74e904886aefd3ee77949706e5569dda4d198772fd87f2b8a0a6a68a",  o  peer-lifecycle-chaincode-queryinstalled  			"label": "my_simple_chaincode_updated"  o  peer-lifecycle-chaincode-queryinstalled  		}  o  peer-lifecycle-chaincode-queryinstalled  	   o  peer-lifecycle-chaincode-queryinstalled  } {code} Then, after installing an updated chaincode package "my_simple_chaincode_updated" and updating the chaincode definition for "mycc" to version "1.0",  the lifecycle cache is inadvertently updating the references for both chaincode packages: {code:java}  o  peer-lifecycle-chaincode-queryinstalled  {  o  peer-lifecycle-chaincode-queryinstalled  	"installed_chaincodes":    o  peer-lifecycle-chaincode-queryinstalled  		{  o  peer-lifecycle-chaincode-queryinstalled  			"package_id": "my_simple_chaincode:ab63d153fc8ac7ceb225cf365b6e8021a1e8086b773e0004fb0f629ba10ee169",  o  peer-lifecycle-chaincode-queryinstalled  			"label": "my_simple_chaincode",  o  peer-lifecycle-chaincode-queryinstalled  			"references": {  o  peer-lifecycle-chaincode-queryinstalled  				"testchannel": {  o  peer-lifecycle-chaincode-queryinstalled  					"chaincodes":    o  peer-lifecycle-chaincode-queryinstalled  						{  o  peer-lifecycle-chaincode-queryinstalled  							"name": "mycc",  o  peer-lifecycle-chaincode-queryinstalled  							"version": "1.0"  o  peer-lifecycle-chaincode-queryinstalled  						}  o  peer-lifecycle-chaincode-queryinstalled  					   o  peer-lifecycle-chaincode-queryinstalled  				}  o  peer-lifecycle-chaincode-queryinstalled  			}  o  peer-lifecycle-chaincode-queryinstalled  		},  o  peer-lifecycle-chaincode-queryinstalled  		{  o  peer-lifecycle-chaincode-queryinstalled  			"package_id": "my_simple_chaincode_upgraded:7ec88ede74e904886aefd3ee77949706e5569dda4d198772fd87f2b8a0a6a68a",  o  peer-lifecycle-chaincode-queryinstalled  			"label": "my_simple_chaincode_updated",  o  peer-lifecycle-chaincode-queryinstalled  			"references": {  o  peer-lifecycle-chaincode-queryinstalled  				"testchannel": {  o  peer-lifecycle-chaincode-queryinstalled  					"chaincodes":    o  peer-lifecycle-chaincode-queryinstalled  						{  o  peer-lifecycle-chaincode-queryinstalled  							"name": "mycc",  o  peer-lifecycle-chaincode-queryinstalled  							"version": "1.0"  o  peer-lifecycle-chaincode-queryinstalled  						}  o  peer-lifecycle-chaincode-queryinstalled  					   o  peer-lifecycle-chaincode-queryinstalled  				}  o  peer-lifecycle-chaincode-queryinstalled  			}  o  peer-lifecycle-chaincode-queryinstalled  		}  o  peer-lifecycle-chaincode-queryinstalled  	   o  peer-lifecycle-chaincode-queryinstalled  }  {code} The lifecycle cache should be updated to remove the reference to "mycc" for the original chaincode package ("my_simple_chaincode").  ></description> </Issue>
