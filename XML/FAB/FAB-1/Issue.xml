<Issue id="12251" key="FAB-1" number="1" project="10002" reporter="bgorman" assignee="bgorman" creator="bgorman" type="10004" summary="`make images` results in goimports failures" environment="Windows 7, running vagrant VM with commit level 0716064b25428ea2426fa589db365c419726b24b" priority="4" resolution="10000" status="6" created="2016-07-28 05:40:02.0" updated="2018-08-27 12:01:26.0" resolutiondate="2016-08-12 01:52:06.0" votes="0" watches="3" timeoriginalestimate="3600" timeestimate="3600" workflowId="35986"> <description><! CDATA When running `make images` on a cleanly provisioned vagrant VM, I often run into goimports causing fatal errors in the build.  From manually running goimports across some of the files it seems all of the files in "vendor" have not been added to the $GOPATH. Goimports seems to assume, if it cannot find the source files, that the package names will be based off the directory name. The go-logging package does not meet this, as its package name is "logging". The spf13/viper package is also not found, but uses the expected package name, thus is not removed by goimports.  Short of being able to install the "vendor" files into the $GOPATH (I'm not sure if this is desired or not) prior to running goimports, this can be worked around by explicitly labeling go-logging with a custom package name of "logging".   E.g.  import ( logging "github.com/op/go-logging" )  ------------------- build/bin/peer CGO_CFLAGS=" " CGO_LDFLAGS="-lrocksdb -lstdc++ -lm -lz -lbz2 -lsnappy" GOBIN=/hyperledger/build/bin go install github.com/hyperledger/fabric/peer Binary available as build/bin/peer build/bin/membersrvc CGO_CFLAGS=" " CGO_LDFLAGS="-lrocksdb -lstdc++ -lm -lz -lbz2 -lsnappy" GOBIN=/hyperledger/build/bin go install github.com/hyperledger/fabric/membersrvc Binary available as build/bin/membersrvc cd gotools && make make 1 : Entering directory `/hyperledger/gotools' make 2 : Entering directory `/hyperledger/gotools' Building gomega go get github.com/onsi/gomega make 2 : Leaving directory `/hyperledger/gotools' make 1 : Leaving directory `/hyperledger/gotools' LINT: Running code checks.. Running go vet go vet ./consensus/... go vet ./core/... go vet ./events/... go vet ./examples/... go vet ./membersrvc/... go vet ./peer/... go vet ./protos/... Running goimports The following files contain goimports errors consensus/controller/controller.go consensus/executor/executor.go consensus/executor/executor_test.go consensus/helper/handler.go consensus/noops/noops.go consensus/pbft/batch.go consensus/pbft/fuzz_test.go consensus/pbft/pbft-core.go consensus/pbft/pbft-core_test.go consensus/util/events/events.go consensus/util/messagefan.go The goimports command must be run for these files The following files contain goimports errors core/admin.go core/chaincode/config.go core/chaincode/handler.go core/chaincode/platforms/golang/hash.go core/chaincode/shim/chaincode.go core/chaincode/shim/shim_test.go core/comm/connection.go core/config/config.go core/config.go core/container/config.go core/container/dockercontroller/dockercontroller.go core/container/dockercontroller/dockercontroller_test.go core/container/inproccontroller/inproccontroller.go core/container/util/dockerutil.go core/container/util/writer.go core/container/vm.go core/crypto/client_tca.go core/crypto/crypto_settings.go core/crypto/crypto_settings_test.go core/crypto/crypto_test.go core/crypto/node_eca.go core/crypto/node_tlsca.go core/db/db.go core/devops.go core/ledger/blockchain_indexes.go core/ledger/genesis/genesis.go core/ledger/ledger.go core/ledger/perf_test.go core/ledger/perfstat/stat_holder.go core/ledger/statemgmt/buckettree/bucket_cache_test.go core/ledger/statemgmt/buckettree/perf_test.go core/ledger/statemgmt/buckettree/state_impl.go core/ledger/statemgmt/commons.go core/ledger/statemgmt/state/state.go core/ledger/statemgmt/trie/state_trie.go core/ledger/test/ledger_suite_test.go core/ledger/testutil/test_util.go core/logging.go core/logging_test.go core/peer/peer.go core/peer/statetransfer/statetransfer.go core/peer/statetransfer/statetransfer_test.go core/rest/api.go core/rest/api_test.go core/rest/rest_api.go core/system_chaincode/api/sysccapi.go core/system_chaincode/config.go The goimports command must be run for these files The following files contain goimports errors events/config.go events/producer/producer.go The goimports command must be run for these files The following files contain goimports errors examples/chaincode/go/asset_management/app/app.go examples/chaincode/go/asset_management/app/app_internal.go examples/chaincode/go/asset_management/asset_management.go examples/chaincode/go/asset_management02/asset_management02.go examples/chaincode/go/asset_management02/asset_management02_test.go examples/chaincode/go/asset_management_with_roles/asset_management_with_roles.go examples/chaincode/go/asset_management_with_roles/asset_management_with_roles_test.go examples/chaincode/go/chaincode_example02/chaincode_example02_test.go examples/chaincode/go/chaincode_example03/chaincode_example03_test.go examples/chaincode/go/chaincode_example04/chaincode_example04_test.go examples/chaincode/go/chaincode_example05/chaincode_example05_test.go examples/chaincode/go/rbac_tcerts_no_attrs/rbac.go examples/chaincode/go/rbac_tcerts_no_attrs/rbac_test.go The goimports command must be run for these files The following files contain goimports errors membersrvc/ca/aca.go membersrvc/ca/aca_test.go membersrvc/ca/eca_test.go membersrvc/ca/ecap.go membersrvc/ca/tca_test.go membersrvc/ca/tcap.go membersrvc/ca/tlsca_test.go The goimports command must be run for these files The following files contain goimports errors peer/main.go The goimports command must be run for these files The following files contain goimports errors protos/init.go The goimports command must be run for these files ------------------  vagrant@hyperledger-devenv:v0.0.10-0716064:/hyperledger$ goimports -v -d events/config.go 2016/07/28 04:53:21.992158 fixImports(filename="events/config.go"), abs="/hyperledger/events/config.go", srcDir="/hyperledger/events" ... 2016/07/28 04:53:21.993427 importPathToNameGoPathParse("github.com/op/go-logging", srcDir="/hyperledger/events") = "", cannot find package "github.com/op/go-logging" in any of: /opt/go/src/github.com/op/go-logging (from $GOROOT) /opt/gopath/src/github.com/op/go-logging (from $GOPATH) 2016/07/28 04:53:21.994737 importPathToNameGoPathParse("github.com/spf13/viper", srcDir="/hyperledger/events") = "", cannot find package "github.com/spf13/viper" in any of: /opt/go/src/github.com/spf13/viper (from $GOROOT) /opt/gopath/src/github.com/spf13/viper (from $GOPATH) 2016/07/28 04:53:21.995069 open /opt/gopath/src/.goimportsignore: no such file or directory 2016/07/28 04:53:21.995241 scanning $GOPATH 2016/07/28 04:53:21.995489 scanning $GOROOT 2016/07/28 04:53:22.019560 scanned $GOROOT 2016/07/28 04:53:22.408786 scanned $GOPATH diff events/config.go gofmt/events/config.go --- /tmp/gofmt583448441 2016-07-28 04:53:22.443013329 +0000 +++ /tmp/gofmt079091332 2016-07-28 04:53:22.443013329 +0000 @@ -22,7 +22,6 @@ "runtime" "strings"  -       "github.com/op/go-logging" "github.com/spf13/viper" ) ---------------------------  ></description> </Issue>
