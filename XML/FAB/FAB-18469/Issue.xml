<Issue id="46848" key="FAB-18469" number="18469" project="10002" reporter="denyeart" assignee="JIRAUSER20852" creator="denyeart" type="10004" summary="NewSnapshotReader returns nil error if file doesn&apos;t exist" priority="3" status="3" created="2021-05-08 10:28:22.0" updated="2021-05-14 19:05:43.0" votes="0" watches="1" workflowId="60749" archived="N"> <description><! CDATA When testing ledger snapshot comparison, I found that it panics if you provide as input a file that does not exist:    {code:java} panic: runtime error: invalid memory address or nil pointer dereference  signal SIGSEGV: segmentation violation code=0x1 addr=0x8 pc=0x1524d26  goroutine 1  running : github.com/hyperledger/fabric/core/ledger/kvledger/txmgmt/privacyenabledstate.(*SnapshotReader).Next(0x0, 0x0, 0x0, 0xc0000e4280, 0x0, 0x0) /Users/denyeart/work/src/github.com/hyperledger/fabric/core/ledger/kvledger/txmgmt/privacyenabledstate/snapshot.go:503 +0x26 github.com/hyperledger/fabric/internal/ledger.Compare(0x7ffeefbff997, 0x43, 0x7ffeefbff9db, 0x4b, 0x16c4950, 0xd, 0x0, 0x0) /Users/denyeart/work/src/github.com/hyperledger/fabric/internal/ledger/compare.go:71 +0x5f1 main.main() /Users/denyeart/work/src/github.com/hyperledger/fabric/cmd/ledger/main.go:42 +0x259 {code}    The issue seems to be that the NewSnapshotReader() returns a nil error here:   https://github.com/hyperledger/fabric/blob/main/core/ledger/kvledger/txmgmt/privacyenabledstate/snapshot.go#L443-L446  {code:java}  	exist, _, err := fileutil.FileExists(dataFilePath) 	if err != nil || !exist { 		return nil, err 	} {code}  In the case of file !exist, it should create a new error and return it, rather than return the nil error.  A test should also be added to snapshot_test.go to cover file does not exist scenario.  ></description> </Issue>
