<Issue id="36076" key="FAB-13240" number="13240" project="10002" reporter="dongming" assignee="manish-sethi" creator="dongming" type="10004" summary="peer panic when adding a new private data collection member" priority="2" resolution="10000" status="6" created="2018-12-11 21:53:02.0" updated="2018-12-19 16:57:02.0" resolutiondate="2018-12-12 01:17:35.0" votes="0" watches="5" workflowId="47591"> <description><! CDATA Peer panic when install/upgrade chaincode to add an org to existing privateDB.   ~suryalnvs  will attach peer logs to the bug.  Not sure what triggered the panic, but we just noticed it some time later in the logs of two peers, both in org5. Created a network with 5 orgs, 2 peers per org. Installed and instantiated one chaincode in all peers with cc version 0. Orgs 1-4 (not 5) are all using the private collection. Installed cc versions 1, then 2, then 3, on the peers in orgs 1-4 (not 5) and upgraded one by one. Finally installed cc version 4 on ALL peers, and upgraded. Somewhere along the way, the peer panicked. Hopefully this might give some helpful insight.        Panic seeing in the committer peers: {code:java} 2018-12-11 20:28:04.912 UTC  committer.txvalidator  Validate -> INFO 2262  testorgschannel1  Validated block  2868  in 10ms2018-12-11 20:28:04.912 UTC  committer.txvalidator  Validate -> INFO 2262  testorgschannel1  Validated block  2868  in 10ms2018-12-11 20:28:04.918 UTC  cceventmgmt  HandleStateUpdates -> INFO 2263 Channel  testorgschannel1 : Handling deploy or update of chaincode  map_cc_ch1 2018-12-11 20:28:04.925 UTC  pvtdatastorage  processCollElgEvents -> INFO 2264 Converting missing data entries from ineligible to eligible for  ns=map_cc_ch1, coll=collection-FAB-12743 panic: runtime error: slice bounds out of range goroutine 288  running :github.com/hyperledger/fabric/core/ledger/util.DecodeReverseOrderVarUint64(0xc0042091b2, 0x2, 0x2, 0x14, 0xc003c78680) /opt/gopath/src/github.com/hyperledger/fabric/core/ledger/util/uint64_encoding.go:45 +0x106github.com/hyperledger/fabric/core/ledger/pvtdatastorage.decodeMissingDataKey(0xc004209191, 0x24, 0x2f, 0x20) /opt/gopath/src/github.com/hyperledger/fabric/core/ledger/pvtdatastorage/kv_encoding.go:135 +0x38cgithub.com/hyperledger/fabric/core/ledger/pvtdatastorage.(*store).processCollElgEvents(0xc0002c9320, 0x1388, 0x3e8) /opt/gopath/src/github.com/hyperledger/fabric/core/ledger/pvtdatastorage/store_impl.go:873 +0x55cgithub.com/hyperledger/fabric/core/ledger/pvtdatastorage.(*store).launchCollElgProc.func1(0xc0002c9320, 0x1388, 0x3e8) /opt/gopath/src/github.com/hyperledger/fabric/core/ledger/pvtdatastorage/store_impl.go:838 +0xb9created by github.com/hyperledger/fabric/core/ledger/pvtdatastorage.(*store).launchCollElgProc /opt/gopath/src/github.com/hyperledger/fabric/core/ledger/pvtdatastorage/store_impl.go:833 +0x65 {code}    ></description> </Issue>
