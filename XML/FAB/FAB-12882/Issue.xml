<Issue id="35388" key="FAB-12882" number="12882" project="10002" reporter="sykesm" assignee="yacovm" creator="sykesm" type="10004" summary="intermittent test failure in orderer/common/cluster" priority="3" resolution="10000" status="6" created="2018-11-15 14:45:38.0" updated="2019-03-19 10:57:22.0" resolutiondate="2018-12-04 17:54:51.0" votes="0" watches="2" workflowId="46853"> <description><! CDATA While running {{make unit-test}} locally, I have hit this failure (panic after failing to receive block) two or three times in the past day.  {code} 2018-11-15 09:39:53.283 EST  test  fetchLastBlockSeq -> INFO 001 127.0.0.1:62706 is at block sequence of 10 2018-11-15 09:39:53.283 EST  test  connectToSomeEndpoint -> INFO 002 Connected to 127.0.0.1:62706 with last block seq of 10 2018-11-15 09:39:53.284 EST  test  obtainStream -> INFO 003 Sending request for block 5 to 127.0.0.1:62706 2018-11-15 09:39:53.285 EST  test  pullBlocks -> INFO 004 Got block 5 of size 0KB from 127.0.0.1:62706 2018-11-15 09:39:53.285 EST  test  pullBlocks -> INFO 005 Got block 6 of size 0KB from 127.0.0.1:62706 2018-11-15 09:39:53.286 EST  test  pullBlocks -> INFO 006 Got block 7 of size 0KB from 127.0.0.1:62706 2018-11-15 09:39:53.286 EST  test  pullBlocks -> INFO 007 Got block 8 of size 0KB from 127.0.0.1:62706 2018-11-15 09:39:53.286 EST  test  pullBlocks -> INFO 008 Got block 9 of size 0KB from 127.0.0.1:62706 2018-11-15 09:39:53.287 EST  test  pullBlocks -> INFO 009 Got block 10 of size 0KB from 127.0.0.1:62706 2018-11-15 09:39:53.293 EST  test  fetchLastBlockSeq -> INFO 00a 127.0.0.1:62708 is at block sequence of 3 2018-11-15 09:39:53.294 EST  test  fetchLastBlockSeq -> INFO 00b 127.0.0.1:62708 is at block sequence of 3 2018-11-15 09:39:53.294 EST  test  byEndpoints -> WARN 00c Duplicate endpoint found(127.0.0.1:62708), skipping it 2018-11-15 09:39:53.295 EST  test  connectToSomeEndpoint -> INFO 00d Connected to 127.0.0.1:62708 with last block seq of 3 2018-11-15 09:39:53.295 EST  test  obtainStream -> INFO 00e Sending request for block 1 to 127.0.0.1:62708 2018-11-15 09:39:53.296 EST  test  pullBlocks -> INFO 00f Got block 1 of size 0KB from 127.0.0.1:62708 2018-11-15 09:39:53.296 EST  test  pullBlocks -> INFO 010 Got block 2 of size 0KB from 127.0.0.1:62708 2018-11-15 09:39:53.297 EST  test  pullBlocks -> INFO 011 Got block 3 of size 0KB from 127.0.0.1:62708 2018-11-15 09:39:53.302 EST  test  fetchLastBlockSeq -> INFO 012 127.0.0.1:62711 is at block sequence of 100 2018-11-15 09:39:53.302 EST  test  connectToSomeEndpoint -> INFO 013 Connected to 127.0.0.1:62711 with last block seq of 100 2018-11-15 09:39:53.302 EST  test  obtainStream -> INFO 014 Sending request for block 1 to 127.0.0.1:62711 2018-11-15 09:39:53.304 EST  test  pullBlocks -> INFO 015 Got block 1 of size 1KB from 127.0.0.1:62711 2018-11-15 09:39:53.304 EST  test  pullBlocks -> INFO 016 Got block 2 of size 1KB from 127.0.0.1:62711 2018-11-15 09:39:53.304 EST  test  pullBlocks -> INFO 017 Got block 3 of size 1KB from 127.0.0.1:62711 2018-11-15 09:39:53.305 EST  test  pullBlocks -> INFO 018 Got block 4 of size 1KB from 127.0.0.1:62711 2018-11-15 09:39:53.305 EST  test  pullBlocks -> INFO 019 Got block 5 of size 1KB from 127.0.0.1:62711 2018-11-15 09:39:53.305 EST  test  pullBlocks -> INFO 01a Got block 6 of size 1KB from 127.0.0.1:62711 2018-11-15 09:39:53.306 EST  test  pullBlocks -> INFO 01b Got block 7 of size 1KB from 127.0.0.1:62711 2018-11-15 09:39:53.306 EST  test  pullBlocks -> INFO 01c Got block 8 of size 1KB from 127.0.0.1:62711 2018-11-15 09:39:53.307 EST  test  pullBlocks -> INFO 01d Got block 9 of size 1KB from 127.0.0.1:62711 2018-11-15 09:39:53.307 EST  test  pullBlocks -> INFO 01e Got block 10 of size 1KB from 127.0.0.1:62711 2018-11-15 09:39:53.309 EST  test  pullBlocks -> INFO 01f Got block 11 of size 1KB from 127.0.0.1:62711 2018-11-15 09:39:53.309 EST  test  pullBlocks -> INFO 020 Got block 12 of size 1KB from 127.0.0.1:62711 2018-11-15 09:39:53.310 EST  test  pullBlocks -> INFO 021 Got block 13 of size 1KB from 127.0.0.1:62711 2018-11-15 09:39:53.310 EST  test  pullBlocks -> INFO 022 Got block 14 of size 1KB from 127.0.0.1:62711 2018-11-15 09:39:53.311 EST  test  pullBlocks -> INFO 023 Got block 15 of size 1KB from 127.0.0.1:62711 2018-11-15 09:39:53.311 EST  test  pullBlocks -> INFO 024 Got block 16 of size 1KB from 127.0.0.1:62711 2018-11-15 09:39:53.312 EST  test  pullBlocks -> INFO 025 Got block 17 of size 1KB from 127.0.0.1:62711 2018-11-15 09:39:53.312 EST  test  pullBlocks -> INFO 026 Got block 18 of size 1KB from 127.0.0.1:62711 2018-11-15 09:39:53.312 EST  test  pullBlocks -> INFO 027 Got block 19 of size 1KB from 127.0.0.1:62711 2018-11-15 09:39:53.313 EST  test  pullBlocks -> INFO 028 Got block 20 of size 1KB from 127.0.0.1:62711 2018-11-15 09:39:53.314 EST  test  pullBlocks -> INFO 029 Got block 21 of size 1KB from 127.0.0.1:62711 2018-11-15 09:39:53.314 EST  test  pullBlocks -> INFO 02a Got block 22 of size 1KB from 127.0.0.1:62711 2018-11-15 09:39:53.314 EST  test  pullBlocks -> INFO 02b Got block 23 of size 1KB from 127.0.0.1:62711 2018-11-15 09:39:53.315 EST  test  pullBlocks -> INFO 02c Got block 24 of size 1KB from 127.0.0.1:62711 2018-11-15 09:39:53.315 EST  test  pullBlocks -> INFO 02d Got block 25 of size 1KB from 127.0.0.1:62711 2018-11-15 09:39:53.315 EST  test  pullBlocks -> INFO 02e Got block 26 of size 1KB from 127.0.0.1:62711 2018-11-15 09:39:53.316 EST  test  pullBlocks -> INFO 02f Got block 27 of size 1KB from 127.0.0.1:62711 2018-11-15 09:39:53.316 EST  test  pullBlocks -> INFO 030 Got block 28 of size 1KB from 127.0.0.1:62711 2018-11-15 09:39:53.316 EST  test  pullBlocks -> INFO 031 Got block 29 of size 1KB from 127.0.0.1:62711 2018-11-15 09:39:53.317 EST  test  pullBlocks -> INFO 032 Got block 30 of size 1KB from 127.0.0.1:62711 2018-11-15 09:39:53.317 EST  test  pullBlocks -> INFO 033 Got block 31 of size 1KB from 127.0.0.1:62711 2018-11-15 09:39:53.318 EST  test  pullBlocks -> INFO 034 Got block 32 of size 1KB from 127.0.0.1:62711 2018-11-15 09:39:53.318 EST  test  pullBlocks -> INFO 035 Got block 33 of size 1KB from 127.0.0.1:62711 2018-11-15 09:39:53.318 EST  test  pullBlocks -> INFO 036 Got block 34 of size 1KB from 127.0.0.1:62711 2018-11-15 09:39:53.319 EST  test  pullBlocks -> INFO 037 Got block 35 of size 1KB from 127.0.0.1:62711 2018-11-15 09:39:53.319 EST  test  pullBlocks -> INFO 038 Got block 36 of size 1KB from 127.0.0.1:62711 2018-11-15 09:39:53.319 EST  test  pullBlocks -> INFO 039 Got block 37 of size 1KB from 127.0.0.1:62711 2018-11-15 09:39:53.319 EST  test  pullBlocks -> INFO 03a Got block 38 of size 1KB from 127.0.0.1:62711 2018-11-15 09:39:53.320 EST  test  pullBlocks -> INFO 03b Got block 39 of size 1KB from 127.0.0.1:62711 2018-11-15 09:39:53.320 EST  test  pullBlocks -> INFO 03c Got block 40 of size 1KB from 127.0.0.1:62711 2018-11-15 09:39:53.321 EST  test  pullBlocks -> INFO 03d Got block 41 of size 1KB from 127.0.0.1:62711 2018-11-15 09:39:53.322 EST  test  pullBlocks -> INFO 03e Got block 42 of size 1KB from 127.0.0.1:62711 2018-11-15 09:39:53.322 EST  test  pullBlocks -> INFO 03f Got block 43 of size 1KB from 127.0.0.1:62711 2018-11-15 09:39:53.322 EST  test  pullBlocks -> INFO 040 Got block 44 of size 1KB from 127.0.0.1:62711 2018-11-15 09:39:53.323 EST  test  pullBlocks -> INFO 041 Got block 45 of size 1KB from 127.0.0.1:62711 2018-11-15 09:39:53.323 EST  test  pullBlocks -> INFO 042 Got block 46 of size 1KB from 127.0.0.1:62711 2018-11-15 09:39:53.323 EST  test  pullBlocks -> INFO 043 Got block 47 of size 1KB from 127.0.0.1:62711 2018-11-15 09:39:53.324 EST  test  pullBlocks -> INFO 044 Got block 48 of size 1KB from 127.0.0.1:62711 2018-11-15 09:39:53.324 EST  test  pullBlocks -> INFO 045 Got block 49 of size 1KB from 127.0.0.1:62711 2018-11-15 09:39:53.324 EST  test  pullBlocks -> INFO 046 Got block 50 of size 1KB from 127.0.0.1:62711 2018-11-15 09:39:53.329 EST  test  fetchLastBlockSeq -> INFO 047 127.0.0.1:62714 is at block sequence of 100 2018-11-15 09:39:53.330 EST  test  connectToSomeEndpoint -> INFO 048 Connected to 127.0.0.1:62714 with last block seq of 100 2018-11-15 09:39:53.330 EST  test  obtainStream -> INFO 049 Sending request for block 1 to 127.0.0.1:62714 2018-11-15 09:39:53.331 EST  test  pullBlocks -> INFO 04a Got block 1 of size 0KB from 127.0.0.1:62714 2018-11-15 09:39:54.333 EST  test  fetchLastBlockSeq -> ERRO 04b Failed receiving the latest block from 127.0.0.1:62714: didn't receive a response within 1s 2018-11-15 09:39:54.334 EST  test  connectToSomeEndpoint -> WARN 04c Could not connect to any endpoint of  127.0.0.1:62714  panic: runtime error: invalid memory address or nil pointer dereference  signal SIGSEGV: segmentation violation code=0x1 addr=0x0 pc=0x49f2524   goroutine 144  running : github.com/hyperledger/fabric/orderer/common/cluster_test.(*deliverServer).addExpectPullAssert.func1(0xc000383800) 	/Users/sykesm/workspace/fabric/src/github.com/hyperledger/fabric/orderer/common/cluster/deliver_test.go:225 +0x174 github.com/hyperledger/fabric/orderer/common/cluster_test.(*deliverServer).Deliver(0xc0001f97c0, 0x4d555a0, 0xc0004c13a0, 0x4d431c0, 0xc0001f97c0) 	/Users/sykesm/workspace/fabric/src/github.com/hyperledger/fabric/orderer/common/cluster/deliver_test.go:163 +0x1a1 github.com/hyperledger/fabric/protos/orderer._AtomicBroadcast_Deliver_Handler(0x4bdd3e0, 0xc0001f97c0, 0x4d53860, 0xc0002f8420, 0x5e58670, 0xc0002071a0) 	/Users/sykesm/workspace/fabric/src/github.com/hyperledger/fabric/protos/orderer/ab.pb.go:714 +0xce github.com/hyperledger/fabric/vendor/google.golang.org/grpc.(*Server).processStreamingRPC(0xc000001e00, 0x4d56680, 0xc00045f500, 0xc00039e100, 0xc00031f1a0, 0x547dba0, 0x0, 0x0, 0x0) 	/Users/sykesm/workspace/fabric/src/github.com/hyperledger/fabric/vendor/google.golang.org/grpc/server.go:1124 +0x11e1 github.com/hyperledger/fabric/vendor/google.golang.org/grpc.(*Server).handleStream(0xc000001e00, 0x4d56680, 0xc00045f500, 0xc00039e100, 0x0) 	/Users/sykesm/workspace/fabric/src/github.com/hyperledger/fabric/vendor/google.golang.org/grpc/server.go:1212 +0x1319 github.com/hyperledger/fabric/vendor/google.golang.org/grpc.(*Server).serveStreams.func1.1(0xc000175bf0, 0xc000001e00, 0x4d56680, 0xc00045f500, 0xc00039e100) 	/Users/sykesm/workspace/fabric/src/github.com/hyperledger/fabric/vendor/google.golang.org/grpc/server.go:686 +0xad created by github.com/hyperledger/fabric/vendor/google.golang.org/grpc.(*Server).serveStreams.func1 	/Users/sykesm/workspace/fabric/src/github.com/hyperledger/fabric/vendor/google.golang.org/grpc/server.go:684 +0xb9 FAIL	github.com/hyperledger/fabric/orderer/common/cluster	1.698s {code}  /cc  ~kchristidis   ></description> </Issue>
