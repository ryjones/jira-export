<Action id="58208" issue="38522" author="yacovm" type="comment" created="2019-03-15 17:11:28.0" updateauthor="yacovm" updated="2019-03-15 17:11:28.0"> <body><! CDATA {quote}We also did a test with fixed incoming TPS=100 for 90 min. This test passed. {quote}    At what TPS it stops working?  ></body> </Action>
<Action id="58209" issue="38522" author="yacovm" type="comment" body="and can we please get some more information, like - the logs of the leader and the follower that intercepted the service unavailable ? I presume the log in the description is the follower. Can we have the logs of the leader too?" created="2019-03-15 17:15:00.0" updateauthor="yacovm" updated="2019-03-15 17:15:00.0"/>
<Action id="58212" issue="38522" author="dongming" type="comment" created="2019-03-15 19:50:43.0" updateauthor="dongming" updated="2019-03-15 19:50:43.0"> <body><! CDATA  ~yacovm  I did two test on the system with 108 orderers using local storage with tx payload=8B 1. fixed incoming rate, TPS=100 for 90 min, this test passed: PTE receives events for all transactions. 2. send the tx as soon as possible, the first time passed with TPS=638, 2nd time failed.  I will post logs of leader and the follower once I gather them.  ></body> </Action>
<Action id="58214" issue="38522" author="dongming" type="comment" body="Attached loader and follower log, see108-2orderers.log, where the leader is orderer12-ordererorg4, and follower is orderer7-ordererorg2." created="2019-03-15 20:04:52.0" updateauthor="dongming" updated="2019-03-15 20:04:52.0"/>
<Action id="58215" issue="38522" author="yacovm" type="comment" body="All I see in  ^108-2orderers.log  are logs of comm.grpc.server ... where are the cluster and etcdraft logs?" created="2019-03-15 20:09:43.0" updateauthor="yacovm" updated="2019-03-15 20:09:43.0"/>
<Action id="58221" issue="38522" author="guoger" type="comment" created="2019-03-16 03:11:27.0" updateauthor="guoger" updated="2019-03-16 03:11:27.0"> <body><! CDATA I'm seeing this in that timeframe: {code} Mar 15 02:49:02 2019-03-14 18:49:02.809 UTC  orderer.common.broadcast  ProcessMessage -> WARN 3ce2  channel: testorgschannel1  Rejecting broadcast of normal message from 10.191.5.91:49804 with SERVICE_UNAVAILABLE: rejected by Order: stream aborted Mar 15 02:49:02 2019-03-14 18:49:02.809 UTC  comm.grpc.server  1 -> INFO 3ce3 streaming call completed grpc.service=orderer.AtomicBroadcast grpc.method=Broadcast grpc.peer_address=10.191.5.91:49804 grpc.code=OK grpc.call_duration=5.620683066s Mar 15 02:49:02 2019-03-14 18:49:02.810 UTC  orderer.common.cluster.step  sendMessage -> WARN 3ce4 Stream 2 to orderer2-ordererorg2.ordererorg2(orderer2-ordererorg2:7050) was forcibly terminated because timeout (7s) expired {code} on orderer7-ordererorg2  ></body> </Action>
<Action id="58228" issue="38522" author="yacovm" type="comment" created="2019-03-16 12:37:17.0" updateauthor="yacovm" updated="2019-03-16 12:37:17.0"> <body><! CDATA {quote}2. send the tx as soon as possible, the first time passed with TPS=638, 2nd time failed. {quote}    Let's try something - do 3 runs with every combination with the following changes that includes at least one of them (meaning- \{(01), (10), (11)} ): *  MaxInflightMsgs|https://gerrit.hyperledger.org/r/#/c/30018/10/sampleconfig/configtx.yaml  (in the future it's MaxInflightBlocks) is 5 by default. Let's set it to 1. *  RPCTimeout|https://gerrit.hyperledger.org/r/#/c/29717/2/sampleconfig/orderer.yaml  - make it 30s instead of the default 7s.  ></body> </Action>
<Action id="58257" issue="38522" author="dongming" type="comment" created="2019-03-18 15:06:18.0" updateauthor="dongming" updated="2019-03-18 15:06:18.0"> <body><! CDATA  ~yacovm  Will do the 3 runs as you suggested.  Another data point, I did a run with 54 threads hitting 54 orderers instead of all 108 orderers few times and did NOT see the SERVICE_UNAVAILABLE issue.  So it seems the burst traffic is a factor.  ></body> </Action>
<Action id="58295" issue="38522" author="dongming" type="comment" created="2019-03-19 14:02:58.0" updateauthor="dongming" updated="2019-03-19 14:02:58.0"> <body><! CDATA  ~yacovm  I executed the same test with MaxInflightMsgs=1 twice successfully without the "SERVICE_UNAVAILABLE" issue. TPS=729.35 and 745.59 resp.  Do you think we need to run the test with RPCTimeout?  ></body> </Action>
<Action id="58298" issue="38522" author="yacovm" type="comment" created="2019-03-19 15:30:03.0" updateauthor="yacovm" updated="2019-03-19 15:30:03.0"> <body><! CDATA  ~jyellick  ^   ?  ></body> </Action>
<Action id="58305" issue="38522" author="dongming" type="comment" body="close the issue per conversation with Jason" created="2019-03-19 17:37:44.0" updateauthor="dongming" updated="2019-03-19 17:37:44.0"/>
