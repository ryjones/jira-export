<Issue id="45268" key="FAB-17994" number="17994" project="10002" reporter="denyeart" assignee="btl5037" creator="denyeart" type="10003" summary="Support v3.x CouchDB users database" priority="3" resolution="10000" status="6" created="2020-06-15 16:18:25.0" updated="2020-06-26 15:22:31.0" resolutiondate="2020-06-26 15:22:31.0" votes="0" watches="1" workflowId="59181" archived="N"> <description><! CDATA An admin id/password is required starting in v3.x. Upon first start peer creates CouchDB users database and updates its security object. This is not supported in CouchDB v3.x, it returns error "You can't edit the security object of the user database."  {code:java} 2020-06-15 12:14:14.120 EDT  couchdb  VerifyCouchConfig -> DEBU 024 VerifyConnection() dbResponseJSON: %s 2020-06-15 12:14:14.120 EDT  couchdb  CreateDatabaseIfNotExist -> DEBU 025  _users  Entering CreateDatabaseIfNotExist() 2020-06-15 12:14:14.120 EDT  couchdb  handleRequest -> DEBU 026 Entering handleRequest() method=GET url=http://127.0.0.1:5984 dbName=_users 2020-06-15 12:14:14.120 EDT  couchdb  handleRequest -> DEBU 027 Request URL: http://127.0.0.1:5984/_users 2020-06-15 12:14:14.120 EDT  couchdb  handleRequest -> DEBU 028 HTTP Request: GET /_users HTTP/1.1 | Host: 127.0.0.1:5984 | User-Agent: Go-http-client/1.1 | Accept: multipart/related | Authorization: Basic YWRtaW46cGFzc3dvcmQ= | Accept-Encoding: gzip | |  2020-06-15 12:14:14.127 EDT  couchdb  handleRequest -> DEBU 029 Error handling CouchDB request. Error:not_found, Status Code:404, Reason:Database does not exist. 2020-06-15 12:14:14.127 EDT  couchdb  CreateDatabaseIfNotExist -> DEBU 02a  _users  Database does not exist. 2020-06-15 12:14:14.127 EDT  couchdb  handleRequest -> DEBU 02b Entering handleRequest() method=PUT url=http://127.0.0.1:5984 dbName=_users 2020-06-15 12:14:14.127 EDT  couchdb  handleRequest -> DEBU 02c Request URL: http://127.0.0.1:5984/_users 2020-06-15 12:14:14.127 EDT  couchdb  handleRequest -> DEBU 02d HTTP Request: PUT /_users HTTP/1.1 | Host: 127.0.0.1:5984 | User-Agent: Go-http-client/1.1 | Content-Length: 0 | Accept: application/json | Authorization: Basic YWRtaW46cGFzc3dvcmQ= | Content-Type: application/json | Accept-Encoding: gzip | |  2020-06-15 12:14:14.190 EDT  couchdb  handleRequest -> DEBU 02e Exiting handleRequest() 2020-06-15 12:14:14.190 EDT  couchdb  ApplyDatabaseSecurity -> DEBU 02f  _users  Entering ApplyDatabaseSecurity() 2020-06-15 12:14:14.190 EDT  couchdb  ApplyDatabaseSecurity -> DEBU 030  _users  Applying security to database: \{"admins":{"names": "admin" ,"roles":  },"members":\{"names": "admin" ,"roles":  }} 2020-06-15 12:14:14.190 EDT  couchdb  handleRequest -> DEBU 031 Entering handleRequest() method=PUT url=http://127.0.0.1:5984 dbName=_users 2020-06-15 12:14:14.190 EDT  couchdb  handleRequest -> DEBU 032 Request URL: http://127.0.0.1:5984/_users/_security 2020-06-15 12:14:14.191 EDT  couchdb  handleRequest -> DEBU 033 HTTP Request: PUT /_users/_security HTTP/1.1 | Host: 127.0.0.1:5984 | User-Agent: Go-http-client/1.1 | Content-Length: 82 | Accept: application/json | Authorization: Basic YWRtaW46cGFzc3dvcmQ= | Content-Type: application/json | Accept-Encoding: gzip | |  2020-06-15 12:14:14.207 EDT  couchdb  handleRequest -> DEBU 034 Error handling CouchDB request. Error:forbidden, Status Code:403, Reason:You can't edit the security object of the user database. {code}   ></description> </Issue>
