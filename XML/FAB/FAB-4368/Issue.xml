<Issue id="17492" key="FAB-4368" number="4368" project="10002" reporter="markparz" assignee="markparz" creator="markparz" type="10004" summary="Doc workaround for policy checker in FAB-4248" priority="4" resolution="10000" status="6" created="2017-06-05 14:39:32.0" updated="2018-07-20 14:13:08.0" resolutiondate="2017-06-15 21:18:39.0" votes="0" watches="1" workflowId="38819" security="10001"> <description><! CDATA Need to doc work around in troubleshooting section. Corner case issue in policy endorsement based on admin vs member in FAB-4248  As noted by  ~jimthematrix   from my observation when  ~xixuejia  showed me the behavior of the policy checker, this is what I think is happening: - you have two endorsements: endorser1 as a member in org1 (E1) and endorser2 as an admin in org1 (E2) - you have the endorsement policy: "AND (org1.member, org1.admin)"  so the policy should be met. but what we observed was that depending on the order of the two MSP principals in the endorsement policy, the policy checking can fail. and this is why it's failing: - the code iterates over the principals, so it takes the first one in the array: org1.member - it then iterates over the endorsers  E2, E1  and tries to find which one satisfies the target principal: org1.member - so it takes the first identity from the array, E2, and see that it satisfies the principal org1.member (since admin is a member) - it now marks E2 as used - it then moves on to the next principal: org1.admin - and tries to iterate over the endorsers to match any unused identities, which is now E1 - because E1 is not an admin, it'll mark the policy check as failed  on the other hand, if the endorsers array is set to a different order:  E1, E2 , then the above checking logic will succeed or if the endorsement policy is specified as "AND  org1.admin, org1.member , the checking will also succeed  in fact, the workaround I suggested to the testing team is to always specify admin identity in the policy before the member identity of the same org, which will always work regardless of the order of the endorsers. This can be used as a recommended workaround for v1.0 in case the fix is difficult. but if the fix is straightforward enough, we should get it in.  ></description> </Issue>
