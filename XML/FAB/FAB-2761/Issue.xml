<Issue id="15329" key="FAB-2761" number="2761" project="10002" reporter="aambati" assignee="aambati" creator="aambati" type="10004" summary="Enrollment request with bad authentication header succeeds (it should fail)" priority="3" resolution="10000" status="6" created="2017-03-13 14:48:46.0" updated="2018-07-20 14:11:59.0" resolutiondate="2017-03-15 15:50:25.0" votes="0" watches="1" timeoriginalestimate="28800" timeestimate="28800" workflowId="37777"> <description><! CDATA If authType == basic and a bogus authorization header is sent , fcaAuthHandler serveHTTP function will allow the request through, instead of returning an error.  For example: curl -X POST -H "Authorization:blah" http://fabrica-ca-server-hostname:7055/enroll -d '{"hosts":null,"certificate_request":"-----BEGIN CERTIFICATE REQUEST-----\nMIIBATCBqQIBADAQMQ4wDAYDVQQDEwVhZG1pbjBZMBMGByqGSM49AgEGCCqGSM49\nAwEHA0IABCK1am728KdO0iOeJuK3+Z05T9Mw2rxmQO3SIMfiGEJ56GZvcP/iN/z5\np43hTiF5do98O0DtByD37b4bCdJ/3l+gNzA1BgkqhkiG9w0BCQ4xKDAmMCQGA1Ud\nEQQdMBuCGWFuaWxzLW1icC5yYWxlaWdoLmlibS5jb20wCgYIKoZIzj0EAwIDRwAw\nRAIgIeZDliMQEX9+uqZXCcLvAfRUXoBzg/74jZQReaHmWKMCIAovDiMdrmbSIzT5\nlDSknJdgXMST2HF9SoRzHewuR6cL\n-----END CERTIFICATE REQUEST-----\n","profile":"","crl_override":"","label":""}' will succeed even though authorization header is invalid  Keith Smith suggested this: We should add an enroll test case for this and make sure the test case fails before fixing it.  To add this test case, I recommend adding a testBogusAuthHeader test case to lib/client_test.go by copying the Client.Enroll func and changing this line: "post.SetBasicAuth(req.Name, req.Secret)" to add the bogus authorization header instead.  To fix the code in this function, I recommend just changing the logic to a switch statement based on ah.authType just to make the 3 cases more explicit and easy to follow logic, each being self-contained.  ></description> </Issue>
