<Issue id="33020" key="FAB-11642" number="11642" project="10002" reporter="yacovm" assignee="ronenschafferibm" creator="yacovm" type="10003" summary="Address data races in gossip/service" priority="3" resolution="10000" status="6" created="2018-08-17 22:00:42.0" updated="2019-06-20 12:23:53.0" resolutiondate="2019-06-20 12:23:53.0" votes="0" watches="4" workflowId="44225"> <description><! CDATA {quote} ================== WARNING: DATA RACE Write at 0x00c00058b5d0 by goroutine 1632: github.com/hyperledger/fabric/vendor/google.golang.org/grpc.(*clientStream).CloseSend() /Users/bartem/golang/src/github.com/hyperledger/fabric/vendor/google.golang.org/grpc/stream.go:751 +0x5e github.com/hyperledger/fabric/protos/gossip.(*gossipGossipStreamClient).CloseSend() <autogenerated>:1 +0x62 github.com/hyperledger/fabric/gossip/comm.(*connection).close() /Users/bartem/golang/src/github.com/hyperledger/fabric/gossip/comm/conn.go:239 +0x1d6 github.com/hyperledger/fabric/gossip/comm.(*connectionStore).onConnected() /Users/bartem/golang/src/github.com/hyperledger/fabric/gossip/comm/conn.go:169 +0x189 github.com/hyperledger/fabric/gossip/comm.(*commImpl).GossipStream() /Users/bartem/golang/src/github.com/hyperledger/fabric/gossip/comm/comm_impl.go:580 +0x3bf github.com/hyperledger/fabric/protos/gossip._Gossip_GossipStream_Handler() /Users/bartem/golang/src/github.com/hyperledger/fabric/protos/gossip/message.pb.go:2758 +0xcd github.com/hyperledger/fabric/vendor/google.golang.org/grpc.(*Server).processStreamingRPC() /Users/bartem/golang/src/github.com/hyperledger/fabric/vendor/google.golang.org/grpc/server.go:1170 +0x1602 github.com/hyperledger/fabric/vendor/google.golang.org/grpc.(*Server).handleStream() /Users/bartem/golang/src/github.com/hyperledger/fabric/vendor/google.golang.org/grpc/server.go:1249 +0x130c github.com/hyperledger/fabric/vendor/google.golang.org/grpc.(*Server).serveStreams.func1.1() /Users/bartem/golang/src/github.com/hyperledger/fabric/vendor/google.golang.org/grpc/server.go:685 +0xac  Previous read at 0x00c00058b5d0 by goroutine 1506: github.com/hyperledger/fabric/vendor/google.golang.org/grpc.(*clientStream).SendMsg() /Users/bartem/golang/src/github.com/hyperledger/fabric/vendor/google.golang.org/grpc/stream.go:668 +0xf8 github.com/hyperledger/fabric/protos/gossip.(*gossipGossipStreamClient).Send() /Users/bartem/golang/src/github.com/hyperledger/fabric/protos/gossip/message.pb.go:2725 +0x6a github.com/hyperledger/fabric/gossip/comm.(*connection).writeToStream() /Users/bartem/golang/src/github.com/hyperledger/fabric/gossip/comm/conn.go:314 +0x1fc  Goroutine 1632 (running) created at: github.com/hyperledger/fabric/vendor/google.golang.org/grpc.(*Server).serveStreams.func1() /Users/bartem/golang/src/github.com/hyperledger/fabric/vendor/google.golang.org/grpc/server.go:683 +0xb8 github.com/hyperledger/fabric/vendor/google.golang.org/grpc/internal/transport.(*http2Server).operateHeaders() /Users/bartem/golang/src/github.com/hyperledger/fabric/vendor/google.golang.org/grpc/internal/transport/http2_server.go:419 +0x1481 github.com/hyperledger/fabric/vendor/google.golang.org/grpc/internal/transport.(*http2Server).HandleStreams() /Users/bartem/golang/src/github.com/hyperledger/fabric/vendor/google.golang.org/grpc/internal/transport/http2_server.go:459 +0x37a github.com/hyperledger/fabric/vendor/google.golang.org/grpc.(*Server).serveStreams() /Users/bartem/golang/src/github.com/hyperledger/fabric/vendor/google.golang.org/grpc/server.go:681 +0x170 github.com/hyperledger/fabric/vendor/google.golang.org/grpc.(*Server).handleRawConn.func1() /Users/bartem/golang/src/github.com/hyperledger/fabric/vendor/google.golang.org/grpc/server.go:643 +0x50  Goroutine 1506 (finished) created at: github.com/hyperledger/fabric/gossip/comm.(*connection).serviceConnection() /Users/bartem/golang/src/github.com/hyperledger/fabric/gossip/comm/conn.go:288 +0x12c {quote}  ></description> </Issue>
