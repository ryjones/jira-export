<Action id="70788" issue="45292" author="denyeart" type="comment" created="2020-11-23 20:44:38.0" updateauthor="denyeart" updated="2020-11-23 20:44:38.0"> <body><! CDATA With the default at warmIndexesAfterNBlocks: 1, we'll see the index get warmed after block commit, as evidenced in the peer and couchdb logs:  Peer log entries with "couchdb" debug: {code:java} 2020-11-23 15:29:27.996 EST  couchdb  warmIndexAllIndexes -> DEBU 69a  mychannel_marbles  Entering WarmIndexAllIndexes() 2020-11-23 15:29:27.996 EST  couchdb  listIndex -> DEBU 69c  mychannel_marbles  Entering ListIndex() 2020-11-23 15:29:27.996 EST  couchdb  handleRequest -> DEBU 6a0 Request URL: http://127.0.0.1:5984/mychannel_marbles/_index 2020-11-23 15:29:28.005 EST  couchdb  listIndex -> DEBU 6a6  mychannel_marbles  Exiting ListIndex() 2020-11-23 15:29:28.005 EST  couchdb  warmIndex -> DEBU 6a7  mychannel_marbles  Entering WarmIndex() designdoc=indexOwnerDoc indexname=indexOwner 2020-11-23 15:29:28.006 EST  couchdb  handleRequest -> DEBU 6a9 Request URL: http://127.0.0.1:5984/mychannel_marbles/_design/indexOwnerDoc/_view/indexOwner?stale=update_after{code}    Couchdb log entries:    {code:java}  info  2020-11-23T20:29:28.012350Z nonode@nohost <0.4156.0> -------- Starting index update for db: shards/80000000-ffffffff/mychannel_marbles.1606163331 idx: _design/indexOwnerDoc  notice  2020-11-23T20:29:28.019118Z nonode@nohost <0.3570.0> c009f28c7c 127.0.0.1:5984 172.17.0.1 admin GET /mychannel_marbles/_index 200 ok 7  info  2020-11-23T20:29:28.062627Z nonode@nohost <0.4156.0> -------- Index update finished for db: shards/80000000-ffffffff/mychannel_marbles.1606163331 idx: _design/indexOwnerDoc  notice  2020-11-23T20:29:28.094637Z nonode@nohost <0.3570.0> 87b0a1e83d 127.0.0.1:5984 172.17.0.1 admin GET /mychannel_marbles/_design/indexOwnerDoc/_view/indexOwner?stale=update_after 200 ok 74{code}  ></body> </Action>
<Action id="70789" issue="45292" author="denyeart" type="comment" created="2020-11-23 21:01:01.0" updateauthor="denyeart" updated="2020-11-23 21:01:01.0"> <body><! CDATA Approach:  With warmIndexesAfterNBlocks=0, create a large number of entries in CouchDB 2.3.1 state database.  Perform a JSON _find query that requires an index. In the CouchDB logs, you should see the data was not indexed until the query executes for the first time. The query will delay while the index builds.  Do the same trial using CouchDB 3.1.1. In the CouchDB logs, you should see the data gets indexed as blocks are committed.  The first JSON _find query should be quick this time, since the index is already built.  Identify optimal automatic index settings in CouchDB, per the CouchDB release notes, "Many configuration parameters are available".  Once automatic indexing is confirmed, the index warming code can then be removed from Fabric block commit logic.  ></body> </Action>
<Action id="71307" issue="45292" author="denyeart" type="comment" body="https://github.com/hyperledger/fabric/pull/2252" created="2021-01-25 14:33:21.0" updateauthor="denyeart" updated="2021-01-25 14:33:21.0"/>
