<Issue id="34165" key="FAB-12205" number="12205" project="10002" reporter="sykesm" assignee="sykesm" creator="sykesm" type="10004" summary="Data race exposed by orderer/consensus/solo/consensus TestOrdererBenchmarkSolo" priority="4" resolution="10000" status="6" created="2018-09-27 17:44:29.0" updated="2018-11-19 07:00:29.0" resolutiondate="2018-09-28 15:59:11.0" votes="0" watches="2" workflowId="45488"> <description><! CDATA {code} unit-tests_1  | ================== unit-tests_1  | WARNING: DATA RACE unit-tests_1  | Read at 0x00c420a35dd0 by goroutine 43: unit-tests_1  |   github.com/hyperledger/fabric/common/ledger/blkstorage/fsblkstorage.(*fsBlockStore).RetrieveBlocks() unit-tests_1  |       /opt/gopath/src/github.com/hyperledger/fabric/common/ledger/blkstorage/fsblkstorage/blocks_itr.go:36 +0xab unit-tests_1  |   github.com/hyperledger/fabric/common/ledger/blockledger/file.(*FileLedger).Iterator() unit-tests_1  |       /opt/gopath/src/github.com/hyperledger/fabric/common/ledger/blockledger/file/impl.go:90 +0x137 unit-tests_1  |   github.com/hyperledger/fabric/orderer/common/multichannel.(*ChainSupport).Iterator() unit-tests_1  |       <autogenerated>:1 +0x82 unit-tests_1  |   github.com/hyperledger/fabric/common/deliver.(*Handler).deliverBlocks() unit-tests_1  |       /opt/gopath/src/github.com/hyperledger/fabric/common/deliver/deliver.go:227 +0x1447 unit-tests_1  |   github.com/hyperledger/fabric/common/deliver.(*Handler).Handle() unit-tests_1  |       /opt/gopath/src/github.com/hyperledger/fabric/common/deliver/deliver.go:153 +0x3b8 unit-tests_1  |   github.com/hyperledger/fabric/orderer/common/server.(*server).Deliver() unit-tests_1  |       /opt/gopath/src/github.com/hyperledger/fabric/orderer/common/server/server.go:182 +0x3af unit-tests_1  |   github.com/hyperledger/fabric/orderer/common/performance.(*BenchmarkServer).CreateDeliverClient.func1() unit-tests_1  |       /opt/gopath/src/github.com/hyperledger/fabric/orderer/common/performance/server.go:174 +0x68 unit-tests_1  |  unit-tests_1  | Previous write at 0x00c420a35dd0 by goroutine 45: unit-tests_1  |   github.com/hyperledger/fabric/common/ledger/blkstorage/fsblkstorage.(*blockfileMgr).updateCheckpoint() unit-tests_1  |       /opt/gopath/src/github.com/hyperledger/fabric/common/ledger/blkstorage/fsblkstorage/blockfile_mgr.go:437 +0xdc unit-tests_1  |   github.com/hyperledger/fabric/common/ledger/blkstorage/fsblkstorage.(*blockfileMgr).addBlock() unit-tests_1  |       /opt/gopath/src/github.com/hyperledger/fabric/common/ledger/blkstorage/fsblkstorage/blockfile_mgr.go:323 +0xada unit-tests_1  |   github.com/hyperledger/fabric/common/ledger/blkstorage/fsblkstorage.(*fsBlockStore).AddBlock() unit-tests_1  |       /opt/gopath/src/github.com/hyperledger/fabric/common/ledger/blkstorage/fsblkstorage/fs_blockstore.go:43 +0x5c unit-tests_1  |   github.com/hyperledger/fabric/common/ledger/blockledger/file.(*FileLedger).Append() unit-tests_1  |       /opt/gopath/src/github.com/hyperledger/fabric/common/ledger/blockledger/file/impl.go:109 +0x5c unit-tests_1  |   github.com/hyperledger/fabric/orderer/common/multichannel.(*ChainSupport).Append() unit-tests_1  |       <autogenerated>:1 +0x82 unit-tests_1  |   github.com/hyperledger/fabric/orderer/common/multichannel.(*BlockWriter).commitBlock() unit-tests_1  |       /opt/gopath/src/github.com/hyperledger/fabric/orderer/common/multichannel/blockwriter.go:169 +0xf6 unit-tests_1  |   github.com/hyperledger/fabric/orderer/common/multichannel.(*BlockWriter).WriteBlock.func1() unit-tests_1  |       /opt/gopath/src/github.com/hyperledger/fabric/orderer/common/multichannel/blockwriter.go:155 +0x86 unit-tests_1  |  unit-tests_1  | Goroutine 43 (running) created at: unit-tests_1  |   github.com/hyperledger/fabric/orderer/common/performance.(*BenchmarkServer).CreateDeliverClient() unit-tests_1  |       /opt/gopath/src/github.com/hyperledger/fabric/orderer/common/performance/server.go:173 +0x195 unit-tests_1  |   github.com/hyperledger/fabric/orderer/common/server.benchmarkOrderer.func1.1.1.1() unit-tests_1  |       /opt/gopath/src/github.com/hyperledger/fabric/orderer/common/server/benchmark_test.go:453 +0x50 unit-tests_1  |  unit-tests_1  | Goroutine 45 (finished) created at: unit-tests_1  |   github.com/hyperledger/fabric/orderer/common/multichannel.(*BlockWriter).WriteBlock() unit-tests_1  |       /opt/gopath/src/github.com/hyperledger/fabric/orderer/common/multichannel/blockwriter.go:153 +0xac unit-tests_1  |   github.com/hyperledger/fabric/orderer/common/multichannel.(*ChainSupport).WriteBlock() unit-tests_1  |       <autogenerated>:1 +0x83 unit-tests_1  |   github.com/hyperledger/fabric/orderer/consensus/solo.(*chain).main() unit-tests_1  |       /opt/gopath/src/github.com/hyperledger/fabric/orderer/consensus/solo/consensus.go:139 +0x998 unit-tests_1  | ================== unit-tests_1  | ================== unit-tests_1  | WARNING: DATA RACE unit-tests_1  | Read at 0x00c420298cf8 by goroutine 43: unit-tests_1  |   github.com/hyperledger/fabric/common/ledger/blkstorage/fsblkstorage.(*fsBlockStore).RetrieveBlocks() unit-tests_1  |       /opt/gopath/src/github.com/hyperledger/fabric/common/ledger/blkstorage/fsblkstorage/blocks_itr.go:36 +0xc1 unit-tests_1  |   github.com/hyperledger/fabric/common/ledger/blockledger/file.(*FileLedger).Iterator() unit-tests_1  |       /opt/gopath/src/github.com/hyperledger/fabric/common/ledger/blockledger/file/impl.go:90 +0x137 unit-tests_1  |   github.com/hyperledger/fabric/orderer/common/multichannel.(*ChainSupport).Iterator() unit-tests_1  |       <autogenerated>:1 +0x82 unit-tests_1  |   github.com/hyperledger/fabric/common/deliver.(*Handler).deliverBlocks() unit-tests_1  |       /opt/gopath/src/github.com/hyperledger/fabric/common/deliver/deliver.go:227 +0x1447 unit-tests_1  |   github.com/hyperledger/fabric/common/deliver.(*Handler).Handle() unit-tests_1  |       /opt/gopath/src/github.com/hyperledger/fabric/common/deliver/deliver.go:153 +0x3b8 unit-tests_1  |   github.com/hyperledger/fabric/orderer/common/server.(*server).Deliver() unit-tests_1  |       /opt/gopath/src/github.com/hyperledger/fabric/orderer/common/server/server.go:182 +0x3af unit-tests_1  |   github.com/hyperledger/fabric/orderer/common/performance.(*BenchmarkServer).CreateDeliverClient.func1() unit-tests_1  |       /opt/gopath/src/github.com/hyperledger/fabric/orderer/common/performance/server.go:174 +0x68 unit-tests_1  |  unit-tests_1  | Previous write at 0x00c420298cf8 by goroutine 45: unit-tests_1  |   github.com/hyperledger/fabric/common/ledger/blkstorage/fsblkstorage.(*blockfileMgr).addBlock() unit-tests_1  |       /opt/gopath/src/github.com/hyperledger/fabric/common/ledger/blkstorage/fsblkstorage/blockfile_mgr.go:298 +0x6ea unit-tests_1  |   github.com/hyperledger/fabric/common/ledger/blkstorage/fsblkstorage.(*fsBlockStore).AddBlock() unit-tests_1  |       /opt/gopath/src/github.com/hyperledger/fabric/common/ledger/blkstorage/fsblkstorage/fs_blockstore.go:43 +0x5c unit-tests_1  |   github.com/hyperledger/fabric/common/ledger/blockledger/file.(*FileLedger).Append() unit-tests_1  |       /opt/gopath/src/github.com/hyperledger/fabric/common/ledger/blockledger/file/impl.go:109 +0x5c unit-tests_1  |   github.com/hyperledger/fabric/orderer/common/multichannel.(*ChainSupport).Append() unit-tests_1  |       <autogenerated>:1 +0x82 unit-tests_1  |   github.com/hyperledger/fabric/orderer/common/multichannel.(*BlockWriter).commitBlock() unit-tests_1  |       /opt/gopath/src/github.com/hyperledger/fabric/orderer/common/multichannel/blockwriter.go:169 +0xf6 unit-tests_1  |   github.com/hyperledger/fabric/orderer/common/multichannel.(*BlockWriter).WriteBlock.func1() unit-tests_1  |       /opt/gopath/src/github.com/hyperledger/fabric/orderer/common/multichannel/blockwriter.go:155 +0x86 unit-tests_1  |  unit-tests_1  | Goroutine 43 (running) created at: unit-tests_1  |   github.com/hyperledger/fabric/orderer/common/performance.(*BenchmarkServer).CreateDeliverClient() unit-tests_1  |       /opt/gopath/src/github.com/hyperledger/fabric/orderer/common/performance/server.go:173 +0x195 unit-tests_1  |   github.com/hyperledger/fabric/orderer/common/server.benchmarkOrderer.func1.1.1.1() unit-tests_1  |       /opt/gopath/src/github.com/hyperledger/fabric/orderer/common/server/benchmark_test.go:453 +0x50 unit-tests_1  |  unit-tests_1  | Goroutine 45 (finished) created at: unit-tests_1  |   github.com/hyperledger/fabric/orderer/common/multichannel.(*BlockWriter).WriteBlock() unit-tests_1  |       /opt/gopath/src/github.com/hyperledger/fabric/orderer/common/multichannel/blockwriter.go:153 +0xac unit-tests_1  |   github.com/hyperledger/fabric/orderer/common/multichannel.(*ChainSupport).WriteBlock() unit-tests_1  |       <autogenerated>:1 +0x83 unit-tests_1  |   github.com/hyperledger/fabric/orderer/consensus/solo.(*chain).main() unit-tests_1  |       /opt/gopath/src/github.com/hyperledger/fabric/orderer/consensus/solo/consensus.go:139 +0x998 unit-tests_1  | ================== {code}  ></description> </Issue>
