<Issue id="33580" key="FAB-11906" number="11906" project="10002" reporter="sykesm" assignee="ales" creator="sykesm" type="10004" summary="Data races in state based validation" priority="3" resolution="10000" status="6" created="2018-09-07 17:31:35.0" updated="2018-09-21 16:56:28.0" resolutiondate="2018-09-21 16:56:28.0" votes="0" watches="2" workflowId="44873"> <description><! CDATA {code} ================== WARNING: DATA RACE Write at 0x00c0000447b0 by goroutine 364: github.com/hyperledger/fabric/core/common/validation/statebased.(*mockState).Done() /Users/sykesm/workspace/fabric/src/github.com/hyperledger/fabric/core/common/validation/statebased/vpmanager_test.go:52 +0x3e github.com/hyperledger/fabric/core/common/validation/statebased.(*KeyLevelValidationParameterManagerImpl).GetValidationParameterForKey() /Users/sykesm/workspace/fabric/src/github.com/hyperledger/fabric/core/common/validation/statebased/vpmanagerimpl.go:326 +0x4da github.com/hyperledger/fabric/core/common/validation/statebased.TestForRaces.func1() /Users/sykesm/workspace/fabric/src/github.com/hyperledger/fabric/core/common/validation/statebased/vpmanager_test.go:676 +0x215 github.com/hyperledger/fabric/vendor/github.com/stretchr/testify/assert.didPanic.func1() /Users/sykesm/workspace/fabric/src/github.com/hyperledger/fabric/vendor/github.com/stretchr/testify/assert/assertions.go:791 +0x68 github.com/hyperledger/fabric/vendor/github.com/stretchr/testify/assert.didPanic() /Users/sykesm/workspace/fabric/src/github.com/hyperledger/fabric/vendor/github.com/stretchr/testify/assert/assertions.go:793 +0x5d github.com/hyperledger/fabric/vendor/github.com/stretchr/testify/assert.NotPanics() /Users/sykesm/workspace/fabric/src/github.com/hyperledger/fabric/vendor/github.com/stretchr/testify/assert/assertions.go:833 +0x3f github.com/hyperledger/fabric/core/common/validation/statebased.runFunctions.func1() /Users/sykesm/workspace/fabric/src/github.com/hyperledger/fabric/core/common/validation/statebased/vpmanager_test.go:140 +0xf8  Previous write at 0x00c0000447b0 by goroutine 54: github.com/hyperledger/fabric/core/common/validation/statebased.(*mockState).Done() /Users/sykesm/workspace/fabric/src/github.com/hyperledger/fabric/core/common/validation/statebased/vpmanager_test.go:52 +0x3e github.com/hyperledger/fabric/core/common/validation/statebased.(*KeyLevelValidationParameterManagerImpl).GetValidationParameterForKey() /Users/sykesm/workspace/fabric/src/github.com/hyperledger/fabric/core/common/validation/statebased/vpmanagerimpl.go:326 +0x4da github.com/hyperledger/fabric/core/common/validation/statebased.TestForRaces.func1() /Users/sykesm/workspace/fabric/src/github.com/hyperledger/fabric/core/common/validation/statebased/vpmanager_test.go:676 +0x215 github.com/hyperledger/fabric/vendor/github.com/stretchr/testify/assert.didPanic.func1() /Users/sykesm/workspace/fabric/src/github.com/hyperledger/fabric/vendor/github.com/stretchr/testify/assert/assertions.go:791 +0x68 github.com/hyperledger/fabric/vendor/github.com/stretchr/testify/assert.didPanic() /Users/sykesm/workspace/fabric/src/github.com/hyperledger/fabric/vendor/github.com/stretchr/testify/assert/assertions.go:793 +0x5d github.com/hyperledger/fabric/vendor/github.com/stretchr/testify/assert.NotPanics() /Users/sykesm/workspace/fabric/src/github.com/hyperledger/fabric/vendor/github.com/stretchr/testify/assert/assertions.go:833 +0x3f github.com/hyperledger/fabric/core/common/validation/statebased.runFunctions.func1() /Users/sykesm/workspace/fabric/src/github.com/hyperledger/fabric/core/common/validation/statebased/vpmanager_test.go:140 +0xf8  Goroutine 364 (running) created at: github.com/hyperledger/fabric/core/common/validation/statebased.runFunctions() /Users/sykesm/workspace/fabric/src/github.com/hyperledger/fabric/core/common/validation/statebased/vpmanager_test.go:139 +0x1b3 github.com/hyperledger/fabric/core/common/validation/statebased.TestForRaces() /Users/sykesm/workspace/fabric/src/github.com/hyperledger/fabric/core/common/validation/statebased/vpmanager_test.go:682 +0x781 testing.tRunner() /usr/local/Cellar/go/1.11/libexec/src/testing/testing.go:827 +0x162  Goroutine 54 (finished) created at: github.com/hyperledger/fabric/core/common/validation/statebased.runFunctions() /Users/sykesm/workspace/fabric/src/github.com/hyperledger/fabric/core/common/validation/statebased/vpmanager_test.go:139 +0x1b3 github.com/hyperledger/fabric/core/common/validation/statebased.TestForRaces() /Users/sykesm/workspace/fabric/src/github.com/hyperledger/fabric/core/common/validation/statebased/vpmanager_test.go:682 +0x781 testing.tRunner() /usr/local/Cellar/go/1.11/libexec/src/testing/testing.go:827 +0x162 ================== ================== WARNING: DATA RACE Write at 0x00c0000447b0 by goroutine 213: github.com/hyperledger/fabric/core/common/validation/statebased.(*mockState).Done() /Users/sykesm/workspace/fabric/src/github.com/hyperledger/fabric/core/common/validation/statebased/vpmanager_test.go:52 +0x3e github.com/hyperledger/fabric/core/common/validation/statebased.(*KeyLevelValidationParameterManagerImpl).GetValidationParameterForKey() /Users/sykesm/workspace/fabric/src/github.com/hyperledger/fabric/core/common/validation/statebased/vpmanagerimpl.go:326 +0x4da github.com/hyperledger/fabric/core/common/validation/statebased.TestForRaces.func1() /Users/sykesm/workspace/fabric/src/github.com/hyperledger/fabric/core/common/validation/statebased/vpmanager_test.go:676 +0x215 github.com/hyperledger/fabric/vendor/github.com/stretchr/testify/assert.didPanic.func1() /Users/sykesm/workspace/fabric/src/github.com/hyperledger/fabric/vendor/github.com/stretchr/testify/assert/assertions.go:791 +0x68 github.com/hyperledger/fabric/vendor/github.com/stretchr/testify/assert.didPanic() /Users/sykesm/workspace/fabric/src/github.com/hyperledger/fabric/vendor/github.com/stretchr/testify/assert/assertions.go:793 +0x5d github.com/hyperledger/fabric/vendor/github.com/stretchr/testify/assert.NotPanics() /Users/sykesm/workspace/fabric/src/github.com/hyperledger/fabric/vendor/github.com/stretchr/testify/assert/assertions.go:833 +0x3f github.com/hyperledger/fabric/core/common/validation/statebased.runFunctions.func1() /Users/sykesm/workspace/fabric/src/github.com/hyperledger/fabric/core/common/validation/statebased/vpmanager_test.go:140 +0xf8  Previous write at 0x00c0000447b0 by goroutine 54: github.com/hyperledger/fabric/core/common/validation/statebased.(*mockState).Done() /Users/sykesm/workspace/fabric/src/github.com/hyperledger/fabric/core/common/validation/statebased/vpmanager_test.go:52 +0x3e github.com/hyperledger/fabric/core/common/validation/statebased.(*KeyLevelValidationParameterManagerImpl).GetValidationParameterForKey() /Users/sykesm/workspace/fabric/src/github.com/hyperledger/fabric/core/common/validation/statebased/vpmanagerimpl.go:326 +0x4da github.com/hyperledger/fabric/core/common/validation/statebased.TestForRaces.func1() /Users/sykesm/workspace/fabric/src/github.com/hyperledger/fabric/core/common/validation/statebased/vpmanager_test.go:676 +0x215 github.com/hyperledger/fabric/vendor/github.com/stretchr/testify/assert.didPanic.func1() /Users/sykesm/workspace/fabric/src/github.com/hyperledger/fabric/vendor/github.com/stretchr/testify/assert/assertions.go:791 +0x68 github.com/hyperledger/fabric/vendor/github.com/stretchr/testify/assert.didPanic() /Users/sykesm/workspace/fabric/src/github.com/hyperledger/fabric/vendor/github.com/stretchr/testify/assert/assertions.go:793 +0x5d github.com/hyperledger/fabric/vendor/github.com/stretchr/testify/assert.NotPanics() /Users/sykesm/workspace/fabric/src/github.com/hyperledger/fabric/vendor/github.com/stretchr/testify/assert/assertions.go:833 +0x3f github.com/hyperledger/fabric/core/common/validation/statebased.runFunctions.func1() /Users/sykesm/workspace/fabric/src/github.com/hyperledger/fabric/core/common/validation/statebased/vpmanager_test.go:140 +0xf8  Goroutine 213 (running) created at: github.com/hyperledger/fabric/core/common/validation/statebased.runFunctions() /Users/sykesm/workspace/fabric/src/github.com/hyperledger/fabric/core/common/validation/statebased/vpmanager_test.go:139 +0x1b3 github.com/hyperledger/fabric/core/common/validation/statebased.TestForRaces() /Users/sykesm/workspace/fabric/src/github.com/hyperledger/fabric/core/common/validation/statebased/vpmanager_test.go:682 +0x781 testing.tRunner() /usr/local/Cellar/go/1.11/libexec/src/testing/testing.go:827 +0x162  Goroutine 54 (finished) created at: github.com/hyperledger/fabric/core/common/validation/statebased.runFunctions() /Users/sykesm/workspace/fabric/src/github.com/hyperledger/fabric/core/common/validation/statebased/vpmanager_test.go:139 +0x1b3 github.com/hyperledger/fabric/core/common/validation/statebased.TestForRaces() /Users/sykesm/workspace/fabric/src/github.com/hyperledger/fabric/core/common/validation/statebased/vpmanager_test.go:682 +0x781 testing.tRunner() /usr/local/Cellar/go/1.11/libexec/src/testing/testing.go:827 +0x162 ================== ================== WARNING: DATA RACE Write at 0x00c0000447b0 by goroutine 352: github.com/hyperledger/fabric/core/common/validation/statebased.(*mockState).Done() /Users/sykesm/workspace/fabric/src/github.com/hyperledger/fabric/core/common/validation/statebased/vpmanager_test.go:52 +0x3e github.com/hyperledger/fabric/core/common/validation/statebased.(*KeyLevelValidationParameterManagerImpl).GetValidationParameterForKey() /Users/sykesm/workspace/fabric/src/github.com/hyperledger/fabric/core/common/validation/statebased/vpmanagerimpl.go:326 +0x4da github.com/hyperledger/fabric/core/common/validation/statebased.TestForRaces.func1() /Users/sykesm/workspace/fabric/src/github.com/hyperledger/fabric/core/common/validation/statebased/vpmanager_test.go:676 +0x215 github.com/hyperledger/fabric/vendor/github.com/stretchr/testify/assert.didPanic.func1() /Users/sykesm/workspace/fabric/src/github.com/hyperledger/fabric/vendor/github.com/stretchr/testify/assert/assertions.go:791 +0x68 github.com/hyperledger/fabric/vendor/github.com/stretchr/testify/assert.didPanic() /Users/sykesm/workspace/fabric/src/github.com/hyperledger/fabric/vendor/github.com/stretchr/testify/assert/assertions.go:793 +0x5d github.com/hyperledger/fabric/vendor/github.com/stretchr/testify/assert.NotPanics() /Users/sykesm/workspace/fabric/src/github.com/hyperledger/fabric/vendor/github.com/stretchr/testify/assert/assertions.go:833 +0x3f github.com/hyperledger/fabric/core/common/validation/statebased.runFunctions.func1() /Users/sykesm/workspace/fabric/src/github.com/hyperledger/fabric/core/common/validation/statebased/vpmanager_test.go:140 +0xf8  Previous write at 0x00c0000447b0 by goroutine 54: github.com/hyperledger/fabric/core/common/validation/statebased.(*mockState).Done() /Users/sykesm/workspace/fabric/src/github.com/hyperledger/fabric/core/common/validation/statebased/vpmanager_test.go:52 +0x3e github.com/hyperledger/fabric/core/common/validation/statebased.(*KeyLevelValidationParameterManagerImpl).GetValidationParameterForKey() /Users/sykesm/workspace/fabric/src/github.com/hyperledger/fabric/core/common/validation/statebased/vpmanagerimpl.go:326 +0x4da github.com/hyperledger/fabric/core/common/validation/statebased.TestForRaces.func1() /Users/sykesm/workspace/fabric/src/github.com/hyperledger/fabric/core/common/validation/statebased/vpmanager_test.go:676 +0x215 github.com/hyperledger/fabric/vendor/github.com/stretchr/testify/assert.didPanic.func1() /Users/sykesm/workspace/fabric/src/github.com/hyperledger/fabric/vendor/github.com/stretchr/testify/assert/assertions.go:791 +0x68 github.com/hyperledger/fabric/vendor/github.com/stretchr/testify/assert.didPanic() /Users/sykesm/workspace/fabric/src/github.com/hyperledger/fabric/vendor/github.com/stretchr/testify/assert/assertions.go:793 +0x5d github.com/hyperledger/fabric/vendor/github.com/stretchr/testify/assert.NotPanics() /Users/sykesm/workspace/fabric/src/github.com/hyperledger/fabric/vendor/github.com/stretchr/testify/assert/assertions.go:833 +0x3f github.com/hyperledger/fabric/core/common/validation/statebased.runFunctions.func1() /Users/sykesm/workspace/fabric/src/github.com/hyperledger/fabric/core/common/validation/statebased/vpmanager_test.go:140 +0xf8  Goroutine 352 (running) created at: github.com/hyperledger/fabric/core/common/validation/statebased.runFunctions() /Users/sykesm/workspace/fabric/src/github.com/hyperledger/fabric/core/common/validation/statebased/vpmanager_test.go:139 +0x1b3 github.com/hyperledger/fabric/core/common/validation/statebased.TestForRaces() /Users/sykesm/workspace/fabric/src/github.com/hyperledger/fabric/core/common/validation/statebased/vpmanager_test.go:682 +0x781 testing.tRunner() /usr/local/Cellar/go/1.11/libexec/src/testing/testing.go:827 +0x162  Goroutine 54 (finished) created at: github.com/hyperledger/fabric/core/common/validation/statebased.runFunctions() /Users/sykesm/workspace/fabric/src/github.com/hyperledger/fabric/core/common/validation/statebased/vpmanager_test.go:139 +0x1b3 github.com/hyperledger/fabric/core/common/validation/statebased.TestForRaces() /Users/sykesm/workspace/fabric/src/github.com/hyperledger/fabric/core/common/validation/statebased/vpmanager_test.go:682 +0x781 testing.tRunner() /usr/local/Cellar/go/1.11/libexec/src/testing/testing.go:827 +0x162 ================== ================== WARNING: DATA RACE Write at 0x00c0000447b0 by goroutine 394: github.com/hyperledger/fabric/core/common/validation/statebased.(*mockState).Done() /Users/sykesm/workspace/fabric/src/github.com/hyperledger/fabric/core/common/validation/statebased/vpmanager_test.go:52 +0x3e github.com/hyperledger/fabric/core/common/validation/statebased.(*KeyLevelValidationParameterManagerImpl).GetValidationParameterForKey() /Users/sykesm/workspace/fabric/src/github.com/hyperledger/fabric/core/common/validation/statebased/vpmanagerimpl.go:326 +0x4da github.com/hyperledger/fabric/core/common/validation/statebased.TestForRaces.func1() /Users/sykesm/workspace/fabric/src/github.com/hyperledger/fabric/core/common/validation/statebased/vpmanager_test.go:676 +0x215 github.com/hyperledger/fabric/vendor/github.com/stretchr/testify/assert.didPanic.func1() /Users/sykesm/workspace/fabric/src/github.com/hyperledger/fabric/vendor/github.com/stretchr/testify/assert/assertions.go:791 +0x68 github.com/hyperledger/fabric/vendor/github.com/stretchr/testify/assert.didPanic() /Users/sykesm/workspace/fabric/src/github.com/hyperledger/fabric/vendor/github.com/stretchr/testify/assert/assertions.go:793 +0x5d github.com/hyperledger/fabric/vendor/github.com/stretchr/testify/assert.NotPanics() /Users/sykesm/workspace/fabric/src/github.com/hyperledger/fabric/vendor/github.com/stretchr/testify/assert/assertions.go:833 +0x3f github.com/hyperledger/fabric/core/common/validation/statebased.runFunctions.func1() /Users/sykesm/workspace/fabric/src/github.com/hyperledger/fabric/core/common/validation/statebased/vpmanager_test.go:140 +0xf8  Previous write at 0x00c0000447b0 by goroutine 54: github.com/hyperledger/fabric/core/common/validation/statebased.(*mockState).Done() /Users/sykesm/workspace/fabric/src/github.com/hyperledger/fabric/core/common/validation/statebased/vpmanager_test.go:52 +0x3e github.com/hyperledger/fabric/core/common/validation/statebased.(*KeyLevelValidationParameterManagerImpl).GetValidationParameterForKey() /Users/sykesm/workspace/fabric/src/github.com/hyperledger/fabric/core/common/validation/statebased/vpmanagerimpl.go:326 +0x4da github.com/hyperledger/fabric/core/common/validation/statebased.TestForRaces.func1() /Users/sykesm/workspace/fabric/src/github.com/hyperledger/fabric/core/common/validation/statebased/vpmanager_test.go:676 +0x215 github.com/hyperledger/fabric/vendor/github.com/stretchr/testify/assert.didPanic.func1() /Users/sykesm/workspace/fabric/src/github.com/hyperledger/fabric/vendor/github.com/stretchr/testify/assert/assertions.go:791 +0x68 github.com/hyperledger/fabric/vendor/github.com/stretchr/testify/assert.didPanic() /Users/sykesm/workspace/fabric/src/github.com/hyperledger/fabric/vendor/github.com/stretchr/testify/assert/assertions.go:793 +0x5d github.com/hyperledger/fabric/vendor/github.com/stretchr/testify/assert.NotPanics() /Users/sykesm/workspace/fabric/src/github.com/hyperledger/fabric/vendor/github.com/stretchr/testify/assert/assertions.go:833 +0x3f github.com/hyperledger/fabric/core/common/validation/statebased.runFunctions.func1() /Users/sykesm/workspace/fabric/src/github.com/hyperledger/fabric/core/common/validation/statebased/vpmanager_test.go:140 +0xf8  Goroutine 394 (running) created at: github.com/hyperledger/fabric/core/common/validation/statebased.runFunctions() /Users/sykesm/workspace/fabric/src/github.com/hyperledger/fabric/core/common/validation/statebased/vpmanager_test.go:139 +0x1b3 github.com/hyperledger/fabric/core/common/validation/statebased.TestForRaces() /Users/sykesm/workspace/fabric/src/github.com/hyperledger/fabric/core/common/validation/statebased/vpmanager_test.go:682 +0x781 testing.tRunner() /usr/local/Cellar/go/1.11/libexec/src/testing/testing.go:827 +0x162  Goroutine 54 (finished) created at: github.com/hyperledger/fabric/core/common/validation/statebased.runFunctions() /Users/sykesm/workspace/fabric/src/github.com/hyperledger/fabric/core/common/validation/statebased/vpmanager_test.go:139 +0x1b3 github.com/hyperledger/fabric/core/common/validation/statebased.TestForRaces() /Users/sykesm/workspace/fabric/src/github.com/hyperledger/fabric/core/common/validation/statebased/vpmanager_test.go:682 +0x781 testing.tRunner() /usr/local/Cellar/go/1.11/libexec/src/testing/testing.go:827 +0x162 ================== --- FAIL: TestForRaces (0.31s) testing.go:771: race detected during execution of test {code}  ></description> </Issue>
