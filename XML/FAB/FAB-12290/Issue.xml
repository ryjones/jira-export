<Issue id="34403" key="FAB-12290" number="12290" project="10002" reporter="sykesm" assignee="sykesm" creator="sykesm" type="10004" summary="Data race in deliverservice/blocksprovider" priority="4" resolution="10000" status="6" created="2018-10-03 16:42:15.0" updated="2018-11-19 05:05:51.0" resolutiondate="2018-10-04 06:15:27.0" votes="0" watches="1" workflowId="45803"> <description><! CDATA {code} ================== WARNING: DATA RACE Write at 0x00c0000bd070 by goroutine 17: sync/atomic.AddInt32() /usr/local/Cellar/go/1.11.1/libexec/src/runtime/race_amd64.s:269 +0xb github.com/hyperledger/fabric/core/deliverservice/mocks.(*MockBlocksDeliverer).Recv() /Users/sykesm/workspace/fabric/src/github.com/hyperledger/fabric/core/deliverservice/mocks/blocksprovider.go:74 +0x4a github.com/hyperledger/fabric/core/deliverservice/blocksprovider.(*blocksProviderImpl).DeliverBlocks() /Users/sykesm/workspace/fabric/src/github.com/hyperledger/fabric/core/deliverservice/blocksprovider/blocksprovider.go:125 +0x11d  Previous read at 0x00c0000bd070 by goroutine 15: github.com/hyperledger/fabric/core/deliverservice/blocksprovider.assertDelivery() /Users/sykesm/workspace/fabric/src/github.com/hyperledger/fabric/core/deliverservice/blocksprovider/blocksprovider_test.go:97 +0x143 github.com/hyperledger/fabric/core/deliverservice/blocksprovider.makeTestCase.func1() /Users/sykesm/workspace/fabric/src/github.com/hyperledger/fabric/core/deliverservice/blocksprovider/blocksprovider_test.go:85 +0x2f5 github.com/hyperledger/fabric/core/deliverservice/blocksprovider.TestBlocksProviderImpl_GetBlockFromTheOldest() /Users/sykesm/workspace/fabric/src/github.com/hyperledger/fabric/core/deliverservice/blocksprovider/blocksprovider_test.go:125 +0x1c4 testing.tRunner() /usr/local/Cellar/go/1.11.1/libexec/src/testing/testing.go:827 +0x162  Goroutine 17 (running) created at: github.com/hyperledger/fabric/core/deliverservice/blocksprovider.makeTestCase.func1.1() /Users/sykesm/workspace/fabric/src/github.com/hyperledger/fabric/core/deliverservice/blocksprovider/blocksprovider_test.go:78 +0x50  Goroutine 15 (running) created at: testing.(*T).Run() /usr/local/Cellar/go/1.11.1/libexec/src/testing/testing.go:878 +0x650 testing.runTests.func1() /usr/local/Cellar/go/1.11.1/libexec/src/testing/testing.go:1119 +0xa8 testing.tRunner() /usr/local/Cellar/go/1.11.1/libexec/src/testing/testing.go:827 +0x162 testing.runTests() /usr/local/Cellar/go/1.11.1/libexec/src/testing/testing.go:1117 +0x4ee testing.(*M).Run() /usr/local/Cellar/go/1.11.1/libexec/src/testing/testing.go:1034 +0x2ee main.main() _testmain.go:104 +0x332 ================== ================== WARNING: DATA RACE Write at 0x00c00041dc50 by goroutine 17: sync/atomic.AddInt32() /usr/local/Cellar/go/1.11.1/libexec/src/runtime/race_amd64.s:269 +0xb github.com/hyperledger/fabric/core/deliverservice/mocks.(*MockGossipServiceAdapter).AddPayload() /Users/sykesm/workspace/fabric/src/github.com/hyperledger/fabric/core/deliverservice/mocks/blocksprovider.go:50 +0x42 github.com/hyperledger/fabric/core/deliverservice/blocksprovider.(*blocksProviderImpl).DeliverBlocks() /Users/sykesm/workspace/fabric/src/github.com/hyperledger/fabric/core/deliverservice/blocksprovider/blocksprovider.go:182 +0x92a  Previous read at 0x00c00041dc50 by goroutine 15: github.com/hyperledger/fabric/core/deliverservice/blocksprovider.assertDelivery() /Users/sykesm/workspace/fabric/src/github.com/hyperledger/fabric/core/deliverservice/blocksprovider/blocksprovider_test.go:97 +0x163 github.com/hyperledger/fabric/core/deliverservice/blocksprovider.makeTestCase.func1() /Users/sykesm/workspace/fabric/src/github.com/hyperledger/fabric/core/deliverservice/blocksprovider/blocksprovider_test.go:85 +0x2f5 github.com/hyperledger/fabric/core/deliverservice/blocksprovider.TestBlocksProviderImpl_GetBlockFromTheOldest() /Users/sykesm/workspace/fabric/src/github.com/hyperledger/fabric/core/deliverservice/blocksprovider/blocksprovider_test.go:125 +0x1c4 testing.tRunner() /usr/local/Cellar/go/1.11.1/libexec/src/testing/testing.go:827 +0x162  Goroutine 17 (running) created at: github.com/hyperledger/fabric/core/deliverservice/blocksprovider.makeTestCase.func1.1() /Users/sykesm/workspace/fabric/src/github.com/hyperledger/fabric/core/deliverservice/blocksprovider/blocksprovider_test.go:78 +0x50  Goroutine 15 (running) created at: testing.(*T).Run() /usr/local/Cellar/go/1.11.1/libexec/src/testing/testing.go:878 +0x650 testing.runTests.func1() /usr/local/Cellar/go/1.11.1/libexec/src/testing/testing.go:1119 +0xa8 testing.tRunner() /usr/local/Cellar/go/1.11.1/libexec/src/testing/testing.go:827 +0x162 testing.runTests() /usr/local/Cellar/go/1.11.1/libexec/src/testing/testing.go:1117 +0x4ee testing.(*M).Run() /usr/local/Cellar/go/1.11.1/libexec/src/testing/testing.go:1034 +0x2ee main.main() _testmain.go:104 +0x332 ================== --- FAIL: TestBlocksProviderImpl_GetBlockFromTheOldest (1.00s) {code}  ></description> </Issue>
