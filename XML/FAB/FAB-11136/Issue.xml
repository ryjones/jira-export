<Issue id="31826" key="FAB-11136" number="11136" project="10002" reporter="wlahti" assignee="wlahti" creator="wlahti" type="10004" summary="Flakey peer CLI unit tests due to low connection timeout" priority="3" resolution="10000" status="6" created="2018-07-12 17:51:09.0" updated="2019-03-19 10:57:28.0" resolutiondate="2018-07-26 03:54:00.0" votes="0" watches="1" workflowId="42843"> <description><! CDATA The peer CLI unit tests occasionally fail due to a "context deadline exceeded" error. This is likely due to CI needing a longer connection timeout value than is necessary for running the tests locally. This task will up the connTimeout value from 10ms to 1s for regular use and set the timeout to 10ms for unit tests where a connection failure is expected.Â   Example error: {code:java} 17:40:07 unit-tests_1  | --- FAIL: TestOrdererClient (0.02s) 17:40:07 unit-tests_1  | 	assertions.go:247:   	Error Trace:	ordererclient_test.go:94 17:40:07 unit-tests_1  | 		 	Error:      	Received unexpected error: 17:40:07 unit-tests_1  | 		 	            	context deadline exceeded 17:40:07 unit-tests_1  | 		 	            	github.com/hyperledger/fabric/core/comm.(*GRPCClient).NewConnection 17:40:07 unit-tests_1  | 		 	            		/opt/gopath/src/github.com/hyperledger/fabric/core/comm/client.go:186 17:40:07 unit-tests_1  | 		 	            	github.com/hyperledger/fabric/peer/common.(*OrdererClient).Broadcast 17:40:07 unit-tests_1  | 		 	            		/opt/gopath/src/github.com/hyperledger/fabric/peer/common/ordererclient.go:45 17:40:07 unit-tests_1  | 		 	            	github.com/hyperledger/fabric/peer/common_test.TestOrdererClient 17:40:07 unit-tests_1  | 		 	            		/opt/gopath/src/github.com/hyperledger/fabric/peer/common/ordererclient_test.go:93 17:40:07 unit-tests_1  | 		 	            	testing.tRunner 17:40:07 unit-tests_1  | 		 	            		/opt/go/src/testing/testing.go:777 17:40:07 unit-tests_1  | 		 	            	runtime.goexit 17:40:07 unit-tests_1  | 		 	            		/opt/go/src/runtime/asm_amd64.s:2361 17:40:07 unit-tests_1  | 		 	            	failed to create new connection 17:40:07 unit-tests_1  | 		 	            	orderer client failed to connect to 127.0.0.1:44740 17:40:07 unit-tests_1  | 		 	Test:       	TestOrdererClient 17:40:07 unit-tests_1  | 	assertions.go:247:   	Error Trace:	ordererclient_test.go:95 17:40:07 unit-tests_1  | 		 	Error:      	Expected value not to be nil. 17:40:07 unit-tests_1  | 		 	Test:       	TestOrdererClient 17:40:07 unit-tests_1  | FAIL 17:40:07 unit-tests_1  | coverage: 62.0% of statements 17:40:07 unit-tests_1  | FAIL	github.com/hyperledger/fabric/peer/common	0.247s{code}  ></description> </Issue>
