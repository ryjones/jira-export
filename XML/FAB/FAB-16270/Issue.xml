<Issue id="41722" key="FAB-16270" number="16270" project="10002" reporter="denyeart" assignee="guoger" creator="denyeart" type="10004" summary="Unit test flake in TestSpawnEtcdRaft on Master branch" priority="2" resolution="10000" status="6" created="2019-08-09 18:23:50.0" updated="2019-08-26 03:31:37.0" resolutiondate="2019-08-26 03:31:37.0" votes="0" watches="4" workflowId="54756"> <description><! CDATA  2nd time seeing in a couple days:  https://jenkins.hyperledger.org/job/fabric-verify-unit-tests-x86_64/14350/console {code:java} 10:36:09 2019-08-09 14:33:53.491 UTC  test  TrackChain -> INFO 04c Adding foo to the set of chains to track 10:36:09 2019-08-09 14:33:53.491 UTC  test  TrackChain -> PANI 04d Called with a nil genesis block 10:36:09 2019-08-09 14:33:53.494 UTC  test  loadVerifier -> PANI 04e Failed obtaining ledger for channel mychannel 10:36:09 2019-08-09 14:33:53.496 UTC  test  loadVerifier -> ERRO 04f Channel mychannel has no blocks, skipping it 10:36:09 2019-08-09 14:33:53.498 UTC  test  loadVerifier -> PANI 050 Failed retrieving block  99  for channel mychannel 10:36:09 2019-08-09 14:33:53.499 UTC  test  loadVerifier -> PANI 051 Failed retrieving config block  99  for channel mychannel 10:36:09 2019-08-09 14:33:53.501 UTC  test  loadVerifier -> PANI 052 Failed extracting configuration for channel mychannel from block  21 : empty block 10:36:09 2019-08-09 14:33:53.506 UTC  test  loadVerifier -> PANI 053 Failed creating verifier for channel mychannel from block  99 : failed initializing MSP 10:36:09 2019-08-09 14:33:53.510 UTC  test  loadVerifier -> INFO 054 Loaded verifier for channel mychannel from config block at index 99 10:36:09 2019-08-09 14:33:54.835 UTC  orderer.common.server  func1 -> ERRO 055 Broadcast client triggered panic: runtime error: invalid memory address or nil pointer dereference 10:36:09 goroutine 140  running : 10:36:09 runtime/debug.Stack(0x2d0be10, 0x1, 0x1) 10:36:09 	/opt/go/go1.12.5.linux.amd64/src/runtime/debug/stack.go:24 +0xab 10:36:09 github.com/hyperledger/fabric/orderer/common/server.(*server).Broadcast.func1() 10:36:09 	/w/workspace/fabric-verify-unit-tests-x86_64/gopath/src/github.com/hyperledger/fabric/orderer/common/server/server.go:152 +0x15f 10:36:09 panic(0x1be8d40, 0x2c125b0) 10:36:09 	/opt/go/go1.12.5.linux.amd64/src/runtime/panic.go:522 +0x1b5 10:36:09 github.com/hyperledger/fabric/orderer/common/server.(*broadcastMsgTracer).Context(0xc0004cb2f0, 0xc000204e00, 0x1) 10:36:09 	<autogenerated>:1 +0x59 10:36:09 github.com/hyperledger/fabric/orderer/common/broadcast.(*Handler).Handle(0x0, 0x1fbc860, 0xc0004cb2f0, 0x1e, 0x0) 10:36:09 	/w/workspace/fabric-verify-unit-tests-x86_64/gopath/src/github.com/hyperledger/fabric/orderer/common/broadcast/broadcast.go:67 +0x5d 10:36:09 github.com/hyperledger/fabric/orderer/common/server.(*server).Broadcast(0xc000204f40, 0x0, 0x0, 0x0, 0x0) 10:36:09 	/w/workspace/fabric-verify-unit-tests-x86_64/gopath/src/github.com/hyperledger/fabric/orderer/common/server/server.go:156 +0x217 10:36:09 github.com/hyperledger/fabric/orderer/common/server.TestBroadcastNoPanic(0xc000d68300) 10:36:09 	/w/workspace/fabric-verify-unit-tests-x86_64/gopath/src/github.com/hyperledger/fabric/orderer/common/server/server_test.go:30 +0x55 10:36:09 testing.tRunner(0xc000d68300, 0x1dc5958) 10:36:09 	/opt/go/go1.12.5.linux.amd64/src/testing/testing.go:865 +0x164 10:36:09 created by testing.(*T).Run 10:36:09 	/opt/go/go1.12.5.linux.amd64/src/testing/testing.go:916 +0x65b 10:36:09 2019-08-09 14:33:54.836 UTC  orderer.common.server  func1 -> ERRO 056 Deliver client triggered panic: runtime error: invalid memory address or nil pointer dereference 10:36:09 goroutine 141  running : 10:36:09 runtime/debug.Stack(0x2d0be10, 0x1, 0x1) 10:36:09 	/opt/go/go1.12.5.linux.amd64/src/runtime/debug/stack.go:24 +0xab 10:36:09 github.com/hyperledger/fabric/orderer/common/server.(*server).Deliver.func1() 10:36:09 	/w/workspace/fabric-verify-unit-tests-x86_64/gopath/src/github.com/hyperledger/fabric/orderer/common/server/server.go:170 +0x15f 10:36:09 panic(0x1be8d40, 0x2c125b0) 10:36:09 	/opt/go/go1.12.5.linux.amd64/src/runtime/panic.go:522 +0x1b5 10:36:09 github.com/hyperledger/fabric/orderer/common/server.(*server).Deliver(0xc0004f55c0, 0x0, 0x0, 0x0, 0x0) 10:36:09 	/w/workspace/fabric-verify-unit-tests-x86_64/gopath/src/github.com/hyperledger/fabric/orderer/common/server/server.go:198 +0x382 10:36:09 github.com/hyperledger/fabric/orderer/common/server.TestDeliverNoPanic(0xc000d68400) 10:36:09 	/w/workspace/fabric-verify-unit-tests-x86_64/gopath/src/github.com/hyperledger/fabric/orderer/common/server/server_test.go:35 +0x84 10:36:09 testing.tRunner(0xc000d68400, 0x1dc59e8) 10:36:09 	/opt/go/go1.12.5.linux.amd64/src/testing/testing.go:865 +0x164 10:36:09 created by testing.(*T).Run 10:36:09 	/opt/go/go1.12.5.linux.amd64/src/testing/testing.go:916 +0x65b 10:36:09 2019-08-09 14:33:54.933 UTC  localconfig  completeInitialization -> INFO 057 Kafka.Version unset, setting to 0.10.2.0 10:36:09 2019-08-09 14:33:54.997 UTC  orderer.common.server  createSubDir -> PANI 058 Error creating sub dir: mkdir /tmp/foo/name: no such file or directory 10:36:09 2019-08-09 14:33:55.000 UTC  orderer.common.server  createTempDir -> PANI 059 Error creating temp dir: mkdir /tmp/foo/bar127401846: no such file or directory 10:36:09 --- FAIL: TestSpawnEtcdRaft (19.48s) 10:36:09     etcdraft_test.go:99:  10:36:09         No future change is possible.  Bailing out early after 0.022s. 10:36:09         Got stuck at: 10:36:09              10:36:09             	General.Cluster.TLSHandshakeTimeShift = 0s 10:36:09             	General.Keepalive.ServerMinInterval = 1m0s 10:36:09             	General.Keepalive.ServerInterval = 2h0m0s  ... 10:36:09             	Metrics.Statsd.WriteInterval = 30s 10:36:09             	Metrics.Statsd.Prefix = "" 10:36:09             2019-08-09 14:34:13.203 UTC  orderer.common.server  Main -> PANI 003 failed to initialize operations subsystem: listen tcp 127.0.0.1:8443: bind: address already in use 10:36:09             panic: failed to initialize operations subsystem: listen tcp 127.0.0.1:8443: bind: address already in use 10:36:09              10:36:09             goroutine 1  running : 10:36:09             github.com/hyperledger/fabric/vendor/go.uber.org/zap/zapcore.(*CheckedEntry).Write(0xc0001d51e0, 0x0, 0x0, 0x0) 10:36:09             	/w/workspace/fabric-verify-unit-tests-x86_64/gopath/src/github.com/hyperledger/fabric/vendor/go.uber.org/zap/zapcore/entry.go:229 +0x546 10:36:09             github.com/hyperledger/fabric/vendor/go.uber.org/zap.(*SugaredLogger).log(0xc000146308, 0x176fb04, 0x1620182, 0x2d, 0xc0003ddad8, 0x1, 0x1, 0x0, 0x0, 0x0) 10:36:09             	/w/workspace/fabric-verify-unit-tests-x86_64/gopath/src/github.com/hyperledger/fabric/vendor/go.uber.org/zap/sugar.go:234 +0x101 10:36:09             github.com/hyperledger/fabric/vendor/go.uber.org/zap.(*SugaredLogger).Panicf(...) 10:36:09             	/w/workspace/fabric-verify-unit-tests-x86_64/gopath/src/github.com/hyperledger/fabric/vendor/go.uber.org/zap/sugar.go:159 10:36:09             github.com/hyperledger/fabric/common/flogging.(*FabricLogger).Panicf(...) 10:36:09             	/w/workspace/fabric-verify-unit-tests-x86_64/gopath/src/github.com/hyperledger/fabric/common/flogging/zap.go:74 10:36:09             github.com/hyperledger/fabric/orderer/common/server.Main() 10:36:09             	/w/workspace/fabric-verify-unit-tests-x86_64/gopath/src/github.com/hyperledger/fabric/orderer/common/server/main.go:96 +0x440 10:36:09             main.main() 10:36:09             	/w/workspace/fabric-verify-unit-tests-x86_64/gopath/src/github.com/hyperledger/fabric/orderer/main.go:15 +0x20 10:36:09              10:36:09         Waiting for: 10:36:09             EvictionSuspicion not set, defaulting to 10m 10:36:09     --- FAIL: TestSpawnEtcdRaft/EtcdRaft_launch_success (0.24s) 10:36:09         testing.go:820: test executed panic(nil) or runtime.Goexit: subtest may have called FailNow on a parent test ... ... 10:36:09 FAIL	github.com/hyperledger/fabric/orderer/common/server	61.870s {code}    ></description> </Issue>
