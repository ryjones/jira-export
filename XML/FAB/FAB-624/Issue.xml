<Issue id="12926" key="FAB-624" number="624" project="10002" reporter="hgabre" assignee="hgabre" creator="hgabre" type="10004" summary="SBFT unit test TestRestartAfterCheckpoint sometimes fails" priority="3" resolution="10000" status="6" created="2016-10-07 13:21:26.0" updated="2018-07-20 14:10:25.0" resolutiondate="2016-11-01 10:05:10.0" votes="0" watches="5" timeoriginalestimate="57600" timeestimate="57600" workflowId="36403"> <description><! CDATA A bug of SBFT implementation: https://gerrit.hyperledger.org/r/#/c/1467/  TestRestartAfterCheckpoint sometimes (every 6th-7th test) fails with the following error message: --- FAIL: TestRestartAfterCheckpoint (0.15s) panic: runtime error: index out of range  recovered  panic: runtime error: index out of range  The error is caused by an uint64 overflow in calendarqueue. The root cause behind this might be that the primary node falls into an infinite loop of view changes resulting in a very high view change timeout.  The problem can be solved by making connectAll's (simplebft_test.go) adapter map (sys.adapters) iteration (for .. range) deterministic (go map iteration is non-deterministic). E.g.: keys := uint64slicetype{} for k, _ := range sys.adapters { keys = append(keys,uint64(k)) } sort.Sort(keys)  ></description> </Issue>
