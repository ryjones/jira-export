<Issue id="36614" key="FAB-13594" number="13594" project="10002" reporter="sykesm" assignee="wlahti" creator="sykesm" type="10004" summary="intermittent test failure in acl e2e test" priority="3" resolution="10000" status="6" created="2019-01-09 17:38:18.0" updated="2019-03-19 10:57:31.0" resolutiondate="2019-01-15 22:43:08.0" votes="0" watches="2" workflowId="48159"> <description><! CDATA Hit this in CR build:  https://gerrit.hyperledger.org/r/c/28569/  {code:java} 15:25:00 ------------------------------ 15:25:00 • Failure  35.962 seconds  15:25:00 EndToEndACL  It  enforces access control list policies  15:25:00 /w/workspace/fabric-verify-integration-tests-x86_64/gopath/src/github.com/hyperledger/fabric/integration/e2e/acl_test.go:91 15:25:00  15:25:00   Got stuck at: 15:25:00       2019-01-09 15:24:58.547 UTC  channelCmd  InitCmdFactory -> INFO 001 Endorser and orderer connections initialized 15:25:00       2019-01-09 15:24:58.671 UTC  cli.common  readBlock -> INFO 002 Received block: 5 15:25:00        15:25:00   Waiting for: 15:25:00       can't read the block: &{FORBIDDEN} 15:25:00  15:25:00   /w/workspace/fabric-verify-integration-tests-x86_64/gopath/src/github.com/hyperledger/fabric/integration/e2e/acl_test.go:154 15:25:00 ------------------------------ 15:25:02 ••PP 15:25:02  15:25:02 Summarizing 1 Failure: 15:25:02  15:25:02  Fail  EndToEndACL  It  enforces access control list policies  15:25:02 /w/workspace/fabric-verify-integration-tests-x86_64/gopath/src/github.com/hyperledger/fabric/integration/e2e/acl_test.go:154 15:25:02  15:25:02 Ran 5 of 11 Specs in 197.996 seconds 15:25:02 FAIL! -- 4 Passed | 1 Failed | 6 Pending | 0 Skipped {code} It looks like the config update was part of block 5 on org1Peer0 but that the block did not get committed at org2Peer0 before the assertions started to run. {code:java} 15:25:00  e  peer-channel-fetch  2019-01-09 15:24:57.463 UTC  channelCmd  InitCmdFactory -> INFO 001 Endorser and orderer connections initialized 15:25:00  e  peer-channel-fetch  2019-01-09 15:24:57.467 UTC  cli.common  readBlock -> INFO 002 Received block: 6 15:25:00  e  peer-channel-fetch  2019-01-09 15:24:57.468 UTC  cli.common  readBlock -> INFO 003 Received block: 6 15:25:00  e  OrdererOrg.orderer  2019-01-09 15:24:57.469 UTC  common.deliver  Handle -> WARN 0a6 Error reading from 127.0.0.1:42892: rpc error: code = Canceled desc = context canceled 15:25:00  e  OrdererOrg.orderer  2019-01-09 15:24:57.470 UTC  comm.grpc.server  1 -> INFO 0a7 streaming call completed {"grpc.start_time": "2019-01-09T15:24:57.464Z", "grpc.service": "orderer.AtomicBroadcast", "grpc.method": "Deliver", "grpc.peer_address": "127.0.0.1:42892", "error": "rpc error: code = Canceled desc = context canceled", "grpc.code": "Canceled", "grpc.call_duration": "5.501305ms"}  15:25:00 STEP: fetching the latest block from the peer as a permitted Org1 Admin identity 15:25:00  e  Org1.peer0  2019-01-09 15:24:57.503 UTC  kvledger  CommitWithPvtData -> INFO 071  testchannel  Committed block  4  with 1 transaction(s) in 4421ms (state_validation=0ms block_commit=4340ms state_commit=36ms) 15:25:00  e  Org1.peer0  2019-01-09 15:24:57.503 UTC  gossip.privdata  StoreBlock -> INFO 072  testchannel  Received block  5  from buffer 15:25:00  e  Org1.peer0  2019-01-09 15:24:57.505 UTC  committer.txvalidator  Validate -> INFO 073  testchannel  Validated block  5  in 1ms 15:25:00  e  Org2.peer0  2019-01-09 15:24:57.523 UTC  kvledger  CommitWithPvtData -> INFO 048  testchannel  Committed block  4  with 1 transaction(s) in 4433ms (state_validation=1ms block_commit=4348ms state_commit=31ms) 15:25:00  e  Org2.peer0  2019-01-09 15:24:57.523 UTC  gossip.privdata  StoreBlock -> INFO 049  testchannel  Received block  5  from buffer 15:25:00  e  Org2.peer0  2019-01-09 15:24:57.526 UTC  committer.txvalidator  Validate -> INFO 04a  testchannel  Validated block  5  in 2ms 15:25:00  e  peer-channel-fetch  2019-01-09 15:24:57.549 UTC  channelCmd  InitCmdFactory -> INFO 001 Endorser and orderer connections initialized 15:25:00  e  Org1.peer0  2019-01-09 15:24:58.476 UTC  kvledger  CommitWithPvtData -> INFO 074  testchannel  Committed block  5  with 1 transaction(s) in 970ms (state_validation=0ms block_commit=927ms state_commit=25ms) 15:25:00  e  Org1.peer0  2019-01-09 15:24:58.477 UTC  gossip.privdata  StoreBlock -> INFO 075  testchannel  Received block  6  from buffer 15:25:00  e  peer-channel-fetch  2019-01-09 15:24:58.478 UTC  cli.common  readBlock -> INFO 002 Received block: 4 15:25:00  e  Org1.peer0  2019-01-09 15:24:58.480 UTC  common.deliver  Handle -> WARN 076 Error reading from 127.0.0.1:44866: rpc error: code = Canceled desc = context canceled 15:25:00  e  Org1.peer0  2019-01-09 15:24:58.480 UTC  comm.grpc.server  1 -> INFO 077 streaming call completed {"grpc.start_time": "2019-01-09T15:24:57.55Z", "grpc.service": "protos.Deliver", "grpc.method": "Deliver", "grpc.peer_address": "127.0.0.1:44866", "error": "rpc error: code = Canceled desc = context canceled", "grpc.code": "Canceled", "grpc.call_duration": "929.862701ms"}  15:25:00 STEP: fetching the latest block from the peer as a forbidden org2 Admin identity 15:25:00  e  Org1.peer0  2019-01-09 15:24:58.487 UTC  committer.txvalidator  Validate -> INFO 078  testchannel  Validated block  6  in 9ms 15:25:00  e  peer-channel-fetch  2019-01-09 15:24:58.547 UTC  channelCmd  InitCmdFactory -> INFO 001 Endorser and orderer connections initialized 15:25:00  e  Org2.peer0  2019-01-09 15:24:58.669 UTC  kvledger  CommitWithPvtData -> INFO 04b  testchannel  Committed block  5  with 1 transaction(s) in 1142ms (state_validation=0ms block_commit=940ms state_commit=25ms) 15:25:00  e  Org2.peer0  2019-01-09 15:24:58.670 UTC  gossip.privdata  StoreBlock -> INFO 04c  testchannel  Received block  6  from buffer 15:25:00  e  peer-channel-fetch  2019-01-09 15:24:58.671 UTC  cli.common  readBlock -> INFO 002 Received block: 5 15:25:00  e  Org2.peer0  2019-01-09 15:24:58.673 UTC  common.deliver  Handle -> WARN 04d Error reading from 127.0.0.1:37192: rpc error: code = Canceled desc = context canceled 15:25:00  e  Org2.peer0  2019-01-09 15:24:58.673 UTC  comm.grpc.server  1 -> INFO 04e streaming call completed {"grpc.start_time": "2019-01-09T15:24:58.548Z", "grpc.service": "protos.Deliver", "grpc.method": "Deliver", "grpc.peer_address": "127.0.0.1:37192", "error": "rpc error: code = Canceled desc = context canceled", "grpc.code": "Canceled", "grpc.call_duration": "125.349035ms"} 15:25:00  e  Org2.peer0  2019-01-09 15:24:58.678 UTC  nodeCmd  handleSignals -> INFO 04f Received signal: 15 (terminated) 15:25:00  e  Org1.peer0  2019-01-09 15:24:58.678 UTC  nodeCmd  handleSignals -> INFO 079 Received signal: 15 (terminated) 15:25:00  e  Org1.peer0  2019-01-09 15:24:58.678 UTC  gossip.service  Stop -> INFO 07a Stopping chain testchannel 15:25:00  e  Org2.peer0  2019-01-09 15:24:58.678 UTC  gossip.service  Stop -> INFO 050 Stopping chain testchannel 15:25:00  e  Org1.peer0  2019-01-09 15:24:58.678 UTC  gossip.service  Stop -> INFO 07b Stopping leader election for testchannel 15:25:00  e  Org2.peer0  2019-01-09 15:24:58.678 UTC  gossip.service  Stop -> INFO 051 Stopping leader election for testchannel 15:25:00  e  Org2.peer0  2019-01-09 15:24:58.688 UTC  committer.txvalidator  Validate -> INFO 052  testchannel  Validated block  6  in 18ms 15:25:00  e  Org1.peer0  2019-01-09 15:25:00.436 UTC  kvledger  CommitWithPvtData -> INFO 07c  testchannel  Committed block  6  with 1 transaction(s) in 1949ms (state_validation=0ms block_commit=1910ms state_commit=19ms) 15:25:00  e  Org1.peer0  2019-01-09 15:25:00.437 UTC  gossip.gossip  Stop -> INFO 07d Stopping gossip 15:25:00  e  Org1.peer0  2019-01-09 15:25:00.437 UTC  gossip.discovery  Stop -> INFO 07e Stopping 15:25:00  e  Org1.peer0  2019-01-09 15:25:00.437 UTC  gossip.discovery  Stop -> INFO 07f Stopped 15:25:00  e  Org1.peer0  2019-01-09 15:25:00.437 UTC  deliveryClient  try -> WARN 080 Got error: rpc error: code = Canceled desc = context canceled , at 1 attempt. Retrying in 1s 15:25:00  e  Org1.peer0  2019-01-09 15:25:00.437 UTC  blocksProvider  DeliverBlocks -> WARN 081  testchannel  Receive error: client is closing 15:25:00  e  Org1.peer0  2019-01-09 15:25:00.437 UTC  gossip.comm  Stop -> INFO 082 Stopping 15:25:00  e  Org1.peer0  2019-01-09 15:25:00.437 UTC  gossip.comm  Stop -> INFO 083 Stopped 15:25:00  e  Org1.peer0  2019-01-09 15:25:00.437 UTC  gossip.election  stopBeingLeader -> INFO 084 7526d7fdca921600fc59b5f1f75f3d65592fa6a5bb446631028c54e1c00b468e Stopped being a leader 15:25:00  e  Org1.peer0  2019-01-09 15:25:00.437 UTC  gossip.service  func1 -> INFO 085 Renounced leadership, stopping delivery service for channel testchannel 15:25:00  e  OrdererOrg.orderer  2019-01-09 15:25:00.437 UTC  comm.grpc.server  1 -> INFO 0a8 streaming call completed {"grpc.start_time": "2019-01-09T15:24:33.009Z", "grpc.service": "orderer.AtomicBroadcast", "grpc.method": "Deliver", "grpc.peer_address": "127.0.0.1:42704", "grpc.peer_subject": "CN=peer0.org1.example.com,L=San Francisco,ST=California,C=US", "error": "context finished before block retrieved: context canceled", "grpc.code": "Unknown", "grpc.call_duration": "27.428281248s"} 15:25:00  e  Org2.peer0  2019-01-09 15:25:00.442 UTC  kvledger  CommitWithPvtData -> INFO 053  testchannel  Committed block  6  with 1 transaction(s) in 1753ms (state_validation=1ms block_commit=1742ms state_commit=6ms) 15:25:00  e  Org2.peer0  2019-01-09 15:25:00.443 UTC  deliveryClient  try -> WARN 055 Got error: rpc error: code = Canceled desc = context canceled , at 1 attempt. Retrying in 1s 15:25:00  e  Org2.peer0  2019-01-09 15:25:00.444 UTC  blocksProvider  DeliverBlocks -> WARN 056  testchannel  Receive error: client is closing 15:25:00  e  Org2.peer0  2019-01-09 15:25:00.443 UTC  gossip.gossip  Stop -> INFO 054 Stopping gossip 15:25:00  e  OrdererOrg.orderer  2019-01-09 15:25:00.444 UTC  comm.grpc.server  1 -> INFO 0a9 streaming call completed {"grpc.start_time": "2019-01-09T15:24:33.703Z", "grpc.service": "orderer.AtomicBroadcast", "grpc.method": "Deliver", "grpc.peer_address": "127.0.0.1:42706", "grpc.peer_subject": "CN=peer0.org2.example.com,L=San Francisco,ST=California,C=US", "error": "context finished before block retrieved: context canceled", "grpc.code": "Unknown", "grpc.call_duration": "26.741174403s"} 15:25:00  e  Org2.peer0  2019-01-09 15:25:00.444 UTC  gossip.discovery  Stop -> INFO 057 Stopping 15:25:00  e  Org2.peer0  2019-01-09 15:25:00.444 UTC  gossip.discovery  Stop -> INFO 058 Stopped 15:25:00  e  Org2.peer0  2019-01-09 15:25:00.444 UTC  gossip.comm  Stop -> INFO 059 Stopping 15:25:00  e  Org2.peer0  2019-01-09 15:25:00.444 UTC  gossip.comm  Stop -> INFO 05a Stopped 15:25:00  e  OrdererOrg.orderer  2019-01-09 15:25:00.448 UTC  orderer.common.server  handleSignals -> INFO 0aa Received signal: 15 (terminated) 15:25:00  15:25:00 ------------------------------ 15:25:00 • Failure  35.962 seconds  {code}  /cc  ~wlahti  - I think you may have written these initially?  ></description> </Issue>
