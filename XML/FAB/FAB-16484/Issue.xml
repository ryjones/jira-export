<Issue id="42133" key="FAB-16484" number="16484" project="10002" reporter="steveliuu" creator="steveliuu" type="10004" summary="Channel creation failed when processMessagesToBlocks didn&apos;t work" priority="3" status="10701" created="2019-08-30 09:02:03.0" updated="2020-11-19 22:21:22.0" votes="0" watches="4" workflowId="55180"> <description><! CDATA *Development environment:* Kubernetes, fabric node sdk  *Fabric network:* one orderer, two orgs with 2 peers  *Fabric version:*Â 1.4.2  *Kafka consensus:* 4 kafka brokers, 3 zookeepers  We have built a fabric network successfully several times but the success probability is around 50/50. Sometimes the channel can't be created. Sometimes query chaincode is unavailable after instantiating chaincode but the configs are exactly the same. After tracing orderer logs, we found that the `processMessagesToBlocks` function didn't work properly. The orderer didn't invoke theÂ processMessagesToBlocks function when errors occur. On the contrary, everything works fine whenÂ processMessagesToBlocks shows in the orderer log. The followings are the logs:Â  {code:java} # successfully create channel   34m2019-08-29 06:04:31.912 UTC  orderer.consensus.kafka  startThread -> INFO 649 0m  channel: mychannel  Start phase completed successfully  36m2019-08-29 06:04:31.912 UTC  orderer.consensus.kafka  processMessagesToBlocks -> DEBU 64a 0m  channel: mychannel  Successfully unmarshalled consumed message, offset is 0. Inspecting type...  36m2019-08-29 06:04:31.912 UTC  orderer.consensus.kafka  processConnect -> DEBU 64b 0m  channel: mychannel  It's a connect message - ignoring  # fail to create channel  34m2019-08-29 08:52:57.604 UTC  orderer.consensus.kafka  startThread -> INFO 636 0m  channel: mychannel  Start phase completed successfully  36m2019-08-29 08:52:57.604 UTC  orderer.consensus.kafka.sarama  func1 -> DEBU 637 0m Closed connection to broker kafka-2.broker.kafka:9092{code} The error only occurs when using the kafka consensus. Everything works fine when using solo.  startThread logs are uploaded to Attachments.  Â   ></description> </Issue>
