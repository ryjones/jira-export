<Action id="70632" issue="46306" author="sykesm" type="comment" created="2020-11-09 15:18:22.0" updateauthor="sykesm" updated="2020-11-09 15:18:22.0"> <body><! CDATA Additional race reported in same execution and in same test:  {code} ================== WARNING: DATA RACE Write at 0x00c00169ce20 by goroutine 145: github.com/hyperledger/fabric/orderer/common/cluster_test.(*clusterNode).renewCertificates() /Users/sykesm/workspace/fabric/src/github.com/hyperledger/fabric/orderer/common/cluster/comm_test.go:216 +0x525 github.com/hyperledger/fabric/orderer/common/cluster_test.TestRenewCertificates() /Users/sykesm/workspace/fabric/src/github.com/hyperledger/fabric/orderer/common/cluster/comm_test.go:877 +0x856 testing.tRunner() /usr/local/Cellar/go@1.14/1.14.11/libexec/src/testing/testing.go:1050 +0x1eb  Previous read at 0x00c00169ce20 by goroutine 170: github.com/hyperledger/fabric/orderer/common/cluster.(*PredicateDialer).Dial.func1() /Users/sykesm/workspace/fabric/src/github.com/hyperledger/fabric/orderer/common/cluster/util.go:161 +0x9e github.com/hyperledger/fabric/internal/pkg/comm.(*DynamicClientCredentials).latestConfig() /Users/sykesm/workspace/fabric/src/github.com/hyperledger/fabric/internal/pkg/comm/creds.go:145 +0xb4 github.com/hyperledger/fabric/internal/pkg/comm.(*DynamicClientCredentials).Info() /Users/sykesm/workspace/fabric/src/github.com/hyperledger/fabric/internal/pkg/comm/creds.go:168 +0x59 google.golang.org/grpc/internal/transport.newHTTP2Client() /Users/sykesm/workspace/fabric/src/github.com/hyperledger/fabric/vendor/google.golang.org/grpc/internal/transport/http2_client.go:230 +0x2e75 google.golang.org/grpc/internal/transport.NewClientTransport() /Users/sykesm/workspace/fabric/src/github.com/hyperledger/fabric/vendor/google.golang.org/grpc/internal/transport/transport.go:577 +0x6c5 google.golang.org/grpc.(*addrConn).createTransport() /Users/sykesm/workspace/fabric/src/github.com/hyperledger/fabric/vendor/google.golang.org/grpc/clientconn.go:1282 +0x4e4 google.golang.org/grpc.(*addrConn).tryAllAddrs() /Users/sykesm/workspace/fabric/src/github.com/hyperledger/fabric/vendor/google.golang.org/grpc/clientconn.go:1212 +0x561 google.golang.org/grpc.(*addrConn).resetTransport() /Users/sykesm/workspace/fabric/src/github.com/hyperledger/fabric/vendor/google.golang.org/grpc/clientconn.go:1127 +0x30a  Goroutine 145 (running) created at: testing.(*T).Run() /usr/local/Cellar/go@1.14/1.14.11/libexec/src/testing/testing.go:1095 +0x537 testing.runTests.func1() /usr/local/Cellar/go@1.14/1.14.11/libexec/src/testing/testing.go:1339 +0xa6 testing.tRunner() /usr/local/Cellar/go@1.14/1.14.11/libexec/src/testing/testing.go:1050 +0x1eb testing.runTests() /usr/local/Cellar/go@1.14/1.14.11/libexec/src/testing/testing.go:1337 +0x594 testing.(*M).Run() /usr/local/Cellar/go@1.14/1.14.11/libexec/src/testing/testing.go:1252 +0x2ff main.main() _testmain.go:262 +0x337  Goroutine 170 (running) created at: google.golang.org/grpc.(*addrConn).connect() /Users/sykesm/workspace/fabric/src/github.com/hyperledger/fabric/vendor/google.golang.org/grpc/clientconn.go:813 +0x103 google.golang.org/grpc.(*acBalancerWrapper).Connect() /Users/sykesm/workspace/fabric/src/github.com/hyperledger/fabric/vendor/google.golang.org/grpc/balancer_conn_wrappers.go:239 +0x92 google.golang.org/grpc.(*pickfirstBalancer).UpdateClientConnState() /Users/sykesm/workspace/fabric/src/github.com/hyperledger/fabric/vendor/google.golang.org/grpc/pickfirst.go:85 +0x752 google.golang.org/grpc.(*ccBalancerWrapper).updateClientConnState() /Users/sykesm/workspace/fabric/src/github.com/hyperledger/fabric/vendor/google.golang.org/grpc/balancer_conn_wrappers.go:122 +0x173 google.golang.org/grpc.(*ClientConn).updateResolverState() /Users/sykesm/workspace/fabric/src/github.com/hyperledger/fabric/vendor/google.golang.org/grpc/clientconn.go:660 +0x40b google.golang.org/grpc.(*ccResolverWrapper).UpdateState() /Users/sykesm/workspace/fabric/src/github.com/hyperledger/fabric/vendor/google.golang.org/grpc/resolver_conn_wrapper.go:148 +0x2b5 google.golang.org/grpc/internal/resolver/passthrough.(*passthroughResolver).start() /Users/sykesm/workspace/fabric/src/github.com/hyperledger/fabric/vendor/google.golang.org/grpc/internal/resolver/passthrough/passthrough.go:48 +0x1f1 google.golang.org/grpc/internal/resolver/passthrough.(*passthroughBuilder).Build() /Users/sykesm/workspace/fabric/src/github.com/hyperledger/fabric/vendor/google.golang.org/grpc/internal/resolver/passthrough/passthrough.go:34 +0xdd google.golang.org/grpc.newCCResolverWrapper() /Users/sykesm/workspace/fabric/src/github.com/hyperledger/fabric/vendor/google.golang.org/grpc/resolver_conn_wrapper.go:74 +0x451 google.golang.org/grpc.DialContext() /Users/sykesm/workspace/fabric/src/github.com/hyperledger/fabric/vendor/google.golang.org/grpc/clientconn.go:307 +0x1053 github.com/hyperledger/fabric/internal/pkg/comm.(*GRPCClient).NewConnection() /Users/sykesm/workspace/fabric/src/github.com/hyperledger/fabric/internal/pkg/comm/client.go:205 +0x56a github.com/hyperledger/fabric/orderer/common/cluster.(*PredicateDialer).Dial() /Users/sykesm/workspace/fabric/src/github.com/hyperledger/fabric/orderer/common/cluster/util.go:157 +0x394 github.com/hyperledger/fabric/orderer/common/cluster.(*ConnectionStore).connect() /Users/sykesm/workspace/fabric/src/github.com/hyperledger/fabric/orderer/common/cluster/connections.go:110 +0x1f6 github.com/hyperledger/fabric/orderer/common/cluster.(*ConnectionStore).Connection() /Users/sykesm/workspace/fabric/src/github.com/hyperledger/fabric/orderer/common/cluster/connections.go:94 +0x188 github.com/hyperledger/fabric/orderer/common/cluster.(*Comm).createRemoteContext.func1() /Users/sykesm/workspace/fabric/src/github.com/hyperledger/fabric/orderer/common/cluster/comm.go:333 +0x307 github.com/hyperledger/fabric/orderer/common/cluster.(*Stub).Activate() /Users/sykesm/workspace/fabric/src/github.com/hyperledger/fabric/orderer/common/cluster/comm.go:433 +0x119 github.com/hyperledger/fabric/orderer/common/cluster.(*Comm).updateStubInMapping() /Users/sykesm/workspace/fabric/src/github.com/hyperledger/fabric/orderer/common/cluster/comm.go:316 +0x371 github.com/hyperledger/fabric/orderer/common/cluster.(*Comm).applyMembershipConfig() /Users/sykesm/workspace/fabric/src/github.com/hyperledger/fabric/orderer/common/cluster/comm.go:271 +0x2f2 github.com/hyperledger/fabric/orderer/common/cluster.(*Comm).Configure() /Users/sykesm/workspace/fabric/src/github.com/hyperledger/fabric/orderer/common/cluster/comm.go:212 +0x372 github.com/hyperledger/fabric/orderer/common/cluster_test.TestRenewCertificates() /Users/sykesm/workspace/fabric/src/github.com/hyperledger/fabric/orderer/common/cluster/comm_test.go:871 +0x7d8 testing.tRunner() /usr/local/Cellar/go@1.14/1.14.11/libexec/src/testing/testing.go:1050 +0x1eb ================== {code}  ></body> </Action>
<Action id="70641" issue="46306" author="yacovm" type="comment" body="https://github.com/hyperledger/fabric/pull/2089" created="2020-11-09 19:16:58.0" updateauthor="yacovm" updated="2020-11-09 19:16:58.0"/>
