<Issue id="27982" key="FAB-8496" number="8496" project="10002" reporter="rennman" assignee="luomin" creator="rennman" type="10001" summary="fabric-ca sample does not allow modification of affiliations" priority="3" resolution="10000" status="6" created="2018-02-24 01:14:26.0" updated="2018-07-20 18:48:59.0" resolutiondate="2018-03-07 23:01:51.0" votes="0" watches="4" workflowId="41351"> <description><! CDATA Updating the orgs for the fabric-ca sample does not have an effect. If I modify the {{env.sh}} script: {code:none} # Names of the orderer organizations ORDERER_ORGS="eu"  # Names of the peer organizations PEER_ORGS="fr ge it sp" {code} The register attempts fail with a message like: {{  Failed to get Affiliation: sql: no rows in result set}}  This is because the server init/start sequence relies on all of the config defaults, so only the default affiliations are available. It requires a little massaging of the start-up scripts:  a) in {{makeDocker.sh}}: {code:none} writeRootCA() ... environment: - FABRIC_ORGS="$ORGS" {code} and {code:none} writeIntermediateCA() ... environment: - FABRIC_ORGS="$ORGS"{code} b) in both {{./scripts/start-root-ca.sh}} and {{./scripts/start-intermediate-ca.sh}}: {code:none} # Add custom orgs for o in $FABRIC_ORGS; do    aff=$aff"\n   $o:   " done aff="${aff#\\n   }" sed -i "/affiliations:/a \\   $aff" \    $FABRIC_CA_SERVER_HOME/fabric-ca-server-config.yaml {code} Now the start.sh tests pass.  ></description> </Issue>
