<Issue id="37070" key="FAB-13843" number="13843" project="10002" reporter="guoger" assignee="yacovm" creator="guoger" type="10004" summary="intermittent test failure in core/cclifecycle" priority="3" resolution="10000" status="6" created="2019-01-23 06:13:10.0" updated="2019-02-06 14:32:45.0" resolutiondate="2019-01-24 21:56:43.0" votes="0" watches="4" workflowId="48645"> <description><! CDATA https://jenkins.hyperledger.org/job/fabric-verify-unit-tests-x86_64/8239/console  {code} 12:55:33 ================== 12:55:33 WARNING: DATA RACE 12:55:33 Write at 0x000001d3e110 by goroutine 26: 12:55:33   github.com/hyperledger/fabric/core/cclifecycle_test.newLogRecorder() 12:55:33       /w/workspace/fabric-verify-unit-tests-x86_64/gopath/src/github.com/hyperledger/fabric/core/cclifecycle/lifecycle_test.go:464 +0x99 12:55:33   github.com/hyperledger/fabric/core/cclifecycle_test.TestMetadata() 12:55:33       /w/workspace/fabric-verify-unit-tests-x86_64/gopath/src/github.com/hyperledger/fabric/core/cclifecycle/lifecycle_test.go:344 +0x53 12:55:33   testing.tRunner() 12:55:33       /opt/go/go1.11.1.linux.amd64/src/testing/testing.go:827 +0x162 12:55:33  12:55:33 Previous read at 0x000001d3e110 by goroutine 25: 12:55:33   github.com/hyperledger/fabric/core/cclifecycle.(*Lifecycle).fireChangeListeners() 12:55:33       /w/workspace/fabric-verify-unit-tests-x86_64/gopath/src/github.com/hyperledger/fabric/core/cclifecycle/lifecycle.go:188 +0x2a4 12:55:33   github.com/hyperledger/fabric/core/cclifecycle.(*Subscription).processPendingUpdate() 12:55:33       /w/workspace/fabric-verify-unit-tests-x86_64/gopath/src/github.com/hyperledger/fabric/core/cclifecycle/subscription.go:57 +0x6e5 12:55:33   github.com/hyperledger/fabric/core/cclifecycle.(*Subscription).ChaincodeDeployDone.func1() 12:55:33       /w/workspace/fabric-verify-unit-tests-x86_64/gopath/src/github.com/hyperledger/fabric/core/cclifecycle/subscription.go:79 +0x131 12:55:33  12:55:33 Goroutine 26 (running) created at: 12:55:33   testing.(*T).Run() 12:55:33       /opt/go/go1.11.1.linux.amd64/src/testing/testing.go:878 +0x650 12:55:33   testing.runTests.func1() 12:55:33       /opt/go/go1.11.1.linux.amd64/src/testing/testing.go:1119 +0xa8 12:55:33   testing.tRunner() 12:55:33       /opt/go/go1.11.1.linux.amd64/src/testing/testing.go:827 +0x162 12:55:33   testing.runTests() 12:55:33       /opt/go/go1.11.1.linux.amd64/src/testing/testing.go:1117 +0x4ee 12:55:33   testing.(*M).Run() 12:55:33       /opt/go/go1.11.1.linux.amd64/src/testing/testing.go:1034 +0x2ee 12:55:33   main.main() 12:55:33       _testmain.go:112 +0x332 12:55:33  12:55:33 Goroutine 25 (finished) created at: 12:55:33   github.com/hyperledger/fabric/core/cclifecycle.(*Subscription).ChaincodeDeployDone() 12:55:33       /w/workspace/fabric-verify-unit-tests-x86_64/gopath/src/github.com/hyperledger/fabric/core/cclifecycle/subscription.go:68 +0x7d 12:55:33   github.com/hyperledger/fabric/core/cclifecycle_test.TestMultipleUpdates() 12:55:33       /w/workspace/fabric-verify-unit-tests-x86_64/gopath/src/github.com/hyperledger/fabric/core/cclifecycle/lifecycle_test.go:320 +0x1399 12:55:33   testing.tRunner() 12:55:33       /opt/go/go1.11.1.linux.amd64/src/testing/testing.go:827 +0x162 12:55:33 ================== 12:55:33 --- FAIL: TestMetadata (0.01s) 12:55:33     <autogenerated>:1:    Metadata -> WARN 0021 Requested Metadata for non-existent channel mychannel 12:55:33     <autogenerated>:1:    queryChaincodeDefinitions -> DEBU 0022 Chaincode {cc1 1.0  42 } 's version is 1.0 and Id is  42  12:55:33     <autogenerated>:1:    DeployedChaincodes -> DEBU 0023 Returning  {cc1 1.0  1 2 3 4 5   42    }  12:55:33     <autogenerated>:1:    fireChangeListeners -> DEBU 0024 Listeners for channel mychannel invoked 12:55:33     <autogenerated>:1:    Metadata -> DEBU 0025 Returning metadata for channel mychannel , chaincode cc1 : {cc1 1.0  1 2 3 4 5   42    } 12:55:33     <autogenerated>:1:    Metadata -> ERRO 0026 Failed obtaining new query for channel mychannel : failed obtaining query executor 12:55:33     <autogenerated>:1:    DeployedChaincodes -> ERRO 0027 Failed querying lscc namespace: GetState failed 12:55:33     <autogenerated>:1:    Metadata -> ERRO 0028 Failed querying LSCC for channel mychannel : GetState failed 12:55:33     <autogenerated>:1:    DeployedChaincodes -> INFO 0029 Chaincode cc2 isn't instantiated 12:55:33     <autogenerated>:1:    DeployedChaincodes -> DEBU 002a Returning    12:55:33     <autogenerated>:1:    Metadata -> INFO 002b Chaincode cc2 isn't defined in channel mychannel 12:55:33     <autogenerated>:1:    DeployedChaincodes -> DEBU 002c Returning  {cc2 1.0     42    }  12:55:33     <autogenerated>:1:    DeployedChaincodes -> DEBU 002d Retrieved collection config for cc1 from cc1~collection 12:55:33     <autogenerated>:1:    DeployedChaincodes -> DEBU 002e Returning  {cc1 1.0  1 2 3 4 5   42   10 10 10 }  12:55:33     <autogenerated>:1:    DeployedChaincodes -> ERRO 002f Failed querying lscc namespace for cc1~collection: foo 12:55:33     <autogenerated>:1:    Metadata -> ERRO 0030 Failed querying LSCC for channel mychannel : foo 12:55:33     testing.go:771: race detected during execution of test 12:55:33 2019-01-23 04:54:32.702 UTC  discovery.lifecycle  DeployedChaincodes -> ERRO 031 Failed querying lscc namespace: failed querying ledger 12:55:33 2019-01-23 04:54:32.703 UTC  discovery.lifecycle  DeployedChaincodes -> ERRO 032 Failed extracting chaincode info about cc1 from LSCC returned payload. Error: failed unmarshaling lscc read value into ChaincodeData: proto: ccprovider.ChaincodeData: illegal tag 0 (wire type 0) 12:55:33 2019-01-23 04:54:32.703 UTC  discovery.lifecycle  DeployedChaincodes -> ERRO 033 Chaincode cc1 is listed in LSCC as cc2 12:55:33 2019-01-23 04:54:32.704 UTC  discovery.lifecycle  DeployedChaincodes -> INFO 034 Chaincode cc1 isn't instantiated 12:55:33 FAIL 12:55:33 coverage: 99.3% of statements 12:55:33 FAIL	github.com/hyperledger/fabric/core/cclifecycle	0.423s {code}  cc  ~sykesm   ></description> </Issue>
