<Issue id="15216" key="FAB-2649" number="2649" project="10002" reporter="yacovm" assignee="gennadyl" creator="yacovm" type="10004" summary="Viper concurrent read/write bug at discovery" priority="3" resolution="10000" status="6" created="2017-03-06 00:05:20.0" updated="2019-03-19 11:13:24.0" resolutiondate="2017-06-07 08:35:23.0" votes="0" watches="3" workflowId="37699"> <description><! CDATA https://jenkins.hyperledger.org/job/fabric-verify-x86_64/8202/consoleFull  23:53:44  32munit-tests_1  | 0m  33m2017-03-05 23:53:43.712 UTC  gossip/discovery#localhost:8610  func1 -> WARN 4bd 0m Could not connect to {localhost:8612       localhost:8612} 23:53:44  32munit-tests_1  | 0m fatal error: concurrent map read and map write 23:53:44  32munit-tests_1  | 0m  23:53:44  32munit-tests_1  | 0m goroutine 10620  running : 23:53:44  32munit-tests_1  | 0m runtime.throw(0x9f6a96, 0x21) 23:53:44  32munit-tests_1  | 0m 	/opt/go/src/runtime/panic.go:566 +0x95 fp=0xc4200348b8 sp=0xc420034898 23:53:44  32munit-tests_1  | 0m runtime.mapaccess2_faststr(0x947e20, 0xc4201550e0, 0xc4237f17a0, 0x22, 0xebeae0, 0xc420034900) 23:53:44  32munit-tests_1  | 0m 	/opt/go/src/runtime/hashmap_fast.go:306 +0x52b fp=0xc420034918 sp=0xc4200348b8 23:53:44  32munit-tests_1  | 0m github.com/hyperledger/fabric/vendor/github.com/spf13/viper.(*Viper).find(0xc42014e680, 0xc4237f17a0, 0x22, 0x22, 0xc4237f1740) 23:53:44  32munit-tests_1  | 0m 	/opt/gopath/src/github.com/hyperledger/fabric/vendor/github.com/spf13/viper/viper.go:628 +0x13a fp=0xc420034ca0 sp=0xc420034918 23:53:44  32munit-tests_1  | 0m github.com/hyperledger/fabric/vendor/github.com/spf13/viper.(*Viper).Get(0xc42014e680, 0x9f78d8, 0x22, 0x1d, 0x3b9aca00) 23:53:44  32munit-tests_1  | 0m 	/opt/gopath/src/github.com/hyperledger/fabric/vendor/github.com/spf13/viper/viper.go:404 +0xe5 fp=0xc420034db0 sp=0xc420034ca0 23:53:44  32munit-tests_1  | 0m github.com/hyperledger/fabric/vendor/github.com/spf13/viper.(*Viper).GetDuration(0xc42014e680, 0x9f78d8, 0x22, 0xc420034e30) 23:53:44  32munit-tests_1  | 0m 	/opt/gopath/src/github.com/hyperledger/fabric/vendor/github.com/spf13/viper/viper.go:481 +0x3f fp=0xc420034de8 sp=0xc420034db0 23:53:44  32munit-tests_1  | 0m github.com/hyperledger/fabric/vendor/github.com/spf13/viper.GetDuration(0x9f78d8, 0x22, 0x3b9aca00) 23:53:44  32munit-tests_1  | 0m 	/opt/gopath/src/github.com/hyperledger/fabric/vendor/github.com/spf13/viper/viper.go:479 +0x41 fp=0xc420034e18 sp=0xc420034de8 23:53:44  32munit-tests_1  | 0m github.com/hyperledger/fabric/gossip/util.GetDurationOrDefault(0x9f78d8, 0x22, 0x12a05f200, 0x5311db) 23:53:44  32munit-tests_1  | 0m 	/opt/gopath/src/github.com/hyperledger/fabric/gossip/util/misc.go:156 +0x35 fp=0xc420034e40 sp=0xc420034e18 23:53:44  32munit-tests_1  | 0m github.com/hyperledger/fabric/gossip/discovery.getAliveExpirationTimeout(0x0) 23:53:44  32munit-tests_1  | 0m 	/opt/gopath/src/github.com/hyperledger/fabric/gossip/discovery/discovery_impl.go:906 +0x48 fp=0xc420034e70 sp=0xc420034e40 23:53:44  32munit-tests_1  | 0m github.com/hyperledger/fabric/gossip/discovery.getReconnectInterval(0xc423b74ed0) 23:53:44  32munit-tests_1  | 0m 	/opt/gopath/src/github.com/hyperledger/fabric/gossip/discovery/discovery_impl.go:918 +0x22 fp=0xc420034ea0 sp=0xc420034e70 23:53:44  32munit-tests_1  | 0m github.com/hyperledger/fabric/gossip/discovery.(*gossipDiscoveryImpl).Connect.func1(0xc4212b7860, 0xc423b87040, 0xe, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0xc423b87040, ...) 23:53:44  32munit-tests_1  | 0m 	/opt/gopath/src/github.com/hyperledger/fabric/gossip/discovery/discovery_impl.go:152 +0x24c fp=0xc420034f50 sp=0xc420034ea0 23:53:44  32munit-tests_1  | 0m runtime.goexit()  ></description> </Issue>
