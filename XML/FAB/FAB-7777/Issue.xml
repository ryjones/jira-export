<Issue id="26884" key="FAB-7777" number="7777" project="10002" reporter="denyeart" assignee="manish-sethi" creator="denyeart" type="10004" summary="Peer panic if invalid couchdb index json passed to chaincode instantiate" priority="2" resolution="10000" status="6" created="2018-01-17 18:26:03.0" updated="2018-07-20 14:15:28.0" resolutiondate="2018-02-16 19:26:58.0" votes="0" watches="1" workflowId="40986"> <description><! CDATA Since couchdb indexes that are included in chaincode installation package are deployed at time of instantiation in the commit path, if there are errors deploying the indexes to couchdb (e.g. bad index definition provided or an operational issue on a single peer's couchdb), then the commit path cannot continue processing subsequent blocks and peer panics.  Here is an example panic of current behavior:  2018-01-17 05:10:49.132 UTC  statecouchdb  HandleChaincodeDeploy -> DEBU 3b1 Reading artifact from file: META-INF/statedb/couchdb/indexes/indexOwner_BAD.json 2018-01-17 05:10:49.132 UTC  statecouchdb  HandleChaincodeDeploy -> DEBU 3b2 Creating index from file file: indexOwner_BAD.json 2018-01-17 05:10:49.132 UTC  couchdb  CreateIndex -> DEBU 3b3 Entering CreateIndex()  indexdefinition=XXXXXXXXXXXXX BAD JSON data XXXXXXXXXXX 2018-01-17 05:10:49.132 UTC  cceventmgmt  HandleChaincodeDeploy -> WARN 3b4 Error while invoking a listener for handling chaincode install event: JSON format is not valid 2018-01-17 05:10:49.132 UTC  gossip/state  commitBlock -> ERRO 3b5 Got error while committing(JSON format is not valid commit failed github.com/hyperledger/fabric/gossip/privdata.(*coordinator).StoreBlock     /opt/gopath/src/github.com/hyperledger/fabric/gossip/privdata/coordinator.go:225 github.com/hyperledger/fabric/gossip/state.(*GossipStateProviderImpl).commitBlock     /opt/gopath/src/github.com/hyperledger/fabric/gossip/state/state.go:781 github.com/hyperledger/fabric/gossip/state.(*GossipStateProviderImpl).deliverPayloads     /opt/gopath/src/github.com/hyperledger/fabric/gossip/state/state.go:561 runtime.goexit     /opt/go/src/runtime/asm_amd64.s:2337 github.com/hyperledger/fabric/gossip/state.(*GossipStateProviderImpl).commitBlock     /opt/gopath/src/github.com/hyperledger/fabric/gossip/state/state.go:782 github.com/hyperledger/fabric/gossip/state.(*GossipStateProviderImpl).deliverPayloads     /opt/gopath/src/github.com/hyperledger/fabric/gossip/state/state.go:561 runtime.goexit     /opt/go/src/runtime/asm_amd64.s:2337)  ></description> </Issue>
