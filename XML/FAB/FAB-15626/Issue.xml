<Issue id="40413" key="FAB-15626" number="15626" project="10002" reporter="mhbauer" assignee="sykesm" creator="mhbauer" type="10004" summary="gossip/state_test.go calls t off of main goroutine" priority="2" resolution="10000" status="6" created="2019-06-04 22:16:07.0" updated="2019-06-11 21:50:20.0" resolutiondate="2019-06-11 21:50:20.0" votes="0" watches="3" workflowId="53330"> <description><! CDATA This leads to panics      https://jenkins.hyperledger.org/job/fabric-verify-unit-tests-x86_64/12626/console   {code}  *14:54:41* goroutine 12306  running :*14:54:41* testing.(*common).logDepth(0xc0001dc600, 0xc00289f500, 0x36, 0x3)*14:54:41* 	/opt/go/go1.12.5.linux.amd64/src/testing/testing.go:634 +0x3a6*14:54:41* testing.(*common).log(...)*14:54:41* 	/opt/go/go1.12.5.linux.amd64/src/testing/testing.go:614*14:54:41* testing.(*common).Logf(0xc0001dc600, 0x11f086e, 0x2, 0xc001731df0, 0x1, 0x1)*14:54:41* 	/opt/go/go1.12.5.linux.amd64/src/testing/testing.go:649 +0x7f*14:54:41* github.com/hyperledger/fabric/common/flogging/floggingtest.(*TestingWriter).Write(0xc0001881e0, 0xc000a2bc00, 0x37, 0x400, 0x1b9fe20, 0x0, 0x0)*14:54:41* 	/w/workspace/fabric-verify-unit-tests-x86_64/gopath/src/github.com/hyperledger/fabric/common/flogging/floggingtest/logger.go:195 +0xf7*14:54:41* github.com/hyperledger/fabric/common/flogging/floggingtest.(*RecordingCore).Write(0xc0001ce280, 0xff, 0xbf35d80846c54a83, 0x6fbf6b746, 0x1b9fe20, 0x0, 0x0, 0xc0011e90e0, 0x1f, 0x1, ...)*14:54:41* 	/w/workspace/fabric-verify-unit-tests-x86_64/gopath/src/github.com/hyperledger/fabric/common/flogging/floggingtest/logger.go:155 +0x123*14:54:41* github.com/hyperledger/fabric/vendor/go.uber.org/zap/zapcore.(*CheckedEntry).Write(0xc0031ba420, 0x0, 0x0, 0x0)*14:54:41* 	/w/workspace/fabric-verify-unit-tests-x86_64/gopath/src/github.com/hyperledger/fabric/vendor/go.uber.org/zap/zapcore/entry.go:215 +0x119*14:54:41* github.com/hyperledger/fabric/vendor/go.uber.org/zap.(*SugaredLogger).log(0xc0002e6028, 0xff, 0xc0011e90e0, 0x1f, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0)*14:54:41* 	/w/workspace/fabric-verify-unit-tests-x86_64/gopath/src/github.com/hyperledger/fabric/vendor/go.uber.org/zap/sugar.go:234 +0x101*14:54:41* github.com/hyperledger/fabric/vendor/go.uber.org/zap.(*SugaredLogger).Debugf(...)*14:54:41* 	/w/workspace/fabric-verify-unit-tests-x86_64/gopath/src/github.com/hyperledger/fabric/vendor/go.uber.org/zap/sugar.go:133*14:54:41* github.com/hyperledger/fabric/common/flogging.(*FabricLogger).Debug(0xc0002e6030, 0xc001731d60, 0x1, 0x1)*14:54:41* 	/w/workspace/fabric-verify-unit-tests-x86_64/gopath/src/github.com/hyperledger/fabric/common/flogging/zap.go:61 +0x9a*14:54:41* github.com/hyperledger/fabric/gossip/state.(*GossipStateProviderImpl).listen(0xc006841220)*14:54:41* 	/w/workspace/fabric-verify-unit-tests-x86_64/gopath/src/github.com/hyperledger/fabric/gossip/state/state.go:361 +0x31c*14:54:41* created by github.com/hyperledger/fabric/gossip/state.NewGossipStateProvider*14:54:41* 	/w/workspace/fabric-verify-unit-tests-x86_64/gopath/src/github.com/hyperledger/fabric/gossip/state/state.go:335 +0x886*14:54:41* panic: Log in goroutine after TestHaltChainProcessing has completed*14:54:41* *14:54:41* goroutine 12307  running :*14:54:41* testing.(*common).logDepth(0xc0001dc600, 0xc0014eb5c0, 0x5e, 0x3)*14:54:41* 	/opt/go/go1.12.5.linux.amd64/src/testing/testing.go:634 +0x3a6*14:54:41* testing.(*common).log(...)*14:54:41* 	/opt/go/go1.12.5.linux.amd64/src/testing/testing.go:614*14:54:41* testing.(*common).Logf(0xc0001dc600, 0x11f086e, 0x2, 0xc0012b9770, 0x1, 0x1)*14:54:41* 	/opt/go/go1.12.5.linux.amd64/src/testing/testing.go:649 +0x7f*14:54:41* github.com/hyperledger/fabric/common/flogging/floggingtest.(*TestingWriter).Write(0xc0001881e0, 0xc004c0e000, 0x5f, 0x400, 0x1b9fe20, 0x0, 0x0)*14:54:41* 	/w/workspace/fabric-verify-unit-tests-x86_64/gopath/src/github.com/hyperledger/fabric/common/flogging/floggingtest/logger.go:195 +0xf7*14:54:41* github.com/hyperledger/fabric/common/flogging/floggingtest.(*RecordingCore).Write(0xc0001ce280, 0xff, 0xbf35d80846c73647, 0x6fbf8a311, 0x1b9fe20, 0x0, 0x0, 0xc00847fec0, 0x3e, 0x1, ...)*14:54:41* 	/w/workspace/fabric-verify-unit-tests-x86_64/gopath/src/github.com/hyperledger/fabric/common/flogging/floggingtest/logger.go:155 +0x123*14:54:41* github.com/hyperledger/fabric/vendor/go.uber.org/zap/zapcore.(*CheckedEntry).Write(0xc007398840, 0x0, 0x0, 0x0)*14:54:41* 	/w/workspace/fabric-verify-unit-tests-x86_64/gopath/src/github.com/hyperledger/fabric/vendor/go.uber.org/zap/zapcore/entry.go:215 +0x119*14:54:41* github.com/hyperledger/fabric/vendor/go.uber.org/zap.(*SugaredLogger).log(0xc0002e6028, 0xff, 0xc00847fec0, 0x3e, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0)*14:54:41* 	/w/workspace/fabric-verify-unit-tests-x86_64/gopath/src/github.com/hyperledger/fabric/vendor/go.uber.org/zap/sugar.go:234 +0x101*14:54:41* github.com/hyperledger/fabric/vendor/go.uber.org/zap.(*SugaredLogger).Debugf(...)*14:54:41* 	/w/workspace/fabric-verify-unit-tests-x86_64/gopath/src/github.com/hyperledger/fabric/vendor/go.uber.org/zap/sugar.go:133*14:54:41* github.com/hyperledger/fabric/common/flogging.(*FabricLogger).Debug(0xc0002e6030, 0xc0012b96e0, 0x1, 0x1)*14:54:41* 	/w/workspace/fabric-verify-unit-tests-x86_64/gopath/src/github.com/hyperledger/fabric/common/flogging/zap.go:61 +0x9a*14:54:41* github.com/hyperledger/fabric/gossip/state.(*GossipStateProviderImpl).deliverPayloads(0xc006841220)*14:54:41* 	/w/workspace/fabric-verify-unit-tests-x86_64/gopath/src/github.com/hyperledger/fabric/gossip/state/state.go:661 +0xd2c*14:54:41* created by github.com/hyperledger/fabric/gossip/state.NewGossipStateProvider*14:54:41* 	/w/workspace/fabric-verify-unit-tests-x86_64/gopath/src/github.com/hyperledger/fabric/gossip/state/state.go:337 +0x8a8*14:54:41* FAIL	github.com/hyperledger/fabric/gossip/state	30.020s*14:54:43* ok  	github.com/hyperledger/fabric/gossip/state/mocks	0.018s	coverage: 55.6% of statements*14:54:49* ok  	github.com/hyperledger/fabric/gossip/util	4.051s	coverage: 78.5% of statements*14:54:49* Makefile:199: recipe for target 'unit-test' failed {code}  ></description> </Issue>
