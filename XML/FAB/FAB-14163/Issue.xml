<Issue id="37642" key="FAB-14163" number="14163" project="10002" reporter="wlahti" assignee="yacovm" creator="wlahti" type="10004" summary="Data race in orderer/common/cluster/comm_test" priority="3" resolution="10002" status="6" created="2019-02-12 22:33:56.0" updated="2019-03-27 20:35:32.0" resolutiondate="2019-03-27 20:35:32.0" votes="1" watches="3" workflowId="49256"> <description><! CDATA Hit here (and in multiple other CRs today):Â https://jenkins.hyperledger.org/job/fabric-verify-unit-tests-x86_64/8869/consoleFull {code:java} 16:25:28 ================== 16:25:28 WARNING: DATA RACE 16:25:28 Write at 0x00c0005810e8 by goroutine 340: 16:25:28   internal/race.Write() 16:25:28       /opt/go/go1.11.1.linux.amd64/src/internal/race/race.go:41 +0x38 16:25:28   sync.(*WaitGroup).Wait() 16:25:28       /opt/go/go1.11.1.linux.amd64/src/sync/waitgroup.go:128 +0xef 16:25:28   github.com/hyperledger/fabric/orderer/common/cluster_test.(*clusterNode).Step() 16:25:28       /w/workspace/fabric-verify-unit-tests-x86_64/gopath/src/github.com/hyperledger/fabric/orderer/common/cluster/comm_test.go:129 +0x52 16:25:28   github.com/hyperledger/fabric/protos/orderer._Cluster_Step_Handler() 16:25:28       /w/workspace/fabric-verify-unit-tests-x86_64/gopath/src/github.com/hyperledger/fabric/protos/orderer/cluster.pb.go:525 +0xcd 16:25:28   github.com/hyperledger/fabric/vendor/google.golang.org/grpc.(*Server).processStreamingRPC() 16:25:28       /w/workspace/fabric-verify-unit-tests-x86_64/gopath/src/github.com/hyperledger/fabric/vendor/google.golang.org/grpc/server.go:1170 +0x1602 16:25:28   github.com/hyperledger/fabric/vendor/google.golang.org/grpc.(*Server).handleStream() 16:25:28       /w/workspace/fabric-verify-unit-tests-x86_64/gopath/src/github.com/hyperledger/fabric/vendor/google.golang.org/grpc/server.go:1249 +0x1303 16:25:28   github.com/hyperledger/fabric/vendor/google.golang.org/grpc.(*Server).serveStreams.func1.1() 16:25:28       /w/workspace/fabric-verify-unit-tests-x86_64/gopath/src/github.com/hyperledger/fabric/vendor/google.golang.org/grpc/server.go:685 +0xac 16:25:28  16:25:28 Previous read at 0x00c0005810e8 by goroutine 11: 16:25:28   internal/race.Read() 16:25:28       /opt/go/go1.11.1.linux.amd64/src/internal/race/race.go:37 +0x38 16:25:28   sync.(*WaitGroup).Add() 16:25:28       /opt/go/go1.11.1.linux.amd64/src/sync/waitgroup.go:71 +0x16b 16:25:28   github.com/hyperledger/fabric/orderer/common/cluster_test.(*clusterNode).freeze() 16:25:28       /w/workspace/fabric-verify-unit-tests-x86_64/gopath/src/github.com/hyperledger/fabric/orderer/common/cluster/comm_test.go:144 +0x43 16:25:28   github.com/hyperledger/fabric/orderer/common/cluster_test.TestSendBigMessage() 16:25:28       /w/workspace/fabric-verify-unit-tests-x86_64/gopath/src/github.com/hyperledger/fabric/orderer/common/cluster/comm_test.go:324 +0x1281 16:25:28   testing.tRunner() 16:25:28       /opt/go/go1.11.1.linux.amd64/src/testing/testing.go:827 +0x162 16:25:28  16:25:28 Goroutine 340 (running) created at: 16:25:28   github.com/hyperledger/fabric/vendor/google.golang.org/grpc.(*Server).serveStreams.func1() 16:25:28       /w/workspace/fabric-verify-unit-tests-x86_64/gopath/src/github.com/hyperledger/fabric/vendor/google.golang.org/grpc/server.go:683 +0xb8 16:25:28   github.com/hyperledger/fabric/vendor/google.golang.org/grpc/internal/transport.(*http2Server).operateHeaders() 16:25:28       /w/workspace/fabric-verify-unit-tests-x86_64/gopath/src/github.com/hyperledger/fabric/vendor/google.golang.org/grpc/internal/transport/http2_server.go:419 +0x1481 16:25:28   github.com/hyperledger/fabric/vendor/google.golang.org/grpc/internal/transport.(*http2Server).HandleStreams() 16:25:28       /w/workspace/fabric-verify-unit-tests-x86_64/gopath/src/github.com/hyperledger/fabric/vendor/google.golang.org/grpc/internal/transport/http2_server.go:459 +0x37a 16:25:28   github.com/hyperledger/fabric/vendor/google.golang.org/grpc.(*Server).serveStreams() 16:25:28       /w/workspace/fabric-verify-unit-tests-x86_64/gopath/src/github.com/hyperledger/fabric/vendor/google.golang.org/grpc/server.go:681 +0x170 16:25:28   github.com/hyperledger/fabric/vendor/google.golang.org/grpc.(*Server).handleRawConn.func1() 16:25:28       /w/workspace/fabric-verify-unit-tests-x86_64/gopath/src/github.com/hyperledger/fabric/vendor/google.golang.org/grpc/server.go:643 +0x50 16:25:28  16:25:28 Goroutine 11 (running) created at: 16:25:28   testing.(*T).Run() 16:25:28       /opt/go/go1.11.1.linux.amd64/src/testing/testing.go:878 +0x650 16:25:28   testing.runTests.func1() 16:25:28       /opt/go/go1.11.1.linux.amd64/src/testing/testing.go:1119 +0xa8 16:25:28   testing.tRunner() 16:25:28       /opt/go/go1.11.1.linux.amd64/src/testing/testing.go:827 +0x162 16:25:28   testing.runTests() 16:25:28       /opt/go/go1.11.1.linux.amd64/src/testing/testing.go:1117 +0x4ee 16:25:28   testing.(*M).Run() 16:25:28       /opt/go/go1.11.1.linux.amd64/src/testing/testing.go:1034 +0x2ee 16:25:28   main.main() 16:25:28       _testmain.go:238 +0x332 16:25:28 ================== {code} cc:  ~yacovm   ></description> </Issue>
