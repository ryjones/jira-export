<Issue id="34152" key="FAB-12202" number="12202" project="10002" reporter="rlalgowdar" assignee="dongming" creator="rlalgowdar" type="10004" summary="PTE Query AllPeers option does not count all the queries or validate all responses received" priority="2" resolution="10000" status="6" created="2018-09-27 14:52:43.0" updated="2018-10-02 21:17:00.0" resolutiondate="2018-10-01 13:38:21.0" votes="0" watches="3" workflowId="45475"> <description><! CDATA For Side DBTests, we are trying {color:#172b4d}new TC similar to 10135, with variation use 3rd org (2 peers, both joined channel, but org3 NOT part of private collection); send invokes to Org1/Org2 peers, then query ALL peers. {color}  {color:#172b4d}Query json{color}  {color:#172b4d}{{color} {color:#172b4d} "channelID": "_ch1",{color} {color:#172b4d} "chaincodeID": "marbles02_private_go",{color} {color:#172b4d} "chaincodeVer": "v0",{color} {color:#172b4d} "logLevel": "ERROR",{color} {color:#172b4d} "invokeCheck": "TRUE",{color} {color:#172b4d} "transMode": "Constant",{color} {color:#172b4d} "transType": "Invoke",{color} {color:#172b4d} "invokeType": "Query",{color} {color:#172b4d} "targetPeers": "AllPeers",{color} {color:#172b4d} "nProcPerOrg": "2",{color} {color:#172b4d} "nRequest": "1000",{color} {color:#172b4d} "runDur": "1200",{color} {color:#172b4d} "TLS": "enabled",{color} {color:#172b4d} "channelOpt": {{color} {color:#172b4d} "name": "testorgschannel1",{color} {color:#172b4d} "action": "create",{color} {color:#172b4d} "orgName":  {color} {color:#172b4d} "org1",{color} {color:#172b4d} "org2",{color} {color:#172b4d} "org3"{color} {color:#172b4d}  {color}  {color:#172b4d}The issue is with option All Peers, the PTE uses ORGName+Peer+threadname to query 1000 records for each thread{color}  {color:#172b4d}^  32minfo^  39m:  PTE 1 main : Child proc exited, procId=6 ,exit code=0 ^  32minfo^  39m:  PTE 1 main : Test Summary 0 :  Nid:chan:org:id=0:testorgschannel1:org3:0 invoke_query_const  pte-exec:completed 1000 transaction INVOKE(QUERY) with 1000 failures in 708229 ms, timestamp: start 1538048696265 end 1538049404494,Throughput=0 TPS ^  32minfo^  39m:  PTE 1 main : Test Summary 1 :  Nid:chan:org:id=0:testorgschannel1:org3:1 invoke_query_const  pte-exec:completed 1000 transaction INVOKE(QUERY) with 1000 failures in 713769 ms, timestamp: start 1538048696267 end 1538049410036,Throughput=0 TPS ^  32minfo^  39m:  PTE 1 main : Test Summary 2 :  Nid:chan:org:id=0:testorgschannel1:org2:0 invoke_query_const  pte-exec:completed 1000 transaction INVOKE(QUERY) with 0 failures in 736445 ms, timestamp: start 1538048696274 end 1538049432719,Throughput=1.36 TPS ^  32minfo^  39m:  PTE 1 main : Test Summary 3 :  Nid:chan:org:id=0:testorgschannel1:org1:0 invoke_query_const  pte-exec:completed 1000 transaction INVOKE(QUERY) with 0 failures in 738438 ms, timestamp: start 1538048696276 end 1538049434714,Throughput=1.35 TPS ^  32minfo^  39m:  PTE 1 main : Test Summary 4 :  Nid:chan:org:id=0:testorgschannel1:org1:1 invoke_query_const  pte-exec:completed 1000 transaction INVOKE(QUERY) with 0 failures in 738554 ms, timestamp: start 1538048696280 end 1538049434834,Throughput=1.35 TPS ^  32minfo^  39m:  PTE 1 main : Test Summary 5 :  Nid:chan:org:id=0:testorgschannel1:org2:1 invoke_query_const  pte-exec:completed 1000 transaction INVOKE(QUERY) with 0 failures in 738914 ms, timestamp: start 1538048696266 end 1538049435180,Throughput=1.35 TPS ^  32minfo^  39m:  PTE 1 main : Test Summary: Total 6 Threads run completed{color}     {color:#172b4d}Issue 1: The ORG3 queries fail with PTE sending with IDs with ORG3 which are not inserted during invokes{color}  {color:#172b4d}info:  PTE 1 main : stdout: info:  PTE 1 exec :  Nid:chan:org:id=0:testorgschannel1:org3:0 invoke_query_const  query return: Error: \{"Error":"Marble private details does not exist: marble_testorgschannel1_org3_0_0_13"} info:  PTE 1 exec :  Nid:chan:org:id=0:testorgschannel1:org3:0 invoke_query_const  query return: Error: \{"Error":"Marble private details does not exist: marble_testorgschannel1_org3_0_0_13"}{color}  {color:#172b4d}Issue 2: Provide a way to Query ORG3 with Ids for ORG1/ORG2.{color}                          ></description> </Issue>
