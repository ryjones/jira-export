<Issue id="16122" key="FAB-3525" number="3525" project="10002" reporter="yacovm" assignee="denyeart" creator="yacovm" type="10004" summary="Ledger gets stuck at startup if chain size is big" priority="2" resolution="10000" status="6" created="2017-04-30 12:30:22.0" updated="2018-07-20 14:12:28.0" resolutiondate="2017-05-10 17:22:33.0" votes="0" watches="4" workflowId="38235"> <description><! CDATA Using commit level:  {quote} commit 4e0f96ba689f1390ebb6839b519e47fa281cefbf Author: manish <manish.sethi@gmail.com> Date:   Thu Mar 30 12:30:24 2017 +0530  create ledger with genesis block {quote}  And a peer with a chain of size ~ 600K blocks (yes, it has been running for a long time) The peer was restarted (due to a reboot). After startup, the logs output the following lines almost indefinitely:   {quote} ESC 36m2017-04-30 07:46:40.357 EDT  kvledger  retrieveBlockByNumber -> DEBU 874efESC 0m retrieveBlockByNumber() - blockNum =  596319  ESC 36m2017-04-30 07:46:40.357 EDT  kvledger  newBlockfileStream -> DEBU 874f0ESC 0m newBlockfileStream(): filePath= /var/hyperledger/production/ledgersData/chains/chains/YACOV2/blockfile_000030 , startOffset= 58701678  ESC 36m2017-04-30 07:46:40.357 EDT  kvledger  nextBlockBytesAndPlacementInfo -> DEBU 874f1ESC 0m Remaining bytes= 8405347 , Going to peek  8  bytes ESC 36m2017-04-30 07:46:40.365 EDT  kvledger  nextBlockBytesAndPlacementInfo -> DEBU 874f2ESC 0m Returning blockbytes - length= 3473 , placementInfo={fileNum= 30 , startOffset= 58701678 , bytesOffset= 58701680 } ESC 36m2017-04-30 07:46:40.365 EDT  kvledger  retrieveBlockByNumber -> DEBU 874f3ESC 0m retrieveBlockByNumber() - blockNum =  596318  ESC 36m2017-04-30 07:46:40.365 EDT  kvledger  newBlockfileStream -> DEBU 874f4ESC 0m newBlockfileStream(): filePath= /var/hyperledger/production/ledgersData/chains/chains/YACOV2/blockfile_000030 , startOffset= 58698204  ESC 36m2017-04-30 07:46:40.365 EDT  kvledger  nextBlockBytesAndPlacementInfo -> DEBU 874f5ESC 0m Remaining bytes= 8408821 , Going to peek  8  bytes ESC 36m2017-04-30 07:46:40.373 EDT  kvledger  nextBlockBytesAndPlacementInfo -> DEBU 874f6ESC 0m Returning blockbytes - length= 3472 , placementInfo={fileNum= 30 , startOffset= 58698204 , bytesOffset= 58698206 } ESC 36m2017-04-30 07:46:40.374 EDT  kvledger  retrieveBlockByNumber -> DEBU 874f7ESC 0m retrieveBlockByNumber() - blockNum =  596317  {quote}  This is most likely because in peer.go the peer attempts to get the latest config block from the ledger by fetching the latest block and then going  backwards | https://github.com/hyperledger/fabric/blob/master/core/peer/peer.go#L149-L176  until the last config block is reached:   The stack trace of the peer is attached  here | https://gist.github.com/yacovm/f3f8f6f1a9596a0eff17efb7d9fbe8cb .  For those that want to reproduce the issue, I uploaded the content of */var/hyperledger/production* to a web server  here | http://fab-3525.stage1.mybluemix.net/peerLedger.tar.gz .   ~C0rWin   ~binhn   ~denyeart   ~mastersingh24   ~muralisr      ></description> </Issue>
