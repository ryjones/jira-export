<Issue id="17431" key="FAB-4345" number="4345" project="10002" reporter="ratnakar" assignee="yacovm" creator="ratnakar" type="10004" summary="non leader peers failed to get the blocks when not using USELEADERELECTION configuration" priority="2" resolution="10000" status="6" created="2017-06-04 08:16:25.0" updated="2018-07-20 14:13:06.0" resolutiondate="2017-06-06 18:56:44.0" votes="0" watches="4" workflowId="38800" security="10001"> <description><! CDATA Commit Level : *2292080faecfca01e7d359ce681a7869e07232b4*  When Gossip leader election flag is disabled in e2e_cli example , non leader peers failed to get the blocks on the channel.  Following are the configuration changes: - Enabled ORG Leader flag (*CORE_PEER_GOSSIP_USELEADERELECTION*) for anchor peers on each org - Disabled both Leader election (*CORE_PEER_GOSSIP_USELEADERELECTION*) & Org Leader (*CORE_PEER_GOSSIP_ORGLEADER*) flags for non-anchor peers on each org  * _base/peer-base.yaml_ {color:#d04437}#- CORE_PEER_GOSSIP_USELEADERELECTION=true{color} {color:#d04437} #- CORE_PEER_GOSSIP_ORGLEADER=false{color}  * _base/docker-compose-base.yaml_  diff --git a/examples/e2e_cli/base/docker-compose-base.yaml b/examples/e2e_cli/base/docker-compose-base.yaml index 7a97e71..b9a17ad 100644 — a/examples/e2e_cli/base/docker-compose-base.yaml +++ b/examples/e2e_cli/base/docker-compose-base.yaml @@ -41,6 +41,8 @@ services: - CORE_PEER_ADDRESS=peer0.org1.example.com:7051 - CORE_PEER_GOSSIP_EXTERNALENDPOINT=peer0.org1.example.com:7051 - CORE_PEER_LOCALMSPID=Org1MSP {color:#14892c}+ - CORE_PEER_GOSSIP_USELEADERELECTION=false{color} {color:#14892c}+ - CORE_PEER_GOSSIP_ORGLEADER=true{color} volumes: - /var/run/:/host/var/run/ - ../crypto-config/peerOrganizations/org1.example.com/peers/peer0.org1.example.com/msp:/etc/hyperledger/fabric/msp @@ -60,6 +62,8 @@ services: - CORE_PEER_GOSSIP_EXTERNALENDPOINT=peer1.org1.example.com:7051 - CORE_PEER_GOSSIP_BOOTSTRAP=peer0.org1.example.com:7051 - CORE_PEER_LOCALMSPID=Org1MSP {color:#14892c}+ - CORE_PEER_GOSSIP_USELEADERELECTION=false{color} {color:#14892c}+ - CORE_PEER_GOSSIP_ORGLEADER=false{color} volumes: - /var/run/:/host/var/run/ - ../crypto-config/peerOrganizations/org1.example.com/peers/peer1.org1.example.com/msp:/etc/hyperledger/fabric/msp @@ -80,6 +84,8 @@ services: - CORE_PEER_GOSSIP_EXTERNALENDPOINT=peer0.org2.example.com:7051 - CORE_PEER_GOSSIP_BOOTSTRAP=peer0.org2.example.com:7051 - CORE_PEER_LOCALMSPID=Org2MSP {color:#14892c}+ - CORE_PEER_GOSSIP_USELEADERELECTION=false{color} {color:#14892c}+ - CORE_PEER_GOSSIP_ORGLEADER=true{color} volumes: - /var/run/:/host/var/run/ - ../crypto-config/peerOrganizations/org2.example.com/peers/peer0.org2.example.com/msp:/etc/hyperledger/fabric/msp @@ -99,6 +105,8 @@ services: - CORE_PEER_GOSSIP_EXTERNALENDPOINT=peer1.org2.example.com:7051 - CORE_PEER_GOSSIP_BOOTSTRAP=peer1.org2.example.com:7051 - CORE_PEER_LOCALMSPID=Org2MSP {color:#14892c}+ - CORE_PEER_GOSSIP_USELEADERELECTION=false{color} {color:#14892c}+ - CORE_PEER_GOSSIP_ORGLEADER=false{color} volumes: - /var/run/:/host/var/run/ - ../crypto-config/peerOrganizations/org2.example.com/peers/peer1.org2.example.com/msp:/etc/hyperledger/fabric/msp  *NOTE*: _attached the modified files._  While querying on non-leader/non-anchor peer (peer1.org2.example.com), below error is seen    {code:java} 2017-06-04 07:59:50.183 UTC  msp  getMspConfig -> INFO 001 intermediate certs folder not found at  /opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/peerOrganizations/org2.example.com/users/Admin@org2.example.com/msp/intermediatecerts . Skipping.:  stat /opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/peerOrganizations/org2.example.com/users/Admin@org2.example.com/msp/intermediatecerts: no such file or directory  2017-06-04 07:59:50.183 UTC  msp  getMspConfig -> INFO 002 crls folder not found at  /opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/peerOrganizations/org2.example.com/users/Admin@org2.example.com/msp/intermediatecerts . Skipping.:  stat /opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/peerOrganizations/org2.example.com/users/Admin@org2.example.com/msp/crls: no such file or directory  2017-06-04 07:59:50.183 UTC  msp  getMspConfig -> INFO 003 MSP configuration file not found at  /opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/peerOrganizations/org2.example.com/users/Admin@org2.example.com/msp/config.yaml :  stat /opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/peerOrganizations/org2.example.com/users/Admin@org2.example.com/msp/config.yaml: no such file or directory  2017-06-04 07:59:50.219 UTC  msp  GetLocalMSP -> DEBU 004 Returning existing local MSP 2017-06-04 07:59:50.219 UTC  msp  GetDefaultSigningIdentity -> DEBU 005 Obtaining default signing identity 2017-06-04 07:59:50.219 UTC  msp/identity  Sign -> DEBU 006 Sign: plaintext: 0AAC070A6608031A0B08F6FBCEC90510...6D7963631A0A0A0571756572790A0161  2017-06-04 07:59:50.220 UTC  msp/identity  Sign -> DEBU 007 Sign: digest: 83F3439169B22ABD8FE80490DC82632023FE4178ABACFBC3F56C372DD3D1FFF4  Error: Error endorsing query: rpc error: code = Unknown desc = failed to obtain cds for mycc - could not find chaincode with name 'mycc' Usage: peer chaincode query  flags  Flags: -x, --hex If true, output the query value byte array in hexadecimal. Incompatible with --raw -r, --raw If true, output the query value as raw bytes, otherwise format as a printable string Global Flags: --cafile string Path to file containing PEM-encoded trusted certificate(s) for the ordering endpoint -C, --chainID string The chain on which this command should be executed (default "testchainid") -c, --ctor string Constructor message for the chaincode in JSON format (default "{}") -E, --escc string The name of the endorsement system chaincode to be used for this chaincode -l, --lang string Language the chaincode is written in (default "golang") --logging-level string Default logging level and overrides, see core.yaml for full syntax -n, --name string Name of the chaincode -o, --orderer string Ordering service endpoint -p, --path string Path to chaincode -P, --policy string The endorsement policy associated to this chaincode --test.coverprofile string Done (default "coverage.cov") -t, --tid string Name of a custom ID generation algorithm (hashing and decoding) e.g. sha256base64 --tls Use TLS when communicating with the orderer endpoint -u, --username string Username for chaincode operations when security is enabled -v, --version string Version of the chaincode specified in install/instantiate/upgrade commands -V, --vscc string The name of the verification system chaincode to be used for this chaincode !!!!!!!!!!!!!!! Query result on PEER3 is INVALID !!!!!!!!!!!!!!!! ================== ERROR !!! FAILED to execute End-2-End Scenario ================== {code}    ></description> </Issue>
