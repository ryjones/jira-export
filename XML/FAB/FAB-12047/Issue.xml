<Issue id="33887" key="FAB-12047" number="12047" project="10002" reporter="denyeart" creator="denyeart" type="10004" summary="Block state validation is doing an extra retrieve per writeset key" priority="2" resolution="10002" status="6" created="2018-09-18 19:55:07.0" updated="2018-09-18 20:56:07.0" resolutiondate="2018-09-18 20:56:07.0" votes="0" watches="1" workflowId="45202"> <description><! CDATA Block state validation is doing an extra retrieve per writeset key.  This causes a performance regression in v1.3.   In the debug log below, the first batch retrieve for readset state validation is expected.  The four individual key retrieves are not expected and did not happen in v1.2.   {code:java} 2018-09-18 15:22:35.759 EDT  valimpl  ValidateAndPrepareBatch -> DEBU 5fa ValidateAndPrepareBatch() for block number =  3  2018-09-18 15:22:35.760 EDT  couchdb  BatchRetrieveDocumentMetadata -> DEBU 603 Entering BatchRetrieveDocumentMetadata()  keys= marble6 marble7  // batch retrieve for readset state validation 2018-09-18 15:22:35.762 EDT  couchdb  ReadDoc -> DEBU 620 Entering ReadDoc()  id= color~namebluemarble6    // extra retrieve 2018-09-18 15:22:35.764 EDT  couchdb  ReadDoc -> DEBU 62a Entering ReadDoc()  id= marble6                  // extra retrieve 2018-09-18 15:22:35.766 EDT  couchdb  ReadDoc -> DEBU 63a Entering ReadDoc()  id= color~namebluemarble7    // extra retrieve 2018-09-18 15:22:35.767 EDT  couchdb  ReadDoc -> DEBU 644 Entering ReadDoc()  id= marble7                  // extra retrieve{code}    {color:#333333}The cause of the extra retrieves is:  {color}  {color:#333333}https://github.com/hyperledger/fabric/blob/master/core/ledger/kvledger/txmgmt/validator/valinternal/tx_ops_preparation.go#L30{color}  ></description> </Issue>
