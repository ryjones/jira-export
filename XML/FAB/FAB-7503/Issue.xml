<Issue id="26149" key="FAB-7503" number="7503" project="10002" reporter="shimos" assignee="shimos" creator="shimos" type="10004" summary="PTE fails to join channels, and install/instantiate chaincodes when multiple organizations are specified" environment="fabric-test commit 133e7946c442a67a8f9ecdeea10b01686e207577" priority="3" resolution="10000" status="6" created="2017-12-19 01:38:17.0" updated="2018-07-20 14:15:17.0" resolutiondate="2018-01-18 15:32:51.0" votes="0" watches="1" workflowId="40820"> <description><! CDATA When multiple organizations are specified in user inputs, PTE fails to join a channel, to install a chaincode, or to instantiate a chaincode, and results in some error or an infinite loop.  The example below works successfully when only single organization is specified in user inputs.  *To join a channel:*  {noformat} $ cat /tmp/input_testorgschannel1_join_channel.json { "SCFile":   { "ServiceCredentials": "/tmp/sc_testorgschannel1.json" }  , "TLS": "enabled", "chaincodeID": "sample_cc", "chaincodeVer": "v0", "channelID": "_testorgschannel1", "channelOpt": { "action": "join", "name": "testorgschannel1", "orgName":   "Org1", "Org2", "Org3"   }, "logLevel": "ERROR", "nProcPerOrg": 1, "targetPeers": "OrgAnchor", "transType": "Channel" }  $ node pte-main.js 0 /tmp/input_testorgschannel1_join_channel.json 0 0 info:  PTE 0 main : input parameters: Nid=0, uiFile=/tmp/input_testorgschannel1_join_channel.json, tStart=0 PTEid=0 info:  PTE 0 main : Nid: 0, chaincode_id: sample_cc_testorgschannel1, chaincode_ver: v0 info:  PTE 0 main : TLS: ENABLED info:  PTE 0 main : channelName: testorgschannel1 info:  PTE 0 main : channelOrgName.length: 3, channelOrgName: Org1,Org2,Org3 info:  PTE 0 main : svcFile;  /tmp/sc_testorgschannel1.json info:  PTE 0 main : GOPATH:  /opt/gopath info:  PTE 0 main : nProcPerOrg  1 info:  PTE 0 main :  performance_main  org= Org1, org Name= PeerOrg1 info:  PTE 0 main :  performance_main  channel name:  testorgschannel1 info:  PTE 0 main :  joinChannel  Calling peers in organization (PeerOrg1) to join the channel (testorgschannel1) info:  PTE 0 main :  joinChannel  user=admin, secret=adminpw info:  PTE 0 main :  chainAddOrderer  channel name:  testorgschannel1 info:  PTE 0 main :  chainAddOrderer  channel orderers:  grpc.ssl_target_name_override=orderer0.example.com, grpc.default_authority=orderer0.example.com, grpc.max_receive_message_length=-1, grpc.max_send_message_length=-1, grpc.primary_user_agent=grpc-node/1.7.3, _url=gr pcs://localhost:5005, , addr=localhost:5005, _request_timeout=45000, info:  PTE 0 main :  performance_main  org= Org2, org Name= PeerOrg2 info:  PTE 0 main :  performance_main  channel name:  testorgschannel1 info:  PTE 0 main :  joinChannel  Calling peers in organization (PeerOrg2) to join the channel (testorgschannel1) info:  PTE 0 main :  joinChannel  user=admin, secret=adminpw info:  PTE 0 main :  chainAddOrderer  channel name:  testorgschannel1 info:  PTE 0 main :  chainAddOrderer  channel orderers:  grpc.ssl_target_name_override=orderer0.example.com, grpc.default_authority=orderer0.example.com, grpc.max_receive_message_length=-1, grpc.max_send_message_length=-1, grpc.primary_user_agent=grpc-node/1.7.3, _url=gr pcs://localhost:5005, , addr=localhost:5005, _request_timeout=45000, info:  PTE 0 main :  performance_main  org= Org3, org Name= PeerOrg3 info:  PTE 0 main :  performance_main  channel name:  testorgschannel1                                                                                                                                                                                                         info:  PTE 0 main :  joinChannel  Calling peers in organization (PeerOrg3) to join the channel (testorgschannel1) info:  PTE 0 main :  joinChannel  user=admin, secret=adminpw info:  PTE 0 main :  chainAddOrderer  channel name:  testorgschannel1 info:  PTE 0 main :  chainAddOrderer  channel orderers:  grpc.ssl_target_name_override=orderer0.example.com, grpc.default_authority=orderer0.example.com, grpc.max_receive_message_length=-1, grpc.max_send_message_length=-1, grpc.primary_user_agent=grpc-node/1.7.3, _url=grpcs://localhost:5005, , addr=localhost:5005, _request_timeout=45000, info:  PTE util :  Org1 admin_cert undefined info:  PTE util :  Org2 admin_cert undefined info:  PTE util :  Org3 admin_cert undefined info:  PTE 0 main :  joinChannel:Org2  Successfully enrolled orderer 'admin' info:  PTE 0 main :  joinChannel:Org1  Successfully enrolled orderer 'admin' info:  PTE 0 main :  joinChannel:Org3  Successfully enrolled orderer 'admin' info:  PTE 0 main :  joinChannel:org=testorgschannel1:Org2  Successfully got the genesis block info:  PTE util :  >>>> getting the org admin info:  PTE util :  Org2 admin_cert undefined info:  PTE 0 main :  joinChannel:org=testorgschannel1:Org1  Successfully got the genesis block info:  PTE util :  >>>> getting the org admin info:  PTE util :  Org1 admin_cert undefined info:  PTE 0 main :  joinChannel:org=testorgschannel1:Org3  Successfully got the genesis block info:  PTE util :  >>>> getting the org admin info:  PTE util :  Org3 admin_cert undefined info:  PTE 0 main :  joinChannel  Successfully enrolled org:Org2 'admin' info:  PTE 0 main :  channelAddPeerEvent  channel name:  testorgschannel1 info:  EventHub.js : _connect - options {"grpc.ssl_target_name_override":"peer0.org2.example.com","grpc.default_authority":"peer0.org2.example.com","grpc.max_receive_message_length":-1,"grpc.max_send_message_length":-1} info:  PTE 0 main :  channelAddPeerEvent  requests: grpcs://localhost:7063, events: grpcs://localhost:6053 info:  EventHub.js : _connect - options {"grpc.ssl_target_name_override":"peer1.org2.example.com","grpc.default_authority":"peer1.org2.example.com","grpc.max_receive_message_length":-1,"grpc.max_send_message_length":-1} info:  PTE 0 main :  channelAddPeerEvent  requests: grpcs://localhost:7064, events: grpcs://localhost:6054 info:  PTE 0 main :  joinChannel  Successfully enrolled org:Org1 'admin' info:  PTE 0 main :  channelAddPeerEvent  channel name:  testorgschannel1 info:  EventHub.js : _connect - options {"grpc.ssl_target_name_override":"peer0.org1.example.com","grpc.default_authority":"peer0.org1.example.com","grpc.max_receive_message_length":-1,"grpc.max_send_message_length":-1} info:  PTE 0 main :  channelAddPeerEvent  requests: grpcs://localhost:7061, events: grpcs://localhost:6051 info:  EventHub.js : _connect - options {"grpc.ssl_target_name_override":"peer1.org1.example.com","grpc.default_authority":"peer1.org1.example.com","grpc.max_receive_message_length":-1,"grpc.max_send_message_length":-1} info:  PTE 0 main :  channelAddPeerEvent  requests: grpcs://localhost:7062, events: grpcs://localhost:6052 info:  PTE 0 main :  joinChannel  Successfully enrolled org:Org3 'admin' info:  PTE 0 main :  channelAddPeerEvent  channel name:  testorgschannel1 info:  EventHub.js : _connect - options {"grpc.ssl_target_name_override":"peer0.org3.example.com","grpc.default_authority":"peer0.org3.example.com","grpc.max_receive_message_length":-1,"grpc.max_send_message_length":-1} info:  PTE 0 main :  channelAddPeerEvent  requests: grpcs://localhost:7065, events: grpcs://localhost:6055 info:  EventHub.js : _connect - options {"grpc.ssl_target_name_override":"peer1.org3.example.com","grpc.default_authority":"peer1.org3.example.com","grpc.max_receive_message_length":-1,"grpc.max_send_message_length":-1} info:  PTE 0 main :  channelAddPeerEvent  requests: grpcs://localhost:7066, events: grpcs://localhost:6056 error:  client-utils.js : sendPeersProposal - Promise is rejected: Error: Failed to deserialize creator identity, err expected MSP ID PeerOrg2, received PeerOrg3 at /opt/gopath/src/github.com/hyperledger/fabric-test/fabric-sdk-node/node_modules/grpc/src/client.js:554:15 error:  client-utils.js : sendPeersProposal - Promise is rejected: Error: Failed to deserialize creator identity, err expected MSP ID PeerOrg2, received PeerOrg1 at /opt/gopath/src/github.com/hyperledger/fabric-test/fabric-sdk-node/node_modules/grpc/src/client.js:554:15 error:  client-utils.js : sendPeersProposal - Promise is rejected: Error: Failed to deserialize creator identity, err expected MSP ID PeerOrg2, received PeerOrg3 at /opt/gopath/src/github.com/hyperledger/fabric-test/fabric-sdk-node/node_modules/grpc/src/client.js:554:15 error:  client-utils.js : sendPeersProposal - Promise is rejected: Error: Failed to deserialize creator identity, err expected MSP ID PeerOrg2, received PeerOrg1 at /opt/gopath/src/github.com/hyperledger/fabric-test/fabric-sdk-node/node_modules/grpc/src/client.js:554:15 error:  client-utils.js : sendPeersProposal - Promise is rejected: Error: Failed to deserialize creator identity, err expected MSP ID PeerOrg1, received PeerOrg3 at /opt/gopath/src/github.com/hyperledger/fabric-test/fabric-sdk-node/node_modules/grpc/src/client.js:554:15 error:  client-utils.js : sendPeersProposal - Promise is rejected: Error: Failed to deserialize creator identity, err expected MSP ID PeerOrg1, received PeerOrg3 at /opt/gopath/src/github.com/hyperledger/fabric-test/fabric-sdk-node/node_modules/grpc/src/client.js:554:15 info:  PTE 0 main :  joinChannel  The new channel has been successfully joined on peer localhost:6052 info:  PTE 0 main :  joinChannel  The new channel has been successfully joined on peer localhost:6052 info:  PTE 0 main :  joinChannel  The new channel has been successfully joined on peer localhost:6054 info:  PTE 0 main :  joinChannel  The new channel has been successfully joined on peer localhost:6054 info:  PTE 0 main :  joinChannel  The new channel has been successfully joined on peer localhost:6054 info:  PTE 0 main :  joinChannel  The new channel has been successfully joined on peer localhost:6053 info:  PTE 0 main :  joinChannel  The new channel has been successfully joined on peer localhost:6053 info:  PTE 0 main :  joinChannel  The new channel has been successfully joined on peer localhost:6053 info:  PTE 0 main :  joinChannel  The new channel has been successfully joined on peer localhost:6056 info:  PTE 0 main :  joinChannel  join Channel R E S P O N S E :   {"version":0,"timestamp":null,"response":{"status":200,"message":"","payload":{"type":"Buffer","data":  }},"payload":{"type":"Buffer","data":  },"endorsement":null},{"version":0,"timestamp":null,"response":{"status":200,"message":"","payload":{"type":"Buffer","data":  }},"payload":{"type":"Buffer","data":  },"endorsement":null} ,null,null  info:  PTE 0 main :  joinChannel  Successfully joined peers in (testorgschannel1:PeerOrg3) {noformat}  *To install a chaincode: (results in infinite loop)*  {noformat} $ cat /tmp/input_testorgschannel1_install_chaincode.json { "SCFile":   { "ServiceCredentials": "/tmp/sc_testorgschannel1.json" }  , "TLS": "enabled", "chaincodeID": "sample_cc", "chaincodeVer": "v0", "channelID": "_testorgschannel1", "channelOpt": { "name": "testorgschannel1", "orgName":   "Org1", "Org2", "Org3"   }, "deploy": { "args":   , "chaincodePath": "github.com/hyperledger/fabric-test/chaincodes/samplecc/go", "fcn": "init" }, "logLevel": "ERROR", "nProcPerOrg": 1, "transType": "Install" } $ node pte-main.js 0 /tmp/input_testorgschannel1_install_chaincode.json 0 0 info:  PTE 0 main : input parameters: Nid=0, uiFile=/tmp/input_testorgschannel1_install_chaincode.json, tStart=0 PTEid=0 info:  PTE 0 main : Nid: 0, chaincode_id: sample_cc_testorgschannel1, chaincode_ver: v0 info:  PTE 0 main : TLS: ENABLED info:  PTE 0 main : channelName: testorgschannel1 info:  PTE 0 main : channelOrgName.length: 3, channelOrgName: Org1,Org2,Org3 info:  PTE 0 main : svcFile;  /tmp/sc_testorgschannel1.json info:  PTE 0 main : GOPATH:  /opt/gopath info:  PTE 0 main : nProcPerOrg  1 info:  PTE 0 main :  performance_main  org= Org1, org Name= PeerOrg1 info:  PTE 0 main : chaincode language: golang, path: github.com/hyperledger/fabric-test/chaincodes/samplecc/go info:  PTE 0 main :  performance_main  Deploy: user= admin, secret= adminpw info:  PTE 0 main :  performance_main  org= Org2, org Name= PeerOrg2 info:  PTE 0 main : chaincode language: golang, path: github.com/hyperledger/fabric-test/chaincodes/samplecc/go info:  PTE 0 main :  performance_main  Deploy: user= admin, secret= adminpw info:  PTE 0 main :  performance_main  org= Org2, org Name= PeerOrg2 info:  PTE 0 main : chaincode language: golang, path: github.com/hyperledger/fabric-test/chaincodes/samplecc/go info:  PTE 0 main :  performance_main  Deploy: user= admin, secret= adminpw {noformat}  *To instantiate a chaincode: (also results in infinite loop)*  {noformat} $ cat /tmp/input_testorgschannel1_instantiate_chaincode.json { "SCFile":   { "ServiceCredentials": "/tmp/sc_testorgschannel1.json" }  , "TLS": "enabled", "chaincodeID": "sample_cc", "chaincodeVer": "v0", "channelID": "_testorgschannel1", "channelOpt": { "name": "testorgschannel1", "orgName":   "Org1", "Org2", "Org3"   }, "deploy": { "args":   , "chaincodePath": "github.com/hyperledger/fabric-test/chaincodes/samplecc/go", "fcn": "init" }, "logLevel": "ERROR", "nProcPerOrg": 1, "transType": "Instantiate" }  $ node pte-main.js 0 /tmp/input_testorgschannel1_instantiate_chaincode.json 0 0 info:  PTE 0 main : input parameters: Nid=0, uiFile=/tmp/input_testorgschannel1_instantiate_chaincode.json, tStart=0 PTEid=0 info:  PTE 0 main : Nid: 0, chaincode_id: sample_cc_testorgschannel1, chaincode_ver: v0 info:  PTE 0 main : TLS: ENABLED info:  PTE 0 main : channelName: testorgschannel1 info:  PTE 0 main : channelOrgName.length: 3, channelOrgName: Org1,Org2,Org3 info:  PTE 0 main : svcFile;  /tmp/sc_testorgschannel1.json info:  PTE 0 main : GOPATH:  /opt/gopath info:  PTE 0 main : nProcPerOrg  1 info:  PTE 0 main :  performance_main  org= Org1, org Name= PeerOrg1 info:  PTE 0 main : chaincode language: golang, path: github.com/hyperledger/fabric-test/chaincodes/samplecc/go info:  PTE 0 main :  performance_main  instantiate: user= admin, secret= adminpw info:  PTE 0 main :  performance_main  org= Org2, org Name= PeerOrg2 info:  PTE 0 main : chaincode language: golang, path: github.com/hyperledger/fabric-test/chaincodes/samplecc/go info:  PTE 0 main :  performance_main  instantiate: user= admin, secret= adminpw info:  PTE 0 main :  performance_main  org= Org2, org Name= PeerOrg2 info:  PTE 0 main : chaincode language: golang, path: github.com/hyperledger/fabric-test/chaincodes/samplecc/go info:  PTE 0 main :  performance_main  instantiate: user= admin, secret= adminpw info:  PTE 0 main :  performance_main  org= Org2, org Name= PeerOrg2 .... {noformat}    ></description> </Issue>
