<Issue id="45035" key="FAB-17868" number="17868" project="10002" reporter="tock" assignee="wlahti" creator="tock" type="10003" summary="Extend the file ledger with methods for the removal of channels in the orderer" priority="3" resolution="10000" status="6" created="2020-05-10 09:34:59.0" updated="2020-08-06 09:05:00.0" resolutiondate="2020-08-06 09:05:00.0" votes="0" watches="4" workflowId="59130" archived="N"> <description><! CDATA h1. General  The common/ledger package, through sub-packages blockledger & blkstorage, now supports only creating new channels and listing existing ones. In order to support the removal of orderer channels through the channel participation APIs this needs to be extended to include the removal of channels.  The ledger team is adding support for resource removal in the block storage FAB-17992.   Here the focus is on the file ledger which consumes the block storage provider.    h1. API  There is one flavor -are two flavors- to this operation:   *Remove(channelName string) error*  causes the channel folder and resources to be permanently deleted.     -*Archive**(channelName string) error*- (*Edit:* this will not be implemented in this task)  causes channel resources to be moved to an archival location.  Removal need to be done in an way that is resistant to crashes during the operation. For that end, as the method is invoked, a *file repo* folder is first tagged with an empty file *"channelName.remove" or "channelName.archive".* Next, the prescribed action will take place. Upon restart, the ledger will detect these tags and complete the operation if it had crashed its execution.   The file repo is developed in FAB-17960.  Crash fault tolerance for the file repo is added in FAB-18082    h1. Changes to current behavior  The file ledger was designed to create a ledger once and never delete it. Therefore, the `GetOrCreate()` method caches channels and never deletes them. This must be changed after the addition of `Remove`.    h1. Archiving (Edit: will not be implemented)  Archiving means moving (renaming) the folder to:  *LedegrArchive/channelName~<timestamp>*     *LedgerArchive* is a folder location defined in the ledger configuration (this need to be defined).  We use a '~' separator because it is not a legal channel name character, and include a timestamp because a channel having the same name may be created and deleted multiple times, and we want to archive all versions of it.  Archived ledger folders can only be removed manually by the administrator. h1. Listing channels  When the ledger factory is asked to detect all the ledgers, it needs to skip folders marked with *".remove" or ".archive".*  *Option:* add a method for the listing of archived ledgers.  h1. Priority  Implementing removal is more important than implementing archiving. The task can be broken in to two respective sub-tasks.      ></description> </Issue>
