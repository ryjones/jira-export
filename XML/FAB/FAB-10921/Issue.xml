<Issue id="31456" key="FAB-10921" number="10921" project="10002" reporter="scottz" assignee="dongming" creator="scottz" type="10004" summary="PTE fix to getNewCryptoKeyStore before create new client orderer object" priority="3" resolution="10000" status="6" created="2018-06-28 16:46:11.0" updated="2018-07-20 14:17:04.0" resolutiondate="2018-06-28 19:13:21.0" votes="0" watches="2" workflowId="42568"> <description><! CDATA Look in pte-main during createAndUpdateOneChannel and joinChannel and other functions.    This is to fix the logical flow of things. It relates to the following error msg, which is seen now at end of v.12 when create a channel:  {quote}info:  PTE 0 util :  getTLSCert  key: orderer, subkey: orderer0 (node:11406) UnhandledPromiseRejectionWarning: Unhandled promise rejection (rejection id: 1): Error: A crypto suite has not been assigned to this client (node:11406)  DEP0018  DeprecationWarning: Unhandled promise rejections are deprecated. In the future, promise rejections that are not handled will terminate the Node.js process with a non-zero exit code (node:11406) UnhandledPromiseRejectionWarning: Unhandled promise rejection (rejection id: 2): Error: A crypto suite has not been assigned to this client {quote}  Comments/suggestions from Rajesh:  FAB-10135 SideDB - CouchDB Performance Test: Concurrent Operation Invoke and Query, 2 orgs, 1 channel.  1. This test needed AnchorPeer setup from PTE. The changes we submitted for pte-main.js for some reason wasn't working and getting failure in create/join channel with error ```(node:11343) UnhandledPromiseRejectionWarning: Unhandled promise rejection (rejection id: 1): Error: A crypto suite has not been assigned to this client```  To fix this I had to move clientNewOrderer/chainAddOrderer further down in create/join channel function in pte-main.js just before the sending call. This fixed it.  2. Later to add the update channel call to preconfig, this needs changes in scripts/test_channel.sh ```+echo " $0  update channel" +echo " ./pte_driver.sh CITest/$PrecfgDir/preconfig/channels/runCases-chan-update-TLS.txt" + + runUpdate=`ls CITest/$PrecfgDir/preconfig/channels/runCases*update*` + echo "runUpdate $runUpdate" + for ri in $runUpdate; do + echo "./pte_driver.sh $ri" + ./pte_driver.sh $ri + sleep 60s + done +``` This runs the update channel to set Anchor peers.  3. To achieve concurrency for invokes and queries.. under Query copied invokes json and set start index higher than first run of invokes. Run invokes and Queries concurrent ```ibmadmin@SDBPTE2:/opt/gopath/src/github.com/hyperledger/fabric-test/tools/PTE/CITest/FAB-10135-4q/marbles02_private$ more PTEMgr-FAB-10135-4q-TLS.txt driver=pte CITest/FAB-10135-4q/marbles02_private/runCases-FAB-10135-4i1-TLS.txt driver=pte CITest/FAB-10135-4q/marbles02_private/runCases-FAB-10135-4q1-TLS.txt``` This made truly concurrent and could see some dip in TPS. @Scott Zwierzynski I will submit patch for the FAB by Tomorrow for now I will continue with CHAOS testing     ></description> </Issue>
