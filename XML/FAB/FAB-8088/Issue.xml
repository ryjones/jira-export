<Issue id="27463" key="FAB-8088" number="8088" project="10002" reporter="suryalnvs" assignee="sanchezl" creator="suryalnvs" type="10004" summary=" Upgrade  v1.1 Peer logs doesn&apos;t show the failure attempts from chaincode container which still using v1.0 chaincode image" priority="3" resolution="10000" status="6" created="2018-02-06 17:15:53.0" updated="2018-07-20 14:15:37.0" resolutiondate="2018-02-10 21:20:33.0" votes="0" watches="2" workflowId="41140"> <description><! CDATA During upgrade of the peers, if chaincode container images on v1.0 are not deleted, when we send a query or invoke, peer tries to launch the chaincode container using the existing chaincode container image which does not have the mutual tls certificate, chaincode container shows {code:java} docker logs -f dev-peer0.org1.example.com-mycc-1.0 2018-02-06 15:44:26.739 UTC  shim  userChaincodeStreamGetter -> ERRO 001 Error trying to connect to local peer: remote error: tls: bad certificate Error starting Simple chaincode: Error trying to connect to local peer: remote error: tls: bad certificate {code} But peer doesn't show any handshake failures (similar to handshake failures errors we see between peer and orderer when there is any tls issue) or attempts from chaincode container to communicate. A timeout happens in launching the chaincode container and removes chaincode container instance by which we may miss what is happening underlying unless and until we do a new query. At this stage, peer just shows chaincode container creation timeout.  Peer log shows as below {code:java} 2018-02-06 15:44:26.244 UTC  container  lockContainer -> DEBU 37e waiting for container(dev-peer0.org1.example.com-mycc-1.0) lock 2018-02-06 15:44:26.244 UTC  container  lockContainer -> DEBU 37f got container (dev-peer0.org1.example.com-mycc-1.0) lock 2018-02-06 15:44:26.244 UTC  dockercontroller  Start -> DEBU 380 Cleanup container dev-peer0.org1.example.com-mycc-1.0 2018-02-06 15:44:26.245 UTC  dockercontroller  stopInternal -> DEBU 381 Stop container dev-peer0.org1.example.com-mycc-1.0(Container not running: dev-peer0.org1.example.com-mycc-1.0) 2018-02-06 15:44:26.245 UTC  dockercontroller  stopInternal -> DEBU 382 Kill container dev-peer0.org1.example.com-mycc-1.0 (API error (409): {"message":"Cannot kill container: dev-peer0.org1.example.com-mycc-1.0: Container 1caa993e4b25ac57af0367eef042051be133ff0dc9ebac0a5b8f00b1e406cd93 is not running"} ) 2018-02-06 15:44:26.255 UTC  dockercontroller  stopInternal -> DEBU 383 Removed container dev-peer0.org1.example.com-mycc-1.0 2018-02-06 15:44:26.255 UTC  dockercontroller  Start -> DEBU 384 Start container dev-peer0.org1.example.com-mycc-1.0 2018-02-06 15:44:26.255 UTC  dockercontroller  getDockerHostConfig -> DEBU 385 docker container hostconfig NetworkMode: e2ecli_default 2018-02-06 15:44:26.256 UTC  dockercontroller  createContainer -> DEBU 386 Create container: dev-peer0.org1.example.com-mycc-1.0 2018-02-06 15:44:26.308 UTC  dockercontroller  createContainer -> DEBU 387 Created container: dev-peer0.org1.example.com-mycc-1.0-384f11f484b9302df90b453200cfb25174305fce8f53f4e94d45ee3b6cab0ce9 2018-02-06 15:44:26.713 UTC  dockercontroller  Start -> DEBU 388 Started container dev-peer0.org1.example.com-mycc-1.0 2018-02-06 15:44:26.713 UTC  container  unlockContainer -> DEBU 389 container lock deleted(dev-peer0.org1.example.com-mycc-1.0) 2018-02-06 15:49:26.243 UTC  chaincode  launchAndWaitForRegister -> DEBU 38b stopping due to error while launching: timeout expired while starting chaincode mycc:1.0(networkid:dev,peerid:peer0.org1.example.com,tx:77e0f51121dc9a63277381c376961f151fa2671993cba4c8d56aa06435ea41bb) github.com/hyperledger/fabric/core/chaincode.(*ChaincodeSupport).launchAndWaitForRegister     /opt/gopath/src/github.com/hyperledger/fabric/core/chaincode/chaincode_support.go:567 github.com/hyperledger/fabric/core/chaincode.(*ChaincodeSupport).Launch     /opt/gopath/src/github.com/hyperledger/fabric/core/chaincode/chaincode_support.go:729 github.com/hyperledger/fabric/core/chaincode.Execute     /opt/gopath/src/github.com/hyperledger/fabric/core/chaincode/exectransaction.go:45 github.com/hyperledger/fabric/core/chaincode.ExecuteChaincode     /opt/gopath/src/github.com/hyperledger/fabric/core/chaincode/chaincodeexec.go:85 github.com/hyperledger/fabric/core/endorser.(*SupportImpl).Execute     /opt/gopath/src/github.com/hyperledger/fabric/core/endorser/support.go:93 github.com/hyperledger/fabric/core/endorser.(*Endorser).callChaincode     /opt/gopath/src/github.com/hyperledger/fabric/core/endorser/endorser.go:123 github.com/hyperledger/fabric/core/endorser.(*Endorser).simulateProposal     /opt/gopath/src/github.com/hyperledger/fabric/core/endorser/endorser.go:256 github.com/hyperledger/fabric/core/endorser.(*Endorser).ProcessProposal     /opt/gopath/src/github.com/hyperledger/fabric/core/endorser/endorser.go:458 github.com/hyperledger/fabric/core/handlers/auth/filter.(*expirationCheckFilter).ProcessProposal     /opt/gopath/src/github.com/hyperledger/fabric/core/handlers/auth/filter/expiration.go:61 github.com/hyperledger/fabric/core/handlers/auth/filter.(*filter).ProcessProposal     /opt/gopath/src/github.com/hyperledger/fabric/core/handlers/auth/filter/filter.go:31 github.com/hyperledger/fabric/protos/peer._Endorser_ProcessProposal_Handler     /opt/gopath/src/github.com/hyperledger/fabric/protos/peer/peer.pb.go:112 github.com/hyperledger/fabric/vendor/google.golang.org/grpc.(*Server).processUnaryRPC     /opt/gopath/src/github.com/hyperledger/fabric/vendor/google.golang.org/grpc/server.go:781 github.com/hyperledger/fabric/vendor/google.golang.org/grpc.(*Server).handleStream     /opt/gopath/src/github.com/hyperledger/fabric/vendor/google.golang.org/grpc/server.go:981 github.com/hyperledger/fabric/vendor/google.golang.org/grpc.(*Server).serveStreams.func1.1     /opt/gopath/src/github.com/hyperledger/fabric/vendor/google.golang.org/grpc/server.go:551 runtime.goexit     /opt/go/src/runtime/asm_amd64.s:2337 2018-02-06 15:49:26.243 UTC  container  lockContainer -> DEBU 38c waiting for container(dev-peer0.org1.example.com-mycc-1.0) lock 2018-02-06 15:49:26.243 UTC  container  lockContainer -> DEBU 38d got container (dev-peer0.org1.example.com-mycc-1.0) lock 2018-02-06 15:49:26.245 UTC  dockercontroller  stopInternal -> DEBU 38e Stop container dev-peer0.org1.example.com-mycc-1.0(Container not running: dev-peer0.org1.example.com-mycc-1.0) 2018-02-06 15:49:26.245 UTC  dockercontroller  stopInternal -> DEBU 38f Kill container dev-peer0.org1.example.com-mycc-1.0 (API error (409): {"message":"Cannot kill container: dev-peer0.org1.example.com-mycc-1.0: Container c47f62a1f3f0c0bea1039cd8cfd5743f61a7fd2e5ede1ebbf6d9d181bf193fdb is not running"} ) 2018-02-06 15:49:26.254 UTC  dockercontroller  stopInternal -> DEBU 390 Removed container dev-peer0.org1.example.com-mycc-1.0 2018-02-06 15:49:26.254 UTC  container  unlockContainer -> DEBU 391 container lock deleted(dev-peer0.org1.example.com-mycc-1.0) 2018-02-06 15:49:26.254 UTC  chaincode  func1 -> DEBU 392 chaincode mycc:1.0 launch seq completed 2018-02-06 15:49:26.254 UTC  chaincode  Launch -> ERRO 393 launchAndWaitForRegister failed: timeout expired while starting chaincode mycc:1.0(networkid:dev,peerid:peer0.org1.example.com,tx:77e0f51121dc9a63277381c376961f151fa2671993cba4c8d56aa06435ea41bb) github.com/hyperledger/fabric/core/chaincode.(*ChaincodeSupport).launchAndWaitForRegister     /opt/gopath/src/github.com/hyperledger/fabric/core/chaincode/chaincode_support.go:567 github.com/hyperledger/fabric/core/chaincode.(*ChaincodeSupport).Launch     /opt/gopath/src/github.com/hyperledger/fabric/core/chaincode/chaincode_support.go:729 github.com/hyperledger/fabric/core/chaincode.Execute     /opt/gopath/src/github.com/hyperledger/fabric/core/chaincode/exectransaction.go:45 github.com/hyperledger/fabric/core/chaincode.ExecuteChaincode     /opt/gopath/src/github.com/hyperledger/fabric/core/chaincode/chaincodeexec.go:85 github.com/hyperledger/fabric/core/endorser.(*SupportImpl).Execute     /opt/gopath/src/github.com/hyperledger/fabric/core/endorser/support.go:93 github.com/hyperledger/fabric/core/endorser.(*Endorser).callChaincode     /opt/gopath/src/github.com/hyperledger/fabric/core/endorser/endorser.go:123 github.com/hyperledger/fabric/core/endorser.(*Endorser).simulateProposal     /opt/gopath/src/github.com/hyperledger/fabric/core/endorser/endorser.go:256 github.com/hyperledger/fabric/core/endorser.(*Endorser).ProcessProposal     /opt/gopath/src/github.com/hyperledger/fabric/core/endorser/endorser.go:458 github.com/hyperledger/fabric/core/handlers/auth/filter.(*expirationCheckFilter).ProcessProposal     /opt/gopath/src/github.com/hyperledger/fabric/core/handlers/auth/filter/expiration.go:61 github.com/hyperledger/fabric/core/handlers/auth/filter.(*filter).ProcessProposal     /opt/gopath/src/github.com/hyperledger/fabric/core/handlers/auth/filter/filter.go:31 github.com/hyperledger/fabric/protos/peer._Endorser_ProcessProposal_Handler     /opt/gopath/src/github.com/hyperledger/fabric/protos/peer/peer.pb.go:112 github.com/hyperledger/fabric/vendor/google.golang.org/grpc.(*Server).processUnaryRPC     /opt/gopath/src/github.com/hyperledger/fabric/vendor/google.golang.org/grpc/server.go:781 github.com/hyperledger/fabric/vendor/google.golang.org/grpc.(*Server).handleStream     /opt/gopath/src/github.com/hyperledger/fabric/vendor/google.golang.org/grpc/server.go:981 github.com/hyperledger/fabric/vendor/google.golang.org/grpc.(*Server).serveStreams.func1.1     /opt/gopath/src/github.com/hyperledger/fabric/vendor/google.golang.org/grpc/server.go:551 runtime.goexit     /opt/go/src/runtime/asm_amd64.s:2337  {code} *Expected Result:* Need some sort of message showing the attempts from chaincode container.           ></description> </Issue>
