<Issue id="15395" key="FAB-2822" number="2822" project="10002" reporter="scottz" assignee="binhn" creator="scottz" type="10004" summary="&quot;failed to obtain cds for mycc&quot; error in e2e_cli test modified to Invoke before first Query" priority="3" resolution="10000" status="6" created="2017-03-17 23:36:55.0" updated="2018-07-20 14:12:01.0" resolutiondate="2017-06-03 00:34:49.0" votes="0" watches="5" workflowId="37810"> <environment><! CDATA  For reference, some logs are attached. And, below are details of my test environment (docker containers in vagrant, on linux laptop), showing the script changes.   {noformat} vagrant@hyperledger-devenv:v0.3.0-db6af20:/opt/gopath/src/github.com/hyperledger/fabric/examples/e2e_cli$ git diffdiff --git a/examples/e2e_cli/docker-compose.yaml b/examples/e2e_cli/docker-compose.yaml index dee9eae..b2f455a 100644 --- a/examples/e2e_cli/docker-compose.yaml +++ b/examples/e2e_cli/docker-compose.yaml @@ -6,6 +6,7 @@ services: container_name: orderer0 image: hyperledger/fabric-orderer environment: +      - CORE_LOGGING_LEVEL=DEBUG - ORDERER_GENERAL_LOGLEVEL=debug - ORDERER_GENERAL_LISTENADDRESS=0.0.0.0 - ORDERER_GENERAL_GENESISMETHOD=file diff --git a/examples/e2e_cli/scripts/script.sh b/examples/e2e_cli/scripts/script.sh index 6591709..39ec238 100755 --- a/examples/e2e_cli/scripts/script.sh +++ b/examples/e2e_cli/scripts/script.sh @@ -2,7 +2,7 @@  CHANNEL_NAME="$1" : ${CHANNEL_NAME:="mychannel"} -: ${TIMEOUT:="60"} +: ${TIMEOUT:="90"} COUNTER=0 MAX_RETRY=5 ORDERER_CA=/opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/orderer/localMspConfig/cacerts/ordererOrg0.pem @@ -158,13 +158,13 @@ installChaincode 2 echo "Instantiating chaincode on Peer2/Org1 ..." instantiateChaincode 2  -#Query on chaincode on Peer0/Org0 -chaincodeQuery 0 100 - #Invoke on chaincode on Peer0/Org0 echo "send Invoke transaction on Peer0/Org0 ..." chaincodeInvoke 0  +#Query on chaincode on Peer0/Org0 +chaincodeQuery 0 90 + ## Install chaincode on Peer3/Org1 installChaincode 3 {noformat}   ></environment> <description><! CDATA {noformat} Error endorsing invoke: rpc error: code = 2 desc = failed to obtain cds for mycc - transaction not found mycc/mychannel {noformat}   The above error was seen in cli logs during the attempt to invoke on peer 0, when executing e2e_cli using commit: fa3d88c Release 1.0.0-alpha.   **Note* there was one tiny modification to e2e_cli/scripts/script.sh : I moved up the statement to send the Invoke on peer0 PRIOR TO the Query on peer0.   {noformat} vagrant@hyperledger-devenv:v0.3.0-db6af20:/opt/gopath/src/github.com/hyperledger/fabric/examples/e2e_cli$ ./network_setup.sh restart {noformat}   There were other changes which seemed to be contributing factors in reproducing this, but hopefully this writeup provides the simplest form and is enough to find the root cause.  For example, increasing the BatchTimeout often (but not always) resulted in this error, especially when  > 30 seconds.  For reference, some logs are attached. And, below in the "Environment" section are details of my test environment, showing the script changes.  ></description> </Issue>
