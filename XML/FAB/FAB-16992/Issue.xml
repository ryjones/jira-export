<Issue id="43075" key="FAB-16992" number="16992" project="10002" reporter="sykesm" assignee="sykesm" creator="sykesm" type="10004" summary="Failure in external build does not fail chaincode deployment" priority="3" resolution="10000" status="6" created="2019-11-01 18:42:58.0" updated="2019-11-07 21:54:53.0" resolutiondate="2019-11-07 21:54:53.0" votes="0" watches="1" workflowId="56181"> <description><! CDATA I have configured an external chaincode builder and launcher that successfully detects but fails to build golang chaincode. When this happens, the installation is still considered "successful" because the peer fell back to using the platform logic within the peer. This is unexpected.  When an external builder has taken responsibility for an instance of chaincode, there should not be a fallback to the platform.  Snippets from a build failure followed by platform: {code}  d  peer-chaincode-install  starting peer chaincode install /var/folders/tw/dsbwtnf50w7dhvhh0tkg7fwr0000gn/T/ledger658970306/marbles_legacy.tar.gz --name marbles --version 0.0 --path github.com/hyperledger/fabric/integration/chaincode/marbles/cmdwithindexspecs  e  Org1.peer0  2019-11-01 13:23:21.330 EDT  endorser  callChaincode -> INFO 0d5    37aea090  Entry chaincode: lscc  e  Org1.peer0  2019-11-01 13:23:21.330 EDT  chaincode  CheckInvocation -> DEBU 0d6  37aea090  getting chaincode data for lscc on channel   e  Org1.peer0  2019-11-01 13:23:21.332 EDT  chaincode  Execute -> DEBU 0d7 Entry  e  Org1.peer0  2019-11-01 13:23:21.554 EDT  chaincode.externalbuilders.binary  RunCommand -> INFO 0d8 binary is the only supported type  e  Org1.peer0  2019-11-01 13:23:21.555 EDT  chaincode.externalbuilders  Detect -> DEBU 0d9 Detection for builder 'binary' detect failed: exit status 1  e  Org1.peer0  2019-11-01 13:23:21.593 EDT  chaincode.externalbuilders.external-golang  RunCommand -> INFO 0da {"path":"github.com/hyperledger/fabric/integration/chaincode/marbles/cmdwithindexspecs","type":"GOLANG","package_id":"marbles:0.0"}  e  Org1.peer0  2019-11-01 13:23:21.599 EDT  chaincode.externalbuilders.external-golang  RunCommand -> INFO 0db + ' ' 3 -ne 3 ' '  e  Org1.peer0  2019-11-01 13:23:21.599 EDT  chaincode.externalbuilders.external-golang  RunCommand -> INFO 0dc + SOURCE=/var/folders/tw/dsbwtnf50w7dhvhh0tkg7fwr0000gn/T/fabric-marbles-0.0273266929/src  e  Org1.peer0  2019-11-01 13:23:21.599 EDT  chaincode.externalbuilders.external-golang  RunCommand -> INFO 0dd + METADATA=/var/folders/tw/dsbwtnf50w7dhvhh0tkg7fwr0000gn/T/fabric-marbles-0.0273266929/metadata  e  Org1.peer0  2019-11-01 13:23:21.599 EDT  chaincode.externalbuilders.external-golang  RunCommand -> INFO 0de + OUTPUT=/var/folders/tw/dsbwtnf50w7dhvhh0tkg7fwr0000gn/T/fabric-marbles-0.0273266929/bld  e  Org1.peer0  2019-11-01 13:23:21.600 EDT  chaincode.externalbuilders.external-golang  RunCommand -> INFO 0df ++ jq -r .path /var/folders/tw/dsbwtnf50w7dhvhh0tkg7fwr0000gn/T/fabric-marbles-0.0273266929/metadata/metadata.json  e  Org1.peer0  2019-11-01 13:23:21.629 EDT  chaincode.externalbuilders.external-golang  RunCommand -> INFO 0e0 + GO_PACKAGE_PATH=github.com/hyperledger/fabric/integration/chaincode/marbles/cmdwithindexspecs  e  Org1.peer0  2019-11-01 13:23:21.629 EDT  chaincode.externalbuilders.external-golang  RunCommand -> INFO 0e1 + ' ' -f /var/folders/tw/dsbwtnf50w7dhvhh0tkg7fwr0000gn/T/fabric-marbles-0.0273266929/src/src/go.mod ' '  e  Org1.peer0  2019-11-01 13:23:21.629 EDT  chaincode.externalbuilders.external-golang  RunCommand -> INFO 0e2 + echo 'Chaincode is not a module'  e  Org1.peer0  2019-11-01 13:23:21.629 EDT  chaincode.externalbuilders.external-golang  RunCommand -> INFO 0e3 Chaincode is not a module  e  Org1.peer0  2019-11-01 13:23:21.629 EDT  chaincode.externalbuilders.external-golang  RunCommand -> INFO 0e4 + exit 1  e  Org1.peer0  2019-11-01 13:23:21.682 EDT  chaincode.platform  GenerateDockerfile -> DEBU 0e5   e  Org1.peer0  FROM hyperledger/fabric-baseos:latest  e  Org1.peer0  ADD binpackage.tar /usr/local/bin  e  Org1.peer0  LABEL org.hyperledger.fabric.chaincode.type="GOLANG" \  e  Org1.peer0        org.hyperledger.fabric.version="latest"  e  Org1.peer0  ENV CORE_CHAINCODE_BUILDLEVEL=latest  e  Org1.peer0  2019-11-01 13:23:21.695 EDT  chaincode.platform.util  DockerBuild -> DEBU 0e6 Attempting build with image hyperledger/fabric-ccenv:latest  e  Org2.peer0  2019-11-01 13:23:22.098 EDT  gossip.election  stopBeingLeader -> INFO 06f b7c12c8016d5606f440619d6cdd39f188cbbdd768dde0b8c31a67fe4073d61c5 Stopped being a leader  e  Org2.peer0  2019-11-01 13:23:22.099 EDT  gossip.service  func1 -> INFO 070 Renounced leadership, stopping delivery service for channel testchannel  e  Org2.peer0  2019-11-01 13:23:22.099 EDT  peer.blocksprovider  func1 -> WARN 071 Encountered an error reading from deliver stream: rpc error: code = Canceled desc = context canceled channel=testchannel orderer-address=127.0.0.1:21500  e  OrdererOrg.orderer  2019-11-01 13:23:22.099 EDT  comm.grpc.server  1 -> INFO 01e streaming call completed grpc.service=orderer.AtomicBroadcast grpc.method=Deliver grpc.peer_address=127.0.0.1:57762 error="context finished before block retrieved: context canceled" grpc.code=Unknown grpc.call_duration=5.006626091s  e  Org1.peer0  2019-11-01 13:23:25.815 EDT  gossip.channel  reportMembershipChanges -> INFO 0e7   testchannel  Membership view has changed. peers went online:    127.0.0.1:21509 9.27.116.57:21509   , current view:    127.0.0.1:21514    127.0.0.1:21509 9.27.116.57:21509   127.0.0.1:21519      e  Org1.peer1  2019-11-01 13:23:25.949 EDT  gossip.channel  reportMembershipChanges -> INFO 068   testchannel  Membership view has changed. peers went online:    127.0.0.1:21504 9.27.116.57:21504   , current view:    127.0.0.1:21504 9.27.116.57:21504   127.0.0.1:21514    127.0.0.1:21519      e  Org1.peer1  2019-11-01 13:23:26.828 EDT  gossip.election  stopBeingLeader -> INFO 069 8a807a217cac6fcb8980b77f9c9d16d4d10fc36ee7bfacff803ae9da1735f62e Stopped being a leader  e  Org1.peer1  2019-11-01 13:23:26.828 EDT  gossip.service  func1 -> INFO 06a Renounced leadership, stopping delivery service for channel testchannel  e  Org1.peer1  2019-11-01 13:23:26.828 EDT  peer.blocksprovider  func1 -> WARN 06b Encountered an error reading from deliver stream: rpc error: code = Canceled desc = grpc: the client connection is closing channel=testchannel orderer-address=127.0.0.1:21500  e  OrdererOrg.orderer  2019-11-01 13:23:26.828 EDT  comm.grpc.server  1 -> INFO 01f streaming call completed grpc.service=orderer.AtomicBroadcast grpc.method=Deliver grpc.peer_address=127.0.0.1:57750 error="context finished before block retrieved: context canceled" grpc.code=Unknown grpc.call_duration=9.868717903s  e  Org1.peer0  2019-11-01 13:23:29.583 EDT  chaincode.platform.util  DockerBuild -> DEBU 0e8 Build output is github.com/hyperledger/fabric/vendor/google.golang.org/grpc/internal/grpcsync  e  Org1.peer0  github.com/hyperledger/fabric/vendor/google.golang.org/grpc/internal/grpcrand  e  Org1.peer0  github.com/hyperledger/fabric/vendor/google.golang.org/grpc/encoding  e  Org1.peer0  github.com/hyperledger/fabric/vendor/golang.org/x/text/transform  e  Org1.peer0  github.com/hyperledger/fabric/vendor/golang.org/x/sys/unix  e  Org1.peer0  github.com/hyperledger/fabric/vendor/github.com/golang/protobuf/proto  e  Org1.peer0  github.com/hyperledger/fabric/vendor/golang.org/x/net/internal/timeseries  e  Org1.peer0  github.com/hyperledger/fabric/vendor/google.golang.org/grpc/grpclog  e  Org1.peer0  github.com/hyperledger/fabric/vendor/google.golang.org/grpc/credentials/internal  e  Org1.peer0  github.com/hyperledger/fabric/vendor/google.golang.org/grpc/metadata  e  Org1.peer0  github.com/hyperledger/fabric/vendor/google.golang.org/grpc/codes  e  Org1.peer0  github.com/hyperledger/fabric/vendor/google.golang.org/grpc/connectivity  e  Org1.peer0  github.com/hyperledger/fabric/vendor/golang.org/x/net/trace  e  Org1.peer0  github.com/hyperledger/fabric/vendor/google.golang.org/grpc/internal/backoff  e  Org1.peer0  github.com/hyperledger/fabric/vendor/google.golang.org/grpc/internal/balancerload  e  Org1.peer0  github.com/hyperledger/fabric/vendor/google.golang.org/grpc/internal  e  Org1.peer0  github.com/hyperledger/fabric/vendor/google.golang.org/grpc/internal/envconfig  e  Org1.peer0  github.com/hyperledger/fabric/vendor/golang.org/x/text/unicode/bidi  e  Org1.peer0  github.com/hyperledger/fabric/vendor/google.golang.org/grpc/serviceconfig  e  Org1.peer0  github.com/hyperledger/fabric/vendor/golang.org/x/text/unicode/norm  e  Org1.peer0  github.com/hyperledger/fabric/vendor/google.golang.org/grpc/resolver  e  Org1.peer0  github.com/hyperledger/fabric/vendor/golang.org/x/net/http2/hpack  e  Org1.peer0  github.com/hyperledger/fabric/vendor/google.golang.org/grpc/keepalive  e  Org1.peer0  github.com/hyperledger/fabric/vendor/golang.org/x/text/secure/bidirule  e  Org1.peer0  github.com/hyperledger/fabric/vendor/google.golang.org/grpc/stats  e  Org1.peer0  github.com/hyperledger/fabric/vendor/google.golang.org/grpc/tap  e  Org1.peer0  github.com/hyperledger/fabric/vendor/google.golang.org/grpc/naming  e  Org1.peer0  github.com/hyperledger/fabric/vendor/google.golang.org/grpc/resolver/dns  e  Org1.peer0  github.com/hyperledger/fabric/vendor/google.golang.org/grpc/resolver/passthrough  e  Org1.peer0  github.com/hyperledger/fabric/vendor/golang.org/x/net/idna  e  Org1.peer0  github.com/hyperledger/fabric/vendor/google.golang.org/grpc/internal/syscall  e  Org1.peer0  github.com/hyperledger/fabric/vendor/golang.org/x/net/http/httpguts  e  Org1.peer0  github.com/hyperledger/fabric/vendor/golang.org/x/net/http2  e  Org1.peer0  github.com/hyperledger/fabric/vendor/github.com/golang/protobuf/ptypes/timestamp  e  Org1.peer0  github.com/hyperledger/fabric/vendor/google.golang.org/grpc/encoding/proto  e  Org1.peer0  github.com/hyperledger/fabric/vendor/google.golang.org/grpc/credentials  e  Org1.peer0  github.com/hyperledger/fabric/vendor/github.com/hyperledger/fabric-protos-go/ledger/rwset  e  Org1.peer0  github.com/hyperledger/fabric/vendor/github.com/hyperledger/fabric-protos-go/msp  e  Org1.peer0  github.com/hyperledger/fabric/vendor/github.com/golang/protobuf/ptypes/any  e  Org1.peer0  github.com/hyperledger/fabric/vendor/github.com/golang/protobuf/ptypes/duration  e  Org1.peer0  github.com/hyperledger/fabric/vendor/google.golang.org/genproto/googleapis/rpc/status  e  Org1.peer0  github.com/hyperledger/fabric/vendor/google.golang.org/grpc/balancer  e  Org1.peer0  github.com/hyperledger/fabric/vendor/github.com/golang/protobuf/ptypes  e  Org1.peer0  github.com/hyperledger/fabric/vendor/google.golang.org/grpc/binarylog/grpc_binarylog_v1  e  Org1.peer0  github.com/hyperledger/fabric/vendor/google.golang.org/grpc/internal/channelz  e  Org1.peer0  github.com/hyperledger/fabric/vendor/google.golang.org/grpc/balancer/base  e  Org1.peer0  github.com/hyperledger/fabric/vendor/google.golang.org/grpc/status  e  Org1.peer0  github.com/hyperledger/fabric/vendor/github.com/hyperledger/fabric-protos-go/common  e  Org1.peer0  github.com/hyperledger/fabric/vendor/google.golang.org/grpc/balancer/roundrobin  e  Org1.peer0  github.com/hyperledger/fabric/vendor/google.golang.org/grpc/peer  e  Org1.peer0  github.com/hyperledger/fabric/vendor/github.com/hyperledger/fabric-protos-go/ledger/queryresult  e  Org1.peer0  github.com/hyperledger/fabric/vendor/google.golang.org/grpc/internal/binarylog  e  Org1.peer0  github.com/hyperledger/fabric/vendor/google.golang.org/grpc/internal/transport  e  Org1.peer0  github.com/hyperledger/fabric/vendor/google.golang.org/grpc  e  Org1.peer0  github.com/hyperledger/fabric/vendor/github.com/hyperledger/fabric-protos-go/peer  e  Org1.peer0  github.com/hyperledger/fabric/vendor/github.com/hyperledger/fabric-chaincode-go/shim/internal  e  Org1.peer0  github.com/hyperledger/fabric/vendor/github.com/hyperledger/fabric-chaincode-go/shim  e  Org1.peer0  github.com/hyperledger/fabric/integration/chaincode/marbles  e  Org1.peer0  github.com/hyperledger/fabric/integration/chaincode/marbles/cmdwithindexspecs  e  Org1.peer0  Done!  e  Org1.peer0  2019-11-01 13:23:31.685 EDT  chaincode.platform.metadata  validateIndexJSON -> DEBU 0e9 Found index object: "ddoc":"indexColorSortDoc"  e  Org1.peer0  2019-11-01 13:23:31.685 EDT  chaincode.platform.metadata  validateIndexJSON -> DEBU 0ea Found index object: "name":"indexColorSortDesc"  e  Org1.peer0  2019-11-01 13:23:31.685 EDT  chaincode.platform.metadata  validateIndexJSON -> DEBU 0eb Found index object: "type":"json"  e  Org1.peer0  2019-11-01 13:23:31.685 EDT  chaincode.platform.metadata  validateFieldMap -> DEBU 0ec Found index field name: "color":"desc"  e  Org1.peer0  2019-11-01 13:23:31.685 EDT  chaincode.platform.metadata  validateFieldMap -> DEBU 0ed Found index field name: "docType":"desc"  e  Org1.peer0  2019-11-01 13:23:31.685 EDT  chaincode.platform.metadata  validateFieldMap -> DEBU 0ee Found index field name: "owner":"desc"  e  Org1.peer0  2019-11-01 13:23:31.685 EDT  chaincode.platform.metadata  validateIndexJSON -> DEBU 0ef Found index object: "type":"json"  e  Org1.peer0  2019-11-01 13:23:31.685 EDT  chaincode.platform.metadata  validateFieldMap -> DEBU 0f0 Found index field name: "size":"desc"  e  Org1.peer0  2019-11-01 13:23:31.685 EDT  chaincode.platform.metadata  validateFieldMap -> DEBU 0f1 Found index field name: "docType":"desc"  e  Org1.peer0  2019-11-01 13:23:31.685 EDT  chaincode.platform.metadata  validateFieldMap -> DEBU 0f2 Found index field name: "owner":"desc"  e  Org1.peer0  2019-11-01 13:23:31.685 EDT  chaincode.platform.metadata  validateIndexJSON -> DEBU 0f3 Found index object: "ddoc":"indexSizeSortDoc"  e  Org1.peer0  2019-11-01 13:23:31.685 EDT  chaincode.platform.metadata  validateIndexJSON -> DEBU 0f4 Found index object: "name":"indexSizeSortDesc"  e  Org1.peer0  2019-11-01 13:23:31.715 EDT  couchdb  CreateDatabaseIfNotExist -> INFO 0f5 Created state database testchannel_lscc  e  Org1.peer0  2019-11-01 13:23:31.718 EDT  lscc  executeInstall -> INFO 0f6 Installed Chaincode  marbles  Version  0.0  to peer  e  Org1.peer0  2019-11-01 13:23:31.718 EDT  chaincode  handleMessage -> DEBU 0f7  37aea090  Fabric side handling ChaincodeMessage of type: COMPLETED in state ready  e  Org1.peer0  2019-11-01 13:23:31.718 EDT  chaincode  Notify -> DEBU 0f8  37aea090  notifying Txid:37aea090a19ea01fb901e6c47ad0bcb23c59c541fda1b76739dd835f50360e8e, channelID:  e  Org1.peer0  2019-11-01 13:23:31.718 EDT  chaincode  Execute -> DEBU 0f9 Exit  e  Org1.peer0  2019-11-01 13:23:31.718 EDT  endorser  callChaincode -> INFO 0fa    37aea090  Exit chaincode: lscc (10388ms)  e  Org1.peer0  2019-11-01 13:23:31.718 EDT  comm.grpc.server  1 -> INFO 0fb unary call completed grpc.service=protos.Endorser grpc.method=ProcessProposal grpc.peer_address=127.0.0.1:57881 grpc.code=OK grpc.call_duration=10.406751562s  e  peer-chaincode-install  2019-11-01 13:23:31.718 EDT  chaincodeCmd  submitInstallProposal -> INFO 001 Installed remotely: response:<status:200 payload:"OK" >  {code}  ></description> </Issue>
