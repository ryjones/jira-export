<Issue id="12303" key="FAB-5" number="5" project="10002" reporter="juliancarrivick" assignee="jeffgarratt" creator="juliancarrivick" type="10004" summary="During BDD Tests, occassionally when peers get stopped and started they get new IPs" environment="Jenkins x86_64 Host" priority="3" resolution="10000" status="6" created="2016-08-10 00:52:47.0" updated="2018-07-20 14:09:57.0" resolutiondate="2017-03-09 22:51:06.0" votes="0" watches="4" timeoriginalestimate="57600" timeestimate="57600" workflowId="35990"> <description><! CDATA Every now and then the BDD tests will fail for seemingly unknown reasons that are not related to the delivered patch set. It usually takes the form of a timeout when attempting to verify a transaction occurred after taking down some peers and bring them back up. The test which seems to exhibit it the most is {{@issue 1000 - chaincode example02 with 4 peers and 1 membersrvc, test crash fault}}.  After adding some extra debug statements to the tests it seems the peers, when brought back up get new IP addresses however the old IPs are still retained which means that consensus cannot be reached: 33m04:26:42.673  peer  ensureConnected -> WARN 6e95 0m Touch service indicates dropped connections, attempting to reconnect...  36m04:26:42.674  peer  ensureConnected -> DEBU 6e96 0m Connected to:  172.17.0.40:7051 172.17.0.41:7051   36m04:26:42.674  peer  ensureConnected -> DEBU 6e97 0m Discovery knows about:  172.17.0.34:7051 172.17.0.35:7051 172.17.0.40:7051 172.17.0.41:7051 172.17.0.33:7051   36m04:26:42.674  peer  chatWithPeer -> DEBU 6e98 0m Initiating Chat with peer address: 172.17.0.33:7051  36m04:26:42.675  peer  chatWithPeer -> DEBU 6e99 0m Initiating Chat with peer address: 172.17.0.34:7051  36m04:26:42.675  peer  chatWithPeer -> DEBU 6e9a 0m Initiating Chat with peer address: 172.17.0.35:7051 ... 2016/08/09 04:26:45 grpc: ClientConn.resetTransport failed to create client transport: connection error: desc = "transport: dial tcp 172.17.0.34:7051: getsockopt: no route to host"; Reconnecting to "172.17.0.34:7051" 2016/08/09 04:26:45 grpc: ClientConn.resetTransport failed to create client transport: connection error: desc = "transport: dial tcp 172.17.0.35:7051: getsockopt: no route to host"; Reconnecting to "172.17.0.35:7051" 2016/08/09 04:26:45 grpc: ClientConn.resetTransport failed to create client transport: connection error: desc = "transport: dial tcp 172.17.0.33:7051: getsockopt: no route to host"; Reconnecting to "172.17.0.33:7051"  31m04:26:45.675  peer  chatWithPeer -> ERRO 6efd 0m Error creating connection to peer address 172.17.0.33:7051: grpc: timed out trying to connect  31m04:26:45.675  peer  chatWithPeer -> ERRO 6efe 0m Error creating connection to peer address 172.17.0.34:7051: grpc: timed out trying to connect  31m04:26:45.675  peer  chatWithPeer -> ERRO 6eff 0m Error creating connection to peer address 172.17.0.35:7051: grpc: timed out trying to connect ...  36m04:26:43.225  consensus/pbft  ProcessEvent -> DEBU 6ebd 0m Replica 0 view change resend timer expired before view change quorum was reached, resending  Logs from failing scenario attached (compressed because too large).  Ideally, the peers would connect and register using their new IPs, the old ones would be discarded and execution could continue as normal.  ></description> </Issue>
