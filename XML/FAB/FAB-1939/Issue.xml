<Issue id="14441" key="FAB-1939" number="1939" project="10002" reporter="nishi" assignee="manish-sethi" creator="nishi" type="10004" summary="Commit fails when writes were sent to a ledger from parallel clients" priority="2" resolution="10000" status="6" created="2017-01-30 18:07:41.0" updated="2018-07-20 14:11:24.0" resolutiondate="2017-04-07 18:23:21.0" votes="0" watches="3" workflowId="37231"> <description><! CDATA Input: 400 keys Ledgers: 500 Parallel Clients: 10 #keys per tx; 4 BatchSize: 10  At the time building a block with batchSize10. Program failed with following error.  P.S. Same program war run successfully when code to Commit was locked using a sync.Mutex  2017/01/30 17:28:21 Write lock aquired for committing updates to state database panic: validateAndPrepare() method should have been called before calling commit()  goroutine 89  running : panic(0x904020, 0xc421ca2250) /opt/go/src/runtime/panic.go:500 +0x1a1 github.com/hyperledger/fabric/core/ledger/kvledger/txmgmt/txmgr/lockbasedtxmgr.(*LockBasedTxMgr).Commit(0xc4202712c0, 0x0, 0x0) /opt/gopath/src/github.com/hyperledger/fabric/core/ledger/kvledger/txmgmt/txmgr/lockbasedtxmgr/lockbased_txmgr.go:98 +0x283 github.com/hyperledger/fabric/core/ledger/kvledger.(*kvLedger).Commit(0xc420013640, 0xc421e12bc0, 0xd50aad4, 0x9298e3e9bf942b65) /opt/gopath/src/github.com/hyperledger/fabric/core/ledger/kvledger/kv_ledger.go:272 +0x165 github.com/hyperledger/fabric/core/ledger/ledgermgmt.(*closableLedger).Commit(0xc4201caae0, 0xc421e12bc0, 0x4, 0xc421751758) <autogenerated>:1 +0x54 github.com/hyperledger/fabric/core/ledger/perf.buildBatchAndCommitTransactions(0x4, 0xa, 0x3c, 0x32) /opt/gopath/src/github.com/hyperledger/fabric/core/ledger/perf/perf_concurrency_test.go:230 +0x2ee github.com/hyperledger/fabric/core/ledger/perf.simulateWriteTx(0x4, 0x5, 0x9d27df, 0x4, 0xc8, 0xf0, 0x4, 0xc8, 0xa) /opt/gopath/src/github.com/hyperledger/fabric/core/ledger/perf/perf_concurrency_test.go:201 +0x7c8 github.com/hyperledger/fabric/core/ledger/perf.TestWrite_Transactions.func1(0xc421898aa0, 0x28, 0x4, 0x5, 0xc421898a80, 0x0, 0x0, 0xc421898a50, 0xc421898a38, 0xc421898a68) /opt/gopath/src/github.com/hyperledger/fabric/core/ledger/perf/perf_concurrency_test.go:150 +0xc6 created by github.com/hyperledger/fabric/core/ledger/perf.TestWrite_Transactions /opt/gopath/src/github.com/hyperledger/fabric/core/ledger/perf/perf_concurrency_test.go:152 +0x419  ></description> </Issue>
