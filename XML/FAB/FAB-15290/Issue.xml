<Issue id="39535" key="FAB-15290" number="15290" project="10002" reporter="ales" creator="ales" type="10004" summary="Pre-pollution of _lifecycle chaincode namespace allows bypassing of endorsement policy and private data dissemination policy" priority="2" resolution="10002" status="6" created="2019-04-26 17:43:32.0" updated="2019-07-31 15:13:07.0" resolutiondate="2019-07-31 15:12:53.0" votes="0" watches="10" workflowId="52415" security="10000"> <description><! CDATA h1. Scenario  A channel operates with the 1.4 capability. The objective of the org {{evilorg}} is to be able to make changes to keys in the {{targetcc}} namespace and to obtain preimages for private data from the same chaincode. {{evilorg}} is unable to do so because: # the endorsement policy of {{targetcc}} does not permit {{evilorg}} peers to endorse changes to {{targetcc}} # the collection configuration of {{targetcc}} does not permit {{evilorg}} peers to receive preimages for private data of {{targetcc}} # the LSCC entry for {{targetcc}} sets and instantiation policy for {{targetcc}} that only permits admins of {{honestorg}} to make changes to {{targetcc}}  Additionally, {{evilorg}} knows that the channel will soon be upgraded to enable the 2.0 capability. h1. Attack h2. Step 1: create a chaincode definition for targetcc in the _lifecycle namespace  Due to FAB-15294, {{_lifecycle}} can be written to by any org member (including users with a client SDK certificate) in versions 1.3, 1.4 and 2.0. However, even if this is fixed, {{evilorg}} may simply craft an LSCC deployment transaction to deploy {{_lifecycle}} with an endorsement policy that permits its peers to write to it.  Then {{evilorg}} simply commits a chaincode definition for {{targetcc}} such that # the endorsement policy is satisfied by any member of {{evilorg}} # the dissemination policy of any existing collection includes {{evilorg}}  h2. Step 2: wait for the upgrade to 2.0  At this point, as soon as the channel is upgrade to 2.0, {{evilorg}} has achieved its objective because the definition in {{_lifecycle}} will take effect.  h1. Proof of concept  Attached is a PoC for the attack using our integration tests. Just apply it on top of master, go to {{integration/nwo/}} and run tests. The changes to the peer code are just a way to avoid having to manually craft transactions in the integration test and they don't impact the validation code of any honest peer.  ></description> </Issue>
