<Issue id="16153" key="FAB-3556" number="3556" project="10002" reporter="mffrench" assignee="manish-sethi" creator="mffrench" type="10004" summary="Peer panic while commiting non UTF8 Key (CouchDB)" priority="3" resolution="10000" status="6" created="2017-05-02 08:45:24.0" updated="2018-07-20 14:12:30.0" resolutiondate="2017-06-09 13:51:07.0" votes="0" watches="3" workflowId="38254"> <description><! CDATA Hi,  peer is on panic when comiting non UTF8 Key to CouchDB. That's fine from a CouchDB view (Key must be UTF8) but from fabric hyperledger view where we can use CouchDB or goleveldb this leads to behavior divergences on the same API calls.   Probably can we improve this :  + by logging a warning in the case we encounter non UTF8 key on the API implementations side (that way developers will see the problem whatever the ledger db configuration)  OR  + by aligning goleveldb key policy to the couchdb one and so rejecting any request with non UTF8 key on the API stack.   Finally I think this kind of panic should be avoided on the peer but rejected from the API client calls.   Let me know what you think,  Kind regards,  Mathilde  panic: Error during commit to txmgr:doc id  656c697869722d6363005f70726f5f0a044f72673012cf042d2d2d2d2d424547494e2043455254494649434154452d2d2d2d2d0a4d494942686a434341533267417749424167495555706e4b4e387337664d3873583567336155624a4d61746247667377436759494b6f5a497a6a3045417749770a447a454e4d417347413155454177774562334a6e4d444165467730784e7a41304d6a67784e7a51304d444261467730784f44417a4d6a67774d5451304d4442610a4d4259784644415342674e5642414d544331646c596b46776345466b62576c754d466b77457759484b6f5a497a6a3043415159494b6f5a497a6a3044415163440a51674145515a51387548356f6951696b5171794c55514b636f3375564c79496c594465346c347a35663643384c744f70707a51694c384d5156645251595754380a7639324c684c6f43674e61326d2b497a346f536d756b7433484b4e674d46347744675944565230504151482f42415144416749454d41774741315564457745420a2f7751434d414177485159445652304f4242594546416e7048674a72552f4730654d395778384863597146332b6f31714d42384741315564497751594d4261410a464577674456516a495230356670385556716d4c3933484a734f33694d416f4743437147534d343942414d43413063414d45514349435032505a32555164316b0a334f4f466f4f79464f76726b456148476a736d6b6e636d413666773468483362416941725736516834423048647677436b4f316b314a2b57565050384a646b460a7964753047692f54357862492b773d3d0a2d2d2d2d2d454e442043455254494649434154452d2d2d2d2d0a  not a valid utf8 string  goroutine 268  running : panic(0xc13880, 0xc422ce34c0) 	/opt/go/src/runtime/panic.go:500 +0x1a1 github.com/hyperledger/fabric/core/ledger/kvledger.(*kvLedger).Commit(0xc4213f7480, 0xc421a6ec00, 0xd159c1, 0x14) 	/opt/gopath/src/github.com/hyperledger/fabric/core/ledger/kvledger/kv_ledger.go:229 +0x806 github.com/hyperledger/fabric/core/ledger/ledgermgmt.(*closableLedger).Commit(0xc42143b0a0, 0xc421a6ec00, 0x0, 0x0) 	<autogenerated>:1 +0x54 github.com/hyperledger/fabric/core/committer.(*LedgerCommitter).Commit(0xc4216f9f60, 0xc421a6ec00, 0x2, 0xc42e8b5b80) 	/opt/gopath/src/github.com/hyperledger/fabric/core/committer/committer_impl.go:62 +0x121 github.com/hyperledger/fabric/gossip/state.(*GossipStateProviderImpl).commitBlock(0xc4214a95e0, 0xc421a6ec00, 0x4, 0x4, 0xc421d8db88) 	/opt/gopath/src/github.com/hyperledger/fabric/gossip/state/state.go:430 +0x56 github.com/hyperledger/fabric/gossip/state.(*GossipStateProviderImpl).deliverPayloads(0xc4214a95e0) 	/opt/gopath/src/github.com/hyperledger/fabric/gossip/state/state.go:327 +0x45e created by github.com/hyperledger/fabric/gossip/state.NewGossipStateProvider 	/opt/gopath/src/github.com/hyperledger/fabric/gossip/state/state.go:177 +0x73c  ></description> </Issue>
