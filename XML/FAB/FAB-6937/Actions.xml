<Action id="34501" issue="23871" author="yacovm" type="comment" created="2017-11-09 14:14:32.0" updateauthor="yacovm" updated="2017-11-09 14:18:16.0"> <body><! CDATA From looking at the docker compose file you provided I suspect the problem is that you're lacking CORE_PEER_ADDRESS in the file. Notice that in the e2e_cli  we have it defined|https://github.com/hyperledger/fabric/blob/master/examples/e2e_cli/base/docker-compose-base.yaml .  Now, I think what happens is that the peer starts, sees it lacks it and therefore auto-computes it based on ip address. Now, the TLS certificate is issued to the hostname, which is what fails the TLS handshake.   Just define CORE_PEER_ADDRESS to be peer01.lsbgb65.cit.lsnet:7051 and you should be all set   ></body> </Action>
<Action id="34502" issue="23871" author="muralisr" type="comment" created="2017-11-09 14:34:47.0" updateauthor="muralisr" updated="2017-11-09 14:34:47.0"> <body><! CDATA  ~yacovm  the docker compose refers to peer-base.yaml where CORE_PEER_ADDRESS maybe defined ? {code:java} peer01.citi1.cit.lsnet: container_name: peer01.citi1.cit.lsnet extends: file: peer-base/peer-base.yaml ... ... service: peer-base{code}    ~snehas  can you provide all referred artefacts please ?  ></body> </Action>
<Action id="34503" issue="23871" author="yacovm" type="comment" created="2017-11-09 14:39:50.0" updateauthor="yacovm" updated="2017-11-09 14:39:50.0"> <body><! CDATA I saw that, but my guess is that this is the culprit and they didn't.  In our peer base we only have a common configuration for all peers so it's unlikely that it would be defined there. Of course - I could be wrong ;)   ></body> </Action>
<Action id="34505" issue="23871" author="muralisr" type="comment" created="2017-11-09 14:53:26.0" updateauthor="muralisr" updated="2017-11-09 17:46:25.0"> <body><! CDATA  ~yacovm  good point....  comparing e2e_cli   {code:java} peer0.org1.example.com: container_name: peer0.org1.example.com extends: file:  base/docker-compose-base.yaml service: peer0.org1.example.com {code}  with   {code:java} peer01.citi1.cit.lsnet: container_name: peer01.citi1.cit.lsnet extends: file: peer-base/peer-base.yaml ... ... service: peer-base {code}  docker-compose-base.yaml COULD have been replaced with peer-base.yaml without updating peer-base with all the vars from docker-compose-base.yaml.  All the more reason to get all the artifacts.  ></body> </Action>
<Action id="34520" issue="23871" author="mastersingh24" type="comment" body="Definitely missing `CORE_PEER_ADDRESS` for each peer as  ~yacovm  stated above.  I&apos;ve seen this issue a couple of times recently." created="2017-11-09 17:28:10.0" updateauthor="mastersingh24" updated="2017-11-09 17:28:10.0"/>
<Action id="34532" issue="23871" author="snehas" type="comment" created="2017-11-10 10:17:22.0" updateauthor="snehas" updated="2017-11-10 11:12:28.0"> <body><! CDATA Thanks for your inputs ! I modified docker-compose file to set CORE_PEER_ADDRESS of peer containers and previous error i.e. "cannot validate certificate" got resolved. However now I am getting below error in chaincode container logs.  2017-11-09 16:14:10.419 UTC  bccsp  initBCCSP -> DEBU 001 Initialize BCCSP  SW  2017-11-09 16:14:10.455 UTC  grpc  Printf -> DEBU 002 grpc: addrConn.resetTransport failed to create client transport: connection error: desc = "transport: Error while dialing dial tcp: lookup peer01.lsbgb65.cit.lsnet on 10.44.224.198:53: no such host"; Reconnecting to \{peer01.lsbgb65.cit.lsnet:7051 <nil>} 2017-11-09 16:14:11.421 UTC  grpc  Printf -> DEBU 003 grpc: addrConn.resetTransport failed to create client transport: connection error: desc = "transport: Error while dialing dial tcp: lookup peer01.lsbgb65.cit.lsnet on 10.44.224.198:53: no such host"; Reconnecting to \{peer01.lsbgb65.cit.lsnet:7051 <nil>} 2017-11-09 16:14:13.126 UTC  grpc  Printf -> DEBU 004 grpc: addrConn.resetTransport failed to create client transport: connection error: desc = "transport: Error while dialing dial tcp: lookup peer01.lsbgb65.cit.lsnet on 10.44.224.198:53: no such host"; Reconnecting to \{peer01.lsbgb65.cit.lsnet:7051 <nil>} 2017-11-09 16:14:13.419 UTC  shim  userChaincodeStreamGetter -> ERRO 005 Error trying to connect to local peer: context deadline exceeded 2017-11-09 16:14:13.419 UTC  Public/PublicCC  Errorf -> ERRO 006 Error starting chaincode: Error trying to connect to local peer: context deadline exceeded  I tried adding dns_search: . as a config value for the peer. But am still getting this error.     Attaching updated docker-compose and peer-base file for reference.    Peer containers on docker:-  CONTAINER ID        IMAGE                                  COMMAND                  CREATED             STATUS              PORTS                                                                       NAMES  3e43405ba24e        ibmblockchain/fabric-peer:1.0.3        "/docker-entrypoin..."   2 minutes ago       Up 2 minutes        0.0.0.0:9051->7051/tcp, 0.0.0.0:9053->7053/tcp                              peer01.deutbnk1.cit.lsnet  b8dc30ad933c        ibmblockchain/fabric-peer:1.0.3        "/docker-entrypoin..."   2 minutes ago       Up 2 minutes        0.0.0.0:11051->7051/tcp, 0.0.0.0:11053->7053/tcp                            peer02.lsbgb65.cit.lsnet  3ce749622098        ibmblockchain/fabric-peer:1.0.3        "/docker-entrypoin..."   2 minutes ago       Up 2 minutes        0.0.0.0:10051->7051/tcp, 0.0.0.0:10053->7053/tcp                            peer01.lsbgb65.cit.lsnet  431656288b9f        ibmblockchain/fabric-peer:1.0.3        "/docker-entrypoin..."   2 minutes ago       Up 2 minutes        0.0.0.0:7051->7051/tcp, 0.0.0.0:7053->7053/tcp                              peer01.citibnk1.cit.lsnet  3c29d29270b3        ibmblockchain/fabric-peer:1.0.3        "/docker-entrypoin..."   2 minutes ago       Up 2 minutes        0.0.0.0:8051->7051/tcp, 0.0.0.0:8053->7053/tcp                              peer01.goldsac1.cit.lsnet  1247c0cfff26        ibmblockchain/fabric-orderer:1.0.3     "/docker-entrypoin..."   2 minutes ago       Up 2 minutes        0.0.0.0:6050->7050/tcp                                                      ord01.lsorder.cit.lsnet  9a985fe9c060        ibmblockchain/fabric-tools:1.0.3       "/bin/bash -c 'sle..."   2 minutes ago       Up 2 minutes            Command to instantiate chaincode  CORE_PEER_TLS_ROOTCERT_FILE=/lsops_artefacts/organizations/lsbldn_lsbgb65/peers/01.peer01.lsbgb65.cit.lsnet/msp/tlsintermediatecerts/tls.ca01.cit.lsnet.pem  CORE_PEER_MSPCONFIGPATH=/lsops_artefacts/organizations/lsbldn_lsbgb65/users/01.admin01.lsbgb65.cit.lsnet/msp   CORE_PEER_ADDRESS=peer01.lsbgb65.cit.lsnet:7051 CORE_PEER_LOCALMSPID=lsbgb65 peer chaincode instantiate -o ord01.lsorder.cit.lsnet:7050 --tls true --cafile /lsops_artefacts/organizations/lsbldn_lsorder/orderers/01.ord01.lsorder.cit.lsnet/msp/tlsintermediatecerts/tls.ca01.cit.lsnet.pem -C public -n public -v 1.0.0 -c '\{"Args": "init","60" }'     Please provide your inputs.  ></body> </Action>
<Action id="34535" issue="23871" author="mastersingh24" type="comment" created="2017-11-10 13:01:24.0" updateauthor="mastersingh24" updated="2017-11-10 13:01:58.0"> <body><! CDATA You need to set *CORE_VM_DOCKER_HOSTCONFIG_NETWORKMODE* in *peer-base.yaml* It needs to be set to the Docker network being used by Compose which will typically be the name of the folder where *docker-compose.yaml* resides plus *_default*  ></body> </Action>
<Action id="34536" issue="23871" author="yacovm" type="comment" created="2017-11-10 13:11:07.0" updateauthor="yacovm" updated="2017-11-10 13:16:31.0"> <body><! CDATA Looks like they have it commented out:   {code} #- CORE_VM_DOCKER_HOSTCONFIG_NETWORKMODE=e2ecliv1opskafka_default {code}  ></body> </Action>
<Action id="34572" issue="23871" author="muralisr" type="comment" body=" ~snehas  any update on this based on comments above ? Seems like a few env setup issues. Please make sure the env variables are correctly set (examples/e2e_cli/docker-compose-e2e.yaml provides a good template)." created="2017-11-12 19:20:57.0" updateauthor="muralisr" updated="2017-11-12 19:20:57.0"/>
<Action id="34585" issue="23871" author="snehas" type="comment" created="2017-11-13 11:55:10.0" updateauthor="snehas" updated="2017-11-13 11:55:10.0"> <body><! CDATA After adding CORE_VM_DOCKER_HOSTCONFIG_NETWORKMODE it worked.   ~mastersingh24   ~yacovm   ~muralisr  : Thanks a lot for your help.  We can close this issue.  ></body> </Action>
