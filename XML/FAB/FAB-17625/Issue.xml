<Issue id="44585" key="FAB-17625" number="17625" project="10002" reporter="jarvis26" creator="jarvis26" type="10004" summary="approvemyorg command in chaincode lifecycle is failing in v2.0 hlf network deployment." priority="1" resolution="10204" status="6" created="2020-03-16 07:21:54.0" updated="2020-03-19 04:00:50.0" resolutiondate="2020-03-19 04:00:50.0" votes="1" watches="3" workflowId="58498" archived="N"> <description><! CDATA I have a distributed hlf network deployment - not running on first-network base. Deployment topology is 1 org, 1 peer with 3 RAFT consenter nodes for Ordering Service. Certificates are generated by Fabric-CA for the peer organization and the Ordering Service Organization. The network is mutual TLS enabled.  Peer and orderer versions: 2.0.0 golang version: go1.13.5 linux/amd64  Following are the set of commands executed to check chaincode life-cycle and the errors occurred.  export CORE_PEER_MSPCONFIGPATH=/var/hyperledger/admin/msp  *Create Channel:* peer channel create -o orderer:7050 -c channel2 -f channel2.tx --tls --clientauth --certfile <path to certfile> --keyfile <path to keyfile> --cafile <path to orderer ca file> --timeout 500s --connTimeout 50s  *Join Channel:* peer channel join -b channel2.block  *Package Chaincode:* peer lifecycle chaincode package testchaincode.tar.gz --path /opt/gopath/src/github.com/hyperledger/fabric-samples/chaincode/abstore/go/ --lang golang --label chaincode  *Install Chaincode:* peer lifecycle chaincode install testchaincode.tar.gz --tls --clientauth --certfile <path to certfile> --keyfile <path to keyfile>  *Query installed chaincode:* peer lifecycle chaincode queryinstalled  This returns the chaincode package Id.  *Approve Chaincode:* peer lifecycle chaincode approveformyorg -o orderer:7050 --tls --clientauth --certfile <path to certfile> --keyfile <path to keyfile> --cafile <path to orderer ca file> --channelID channel2 --name testchaincode --version 1.0 --init-required --package-id chaincode:786d2eda61346963c45cea62a9d3dd36b054741d51e45ef3b07f769e00acbb20 --sequence 1 --signature-policy "OR ('Org1MSP.peer')" --waitForEvent  This resulted in an error:  2020-03-04 09:12:40.996 UTC  chaincodeCmd  ClientWait -> INFO 001 txid  1fea03cbcecb0a26618871297128d87ef80f8177fb22ba6e10ea46dbfb986e8d  committed with status (ENDORSEMENT_POLICY_FAILURE) at Error: transaction invalidated with status (ENDORSEMENT_POLICY_FAILURE)  As a workaround, I restarted the network with a new genesis block generated after commenting out the {{Endorsement}} and the {{LifecycleEndorsement}} default policies in configtx.yaml.  All the above commands succeeded as expected, except the {{approveformyorg}} command. This threw the following error: Error at the Peer: CLI: Error: timed out waiting for txid on all peers Modified the {{approveformyorg}} with {{--waitForEventTimeout}} flag and set it to 600s  peer lifecycle chaincode approveformyorg -o orderer:7050 --tls --clientauth --certfile <path to certfile> --keyfile <path to keyfile> --cafile <path to orderer ca file> --channelID channel2 --name chaincode --version 1.0 --init-required --package-id chaincode:786d2eda61346963c45cea62a9d3dd36b054741d51e45ef3b07f769e00acbb20 --sequence 1 --signature-policy "OR ('Org1MSP.member')" --waitForEventTimeout 600s  The orderer does not report any error, however the peer logs and command line show the following: Error: Error: error receiving from deliver filtered at test-machine:7051: rpc error: code = Unavailable desc = transport is closing  *Peer logs:* ApproveChaincodeDefinitionForOrg -> INFO 07d^  0m Successfully endorsed chaincode approval with name 'testchaincode', package ID 'chaincode:786d2eda61346963c45cea62a9d3dd36b054741d51e45ef3b07f769e00acbb20', on channel 'testchannel' with definition {sequence: 1, endorsement info: (version: '1.0', plugin: 'escc', init required: true), validation info: (plugin: 'vscc', policy: '0a17120812060801120208001a0b12090a074f7267314d5350'), collections: ()} ^  34m2020-03-16 10:25:19.287 UTC  endorser  callChaincode -> INFO 07e^  0m finished chaincode: _lifecycle duration: 1ms channel=testchannel txID=3381d125 ^  34m2020-03-16 10:25:19.625 UTC  comm.grpc.server  1 -> INFO 07f^  0m unary call completed grpc.service=protos.Endorser grpc.method=ProcessProposal grpc.peer_address=127.0.0.1:59888 grpc.peer_subject="CN=peer,OU=peer+OU=org1,O=BIETC,ST=North Carolina,C=US" grpc.code=OK grpc.call_duration=340.668187ms  ^  33m2020-03-16 10:25:50.062 UTC  peer.blocksprovider  func1 -> WARN 080^  0m Encountered an error reading from deliver stream: EOF channel=testchannel orderer-address=test-machine-orderer:7050  ^  33m2020-03-16 10:25:50.062 UTC  peer.blocksprovider  DeliverBlocks -> WARN 081^  0m Got error while attempting to receive blocks: received bad status FORBIDDEN from orderer channel=testchannel orderer-address=test-machine-orderer:7050  *Following are the environment variables set at the peer:* export CORE_PEER_ID=peer0.org1 export CORE_PEER_ADDRESS=test-machine:7051 export CORE_PEER_LISTENADDRESS=test-machine:7051 export CORE_PEER_GOSSIP_EXTERNALENDPOINT=test-machine:7051 export CORE_PEER_CHAINCODEADDRESS=test-machine:7052 export CORE_PEER_CHAINCODELISTENADDRESS=test-machine:7052 export CORE_PEER_ENDORSER_ENABLED=true export CORE_PEER_LOCALMSPID=Org1MSP #export CORE_LEDGER_STATE_STATEDATABASE=CouchDB #export CORE_LEDGER_STATE_COUCHDBCONFIG_COUCHDBADDRESS=127.0.0.1:5984 export CORE_CHAINCODE_BUILDER=hyperledger/fabric-ccenv:amd64-2.0.0 export CORE_CHAINCODE_GOLANG=hyperledger/fabric-baseos:amd64-2.0.0 export CORE_PEER_MSPCONFIGPATH=/var/hyperledger/peer/msp export CORE_CHAINCODE_EXECUTETIMEOUT=300s export CORE_PEER_TLS_ENABLED=true export CORE_PEER_TLS_KEY_FILE=/var/hyperledger/peer/msp/keystore/d430515c3e1975b6578e3a0eefe50eba11d7bc4ecb9c855b442d538a7b00e49b_sk export CORE_PEER_TLS_CERT_FILE=/var/hyperledger/peer/msp/signcerts/cert.pem export CORE_PEER_TLS_ROOTCERT_FILE=/var/hyperledger/peer/msp/tlscacerts/tls-test-machine-7054.pem export CORE_PEER_TLS_CLIENTAUTHREQUIRED=true export CORE_PEER_TLS_CLIENTCERT_FILE=/var/hyperledger/peer/msp/signcerts/cert.pem export CORE_PEER_TLS_CLIENTKEY_FILE=/var/hyperledger/peer/msp/keystore/d430515c3e1975b6578e3a0eefe50eba11d7bc4ecb9c855b442d538a7b00e49b_sk export CORE_PEER_TLS_CLIENTROOTCAS_FILES=/var/hyperledger/peer/msp/tlscacerts/tls-test-machine-7054.pem export FABRIC_LOGGING_SPEC=INFO export FABRIC_CFG_PATH=/opt/gopath/src/github.com/hyperledger/fabric/sampleconfig     ></description> </Issue>
