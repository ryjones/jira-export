<Issue id="31750" key="FAB-11106" number="11106" project="10002" reporter="baohua" assignee="baohua" creator="baohua" type="10004" summary="Fix chaincode name checking" priority="3" resolution="10000" status="6" created="2018-07-10 02:33:37.0" updated="2018-07-20 14:17:10.0" resolutiondate="2018-07-20 09:59:54.0" votes="0" watches="1" workflowId="42665"> <description><! CDATA The existing checking of chaincode is a simple " A-Za-z0-9_- +".  However, using "_-" at the start/end will trigger problem.  Hence we need to fix the naming checking to disable the problematic cases.  Experimental results with e2e_cli:  *Chaincode Name**: -exp02*  Error: could not assemble transaction, err Proposal response was not successful, error code 500, msg failed to execute transaction d698c823ac724202c62791841981e2b1f8e16586dc2c10957c745e0f41d12fd6: error starting container: error starting container: Error constructing Docker VM Name. 'dev-peer0.org1.example.com--exp02-1.0-040e5bf65c5e3d1640909cb0ed5a51591f32a54e249644ee3a5b305209fd520e' breaks Docker's repository naming rules     *Chaincode Name: _exp02*  Error: could not assemble transaction, err Proposal response was not successful, error code 500, msg failed to execute transaction adde86a63d1571a57ea363235bc2c1964a3db1888c23d08c826c04c410fa2881: error starting container: error starting container: Error constructing Docker VM Name. 'dev-peer0.org1.example.com-_exp02-1.0-77fa43ec960f1ba05d9d7fe0175badf73ec5d0aeec095d595080389af5c5a0e8' breaks Docker's repository naming rules     *Chaincode Name:exp02_*  Error: could not assemble transaction, err Proposal response was not successful, error code 500, msg failed to execute transaction fac6bbb25bd0529b8d056420db173c3f246123c83c98f1e40280e41018ada42c: error starting container: error starting container: Error constructing Docker VM Name. 'dev-peer0.org1.example.com-exp02_-1.0-21b747784befe7787dd71568e19d1603ed4cf15c045c482c20d975525c3e53fa' breaks Docker's repository naming rules     *Chaincode Name: exp02-*  fatal error: unexpected signal during runtime execution  signal SIGSEGV: segmentation violation code=0x1 addr=0xe5 pc=0x7f4fe49477f8   runtime stack: runtime.throw(0x106be8c, 0x2a) /usr/local/go/src/runtime/cgocall.go:128 +0x64 fp=0xc420434a50 sp=0xc420434a18 pc=0x402314 os/user._Cfunc_mygetpwuid_r(0x3e8, 0xc42019eb40, 0x7f4fdc000c80, 0x400, 0xc42000e008, 0x0) _cgo_gotypes.go:170 +0x4d fp=0xc420434a98 sp=0xc420434a50 pc=0x8ed0dd os/user.lookupUnixUid.func1.1(0x7f4f000003e8, 0xc42019eb40, 0x7f4fdc000c80, 0x400, 0xc42000e008, 0xc420434b28) /usr/local/go/src/os/user/cgo_lookup_unix.go:100 +0x13f fp=0xc420434ad8 sp=0xc420434a98 pc=0x8eecbf os/user.lookupUnixUid.func1(0x10) /usr/local/go/src/os/user/cgo_lookup_unix.go:100 +0x50 fp=0xc420434b18 sp=0xc420434ad8 pc=0x8eed60 os/user.retryWithBuffer(0xc4203d6000, 0xc420434c08, 0xc4203d6000, 0xf9b000) /usr/local/go/src/os/user/cgo_lookup_unix.go:253 +0x3b fp=0xc420434b78 sp=0xc420434b18 pc=0x8ee18b os/user.lookupUnixUid(0x3e8, 0x0, 0x0, 0x0) /usr/local/go/src/os/user/cgo_lookup_unix.go:96 +0x130 fp=0xc420434c40 sp=0xc420434b78 pc=0x8ed610 os/user.lookupUserId(0xc4206e61a0, 0x4, 0x0, 0x482444, 0x3e8) /usr/local/go/src/os/user/cgo_lookup_unix.go:86 +0x73 fp=0xc420434c78 sp=0xc420434c40 pc=0x8ed4a3 os/user.LookupId(0xc4206e61a0, 0x4, 0x4, 0x0, 0x0) /usr/local/go/src/os/user/lookup.go:41 +0x51 fp=0xc420434cc8 sp=0xc420434c78 pc=0x8ecaa1 archive/tar.statUnix(0x11324a0, 0xc4206da820, 0xc420499260, 0x1960280, 0x106) /usr/local/go/src/archive/tar/stat_unix.go:39 +0x4c1 fp=0xc420434d48 sp=0xc420434cc8 pc=0x8f87d1 archive/tar.FileInfoHeader(0x11324a0, 0xc4206da820, 0xc420698d70, 0x48, 0x0, 0x0, 0x7f4fe651cd80) /usr/local/go/src/archive/tar/common.go:699 +0x491 fp=0xc420434ec8 sp=0xc420434d48 pc=0x8f1ca1 github.com/hyperledger/fabric/core/container/util.WriteStreamToPackage(0x1116840, 0xc4206b5200, 0xc420698d70, 0x48, 0xc420698d74, 0x44, 0xc420651500, 0xc420435158, 0x4112ad) /go/src/github.com/hyperledger/fabric/core/container/util/writer.go:180 +0x18b fp=0xc420435080 sp=0xc420434ec8 pc=0x9862cb github.com/hyperledger/fabric/core/container/util.WriteFileToPackage(0xc420698d70, 0x48, 0xc420698d74, 0x44, 0xc420651500, 0x0, 0x0) /go/src/github.com/hyperledger/fabric/core/container/util/writer.go:170 +0x3aa fp=0xc420435198 sp=0xc420435080 pc=0x98609a github.com/hyperledger/fabric/core/chaincode/platforms/golang.(*Platform).GetDeploymentPayload(0x1984938, 0xc4206ba560, 0x0, 0x0, 0x0, 0x0, 0x0) /go/src/github.com/hyperledger/fabric/core/chaincode/platforms/golang/platform.go:467 +0x1331 fp=0xc4204359a8 sp=0xc420435198 pc=0x98dd81 github.com/hyperledger/fabric/core/chaincode/platforms.GetDeploymentPayload(0xc4206ba560, 0xc4206ba560, 0x0, 0x0, 0x0, 0xc420555550) /go/src/github.com/hyperledger/fabric/core/chaincode/platforms/platforms.go:80 +0x89 fp=0xc4204359f0 sp=0xc4204359a8 pc=0x992d29 github.com/hyperledger/fabric/core/container.GetChaincodePackageBytes(0xc4206ba560, 0x0, 0x0, 0xc4206b64e0, 0xc42066d870, 0x6) /go/src/github.com/hyperledger/fabric/core/container/controller.go:203 +0x96 fp=0xc420435a38 sp=0xc4204359f0 pc=0xc2e7f6 github.com/hyperledger/fabric/peer/chaincode.getChaincodeDeploymentSpec(0xc4206ba560, 0xc4206ba501, 0x0, 0x0, 0x0) /go/src/github.com/hyperledger/fabric/peer/chaincode/common.go:64 +0x112 fp=0xc420435aa0 sp=0xc420435a38 pc=0xc4abb2 github.com/hyperledger/fabric/peer/chaincode.genChaincodeDeploymentSpec(0xc420103200, 0x7ffd31c9571b, 0x6, 0x7ffd31c95725, 0x3, 0x0, 0x1, 0xc420435c70) /go/src/github.com/hyperledger/fabric/peer/chaincode/install.go:104 +0xab fp=0xc420435b68 sp=0xc420435aa0 pc=0xc51e3b github.com/hyperledger/fabric/peer/chaincode.chaincodeInstall(0xc420103200, 0x0, 0x0, 0xc42056b340, 0x0, 0x0) /go/src/github.com/hyperledger/fabric/peer/chaincode/install.go:172 +0x15c fp=0xc420435c58 sp=0xc420435b68 pc=0xc525bc github.com/hyperledger/fabric/peer/chaincode.installCmd.func1(0xc420103200, 0xc420495500, 0x0, 0x6, 0x0, 0x0) /go/src/github.com/hyperledger/fabric/peer/chaincode/install.go:44 +0x /go/src/github.com/hyperledger/fabric/vendor/google.golang.org/grpc/resolver_conn_wrapper.go:109 +0x182 created by github.com/hyperledger/fabric/vendor/google.golang.org/grpc.(*ccResolverWrapper).start /go/src/github.com/hyperledger/fabric/vendor/google.golang.org/grpc/resolver_conn_wrapper.go:95 +0x3f  goroutine 7  select : github.com/hyperledger/fabric/vendor/google.golang.org/grpc.(*ccBalancerWrapper).watcher(0xc420087d80) /go/src/github.com/hyperledger/fabric/vendor/google.golang.org/grpc/balancer_conn_wrappers.go:122 +0x14a created by github.com/hyperledger/fabric/vendor/google.golang.org/grpc.newCCBalancerWrapper /go/src/github.com/hyperledger/fabric/vendor/google.golang.org/grpc/balancer_conn_wrappers.go:113 +0x14c  goroutine 8  select : github.com/hyperledger/fabric/vendor/google.golang.org/grpc.(*addrConn).transportMonitor(0xc4204e6b40) /go/src/github.com/hyperledger/fabric/vendor/google.golang.org/grpc/clientconn.go:1243 +0x235 github.com/hyperledger/fabric/vendor/google.golang.org/grpc.(*addrConn).connect.func1(0xc4204e6b40) /go/src/github.com/hyperledger/fabric/vendor/google.golang.org/grpc/clientconn.go:854 +0x1b5 created by github.com/hyperledger/fabric/vendor/google.golang.org/grpc.(*addrConn).connect /go/src/github.com/hyperledger/fabric/vendor/google.golang.org/grpc/clientconn.go:845 +0xe1  goroutine 14  IO wait : internal/poll.runtime_pollWait(0x7f4fe651cff0, 0x72, 0xc420066970) /usr/local/go/src/runtime/netpoll.go:173 +0x57 internal/poll.(*pollDesc).wait(0xc4204f6818, 0x72, 0xffffffffffffff00, 0x111a740, 0x1899400) /usr/local/go/src/internal/poll/fd_poll_runtime.go:85 +0x9b internal/poll.(*pollDesc).waitRead(0xc4204f6818, 0xc4204d8c00, 0x400, 0x400) /usr/local/go/src/internal/poll/fd_poll_runtime.go:90 +0x3d internal/poll.(*FD).Read(0xc4204f6800, 0xc4204d8c00, 0x400, 0x400, 0x0, 0x0, 0x0) /usr/local/go/src/internal/poll/fd_unix.go:157 +0x17d net.(*netFD).Read(0xc4204f6800, 0xc4204d8c00, 0x400, 0x400, 0x8, 0x8, 0x3f3) /usr/local/go/src/net/fd_unix.go:202 +0x4f net.(*conn).Read(0xc4200ba7a8, 0xc4204d8c00, 0x400, 0x400, 0x0, 0x0, 0x0) /usr/local/go/src/net/net.go:176 +0x6a crypto/tls.(*block).readFromUntil(0xc42064e150, 0x7f4fe5364838, 0xc4200ba7a8, 0x5, 0xc4200ba7a8, 0x0) /usr/local/go/src/crypto/tls/conn.go:493 +0x96 crypto/tls.(*Conn).readRecord(0xc420650000, 0x1097417, 0xc420650120, 0x0) /usr/local/go/src/crypto/tls/conn.go:595 +0xe0 crypto/tls.(*Conn).Read(0xc420650000, 0xc42065c000, 0x8000, 0x8000, 0x0, 0x0, 0x0) /usr/l goroutine 15  select : github.com/hyperledger/fabric/vendor/google.golang.org/grpc/transport.loopyWriter(0x112f3e0, 0xc420087e40, 0xc42064e7b0, 0xc420635fb8) /go/src/github.com/hyperledger/fabric/vendor/google.golang.org/grpc/transport/transport.go:741 +0x368 github.com/hyperledger/fabric/vendor/google.golang.org/grpc/transport.newHTTP2Client.func3(0xc420001b00) /go/src/github.com/hyperledger/fabric/vendor/google.golang.org/grpc/transport/http2_client.go:290 +0x5e created by github.com/hyperledger/fabric/vendor/google.golang.org/grpc/transport.newHTTP2Client /go/src/github.com/hyperledger/fabric/vendor/google.golang.org/grpc/transport/http2_client.go:289 +0xd42  goroutine 16  select : github.com/hyperledger/fabric/vendor/google.golang.org/grpc/transport.(*http2Client).keepalive(0xc420001b00) /go/src/github.com/hyperledger/fabric/vendor/google.golang.org/grpc/transport/http2_client.go:1330 +0x137 created by github.com/hyperledger/fabric/vendor/google.golang.org/grpc/transport.newHTTP2Client /go/src/github.com/hyperledger/fabric/vendor/google.golang.org/grpc/transport/http2_client.go:294 +0xdb5  goroutine 34  select : github.com/hyperledger/fabric/vendor/google.golang.org/grpc.(*ccResolverWrapper).watcher(0xc42064f080) /go/src/github.com/hyperledger/fabric/vendor/google.golang.org/grpc/resolver_conn_wrapper.go:109 +0x182 created by github.com/hyperledger/fabric/vendor/google.golang.org/grpc.(*ccResolverWrapper).start /go/src/github.com/hyperledger/fabric/vendor/google.golang.org/grpc/resolver_conn_wrapper.go:95 +0x3f  goroutine 35  select : github.com/hyperledger/fabric/vendor/google.golang.org/grpc.(*ccBalancerWrapper).watcher(0xc4206523c0) /go/src/github.com/hyperledger/fabric/vendor/google.golang.org/grpc/balancer_conn_wrappers.go:122 +0x14a created by github.com/hyperledger/fabric/vendor/google.golang.org/grpc.newCCBalancerWrapper /go/src/github.com/hyperledger/fabric/vendor/google.golang.org/grpc/balancer_conn_wrappers.go:113 +0x14c  goroutine 36  select : github.com/hyperledger/fabric/vendor/google.golang.org/grpc.(*addrConn).transportMonitor(0xc4204e7b00) /go/src/github.com/hyperledger/fabric/vendor/google.golang.org/grpc/clientconn.go:1243 +0x235 github.com/hyperledger/fabric/vendor/google.golang.org/grpc.(*addrConn).connect.func1(0xc4204e7b00) /go/src/github.com/hyperledger/fabric/vendor/google.golang.org/grpc/clientconn.go:854 +0x1b5 created by github.com/hyperledger/fabric/vendor/google.golang.org/grpc.(*addrConn).connect /go/src/github.com/hyperledger/fabric/vendor/google.golang.org/grpc/clientconn.go:845 +0xe1  goroutine 41  IO wait : internal/poll.runtime_pollWait(0x7f4fe651cf20, 0x72, 0xc42006d970) /usr/local/go/src/runtime/netpoll.go:173 +0 crypto/tls.(*block).readFromUntil(0xc42064f500, 0x7f4fe5364838, 0xc4200ba840, 0x5, 0xc4200ba840, 0x0) /usr/local/go/src/crypto/tls/conn.go:493 +0x96 crypto/tls.(*Conn).readRecord(0xc420650380, 0x1097417, 0xc4206504a0, 0x0) /usr/local/go/src/crypto/tls/conn.go:595 +0xe0 crypto/tls.(*Conn).Read(0xc420650380, 0xc42069c000, 0x8000, 0x8000, 0x0, 0x0, 0x0) /usr/local/go/src/crypto/tls/conn.go:1156 +0x100 bufio.(*Reader).Read(0xc42069a000, 0xc420498f18, 0x9, 0x9, 0x30, 0x28, 0xf83d40) /usr/local/go/src/bufio/bufio.go:216 +0x238 io.ReadAtLeast(0x1116840, 0xc42069a000, 0xc420498f18, 0x9, 0x9, 0x9, 0xc42006ddf0, 0x400ece, 0xc42006de9f) /usr/local/go/src/io/io.go:309 +0x86 io.ReadFull(0x1116840, 0xc42069a000, 0xc420498f18, 0x9, 0x9, 0x85e574, 0xc4206403f0, 0xc420640004) /usr/local/go/src/io/io.go:327 +0x58 github.com/hyperledger/fabric/vendor/golang.org/x/net/http2.readFrameHeader(0xc420498f18, 0x9, 0x9, 0x1116840, 0xc42069a000, 0x0, 0x0, 0xc4206403f0, 0x0) /go/src/github.com/hyperledger/fabric/vendor/golang.org/x/net/http2/frame.go:237 +0x7b github.com/hyperledger/fabric/vendor/golang.org/x/net/http2.(*Framer).ReadFrame(0xc420498ee0, 0xc4206403f0, 0xc420640300, 0x0, 0x0) /go/src/github.com/hyperledger/fabric/vendor/golang.org/x/net/http2/frame.go:492 +0xa4 github.com/hyperledger/fabric/vendor/google.golang.org/grpc/transport.(*http2Client).reader(0xc42067cd80) /go/src/github.com/hyperledger/fabric/vendor/google.golang.org/grpc/transport/http2_client.go:1180 +0xe1 created by github.com/hyperledger/fabric/vendor/google.golang.org/grpc/transport.newHTTP2Client /go/src/github.com/hyperledger/fabric/vendor/google.golang.org/grpc/transport/http2_client.go:258 +0xbf1  goroutine 42  select : github.com/hyperledger/fabric/vendor/google.golang.org/grpc/transport.loopyWriter(0x112f3e0, 0xc420652480, 0xc42064fb90, 0xc42006bfb8) /go/src/github.com/hyperledger/fabric/vendor/google.golang.org/grpc/transport/transport.go:741 +0x368 github.com/hyperledger/fabric/vendor/google.golang.org/grpc/transport.newHTTP2Client.func3(0xc42067cd80) /go/src/github.com/hyperledger/fabric/vendor/google.golang.org/grpc/transport/http2_client.go:290 +0x5e created by github.com/hyperledger/fabric/vendor/google.golang.org/grpc/transport.newHTTP2Client /go/src/github.com/hyperledger/fabric/vendor/google.golang.org/grpc/transport/http2_client.go:289 +0xd42  goroutine 43  select : github.com/hyperledger/fabric/vendor/google.golang.org/grpc/transport.(*http2Client).keepalive(0xc42067cd80) /go/src/github.com/hyperledger/fabric/vendor/google.golang.org/grpc/transport/http2_client.go:1330 +0x137 created by github.com/hyperledger/fabric/vendor/google.golang.org/grpc/transport.newHTTP2Client /go/src/github.com/hyperledger/fabric/vendor/google.golang.org/grpc/transport/http2_client.go:294 +0xdb5 Chaincode installation on remote org 2/peer0 has Failed     *Chaincode Name: exp__02*  Error: could not assemble transaction, err Proposal response was not successful, error code 500, msg failed to execute transaction a7d12f663312a15dbd705a99370df60ca0fc5e7ab650c5a3cdcd14b51f9fa831: error starting container: error starting container: Error constructing Docker VM Name. 'dev-peer0.org1.example.com-exp__02-1.0-c2ce1346e2bb24e9b1f72a9929e288c4e7b23a2f8e355681e0babf3082aead68' breaks Docker's repository naming rules ChaincodeInstantiation on org 1/peer0 in channel businesschannel failed      *Chaincode Name: exp__02*  Error: could not assemble transaction, err Proposal response was not successful, error code 500, msg failed to execute transaction a97586089a3f0b15610959f526bf16ee89174cedfee7d26e4e45fc7c9177a8bd: error starting container: error starting container: Error constructing Docker VM Name. 'dev-peer0.org1.example.com-exp_-02-1.0-ff380c749f877c48069d76ba62a4ad9a49d6bd2344be5878950fac4ae9d6f97f' breaks Docker's repository naming rules ChaincodeInstantiation on org 1/peer0 in channel businesschannel failed     *Chaincode Name: exp_-02*  Error: could not assemble transaction, err Proposal response was not successful, error code 500, msg failed to execute transaction a97586089a3f0b15610959f526bf16ee89174cedfee7d26e4e45fc7c9177a8bd: error starting container: error starting container: Error constructing Docker VM Name. 'dev-peer0.org1.example.com-exp_-02-1.0-ff380c749f877c48069d76ba62a4ad9a49d6bd2344be5878950fac4ae9d6f97f' breaks Docker's repository naming rules ChaincodeInstantiation on org 1/peer0 in channel businesschannel failed  ></description> </Issue>
