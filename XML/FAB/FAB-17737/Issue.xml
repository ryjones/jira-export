<Issue id="44791" key="FAB-17737" number="17737" project="10002" reporter="senthil1" assignee="senthil1" creator="senthil1" type="10004" summary="test flake in TestHandleChaincodeDeployErroneousIndexFile" priority="3" resolution="10000" status="6" created="2020-04-13 02:32:59.0" updated="2020-04-13 13:49:24.0" resolutiondate="2020-04-13 13:49:24.0" votes="0" watches="2" workflowId="58710" archived="N"> <description><! CDATA As per CI statistics, this task has failed 152 times across 173 pipeline runs in the last 14 days.   The potential reason for this error is that the CouchDB creates an index in the background and responds to the REST API immediately. Currently, we wait only for 100 milliseconds to allow CouchDB to build the index. This fails even in the local laptop test. We can try to increase the time to 2 seconds and allow ample time for CouchDB to build the index.   {code:java} --- FAIL: TestHandleChaincodeDeployErroneousIndexFile (0.47s) statecouchdb_test.go:39: Initializing TestVDBEnv statecouchdb_test.go:741: Error Trace: statecouchdb_test.go:741 Error: Received unexpected error: error handling CouchDB request. Error:no_usable_index, Status Code:400, Reason:No index exists for this sort, try indexing by the sort fields. github.com/hyperledger/fabric/core/ledger/kvledger/txmgmt/statedb/statecouchdb.(*couchInstance).handleRequest /Users/senthil/go/src/github.com/hyperledger/fabric/core/ledger/kvledger/txmgmt/statedb/statecouchdb/couchdb.go:1880 github.com/hyperledger/fabric/core/ledger/kvledger/txmgmt/statedb/statecouchdb.(*couchDatabase).handleRequest /Users/senthil/go/src/github.com/hyperledger/fabric/core/ledger/kvledger/txmgmt/statedb/statecouchdb/couchdb.go:1689 github.com/hyperledger/fabric/core/ledger/kvledger/txmgmt/statedb/statecouchdb.(*couchDatabase).queryDocuments /Users/senthil/go/src/github.com/hyperledger/fabric/core/ledger/kvledger/txmgmt/statedb/statecouchdb/couchdb.go:1094 github.com/hyperledger/fabric/core/ledger/kvledger/txmgmt/statedb/statecouchdb.(*queryScanner).executeQueryWithBookmark /Users/senthil/go/src/github.com/hyperledger/fabric/core/ledger/kvledger/txmgmt/statedb/statecouchdb/statecouchdb.go:591 github.com/hyperledger/fabric/core/ledger/kvledger/txmgmt/statedb/statecouchdb.newQueryScanner /Users/senthil/go/src/github.com/hyperledger/fabric/core/ledger/kvledger/txmgmt/statedb/statecouchdb/statecouchdb.go:881 github.com/hyperledger/fabric/core/ledger/kvledger/txmgmt/statedb/statecouchdb.(*VersionedDB).ExecuteQueryWithMetadata /Users/senthil/go/src/github.com/hyperledger/fabric/core/ledger/kvledger/txmgmt/statedb/statecouchdb/statecouchdb.go:573 github.com/hyperledger/fabric/core/ledger/kvledger/txmgmt/statedb/statecouchdb.(*VersionedDB).ExecuteQuery /Users/senthil/go/src/github.com/hyperledger/fabric/core/ledger/kvledger/txmgmt/statedb/statecouchdb/statecouchdb.go:537 github.com/hyperledger/fabric/core/ledger/kvledger/txmgmt/statedb/statecouchdb.TestHandleChaincodeDeployErroneousIndexFile /Users/senthil/go/src/github.com/hyperledger/fabric/core/ledger/kvledger/txmgmt/statedb/statecouchdb/statecouchdb_test.go:740 testing.tRunner /usr/local/go/src/testing/testing.go:992 runtime.goexit /usr/local/go/src/runtime/asm_amd64.s:1373 Test: TestHandleChaincodeDeployErroneousIndexFile statecouchdb_test.go:89: Cleaningup TestVDBEnv  {code}   ></description> </Issue>
