<Issue id="37899" key="FAB-14300" number="14300" project="10002" reporter="suryalnvs" assignee="yacovm" creator="suryalnvs" type="10004" summary="Onboarding orderer halts after restart" priority="3" resolution="10000" status="6" created="2019-02-21 23:09:19.0" updated="2019-03-04 12:11:00.0" resolutiondate="2019-02-22 16:03:10.0" votes="0" watches="4" workflowId="49516"> <description><! CDATA Observed:  During testcase FAB-14046, after restarting orderer4:  Orderer4 did not complete the onboarding process; it got stuck trying to pull the next block from other orderers on testorgschannel1. {quote}{{2019-02-21 22:31:22.960 UTC  orderer.common.cluster.replication  fetchLastBlockSeq -> INFO 056 0m Skipping pulling from orderer1st-ordererorg:7050: minimum requested sequence is 3055 but orderer1st-ordererorg:7050 is at sequence 3054}} {quote} Remember, it had already completed pulling all the 3054 blocks for channel1 andÂ was in the middle of pulling blocks for channel2 when it was restarted.  Remember, traffic had stopped before the onboarding started, and thereforeÂ no new blocks were added to channel1 since before orderer4 was restarted.  It appears orderer4 mistakenly halts itself until it can retrieve at leastÂ one more NEW block for channel1 from one of the other orderers before it can proceed.  To test this theory, with the orderer4 stuck in this state, repeatedly printingÂ logs indicating it could not pull a block for channel1 from other orderers,Â we broadcasted one more transaction to channel1,Â and a block was committed on the other 3 orderers,Â and orderer4 immediately pulled it and completed with channel1, and then resumed pulling blocks from where itÂ had left off for channel2, block 385, and completed onboarding. {quote}2019-02-21 22:53:31.573 UTC  orderer.common.cluster.replication  pullBlocks -> INFO 9ac 0m Got block 3055 of size 15KB from orderer1st-ordererorg:7050  2019-02-21 22:53:31.607 UTC  orderer.common.cluster  appendBlock -> INFO 9ae 0m Committed block 3055 for channel testorgschannel1 2019-02-21 22:53:31.607 UTC  orderer.common.cluster  PullChannel -> INFO 9af 0m Pulling channel testorgschannel2  2019-02-21 22:53:31.630 UTC  orderer.common.cluster.replication  obtainStream -> INFO 9bd 0m Sending request for block 385 to orderer1st-ordererorg:7050 {quote} Therefore, we believe that the onboarding would complete successfullyÂ with no problems if we repeat the test with traffic running the entire time.  FYI: We restarted orderer4 again before it finished, and the same thing happened.  ></description> </Issue>
