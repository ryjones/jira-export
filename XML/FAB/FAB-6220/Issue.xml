<Issue id="20908" key="FAB-6220" number="6220" project="10002" reporter="davidkel" assignee="zhaochy" creator="davidkel" type="10004" summary="Unable to instantiate node.js chaincode" priority="1" resolution="10000" status="6" created="2017-09-19 15:24:54.0" updated="2018-07-20 14:14:26.0" resolutiondate="2017-09-27 20:46:06.0" votes="0" watches="1" workflowId="40049"> <description><! CDATA As part of the new capabilities coming in fabric, support exists for node.js chaincode. I am currently testing this capability and the base image that the node container uses in order to perform the npm install does not have python 2.7 installed (it does have python3 but this version of python cannot be used). When the docker container runs npm install to prepare the node.js chaincode, some npm modules require compilation using node-gyp which in turn uses python 2.7. An example of a failure is this {noformat} > grpc@1.6.0 install /chaincode/output/node_modules/grpc > node-pre-gyp install --fallback-to-build --library=static_library  node-pre-gyp ERR! Tried to download(undefined): https://storage.googleapis.com/grpc-precompiled-binaries/node/grpc/v1.6.0/node-v57-linux-x64.tar.gz node-pre-gyp ERR! Pre-built binaries not found for grpc@1.6.0 and node@8.4.0 (node-v57 ABI) (falling back to source compile with node-gyp) gyp ERR! configure error gyp ERR! stack Error: Can't find Python executable "python", you can set the PYTHON env variable. gyp ERR! stack at PythonFinder.failNoPython (/usr/local/lib/node_modules/npm/node_modules/node-gyp/lib/configure.js:483:19) gyp ERR! stack at PythonFinder.<anonymous> (/usr/local/lib/node_modules/npm/node_modules/node-gyp/lib/configure.js:397:16) gyp ERR! stack at F (/usr/local/lib/node_modules/npm/node_modules/which/which.js:68:16) gyp ERR! stack at E (/usr/local/lib/node_modules/npm/node_modules/which/which.js:80:29) gyp ERR! stack at /usr/local/lib/node_modules/npm/node_modules/which/which.js:89:16 gyp ERR! stack at /usr/local/lib/node_modules/npm/node_modules/which/node_modules/isexe/index.js:42:5 gyp ERR! stack at /usr/local/lib/node_modules/npm/node_modules/which/node_modules/isexe/mode.js:8:5 gyp ERR! stack at FSReqWrap.oncomplete (fs.js:152:21) gyp ERR! System Linux 3.13.0-129-generic gyp ERR! command "/usr/local/bin/node" "/usr/local/lib/node_modules/npm/node_modules/node-gyp/bin/node-gyp.js" "configure" "--fallback-to-build" "--library=static_library" "--module=/chaincode/output/node_modules/grpc/src/node/extension_binary/node-v57-linux-x64/grpc_node.node" "--module_name=grpc_node" "--module_path=/chaincode/output/node_modules/grpc/src/node/extension_binary/node-v57-linux-x64" gyp ERR! cwd /chaincode/output/node_modules/grpc gyp ERR! node -v v8.4.0 gyp ERR! node-gyp -v v3.6.2 gyp ERR! not ok node-pre-gyp ERR! build error node-pre-gyp ERR! stack Error: Failed to execute '/usr/local/bin/node /usr/local/lib/node_modules/npm/node_modules/node-gyp/bin/node-gyp.js configure --fallback-to-build --library=static_library --module=/chaincode/output/node_modules/grpc/src/node/extension_binary/node-v57-linux-x64/grpc_node.node --module_name=grpc_node --module_path=/chaincode/output/node_modules/grpc/src/node/extension_binary/node-v57-linux-x64' (1) node-pre-gyp ERR! stack at ChildProcess.<anonymous> (/chaincode/output/node_modules/grpc/node_modules/node-pre-gyp/lib/util/compile.js:83:29) node-pre-gyp ERR! stack at emitTwo (events.js:125:13) node-pre-gyp ERR! stack at ChildProcess.emit (events.js:213:7) node-pre-gyp ERR! stack at maybeClose (internal/child_process.js:927:16) node-pre-gyp ERR! stack at Process.ChildProcess._handle.onexit (internal/child_process.js:211:5) node-pre-gyp ERR! System Linux 3.13.0-129-generic node-pre-gyp ERR! command "/usr/local/bin/node" "/chaincode/output/node_modules/grpc/node_modules/.bin/node-pre-gyp" "install" "--fallback-to-build" "--library=static_library" node-pre-gyp ERR! cwd /chaincode/output/node_modules/grpc node-pre-gyp ERR! node -v v8.4.0 node-pre-gyp ERR! node-pre-gyp -v v0.6.36{noformat} Although interestingly it should have been able to pull down a pre-built package, the point is at this time it couldn't plus other native modules won't have prebuilt packages. Therefore it is critical that npm install can handle building native modules and that requires python2.7 to be installed and driven by the command `python`. Also basic linux compilation tools such as gcc and make also need to be available.  ></description> </Issue>
