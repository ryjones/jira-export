<Issue id="28866" key="FAB-9138" number="9138" project="10002" reporter="sykesm" creator="sykesm" type="10003" summary="Multiple data races when running TestCC2CC" priority="3" resolution="10002" status="6" created="2018-03-26 13:43:54.0" updated="2018-07-20 14:17:34.0" resolutiondate="2018-07-20 14:06:30.0" votes="0" watches="1" workflowId="43100"> <description><! CDATA {code:java} unit-tests_1  | ==================  unit-tests_1  | WARNING: DATA RACE  unit-tests_1  | Write at 0x00c42020c540 by goroutine 62:  unit-tests_1  |   github.com/hyperledger/fabric/core/chaincode/shim.TestStartInProc.func3()  unit-tests_1  |       /opt/gopath/src/github.com/hyperledger/fabric/core/chaincode/shim/shim_test.go:866 +0x155  unit-tests_1  |  unit-tests_1  | Previous write at 0x00c42020c540 by goroutine 66:  unit-tests_1  |   github.com/hyperledger/fabric/core/chaincode/shim.TestStartInProc.func2()  unit-tests_1  |       /opt/gopath/src/github.com/hyperledger/fabric/core/chaincode/shim/shim_test.go:861 +0x400  unit-tests_1  |  unit-tests_1  | Goroutine 62 (running) created at:  unit-tests_1  |   github.com/hyperledger/fabric/core/chaincode/shim.TestStartInProc()  unit-tests_1  |       /opt/gopath/src/github.com/hyperledger/fabric/core/chaincode/shim/shim_test.go:865 +0x25a  unit-tests_1  |   testing.tRunner()  unit-tests_1  |       /opt/go/src/testing/testing.go:746 +0x16c  unit-tests_1  |  unit-tests_1  | Goroutine 66 (finished) created at:  unit-tests_1  |   github.com/hyperledger/fabric/core/chaincode/shim.TestStartInProc()  unit-tests_1  |       /opt/gopath/src/github.com/hyperledger/fabric/core/chaincode/shim/shim_test.go:856 +0x221  unit-tests_1  |   testing.tRunner()  unit-tests_1  |       /opt/go/src/testing/testing.go:746 +0x16c  unit-tests_1  | ==================  unit-tests_1  | ==================  unit-tests_1  | WARNING: DATA RACE  unit-tests_1  | Write at 0x00000176e7c0 by goroutine 63:  unit-tests_1  |   github.com/hyperledger/fabric/vendor/github.com/op/go-logging.SetBackend()  unit-tests_1  |       /opt/gopath/src/github.com/hyperledger/fabric/vendor/github.com/op/go-logging/backend.go:26 +0xbb  unit-tests_1  |   github.com/hyperledger/fabric/common/flogging.InitBackend()  unit-tests_1  |       /opt/gopath/src/github.com/hyperledger/fabric/common/flogging/logging.go:76 +0x28c  unit-tests_1  |   github.com/hyperledger/fabric/core/chaincode/shim.SetupChaincodeLogging()  unit-tests_1  |       github.com/hyperledger/fabric/core/chaincode/shim/_test/_obj_test/chaincode.go:174 +0x23b  unit-tests_1  |   github.com/hyperledger/fabric/core/chaincode/shim.Start()  unit-tests_1  |       github.com/hyperledger/fabric/core/chaincode/shim/_test/_obj_test/chaincode.go:126 +0x5c  unit-tests_1  |   github.com/hyperledger/fabric/core/chaincode/shim.TestCC2CC.func1()  unit-tests_1  |       /opt/gopath/src/github.com/hyperledger/fabric/core/chaincode/shim/shim_test.go:889 +0x48  unit-tests_1  |  unit-tests_1  | Previous read at 0x00000176e7c0 by goroutine 65:  unit-tests_1  |   github.com/hyperledger/fabric/vendor/github.com/op/go-logging.(*Logger).IsEnabledFor()  unit-tests_1  |       /opt/gopath/src/github.com/hyperledger/fabric/vendor/github.com/op/go-logging/logger.go:140 +0x3e  unit-tests_1  |   github.com/hyperledger/fabric/vendor/github.com/op/go-logging.(*Logger).log()  unit-tests_1  |       /opt/gopath/src/github.com/hyperledger/fabric/vendor/github.com/op/go-logging/logger.go:144 +0x4c  unit-tests_1  |   github.com/hyperledger/fabric/vendor/github.com/op/go-logging.(*Logger).Debugf()  unit-tests_1  |       /opt/gopath/src/github.com/hyperledger/fabric/vendor/github.com/op/go-logging/logger.go:254 +0x98  unit-tests_1  |   github.com/hyperledger/fabric/core/chaincode/shim.chatWithPeer.func1()  unit-tests_1  |       github.com/hyperledger/fabric/core/chaincode/shim/_test/_obj_test/chaincode.go:348 +0xa3a  unit-tests_1  |  unit-tests_1  | Goroutine 63 (running) created at:  unit-tests_1  |   github.com/hyperledger/fabric/core/chaincode/shim.TestCC2CC()  unit-tests_1  |       /opt/gopath/src/github.com/hyperledger/fabric/core/chaincode/shim/shim_test.go:888 +0x1a2  unit-tests_1  |   testing.tRunner()  unit-tests_1  |       /opt/go/src/testing/testing.go:746 +0x16c  unit-tests_1  |  unit-tests_1  | Goroutine 65 (finished) created at:  unit-tests_1  |   github.com/hyperledger/fabric/core/chaincode/shim.chatWithPeer()  unit-tests_1  |       github.com/hyperledger/fabric/core/chaincode/shim/_test/_obj_test/chaincode.go:297 +0x695  unit-tests_1  |   github.com/hyperledger/fabric/core/chaincode/shim.StartInProc()  unit-tests_1  |       github.com/hyperledger/fabric/core/chaincode/shim/_test/_obj_test/chaincode.go:236 +0x46e  unit-tests_1  |   github.com/hyperledger/fabric/core/chaincode/shim.TestStartInProc.func3()  unit-tests_1  |       /opt/gopath/src/github.com/hyperledger/fabric/core/chaincode/shim/shim_test.go:866 +0x12d  unit-tests_1  | ==================  unit-tests_1  | 2018-03-26 12:35:16.475 UTC  shim  SetupChaincodeLogging -> INFO 055 Chaincode log level not provided; defaulting to: INFO  unit-tests_1  | ==================  unit-tests_1  | WARNING: DATA RACE  unit-tests_1  | Read at 0x00c420292068 by goroutine 69:  unit-tests_1  |   github.com/hyperledger/fabric/common/mocks/peer.(*MockCCComm).ka()  unit-tests_1  |       /opt/gopath/src/github.com/hyperledger/fabric/common/mocks/peer/mockccstream.go:137 +0xa2  unit-tests_1  |  unit-tests_1  | Previous write at 0x00c420292068 by goroutine 66:  unit-tests_1  |   github.com/hyperledger/fabric/common/mocks/peer.(*MockCCComm).Run.func1()  unit-tests_1  |       /opt/gopath/src/github.com/hyperledger/fabric/common/mocks/peer/mockccstream.go:152 +0x44  unit-tests_1  |   github.com/hyperledger/fabric/common/mocks/peer.(*MockCCComm).Run()  unit-tests_1  |       /opt/gopath/src/github.com/hyperledger/fabric/common/mocks/peer/mockccstream.go:160 +0x158  unit-tests_1  |   github.com/hyperledger/fabric/core/chaincode/shim.TestStartInProc.func2()  unit-tests_1  |       /opt/gopath/src/github.com/hyperledger/fabric/core/chaincode/shim/shim_test.go:861 +0x3d8  unit-tests_1  |  unit-tests_1  | Goroutine 69 (running) created at:  unit-tests_1  |   github.com/hyperledger/fabric/common/mocks/peer.(*MockCCComm).Run()  unit-tests_1  |       /opt/gopath/src/github.com/hyperledger/fabric/common/mocks/peer/mockccstream.go:148 +0x62  unit-tests_1  |   github.com/hyperledger/fabric/core/chaincode/shim.TestStartInProc.func2()  unit-tests_1  |       /opt/gopath/src/github.com/hyperledger/fabric/core/chaincode/shim/shim_test.go:861 +0x3d8  unit-tests_1  |  unit-tests_1  | Goroutine 66 (finished) created at:  unit-tests_1  |   github.com/hyperledger/fabric/core/chaincode/shim.TestStartInProc()  unit-tests_1  |       /opt/gopath/src/github.com/hyperledger/fabric/core/chaincode/shim/shim_test.go:856 +0x221  unit-tests_1  |   testing.tRunner()  unit-tests_1  |       /opt/go/src/testing/testing.go:746 +0x16c  unit-tests_1  | ==================  unit-tests_1  | ==================  unit-tests_1  | WARNING: DATA RACE  unit-tests_1  | Write at 0x00c42025a420 by goroutine 25:  unit-tests_1  |   runtime.closechan()  unit-tests_1  |       /opt/go/src/runtime/chan.go:313 +0x0  unit-tests_1  |   github.com/hyperledger/fabric/core/chaincode/shim.TestCC2CC()  unit-tests_1  |       /opt/gopath/src/github.com/hyperledger/fabric/common/mocks/peer/mockccstream.go:102 +0x28ab  unit-tests_1  |   testing.tRunner()  unit-tests_1  |       /opt/go/src/testing/testing.go:746 +0x16c  unit-tests_1  |  unit-tests_1  | Previous read at 0x00c42025a420 by goroutine 74:  unit-tests_1  |   runtime.chansend()  unit-tests_1  |       /opt/go/src/runtime/chan.go:128 +0x0  unit-tests_1  |   github.com/hyperledger/fabric/common/mocks/peer.(*MockCCComm).Send()  unit-tests_1  |       /opt/gopath/src/github.com/hyperledger/fabric/common/mocks/peer/mockccstream.go:74 +0x94  unit-tests_1  |   github.com/hyperledger/fabric/core/chaincode/shim.(*Handler).serialSend()  unit-tests_1  |       github.com/hyperledger/fabric/core/chaincode/shim/_test/_obj_test/handler.go:62 +0xca  unit-tests_1  |   github.com/hyperledger/fabric/core/chaincode/shim.(*Handler).serialSendAsync.func1()  unit-tests_1  |       github.com/hyperledger/fabric/core/chaincode/shim/_test/_obj_test/handler.go:71 +0x5e  unit-tests_1  |  unit-tests_1  | Goroutine 25 (running) created at:  unit-tests_1  |   testing.(*T).Run()  unit-tests_1  |       /opt/go/src/testing/testing.go:789 +0x568  unit-tests_1  |   testing.runTests.func1()  unit-tests_1  |       /opt/go/src/testing/testing.go:1004 +0xa7  unit-tests_1  |   testing.tRunner()  unit-tests_1  |       /opt/go/src/testing/testing.go:746 +0x16c  unit-tests_1  |   testing.runTests()  unit-tests_1  |       /opt/go/src/testing/testing.go:1002 +0x521  unit-tests_1  |   testing.(*M).Run()  unit-tests_1  |       /opt/go/src/testing/testing.go:921 +0x206  unit-tests_1  |   main.main()  unit-tests_1  |       github.com/hyperledger/fabric/core/chaincode/shim/_test/_testmain.go:134 +0x2f0  unit-tests_1  |  unit-tests_1  | Goroutine 74 (finished) created at:  unit-tests_1  |   github.com/hyperledger/fabric/core/chaincode/shim.(*Handler).serialSendAsync()  unit-tests_1  |       github.com/hyperledger/fabric/core/chaincode/shim/_test/_obj_test/handler.go:69 +0x78  unit-tests_1  |   github.com/hyperledger/fabric/core/chaincode/shim.chatWithPeer.func1()  unit-tests_1  |       github.com/hyperledger/fabric/core/chaincode/shim/_test/_obj_test/chaincode.go:371 +0x68e  unit-tests_1  | ==================  unit-tests_1  | ==================  unit-tests_1  | WARNING: DATA RACE  unit-tests_1  | Write at 0x00c420292110 by goroutine 25:  unit-tests_1  |   github.com/hyperledger/fabric/core/chaincode/shim.TestCC2CC()  unit-tests_1  |       /opt/gopath/src/github.com/hyperledger/fabric/common/mocks/peer/mockccstream.go:103 +0x28bf  unit-tests_1  |   testing.tRunner()  unit-tests_1  |       /opt/go/src/testing/testing.go:746 +0x16c  unit-tests_1  |  unit-tests_1  | Previous read at 0x00c420292110 by goroutine 27:  unit-tests_1  |   github.com/hyperledger/fabric/common/mocks/peer.(*MockCCComm).Run()  unit-tests_1  |       /opt/gopath/src/github.com/hyperledger/fabric/common/mocks/peer/mockccstream.go:80 +0xa7  unit-tests_1  |   github.com/hyperledger/fabric/core/chaincode/shim.TestCC2CC.func3()  unit-tests_1  |       /opt/gopath/src/github.com/hyperledger/fabric/core/chaincode/shim/shim_test.go:904 +0x3d8  unit-tests_1  |  unit-tests_1  | Goroutine 25 (running) created at:  unit-tests_1  |   testing.(*T).Run()  unit-tests_1  |       /opt/go/src/testing/testing.go:789 +0x568  unit-tests_1  |   testing.runTests.func1()  unit-tests_1  |       /opt/go/src/testing/testing.go:1004 +0xa7  unit-tests_1  |   testing.tRunner()  unit-tests_1  |       /opt/go/src/testing/testing.go:746 +0x16c  unit-tests_1  |   testing.runTests()  unit-tests_1  |       /opt/go/src/testing/testing.go:1002 +0x521  unit-tests_1  |   testing.(*M).Run()  unit-tests_1  |       /opt/go/src/testing/testing.go:921 +0x206  unit-tests_1  |   main.main()  unit-tests_1  |       github.com/hyperledger/fabric/core/chaincode/shim/_test/_testmain.go:134 +0x2f0  unit-tests_1  |  unit-tests_1  | Goroutine 27 (running) created at:  unit-tests_1  |   github.com/hyperledger/fabric/core/chaincode/shim.TestCC2CC()  unit-tests_1  |       /opt/gopath/src/github.com/hyperledger/fabric/core/chaincode/shim/shim_test.go:899 +0x274  unit-tests_1  |   testing.tRunner()  unit-tests_1  |       /opt/go/src/testing/testing.go:746 +0x16c  unit-tests_1  | ==================  unit-tests_1  | ==================  unit-tests_1  | WARNING: DATA RACE  unit-tests_1  | Write at 0x00c42025a480 by goroutine 25:  unit-tests_1  |   runtime.closechan()  unit-tests_1  |       /opt/go/src/runtime/chan.go:313 +0x0  unit-tests_1  |   github.com/hyperledger/fabric/core/chaincode/shim.TestCC2CC()  unit-tests_1  |       /opt/gopath/src/github.com/hyperledger/fabric/common/mocks/peer/mockccstream.go:107 +0x2833  unit-tests_1  |   testing.tRunner()  unit-tests_1  |       /opt/go/src/testing/testing.go:746 +0x16c  unit-tests_1  |  unit-tests_1  | Previous read at 0x00c42025a480 by goroutine 29:  unit-tests_1  |   runtime.chansend()  unit-tests_1  |       /opt/go/src/runtime/chan.go:128 +0x0  unit-tests_1  |   github.com/hyperledger/fabric/common/mocks/peer.(*MockCCComm).Send()  unit-tests_1  |       /opt/gopath/src/github.com/hyperledger/fabric/common/mocks/peer/mockccstream.go:74 +0x94  unit-tests_1  |   github.com/hyperledger/fabric/common/mocks/peer.(*MockCCComm).ka()  unit-tests_1  |       /opt/gopath/src/github.com/hyperledger/fabric/common/mocks/peer/mockccstream.go:140 +0x7b  unit-tests_1  |  unit-tests_1  | Goroutine 25 (running) created at:  unit-tests_1  |   testing.(*T).Run()  unit-tests_1  |       /opt/go/src/testing/testing.go:789 +0x568  unit-tests_1  |   testing.runTests.func1()  unit-tests_1  |       /opt/go/src/testing/testing.go:1004 +0xa7  unit-tests_1  |   testing.tRunner()  unit-tests_1  |       /opt/go/src/testing/testing.go:746 +0x16c  unit-tests_1  |   testing.runTests()  unit-tests_1  |       /opt/go/src/testing/testing.go:1002 +0x521  unit-tests_1  |   testing.(*M).Run()  unit-tests_1  |       /opt/go/src/testing/testing.go:921 +0x206  unit-tests_1  |   main.main()  unit-tests_1  |       github.com/hyperledger/fabric/core/chaincode/shim/_test/_testmain.go:134 +0x2f0  unit-tests_1  |  unit-tests_1  | Goroutine 29 (running) created at:  unit-tests_1  |   github.com/hyperledger/fabric/common/mocks/peer.(*MockCCComm).Run()  unit-tests_1  |       /opt/gopath/src/github.com/hyperledger/fabric/common/mocks/peer/mockccstream.go:148 +0x62  unit-tests_1  |   github.com/hyperledger/fabric/core/chaincode/shim.TestCC2CC.func3()  unit-tests_1  |       /opt/gopath/src/github.com/hyperledger/fabric/core/chaincode/shim/shim_test.go:904 +0x3d8  unit-tests_1  | ==================  unit-tests_1  | ==================  unit-tests_1  | WARNING: DATA RACE  unit-tests_1  | Write at 0x00c420292118 by goroutine 25:  unit-tests_1  |   github.com/hyperledger/fabric/core/chaincode/shim.TestCC2CC()  unit-tests_1  |       /opt/gopath/src/github.com/hyperledger/fabric/common/mocks/peer/mockccstream.go:108 +0x2847  unit-tests_1  |   testing.tRunner()  unit-tests_1  |       /opt/go/src/testing/testing.go:746 +0x16c  unit-tests_1  |  unit-tests_1  | Previous read at 0x00c420292118 by goroutine 29:  unit-tests_1  |   github.com/hyperledger/fabric/common/mocks/peer.(*MockCCComm).Send()  unit-tests_1  |       /opt/gopath/src/github.com/hyperledger/fabric/common/mocks/peer/mockccstream.go:74 +0x78  unit-tests_1  |   github.com/hyperledger/fabric/common/mocks/peer.(*MockCCComm).ka()  unit-tests_1  |       /opt/gopath/src/github.com/hyperledger/fabric/common/mocks/peer/mockccstream.go:140 +0x7b  unit-tests_1  |  unit-tests_1  | Goroutine 25 (running) created at:  unit-tests_1  |   testing.(*T).Run()  unit-tests_1  |       /opt/go/src/testing/testing.go:789 +0x568  unit-tests_1  |   testing.runTests.func1()  unit-tests_1  |       /opt/go/src/testing/testing.go:1004 +0xa7  unit-tests_1  |   testing.tRunner()  unit-tests_1  |       /opt/go/src/testing/testing.go:746 +0x16c  unit-tests_1  |   testing.runTests()  unit-tests_1  |       /opt/go/src/testing/testing.go:1002 +0x521  unit-tests_1  |   testing.(*M).Run()  unit-tests_1  |       /opt/go/src/testing/testing.go:921 +0x206  unit-tests_1  |   main.main()  unit-tests_1  |       github.com/hyperledger/fabric/core/chaincode/shim/_test/_testmain.go:134 +0x2f0  unit-tests_1  |  unit-tests_1  | Goroutine 29 (running) created at:  unit-tests_1  |   github.com/hyperledger/fabric/common/mocks/peer.(*MockCCComm).Run()  unit-tests_1  |       /opt/gopath/src/github.com/hyperledger/fabric/common/mocks/peer/mockccstream.go:148 +0x62  unit-tests_1  |   github.com/hyperledger/fabric/core/chaincode/shim.TestCC2CC.func3()  unit-tests_1  |       /opt/gopath/src/github.com/hyperledger/fabric/core/chaincode/shim/shim_test.go:904 +0x3d8  unit-tests_1  | =================={code}  ></description> </Issue>
