<Issue id="40264" key="FAB-15604" number="15604" project="10002" reporter="muralisr" assignee="wlahti" creator="muralisr" type="10004" summary="crash on peer restart after installing CC using lifecycle 2.0 operations" priority="2" resolution="10000" status="6" created="2019-06-01 17:45:34.0" updated="2019-06-03 18:24:12.0" resolutiondate="2019-06-03 17:09:43.0" votes="0" watches="2" workflowId="53170"> <description><! CDATA Deploy a chaincode using lifecycle 2.0 operations. Kill and restart the peer. You should see this crash (using latest commit level 36f783c4b94f58d1619d8bdae8546f35bfc5d8d1).    {code:java} ^  34m2019-06-01 13:42:37.389 EDT  nodeCmd  serve -> INFO 001^  0m Starting peer: Version: 2.0.0 Commit SHA: 36f783c4b Go version: go1.12.5 OS/Arch: darwin/amd64 Chaincode: Base Docker Namespace: hyperledger Base Docker Label: org.hyperledger.fabric Docker Namespace: hyperledger ^  34m2019-06-01 13:42:37.390 EDT  peer  getLocalAddress -> INFO 002^  0m Auto-detected peer address: 192.168.1.96:7051 ^  34m2019-06-01 13:42:37.390 EDT  peer  getLocalAddress -> INFO 003^  0m Host is 0.0.0.0 , falling back to auto-detected address: 192.168.1.96:7051 ^  33m2019-06-01 13:42:37.393 EDT  ccprovider  ListInstalledChaincodes -> WARN 004^  0m Failed obtaining chaincode information about mycc:663998cb12e30285a155831ab40fe2357d89ff81a59dd29bf9c3554e30491568 bin : failed to unmarshal envelope from bytes ^  35m2019-06-01 13:42:37.393 EDT  nodeCmd  serve -> PANI 005^  0m Failed creating LegacyMetadataManager: +failed listing installed chaincodes: failed obtaining information about mycc:663998cb12e30285a155831ab40fe2357d89ff81a59dd29bf9c3554e30491568, version bin: failed to unmarshal envelope from bytes panic: Failed creating LegacyMetadataManager: +failed listing installed chaincodes: failed obtaining information about mycc:663998cb12e30285a155831ab40fe2357d89ff81a59dd29bf9c3554e30491568, version bin: failed to unmarshal envelope from bytes goroutine 1  running : github.com/hyperledger/fabric/vendor/go.uber.org/zap/zapcore.(*CheckedEntry).Write(0xc00017c580, 0x0, 0x0, 0x0) /Users/muralisr/hyperledger/src/github.com/hyperledger/fabric/vendor/go.uber.org/zap/zapcore/entry.go:229 +0x546 github.com/hyperledger/fabric/vendor/go.uber.org/zap.(*SugaredLogger).log(0xc000010cb8, 0xc00041d704, 0x4ff8eb0, 0x2a, 0xc00046f828, 0x1, 0x1, 0x0, 0x0, 0x0) /Users/muralisr/hyperledger/src/github.com/hyperledger/fabric/vendor/go.uber.org/zap/sugar.go:234 +0x101 github.com/hyperledger/fabric/vendor/go.uber.org/zap.(*SugaredLogger).Panicf(...) /Users/muralisr/hyperledger/src/github.com/hyperledger/fabric/vendor/go.uber.org/zap/sugar.go:159 github.com/hyperledger/fabric/common/flogging.(*FabricLogger).Panicf(...) /Users/muralisr/hyperledger/src/github.com/hyperledger/fabric/common/flogging/zap.go:74 github.com/hyperledger/fabric/internal/peer/node.serve(0x5c8c9a0, 0x0, 0x0, 0x0, 0x0) /Users/muralisr/hyperledger/src/github.com/hyperledger/fabric/internal/peer/node/start.go:220 +0x8c0 github.com/hyperledger/fabric/internal/peer/node.glob..func1(0x5c46b20, 0x5c8c9a0, 0x0, 0x0, 0x0, 0x0) /Users/muralisr/hyperledger/src/github.com/hyperledger/fabric/internal/peer/node/start.go:122 +0xf1 github.com/hyperledger/fabric/vendor/github.com/spf13/cobra.(*Command).execute(0x5c46b20, 0x5c8c9a0, 0x0, 0x0, 0x5c46b20, 0x5c8c9a0) /Users/muralisr/hyperledger/src/github.com/hyperledger/fabric/vendor/github.com/spf13/cobra/command.go:762 +0x465 github.com/hyperledger/fabric/vendor/github.com/spf13/cobra.(*Command).ExecuteC(0x5c46fe0, 0xc00046ff60, 0x1, 0x1) /Users/muralisr/hyperledger/src/github.com/hyperledger/fabric/vendor/github.com/spf13/cobra/command.go:850 +0x2fc github.com/hyperledger/fabric/vendor/github.com/spf13/cobra.(*Command).Execute(...) /Users/muralisr/hyperledger/src/github.com/hyperledger/fabric/vendor/github.com/spf13/cobra/command.go:800 main.main() /Users/muralisr/hyperledger/src/github.com/hyperledger/fabric/cmd/peer/main.go:51 +0x416 {code}  ></description> </Issue>
