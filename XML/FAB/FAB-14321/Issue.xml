<Issue id="37936" key="FAB-14321" number="14321" project="10002" reporter="c0rwin" assignee="c0rwin" creator="c0rwin" type="10001" summary="Backport Raft OSN to Fabric v1.4.1" priority="1" resolution="10000" status="6" created="2019-02-23 23:14:24.0" updated="2019-03-07 14:03:31.0" resolutiondate="2019-03-07 14:03:31.0" votes="0" watches="2" workflowId="49554"> <description><! CDATA There is a need to backport Raft related CRs from master branch into v1.4.1.   Here is the list of items since cut of 1.4.0 which was *merged* into {{master}} while not ported into {{v1.4.0}} branch:  ||JIRA ||Gerrit(master) CR|| Backport Gerrit(v1.4.1) CR ||Ported (Yes/No/Gerrit)|| |  FAB-12945  add raft reconfiguration unit-tests  | https://gerrit.hyperledger.org/r/27656| https://gerrit.hyperledger.org/r/29514|Gerrit| | FAB-12986: ledger per chain for raft chain_test.go  | https://gerrit.hyperledger.org/r/27719| https://gerrit.hyperledger.org/r/29515|Gerrit| |  FAB-12949  finish reconfiguration after restart  | https://gerrit.hyperledger.org/r/27773| https://gerrit.hyperledger.org/r/29516|Gerrit| |  FAB-13199  Reduce etcdraft test time.  | https://gerrit.hyperledger.org/r/28083| https://gerrit.hyperledger.org/r/29517|Gerrit| |  FAB-13057  Remove applied index check in storage  | https://gerrit.hyperledger.org/r/28005| https://gerrit.hyperledger.org/r/29518|Gerrit| |  FAB-13225  address code review comments  | https://gerrit.hyperledger.org/r/28058| https://gerrit.hyperledger.org/r/29519|Gerrit| |  FAB-13150  Re-enable etcdraft for v2.0 development  | https://gerrit.hyperledger.org/r/27909| https://gerrit.hyperledger.org/r/29511|Gerrit| |  FAB-12729  Support subset of system channel OSNs  | https://gerrit.hyperledger.org/r/28046| https://gerrit.hyperledger.org/r/29512|Gerrit| |  FAB-12949  Fix etcdraft reconfiguration UT  | https://gerrit.hyperledger.org/r/28119| https://gerrit.hyperledger.org/r/29520|Gerrit| |  FAB-13053  Add an UT to assert retransmission.  | https://gerrit.hyperledger.org/r/27804| https://gerrit.hyperledger.org/r/29521|Gerrit| |  FAB-13262  typo in configblock.go  | https://gerrit.hyperledger.org/r/28150| https://gerrit.hyperledger.org/r/29522|Gerrit| |  FAB-12579  Separate TLS listener for intra-cluster  | https://gerrit.hyperledger.org/r/28107| https://gerrit.hyperledger.org/r/29537|Gerrit| |  FAB-13299  Onboarding: Skip committing existing blocks  | https://gerrit.hyperledger.org/r/28205| https://gerrit.hyperledger.org/r/29538|Gerrit| |  FAB-13298  Fix TestConfigureClusterListener in MacOS  | https://gerrit.hyperledger.org/r/28202| https://gerrit.hyperledger.org/r/29539|Gerrit| |  FAB-13350  Fix etcdraft flaky test  | https://gerrit.hyperledger.org/r/28285| https://gerrit.hyperledger.org/r/29540|Gerrit| |  FAB-13095  fix UT flake RPC timeout  | https://gerrit.hyperledger.org/r/28280| https://gerrit.hyperledger.org/r/29541|Gerrit| |  FAB-13349  Add more assertion to etcdraft UT.  | https://gerrit.hyperledger.org/r/28295| https://gerrit.hyperledger.org/r/29542|Gerrit| |  FAB-13330  Rename GetConfigBlock to GetConfig in nwo  | https://gerrit.hyperledger.org/r/28240| https://gerrit.hyperledger.org/r/29543|Gerrit| |  FAB-13334  Onboarding: Allow empty channels  | https://gerrit.hyperledger.org/r/28238| https://gerrit.hyperledger.org/r/29544|Gerrit| |  FAB-13332  Add cryptogen extend to integration tests  | https://gerrit.hyperledger.org/r/28239| https://gerrit.hyperledger.org/r/29545|Gerrit| |  FAB-13298  Fix test flake on MacOS  | https://gerrit.hyperledger.org/r/28246| https://gerrit.hyperledger.org/r/29546|Gerrit| |  FAB-13333  Orderer config update to use orderer creds  | https://gerrit.hyperledger.org/r/28242| https://gerrit.hyperledger.org/r/29556|Gerrit| |  FAB-13208  Raft Reconfig&Onboarding integration test  | https://gerrit.hyperledger.org/r/28243| https://gerrit.hyperledger.org/r/29557|Gerrit| |  FAB-1337  Raft: Commit genesis blocks for non-members  | https://gerrit.hyperledger.org/r/28330| https://gerrit.hyperledger.org/r/29564|Gerrit| |  FAB-13331  Refactor metadata updates in nwo  | https://gerrit.hyperledger.org/r/28241| https://gerrit.hyperledger.org/r/29558|Gerrit| |  FAB-13367  Fix flaky etcdraft UT  | https://gerrit.hyperledger.org/r/28308| https://gerrit.hyperledger.org/r/29559|Gerrit| |  FAB-13415  DRY up UpdateConsensusMetadata in nwo  | https://gerrit.hyperledger.org/r/28346| https://gerrit.hyperledger.org/r/29560|Gerrit| |  FAB-13360  Fix an etcdraft flaky UT  | https://gerrit.hyperledger.org/r/28341| https://gerrit.hyperledger.org/r/29561|Gerrit| |  FAB-13427  Make replication tests not depend on time  | https://gerrit.hyperledger.org/r/28354| https://gerrit.hyperledger.org/r/29562|Gerrit| |  FAB-13428  Make TestReplicateChainsFailures robust  | https://gerrit.hyperledger.org/r/28355| https://gerrit.hyperledger.org/r/29563|Gerrit| |  FAB-13441  Properly capture OSN output  | https://gerrit.hyperledger.org/r/28377| https://gerrit.hyperledger.org/r/29573|Gerrit| |  FAB-13362  Pulling not servicing chains in onboarding  | https://gerrit.hyperledger.org/r/28366| https://gerrit.hyperledger.org/r/29574|Gerrit| |  FAB-13444  Prepare onboarding to multi-time use  | https://gerrit.hyperledger.org/r/28385| https://gerrit.hyperledger.org/r/29575|Gerrit| |  FAB-13456  Use empty peer list to join raft cluster  | https://gerrit.hyperledger.org/r/28402| https://gerrit.hyperledger.org/r/29579|Gerrit| |  FAB-13180  Orderer: auto-join existing inactive chains  | https://gerrit.hyperledger.org/r/28391| https://gerrit.hyperledger.org/r/29580|Gerrit| |  FAB-13456  Fix race in etcdraft test  | https://gerrit.hyperledger.org/r/28475| https://gerrit.hyperledger.org/r/29576|Gerrit| |  FAB-13465  Max retry attempts for orderer replication  | https://gerrit.hyperledger.org/r/28442| https://gerrit.hyperledger.org/r/29577|Gerrit| | FAB-12983 capability V2_0 for Kafka2RaftMigration  | https://gerrit.hyperledger.org/r/27822| https://gerrit.hyperledger.org/r/29578|Gerrit| |  FAB-13495  Activate onboarding max retries  | https://gerrit.hyperledger.org/r/28499| https://gerrit.hyperledger.org/r/29581|Gerrit| |  FAB-13481  Make onboarding code more idiomatic  | https://gerrit.hyperledger.org/r/28473| https://gerrit.hyperledger.org/r/29582|Gerrit| |  FAB-11996  Fix failed UT  | https://gerrit.hyperledger.org/r/28620| https://gerrit.hyperledger.org/r/29583|Gerrit| |  FAB-13178  Simplify the proposition of config block  | https://gerrit.hyperledger.org/r/28345| https://gerrit.hyperledger.org/r/29588|Gerrit| |  FAB-13633  Make Step RPC failures non blocking  | https://gerrit.hyperledger.org/r/28657| https://gerrit.hyperledger.org/r/29589|Gerrit| | FAB-12984 consensus migration protos  | https://gerrit.hyperledger.org/r/28113| https://gerrit.hyperledger.org/r/29590|Gerrit| | FAB-13265 migration status in channelconfig  | https://gerrit.hyperledger.org/r/28155| https://gerrit.hyperledger.org/r/29591|Gerrit| |  FAB-13643  Leader crash and failover integration test  | https://gerrit.hyperledger.org/r/28648| https://gerrit.hyperledger.org/r/29592|Gerrit| |  FAB-13698  disable flaky test TestReconnect  | https://gerrit.hyperledger.org/r/28747| https://gerrit.hyperledger.org/r/29593|Gerrit| |  FAB-13694  Move LastConfigBlock to orderer common  | https://gerrit.hyperledger.org/r/28732| https://gerrit.hyperledger.org/r/29594|Gerrit| |  FAB-13178  Refactor etcdraft chain to avoid sync  | https://gerrit.hyperledger.org/r/28204| https://gerrit.hyperledger.org/r/29595|Gerrit| |  FAB-13178  do not accept new env when conf in flight  | https://gerrit.hyperledger.org/r/28427| https://gerrit.hyperledger.org/r/29596|Gerrit| |  FAB-13178  Move raft logic to its own file  | https://gerrit.hyperledger.org/r/28428| https://gerrit.hyperledger.org/r/29597|Gerrit| |  FAB-13178  Remove global leader var in etcdraft chain  | https://gerrit.hyperledger.org/r/28478| https://gerrit.hyperledger.org/r/29598|Gerrit| |  FAB-13178  A dumb version of etcdraft BlockCreator  | https://gerrit.hyperledger.org/r/28541| https://gerrit.hyperledger.org/r/29600|Gerrit| |  FAB-13447  Streamline the code  | https://gerrit.hyperledger.org/r/28581| https://gerrit.hyperledger.org/r/29601|Gerrit| |  FAB-13447  new leader should wait for in flight msg  | https://gerrit.hyperledger.org/r/28582| https://gerrit.hyperledger.org/r/29602|Gerrit| |  FAB-13438  pass SoftState on observe channel  | https://gerrit.hyperledger.org/r/28585| https://gerrit.hyperledger.org/r/29603|Gerrit| |  FAB-13438  Store raft SoftState  | https://gerrit.hyperledger.org/r/28588| https://gerrit.hyperledger.org/r/29604|Gerrit| |  FAB-13613  Fix race in etcdraft chain UT  | https://gerrit.hyperledger.org/r/28621| https://gerrit.hyperledger.org/r/29605|Gerrit| |  FAB-13438  Errored should reflect correct state  | https://gerrit.hyperledger.org/r/28619| https://gerrit.hyperledger.org/r/29623|Gerrit| |  FAB-13178  Use MaxInflightMsgs to throttle requests  | https://gerrit.hyperledger.org/r/28650| https://gerrit.hyperledger.org/r/29624|Gerrit| |  FAB-13716  Block verifier book-keeping for onboarding  | https://gerrit.hyperledger.org/r/28768| https://gerrit.hyperledger.org/r/29625|Gerrit| |  FAB-13178  Move `SendSubmit` out of serveRequest  | https://gerrit.hyperledger.org/r/28847| https://gerrit.hyperledger.org/r/29626|Gerrit| |  FAB-13363  Block verification for onboarding  | https://gerrit.hyperledger.org/r/28770| https://gerrit.hyperledger.org/r/29627|Gerrit| |  FAB-13808  Address code review comments for FAB-13363  | https://gerrit.hyperledger.org/r/28866| https://gerrit.hyperledger.org/r/29628|Gerrit| | FAB-13704 Update doc of ConsensusType proto  | https://gerrit.hyperledger.org/r/28776| https://gerrit.hyperledger.org/r/29629|Gerrit| | FAB-13705 refine Bundle.validateNew  | https://gerrit.hyperledger.org/r/28780| https://gerrit.hyperledger.org/r/29630|Gerrit| |  FAB-13845  Increase default raft tick interval  | https://gerrit.hyperledger.org/r/28918| https://gerrit.hyperledger.org/r/29631|Gerrit| |  FAB-13848  Fix flaky integration test in raft cft  | https://gerrit.hyperledger.org/r/28921| https://gerrit.hyperledger.org/r/29632|Gerrit| |  FAB-12709  Use another way to elect leader in UT  | https://gerrit.hyperledger.org/r/28778| https://gerrit.hyperledger.org/r/29633|Gerrit| |  FAB-12709  Enable CheckQuorum  | https://gerrit.hyperledger.org/r/28628| https://gerrit.hyperledger.org/r/29634|Gerrit| |  FAB-12709  Add integration test for CheckQuorum  | https://gerrit.hyperledger.org/r/28783| https://gerrit.hyperledger.org/r/29635|Gerrit| |  FAB-13199  Start etcdraft chain sequentially in UT  | https://gerrit.hyperledger.org/r/28846| https://gerrit.hyperledger.org/r/29636|Gerrit| |  FAB-13059  put raft snapshotting in go routine  | https://gerrit.hyperledger.org/r/28849| https://gerrit.hyperledger.org/r/29637|Gerrit| |  FAB-11863  Clean orderer network failure logs  | https://gerrit.hyperledger.org/r/28883| https://gerrit.hyperledger.org/r/29638|Gerrit| |  FAB-13455  Initialize BlockPuller on demand.  | https://gerrit.hyperledger.org/r/28885| https://gerrit.hyperledger.org/r/29639|Gerrit| | FAB-13264 consensus migration: kafka2raft green path #1  | https://gerrit.hyperledger.org/r/28435| https://gerrit.hyperledger.org/r/29640|Gerrit| |  FAB-13967  Polling, instead of waiting in AfterEach  | https://gerrit.hyperledger.org/r/29034| https://gerrit.hyperledger.org/r/29641|Gerrit| |  FAB-13805  Unify Step and Submit into a stream  | https://gerrit.hyperledger.org/r/28892| https://gerrit.hyperledger.org/r/29642|Gerrit| |  FAB-13059  Purge etcdraft WAL and Snapshot files  | https://gerrit.hyperledger.org/r/28850| https://gerrit.hyperledger.org/r/29643|Gerrit| |  FAB-13934  Add GinkgoRecover to integration tests.  | https://gerrit.hyperledger.org/r/28998| https://gerrit.hyperledger.org/r/29644|Gerrit| |  FAB-14041  Validate boot block is system channel block  | https://gerrit.hyperledger.org/r/29112| https://gerrit.hyperledger.org/r/29645|Gerrit| |  FAB-14010  Integration test- remove OSN from cluster  | https://gerrit.hyperledger.org/r/29070| https://gerrit.hyperledger.org/r/29646|Gerrit| |  FAB-14045  Send messages asynchronously in clusters  | https://gerrit.hyperledger.org/r/29113| https://gerrit.hyperledger.org/r/29647|Gerrit| |  FAB-13618  Fix test flake in OSN eviction test  | https://gerrit.hyperledger.org/r/29141| https://gerrit.hyperledger.org/r/29648|Gerrit| |  FAB-14111  Remove unused function IsMembershipUpdate  | https://gerrit.hyperledger.org/r/29196| https://gerrit.hyperledger.org/r/29649|Gerrit| |  FAB-13656  Size-based snapshotting  | https://gerrit.hyperledger.org/r/29152| https://gerrit.hyperledger.org/r/29650|Gerrit| |  FAB-14031  Fix flake in etcdraft UT  | https://gerrit.hyperledger.org/r/29180| https://gerrit.hyperledger.org/r/29651|Gerrit| | FAB-13665 consensus migration: kafka2raft green path #2  | https://gerrit.hyperledger.org/r/28705| https://gerrit.hyperledger.org/r/29653|Gerrit| |  FAB-14142  NPE when onboarding without app channels  | https://gerrit.hyperledger.org/r/29247| https://gerrit.hyperledger.org/r/29654|Gerrit| |  FAB-14129  Add more logs to etcdraft chain  | https://gerrit.hyperledger.org/r/29236| https://gerrit.hyperledger.org/r/29655|Gerrit| |  FAB-14179  Perform checks of instantiation in test  | https://gerrit.hyperledger.org/r/29297| https://gerrit.hyperledger.org/r/29656|Gerrit| |  FAB-14181  GinkgoRecover should be deferred directly  | https://gerrit.hyperledger.org/r/29299| https://gerrit.hyperledger.org/r/29657|Gerrit| |  FAB-11937  Provide Raft-specific metrics  | https://gerrit.hyperledger.org/r/29153| https://gerrit.hyperledger.org/r/29658|Gerrit| |  FAB-14136  Always Deliver if cluster smaller than 3  | https://gerrit.hyperledger.org/r/29233| https://gerrit.hyperledger.org/r/29659|Gerrit| |  FAB-14217  Harden etcdraft eviction integration test  | https://gerrit.hyperledger.org/r/29340| https://gerrit.hyperledger.org/r/29660|Gerrit| | FAB-13666 consensus migration: kafka2raft green path #3  | https://gerrit.hyperledger.org/r/28707| https://gerrit.hyperledger.org/r/29661|Gerrit| | FAB-13669 consensus migration: kafka2raft green path #4  | https://gerrit.hyperledger.org/r/28708| https://gerrit.hyperledger.org/r/29662|Gerrit| | FAB-12991 kafka2raft e2e tests green path  | https://gerrit.hyperledger.org/r/28439| https://gerrit.hyperledger.org/r/29663|Gerrit| |  FAB-14192  Fix deadlock in etcdraft chain  | https://gerrit.hyperledger.org/r/29323| https://gerrit.hyperledger.org/r/29664|Gerrit| |  FAB-14240  Do not use `support.Height` in chain  | https://gerrit.hyperledger.org/r/29363| https://gerrit.hyperledger.org/r/29675|Gerrit| |  FAB-14004  Bump etcd/raft lib version  | https://gerrit.hyperledger.org/r/29435| https://gerrit.hyperledger.org/r/29681|Gerrit| |  FAB-14278  Fix etcdraft flaky UT  | https://gerrit.hyperledger.org/r/29431| https://gerrit.hyperledger.org/r/29682|Gerrit| |  FAB-14300  Skip pulling pulled channels in onboarding  | https://gerrit.hyperledger.org/r/29477| https://gerrit.hyperledger.org/r/29683|Gerrit| |  FAB-13750  Detect eviction from channel and halt  | https://gerrit.hyperledger.org/r/29084| https://gerrit.hyperledger.org/r/29684|Gerrit|  And there is still waiting for review item  ||JIRA ||Gerrit CR||Ported (Yes/No)|| |  WIP  FAB-14077  cluster comm metrics  | https://gerrit.hyperledger.org/r/29373|No|  In addition need to backport changes from following stack:  https://gerrit.hyperledger.org/r/c/29124 and commit https://gerrit.hyperledger.org/r/#/c/29384/   //cc  ~kchristidis   ></description> </Issue>
