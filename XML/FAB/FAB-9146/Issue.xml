<Issue id="28874" key="FAB-9146" number="9146" project="10002" reporter="sykesm" creator="sykesm" type="10003" summary="Data race when running TestCreateChainFromBlock" priority="4" resolution="10000" status="6" created="2018-03-26 13:51:39.0" updated="2018-07-20 14:16:07.0" resolutiondate="2018-07-05 15:10:11.0" votes="0" watches="1" workflowId="41646"> <description><! CDATA {code:java} unit-tests_1  | ==================  unit-tests_1  | WARNING: DATA RACE  unit-tests_1  | Write at 0x00c420126f00 by goroutine 94:  unit-tests_1  |   runtime.mapassign_faststr()  unit-tests_1  |       /opt/go/src/runtime/hashmap_fast.go:598 +0x0  unit-tests_1  |   github.com/hyperledger/fabric/vendor/github.com/spf13/viper.(*Viper).Set()  unit-tests_1  |       /opt/gopath/src/github.com/hyperledger/fabric/vendor/github.com/spf13/viper/viper.go:772 +0xc6  unit-tests_1  |   github.com/hyperledger/fabric/vendor/github.com/spf13/viper.Set()  unit-tests_1  |       /opt/gopath/src/github.com/hyperledger/fabric/vendor/github.com/spf13/viper/viper.go:768 +0x72  unit-tests_1  |   github.com/hyperledger/fabric/core/peer_test.TestUpdateRootsFromConfigBlock.func1()  unit-tests_1  |       /opt/gopath/src/github.com/hyperledger/fabric/core/peer/pkg_test.go:161 +0x90  unit-tests_1  |   github.com/hyperledger/fabric/core/peer_test.TestUpdateRootsFromConfigBlock.func3()  unit-tests_1  |       /opt/gopath/src/github.com/hyperledger/fabric/core/peer/pkg_test.go:261 +0x5a  unit-tests_1  |   github.com/hyperledger/fabric/core/peer_test.TestUpdateRootsFromConfigBlock.func5()  unit-tests_1  |       /opt/gopath/src/github.com/hyperledger/fabric/core/peer/pkg_test.go:312 +0x59f  unit-tests_1  |   testing.tRunner()  unit-tests_1  |       /opt/go/src/testing/testing.go:746 +0x16c  unit-tests_1  |  unit-tests_1  | Previous read at 0x00c420126f00 by goroutine 137:  unit-tests_1  |   runtime.mapaccess2_faststr()  unit-tests_1  |       /opt/go/src/runtime/hashmap_fast.go:315 +0x0  unit-tests_1  |   github.com/hyperledger/fabric/vendor/github.com/spf13/viper.(*Viper).find()  unit-tests_1  |       /opt/gopath/src/github.com/hyperledger/fabric/vendor/github.com/spf13/viper/viper.go:628 +0x16d  unit-tests_1  |   github.com/hyperledger/fabric/vendor/github.com/spf13/viper.(*Viper).Get()  unit-tests_1  |       /opt/gopath/src/github.com/hyperledger/fabric/vendor/github.com/spf13/viper/viper.go:404 +0x109  unit-tests_1  |   github.com/hyperledger/fabric/vendor/github.com/spf13/viper.(*Viper).GetDuration()  unit-tests_1  |       /opt/gopath/src/github.com/hyperledger/fabric/vendor/github.com/spf13/viper/viper.go:481 +0x4c  unit-tests_1  |   github.com/hyperledger/fabric/vendor/github.com/spf13/viper.GetDuration()  unit-tests_1  |       /opt/gopath/src/github.com/hyperledger/fabric/vendor/github.com/spf13/viper/viper.go:479 +0x5e  unit-tests_1  |   github.com/hyperledger/fabric/gossip/util.GetDurationOrDefault()  unit-tests_1  |       /opt/gopath/src/github.com/hyperledger/fabric/gossip/util/misc.go:165 +0x87  unit-tests_1  |   github.com/hyperledger/fabric/gossip/discovery.getReconnectInterval()  unit-tests_1  |       /opt/gopath/src/github.com/hyperledger/fabric/gossip/discovery/discovery_impl.go:1002 +0x51  unit-tests_1  |   github.com/hyperledger/fabric/gossip/discovery.(*gossipDiscoveryImpl).Connect.func1()  unit-tests_1  |       /opt/gopath/src/github.com/hyperledger/fabric/gossip/discovery/discovery_impl.go:158 +0x8b7  unit-tests_1  |  unit-tests_1  | Goroutine 94 (running) created at:  unit-tests_1  |   testing.(*T).Run()  unit-tests_1  |       /opt/go/src/testing/testing.go:789 +0x568  unit-tests_1  |   github.com/hyperledger/fabric/core/peer_test.TestUpdateRootsFromConfigBlock()  unit-tests_1  |       /opt/gopath/src/github.com/hyperledger/fabric/core/peer/pkg_test.go:293 +0x2d2a  unit-tests_1  |   testing.tRunner()  unit-tests_1  |       /opt/go/src/testing/testing.go:746 +0x16c  unit-tests_1  |  unit-tests_1  | Goroutine 137 (running) created at:  unit-tests_1  |   github.com/hyperledger/fabric/gossip/discovery.(*gossipDiscoveryImpl).Connect()  unit-tests_1  |       /opt/gopath/src/github.com/hyperledger/fabric/gossip/discovery/discovery_impl.go:150 +0x486  unit-tests_1  |   github.com/hyperledger/fabric/gossip/gossip.(*gossipServiceImpl).learnAnchorPeers()  unit-tests_1  |       /opt/gopath/src/github.com/hyperledger/fabric/gossip/gossip/gossip_impl.go:262 +0x6a2  unit-tests_1  |   github.com/hyperledger/fabric/gossip/gossip.(*gossipServiceImpl).JoinChan()  unit-tests_1  |       /opt/gopath/src/github.com/hyperledger/fabric/gossip/gossip/gossip_impl.go:186 +0x153  unit-tests_1  |   github.com/hyperledger/fabric/gossip/service.(*gossipServiceImpl).updateAnchors()  unit-tests_1  |       /opt/gopath/src/github.com/hyperledger/fabric/gossip/service/gossip_service.go:323 +0xb7d  unit-tests_1  |   github.com/hyperledger/fabric/gossip/service.(*configEventer).ProcessConfigUpdate()  unit-tests_1  |       /opt/gopath/src/github.com/hyperledger/fabric/gossip/service/eventer.go:82 +0x5f7  unit-tests_1  |   github.com/hyperledger/fabric/core/peer.createChain.func1()  unit-tests_1  |       github.com/hyperledger/fabric/core/peer/_test/_obj_test/peer.go:342 +0x228  unit-tests_1  |   github.com/hyperledger/fabric/common/resourcesconfig.(*BundleSource).Update()  unit-tests_1  |       /opt/gopath/src/github.com/hyperledger/fabric/common/resourcesconfig/bundlesource.go:43 +0xa8  unit-tests_1  |   github.com/hyperledger/fabric/common/resourcesconfig.NewBundleSource()  unit-tests_1  |       /opt/gopath/src/github.com/hyperledger/fabric/common/resourcesconfig/bundlesource.go:35 +0xeb  unit-tests_1  |   github.com/hyperledger/fabric/core/peer.createChain()  unit-tests_1  |       github.com/hyperledger/fabric/core/peer/_test/_obj_test/peer.go:418 +0x92f  unit-tests_1  |   github.com/hyperledger/fabric/core/peer.CreateChainFromBlock()  unit-tests_1  |       github.com/hyperledger/fabric/core/peer/_test/_obj_test/peer.go:493 +0x232  unit-tests_1  |   github.com/hyperledger/fabric/core/peer.TestCreateChainFromBlock()  unit-tests_1  |       /opt/gopath/src/github.com/hyperledger/fabric/core/peer/peer_test.go:129 +0x65c  unit-tests_1  |   testing.tRunner()  unit-tests_1  |       /opt/go/src/testing/testing.go:746 +0x16c  unit-tests_1  | =================={code}  ></description> </Issue>
