<Action id="69136" issue="44976" author="denyeart" type="comment" created="2020-05-03 19:48:03.0" updateauthor="denyeart" updated="2020-05-03 19:48:03.0"> <body><! CDATA  ~KoushKilla  You're right, the validation codes should be the same across all peers, even after rebuild.  Please upload the peer logs so that we can see what the invalidation code is.  BTW, I am not able to reproduce... the transactions in my blocks are always valid.  ></body> </Action>
<Action id="69168" issue="44976" author="JIRAUSER20127" type="comment" created="2020-05-06 16:09:48.0" updateauthor="JIRAUSER20127" updated="2020-05-06 16:09:48.0"> <body><! CDATA Hi,     Thank you for taking a look at the ticket and getting back to me. After more careful examination I only see this type of error for only certain blocks. For an example my channel has 4 blocks, where as blocks 1,2,4 are synchronized with the other peers however block 3 is invalid after rebuilding the container with out disk-mounting on the peer, and what’s more weird is that when I rebuild the exact same peer container the second time then block 3 changes from invalid to valid? Any thoughts?     Below are the peer logs after I join the channel again,     Below are logs of peer0 (peer after it got rebuild the first time)    {code:java} 2020-05-06 15:51:00.630 UTC  nodeCmd  serve -> INFO 001 Starting peer: Version: 1.4.4 Commit SHA: 7917a40 Go version: go1.12.12 OS/Arch: linux/amd64 Chaincode:   Base Image Version: 0.4.18   Base Docker Namespace: hyperledger   Base Docker Label: org.hyperledger.fabric   Docker Namespace: hyperledger 2020-05-06 15:51:00.631 UTC  ledgermgmt  initialize -> INFO 002 Initializing ledger mgmt 2020-05-06 15:51:00.631 UTC  kvledger  NewProvider -> INFO 003 Initializing ledger provider 2020-05-06 15:51:00.677 UTC  kvledger  NewProvider -> INFO 004 ledger provider Initialized 2020-05-06 15:51:00.730 UTC  couchdb  handleRequest -> WARN 005 Retrying couchdb request in 125ms. Attempt:1  Error:Get http://couchdbOrg1Peer0:5984/: dial tcp 172.21.0.9:5984: connect: connection refused 2020-05-06 15:51:00.859 UTC  couchdb  handleRequest -> WARN 006 Retrying couchdb request in 250ms. Attempt:2  Error:Get http://couchdbOrg1Peer0:5984/: dial tcp 172.21.0.9:5984: connect: connection refused 2020-05-06 15:51:01.111 UTC  couchdb  handleRequest -> WARN 007 Retrying couchdb request in 500ms. Attempt:3  Error:Get http://couchdbOrg1Peer0:5984/: dial tcp 172.21.0.9:5984: connect: connection refused 2020-05-06 15:51:01.614 UTC  couchdb  handleRequest -> WARN 008 Retrying couchdb request in 1s. Attempt:4  Error:Get http://couchdbOrg1Peer0:5984/: dial tcp 172.21.0.9:5984: connect: connection refused 2020-05-06 15:51:02.803 UTC  couchdb  CreateDatabaseIfNotExist -> INFO 009 Created state database _users 2020-05-06 15:51:02.849 UTC  couchdb  CreateDatabaseIfNotExist -> INFO 00a Created state database _replicator 2020-05-06 15:51:02.850 UTC  ledgermgmt  initialize -> INFO 00b ledger mgmt initialized 2020-05-06 15:51:02.850 UTC  peer  func1 -> INFO 00c Auto-detected peer address: 172.21.0.14:7051 2020-05-06 15:51:02.851 UTC  peer  func1 -> INFO 00d Returning peer0.org1.example.com:7051 2020-05-06 15:51:02.851 UTC  peer  func1 -> INFO 00e Auto-detected peer address: 172.21.0.14:7051 2020-05-06 15:51:02.851 UTC  peer  func1 -> INFO 00f Returning peer0.org1.example.com:7051 2020-05-06 15:51:02.853 UTC  nodeCmd  computeChaincodeEndpoint -> INFO 010 Entering computeChaincodeEndpoint with peerHostname: peer0.org1.example.com 2020-05-06 15:51:02.854 UTC  nodeCmd  computeChaincodeEndpoint -> INFO 011 Exit with ccEndpoint: peer0.org1.example.com:7052 2020-05-06 15:51:02.854 UTC  nodeCmd  createChaincodeServer -> WARN 012 peer.chaincodeListenAddress is not set, using peer0.org1.example.com:7052 2020-05-06 15:51:02.858 UTC  sccapi  registerSysCC -> INFO 013 system chaincode lscc(github.com/hyperledger/fabric/core/scc/lscc) registered 2020-05-06 15:51:02.858 UTC  sccapi  registerSysCC -> INFO 014 system chaincode cscc(github.com/hyperledger/fabric/core/scc/cscc) registered 2020-05-06 15:51:02.858 UTC  sccapi  registerSysCC -> INFO 015 system chaincode qscc(github.com/hyperledger/fabric/core/scc/qscc) registered 2020-05-06 15:51:02.858 UTC  sccapi  registerSysCC -> INFO 016 system chaincode (+lifecycle,github.com/hyperledger/fabric/core/chaincode/lifecycle,true) disabled 2020-05-06 15:51:02.862 UTC  gossip.service  func1 -> INFO 017 Initialize gossip with endpoint peer0.org1.example.com:7051 and bootstrap set  127.0.0.1:7051  2020-05-06 15:51:02.867 UTC  gossip.gossip  NewGossipService -> INFO 018 Creating gossip service with self membership of Endpoint: , InternalEndpoint: peer0.org1.example.com:7051, PKI-ID: 3b47bbbd2b69d7ef9e04af52a09463a705f05de72ddcc656c31a8da2ccb2ae65, Metadata:  2020-05-06 15:51:02.868 UTC  gossip.gossip  NewGossipService -> WARN 019 External endpoint is empty, peer will not be accessible outside of its organization 2020-05-06 15:51:02.868 UTC  gossip.gossip  start -> INFO 01a Gossip instance peer0.org1.example.com:7051 started 2020-05-06 15:51:02.869 UTC  sccapi  deploySysCC -> INFO 01b system chaincode lscc/(github.com/hyperledger/fabric/core/scc/lscc) deployed 2020-05-06 15:51:02.869 UTC  cscc  Init -> INFO 01c Init CSCC 2020-05-06 15:51:02.869 UTC  sccapi  deploySysCC -> INFO 01d system chaincode cscc/(github.com/hyperledger/fabric/core/scc/cscc) deployed 2020-05-06 15:51:02.869 UTC  qscc  Init -> INFO 01e Init QSCC 2020-05-06 15:51:02.869 UTC  sccapi  deploySysCC -> INFO 01f system chaincode qscc/(github.com/hyperledger/fabric/core/scc/qscc) deployed 2020-05-06 15:51:02.869 UTC  sccapi  deploySysCC -> INFO 020 system chaincode (+lifecycle,github.com/hyperledger/fabric/core/chaincode/lifecycle) disabled 2020-05-06 15:51:02.869 UTC  nodeCmd  serve -> INFO 021 Deployed system chaincodes 2020-05-06 15:51:02.871 UTC  discovery  NewService -> INFO 022 Created with config TLS: false, authCacheMaxSize: 1000, authCachePurgeRatio: 0.750000 2020-05-06 15:51:02.871 UTC  nodeCmd  registerDiscoveryService -> INFO 023 Discovery service activated 2020-05-06 15:51:02.871 UTC  nodeCmd  serve -> INFO 024 Starting peer with ID= name:"peer0.org1.example.com"  , network ID= dev , address= peer0.org1.example.com:7051  2020-05-06 15:51:02.871 UTC  nodeCmd  serve -> INFO 025 Started peer with ID= name:"peer0.org1.example.com"  , network ID= dev , address= peer0.org1.example.com:7051  2020-05-06 15:51:02.871 UTC  kvledger  LoadPreResetHeight -> INFO 026 Loading prereset height from path  /var/hyperledger/production/ledgersData/chains  2020-05-06 15:51:02.871 UTC  fsblkstorage  LoadPreResetHeight -> INFO 027 Loading Pre-reset heights 2020-05-06 15:51:02.872 UTC  fsblkstorage  preRestHtFiles -> INFO 028 Dir  /var/hyperledger/production/ledgersData/chains/chains  missing... exiting 2020-05-06 15:51:02.872 UTC  fsblkstorage  LoadPreResetHeight -> INFO 029 Pre-reset heights loaded 2020-05-06 15:51:13.987 UTC  endorser  callChaincode -> INFO 02a    a16d4e30  Entry chaincode: name:"cscc"  2020-05-06 15:51:13.988 UTC  endorser  callChaincode -> INFO 02b    a16d4e30  Exit chaincode: name:"cscc"  (1ms) 2020-05-06 15:51:13.988 UTC  comm.grpc.server  1 -> INFO 02c unary call completed grpc.service=protos.Endorser grpc.method=ProcessProposal grpc.peer_address=172.21.0.15:44656 grpc.code=OK grpc.call_duration=1.4193ms 2020-05-06 15:51:33.324 UTC  endorser  callChaincode -> INFO 02d    7615ef6f  Entry chaincode: name:"cscc"  2020-05-06 15:51:33.325 UTC  ledgermgmt  CreateLedger -> INFO 02e Creating ledger  allarewelcome  with genesis block 2020-05-06 15:51:33.327 UTC  fsblkstorage  newBlockfileMgr -> INFO 02f Getting block information from block storage 2020-05-06 15:51:33.368 UTC  couchdb  CreateDatabaseIfNotExist -> INFO 030 Created state database allarewelcome_ 2020-05-06 15:51:33.453 UTC  kvledger  CommitWithPvtData -> INFO 031  allarewelcome  Committed block  0  with 1 transaction(s) in 84ms (state_validation=0ms block_and_pvtdata_commit=7ms state_commit=74ms) commitHash=   2020-05-06 15:51:33.457 UTC  ledgermgmt  CreateLedger -> INFO 032 Created ledger  allarewelcome  with genesis block 2020-05-06 15:51:33.471 UTC  gossip.gossip  JoinChan -> INFO 033 Joining gossip network of channel allarewelcome with 1 organizations 2020-05-06 15:51:33.471 UTC  gossip.gossip  learnAnchorPeers -> INFO 034 No configured anchor peers of Org1MSP for channel allarewelcome to learn about 2020-05-06 15:51:33.483 UTC  gossip.state  NewGossipStateProvider -> INFO 035 Updating metadata information for channel allarewelcome, current ledger sequence is at = 0, next expected block is = 1 2020-05-06 15:51:33.484 UTC  sccapi  deploySysCC -> INFO 036 system chaincode lscc/allarewelcome(github.com/hyperledger/fabric/core/scc/lscc) deployed 2020-05-06 15:51:33.485 UTC  cscc  Init -> INFO 037 Init CSCC 2020-05-06 15:51:33.485 UTC  sccapi  deploySysCC -> INFO 038 system chaincode cscc/allarewelcome(github.com/hyperledger/fabric/core/scc/cscc) deployed 2020-05-06 15:51:33.485 UTC  qscc  Init -> INFO 039 Init QSCC 2020-05-06 15:51:33.485 UTC  sccapi  deploySysCC -> INFO 03a system chaincode qscc/allarewelcome(github.com/hyperledger/fabric/core/scc/qscc) deployed 2020-05-06 15:51:33.485 UTC  sccapi  deploySysCC -> INFO 03b system chaincode (+lifecycle,github.com/hyperledger/fabric/core/chaincode/lifecycle) disabled 2020-05-06 15:51:33.485 UTC  endorser  callChaincode -> INFO 03c    7615ef6f  Exit chaincode: name:"cscc"  (161ms) 2020-05-06 15:51:33.485 UTC  comm.grpc.server  1 -> INFO 03d unary call completed grpc.service=protos.Endorser grpc.method=ProcessProposal grpc.peer_address=172.21.0.15:44658 grpc.code=OK grpc.call_duration=161.6937ms 2020-05-06 15:51:39.485 UTC  gossip.election  beLeader -> INFO 03e 3b47bbbd2b69d7ef9e04af52a09463a705f05de72ddcc656c31a8da2ccb2ae65 : Becoming a leader 2020-05-06 15:51:39.485 UTC  gossip.service  func1 -> INFO 03f Elected as a leader, starting delivery service for channel allarewelcome 2020-05-06 15:51:39.486 UTC  deliveryClient  StartDeliverForChannel -> INFO 040 This peer will retrieve blocks from ordering service and disseminate to other peers in the organization for channel allarewelcome 2020-05-06 15:51:39.490 UTC  deliveryClient  RequestBlocks -> INFO 041 Starting deliver with block  1  for channel allarewelcome 2020-05-06 15:51:39.503 UTC  gossip.privdata  StoreBlock -> INFO 042  allarewelcome  Received block  1  from buffer 2020-05-06 15:51:39.540 UTC  couchdb  CreateDatabaseIfNotExist -> INFO 043 Created state database allarewelcome_lscc 2020-05-06 15:51:39.543 UTC  committer.txvalidator  Validate -> INFO 044  allarewelcome  Validated block  1  in 40ms 2020-05-06 15:51:39.547 UTC  cceventmgmt  HandleStateUpdates -> INFO 045 Channel  allarewelcome : Handling deploy or update of chaincode  ccForAll  2020-05-06 15:51:39.551 UTC  ccprovider  ExtractStatedbArtifactsForChaincode -> INFO 046 Error while loading installation package for ccname=ccForAll, ccversion=1.0. Err=open /var/hyperledger/production/chaincodes/ccForAll.1.0: no such file or directory 2020-05-06 15:51:39.551 UTC  cceventmgmt  HandleChaincodeDeploy -> INFO 047 Channel  allarewelcome : Chaincode  Name=ccForAll, Version=1.0, Hash=  byte{0x58, 0xde, 0x21, 0xe4, 0x23, 0x9c, 0x80, 0x81, 0xda, 0x8, 0xf0, 0xdc, 0x64, 0xe0, 0xef, 0xab, 0xe9, 0x3d, 0x7a, 0x1a, 0x54, 0x6b, 0xa8, 0x38, 0xe2, 0xd8, 0x9f, 0x3c, 0x59, 0xc9, 0x23, 0x1c}  is not installed hence no need to create chaincode artifacts for endorsement 2020-05-06 15:51:39.606 UTC  couchdb  CreateDatabaseIfNotExist -> INFO 048 Created state database allarewelcome_cc$for$all 2020-05-06 15:51:39.635 UTC  kvledger  CommitWithPvtData -> INFO 049  allarewelcome  Committed block  1  with 1 transaction(s) in 91ms (state_validation=13ms block_and_pvtdata_commit=4ms state_commit=71ms) commitHash= 244455f9439383ac0a929bf016883802da7643e650e7627a01dc156d11e56649  2020-05-06 15:51:39.635 UTC  gossip.privdata  StoreBlock -> INFO 04a  allarewelcome  Received block  2  from buffer 2020-05-06 15:51:39.637 UTC  gossip.gossip  JoinChan -> INFO 04b Joining gossip network of channel allarewelcome with 1 organizations 2020-05-06 15:51:39.638 UTC  gossip.gossip  learnAnchorPeers -> INFO 04c Learning about the configured anchor peers of Org1MSP for channel allarewelcome :  {peer1.org1.example.com 7051}  2020-05-06 15:51:39.638 UTC  committer.txvalidator  Validate -> INFO 04d  allarewelcome  Validated block  2  in 2ms 2020-05-06 15:51:39.673 UTC  kvledger  CommitWithPvtData -> INFO 04e  allarewelcome  Committed block  2  with 1 transaction(s) in 34ms (state_validation=0ms block_and_pvtdata_commit=7ms state_commit=24ms) commitHash= 455df3f5ca1462a0194834cf294078ea88ac251253dc1a366c4352f46754853f  2020-05-06 15:51:39.674 UTC  gossip.privdata  StoreBlock -> INFO 04f  allarewelcome  Received block  3  from buffer 2020-05-06 15:51:39.680 UTC  committer.txvalidator  validateTx -> INFO 050 Find chaincode upgrade transaction for chaincode ccForAll on channel allarewelcome with new version 1.1 2020-05-06 15:51:39.680 UTC  committer.txvalidator  Validate -> INFO 051  allarewelcome  Validated block  3  in 5ms 2020-05-06 15:51:39.683 UTC  cceventmgmt  HandleStateUpdates -> INFO 052 Channel  allarewelcome : Handling deploy or update of chaincode  ccForAll  2020-05-06 15:51:39.686 UTC  ccprovider  ExtractStatedbArtifactsForChaincode -> INFO 053 Error while loading installation package for ccname=ccForAll, ccversion=1.1. Err=open /var/hyperledger/production/chaincodes/ccForAll.1.1: no such file or directory 2020-05-06 15:51:39.686 UTC  cceventmgmt  HandleChaincodeDeploy -> INFO 054 Channel  allarewelcome : Chaincode  Name=ccForAll, Version=1.1, Hash=  byte{0x74, 0xef, 0x24, 0x4b, 0x4f, 0x1b, 0xd2, 0xbd, 0x23, 0x7f, 0x1e, 0x48, 0x33, 0x69, 0x8c, 0xfc, 0xa, 0xa3, 0xfb, 0x16, 0x4e, 0x2b, 0x88, 0xca, 0xfc, 0x84, 0xc2, 0x1a, 0xc2, 0xa2, 0x25, 0x88}  is not installed hence no need to create chaincode artifacts for endorsement 2020-05-06 15:51:39.732 UTC  kvledger  CommitWithPvtData -> INFO 055  allarewelcome  Committed block  3  with 1 transaction(s) in 51ms (state_validation=15ms block_and_pvtdata_commit=6ms state_commit=27ms) commitHash= d07ee45a070def67c28c26077caa70c571b59ad298fa09c318eea805321e3c77  2020-05-06 15:51:39.732 UTC  gossip.privdata  StoreBlock -> INFO 056  allarewelcome  Received block  4  from buffer 2020-05-06 15:51:39.733 UTC  cauthdsl  deduplicate -> WARN 057 De-duplicating identity  Org1MSP8664ada90efcda4d1aef62de4c834c7a3749ea2402bf069bc71304c89f61a800  at index 1 in signature set 2020-05-06 15:51:39.735 UTC  gossip.gossip  JoinChan -> INFO 058 Joining gossip network of channel allarewelcome with 2 organizations 2020-05-06 15:51:39.735 UTC  gossip.gossip  learnAnchorPeers -> INFO 059 No configured anchor peers of Org2MSP for channel allarewelcome to learn about 2020-05-06 15:51:39.735 UTC  gossip.gossip  learnAnchorPeers -> INFO 05a Learning about the configured anchor peers of Org1MSP for channel allarewelcome :  {peer1.org1.example.com 7051}  2020-05-06 15:51:39.736 UTC  committer.txvalidator  Validate -> INFO 05b  allarewelcome  Validated block  4  in 3ms 2020-05-06 15:51:39.740 UTC  gossip.comm  func1 -> WARN 05c peer1.org1.example.com:7051, PKIid:dbabc5ef1a0ceb099052e7c31a96a9fb05ab6f0b8d9fe57601e79622eb18d5b0 isn't responsive: EOF 2020-05-06 15:51:39.740 UTC  gossip.discovery  expireDeadMembers -> WARN 05d Entering  dbabc5ef1a0ceb099052e7c31a96a9fb05ab6f0b8d9fe57601e79622eb18d5b0  2020-05-06 15:51:39.741 UTC  gossip.discovery  expireDeadMembers -> WARN 05e Closing connection to Endpoint: , InternalEndpoint: peer1.org1.example.com:7051, PKI-ID: dbabc5ef1a0ceb099052e7c31a96a9fb05ab6f0b8d9fe57601e79622eb18d5b0, Metadata:  2020-05-06 15:51:39.741 UTC  gossip.discovery  expireDeadMembers -> WARN 05f Exiting 2020-05-06 15:51:39.764 UTC  kvledger  CommitWithPvtData -> INFO 060  allarewelcome  Committed block  4  with 1 transaction(s) in 28ms (state_validation=0ms block_and_pvtdata_commit=7ms state_commit=18ms) commitHash= b89e4b6e0d72c6265021ec25e7f61e47c8d9a29843079f54d905127ec025f91b  2020-05-06 15:51:42.706 UTC  comm.grpc.server  1 -> INFO 061 unary call completed grpc.service=gossip.Gossip grpc.method=Ping grpc.request_deadline=2020-05-06T15:51:44.706Z grpc.peer_address=172.21.0.12:43494 grpc.code=OK grpc.call_duration=70.4µs 2020-05-06 15:51:48.438 UTC  gossip.channel  reportMembershipChanges -> INFO 062 Membership view has changed. peers went online:     peer1.org1.example.com:7051   , current view:     peer1.org1.example.com:7051   2020-05-06 15:51:49.475 UTC  gossip.election  stopBeingLeader -> INFO 063 3b47bbbd2b69d7ef9e04af52a09463a705f05de72ddcc656c31a8da2ccb2ae65 Stopped being a leader 2020-05-06 15:51:49.475 UTC  gossip.service  func1 -> INFO 064 Renounced leadership, stopping delivery service for channel allarewelcome 2020-05-06 15:51:49.476 UTC  deliveryClient  try -> WARN 065 Got error: rpc error: code = Unavailable desc = transport is closing , at 1 attempt. Retrying in 1s 2020-05-06 15:51:49.476 UTC  blocksProvider  DeliverBlocks -> WARN 066  allarewelcome  Receive error: client is closing 2020-05-06 15:51:53.437 UTC  gossip.channel  reportMembershipChanges -> INFO 067 Membership view has changed. peers went online:     peer2.org1.example.com:7051   , current view:     peer1.org1.example.com:7051    peer2.org1.example.com:7051   {code}    ></body> </Action>
<Action id="69554" issue="44976" author="denyeart" type="comment" body=" ~KoushKilla  Are you still seeing the problem? What I meant in my prior request, was please attach both logs, one log showing valid status, and one log showing invalid status. The single log above does not show any invalidations." created="2020-06-25 10:48:17.0" updateauthor="denyeart" updated="2020-06-25 10:48:17.0"/>
<Action id="69562" issue="44976" author="JIRAUSER20127" type="comment" created="2020-06-25 20:37:16.0" updateauthor="JIRAUSER20127" updated="2020-06-25 20:37:16.0"> <body><! CDATA HI David,   Thanks for the response. Here is the transaction validation code for the block number #3, it changes from valid to invalid once I disable disk mounting and rebuild the container hence the peer gets kicked out of the channel. I fetch the block again after I rejoin the channel, and as shown below block #3 now states that it is invalid.      ~```shell~  Current hash: aa3778ca0cb72396f258b94348994ccfb607ac7888e7b98d5a43895866105258  Previous hash: b13842990bd59ffffc82a6fa3a0f69575b026b25b4cc4c2ffee65a4565a02a54  Transaction 0 status: VALID  ~```~  ```shell  Current hash: aa3778ca0cb72396f258b94348994ccfb607ac7888e7b98d5a43895866105258  Previous hash: b13842990bd59ffffc82a6fa3a0f69575b026b25b4cc4c2ffee65a4565a02a54  Transaction 0 status: ENDORSEMENT_POLICY_FAILURE   ```     ></body> </Action>
<Action id="70735" issue="44976" author="manish-sethi" type="comment" created="2020-11-18 15:03:49.0" updateauthor="manish-sethi" updated="2020-11-18 15:09:43.0"> <body><! CDATA  ~KoushKilla  - From whatever you have mentioned, it appears to me that when you rebuild the peer, you did not explicitly dropped the couchdb. As a result, you may have been rebuilding the peer with existing couchdb (that is already populated by the previous peer). In this situation, what you are observing is expected. Specially, for the chaincode upgrade transaction in block-3, that your logs show.   Anyhow, I have opened a Jira (FAB-18347) to add this check at the peer start.  However, if this is not the case, we will need the logs from the peer where the unexpectedly transactions are being marked as invalid.  ></body> </Action>
<Action id="70773" issue="44976" author="JIRAUSER20205" type="comment" created="2020-11-20 12:22:42.0" updateauthor="JIRAUSER20205" updated="2020-11-20 12:22:42.0"> <body><! CDATA Hi Manish,  Thank you for the response. Not sure whether the couchdb was dropped during the rebuild activity. We will redo the steps and check whether the issue reproduced when the couchdb is dropped before the rebuild. Will share the update and logs if it reproduces.  Thanks.  ></body> </Action>
<Action id="70784" issue="44976" author="manish-sethi" type="comment" body=" ~ddhulla  - Thanks. Closing this for now and please feel free to open again if you get more info that indicates that this is a real issue." created="2020-11-23 14:18:54.0" updateauthor="manish-sethi" updated="2020-11-23 14:18:54.0"/>
