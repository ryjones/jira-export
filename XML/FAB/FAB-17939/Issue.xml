<Issue id="45149" key="FAB-17939" number="17939" project="10002" reporter="senthil1" assignee="senthil1" creator="senthil1" type="10004" summary="open ended range query results in an infinite loop" priority="2" resolution="10000" status="6" created="2020-05-28 15:11:55.0" updated="2020-05-29 05:41:47.0" resolutiondate="2020-05-29 05:41:47.0" votes="0" watches="1" workflowId="59059" archived="N"> <description><! CDATA We use a single scanner for achieving both paginated and non-paginated range query.  We have internalQueryLimit and pageSize.  For each _all_docs?startKey="XXX"&endKey="YYY" REST API call to CouchDB, we fetch atmost internalQueryLimit number of records only by appending limit=internalQueryLimit.  When the requested pageSize is higher than the internalQueryLimit or the total number of records present in the given range is higher than the internalQueryLimit, iterator would execute the query again once the records fetched in the first cycle are consumed and so on. In order to do that, after execution of the REST API in each cycle, the iterator updates the initially passed startKey to the nextStartKey. If there is no nextStartKey, it is set to the endKey.  Currently, when the nextStartKey and the endKey are the same, we still run one REST API call which is actually not needed as we always set inclusive_end=false. However, this causes infinite loop in a particular case. When we want to retrieve all the records, the user would submit an open-ended query by pass an empty string as the startKey and the endKey. When the startKey is an empty string, the REST API call would become _all_docs?endKey="YYY". When both are empty, it would become _all_docs  Given that we set the startKey to the endKey when there is no nextStartKey and still execute one REST API call, it gets into infinite loop by fetching all records again and again.  ></description> </Issue>
