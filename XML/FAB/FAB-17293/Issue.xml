<Issue id="43789" key="FAB-17293" number="17293" project="10002" reporter="luckyrobinson" assignee="manish-sethi" creator="luckyrobinson" type="10004" summary="synchronize problem of  blockfile and pvtdata" priority="3" resolution="10000" status="6" created="2019-12-21 01:57:57.0" updated="2020-02-15 18:55:41.0" resolutiondate="2020-02-15 18:55:41.0" votes="0" watches="3" workflowId="57642"> <description><! CDATA fabric version release-1.4,  in function func (mgr *blockfileMgr) addBlock(block *common.Block) , as code follows,  //save the index in the database if err = mgr.index.indexBlock(&blockIdxInfo{ blockNum: block.Header.Number, blockHash: blockHash, flp: blockFLP, txOffsets: txOffsets, metadata: block.Metadata}); err != nil {      return err }  if write indexdatabase failed, code just return error message, but not use the function like mgr.currentFileWriter.truncateFile to rollback the blockfile.  in the function func (s *Store) CommitWithPvtData(blockAndPvtdata *ledger.BlockAndPvtData) , as code follows,  if err := s.AddBlock(blockAndPvtdata.Block); err != nil { s.pvtdataStore.Rollback() return err }  when err is not nil, the function s.pvtdataStore.Rollback() delete the pendingCommitKey from the pvtdatabase, but not delete the pvtdata inserted into the database in function Prepare.  if now the fabric system meets the coredump for some reason like power failure. restarting the fabric will meets the error as height not equals of blockfile and pvtdatabase     ></description> </Issue>
