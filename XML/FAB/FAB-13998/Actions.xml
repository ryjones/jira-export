<Action id="56416" issue="37317" author="sae imson" type="comment" created="2019-01-31 01:51:29.0" updateauthor="sae imson" updated="2019-01-31 01:51:29.0"> <body><! CDATA *if you need full logfile to analyze and resolve this issue, let me know.*  *log1  user : tcr2of3_7k_Firm1Org-User000004 create two token balances : krxgld320001, curusd320001.*  *after balance create invoke, queried normally*   2019-01-29 15:04:53.261  http-nio-8806-exec-164  INFO c.k.b.f.s.MemberService - get Instance channelName = krxgldcurusd  2019-01-29 15:04:53.264  http-nio-8806-exec-260  INFO c.k.b.f.s.FabricApplication - User Name = tcr2of3_7k_Firm6Org-User000035  2019-01-29 15:04:53.264  http-nio-8806-exec-260  INFO c.k.b.f.s.FabricApplication - user create mode  2019-01-29 15:04:53.264  http-nio-8806-exec-338  INFO c.k.b.f.s.FabricApplication - interval on  2019-01-29 15:04:53.264  http-nio-8806-exec-338  INFO c.k.b.f.s.FabricApplication - randomNumber : 1  2019-01-29 15:04:53.264  http-nio-8806-exec-338  INFO c.k.b.f.s.FabricApplication - Start FabricMemberService  2019-01-29 15:04:53.264  http-nio-8806-exec-338  INFO c.k.b.f.s.FabricApplication - Parameter setting  2019-01-29 15:04:53.264  http-nio-8806-exec-338  INFO c.k.b.f.s.FabricApplication - initMember start  2019-01-29 15:04:53.264  http-nio-8806-exec-338  INFO c.k.b.f.s.MemberService - get Instance channelName = krxgldcurusd  2019-01-29 15:04:53.264  http-nio-8806-exec-338  INFO c.k.b.f.s.MemberService - Memberservice init  2019-01-29 15:04:53.266  http-nio-8806-exec-299  INFO c.k.b.f.s.FabricApplication - Result Code : 1  2019-01-29 15:04:53.266  http-nio-8806-exec-299  INFO c.k.b.f.s.FabricApplication - Result Message : success  2019-01-29 15:04:53.266  http-nio-8806-exec-299  INFO c.k.b.f.s.FabricApplication - Result Data : {color:#FF0000}{"object":"wallet","address":"0x494b376a415c3335ec83d30109fe1388df119d00","token":"curusd320001","orgId":"Firm3OrgMSP","qty":1000000000,"lockQty":0,"requiredNumOfKeysForSig":3,"totalNumOfKeysForSig":4,"withdrawDayLimit":10000,{color}"owner":"-----BEGIN PUBLIC KEY-----\nMFkwEwYHKoZIzj0CAQYIKoZIzj0DAQcDQgAEEStvRipSvfLuJ3TZfQmHhkv3QSUT\nJxmFFl3A9uZ2/a2bwZ9RnPCJSquzTM7+vEfNwt0E4qaPvGbMYwktG6urYA==\n-----END PUBLIC KEY-----","coOwners":\{"-----BEGIN PUBLIC KEY-----\nMFkwEwYHKoZIzj0CAQYIKoZIzj0DAQcDQgAEEStvRipSvfLuJ3TZfQmHhkv3QSUT\nJxmFFl3A9uZ2/a2bwZ9RnPCJSquzTM7+vEfNwt0E4qaPvGbMYwktG6urYA==\n-----END PUBLIC KEY-----":"","-----BEGIN PUBLIC KEY-----\nMFkwEwYHKoZIzj0CAQYIKoZIzj0DAQcDQgAEe+4BW/SRujPfwKypO8uNtccM/hYX\nvfkppr9zjtKI0NK2NFOlUUISSHisxJ72XtfW7HlE+UJKqjLg+apJRO/LnA==\n-----END PUBLIC KEY-----":"","-----BEGIN PUBLIC KEY-----\nMFkwEwYHKoZIzj0CAQYIKoZIzj0DAQcDQgAEvsSz8AqJjeMTvLfW8bhPnbtkyzI1\nMPSWGvqnrtVHnQdNModxaqzY4c4EEutVtwkXKlNyz5jUTE4XBvSnLfMrOA==\n-----END PUBLIC KEY-----":""}}{color:#FF0000}{"object":"wallet","address":"0x494b376a415c3335ec83d30109fe1388df119d00","token":"krxgld320001","orgId":"Firm3OrgMSP","qty":1000000000,"lockQty":0,"requiredNumOfKeysForSig":3,"totalNumOfKeysForSig":4,"withdrawDayLimit":10000,{color}"owner":"-----BEGIN PUBLIC KEY-----\nMFkwEwYHKoZIzj0CAQYIKoZIzj0DAQcDQgAEEStvRipSvfLuJ3TZfQmHhkv3QSUT\nJxmFFl3A9uZ2/a2bwZ9RnPCJSquzTM7+vEfNwt0E4qaPvGbMYwktG6urYA==\n-----END PUBLIC KEY-----","coOwners":\{"-----BEGIN PUBLIC KEY-----\nMFkwEwYHKoZIzj0CAQYIKoZIzj0DAQcDQgAEEStvRipSvfLuJ3TZfQmHhkv3QSUT\nJxmFFl3A9uZ2/a2bwZ9RnPCJSquzTM7+vEfNwt0E4qaPvGbMYwktG6urYA==\n-----END PUBLIC KEY-----":"","-----BEGIN PUBLIC KEY-----\nMFkwEwYHKoZIzj0CAQYIKoZIzj0DAQcDQgAEe+4BW/SRujPfwKypO8uNtccM/hYX\nvfkppr9zjtKI0NK2NFOlUUISSHisxJ72XtfW7HlE+UJKqjLg+apJRO/LnA==\n-----END PUBLIC KEY-----":"","-----BEGIN PUBLIC KEY-----\nMFkwEwYHKoZIzj0CAQYIKoZIzj0DAQcDQgAEvsSz8AqJjeMTvLfW8bhPnbtkyzI1\nMPSWGvqnrtVHnQdNModxaqzY4c4EEutVtwkXKlNyz5jUTE4XBvSnLfMrOA==\n-----END PUBLIC KEY-----":""}}  2019-01-29 15:04:53.266  http-nio-8806-exec-299  INFO c.k.b.f.s.FabricApplication - tcr2of3_7k_Firm3Org-User000045,krxgldcurusd,tw720,query,queryAccount,-----BEGIN PUBLIC KEY-----@MFkwEwYHKoZIzj0CAQYIKoZIzj0DAQcDQgAETrqC1lXFMFXVgiPtQKOhjSH/Hjf7@UxjD87DgTwU6IVV2rWIWNwRRtdZbPktbUAJ0Htzzh+by4HslXjtX9UG96A==@-----END PUBLIC KEY-----,DECKEY^WjAiUE5jR97kmA5fpIbo47A4cfmrnLrG^IV^Vu5uKS1JKIK4G6un  2019-01-29 15:04:53.266  http-nio-8806-exec-299  INFO c.k.b.f.s.FabricApplication - -----BEGIN PUBLIC KEY-----@MFkwEwYHKoZIzj0CAQYIKoZIzj0DAQcDQgAETrqC1lXFMFXVgiPtQKOhjSH/Hjf7@UxjD87DgTwU6IVV2rWIWNwRRtdZbPktbUAJ0Htzzh+by4HslXjtX9UG96A==@-----END PUBLIC KEY-----  2019-01-29 15:04:53.266  http-nio-8806-exec-299  INFO c.k.b.f.s.FabricApplication - -----BEGIN PUBLIC KEY-----     *log2  during balance change invoke, 'curusd3200001' balance is vanished and getstate returned error.*   2019-01-30 10:15:33.661  http-nio-8806-exec-2  INFO c.k.b.f.s.MemberService - << start Invoke >>{color:#FF0000} chaincode : tw720, invFnc : lockOrderVol, param :  krxgld320001, 1, 0000000001, -----BEGIN PUBLIC KEY-----{color} MFkwEwYHKoZIzj0CAQYIKoZIzj0DAQcDQgAEtqLr5DSRcHazfIs8V77suotyamJq USal9hERwIFvuYxWKqH6N6kvTk+LoWbytuiLZfeCUtd35K+YFN3XtJN5Cw== -----END PUBLIC KEY-----, MEQCIFVTLNy5XiJvU39Lm0k4CxJziHVIqp2FyFZ8so08nn/oAiBBm4B10XaACz6M2fvK5MFa2NUOoWP5Zg+kgPVNlkagiQ==, -----BEGIN PUBLIC KEY----- MFkwEwYHKoZIzj0CAQYIKoZIzj0DAQcDQgAEe+4BW/SRujPfwKypO8uNtccM/hYX vfkppr9zjtKI0NK2NFOlUUISSHisxJ72XtfW7HlE+UJKqjLg+apJRO/LnA== -----END PUBLIC KEY-----, MEQCIA0Yd9B+z5SFGG7HeBtPITZAC9yKREYtQkFFtw8mMPt7AiAbdawE8m1SqPToQrTcRPvgCN/u9fdx0x/CjqFn1LN1nQ==, -----BEGIN PUBLIC KEY----- MFkwEwYHKoZIzj0CAQYIKoZIzj0DAQcDQgAEvsSz8AqJjeMTvLfW8bhPnbtkyzI1 MPSWGvqnrtVHnQdNModxaqzY4c4EEutVtwkXKlNyz5jUTE4XBvSnLfMrOA== -----END PUBLIC KEY-----, MEUCIQDOSKlanZi8+3hJP4ztQ2Crn8245K+ygErflu4uEZztqQIgA2A+Q+MsqH1N5hz2uMwbxV065t2jz76vASYm2tVBFHM=   2019-01-30 10:15:33.661  http-nio-8806-exec-2  INFO c.k.b.f.s.MemberService - Start Time of 'Send Transaction Proposal': 2019-01-30 10:15:33.661  2019-01-30 10:15:33.661  http-nio-8806-exec-2  INFO c.k.b.f.s.MemberService - user mspid : KrxOrgMSP  2019-01-30 10:15:33.782  http-nio-8806-exec-2  INFO c.k.b.f.s.MemberService - send proposal peer(ENDORSING_PEER) : krxpeer01  2019-01-30 10:15:33.782  http-nio-8806-exec-2  INFO c.k.b.f.s.MemberService - send proposal peer(ENDORSING_PEER) : bank1peer01  2019-01-30 10:15:33.782  http-nio-8806-exec-2  INFO c.k.b.f.s.MemberService - send proposal peer(ENDORSING_PEER) : issuerpeer01  2019-01-30 10:15:33.782  http-nio-8806-exec-2  INFO c.k.b.f.s.MemberService -{color:#FF0000} Successful transaction proposal response Txid: fb35cc4ae1fe7c1269786612135accae148cc6e15ffc834b4052c8565b65ba34 from peer krxpeer01{color}  2019-01-30 10:15:33.782  http-nio-8806-exec-2  INFO c.k.b.f.s.MemberService - Successful transaction proposal response Txid: fb35cc4ae1fe7c1269786612135accae148cc6e15ffc834b4052c8565b65ba34 from peer bank1peer01  2019-01-30 10:15:33.782  http-nio-8806-exec-2  INFO c.k.b.f.s.MemberService - Successful transaction proposal response Txid: fb35cc4ae1fe7c1269786612135accae148cc6e15ffc834b4052c8565b65ba34 from peer issuerpeer01  =======================================================================================================  2019-01-30 10:15:33.849  http-nio-8806-exec-2  INFO c.k.b.f.s.MemberService - << start Invoke >>{color:#FF0000} chaincode : tw720, invFnc : lockOrderVol, param :  curusd320001, 1, 0000000001, -----BEGIN PUBLIC KEY-----{color} MFkwEwYHKoZIzj0CAQYIKoZIzj0DAQcDQgAEtqLr5DSRcHazfIs8V77suotyamJq USal9hERwIFvuYxWKqH6N6kvTk+LoWbytuiLZfeCUtd35K+YFN3XtJN5Cw== -----END PUBLIC KEY-----, MEUCIQCmkv7Xr1caTpqkHU+bPczsU/lC+ulPNknDWXdpQ6YKxQIgRv3CdnXALN5QemGeV8GsERa2UBFr0SJNKp2tQf2IKKI=, -----BEGIN PUBLIC KEY----- MFkwEwYHKoZIzj0CAQYIKoZIzj0DAQcDQgAEe+4BW/SRujPfwKypO8uNtccM/hYX vfkppr9zjtKI0NK2NFOlUUISSHisxJ72XtfW7HlE+UJKqjLg+apJRO/LnA== -----END PUBLIC KEY-----, MEUCIQDt4M9EVbcW5wMU1D5qTYgEqJwxsa4V9tHSsulBR3E2egIgBVWCmokHs0plyVpWGxx3hfWdbCiYPD5UlUIk1tFEMbw=, -----BEGIN PUBLIC KEY----- MFkwEwYHKoZIzj0CAQYIKoZIzj0DAQcDQgAEvsSz8AqJjeMTvLfW8bhPnbtkyzI1 MPSWGvqnrtVHnQdNModxaqzY4c4EEutVtwkXKlNyz5jUTE4XBvSnLfMrOA== -----END PUBLIC KEY-----, MEQCIG1f9RSCgHFONJ4qXmywD8LFp2lgVenmk0h0r5EG2xiaAiAsUZgzgGKPgPK9B2IBFIlHqRjYXixFwl+SLsNvG9x9eg==   2019-01-30 10:15:33.849  http-nio-8806-exec-2  INFO c.k.b.f.s.MemberService - Start Time of 'Send Transaction Proposal': 2019-01-30 10:15:33.849  2019-01-30 10:15:33.849  http-nio-8806-exec-2  INFO c.k.b.f.s.MemberService - user mspid : KrxOrgMSP  2019-01-30 10:15:33.861  http-nio-8806-exec-2  INFO c.k.b.f.s.MemberService - send proposal peer(ENDORSING_PEER) : krxpeer01  2019-01-30 10:15:33.862  http-nio-8806-exec-2  INFO c.k.b.f.s.MemberService - send proposal peer(ENDORSING_PEER) : bank1peer01  2019-01-30 10:15:33.862  http-nio-8806-exec-2  INFO c.k.b.f.s.MemberService - send proposal peer(ENDORSING_PEER) : issuerpeer01  2019-01-30 10:15:33.862  http-nio-8806-exec-2  INFO c.k.b.f.s.MemberService - Unsuccessful transaction proposal response Txid: fa970ffefb5fd1c2f66a910d3c54d9c6806557fe6515a11b52215251723d572b from peer krxpeer01Chaincode result message :{color:#FF0000} \{"Error":"address does not exist: 0x00b8677f4527712b081ba1f5bb7d3c075ff1cc00"}{color}  2019-01-30 10:15:33.862  http-nio-8806-exec-2  INFO c.k.b.f.s.MemberService - Unsuccessful transaction proposal response Txid: fa970ffefb5fd1c2f66a910d3c54d9c6806557fe6515a11b52215251723d572b from peer bank1peer01Chaincode result message : \{"Error":"address does not exist: 0x00b8677f4527712b081ba1f5bb7d3c075ff1cc00"}  2019-01-30 10:15:33.862  http-nio-8806-exec-2  INFO c.k.b.f.s.MemberService - Unsuccessful transaction proposal response Txid: fa970ffefb5fd1c2f66a910d3c54d9c6806557fe6515a11b52215251723d572b from peer issuerpeer01Chaincode result message : \{"Error":"address does not exist: 0x00b8677f4527712b081ba1f5bb7d3c075ff1cc00"}  2019-01-30 10:15:33.862  http-nio-8806-exec-2  INFO c.k.b.f.s.MemberService - Not enough endorsers for invoke : 3     ></body> </Action>
<Action id="56615" issue="37317" author="denyeart" type="comment" created="2019-02-03 17:34:49.0" updateauthor="denyeart" updated="2019-02-03 17:34:49.0"> <body><! CDATA Are there any ERRO or WARN messages in peer logs?  Please provide a sample collection configuration.  Explain what is meant by "pvtdata commit was not working properly".  Explain what is meant by "data in collection are disappear randomly". Can you query the private data on one peer but not another peer? What error do you get when attempting to query the private data?           ></body> </Action>
<Action id="56782" issue="37317" author="sae imson" type="comment" created="2019-02-08 01:35:42.0" updateauthor="sae imson" updated="2019-02-08 01:35:56.0"> <body><! CDATA +Are there any ERRO or WARN messages in peer logs?+ : I have checked whether transactions are committed successfullly with "commitwithpvtdata" phrase in a peer log or not. what I mean by "pvtdata commit was not working properly" is that, - commitwithpvtdata took quite a long time (it was "stress test") - mvcc error showed up in a log even though a peer was configured by "1tx/1block" - so, transactions are marked as "invalid"  +Please provide a sample collection configuration.+ : I attached collection definition file.  ^collections_config.json   +Explain what is meant by "data in collection are disappear randomly". Can you query the private data on one peer but not another peer? What error do you get when attempting to query the private data?+ : the chanincode developed has 4 main functions. 1) createAccount : with address and token name as a key, token balance is created.  2) lockOrderVol : by order, certain amount of targeted token balance is marked as "locked" 3) reflectTrade : locked quantity will be transfered to trade counterparty  4) queryAccount : with address and token name, created account(token balance) can be queried.  at the stage of createAccount, account was created and queried successfully. but after many times of lockordervol transaction, endorser peer returned error "address(account) does not found" and when I queried that address by queryAccount, getstate returned nil.  I switched other endorser peers to query but same result was returned.  ></body> </Action>
<Action id="56832" issue="37317" author="denyeart" type="comment" body=" ~sae imSon  The presence of MVCC errors is likely the root cause. Even if you have one transaction per block, you can receive MVCC errors if there are conflicts between transactions before they are committed. For example you attempt to endorse a key read/write when another endorsement of the same key has just occurred but is not yet committed to peers (it may be in the process of being submitted to ordering, being processed by orderers, or being processed by peers but not yet committed). These types of errors are common in stress tests if you are updating the same key in subsequent transactions in quick succession." created="2019-02-11 04:17:39.0" updateauthor="denyeart" updated="2019-02-11 04:17:39.0"/>
<Action id="56836" issue="37317" author="sae imson" type="comment" created="2019-02-11 09:26:41.0" updateauthor="sae imson" updated="2019-02-11 09:26:41.0"> <body><! CDATA to avoid key collision(mvcc error) - we created many users(key) per channel. - batch block configured by 1tx/1block(batch timeout 2s)  we injected transactions through 10 application servers which was run on fabric java sdk(version 1.2.1) one application server was designated to one channel. so, it was not a case of "updating same key in quick succession" and in this case we don't have to consider giving sleep time between transactions.  (we ran stress test with sleep time from 0 to 15 ms, still got the error)  ></body> </Action>
<Action id="56842" issue="37317" author="denyeart" type="comment" body=" ~sae imSon  You mentioned you see some MVCC errors. By definition, this means you have some conflicting transactions. I suggest you start with low volume, look at the debug logs, and determine where the MVCC conflicts are coming from." created="2019-02-11 13:06:07.0" updateauthor="denyeart" updated="2019-02-11 13:06:07.0"/>
<Action id="67599" issue="37317" author="sykesm" type="comment" body="Stale" created="2020-01-22 22:34:12.0" updateauthor="sykesm" updated="2020-01-22 22:34:12.0"/>
