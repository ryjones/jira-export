<Issue id="41397" key="FAB-16065" number="16065" project="10002" reporter="rameshthoomu" creator="rameshthoomu" type="10101" summary="Couchdb index with rich queries, multi indexes, and then upgrade chaincode" priority="3" resolution="10001" status="6" created="2019-07-24 18:25:06.0" updated="2021-01-10 17:34:43.0" resolutiondate="2021-01-10 17:34:43.0" votes="0" watches="3" workflowId="54425"> <description><! CDATA Requires index files to be mounted in peers before start. After large number of transactions already on the ledger (e.g. 100,000 or more), upgrade cc version and restart the peers. Requires new operator function to upgrade chaincode version (with or without a new cc file) and new steps in the driver file or test input file to do it. Requires marbles02(private) or other complex chaincode.  Helpful snippet from PTE/Readme: {quote}If installing chaincode on CouchDB with indexing, then inside the deploy section we should also add metadataPath for the location of the index definition files. Note: if gopath is defined in the service credential json, then specify the relative path from $GOPATH/src/ (as is done in this example); otherwise use a fully specified absolute path.   {code:java} "deploy": { "chaincodePath": "github.com/hyperledger/fabric-test/fabric-samples/chaincode/marbles02/go", "metadataPath": "github.com/hyperledger/fabric-test/fabric-samples/chaincode/marbles02/go/META-INF", "fcn": "init", "args":    }, {code}  {quote}  Helpful snippets from PTE/CITest/Readme:  {quote}  FAB-6813-4i: marbles02 GO chaincode, 4 processes X 1000 invokes, TLS, CouchDB with indexing, 2 channel, channel event service with block listener FAB-8251: marbles02 GO chaincode, 4 processes X 250000 invokes, TLS, CouchDB with indexing, 2 channel, channel event service with block listener, simultaneous operation of 1) chaincode upgrade with index rebuild, 2) 4 processes X 250000 rich queries with 2-field selector 3) 4 processes X 250000 invokes FAB-8252: marbles02 GO chaincode, 4 processes X 250000 invokes, TLS, CouchDB with indexing, 2 channel, channel event service with block listener, simultaneous operation of 1) chaincode upgrade with index rebuild, 2) 4 processes X 250000 rich queries with 4-field selector 3) 4 processes X 250000 invokes  marbles02_private chaincode, go in fabric-samples - used by PTE tests; includes a sample ../collections_config.json and ./META_INF/ with couchdb index file indexOwner.json, but note the PTE sideDB tests (FAB-10134, FAB-10135, FAB-12262) store their own collections files (e.g. PTE/CITest/FAB-10135-4i/preconfig/marbles02_private/collections_config-chan1.json) marbles02_private chaincode, go in fabric-test - used only by fabric-test/feature/ Behave tests; includes its own private data collections definition file but no couchdb index file (which is not needed because tests send only a few transactions){quote}  ></description> </Issue>
