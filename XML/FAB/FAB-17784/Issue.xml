<Issue id="44911" key="FAB-17784" number="17784" project="10002" reporter="denyeart" assignee="wlahti" creator="denyeart" type="10004" summary="Legacy chaincode partially installs upon build failure" priority="2" resolution="10000" status="6" created="2020-04-22 22:06:33.0" updated="2020-05-17 08:21:36.0" resolutiondate="2020-05-17 08:21:36.0" votes="0" watches="5" workflowId="58811" archived="N"> <description><! CDATA *1st issue*  When using legacy chaincode to install a chaincode, if the chaincode build on the peer fails, you'll get an error that says the install failed.  However, the chaincode package actually gets installed in the peer's legacy /chaincode directory.  This is both confusing, and makes it difficult to re-attempt the build once the underlying build issue is resolved.  I emulated this problem by configuring my peer to use ccenv:latest2 to build the chaincode, which does not exist. {code:java} $ peer chaincode install -n marbles2 -p github.com/hyperledger/fabric-samples/chaincode/marbles02/go/ -v 1  Error: install failed with status: 500 - could not build chaincode: docker build failed: docker image build failed: docker build failed: Failed to pull hyperledger/fabric-ccenv:latest2: API error (404): manifest for hyperledger/fabric-ccenv:latest2 not found: manifest unknown: manifest unknown  $ peer chaincode list --installed Get installed chaincodes on peer:  Name: marbles2, Version: 1, Path: github.com/hyperledger/fabric-samples/chaincode/marbles02/go/, Id: 1b9ca3ca452c095825fae828bcb1380edca18ced28c4025433c6a349aa2adad4 {code}  The same trial with new lifecycle gives the expected results. The installation fails with a similar error and the chaincode does NOT get installed at all (not in the new /lifecycle/chaincodes directory).     *2nd issue*  However, there is a second issue with new lifecycle. Even when the build issue is resolved (in my case I kept the peer up, tagged ccenv:latest to ccenv:latest2, did not change core.yaml settings), the next installation attempt still fails with the same error message, even though ccenv:latest2 now exists on the peer machine: {code:java}  $ peer lifecycle chaincode install marbles.tar.gz  Error: chaincode install failed with status: 500 - failed to invoke backing implementation of 'InstallChaincode': could not build chaincode: docker build failed: docker image build failed: docker build failed: Failed to pull hyperledger/fabric-ccenv:latest2: API error (404): manifest for hyperledger/fabric-ccenv:latest2 not found: manifest unknown: manifest unknown {code}  When I restart peer and attempt the install yet again, it succeeds.  So it seems the peer caches the fact that the builder image cannot be found, and restarting the peer is required in order for peer to find the newly tagged ccenv:latest2 builder image.  ></description> </Issue>
