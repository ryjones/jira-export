<Action id="40293" issue="27797" author="denyeart" type="comment" body="Chris, I think this would best be handled by additional validation at packaging time." created="2018-02-16 15:51:35.0" updateauthor="denyeart" updated="2018-02-16 15:51:35.0"/>
<Action id="40432" issue="27797" author="chris.elder" type="comment" body="I think this can be handled at two different levels.   One level would be to correct the messaging to indicate if the index is created or updated and include the name of the index and design document.   An additional check can be made during packaging to ensure that two separate but identical indexes are created." created="2018-02-20 18:39:44.0" updateauthor="chris.elder" updated="2018-02-20 18:39:44.0"/>
<Action id="40433" issue="27797" author="chris.elder" type="comment" body="https://gerrit.hyperledger.org/r/#/c/18099/" created="2018-02-20 18:40:20.0" updateauthor="chris.elder" updated="2018-02-20 18:40:20.0"/>
<Action id="40435" issue="27797" author="denyeart" type="comment" body="Ok, after looking at the options, only the logging clarification is containable in 1.1, let&apos;s go with that approach.  The peer log should indicate whether it is creating or updating an index.  This will be helpful for people upgrading chaincode with an existing index in place regardless." created="2018-02-20 18:54:03.0" updateauthor="denyeart" updated="2018-02-20 18:54:03.0"/>
<Action id="40721" issue="27797" author="adnanchoudhury" type="comment" created="2018-02-24 16:03:19.0" updateauthor="adnanchoudhury" updated="2018-02-24 16:03:19.0"> <body><! CDATA Working with images built this morning (Feb 24), for the scenario mentioned in original message, I am seeing the peer log still contains two "created CouchDB index" and *no* "updated CouchDB index" and the only one index exists in CouchDB.     ></body> </Action>
<Action id="40732" issue="27797" author="denyeart" type="comment" created="2018-02-24 18:02:16.0" updateauthor="denyeart" updated="2018-02-24 18:02:16.0"> <body><! CDATA Testing against latest master, I deployed a chaincode that had two index json files, each defining the same index.  In the peer log, I see that the index is created and then updated:   {code:java} 2018-02-24 17:49:42.916 UTC  couchdb  CreateIndex -> INFO 517 Created CouchDB index  indexOwner  in state database  myc_marbles  using design document  _design/indexOwnerDoc   2018-02-24 17:49:42.919 UTC  couchdb  CreateIndex -> INFO 51c Updated CouchDB index  indexOwner  in state database  myc_marbles  using design document  _design/indexOwnerDoc  {code}     ~AdnanChoudhury  could you paste the corresponding lines from your log?  This could be a timing issue where CouchDB does not detect a previously created index for a few milliseconds, we've seen issues like that but determined it was benign after discussing with CouchDB developers.   ></body> </Action>
<Action id="40787" issue="27797" author="denyeart" type="comment" body="Since there is no runtime problem, only logging for an edge case, let&apos;s defer this to 1.2." created="2018-02-26 11:50:19.0" updateauthor="denyeart" updated="2018-02-26 11:50:35.0"/>
<Action id="40858" issue="27797" author="chris.elder" type="comment" created="2018-02-26 19:25:31.0" updateauthor="chris.elder" updated="2018-02-26 19:25:31.0"> <body><! CDATA I duplicated Dave's results with the current build.  The timestamps for create and update of the same index are 3ms apart.  2018-02-26 17:21:37.112 UTC  couchdb  CreateIndex -> INFO 50f Created CouchDB index  indexOwner  in state database  myc_marbles  using design document  _design/indexOwnerDoc   2018-02-26 17:21:37.115 UTC  couchdb  CreateIndex -> INFO 514 Updated CouchDB index  indexOwner  in state database  myc_marbles  using design document  _design/indexOwnerDoc    ~AdnanChoudhury , were the times between the two timestamps in your log closer in time?   If you can post your results here, that would be great.  ></body> </Action>
<Action id="40943" issue="27797" author="adnanchoudhury" type="comment" created="2018-02-27 16:52:22.0" updateauthor="adnanchoudhury" updated="2018-02-27 16:52:22.0"> <body><! CDATA  ~chris.elder  heres the debug level log, in my test the "Created CouchDB index" messages are 12 ms apart. Tested with images built today.      {code:java}   36m2018-02-27 16:40:02.613 UTC  couchdb  CreateIndex -> DEBU 586^  0m Entering CreateIndex()  indexdefinition={"index":{"fields": "docType","owner" },"ddoc":"indexOwnerDoc", "name":"indexOwner","t     ype":"json"} 1516 ^  36m2018-02-27 16:40:02.613 UTC  couchdb  handleRequest -> DEBU 587^  0m Entering handleRequest()  method=POST  url=http://couchdb01:5984/mychannel1_mycc1/_index 1517 ^  36m2018-02-27 16:40:02.614 UTC  couchdb  handleRequest -> DEBU 588^  0m HTTP Request: POST /mychannel1_mycc1/_index HTTP/1.1 | Host: couchdb01:5984 | User-Agent: Go-http-client/1.1 | Content-Lengt     h: 99 | Accept: application/json | Content-Type: application/json | Accept-Encoding: gzip |  | 1518 ^  36m2018-02-27 16:40:02.712 UTC  couchdb  handleRequest -> DEBU 589^  0m Exiting handleRequest() 1519 2018-02-27 16:40:02.712 UTC  couchdb  CreateIndex -> INFO 58a^  0m Created CouchDB index  indexOwner  in state database  mychannel1_mycc1  using design document  _design/indexOwnerDoc  1520 ^  36m2018-02-27 16:40:02.712 UTC  couchdb  CreateIndex -> DEBU 58b^  0m Entering CreateIndex()  indexdefinition={"index":{"fields":  "docType", "owner", "color" }, "ddoc": "indexOwnerDoc", "type": "     json", "name": "indexOwner"} 1521 ^  36m2018-02-27 16:40:02.712 UTC  couchdb  handleRequest -> DEBU 58c^  0m Entering handleRequest()  method=POST  url=http://couchdb01:5984/mychannel1_mycc1/_index 1522 ^  36m2018-02-27 16:40:02.712 UTC  couchdb  handleRequest -> DEBU 58d^  0m HTTP Request: POST /mychannel1_mycc1/_index HTTP/1.1 | Host: couchdb01:5984 | User-Agent: Go-http-client/1.1 | Content-Lengt     h: 115 | Accept: application/json | Content-Type: application/json | Accept-Encoding: gzip |  | 1523 ^  36m2018-02-27 16:40:02.729 UTC  couchdb  handleRequest -> DEBU 58e^  0m Exiting handleRequest() 1524 2018-02-27 16:40:02.729 UTC  couchdb  CreateIndex -> INFO 58f^  0m Created CouchDB index  indexOwner  in state database  mychannel1_mycc1  using design document  _design/indexOwnerDoc    {code}    ></body> </Action>
<Action id="40949" issue="27797" author="denyeart" type="comment" body="To test my theory that this is due to a CouchDB timing issue, copy the index definition 50 times in the package.  I suspect you will see a few Creates and then the rest Updates." created="2018-02-27 17:47:21.0" updateauthor="denyeart" updated="2018-02-27 17:47:21.0"/>
<Action id="40954" issue="27797" author="adnanchoudhury" type="comment" created="2018-02-27 19:21:08.0" updateauthor="adnanchoudhury" updated="2018-02-27 19:21:08.0"> <body><! CDATA  ~denyeart  was doing just that :)  You guessed correct, 3 "Created" and 97 "Updated" for 100 same index definitions.  As the Fabric is dependent on the CouchDB return message, and Fabric log now shows "updated" when Couch says that it was updated, for me this issue is solved/verified.  The small corner case that remains is a CouchDB issue, that may be addressed via CouchDB project if need be.    ></body> </Action>
