<Action id="63060" issue="41681" author="rameshthoomu" type="comment" created="2019-08-19 14:07:54.0" updateauthor="rameshthoomu" updated="2019-08-19 14:07:54.0"> <body><! CDATA I have tested below scenario for 12 hrs in the IKS cluster and it ran successfully. See the below test scenario and results.  Samplecc - Go chaincode - 2 channels with 2 threads and sent invokes for 12 hrs using gen_cfgInputs.sh scripts. See the below command.  ./gen_cfgInputs.sh -d "$ConnProfile" --nchan 2 --chan0 0 --norg 1 --chanprefix testorgschannel --chantxpath "$Chantxpath" -a sample_cc --freq 10 --rundur 43200 --nproc 2 --keystart 100 --targetpeers ORGANCHOR -t move  It ran fro 12 hrs of invokes and sent around 326K transactions.   =======  CONSTANT INVOKE Overall Performance Summary  ======= CONSTANT INVOKE Overall number of PTE: 2 CONSTANT INVOKE Overall processes: 4 CONSTANT INVOKE *Overall transactions: sent 3263181 received 3263181* CONSTANT INVOKE Overall failures: proposal 0 transactions 0 CONSTANT INVOKE Overall event: received 3263181 timeout 0 unreceived 0 CONSTANT INVOKE Overall time: start 1566002361053 end 1566045562693 duration 43201640 CONSTANT INVOKE Overall CONSTANT *INVOKE TPS 75.53*  ></body> </Action>
<Action id="63074" issue="41681" author="scottz" type="comment" created="2019-08-19 22:24:29.0" updateauthor="scottz" updated="2019-08-19 22:24:29.0"> <body><! CDATA  ~rameshthoomu  Since it works in k8s lab, then could it be caused by resource exhaustion on vm in the weekly run? Can you tell from the logs? If not, then how about we tweak the config (eliminate some of the nodes) and reduce the traffic rate from 10 tps to only 1 tps and reduce the payload size. (See below.) Do you think it would be a good test if you submit this change to alter the 12Hr weekly test?  In fabric-test/tools/PTE/CITest/FAB-7204-4i/test_nl.sh change from ./networkLauncher.sh -o 3 -x 2 -r 2 -p 2 -k 4 -z 3 -n 2 -e 3 -t kafka -f test -w localhost -S enabled -c 2s -l INFO -B 500 to ./networkLauncher.sh -o 1 -x 0 -r 2 -p 1 -k 3 -z 1 -n 2 -e 3 -t kafka -f test -w localhost -S enabled -c 2s -l INFO -B 500  and in fabric-test/tools/PTE/CITest/FAB-7204-4i/samplejs/samplejs-chan1-FAB-7204-4i-TLS.json change from "constFreq": "100", to "constFreq": "1000",  and change from "payLoadMin": "1024", "payLoadMax": "2048" to "payLoadMin": "8", "payLoadMax": "256"   ></body> </Action>
<Action id="63133" issue="41681" author="rameshthoomu" type="comment" created="2019-08-21 13:28:37.0" updateauthor="rameshthoomu" updated="2019-08-21 13:28:37.0"> <body><! CDATA  ~scottz  This seems reproducing in community jenkins infra. See below log. After sending 100K transactions, observed Service Unavailable error.  {code:java}  32minfo 39m:  2019-08-19T15:02:37.954Z PTE 0 main : stdout:  32minfo 39m:  2019-08-19T15:02:37.953Z PTE 0 exec :  Nid:chan:org:id=0:testorgschannel1:org2:0 isExecDone  invokes(Move) sent: number=102000, evtTimeoutCnt=0, elapsed time= 11112652   32minfo 39m:  2019-08-19T15:03:54.987Z PTE 0 main : stdout:  32minfo 39m:  2019-08-19T15:03:54.986Z PTE 0 exec :  Nid:chan:org:id=0:testorgschannel1:org2:0 invoke_move_dist_evtBlock  failed to sendTransaction status: {"status":"SERVICE_UNAVAILABLE","info":"cannot enqueue"}  {code}  I will try to duplicate the same test configuration when I try this in k8s lab.   ></body> </Action>
<Action id="63404" issue="41681" author="rameshthoomu" type="comment" body="Executed same test case in k8s environment. I don&apos;t see any error even after sending 1million tx.  ~vijaypunugubati  Could you please provide the system info from jenkins job (df -h and free -m) when you observe this again." created="2019-08-29 16:17:47.0" updateauthor="rameshthoomu" updated="2019-08-29 16:17:47.0"/>
<Action id="63410" issue="41681" author="vijaypunugubati" type="comment" body="Present we don&apos;t have the latest build failed with the above error, last week build was failed with missing image nodeenv to pull from nexus, and the next build info will be available on 2nd september on prod, i will run this job on sandbox now to get the req info." created="2019-08-29 17:54:03.0" updateauthor="vijaypunugubati" updated="2019-08-29 17:54:03.0"/>
<Action id="63435" issue="41681" author="vijaypunugubati" type="comment" created="2019-08-30 14:12:12.0" updateauthor="vijaypunugubati" updated="2019-08-30 14:12:12.0"> <body><! CDATA The "12HrTest.py::TimedRun_12Hr::test_FAB_7204_samplejsCC_2chan_x_2_x_10tps PASSED" was passed yesterday on prod.   https://jenkins.hyperledger.org/view/fabric-test/job/fabric-test-svt-weekly-pte-x86_64/54/console   Â   ></body> </Action>
<Action id="63436" issue="41681" author="scottz" type="comment" created="2019-08-30 14:34:08.0" updateauthor="scottz" updated="2019-08-30 14:34:08.0"> <body><! CDATA No. It failed, even though it claims to have passed "12HrTest.py::TimedRun_12Hr::test_FAB_7204_samplejsCC_2chan_x_2_x_10tps PASSED". Refer to   {{File "/home/jenkins/.local/lib/python2.7/site-packages/lftools/deploy.py", line 293, in deploy_logs 03:56:48     output = subprocess.check_output(c).decode('utf-8') 03:56:48   File "/usr/lib/python2.7/subprocess.py", line 574, in check_output 03:56:48     raise CalledProcessError(retcode, cmd, output=output) 03:56:48 subprocess.CalledProcessError: Command ' 'sar', '-b', '-r', '-n', 'DEV' ' returned non-zero exit status 2 }} and refer to link: https://jenkins.hyperledger.org/view/fabric-test/job/fabric-test-svt-weekly-pte-x86_64/lastSuccessfulBuild/artifact/gopath/src/github.com/hyperledger/fabric-test/tools/PTE/CITest/Logs/FAB-7204-4i-pteReport.log  {{=======  CONSTANT INVOKE Overall Performance Summary  ======= CONSTANT INVOKE Overall number of PTE: 2 CONSTANT INVOKE Overall processes: 4 CONSTANT INVOKE Overall transactions: sent 452999 received 410928 CONSTANT INVOKE Overall *failures: proposal 41932 transactions 2* CONSTANT INVOKE Overall event: received 410928 timeout 0 unreceived 137 CONSTANT INVOKE Overall time: start 1567104855371 end 1567116534623 duration 11679252 CONSTANT INVOKE Overall CONSTANT INVOKE TPS 35.18 CONSTANT INVOKE Overall latency summary CONSTANT INVOKE Overall proposals latency 452999 min 6 ms max 45008 ms avg 294.86 ms CONSTANT INVOKE Overall transactions latency 411067 min 4 ms max 10115 ms avg 19.70 ms CONSTANT INVOKE Overall events latency 410928 min 104 ms max 1107435 ms avg 107430.09 ms CONSTANT INVOKE Overall TEST RESULTS FAILED}}   ></body> </Action>
<Action id="63438" issue="41681" author="scottz" type="comment" created="2019-08-30 14:41:25.0" updateauthor="scottz" updated="2019-08-30 14:41:25.0"> <body><! CDATA It started sending TX at 18:54:15, and got to around 20,000 TX in each of the 4 threads before starting to see the first failures at 19:30:44, then errors stopped for a whild when we got to 30,000 TX... and more later.   ></body> </Action>
<Action id="63439" issue="41681" author="vijaypunugubati" type="comment" created="2019-08-30 14:44:21.0" updateauthor="vijaypunugubati" updated="2019-08-30 14:45:47.0"> <body><! CDATA "subprocess.CalledProcessError: Command ' 'sar', '-b', '-r', '-n', 'DEV' ' returned non-zero exit status 2"  The error is from post-build script after the test passes which maybe python process error because of server down or Internet down.  ></body> </Action>
<Action id="63442" issue="41681" author="scottz" type="comment" created="2019-08-30 15:48:36.0" updateauthor="scottz" updated="2019-08-30 15:48:36.0"> <body><! CDATA That is one explanation for one problem.  That is why the build was marked unstable (yellow instead of blue dot). But the test should not say PASSED because of that line `failures: proposal 41932 transactions 2`. We need to add a check in 12HrTest.py that checks for the string in the output `Overall failures: proposal 0 transactions 0` or else it should fail. I created bug for that:  FAB-16486  So this bug should remain open because there were transaction failures. Note: this time the test encountered the first failures after only 35 minutes instead of the 3+ hours seen previously.  ></body> </Action>
<Action id="63724" issue="41681" author="scottz" type="comment" created="2019-09-12 15:06:48.0" updateauthor="scottz" updated="2019-09-12 15:06:48.0"> <body><! CDATA the fab-16486 solution was merged. you should see failures appropriately identified now in the weekly test suite results.Â   Have we gotten any further understanding why the 12 hour test encounters failures in the CI, despite a similar test passing in k8s environment?  ></body> </Action>
<Action id="63749" issue="41681" author="scottz" type="comment" created="2019-09-13 13:41:13.0" updateauthor="scottz" updated="2019-09-13 13:41:13.0"> <body><! CDATA The retest with FAB-16486 in sandbox last night failed; two-thirds of the transactions were errors, as indicated in console logsÂ  https://jenkins.hyperledger.org/sandbox/view/All/job/fabric-test-svt-weekly-pte-x86_64/5/console Â : *03:26:32* E       AssertionError: Test Failed: INVOKE failures; refer to fabric-test/tools/PTE/CITest/Logs/FAB-7204-4i*.log for details The pteReport.log  https://jenkins.hyperledger.org/sandbox/view/All/job/fabric-test-svt-weekly-pte-x86_64/lastFailedBuild/artifact/gopath/src/github.com/hyperledger/fabric-test/tools/PTE/CITest/Logs/FAB-7204-4i-pteReport.log Â shows: *CONSTANT INVOKE Overall transactions: sent 1293921 received 413351* *CONSTANT INVOKE Overall failures: proposal 866046 transactions 14489* *CONSTANT INVOKE Overall event: received 413351 timeout 0 unreceived 35*  Â  The write failure occurs when dumping out the test stdout to terminal at the end of the test seems to indicate it is unable to write to the stdout terminal anymore: 03:26:32 Â  File "/usr/lib/python2.7/dist-packages/py/_io/terminalwriter.py", line 333, in write_out 03:26:32 Â  Â  fil.write(msg) 03:26:32 IOError:  Errno 11  Resource temporarily unavailable Note: the wordcount on the output is not that high:Â Â 1293Â Â Â Â 7687Â Â 123011 Â  And then after that exits, the job archives the logs and dumps some basic data like "df -h", "free -m", "ipconfig", and encounters another write error: *03:27:45*   File "/usr/lib/python2.7/subprocess.py", line 574, in check_output*03:27:45*     raise CalledProcessError(retcode, cmd, output=output)*03:27:45* subprocess.CalledProcessError: Command ' 'sar', '-b', '-r', '-n', 'DEV' ' returned non-zero exit status 2  ></body> </Action>
<Action id="64666" issue="41681" author="scottz" type="comment" body="This fails most likely due to resource exhaustion. Since we are moving to Azure and to testing this on k8s (where it works), let&apos;s close this." created="2019-10-11 15:39:07.0" updateauthor="scottz" updated="2019-10-11 15:39:07.0"/>
