<Issue id="34682" key="FAB-12465" number="12465" project="10002" reporter="gormand" creator="gormand" type="10001" summary="Allow HostConfig to be set for chaincode build env" priority="2" resolution="10001" status="6" created="2018-10-15 13:10:45.0" updated="2020-01-22 22:32:33.0" resolutiondate="2020-01-22 22:32:33.0" votes="0" watches="4" workflowId="47269"> <description><! CDATA When Fabric builds a docker chaincode container it may need internet access. For example if the chaincode is Node.js or a Composer BNA file an npm install is necessary.  Some provisioning environments require *network mode 'host'* to be set in the docker build container to enable external network connectivity.  We found the following code to create the build container does not set or allow to be set the HostConfig option:  https://github.com/hyperledger/fabric/blob/ce1bd7286ed0c1915dc9020182d8e9ad5a9959de/core/chaincode/platforms/util/utils.go#L144   In our testing we found a simple modification to this function fixed the problem, for example:      *{color:#00875a}hostConfig := docker.HostConfig\{NetworkMode: "host"}{color}*  {color:#00875a}{{//------------------------------------------------------}}{color}  {color:#00875a}{{// Create an ephemeral container, armed with our Env/Cmd }}{color}  {color:#00875a}{{//------------------------------------------------------}}{color}  {color:#00875a}{{ container, err := client.CreateContainer(docker.CreateContainerOptions{}}{color}  {color:#00875a}{{ Config: &docker.Config{}}{{ }}{color}  {color:#00875a}{{Image:        opts.Image,}}{{ }}{color}  {color:#00875a}{{Env:          opts.Env,}}{{ }}{color}  {color:#00875a}{{Cmd:            string\{"/bin/sh", "-c", opts.Cmd},}}{{ }}{color}  {color:#00875a}{{AttachStdout: true,}}{{ }}{color}  {color:#00875a}{{AttachStderr: true, },}}{{ }}{color}  *{color:#00875a}{{HostConfig: &hostConfig,}}{color}*  {color:#00875a}{{ })}}{color}     A more comprehensive solution is probably needed that allows existing env vars to override these parameters and are used in other parts of fabric, for example:  CORE_VM_DOCKER_HOSTCONFIG_NETWORKMODE=host  ></description> </Issue>
