<Issue id="44960" key="FAB-17816" number="17816" project="10002" reporter="JIRAUSER20118" creator="JIRAUSER20118" type="10004" summary="Private data not getting fully synced after upgrading the peers from 1.4.2 to 2.0" priority="5" resolution="10203" status="6" created="2020-04-28 14:24:01.0" updated="2020-04-30 15:11:11.0" resolutiondate="2020-04-30 15:11:11.0" votes="0" watches="2" workflowId="58863" archived="N"> <description><! CDATA We are trying to upgrade our hyperledger fabric setup from 1.4.2 to 2.0. We have a kubernetes setup and has 2 organisation in the channel. We use couchdb for peers. We first upgraded all the orderers and when trying to upgrade the peer to 2.0 we performed "*peer node upgrade-dbs*"  on the peers to bring it up align with 2.0 and deleted "data" folder in couchdb. So first we upgraded peers of one organisation to 2.0 and kept the other Org peers in 1.4.2 hoping the data will get synced. But the issue we are facing here is that we have a chaincode in which we use private data collection both the orgs are part of the same collection but after the upgrade of the peers to 2.0 we couldn't get all the private datas in sync. When looked at the peer logs we found the following when the peer gets started.  " 2020-04-27 09:17:46.004 UTC  lockbasedtxmgr  ValidateAndPrepare -> DEBU 438 Waiting for purge mgr to finish the background job of computing expirying keys for the block 2020-04-27 09:17:46.004 UTC  lockbasedtxmgr  ValidateAndPrepare -> DEBU 439 lock acquired on oldBlockCommit for validating read set version against the committed version 2020-04-27 09:17:46.004 UTC  lockbasedtxmgr  ValidateAndPrepare -> DEBU 43a Validating new block with num trans =  10  2020-04-27 09:17:46.004 UTC  valimpl  ValidateAndPrepareBatch -> DEBU 43b ValidateAndPrepareBatch() for block number =  9  2020-04-27 09:17:46.004 UTC  valimpl  ValidateAndPrepareBatch -> DEBU 43c preprocessing ProtoBlock... 2020-04-27 09:17:46.004 UTC  valimpl  preprocessProtoBlock -> WARN 43d Channel  mychannel : Block  9  Transaction index  0  TxId  be338890fc17dbdc4f684b1ab909032f6c286380fd52babfc260526fe485fd04  marked as invalid by committer. Reason code  MVCC_READ_CONFLICT ".     Please guide me if someone has faced any similar issues while upgrading the fabric network. How can I upgrade the network from 1.4.2 to 2.0 in a kubernetes setup without loosing any private data?  ></description> </Issue>
