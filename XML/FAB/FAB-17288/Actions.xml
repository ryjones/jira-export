<Action id="66334" issue="43776" author="lehors" type="comment" created="2019-12-20 10:47:49.0" updateauthor="lehors" updated="2019-12-20 10:47:49.0"> <body><! CDATA Go test also fails:    {code:java} $ cd core/chaincode/platforms/golang $ go test --- FAIL: Test_gopathDependencyPackageInfo (4.82s) --- FAIL: Test_gopathDependencyPackageInfo/TestPeer (2.96s) list_test.go:23: Error Trace: list_test.go:23 Error: Received unexpected error: invalid character 'U' in string escape code Test: Test_gopathDependencyPackageInfo/TestPeer Messages: failed to get dependencyPackageInfo list_test.go:32: Error Trace: list_test.go:32 Error: Should be true Test: Test_gopathDependencyPackageInfo/TestPeer Messages: expected to find the peer package --- FAIL: Test_listModuleInfo (2.65s) list_test.go:87: Error Trace: list_test.go:87 Error: Received unexpected error: invalid character 'U' in string escape code failed to unmarshal output from 'go list' github.com/hyperledger/fabric/core/chaincode/platforms/golang.listModuleInfo C:/Users/lehors/Projects/Go/src/github.com/hyperledger/fabric/core/chaincode/platforms/golang/list.go:144 github.com/hyperledger/fabric/core/chaincode/platforms/golang.Test_listModuleInfo C:/Users/lehors/Projects/Go/src/github.com/hyperledger/fabric/core/chaincode/platforms/golang/list_test.go:86 testing.tRunner c:/go/src/testing/testing.go:909 runtime.goexit c:/go/src/runtime/asm_amd64.s:1357 Test: Test_listModuleInfo Messages: failed to get module info list_test.go:95: Error Trace: list_test.go:95 Error: Not equal: expected: &golang.ModuleInfo{Dir:"C:\\Users\\lehors\\Projects\\Go\\src\\github.com\\hyperledger\\fabric\\core\\chaincode\\platforms\\golang\\testdata\\ccmodule", ImportPath:"ccmodule", ModulePath:"ccmodule", GoMod:"C:\\Users\\lehors\\Projects\\Go\\src\\github.com\\hyperledger\\fabric\\core\\chaincode\\platforms\\golang\\testdata\\ccmodule\\go.mod"} actual : (*golang.ModuleInfo)(nil) Diff: --- Expected +++ Actual @@ -1,7 +1,2 @@ -(*golang.ModuleInfo)({ - Dir: (string) (len=111) "C:\\Users\\lehors\\Projects\\Go\\src\\github.com\\hyperledger\\fabric\\core\\chaincode\\platforms\\golang\\testdata\\ccmodule", - ImportPath: (string) (len=8) "ccmodule", - ModulePath: (string) (len=8) "ccmodule", - GoMod: (string) (len=118) "C:\\Users\\lehors\\Projects\\Go\\src\\github.com\\hyperledger\\fabric\\core\\chaincode\\platforms\\golang\\testdata\\ccmodule\\go.mod" -}) +(*golang.ModuleInfo)(<nil>) Test: Test_listModuleInfo list_test.go:101: Error Trace: list_test.go:101 Error: Received unexpected error: invalid character 'U' in string escape code failed to unmarshal output from 'go list' github.com/hyperledger/fabric/core/chaincode/platforms/golang.listModuleInfo C:/Users/lehors/Projects/Go/src/github.com/hyperledger/fabric/core/chaincode/platforms/golang/list.go:144 github.com/hyperledger/fabric/core/chaincode/platforms/golang.Test_listModuleInfo C:/Users/lehors/Projects/Go/src/github.com/hyperledger/fabric/core/chaincode/platforms/golang/list_test.go:100 testing.tRunner c:/go/src/testing/testing.go:909 runtime.goexit c:/go/src/runtime/asm_amd64.s:1357 Test: Test_listModuleInfo Messages: failed to get module info list_test.go:109: Error Trace: list_test.go:109 Error: Not equal: expected: &golang.ModuleInfo{Dir:"C:\\Users\\lehors\\Projects\\Go\\src\\github.com\\hyperledger\\fabric\\core\\chaincode\\platforms\\golang\\testdata\\ccmodule", ImportPath:"ccmodule/nested", ModulePath:"ccmodule", GoMod:"C:\\Users\\lehors\\Projects\\Go\\src\\github.com\\hyperledger\\fabric\\core\\chaincode\\platforms\\golang\\testdata\\ccmodule\\go.mod"} actual : (*golang.ModuleInfo)(nil) Diff: --- Expected +++ Actual @@ -1,7 +1,2 @@ -(*golang.ModuleInfo)({ - Dir: (string) (len=111) "C:\\Users\\lehors\\Projects\\Go\\src\\github.com\\hyperledger\\fabric\\core\\chaincode\\platforms\\golang\\testdata\\ccmodule", - ImportPath: (string) (len=15) "ccmodule/nested", - ModulePath: (string) (len=8) "ccmodule", - GoMod: (string) (len=118) "C:\\Users\\lehors\\Projects\\Go\\src\\github.com\\hyperledger\\fabric\\core\\chaincode\\platforms\\golang\\testdata\\ccmodule\\go.mod" -}) +(*golang.ModuleInfo)(<nil>) Test: Test_listModuleInfo --- FAIL: TestNormalizePath (2.14s) --- FAIL: TestNormalizePath/1 (1.72s) platform_test.go:110: Error Trace: platform_test.go:110 Error: Received unexpected error: invalid character 'U' in string escape code failed to unmarshal output from 'go list' github.com/hyperledger/fabric/core/chaincode/platforms/golang.listModuleInfo C:/Users/lehors/Projects/Go/src/github.com/hyperledger/fabric/core/chaincode/platforms/golang/list.go:144 github.com/hyperledger/fabric/core/chaincode/platforms/golang.moduleInfo C:/Users/lehors/Projects/Go/src/github.com/hyperledger/fabric/core/chaincode/platforms/golang/platform.go:344 github.com/hyperledger/fabric/core/chaincode/platforms/golang.(*Platform).NormalizePath C:/Users/lehors/Projects/Go/src/github.com/hyperledger/fabric/core/chaincode/platforms/golang/platform.go:58 github.com/hyperledger/fabric/core/chaincode/platforms/golang.TestNormalizePath.func1 C:/Users/lehors/Projects/Go/src/github.com/hyperledger/fabric/core/chaincode/platforms/golang/platform_test.go:109 testing.tRunner c:/go/src/testing/testing.go:909 runtime.goexit c:/go/src/runtime/asm_amd64.s:1357 Test: TestNormalizePath/1 Messages: normalize path failed platform_test.go:111: Error Trace: platform_test.go:111 Error: Not equal: expected: "ccmodule" actual : "" Diff: --- Expected +++ Actual @@ -1 +1 @@ -ccmodule + Test: TestNormalizePath/1 Messages: want result ccmodule got --- FAIL: Test_findSource (0.05s) --- FAIL: Test_findSource/Gopath (0.03s) require.go:794: Error Trace: platform_test.go:178 Error: Received unexpected error: metadata file path must begin with META-INF/statedb, found: META-INF\statedb\couchdb\indexes\ walk failed github.com/hyperledger/fabric/core/chaincode/platforms/golang.findSource C:/Users/lehors/Projects/Go/src/github.com/hyperledger/fabric/core/chaincode/platforms/golang/platform.go:450 github.com/hyperledger/fabric/core/chaincode/platforms/golang.Test_findSource.func1 C:/Users/lehors/Projects/Go/src/github.com/hyperledger/fabric/core/chaincode/platforms/golang/platform_test.go:173 testing.tRunner c:/go/src/testing/testing.go:909 runtime.goexit c:/go/src/runtime/asm_amd64.s:1357 Test: Test_findSource/Gopath Messages: failed to find source --- FAIL: Test_findSource/Module (0.02s) require.go:794: Error Trace: platform_test.go:191 Error: Received unexpected error: metadata file path must begin with META-INF/statedb, found: META-INF\statedb\couchdb\indexes\ walk failed github.com/hyperledger/fabric/core/chaincode/platforms/golang.findSource C:/Users/lehors/Projects/Go/src/github.com/hyperledger/fabric/core/chaincode/platforms/golang/platform.go:450 github.com/hyperledger/fabric/core/chaincode/platforms/golang.Test_findSource.func2 C:/Users/lehors/Projects/Go/src/github.com/hyperledger/fabric/core/chaincode/platforms/golang/platform_test.go:185 testing.tRunner c:/go/src/testing/testing.go:909 runtime.goexit c:/go/src/runtime/asm_amd64.s:1357 Test: Test_findSource/Module Messages: failed to find source --- FAIL: Test_findSource/NonExistent (0.00s) platform_test.go:205: Error Trace: platform_test.go:205 Error: "walk failed: Lstat : The system cannot find the path specified." does not contain "no such file or directory" Test: Test_findSource/NonExistent --- FAIL: TestGopathDeploymentPayload (0.92s) platform_test.go:236: Error Trace: platform_test.go:236 Error: Received unexpected error: metadata file path must begin with META-INF/statedb, found: META-INF\statedb\couchdb\indexes\ walk failed github.com/hyperledger/fabric/core/chaincode/platforms/golang.findSource C:/Users/lehors/Projects/Go/src/github.com/hyperledger/fabric/core/chaincode/platforms/golang/platform.go:450 github.com/hyperledger/fabric/core/chaincode/platforms/golang.(*Platform).GetDeploymentPayload C:/Users/lehors/Projects/Go/src/github.com/hyperledger/fabric/core/chaincode/platforms/golang/platform.go:121 github.com/hyperledger/fabric/core/chaincode/platforms/golang.TestGopathDeploymentPayload C:/Users/lehors/Projects/Go/src/github.com/hyperledger/fabric/core/chaincode/platforms/golang/platform_test.go:235 testing.tRunner c:/go/src/testing/testing.go:909 runtime.goexit c:/go/src/runtime/asm_amd64.s:1357 Test: TestGopathDeploymentPayload require.go:794: Error Trace: platform_test.go:214 platform_test.go:238 Error: Received unexpected error: EOF Test: TestGopathDeploymentPayload Messages: failed to create new gzip reader --- FAIL: TestModuleDeploymentPayload (3.57s) --- FAIL: TestModuleDeploymentPayload/TopLevel (1.76s) platform_test.go:247: Error Trace: platform_test.go:247 Error: Received unexpected error: invalid character 'U' in string escape code failed to unmarshal output from 'go list' github.com/hyperledger/fabric/core/chaincode/platforms/golang.listModuleInfo C:/Users/lehors/Projects/Go/src/github.com/hyperledger/fabric/core/chaincode/platforms/golang/list.go:144 github.com/hyperledger/fabric/core/chaincode/platforms/golang.moduleInfo C:/Users/lehors/Projects/Go/src/github.com/hyperledger/fabric/core/chaincode/platforms/golang/platform.go:344 github.com/hyperledger/fabric/core/chaincode/platforms/golang.DescribeCode C:/Users/lehors/Projects/Go/src/github.com/hyperledger/fabric/core/chaincode/platforms/golang/platform.go:261 github.com/hyperledger/fabric/core/chaincode/platforms/golang.(*Platform).GetDeploymentPayload C:/Users/lehors/Projects/Go/src/github.com/hyperledger/fabric/core/chaincode/platforms/golang/platform.go:116 github.com/hyperledger/fabric/core/chaincode/platforms/golang.TestModuleDeploymentPayload.func1 C:/Users/lehors/Projects/Go/src/github.com/hyperledger/fabric/core/chaincode/platforms/golang/platform_test.go:246 testing.tRunner c:/go/src/testing/testing.go:909 runtime.goexit c:/go/src/runtime/asm_amd64.s:1357 Test: TestModuleDeploymentPayload/TopLevel require.go:794: Error Trace: platform_test.go:214 platform_test.go:248 Error: Received unexpected error: EOF Test: TestModuleDeploymentPayload/TopLevel Messages: failed to create new gzip reader --- FAIL: TestModuleDeploymentPayload/NestedPackage (1.81s) platform_test.go:262: Error Trace: platform_test.go:262 Error: Received unexpected error: invalid character 'U' in string escape code failed to unmarshal output from 'go list' github.com/hyperledger/fabric/core/chaincode/platforms/golang.listModuleInfo C:/Users/lehors/Projects/Go/src/github.com/hyperledger/fabric/core/chaincode/platforms/golang/list.go:144 github.com/hyperledger/fabric/core/chaincode/platforms/golang.moduleInfo C:/Users/lehors/Projects/Go/src/github.com/hyperledger/fabric/core/chaincode/platforms/golang/platform.go:344 github.com/hyperledger/fabric/core/chaincode/platforms/golang.DescribeCode C:/Users/lehors/Projects/Go/src/github.com/hyperledger/fabric/core/chaincode/platforms/golang/platform.go:261 github.com/hyperledger/fabric/core/chaincode/platforms/golang.(*Platform).GetDeploymentPayload C:/Users/lehors/Projects/Go/src/github.com/hyperledger/fabric/core/chaincode/platforms/golang/platform.go:116 github.com/hyperledger/fabric/core/chaincode/platforms/golang.TestModuleDeploymentPayload.func2 C:/Users/lehors/Projects/Go/src/github.com/hyperledger/fabric/core/chaincode/platforms/golang/platform_test.go:261 testing.tRunner c:/go/src/testing/testing.go:909 runtime.goexit c:/go/src/runtime/asm_amd64.s:1357 Test: TestModuleDeploymentPayload/NestedPackage require.go:794: Error Trace: platform_test.go:214 platform_test.go:263 Error: Received unexpected error: EOF Test: TestModuleDeploymentPayload/NestedPackage Messages: failed to create new gzip reader --- FAIL: TestGetDeploymentPayload (9.01s) platform_test.go:320: Error Trace: platform_test.go:320 Error: Received unexpected error: metadata file path must begin with META-INF/statedb, found: META-INF\statedb\couchdb\indexes\ walk failed github.com/hyperledger/fabric/core/chaincode/platforms/golang.findSource C:/Users/lehors/Projects/Go/src/github.com/hyperledger/fabric/core/chaincode/platforms/golang/platform.go:450 github.com/hyperledger/fabric/core/chaincode/platforms/golang.(*Platform).GetDeploymentPayload C:/Users/lehors/Projects/Go/src/github.com/hyperledger/fabric/core/chaincode/platforms/golang/platform.go:121 github.com/hyperledger/fabric/core/chaincode/platforms/golang.TestGetDeploymentPayload C:/Users/lehors/Projects/Go/src/github.com/hyperledger/fabric/core/chaincode/platforms/golang/platform_test.go:318 testing.tRunner c:/go/src/testing/testing.go:909 runtime.goexit c:/go/src/runtime/asm_amd64.s:1357 Test: TestGetDeploymentPayload Messages: expected success for path: github.com/hyperledger/fabric/core/chaincode/platforms/golang/testdata/src/chaincodes/noop platform_test.go:320: Error Trace: platform_test.go:320 Error: Received unexpected error: invalid character 'U' in string escape code Test: TestGetDeploymentPayload Messages: expected success for path: github.com/hyperledger/fabric/core/chaincode/platforms/golang/testdata/src/chaincodes/BadMetadataIgnoreHiddenFile platform_test.go:320: Error Trace: platform_test.go:320 Error: Received unexpected error: invalid character 'U' in string escape code failed to unmarshal output from 'go list' github.com/hyperledger/fabric/core/chaincode/platforms/golang.listModuleInfo C:/Users/lehors/Projects/Go/src/github.com/hyperledger/fabric/core/chaincode/platforms/golang/list.go:144 github.com/hyperledger/fabric/core/chaincode/platforms/golang.moduleInfo C:/Users/lehors/Projects/Go/src/github.com/hyperledger/fabric/core/chaincode/platforms/golang/platform.go:344 github.com/hyperledger/fabric/core/chaincode/platforms/golang.DescribeCode C:/Users/lehors/Projects/Go/src/github.com/hyperledger/fabric/core/chaincode/platforms/golang/platform.go:261 github.com/hyperledger/fabric/core/chaincode/platforms/golang.(*Platform).GetDeploymentPayload C:/Users/lehors/Projects/Go/src/github.com/hyperledger/fabric/core/chaincode/platforms/golang/platform.go:116 github.com/hyperledger/fabric/core/chaincode/platforms/golang.TestGetDeploymentPayload C:/Users/lehors/Projects/Go/src/github.com/hyperledger/fabric/core/chaincode/platforms/golang/platform_test.go:318 testing.tRunner c:/go/src/testing/testing.go:909 runtime.goexit c:/go/src/runtime/asm_amd64.s:1357 Test: TestGetDeploymentPayload Messages: expected success for path: testdata/ccmodule --- FAIL: TestDescribeCode (3.45s) --- FAIL: TestDescribeCode/TopLevelModulePackage (1.73s) platform_test.go:435: Error Trace: platform_test.go:435 Error: Received unexpected error: invalid character 'U' in string escape code failed to unmarshal output from 'go list' github.com/hyperledger/fabric/core/chaincode/platforms/golang.listModuleInfo C:/Users/lehors/Projects/Go/src/github.com/hyperledger/fabric/core/chaincode/platforms/golang/list.go:144 github.com/hyperledger/fabric/core/chaincode/platforms/golang.moduleInfo C:/Users/lehors/Projects/Go/src/github.com/hyperledger/fabric/core/chaincode/platforms/golang/platform.go:344 github.com/hyperledger/fabric/core/chaincode/platforms/golang.DescribeCode C:/Users/lehors/Projects/Go/src/github.com/hyperledger/fabric/core/chaincode/platforms/golang/platform.go:261 github.com/hyperledger/fabric/core/chaincode/platforms/golang.TestDescribeCode.func1 C:/Users/lehors/Projects/Go/src/github.com/hyperledger/fabric/core/chaincode/platforms/golang/platform_test.go:434 testing.tRunner c:/go/src/testing/testing.go:909 runtime.goexit c:/go/src/runtime/asm_amd64.s:1357 Test: TestDescribeCode/TopLevelModulePackage platform_test.go:442: Error Trace: platform_test.go:442 Error: Not equal: expected: &golang.CodeDescriptor{Source:"C:\\Users\\lehors\\Projects\\Go\\src\\github.com\\hyperledger\\fabric\\core\\chaincode\\platforms\\golang\\testdata\\ccmodule", MetadataRoot:"C:\\Users\\lehors\\Projects\\Go\\src\\github.com\\hyperledger\\fabric\\core\\chaincode\\platforms\\golang\\testdata\\ccmodule\\META-INF", Path:"ccmodule", Module:true} actual : (*golang.CodeDescriptor)(nil) Diff: --- Expected +++ Actual @@ -1,7 +1,2 @@ -(*golang.CodeDescriptor)({ - Source: (string) (len=111) "C:\\Users\\lehors\\Projects\\Go\\src\\github.com\\hyperledger\\fabric\\core\\chaincode\\platforms\\golang\\testdata\\ccmodule", - MetadataRoot: (string) (len=120) "C:\\Users\\lehors\\Projects\\Go\\src\\github.com\\hyperledger\\fabric\\core\\chaincode\\platforms\\golang\\testdata\\ccmodule\\META-INF", - Path: (string) (len=8) "ccmodule", - Module: (bool) true -}) +(*golang.CodeDescriptor)(<nil>) Test: TestDescribeCode/TopLevelModulePackage --- FAIL: TestDescribeCode/NestedModulePackage (1.72s) platform_test.go:447: Error Trace: platform_test.go:447 Error: Received unexpected error: invalid character 'U' in string escape code failed to unmarshal output from 'go list' github.com/hyperledger/fabric/core/chaincode/platforms/golang.listModuleInfo C:/Users/lehors/Projects/Go/src/github.com/hyperledger/fabric/core/chaincode/platforms/golang/list.go:144 github.com/hyperledger/fabric/core/chaincode/platforms/golang.moduleInfo C:/Users/lehors/Projects/Go/src/github.com/hyperledger/fabric/core/chaincode/platforms/golang/platform.go:344 github.com/hyperledger/fabric/core/chaincode/platforms/golang.DescribeCode C:/Users/lehors/Projects/Go/src/github.com/hyperledger/fabric/core/chaincode/platforms/golang/platform.go:261 github.com/hyperledger/fabric/core/chaincode/platforms/golang.TestDescribeCode.func2 C:/Users/lehors/Projects/Go/src/github.com/hyperledger/fabric/core/chaincode/platforms/golang/platform_test.go:446 testing.tRunner c:/go/src/testing/testing.go:909 runtime.goexit c:/go/src/runtime/asm_amd64.s:1357 Test: TestDescribeCode/NestedModulePackage platform_test.go:454: Error Trace: platform_test.go:454 Error: Not equal: expected: &golang.CodeDescriptor{Source:"C:\\Users\\lehors\\Projects\\Go\\src\\github.com\\hyperledger\\fabric\\core\\chaincode\\platforms\\golang\\testdata\\ccmodule", MetadataRoot:"C:\\Users\\lehors\\Projects\\Go\\src\\github.com\\hyperledger\\fabric\\core\\chaincode\\platforms\\golang\\testdata\\ccmodule\\nested\\META-INF", Path:"ccmodule/nested", Module:true} actual : (*golang.CodeDescriptor)(nil) Diff: --- Expected +++ Actual @@ -1,7 +1,2 @@ -(*golang.CodeDescriptor)({ - Source: (string) (len=111) "C:\\Users\\lehors\\Projects\\Go\\src\\github.com\\hyperledger\\fabric\\core\\chaincode\\platforms\\golang\\testdata\\ccmodule", - MetadataRoot: (string) (len=127) "C:\\Users\\lehors\\Projects\\Go\\src\\github.com\\hyperledger\\fabric\\core\\chaincode\\platforms\\golang\\testdata\\ccmodule\\nested\\META-INF", - Path: (string) (len=15) "ccmodule/nested", - Module: (bool) true -}) +(*golang.CodeDescriptor)(<nil>) Test: TestDescribeCode/NestedModulePackage FAIL exit status 1 FAIL github.com/hyperledger/fabric/core/chaincode/platforms/golang 32.245s {code}    ></body> </Action>
<Action id="66367" issue="43776" author="lehors" type="comment" created="2019-12-20 18:30:24.0" updateauthor="lehors" updated="2019-12-20 18:30:24.0"> <body><! CDATA It's worth noting that although the code path is different the same is true for all cc languages: go, node/javascript, and java. Indeed, while the command succeeds to produce a tarball for node and java, the tar file contains filepaths with backslashes that makes it unsuitable for chaincode install.     ></body> </Action>
<Action id="66445" issue="43776" author="gigamuse" type="comment" created="2020-01-02 03:33:55.0" updateauthor="gigamuse" updated="2020-01-02 03:33:55.0"> <body><! CDATA Same results as above except for 'h' character instead of 'U':  failed to unmarshal output from 'go list': invalid character 'h' in string escape code  ></body> </Action>
<Action id="66452" issue="43776" author="lehors" type="comment" created="2020-01-02 16:55:58.0" updateauthor="lehors" updated="2020-01-02 16:55:58.0"> <body><! CDATA  ~Gigamuse , I submitted a PR to fix this, if you could test it and confirm that it works for you that'd be great!  https://github.com/hyperledger/fabric/pull/440  ></body> </Action>
<Action id="66458" issue="43776" author="gigamuse" type="comment" body="Having no previous experience in using github (although a member for a while), I have spent considerable time getting my head around what to actually do to incorporate and test your changes. I have read your changes and those by sykesm in each file, noted the name of each and can understand the code. Can&apos;t find these files nor how to get them using git commands. Tried a few but may have inadvertently &apos;committed&apos; some files. My sincere apologies about this but would love to test the changes! I do want to learn and use &apos;fabric&apos; as it seems to have all the potential requirements for the network I am building (see  https://gallipolidawn.com.au/?page=software|https://gallipolidawn.com.au/?page=software)  )." created="2020-01-03 03:49:59.0" updateauthor="gigamuse" updated="2020-01-03 03:49:59.0"/>
<Action id="66512" issue="43776" author="sykesm" type="comment" created="2020-01-07 18:20:20.0" updateauthor="sykesm" updated="2020-01-07 18:20:20.0"> <body><! CDATA sykesm: https://github.com/hyperledger/fabric/pull/458 lehors: https://github.com/hyperledger/fabric/pull/440  ></body> </Action>
<Action id="66513" issue="43776" author="lehors" type="comment" created="2020-01-07 18:55:56.0" updateauthor="lehors" updated="2020-01-07 18:55:56.0"> <body><! CDATA As stated on github I'm happy to withdraw #440 in favor of #458 which although not smaller is definitely better.     ></body> </Action>
