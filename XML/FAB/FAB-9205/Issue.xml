<Issue id="28952" key="FAB-9205" number="9205" project="10002" reporter="manish-sethi" assignee="c0rwin" creator="manish-sethi" type="10001" summary="Enhance gossip layer to support changes to private data collection config" priority="3" resolution="10000" status="6" created="2018-03-28 02:25:47.0" updated="2018-07-20 18:51:03.0" resolutiondate="2018-05-22 01:28:05.0" votes="0" watches="2" workflowId="41677"> <description><! CDATA * *Endorsement:* Use the new proto message (FAB-9204) for persisting the pvtwriteset into transient store and gossip push. Include height _H_ into this proto message where H=Max(last collection config, last channel config) ** * *Serving gossip pull from the committed storage*: When serving a gossip pull request for a data committed at height h from the committed data, evaluate the following two conditions and serves the data if either of these conditions is true.  condition1: A config is committed at height x such that  `(x > h) && (collectionConfig contains requestingOrg) && (requestingOrg has fullAccess)`  condition2: A config is committed at height x such that  `(x = latest height less than h) && (collectionConfig contains requestingOrg)`  Note that in the case of condition1, the corresponding channel config that is used for evaluating the condition should be the most recent channel config committed before height `x`. However, in the case of condition2, the corresponding channel config that is used is the most recent channel config before `h`. For retrieving configs by height - see FAB-9203 * *Serving gossip pull from the transient store*: When serving a request for the pvt data from the transient store - gossip pulls out the data from the transient store  - Evaluates whether the ledger height at the peer is greater than or equals to the height `H` specified in the proto message     - If `ledger height < height specified in the proto message`; return error     - else fetch the most recent collection config and channel config below (or at height) `H` and evaluate the eligibility of the requester     ></description> </Issue>
