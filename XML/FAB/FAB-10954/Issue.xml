<Issue id="31512" key="FAB-10954" number="10954" project="10002" reporter="sykesm" assignee="sykesm" creator="sykesm" type="10003" summary="Data race when running TestDisableEndpoint" priority="4" resolution="10000" status="6" created="2018-06-29 20:33:40.0" updated="2018-07-20 14:17:05.0" resolutiondate="2018-07-02 14:45:36.0" votes="0" watches="1" workflowId="42576"> <description><! CDATA The tests in the comm package have been explicitly enabled for parallel execution yet they rely on package level state for configuration information. TestDisableEndpoint would modify the package level config in its test and restore it at the end. This modification would race against all of the other tests that were reading it. {code:java} ================== WARNING: DATA RACE Read at 0x000004d6b850 by goroutine 22:   github.com/hyperledger/fabric/core/comm.TestUpdateEndpoints()       /Users/sykesm/workspace/fabric/src/github.com/hyperledger/fabric/core/comm/producer.go:60 +0x1e1   testing.tRunner()       /usr/local/Cellar/go/1.10.3/libexec/src/testing/testing.go:777 +0x16d  2018-06-29 16:25:38.290 EDT  ConnProducer  DisableEndpoint -> WARN 001 Only 1 endpoint remained, will not black-list it Previous write at 0x000004d6b850 by goroutine 23:   github.com/hyperledger/fabric/core/comm.TestDisableEndpoint()       /Users/sykesm/workspace/fabric/src/github.com/hyperledger/fabric/core/comm/producer_test.go:105 +0x7f   testing.tRunner()       /usr/local/Cellar/go/1.10.3/libexec/src/testing/testing.go:777 +0x16d  Goroutine 22 (running) created at:   testing.(*T).Run()       /usr/local/Cellar/go/1.10.3/libexec/src/testing/testing.go:824 +0x564   testing.runTests.func1()       /usr/local/Cellar/go/1.10.3/libexec/src/testing/testing.go:1063 +0xa4   testing.tRunner()       /usr/local/Cellar/go/1.10.3/libexec/src/testing/testing.go:777 +0x16d   testing.runTests()       /usr/local/Cellar/go/1.10.3/libexec/src/testing/testing.go:1061 +0x4e1   testing.(*M).Run()       /usr/local/Cellar/go/1.10.3/libexec/src/testing/testing.go:978 +0x2cd   main.main()       _testmain.go:116 +0x22a  Goroutine 23 (running) created at:   testing.(*T).Run()       /usr/local/Cellar/go/1.10.3/libexec/src/testing/testing.go:824 +0x564   testing.runTests.func1()       /usr/local/Cellar/go/1.10.3/libexec/src/testing/testing.go:1063 +0xa4   testing.tRunner()       /usr/local/Cellar/go/1.10.3/libexec/src/testing/testing.go:777 +0x16d   testing.runTests()       /usr/local/Cellar/go/1.10.3/libexec/src/testing/testing.go:1061 +0x4e1   testing.(*M).Run()       /usr/local/Cellar/go/1.10.3/libexec/src/testing/testing.go:978 +0x2cd   main.main()       _testmain.go:116 +0x22a =================={code}  ></description> </Issue>
