<Issue id="18894" key="FAB-5152" number="5152" project="10002" reporter="reubent 1" assignee="mastersingh24" creator="reubent 1" type="10004" summary="Inconsistent behaviour when opening files in MSP when installing chaincode" priority="3" resolution="10000" status="6" created="2017-07-03 11:02:52.0" updated="2018-07-20 14:13:41.0" resolutiondate="2018-01-23 22:00:30.0" votes="0" watches="4" workflowId="39369"> <description><! CDATA When installing chaincode, I receive the error "Error when setting up MSP from directory /etc/hyperledger/fabric/msp: err KeyMaterial not found in SigningIdentityInfo".  Having run the process through strace, I can see there's an inconsistency in how the keystore path is set compared to the other files in the MSP. I'm unsure which of these is correct but it probably ought to be consistent.  I ran the command {noformat} strace peer chaincode install --cafile msp/intermediatecerts/intermediate.cert.pem -C testchainid -c "{}" -l golang --logging-level debug -n mycc -o orderer:7050 -p com/gospel/chaincode/ -v 1{noformat} The keystore is opened as "msp/keystore" whereas the others are opened with the full path of pwd in front eg "/etc/hyperledger/fabric/msp/signcerts"  Relevant part of trace:    {code:java} stat("msp/keystore", 0xc42021cac8) = -1 ENOENT (No such file or directory) stat("msp/keystore", 0xc42021cb98) = -1 ENOENT (No such file or directory) stat("msp", 0xc42021cc68) = -1 ENOENT (No such file or directory) mkdirat(AT_FDCWD, "msp", 0755) = 0 mkdirat(AT_FDCWD, "msp/keystore", 0755) = 0 stat("/etc/hyperledger/fabric/msp/signcerts", {st_mode=S_IFDIR|0755, st_size=4096, ...}) = 0 openat(AT_FDCWD, "/etc/hyperledger/fabric/msp/signcerts", O_RDONLY|O_CLOEXEC) = 3 getdents64(3, /* 3 entries */, 4096) = 80 getdents64(3, /* 0 entries */, 4096) = 0 lstat("/etc/hyperledger/fabric/msp/signcerts/peer0.pem", {st_mode=S_IFREG|0644, st_size=1334, ...}) = 0 close(3) = 0 openat(AT_FDCWD, "/etc/hyperledger/fabric/msp/signcerts/peer0.pem", O_RDONLY|O_CLOEXEC) = 3 fstat(3, {st_mode=S_IFREG|0644, st_size=1334, ...}) = 0 read(3, "-----BEGIN CERTIFICATE-----\nMIID"..., 1846) = 1334 read(3, "", 512) = 0 close(3) = 0 stat("/etc/hyperledger/fabric/msp/cacerts", {st_mode=S_IFDIR|0755, st_size=4096, ...}) = 0 openat(AT_FDCWD, "/etc/hyperledger/fabric/msp/cacerts", O_RDONLY|O_CLOEXEC) = 3 getdents64(3, /* 3 entries */, 4096) = 80 getdents64(3, /* 0 entries */, 4096) = 0 lstat("/etc/hyperledger/fabric/msp/cacerts/ca.cert.pem", {st_mode=S_IFREG|0644, st_size=826, ...}) = 0 close(3) = 0 openat(AT_FDCWD, "/etc/hyperledger/fabric/msp/cacerts/ca.cert.pem", O_RDONLY|O_CLOEXEC) = 3 fstat(3, {st_mode=S_IFREG|0644, st_size=826, ...}) = 0 read(3, "-----BEGIN CERTIFICATE-----\nMIIC"..., 1338) = 826 read(3, "", 512) = 0 close(3) = 0 stat("/etc/hyperledger/fabric/msp/signcerts", {st_mode=S_IFDIR|0755, st_size=4096, ...}) = 0 openat(AT_FDCWD, "/etc/hyperledger/fabric/msp/signcerts", O_RDONLY|O_CLOEXEC) = 3 getdents64(3, /* 3 entries */, 4096) = 80 getdents64(3, /* 0 entries */, 4096) = 0 lstat("/etc/hyperledger/fabric/msp/signcerts/peer0.pem", {st_mode=S_IFREG|0644, st_size=1334, ...}) = 0 close(3) = 0 openat(AT_FDCWD, "/etc/hyperledger/fabric/msp/signcerts/peer0.pem", O_RDONLY|O_CLOEXEC) = 3 fstat(3, {st_mode=S_IFREG|0644, st_size=1334, ...}) = 0 read(3, "-----BEGIN CERTIFICATE-----\nMIID"..., 1846) = 1334 read(3, "", 512) = 0 close(3) = 0 stat("/etc/hyperledger/fabric/msp/admincerts", {st_mode=S_IFDIR|0755, st_size=4096, ...}) = 0 openat(AT_FDCWD, "/etc/hyperledger/fabric/msp/admincerts", O_RDONLY|O_CLOEXEC) = 3 getdents64(3, /* 5 entries */, 4096) = 160 getdents64(3, /* 0 entries */, 4096) = 0 lstat("/etc/hyperledger/fabric/msp/admincerts/ca.cert.pem", {st_mode=S_IFREG|0644, st_size=826, ...}) = 0 lstat("/etc/hyperledger/fabric/msp/admincerts/peer0.pem", {st_mode=S_IFREG|0644, st_size=1334, ...}) = 0 lstat("/etc/hyperledger/fabric/msp/admincerts/intermediate.cert.pem", {st_mode=S_IFREG|0644, st_size=843, ...}) = 0 close(3) = 0 openat(AT_FDCWD, "/etc/hyperledger/fabric/msp/admincerts/ca.cert.pem", O_RDONLY|O_CLOEXEC) = 3 fstat(3, {st_mode=S_IFREG|0644, st_size=826, ...}) = 0 read(3, "-----BEGIN CERTIFICATE-----\nMIIC"..., 1338) = 826 read(3, "", 512) = 0 close(3) = 0 openat(AT_FDCWD, "/etc/hyperledger/fabric/msp/admincerts/intermediate.cert.pem", O_RDONLY|O_CLOEXEC) = 3 fstat(3, {st_mode=S_IFREG|0644, st_size=843, ...}) = 0 read(3, "-----BEGIN CERTIFICATE-----\nMIIC"..., 1355) = 843 read(3, "", 512) = 0 close(3) = 0 openat(AT_FDCWD, "/etc/hyperledger/fabric/msp/admincerts/peer0.pem", O_RDONLY|O_CLOEXEC) = 3 fstat(3, {st_mode=S_IFREG|0644, st_size=1334, ...}) = 0 read(3, "-----BEGIN CERTIFICATE-----\nMIID"..., 1846) = 1334 read(3, "", 512) = 0 close(3) = 0 stat("/etc/hyperledger/fabric/msp/intermediatecerts", {st_mode=S_IFDIR|0755, st_size=4096, ...}) = 0 openat(AT_FDCWD, "/etc/hyperledger/fabric/msp/intermediatecerts", O_RDONLY|O_CLOEXEC) = 3 getdents64(3, /* 3 entries */, 4096) = 96 getdents64(3, /* 0 entries */, 4096) = 0 lstat("/etc/hyperledger/fabric/msp/intermediatecerts/intermediate.cert.pem", {st_mode=S_IFREG|0644, st_size=843, ...}) = 0 close(3) = 0 openat(AT_FDCWD, "/etc/hyperledger/fabric/msp/intermediatecerts/intermediate.cert.pem", O_RDONLY|O_CLOEXEC) = 3 fstat(3, {st_mode=S_IFREG|0644, st_size=843, ...}) = 0 read(3, "-----BEGIN CERTIFICATE-----\nMIIC"..., 1355) = 843 read(3, "", 512) = 0 close(3) = 0 stat("/etc/hyperledger/fabric/msp/crls", 0xc42021dca8) = -1 ENOENT (No such file or directory) write(2, "2017-07-03 10:38:12.345 UTC  msp"..., 2152017-07-03 10:38:12.345 UTC  msp  getMspConfig -> INFO 001 crls folder not found at  /etc/hyperledger/fabric/msp/intermediatecerts . Skipping.:  stat /etc/hyperledger/fabric/msp/crls: no such file or directory  ) = 215 stat("/etc/hyperledger/fabric/msp/config.yaml", {st_mode=S_IFREG|0664, st_size=137, ...}) = 0 openat(AT_FDCWD, "/etc/hyperledger/fabric/msp/config.yaml", O_RDONLY|O_CLOEXEC) = 3 fstat(3, {st_mode=S_IFREG|0664, st_size=137, ...}) = 0 read(3, "OrganizationalUnitIdentifiers:\n "..., 649) = 137 read(3, "", 512) = 0 close(3) = 0 openat(AT_FDCWD, "/etc/hyperledger/fabric/msp/intermediatecerts/intermediate.cert.pem", O_RDONLY|O_CLOEXEC) = 3 fstat(3, {st_mode=S_IFREG|0644, st_size=843, ...}) = 0 read(3, "-----BEGIN CERTIFICATE-----\nMIIC"..., 1355) = 843 read(3, "", 512) = 0 close(3) = 0 mmap(0xc420300000, 1048576, PROT_READ|PROT_WRITE, MAP_PRIVATE|MAP_ANONYMOUS, -1, 0) = 0xc420300000 mmap(0xc41ffe0000, 32768, PROT_READ|PROT_WRITE, MAP_PRIVATE|MAP_ANONYMOUS, -1, 0) = 0xc41ffe0000 openat(AT_FDCWD, "msp/keystore", O_RDONLY|O_CLOEXEC) = 3 getdents64(3, /* 2 entries */, 4096) = 48 getdents64(3, /* 0 entries */, 4096) = 0 close(3) = 0 openat(AT_FDCWD, "msp/keystore", O_RDONLY|O_CLOEXEC) = 3 getdents64(3, /* 2 entries */, 4096) = 48 getdents64(3, /* 0 entries */, 4096) = 0 close(3) = 0 select(0, NULL, NULL, NULL, {0, 1000}) = 0 (Timeout) select(0, NULL, NULL, NULL, {0, 1000}) = 0 (Timeout) write(2, "panic: ", 7panic: ) = 7 write(2, "Error when setting up MSP from d"..., 118Error when setting up MSP from directory /etc/hyperledger/fabric/msp: err KeyMaterial not found in SigningIdentityInfo) = 118 write(2, "\n", 1  {code}    ></description> </Issue>
