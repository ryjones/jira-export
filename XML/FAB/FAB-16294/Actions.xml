<Action id="62845" issue="41763" author="manish-sethi" type="comment" body="For more context - https://gerrit.hyperledger.org/r/#/c/fabric/+/32792/1/core/ledger/pvtdatastorage/store_impl.go@578" created="2019-08-13 16:01:30.0" updateauthor="manish-sethi" updated="2019-08-13 16:01:30.0"/>
<Action id="67998" issue="41763" author="senthil1" type="comment" created="2020-02-19 02:18:08.0" updateauthor="senthil1" updated="2020-02-19 02:27:58.0"> <body><! CDATA In release 1.4, the commit of pvtData of old block execute the following steps: # commit the pvtData of old blocks to the pvtdata store and a marker denoting the set of pvtData being added to the pvtDataStore. # commit the pvtData of old blocks to stateDB. # remove the marker from the pvtdata store using _ResetLastUpdatedOldBlockList()_. # If the peer fails after storing the data in pvtdatastore, the marker helps in synching the stateDB with the pvtdataStore. _GetLastUpdatedOldBlockList()_ is used by the kvledger during startup to see any pending old pvtData that needs to be applied to the stateDB. Further, it uses _ResetLastUpdatedOldBlockList() to remove the marker once the recovery is completed._  In release 2.0, we have simplified this flow as follows (by removing the marker): # commit the pvtData of old blocks to stateDB # commit the pvtData of old blocks to the pvtDataStore. # If the peer fails after storing the pvtData in the stateDB, we don't need to do any special operation to recover the states. The reconciler would fetch the data as the pvtData is missing in the pvtdata Store. While committing the pvtData to the stateDB, at the worst case, we overwrite existing data but there is no consistency issues. # we don't store any marker in the pvtDataStore in this approach.  However, during the rolling upgrade from 1.4 LTS to v2.x LTS, the marker can exist in the pvtDataStore. Hence, the recovery logic in 2.x still need to use _GetLastUpdatedOldBlockList()_ and __ _ResetLastUpdatedOldBlockList()_ to ensure correct recovery. When we move from v2.x to v2.x+1, we can be sure that there is no marker. Hence, in v2.x+1, we can safely remove _ResetLastUpdatedOldBlockList()_  _Assumption: user would move from 1.4 LTS to 2.x LTS_  ></body> </Action>
