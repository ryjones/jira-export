<Issue id="40732" key="FAB-15778" number="15778" project="10002" reporter="yacovm" assignee="mhbauer" creator="yacovm" type="10004" summary="NPE observed in gossip service UT" priority="3" resolution="10000" status="6" created="2019-06-20 20:53:23.0" updated="2020-01-13 18:13:22.0" resolutiondate="2019-07-10 11:57:24.0" votes="0" watches="3" workflowId="53686"> <description><! CDATA From: https://jenkins.hyperledger.org/job/fabric-verify-unit-tests-x86_64/13160/console   {code:java} 23:02:31 ok  	github.com/hyperledger/fabric/gossip/protoext	0.007s	coverage: 95.1% of statements 23:02:44 2019-06-20 20:02:36.093 UTC  gossip.service  loadGossipConfig -> WARN 001 Configuration key peer.gossip.pvtData.transientstoreMaxBlockRetention isn't set, defaulting to 1000 23:02:44 2019-06-20 20:02:36.095 UTC  gossip.gossip#127.0.0.1:46283  NewGossipService -> WARN 002 External endpoint is empty, peer will not be accessible outside of its organization 23:02:44 2019-06-20 20:02:38.108 UTC  gossip.comm  func1 -> WARN 003 1.2.3.4:42336, PKIid:3132372e302e302e313a3432333336 isn't responsive: rpc error: code = Unavailable desc = transport is closing 23:02:44 2019-06-20 20:02:38.108 UTC  gossip.discovery#127.0.0.1:40596  expireDeadMembers -> WARN 004 Entering  3132372e302e302e313a3432333336  23:02:44 2019-06-20 20:02:38.108 UTC  gossip.discovery#127.0.0.1:40596  expireDeadMembers -> WARN 005 Closing connection to Endpoint: 1.2.3.4:42336, InternalEndpoint: 127.0.0.1:42336, PKI-ID: 3132372e302e302e313a3432333336, Metadata:  23:02:44 2019-06-20 20:02:38.108 UTC  gossip.discovery#127.0.0.1:40596  expireDeadMembers -> WARN 006 Exiting 23:02:44 2019-06-20 20:02:40.100 UTC  gossip.privdata  loadPrivDataConfig -> WARN 007 Configuration key peer.gossip.pvtData.reconcileSleepInterval isn't set, defaulting to 1m0s 23:02:44 2019-06-20 20:02:40.100 UTC  gossip.privdata  loadPrivDataConfig -> WARN 008 Configuration key peer.gossip.pvtData.reconcileBatchSize isn't set, defaulting to 10 23:02:44 2019-06-20 20:02:40.100 UTC  gossip.privdata  loadPrivDataConfig -> WARN 009 Configuration key peer.gossip.pvtData.reconcileSleepInterval isn't set, defaulting to 1m0s 23:02:44 2019-06-20 20:02:40.100 UTC  gossip.privdata  loadPrivDataConfig -> WARN 00a Configuration key peer.gossip.pvtData.reconcileBatchSize isn't set, defaulting to 10 23:02:44 2019-06-20 20:02:40.100 UTC  gossip.privdata  loadPrivDataConfig -> WARN 00b Configuration key peer.gossip.pvtData.reconcileSleepInterval isn't set, defaulting to 1m0s 23:02:44 2019-06-20 20:02:40.100 UTC  gossip.privdata  loadPrivDataConfig -> WARN 00c Configuration key peer.gossip.pvtData.reconcileBatchSize isn't set, defaulting to 10 23:02:44 2019-06-20 20:02:40.100 UTC  gossip.gossip#p0  UpdateLedgerHeight -> WARN 00d No such channel  99 104 97 110 66  23:02:44 2019-06-20 20:02:40.100 UTC  gossip.privdata  loadPrivDataConfig -> WARN 00e Configuration key peer.gossip.pvtData.reconcileSleepInterval isn't set, defaulting to 1m0s 23:02:44 2019-06-20 20:02:40.100 UTC  gossip.privdata  loadPrivDataConfig -> WARN 00f Configuration key peer.gossip.pvtData.reconcileBatchSize isn't set, defaulting to 10 23:02:44 2019-06-20 20:02:40.100 UTC  gossip.gossip#p1  UpdateLedgerHeight -> WARN 010 No such channel  99 104 97 110 66  23:02:44 2019-06-20 20:02:44.104 UTC  gossip.privdata  loadPrivDataConfig -> WARN 011 Configuration key peer.gossip.pvtData.reconcileSleepInterval isn't set, defaulting to 1m0s 23:02:44 2019-06-20 20:02:44.104 UTC  gossip.privdata  loadPrivDataConfig -> WARN 012 Configuration key peer.gossip.pvtData.reconcileBatchSize isn't set, defaulting to 10 23:02:44 2019-06-20 20:02:44.104 UTC  gossip.privdata  loadPrivDataConfig -> WARN 013 Configuration key peer.gossip.pvtData.reconcileSleepInterval isn't set, defaulting to 1m0s 23:02:44 2019-06-20 20:02:44.104 UTC  gossip.privdata  loadPrivDataConfig -> WARN 014 Configuration key peer.gossip.pvtData.reconcileBatchSize isn't set, defaulting to 10 23:02:44 2019-06-20 20:02:44.105 UTC  gossip.comm  sendToEndpoint -> WARN 015 Failed obtaining connection for 127.0.0.1:43450, PKIid:3132372e302e302e313a3433343530 reason: Shutting down 23:02:44 panic: runtime error: invalid memory address or nil pointer dereference 23:02:44  signal SIGSEGV: segmentation violation code=0x1 addr=0x28 pc=0xf13e76  23:02:44  23:02:44 goroutine 440  running : 23:02:44 github.com/hyperledger/fabric/gossip/state.(*GossipStateProviderImpl).dispatch(0xc0001a6870, 0x0, 0x0) 23:02:44 	/w/workspace/fabric-verify-unit-tests-x86_64/gopath/src/github.com/hyperledger/fabric/gossip/state/state.go:361 +0x26 23:02:44 created by github.com/hyperledger/fabric/gossip/state.(*GossipStateProviderImpl).listen 23:02:44 	/w/workspace/fabric-verify-unit-tests-x86_64/gopath/src/github.com/hyperledger/fabric/gossip/state/state.go:352 +0x1ee 23:02:44 panic: runtime error: invalid memory address or nil pointer dereference 23:02:44  signal SIGSEGV: segmentation violation code=0x1 addr=0x28 pc=0xf13e76  23:02:44  23:02:44 goroutine 442  running : 23:02:44 github.com/hyperledger/fabric/gossip/state.(*GossipStateProviderImpl).dispatch(0xc0001a6870, 0x0, 0x0) 23:02:44 	/w/workspace/fabric-verify-unit-tests-x86_64/gopath/src/github.com/hyperledger/fabric/gossip/state/state.go:361 +0x26 23:02:44 created by github.com/hyperledger/fabric/gossip/state.(*GossipStateProviderImpl).listen 23:02:44 	/w/workspace/fabric-verify-unit-tests-x86_64/gopath/src/github.com/hyperledger/fabric/gossip/state/state.go:352 +0x1ee 23:02:44 panic: runtime error: invalid memory address or nil pointer dereference 23:02:44  signal SIGSEGV: segmentation violation code=0x1 addr=0x28 pc=0xf13e76  23:02:44  23:02:44 goroutine 438  running : 23:02:44 github.com/hyperledger/fabric/gossip/state.(*GossipStateProviderImpl).dispatch(0xc0001a6870, 0x0, 0x0) 23:02:44 	/w/workspace/fabric-verify-unit-tests-x86_64/gopath/src/github.com/hyperledger/fabric/gossip/state/state.go:361 +0x26 23:02:44 created by github.com/hyperledger/fabric/gossip/state.(*GossipStateProviderImpl).listen 23:02:44 	/w/workspace/fabric-verify-unit-tests-x86_64/gopath/src/github.com/hyperledger/fabric/gossip/state/state.go:352 +0x1ee 23:02:44 panic: runtime error: invalid memory address or nil pointer dereference 23:02:44  signal SIGSEGV: segmentation violation code=0x1 addr=0x28 pc=0xf13e76  23:02:44  23:02:44 goroutine 439  running : 23:02:44 github.com/hyperledger/fabric/gossip/state.(*GossipStateProviderImpl).dispatch(0xc0001a6870, 0x0, 0x0) 23:02:44 	/w/workspace/fabric-verify-unit-tests-x86_64/gopath/src/github.com/hyperledger/fabric/gossip/state/state.go:361 +0x26 23:02:44 created by github.com/hyperledger/fabric/gossip/state.(*GossipStateProviderImpl).listen 23:02:44 	/w/workspace/fabric-verify-unit-tests-x86_64/gopath/src/github.com/hyperledger/fabric/gossip/state/state.go:352 +0x1ee 23:02:44 FAIL	github.com/hyperledger/fabric/gossip/service	8.098s 23:02:44 ?   	github.com/hyperledger/fabric/gossip/service/mocks	 no test files  23:03:55 ok  	github.com/hyperledger/fabric/gossip/state	33.274s	coverage: 77.9% of statements 23:03:58 ok  	github.com/hyperledger/fabric/gossip/state/mocks	0.019s	coverage: 55.6% of statements 23:04:04 ok  	github.com/hyperledger/fabric/gossip/util	4.058s	coverage: 73.5% of statements 23:04:05 Makefile:199: recipe for target 'unit-test' failed 23:04:05 make: ***  unit-test  Error 1 {code}  ></description> </Issue>
