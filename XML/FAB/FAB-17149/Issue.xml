<Issue id="43463" key="FAB-17149" number="17149" project="10002" reporter="sykesm" assignee="samyuan1990" creator="sykesm" type="10004" summary="Some test(s) using TestEnv from kvledger/bookeeping/test_exports are not cleaning up" priority="3" resolution="10001" status="6" created="2019-11-26 15:54:31.0" updated="2020-01-16 18:41:22.0" resolutiondate="2020-01-16 18:41:22.0" votes="0" watches="3" workflowId="56577"> <description><! CDATA My tmpfs filled up today. When I looked at the directory entries, I found hundreds of directories like this:  {code} bookkeep728418616                                                                                                                                                                     bookkeep728538393                                                                                                                                                                     bookkeep728665212                                                                                                                                                                     bookkeep729158493                                                                                                                                                                     bookkeep729472634                                                                                                                                                                     bookkeep729680717                                                                                                                                                                     bookkeep730930575                                                                                                                                                                     bookkeep731151148                                                                                                                                                                     bookkeep731594777                                                                                                                                                                     bookkeep732084507                                                                                                                                                                     bookkeep733935366                                                                                                                                                                     bookkeep734021180                                                                                                                                                                     bookkeep734563843                                                                                                                                                                     bookkeep735016345                                                                                                                                                                     bookkeep735781202                                                                                                                                                                     bookkeep738221388                                                                                                                                                                     bookkeep738355796                                                                                                                                                                     bookkeep738415002                                                                                                                                                                     bookkeep738471849                                                                                                                                                                     bookkeep739233366                                                                                                                                                                     bookkeep741195179                                                                                                                                                                     bookkeep741820148                                                                                                                                                                     bookkeep741872069                                                                                                                                                                     bookkeep743326330                                                                                                                                                                     bookkeep744359792                                                                                                                                                                     bookkeep745486185                                                                                                                                                                     bookkeep745581451                                                                                                                                                                     bookkeep747394076                                                                                                                                                                     bookkeep747449837                                                                                                                                                                     bookkeep748419749                                                                                                                                                                     bookkeep750209949                                                                                                                                                                     bookkeep750785581                                                                                                                                                                     bookkeep751378795                                                                                                                                                                     bookkeep751762031                                                                                                                                                                     bookkeep751804935                                                                                                                                                                     bookkeep751836555                                                                                                                                                                     bookkeep752020079                                                                                                                                                                     bookkeep752070527                                                                                                                                                                     bookkeep752230068                                                                                                                                                                     bookkeep752766759                                                                                                                                                                     bookkeep753094979                                                                                                                                                                     bookkeep754021547                                                                                                                                                                     bookkeep755580477                                                                                                                                                                     {code}  It appears this is coming from the code in kvledger/bookeeping/test_exports: {code} // NewTestEnv construct a TestEnv for testing func NewTestEnv(t testing.TB) *TestEnv { 	dbPath, err := ioutil.TempDir("", "bookkeep") 	require.NoError(t, err) 	provider, err := NewProvider(dbPath) 	require.NoError(t, err) 	return &TestEnv{t, provider, dbPath} } {code}  There is a {{Cleanup}} method on the object that should delete the temporary directory but it does not look like it's being called as appropriate.  --- Looks like the following use NewTestEnv {code} core/ledger/kvledger/txmgmt/pvtstatepurgemgmt/expiry_keeper_test.go core/ledger/kvledger/txmgmt/pvtstatepurgemgmt/purge_mgr_test.go core/ledger/kvledger/txmgmt/txmgr/lockbasedtxmgr/pkg_test.go core/ledger/kvledger/txmgmt/privacyenabledstate/test_exports.go core/ledger/kvledger/txmgmt/privacyenabledstate/optimization_test.go core/ledger/kvledger/history/pkg_test.go {code}   ></description> </Issue>
