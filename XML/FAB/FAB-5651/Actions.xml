<Action id="29515" issue="20018" author="adnanchoudhury" type="comment" body=" ~C0rWin " created="2017-08-07 21:38:48.0" updateauthor="adnanchoudhury" updated="2017-08-07 21:38:48.0"/>
<Action id="29610" issue="20018" author="adnanchoudhury" type="comment" created="2017-08-09 15:40:07.0" updateauthor="adnanchoudhury" updated="2017-08-09 15:40:07.0"> <body><! CDATA Attaching logs from 2 more runs, they differ in how the ledgerfile is edited in step 5: 1) in the 2nd run, In the leader peer ledger file,  values of one of the invokes is edited. 2) in the 3rd run, In the leader peer ledger file,  The entire ledger file contents are deleted except 1st line.  The non-leader, in both cases, end up with error-free ledger (ledgers for both runs are also attached.)  ></body> </Action>
<Action id="29897" issue="20018" author="gennadyl" type="comment" body="Hi  ~AdnanChoudhury . Based what I saw in logs, peer1Org2.example.com get missing blocks using pull mechanism from peer0Org2.example.com, so system works as expected. Pull mechanism keep in-memory blocks cache (for latest blocks) and this way not affected by blocks stored on disk." created="2017-08-16 12:57:34.0" updateauthor="gennadyl" updated="2017-08-16 13:00:39.0"/>
<Action id="29898" issue="20018" author="gennadyl" type="comment" created="2017-08-16 13:03:29.0" updateauthor="gennadyl" updated="2017-08-16 13:57:38.0"> <body><! CDATA In any case, non-leader can't have corrupted ledger, only in-complete - each block validated in state transfer/pull upon receive.   Here how last block verification fails during state transfer:  017-08-07 21:30:14.087 UTC  gossip/state  handleStateResponse -> WARN a37 Error verifying block with sequence number 4, due to Header.DataHash is different from Hash(block.Data) for block with id  4  on channel  behavesystest  2017-08-07 21:30:14.087 UTC  gossip/state  requestBlocksInRange -> WARN a38 Wasn't able to process state response for blocks  4...4 , due to Header.DataHash is different from Hash(block.Data) for block with id  4  on channel  behavesystest   ></body> </Action>
<Action id="29906" issue="20018" author="adnanchoudhury" type="comment" created="2017-08-16 14:14:17.0" updateauthor="adnanchoudhury" updated="2017-08-16 14:14:56.0"> <body><! CDATA Thanks for the update  ~gennadyl  Upon closer look at the log, came to the same conclusion few hours back, that it is indeed receiving all the blocks from the leader peer (peer0Org2). Just a clarification, when you mention that pull mechanism keep in-memory blocks cache, do you mean the cache is in the peer that *has* the blocks, *not* in the peer that requests the pull, right? In any case, I would now consider this jira "working as  expected" and not a bug.   ></body> </Action>
<Action id="29908" issue="20018" author="adnanchoudhury" type="comment" body="-Let me run some additional test cases to confirm, will update soon.-" created="2017-08-16 14:46:50.0" updateauthor="adnanchoudhury" updated="2017-08-16 16:39:58.0"/>
<Action id="29913" issue="20018" author="gennadyl" type="comment" body="Yes, in peer that has the blocks" created="2017-08-16 15:18:32.0" updateauthor="gennadyl" updated="2017-08-16 15:18:32.0"/>
<Action id="29914" issue="20018" author="adnanchoudhury" type="comment" body=" ~gennadyl  thanks, Is there a way to know/calculate how many blocks will be in memory?" created="2017-08-16 15:20:57.0" updateauthor="adnanchoudhury" updated="2017-08-16 15:20:57.0"/>
<Action id="29939" issue="20018" author="gennadyl" type="comment" created="2017-08-17 06:42:20.0" updateauthor="gennadyl" updated="2017-08-17 08:44:31.0"> <body><! CDATA  ~AdnanChoudhury  Yes, it is possible. The block stay in memory for core.peer.gossip.pullInterval * 100 seconds. In current configuration it set to 400 seconds, but give it some extra time, to make eviction goroutine time to run. In addition, cache has limited capacity - core.peer.gossip.maxBlockCountToStore, now it is 100 blocks.   ></body> </Action>
<Action id="29959" issue="20018" author="adnanchoudhury" type="comment" body="Thanks  ~gennadyl " created="2017-08-17 15:31:21.0" updateauthor="adnanchoudhury" updated="2017-08-17 15:31:21.0"/>
<Action id="30255" issue="20018" author="yacovm" type="comment" body="can we close this? or - what is the status on this?" created="2017-08-28 14:33:06.0" updateauthor="yacovm" updated="2017-08-28 14:33:19.0"/>
<Action id="30257" issue="20018" author="adnanchoudhury" type="comment" created="2017-08-28 14:37:24.0" updateauthor="adnanchoudhury" updated="2017-08-28 14:37:24.0"> <body><! CDATA Closing it.     ></body> </Action>
