<Issue id="23880" key="FAB-6940" number="6940" project="10002" reporter="adnanchoudhury" assignee="adnanchoudhury" creator="adnanchoudhury" type="10004" summary="Daily-test: Gosiip test failure in scenario &quot;A leader peer goes down by disconnect, comes back up *before* another leader is elected, catches up&quot;" priority="3" resolution="10000" status="6" created="2017-11-09 15:26:01.0" updated="2019-03-19 11:13:20.0" resolutiondate="2017-11-13 18:35:28.0" votes="0" watches="1" workflowId="40483"> <description><! CDATA This scenario or the related scenarios with stop/pause fail with following error messages:  https://jenkins.hyperledger.org/view/fabric-test/job/fabric-test-daily-x86_64/149/testReport/gossip/Gossip%20Service/_FAB_4663___FAB_4664___FAB_4665__A_non_leader_peer_goes_down_by_disconnect__comes_back_up_and_catches_up_eventually__Disconnect_test_may_fail_due_to_FAB_6333______1_3_/     {code:java} Error Message Error: initial non-leader peer has already become leader. Stacktrace Failing step: Then the initial non-leader peer of "org1" has not become the leader ... failed in 0.507s Location: gossip.feature:133 Assertion Failed: Error: initial non-leader peer has already become leader. Captured stdout: testConfigs: configs/95bfda3cc4bd11e7a32efa163ebc964d  /bin/bash -c "CORE_PEER_MSPCONFIGPATH=/var/hyperledger/configs/95bfda3cc4bd11e7a32efa163ebc964d/peerOrganizations/org1.example.com/users/Admin@org1.example.com/msp CORE_PEER_LOCALMSPID=org1.example.com CORE_PEER_ID=peer0.org1.example.com CORE_PEER_ADDRESS=peer0.org1.example.com:7051 peer channel create --file /var/hyperledger/configs/95bfda3cc4bd11e7a32efa163ebc964d/behavesystest.tx --channelID behavesystest --timeout 120 --orderer orderer0.example.com:7050 " : {'cli': ''}  /bin/bash -c "CORE_PEER_MSPCONFIGPATH=/var/hyperledger/configs/95bfda3cc4bd11e7a32efa163ebc964d/peerOrganizations/org2.example.com/users/Admin@org2.example.com/msp peer channel fetch config /var/hyperledger/configs/95bfda3cc4bd11e7a32efa163ebc964d/behavesystest.block --channelID behavesystest --orderer orderer0.example.com:7050 " : {'peer1.org2.example.com': ''}  /bin/bash -c "CORE_PEER_MSPCONFIGPATH=/var/hyperledger/configs/95bfda3cc4bd11e7a32efa163ebc964d/peerOrganizations/org2.example.com/users/Admin@org2.example.com/msp CORE_PEER_LOCALMSPID=org2.example.com CORE_PEER_ID=peer1.org2.example.com CORE_PEER_ADDRESS=peer1.org2.example.com:7051 peer channel join --blockpath /var/hyperledger/configs/95bfda3cc4bd11e7a32efa163ebc964d/behavesystest.block" :  Channel Block Present Result True  /bin/bash -c "CORE_PEER_MSPCONFIGPATH=/var/hyperledger/configs/95bfda3cc4bd11e7a32efa163ebc964d/peerOrganizations/org2.example.com/users/Admin@org2.example.com/msp CORE_PEER_LOCALMSPID=org2.example.com CORE_PEER_ID=peer1.org2.example.com CORE_PEER_ADDRESS=peer1.org2.example.com:7051 peer chaincode install --name mycc --lang GOLANG --version 0 --path github.com/hyperledger/fabric/examples/chaincode/go/chaincode_example02 --orderer orderer0.example.com:7050 " : {'peer1.org2.example.com': '', 'peer0.org1.example.com': '', 'peer1.org1.example.com': '', 'peer0.org2.example.com': ''}  /bin/bash -c "CORE_PEER_MSPCONFIGPATH=/var/hyperledger/configs/95bfda3cc4bd11e7a32efa163ebc964d/peerOrganizations/org1.example.com/users/Admin@org1.example.com/msp CORE_PEER_LOCALMSPID=org1.example.com CORE_PEER_ID=peer0.org1.example.com CORE_PEER_ADDRESS=peer0.org1.example.com:7051 peer chaincode instantiate --name mycc --version 0 --lang GOLANG --channelID behavesystest --ctor '{"Args":  "init","a","1000","b","2000" }' --orderer orderer0.example.com:7050 " : {'peer0.org1.example.com': {'peer0.org1.example.com': ''}} initial leader is peer1.org1.example.com Invoke /bin/bash -c "CORE_PEER_MSPCONFIGPATH=/var/hyperledger/configs/95bfda3cc4bd11e7a32efa163ebc964d/peerOrganizations/org1.example.com/users/Admin@org1.example.com/msp CORE_PEER_LOCALMSPID=org1.example.com CORE_PEER_ID=peer1.org1.example.com CORE_PEER_ADDRESS=peer1.org1.example.com:7051 peer chaincode invoke --name mycc --ctor '{"Args":  "invoke","a","b","10" }' --channelID behavesystest --orderer orderer0.example.com:7050 " : {'peer1.org1.example.com': ''} Query Exec command: /bin/bash -c "CORE_PEER_MSPCONFIGPATH=/var/hyperledger/configs/95bfda3cc4bd11e7a32efa163ebc964d/peerOrganizations/org1.example.com/users/Admin@org1.example.com/msp CORE_PEER_LOCALMSPID=org1.example.com CORE_PEER_ID=peer1.org1.example.com CORE_PEER_ADDRESS=peer1.org1.example.com:7051 peer chaincode query --name mycc --ctor '{"Args":  "query","a" }' --channelID behavesystest " initial non-leader is peer0.org1.example.com Invoke /bin/bash -c "CORE_PEER_MSPCONFIGPATH=/var/hyperledger/configs/95bfda3cc4bd11e7a32efa163ebc964d/peerOrganizations/org1.example.com/users/Admin@org1.example.com/msp CORE_PEER_LOCALMSPID=org1.example.com CORE_PEER_ID=peer0.org1.example.com CORE_PEER_ADDRESS=peer0.org1.example.com:7051 peer chaincode invoke --name mycc --ctor '{"Args":  "invoke","a","b","10" }' --channelID behavesystest --orderer orderer0.example.com:7050 " : {'peer0.org1.example.com': ''} Query Exec command: /bin/bash -c "CORE_PEER_MSPCONFIGPATH=/var/hyperledger/configs/95bfda3cc4bd11e7a32efa163ebc964d/peerOrganizations/org1.example.com/users/Admin@org1.example.com/msp CORE_PEER_LOCALMSPID=org1.example.com CORE_PEER_ID=peer0.org1.example.com CORE_PEER_ADDRESS=peer0.org1.example.com:7051 peer chaincode query --name mycc --ctor '{"Args":  "query","a" }' --channelID behavesystest " Invoke /bin/bash -c "CORE_PEER_MSPCONFIGPATH=/var/hyperledger/configs/95bfda3cc4bd11e7a32efa163ebc964d/peerOrganizations/org1.example.com/users/Admin@org1.example.com/msp CORE_PEER_LOCALMSPID=org1.example.com CORE_PEER_ID=peer0.org1.example.com CORE_PEER_ADDRESS=peer0.org1.example.com:7051 peer chaincode invoke --name mycc --ctor '{"Args":  "invoke","a","b","10" }' --channelID behavesystest --orderer orderer0.example.com:7050 " : {'peer0.org1.example.com': ''}  Standard Output @scenario.begin  @daily Scenario Outline:  FAB-4673   FAB-4674   FAB-4675  A leader peer goes down by disconnect, comes back up *before* another leader is elected, catches up. Disconnect test may fail due to FAB-6333. -- @1.3  Given the CORE_LOGGING_GOSSIP environment variable is "DEBUG" ... passed in 0.000s And I have a bootstrapped fabric network of type kafka ... passed in 30.796s When a user sets up a channel ... passed in 37.977s And a user deploys chaincode at path "github.com/hyperledger/fabric/examples/chaincode/go/chaincode_example02" with args  "init","a","1000","b","2000"  with name "mycc" ... passed in 62.150s And I wait "30" seconds ... passed in 30.027s When a user invokes on the chaincode named "mycc" with args  "invoke","a","b","10"  on the initial leader peer of "org1" ... passed in 35.894s And I wait "5" seconds ... passed in 5.005s And a user queries on the chaincode named "mycc" with args  "query","a"  on the initial leader peer of "org1" ... passed in 4.682s Then a user receives a success response of 990 from the initial leader peer of "org1" ... passed in 0.000s When a user invokes on the chaincode named "mycc" with args  "invoke","a","b","10"  on the initial non-leader peer of "org1" ... passed in 5.458s And I wait "5" seconds ... passed in 5.005s And a user queries on the chaincode named "mycc" with args  "query","a"  on the initial non-leader peer of "org1" ... passed in 4.898s Then a user receives a success response of 980 from the initial non-leader peer of "org1" ... passed in 0.000s When the initial leader peer of "org1" is taken down by doing a disconnect ... passed in 4.198s And I wait "1" seconds ... passed in 1.001s And a user invokes on the chaincode named "mycc" with args  "invoke","a","b","10"  on the initial non-leader peer of "org1" ... passed in 3.173s And I wait " 5" seconds ... passed in 5.005s Then the initial non-leader peer of "org1" has not become the leader ... failed in 0.507s When the initial leader peer of "org1" comes back up by doing a connect ... skipped in 0.000s And I wait "20" seconds ... skipped in 0.000s When a user queries on the chaincode named "mycc" with args  "query","a"  on the initial leader peer of "org1" ... skipped in 0.000s Then a user receives a success response of 970 from the initial leader peer of "org1" ... skipped in 0.000s  @scenario.end --------------------------------------------------------------------------------  Captured stdout: testConfigs: configs/95bfda3cc4bd11e7a32efa163ebc964d  /bin/bash -c "CORE_PEER_MSPCONFIGPATH=/var/hyperledger/configs/95bfda3cc4bd11e7a32efa163ebc964d/peerOrganizations/org1.example.com/users/Admin@org1.example.com/msp CORE_PEER_LOCALMSPID=org1.example.com CORE_PEER_ID=peer0.org1.example.com CORE_PEER_ADDRESS=peer0.org1.example.com:7051 peer channel create --file /var/hyperledger/configs/95bfda3cc4bd11e7a32efa163ebc964d/behavesystest.tx --channelID behavesystest --timeout 120 --orderer orderer0.example.com:7050 " : {'cli': ''}  /bin/bash -c "CORE_PEER_MSPCONFIGPATH=/var/hyperledger/configs/95bfda3cc4bd11e7a32efa163ebc964d/peerOrganizations/org2.example.com/users/Admin@org2.example.com/msp peer channel fetch config /var/hyperledger/configs/95bfda3cc4bd11e7a32efa163ebc964d/behavesystest.block --channelID behavesystest --orderer orderer0.example.com:7050 " : {'peer1.org2.example.com': ''}  /bin/bash -c "CORE_PEER_MSPCONFIGPATH=/var/hyperledger/configs/95bfda3cc4bd11e7a32efa163ebc964d/peerOrganizations/org2.example.com/users/Admin@org2.example.com/msp CORE_PEER_LOCALMSPID=org2.example.com CORE_PEER_ID=peer1.org2.example.com CORE_PEER_ADDRESS=peer1.org2.example.com:7051 peer channel join --blockpath /var/hyperledger/configs/95bfda3cc4bd11e7a32efa163ebc964d/behavesystest.block" :  Channel Block Present Result True  /bin/bash -c "CORE_PEER_MSPCONFIGPATH=/var/hyperledger/configs/95bfda3cc4bd11e7a32efa163ebc964d/peerOrganizations/org2.example.com/users/Admin@org2.example.com/msp CORE_PEER_LOCALMSPID=org2.example.com CORE_PEER_ID=peer1.org2.example.com CORE_PEER_ADDRESS=peer1.org2.example.com:7051 peer chaincode install --name mycc --lang GOLANG --version 0 --path github.com/hyperledger/fabric/examples/chaincode/go/chaincode_example02 --orderer orderer0.example.com:7050 " : {'peer1.org2.example.com': '', 'peer0.org1.example.com': '', 'peer1.org1.example.com': '', 'peer0.org2.example.com': ''}  /bin/bash -c "CORE_PEER_MSPCONFIGPATH=/var/hyperledger/configs/95bfda3cc4bd11e7a32efa163ebc964d/peerOrganizations/org1.example.com/users/Admin@org1.example.com/msp CORE_PEER_LOCALMSPID=org1.example.com CORE_PEER_ID=peer0.org1.example.com CORE_PEER_ADDRESS=peer0.org1.example.com:7051 peer chaincode instantiate --name mycc --version 0 --lang GOLANG --channelID behavesystest --ctor '{"Args":  "init","a","1000","b","2000" }' --orderer orderer0.example.com:7050 " : {'peer0.org1.example.com': {'peer0.org1.example.com': ''}} initial leader is peer1.org1.example.com Invoke /bin/bash -c "CORE_PEER_MSPCONFIGPATH=/var/hyperledger/configs/95bfda3cc4bd11e7a32efa163ebc964d/peerOrganizations/org1.example.com/users/Admin@org1.example.com/msp CORE_PEER_LOCALMSPID=org1.example.com CORE_PEER_ID=peer1.org1.example.com CORE_PEER_ADDRESS=peer1.org1.example.com:7051 peer chaincode invoke --name mycc --ctor '{"Args":  "invoke","a","b","10" }' --channelID behavesystest --orderer orderer0.example.com:7050 " : {'peer1.org1.example.com': ''} Query Exec command: /bin/bash -c "CORE_PEER_MSPCONFIGPATH=/var/hyperledger/configs/95bfda3cc4bd11e7a32efa163ebc964d/peerOrganizations/org1.example.com/users/Admin@org1.example.com/msp CORE_PEER_LOCALMSPID=org1.example.com CORE_PEER_ID=peer1.org1.example.com CORE_PEER_ADDRESS=peer1.org1.example.com:7051 peer chaincode query --name mycc --ctor '{"Args":  "query","a" }' --channelID behavesystest " initial non-leader is peer0.org1.example.com Invoke /bin/bash -c "CORE_PEER_MSPCONFIGPATH=/var/hyperledger/configs/95bfda3cc4bd11e7a32efa163ebc964d/peerOrganizations/org1.example.com/users/Admin@org1.example.com/msp CORE_PEER_LOCALMSPID=org1.example.com CORE_PEER_ID=peer0.org1.example.com CORE_PEER_ADDRESS=peer0.org1.example.com:7051 peer chaincode invoke --name mycc --ctor '{"Args":  "invoke","a","b","10" }' --channelID behavesystest --orderer orderer0.example.com:7050 " : {'peer0.org1.example.com': ''} Query Exec command: /bin/bash -c "CORE_PEER_MSPCONFIGPATH=/var/hyperledger/configs/95bfda3cc4bd11e7a32efa163ebc964d/peerOrganizations/org1.example.com/users/Admin@org1.example.com/msp CORE_PEER_LOCALMSPID=org1.example.com CORE_PEER_ID=peer0.org1.example.com CORE_PEER_ADDRESS=peer0.org1.example.com:7051 peer chaincode query --name mycc --ctor '{"Args":  "query","a" }' --channelID behavesystest " Invoke /bin/bash -c "CORE_PEER_MSPCONFIGPATH=/var/hyperledger/configs/95bfda3cc4bd11e7a32efa163ebc964d/peerOrganizations/org1.example.com/users/Admin@org1.example.com/msp CORE_PEER_LOCALMSPID=org1.example.com CORE_PEER_ID=peer0.org1.example.com CORE_PEER_ADDRESS=peer0.org1.example.com:7051 peer chaincode invoke --name mycc --ctor '{"Args":  "invoke","a","b","10" }' --channelID behavesystest --orderer orderer0.example.com:7050 " : {'peer0.org1.example.com': ''}  {code}       ></description> </Issue>
