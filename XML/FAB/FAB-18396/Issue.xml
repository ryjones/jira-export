<Issue id="46479" key="FAB-18396" number="18396" project="10002" reporter="JIRAUSER21063" creator="JIRAUSER21063" type="10004" summary="Peers fails to start on Azure Kubernetes Service with interrupted system call" priority="3" status="10300" created="2021-01-11 22:28:46.0" updated="2021-01-18 05:23:57.0" votes="0" watches="2" workflowId="60421" archived="N"> <description><! CDATA When we try to deploy the network on Azure Kubernetes Service (Version: *1.18.10,* Kernal Version: 5.4.0-1031-azure) both peers and orderer fail to start. It either fails with interrupted system calls or file doesn't exist when initializing ledgerData  Below is the stack trace on peer:    {code:java} 2021-01-11 22:20:51.648 UTC  ledgermgmt  NewLedgerMgr -> INFO 009 Initializing LedgerMgrpanic: Error acquiring lock on file /var/hyperledger/production/ledgersData/fileLock: file does not existgoroutine 1  running :github.com/hyperledger/fabric/common/ledger/util/leveldbhelper.(*FileLock).Lock(0xc0003a6700, 0xc0003a6700, 0x2)	/go/src/github.com/hyperledger/fabric/common/ledger/util/leveldbhelper/leveldb_helper.go:212 +0x2edgithub.com/hyperledger/fabric/core/ledger/kvledger.NewProvider(0xc0000ffc20, 0x0, 0x0, 0x0)	/go/src/github.com/hyperledger/fabric/core/ledger/kvledger/kv_ledger_provider.go:103 +0x180github.com/hyperledger/fabric/core/ledger/ledgermgmt.NewLedgerMgr(0xc0004e1968, 0x1af0060)	/go/src/github.com/hyperledger/fabric/core/ledger/ledgermgmt/ledger_mgmt.go:65 +0x27agithub.com/hyperledger/fabric/internal/peer/node.serve(0x248d5c8, 0x0, 0x0, 0x0, 0x0)	/go/src/github.com/hyperledger/fabric/internal/peer/node/start.go:431 +0x2035github.com/hyperledger/fabric/internal/peer/node.glob..func6(0x235b140, 0x248d5c8, 0x0, 0x0, 0x0, 0x0)	/go/src/github.com/hyperledger/fabric/internal/peer/node/start.go:127 +0x9cgithub.com/spf13/cobra.(*Command).execute(0x235b140, 0x248d5c8, 0x0, 0x0, 0x235b140, 0x248d5c8)	/go/src/github.com/hyperledger/fabric/vendor/github.com/spf13/cobra/command.go:762 +0x453github.com/spf13/cobra.(*Command).ExecuteC(0x235b860, 0xc0001f5f50, 0x1, 0x1)	/go/src/github.com/hyperledger/fabric/vendor/github.com/spf13/cobra/command.go:852 +0x2eagithub.com/spf13/cobra.(*Command).Execute(...)  {code} Sometimes it fails with the following error:       {code:java} panic: Error opening leveldb: seek /var/hyperledger/production/transientstore/LOG: interrupted system call{code}    I have raised the issue with Microsoft. They have identified the issue at the kernel level and they are working on fixing that. Meanwhile, they have suggested a workaround as follows.  The application (leveldb) should either: * Handle EINTR from the I/O system calls, and retry on getting such an error. OR  * Use the SA_RESTART flag on sigaction:  https://www.gnu.org/software/libc/manual/html_node/Flags-for-Sigaction.html|https://urldefense.com/v3/__https://www.gnu.org/software/libc/manual/html_node/Flags-for-Sigaction.html__;!!E1R1dd1bLLODlQ4!U72GR65-W2zLAb3K5dw_JyKcLaJ9FkORj0foPdFLUJ6kQ9hFNrkiZ7-6nk1HkZXhs4A$   I understand that this might be an issue with level DB but is it possible to have a fix on Fabric until we wait to get the kernel fix?  ></description> </Issue>
