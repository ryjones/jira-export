<Issue id="46599" key="FAB-18431" number="18431" project="10002" reporter="JIRAUSER21466" creator="JIRAUSER21466" type="10004" summary="Issue when Discovery service is enabled: first invoke fails" priority="3" resolution="10203" status="6" created="2021-02-25 12:11:08.0" updated="2021-03-01 12:23:53.0" resolutiondate="2021-03-01 12:23:53.0" votes="0" watches="1" workflowId="60543" archived="N"> <description><! CDATA Versions: * fabric-network 2.2.5 *  fabric-peer 2.3.0 *  fabric-orderer 2.3.0 *  Chaincode is running as an external service.  With a single peer network, when *Discovery* is *enabled*, the first invoke transaction sent from the SDK always fails with error. {code:java} 'Error: DiscoveryService: test-chaincode error: failed constructing descriptor for chaincodes:<name:"test-chaincode" > '{code}   After this first error, all other invoke transactions succeed without an issue.  Every time a new Gateway is created (i.e. our client is restarted) this problem appears again (first invoke transaction fails, and all others after this one work).   The peer outputs the following log:    {code:java} 2021-02-25 10:42:23.740 UTC  lifecycle  Work -> WARN 09a could not launch chaincode 'test-chaincode:f7e8d6c0cde75ec259479d3d6de55c88ec4eafd1a1f594d2c85325e48b3bf3f0': connection to test-chaincode:f7e8d6c0cde75ec259479d3d6de55c88ec4eafd1a1f594d2c85325e48b 3bf3f0 failed: error cannot create connection for test-chaincode:f7e8d6c0cde75ec259479d3 d6de55c88ec4eafd1a1f594d2c85325e48b3bf3f0: error creating grpc connection to test-chaincode:7052: failed to create new connection: connection error: desc = "transport : error while dialing: dial tcp 10.102.31.213:7052: connect: connection refused" 2021-02-25 10:42:50.619 UTC  policies.inquire  principalsOfTree -> WARN 09b Leaf vertex 0.0 is of type &{rules:<signed_by:0 > } 2021-02-25 10:42:50.619 UTC  discovery.endorsement  PeersForEndorsement -> WARN 09c Principal set computation failed: endorsement policy cannot be satisfied 2021-02-25 10:42:50.619 UTC  discovery  chaincodeQuery -> ERRO 09d Failed constructing descriptor for chaincode chaincodes:<name:"test-chaincode" > ,: endorsement policy cannot be satisfied{code}   If Discovery is disabled this error doesn't happen.  ></description> </Issue>
