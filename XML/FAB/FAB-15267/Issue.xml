<Issue id="39492" key="FAB-15267" number="15267" project="10002" reporter="sykesm" assignee="dereckluo" creator="sykesm" type="10004" summary="mock generation should never reference foreign interfaces or traverse parent directories" priority="3" resolution="10000" status="6" created="2019-04-24 16:35:11.0" updated="2019-05-02 19:24:16.0" resolutiondate="2019-05-02 19:24:16.0" votes="0" watches="2" workflowId="52372"> <description><! CDATA As of current master, the following {{go:generate}} statements traverse parent directories.   {code} $ ag 'go:generate' | grep '\.\.' core/endorser/plugin_endorser.go:23://go:generate mockery -dir ../transientstore/ -name Store -case underscore -output mocks/ core/chaincode/chaincode_suite_test.go:68://go:generate mockery -dir ../common/ccprovider/ -name ChaincodeDefinition -case underscore -output mock/ -outpkg mock core/committer/txvalidator/v14/plugin_validator.go:27://go:generate mockery -dir ../plugin/ -name Mapper -case underscore -output mocks/ core/committer/txvalidator/v14/plugin_validator.go:28://go:generate mockery -dir ../../../handlers/validation/api/ -name PluginFactory -case underscore -output mocks/ core/committer/txvalidator/v14/plugin_validator.go:29://go:generate mockery -dir ../../../handlers/validation/api/ -name Plugin -case underscore -output mocks/ core/committer/txvalidator/v14/plugin_validator.go:65://go:generate mockery -dir ../../../handlers/validation/api/capabilities/ -name Capabilities -case underscore -output mocks/ core/committer/txvalidator/v14/plugin_validator.go:66://go:generate mockery -dir ../../../../msp/ -name IdentityDeserializer -case underscore -output mocks/ core/committer/txvalidator/v20/validator.go:81://go:generate mockery -dir ../../../ledger/ -name QueryExecutor -case underscore -output mocks/ core/committer/txvalidator/v20/validator.go:82://go:generate mockery -dir ../../../../common/policies/ -name ChannelPolicyManagerGetter -case underscore -output mocks/ core/committer/txvalidator/v20/valinforetriever/shim.go:14://go:generate mockery -dir ../plugindispatcher/ -name LifecycleResources -case underscore -output mocks/ core/committer/txvalidator/v20/plugindispatcher/plugin_validator.go:29://go:generate mockery -dir ../../plugin/ -name Mapper -case underscore -output mocks/ core/committer/txvalidator/v20/plugindispatcher/plugin_validator.go:30://go:generate mockery -dir ../../../../handlers/validation/api/ -name PluginFactory -case underscore -output mocks/ core/committer/txvalidator/v20/plugindispatcher/plugin_validator.go:31://go:generate mockery -dir ../../../../handlers/validation/api/ -name Plugin -case underscore -output mocks/ core/committer/txvalidator/v20/plugindispatcher/plugin_validator.go:69://go:generate mockery -dir ../../../../handlers/validation/api/capabilities/ -name Capabilities -case underscore -output mocks/ core/committer/txvalidator/v20/plugindispatcher/plugin_validator.go:70://go:generate mockery -dir ../../../../../msp/ -name IdentityDeserializer -case underscore -output mocks/ core/committer/txvalidator/v20/plugindispatcher/plugin_validator.go:71://go:generate mockery -dir ../../../../../common/policies/ -name ChannelPolicyManagerGetter -case underscore -output mocks/ core/handlers/validation/builtin/v12/validation_logic.go:47://go:generate mockery -dir ../../api/capabilities/ -name Capabilities -case underscore -output mocks/ core/handlers/validation/builtin/v12/validation_logic.go:48://go:generate mockery -dir ../../api/state/ -name StateFetcher -case underscore -output mocks/ core/handlers/validation/builtin/v12/validation_logic.go:49://go:generate mockery -dir ../../api/identities/ -name IdentityDeserializer -case underscore -output mocks/ core/handlers/validation/builtin/v12/validation_logic.go:50://go:generate mockery -dir ../../api/policies/ -name PolicyEvaluator -case underscore -output mocks/ core/handlers/validation/builtin/v13/validation_logic.go:30://go:generate mockery -dir ../../api/capabilities/ -name Capabilities -case underscore -output mocks/ core/handlers/validation/builtin/v13/validation_logic.go:31://go:generate mockery -dir ../../api/state/ -name StateFetcher -case underscore -output mocks/ core/handlers/validation/builtin/v13/validation_logic.go:32://go:generate mockery -dir ../../api/identities/ -name IdentityDeserializer -case underscore -output mocks/ core/handlers/validation/builtin/v13/validation_logic.go:33://go:generate mockery -dir ../../api/policies/ -name PolicyEvaluator -case underscore -output mocks/ core/handlers/validation/builtin/v20/validation_logic.go:28://go:generate mockery -dir ../../api/identities/ -name IdentityDeserializer -case underscore -output mocks/ core/handlers/validation/builtin/v20/validation_logic.go:30://go:generate mockery -dir ../../../../common/validation/statebased/ -name CollectionResources -case underscore -output mocks/ core/policy/application.go:32://go:generate mockery -dir ../../common/policies/ -name Policy -case underscore -output mocks/ core/policy/application.go:33://go:generate mockery -dir ../../common/policies/ -name ChannelPolicyManagerGetter -case underscore -output mocks/ core/policy/application.go:34://go:generate mockery -dir ../../common/policies/ -name Manager -case underscore -output mocks/ core/policy/application_test.go:23://go:generate mockery -dir ../../msp/ -name IdentityDeserializer -case underscore -output mocks/ core/policy/application_test.go:24://go:generate mockery -dir ../../msp/ -name Identity -case underscore -output mocks/ discovery/cmd/stub.go:21://go:generate mockery -dir ../client/ -name LocalResponse -case underscore -output mocks/ discovery/cmd/stub.go:22://go:generate mockery -dir ../client/ -name ChannelResponse -case underscore -output mocks/ discovery/api.go:30://go:generate mockery -name GossipSupport -case underscore -output ../support/mocks/ discovery/support/acl/support.go:107://go:generate mockery -name ChannelPolicyManagerGetter -case underscore  -output ../mocks/ gossip/privdata/coordinator.go:40://go:generate mockery -dir ../../core/common/privdata/ -name CollectionStore -case underscore -output mocks/ gossip/privdata/coordinator.go:41://go:generate mockery -dir ../../core/committer/ -name Committer -case underscore -output mocks/ gossip/privdata/reconcile.go:33://go:generate mockery -dir ../../core/ledger/ -name MissingPvtDataTracker -case underscore -output mocks/ gossip/privdata/reconcile.go:34://go:generate mockery -dir ../../core/ledger/ -name ConfigHistoryRetriever -case underscore -output mocks/ gossip/privdata/dataretriever.go:27://go:generate mockery -dir ../../core/transientstore/ -name RWSetScanner -case underscore -output mocks/ gossip/privdata/dataretriever.go:28://go:generate mockery -dir ../../core/ledger/ -name ConfigHistoryRetriever -case underscore -output mocks/ gossip/api/channel.go:21://go:generate mockery -dir . -name SecurityAdvisor -case underscore -output ../mocks/ internal/configtxgen/encoder/encoder_test.go:26://go:generate counterfeiter -o fakes/signer_serializer.go --fake-name SignerSerializer ../../pkg/identity SignerSerializer {code}  This introduces a latent dependency that is not discovered in the build process or testing that impacts refactoring.  The existing directives need to be evaluated and updated to place mocks in a subdirectory of the current folder using locally defined interfaces. Where the mock is for a foreign interface, a local interface that embeds the foreign interface should be declared in a test package and used to generate the mocks.  ></description> </Issue>
