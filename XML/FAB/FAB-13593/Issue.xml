<Issue id="36611" key="FAB-13593" number="13593" project="10002" reporter="sykesm" assignee="mne" creator="sykesm" type="10004" summary="intermittent test failure in SBE integration tests" priority="3" resolution="10000" status="6" created="2019-01-09 16:31:04.0" updated="2019-03-19 10:57:30.0" resolutiondate="2019-01-14 19:10:36.0" votes="0" watches="3" workflowId="48156"> <description><! CDATA Encountered in CR: https://gerrit.hyperledger.org/r/c/28569/  {code} 14:50:23  14:50:23 ------------------------------ 14:50:23 â€¢ Failure  71.623 seconds  14:50:23 SBE_E2E basic solo network with 2 orgs  It  executes a basic solo network with 2 orgs and SBE checks  14:50:23 /w/workspace/fabric-verify-integration-tests-x86_64/gopath/src/github.com/hyperledger/fabric/integration/sbe/sbe_test.go:74 14:50:23  14:50:23   Got stuck at: 14:50:23       foo 14:50:23        14:50:23   Waiting for: 14:50:23       val1 14:50:23  14:50:23   /w/workspace/fabric-verify-integration-tests-x86_64/gopath/src/github.com/hyperledger/fabric/integration/sbe/sbe_test.go:171 14:50:23 ------------------------------ 14:50:23  14:50:23  14:50:23 Summarizing 1 Failure: 14:50:23  14:50:23  Fail  SBE_E2E basic solo network with 2 orgs  It  executes a basic solo network with 2 orgs and SBE checks  14:50:23 /w/workspace/fabric-verify-integration-tests-x86_64/gopath/src/github.com/hyperledger/fabric/integration/sbe/sbe_test.go:171 {code}  It appears that we're invoking chaincode against an org1 peer and waiting for the commit and then go to org2's peer to do the query. The block doesn't get to org2's peer until after the query is initiated.  {code} 14:50:23 STEP: org1 sets the value of the key 14:50:23  e  Org1.peer0  2019-01-09 14:50:22.364 UTC  endorser  callChaincode -> INFO 0fd  testchannel  65faa67b  Entry chaincode: name:"mycc"  14:50:23  e  Org1.peer0  2019-01-09 14:50:22.365 UTC  endorser  callChaincode -> INFO 0fe  testchannel  65faa67b  Exit chaincode: name:"mycc"  (1ms) 14:50:23  e  Org1.peer0  2019-01-09 14:50:22.390 UTC  comm.grpc.server  1 -> INFO 0ff unary call completed {"grpc.start_time": "2019-01-09T14:50:22.363Z", "grpc.service": "protos.Endorser", "grpc.method": "ProcessProposal", "grpc.peer_address": "127.0.0.1:47754", "grpc.code": "OK", "grpc.call_duration": "27.123179ms"} 14:50:23  e  Org1.peer0  2019-01-09 14:50:22.401 UTC  gossip.privdata  StoreBlock -> INFO 100  testchannel  Received block  18  from buffer 14:50:23  e  Org2.peer0  2019-01-09 14:50:22.401 UTC  gossip.privdata  StoreBlock -> INFO 0d0  testchannel  Received block  18  from buffer 14:50:23  e  Org2.peer0  2019-01-09 14:50:22.402 UTC  committer.txvalidator  Validate -> INFO 0d1  testchannel  Validated block  18  in 0ms 14:50:23  e  Org1.peer0  2019-01-09 14:50:22.402 UTC  committer.txvalidator  Validate -> INFO 101  testchannel  Validated block  18  in 0ms 14:50:23  e  Org2.peer1  2019-01-09 14:50:22.405 UTC  gossip.privdata  StoreBlock -> INFO 094  testchannel  Received block  18  from buffer 14:50:23  e  Org1.peer1  2019-01-09 14:50:22.405 UTC  gossip.privdata  StoreBlock -> INFO 098  testchannel  Received block  18  from buffer 14:50:23  e  Org2.peer1  2019-01-09 14:50:22.406 UTC  committer.txvalidator  Validate -> INFO 095  testchannel  Validated block  18  in 1ms 14:50:23  e  Org1.peer1  2019-01-09 14:50:22.406 UTC  committer.txvalidator  Validate -> INFO 099  testchannel  Validated block  18  in 0ms 14:50:23  e  Org1.peer0  2019-01-09 14:50:22.461 UTC  kvledger  CommitWithPvtData -> INFO 102  testchannel  Committed block  18  with 1 transaction(s) in 58ms (state_validation=0ms block_commit=37ms state_commit=13ms) 14:50:23  e  peer-chaincode-invoke  2019-01-09 14:50:22.462 UTC  chaincodeCmd  ClientWait -> INFO 001 txid  65faa67b1ea8177835d67e700cddb9ec4ed67c613dbc20c3545d85222a8429ea  committed with status (VALID) at 127.0.0.1:30003 14:50:23  e  peer-chaincode-invoke  2019-01-09 14:50:22.462 UTC  chaincodeCmd  chaincodeInvokeOrQuery -> INFO 002 Chaincode invoke successful. result: status:200  14:50:23  e  Org1.peer0  2019-01-09 14:50:22.462 UTC  comm.grpc.server  1 -> INFO 103 streaming call completed {"grpc.start_time": "2019-01-09T14:50:22.391Z", "grpc.service": "protos.Deliver", "grpc.method": "DeliverFiltered", "grpc.request_deadline": "2019-01-09T14:50:52.391Z", "grpc.peer_address": "127.0.0.1:47756", "error": "context finished before block retrieved: context canceled", "grpc.code": "Unknown", "grpc.call_duration": "71.018912ms"} 14:50:23  e  OrdererOrg.orderer  2019-01-09 14:50:22.463 UTC  orderer.common.broadcast  Handle -> WARN 042 Error reading from 127.0.0.1:47540: rpc error: code = Canceled desc = context canceled 14:50:23  e  OrdererOrg.orderer  2019-01-09 14:50:22.463 UTC  comm.grpc.server  1 -> INFO 043 streaming call completed {"grpc.start_time": "2019-01-09T14:50:22.362Z", "grpc.service": "orderer.AtomicBroadcast", "grpc.method": "Broadcast", "grpc.peer_address": "127.0.0.1:47540", "error": "rpc error: code = Canceled desc = context canceled", "grpc.code": "Canceled", "grpc.call_duration": "100.601766ms"} 14:50:23 STEP: org2 checks that setting the value was successful by reading it 14:50:23  e  Org2.peer1  2019-01-09 14:50:22.467 UTC  kvledger  CommitWithPvtData -> INFO 096  testchannel  Committed block  18  with 1 transaction(s) in 59ms (state_validation=0ms block_commit=36ms state_commit=14ms) 14:50:23  e  Org2.peer0  2019-01-09 14:50:22.482 UTC  gossip.privdata  StoreBlock -> INFO 0d2  testchannel  Fetched all missing collection private write sets from remote peers for block  18  (79ms) 14:50:23  e  Org1.peer1  2019-01-09 14:50:22.482 UTC  kvledger  CommitWithPvtData -> INFO 09a  testchannel  Committed block  18  with 1 transaction(s) in 75ms (state_validation=0ms block_commit=39ms state_commit=14ms) 14:50:23  e  Org2.peer0  2019-01-09 14:50:22.522 UTC  endorser  callChaincode -> INFO 0d3  testchannel  c0b06aaa  Entry chaincode: name:"mycc"  14:50:23  e  Org2.peer0  2019-01-09 14:50:22.524 UTC  endorser  callChaincode -> INFO 0d4  testchannel  c0b06aaa  Exit chaincode: name:"mycc"  (1ms) 14:50:23  e  Org2.peer0  2019-01-09 14:50:22.524 UTC  comm.grpc.server  1 -> INFO 0d5 unary call completed {"grpc.start_time": "2019-01-09T14:50:22.522Z", "grpc.service": "protos.Endorser", "grpc.method": "ProcessProposal", "grpc.peer_address": "127.0.0.1:50924", "grpc.code": "OK", "grpc.call_duration": "2.346419ms"} 14:50:23  o  peer-chaincode-query  foo {code}  /cc  ~mne   ></description> </Issue>
