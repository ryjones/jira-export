<Issue id="40173" key="FAB-15564" number="15564" project="10002" reporter="nn77" assignee="naaman" creator="nn77" type="10004" summary="Peers randomly go offline permanently." priority="2" resolution="10000" status="6" created="2019-05-28 08:38:30.0" updated="2019-07-17 11:43:21.0" resolutiondate="2019-07-17 11:28:34.0" votes="6" watches="8" workflowId="53075"> <description><! CDATA Hello.  I have HLF network with 14 peers on openshift cluster. I noticed that some peers go offline and do not recover from this state. Howewer they are available on cluster network (I can telnet on their port and launch chaincode). But when I ask all peers with discover tool - it cannot connect to offline peers.     discover messages: {code:java} 2019-05-27 15:32:42.248 UTC  bccsp  initBCCSP -> DEBU 001 Initialize BCCSP  SW  2019-05-27 15:32:42.258 UTC  grpc  DialContext -> DEBU 002 parsed scheme: "" 2019-05-27 15:32:42.258 UTC  grpc  DialContext -> DEBU 003 scheme "" not registered, fallback to default scheme 2019-05-27 15:32:42.258 UTC  grpc  watcher -> DEBU 004 ccResolverWrapper: sending new addresses to cc:  {peer0-bch-org1:7051 0  <nil>}  2019-05-27 15:32:42.258 UTC  grpc  switchBalancer -> DEBU 005 ClientConn switching balancer to "pick_first" 2019-05-27 15:32:42.258 UTC  grpc  HandleSubConnStateChange -> DEBU 006 pickfirstBalancer: HandleSubConnStateChange: 0xc00020e470, CONNECTING 2019-05-27 15:32:42.260 UTC  grpc  HandleSubConnStateChange -> DEBU 007 pickfirstBalancer: HandleSubConnStateChange: 0xc00020e470, READY failed connecting to peer0-bch-org1:7051: discovery service refused our Request: rpc error: code = DeadlineExceeded desc = context deadline exceeded {code} offline peer log: {code:java} 2019-05-27 12:56:59.317 UTC  comm.grpc.server  1 -> INFO d3aaf unary call completed {"grpc.start_time": "2019-05-27T12:56:59.317Z", "grpc.service": "gossip.Gossip", "grpc.method": "Ping", "grpc.request_deadline": "2019-05-27T12:57:01.317Z", "grpc.peer_address": "10.130.2.97:33488", "grpc.code": "OK", "grpc.call_duration": "49.388µs"} 2019-05-27 12:56:59.328 UTC  comm.grpc.server  1 -> INFO d3ab0 unary call completed {"grpc.start_time": "2019-05-27T12:56:59.328Z", "grpc.service": "gossip.Gossip", "grpc.method": "Ping", "grpc.request_deadline": "2019-05-27T12:57:01.328Z", "grpc.peer_address": "10.130.1.246:54236", "grpc.code": "OK", "grpc.call_duration": "54.053µs"} 2019-05-27 12:57:16.429 UTC  gossip.channel  reportMembershipChanges -> INFO d3ab1 Membership view has changed. peers went offline:    peer0-bch-org2:7051    peer0-bch-org3:7051    , current view:    peer0-bch-org4:7051    peer0-bch-org14:7051    peer0-bch-org5:7051    peer0-bch-org6:7051    peer0-bch-org7:7051    peer0-bch-org8:7051    peer0-bch-org9:7051    peer0-bch-org10:7051    peer0-bch-org11:7051    peer0-bch-org12:7051    peer0-bch-org13:7051    2019-05-27 12:57:20.523 UTC  comm.grpc.server  1 -> INFO d3ab2 unary call completed {"grpc.start_time": "2019-05-27T12:57:20.523Z", "grpc.service": "gossip.Gossip", "grpc.method": "Ping", "grpc.request_deadline": "2019-05-27T12:57:22.523Z", "grpc.peer_address": "10.129.3.88:49544", "grpc.code": "OK", "grpc.call_duration": "51.024µs"} 2019-05-27 12:57:21.429 UTC  gossip.channel  reportMembershipChanges -> INFO d3ab3 Membership view has changed. peers went offline:    peer0-bch-org8:7051    , current view:    peer0-bch-org5:7051    peer0-bch-org4:7051    peer0-bch-org14:7051    peer0-bch-org6:7051    peer0-bch-org7:7051    peer0-bch-org12:7051    peer0-bch-org9:7051    peer0-bch-org10:7051    peer0-bch-org11:7051    peer0-bch-org13:7051    2019-05-27 12:57:24.265 UTC  comm.grpc.server  1 -> INFO d3ab4 unary call completed {"grpc.start_time": "2019-05-27T12:57:24.265Z", "grpc.service": "gossip.Gossip", "grpc.method": "Ping", "grpc.request_deadline": "2019-05-27T12:57:26.265Z", "grpc.peer_address": "10.129.3.73:45932", "grpc.code": "OK", "grpc.call_duration": "73.435µs"} 2019-05-27 12:57:24.291 UTC  comm.grpc.server  1 -> INFO d3ab5 unary call completed {"grpc.start_time": "2019-05-27T12:57:24.291Z", "grpc.service": "gossip.Gossip", "grpc.method": "Ping", "grpc.request_deadline": "2019-05-27T12:57:26.291Z", "grpc.peer_address": "10.130.2.98:41798", "grpc.code": "OK", "grpc.call_duration": "61.923µs"} 2019-05-27 12:57:26.429 UTC  gossip.channel  reportMembershipChanges -> INFO d3ab6 Membership view has changed. peers went offline:    peer0-bch-org4:7051    peer0-bch-org11:7051    peer0-bch-org13:7051    , current view:    peer0-bch-org5:7051    peer0-bch-org14:7051    peer0-bch-org6:7051    peer0-bch-org7:7051    peer0-bch-org10:7051    peer0-bch-org12:7051    peer0-bch-org9:7051    2019-05-27 12:57:31.429 UTC  gossip.channel  reportMembershipChanges -> INFO d3ab7 Membership view has changed. peers went offline:    peer0-bch-org14:7051    peer0-bch-org7:7051    , current view:    peer0-bch-org5:7051    peer0-bch-org6:7051    peer0-bch-org12:7051    peer0-bch-org9:7051    peer0-bch-org10:7051    2019-05-27 12:57:41.429 UTC  gossip.channel  reportMembershipChanges -> INFO d3ab8 Membership view has changed. peers went offline:    peer0-bch-org12:7051    peer0-bch-org10:7051    , current view:    peer0-bch-org9:7051    peer0-bch-org5:7051    peer0-bch-org6:7051    2019-05-27 12:57:51.429 UTC  gossip.channel  reportMembershipChanges -> INFO d3ab9 Membership view has changed. peers went offline:    peer0-bch-org5:7051    peer0-bch-org6:7051    peer0-bch-org9:7051    , current view:     2019-05-27 13:00:03.314 UTC  comm.grpc.server  1 -> INFO d3aba unary call completed {"grpc.start_time": "2019-05-27T13:00:03.314Z", "grpc.service": "discovery.Discovery", "grpc.method": "Discover", "grpc.request_deadline": "2019-05-27T13:00:13.311Z", "grpc.peer_address": "10.128.2.45:44750", "grpc.code": "OK", "grpc.call_duration": "777.351µs"} 2019-05-27 13:15:02.993 UTC  comm.grpc.server  1 -> INFO d3abb unary call completed {"grpc.start_time": "2019-05-27T13:15:02.992Z", "grpc.service": "discovery.Discovery", "grpc.method": "Discover", "grpc.request_deadline": "2019-05-27T13:15:12.988Z", "grpc.peer_address": "10.128.2.45:45004", "grpc.code": "OK", "grpc.call_duration": "701.159µs"} 2019-05-27 13:30:02.610 UTC  comm.grpc.server  1 -> INFO d3abc unary call completed {"grpc.start_time": "2019-05-27T13:30:02.609Z", "grpc.service": "discovery.Discovery", "grpc.method": "Discover", "grpc.request_deadline": "2019-05-27T13:30:12.606Z", "grpc.peer_address": "10.128.2.45:45394", "grpc.code": "OK", "grpc.call_duration": "702.133µs"} 2019-05-27 13:45:03.262 UTC  comm.grpc.server  1 -> INFO d3abd unary call completed {"grpc.start_time": "2019-05-27T13:45:03.261Z", "grpc.service": "discovery.Discovery", "grpc.method": "Discover", "grpc.request_deadline": "2019-05-27T13:45:13.258Z", "grpc.peer_address": "10.128.2.45:45678", "grpc.code": "OK", "grpc.call_duration": "640.234µs"} {code} This happens when peers are idle without any writes to blockchain.  Is there any opportunity to debug gossip, discovery? What causes this?     After restarting pod it works okay for some time.  ></description> </Issue>
