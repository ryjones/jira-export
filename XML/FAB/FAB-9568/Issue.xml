<Issue id="29471" key="FAB-9568" number="9568" project="10002" reporter="xixuejia" assignee="jyellick" creator="xixuejia" type="10003" summary="Collect orderer Broadcast count and latency" priority="3" resolution="10000" status="6" created="2018-04-18 05:04:17.0" updated="2018-11-28 21:06:10.0" resolutiondate="2018-11-28 21:06:03.0" votes="0" watches="3" workflowId="35703"> <description><! CDATA The Broadcast service is responsible for taking a stream of transactions from the user, validating them, and enqueuing them into the consensus implementation.  Therefore as a first set of metrics it makes sense to expose:  {noformat} validateDuration = metrics.HistogramOpts{ Namespace:    "broadcast", Name:         "validate_duration", Help:         "The time to validate a transaction.", LabelNames:     string{"channel", "type", "status"}, StatsdFormat: "%{#fqname}.%{channel}.%{type}.%{status}", } enqueueDuration = metrics.HistogramOpts{ Namespace:    "broadcast", Name:         "enqueue_duration", Help:         "The time to enqueue a transaction.", LabelNames:     string{"channel", "type", "status"}, StatsdFormat: "%{#fqname}.%{channel}.%{type}.%{status}", } processedCount = metrics.CounterOpts{ Namespace:    "broadcast", Name:         "processed_count", Help:         "The number of transactions processed.", LabelNames:     string{"channel", "type", "status"}, StatsdFormat: "%{#fqname}.%{channel}.%{type}.%{status}", } {noformat}  The {{validateDuration}} should include the time spent by the orderer after the Recv() has successfully returned with the client transaction through the time that the message has either been ruled invalid (returning an error status) or is ready to enqueue (either via the Order, or Configure consenter verbs).  This time contains the CPU intensive activities like validating signature, and unmarshaling message contents.  The {{enqueueDuration}} should include the time spent by the either Order or Configure consenter verbs.  There is no need to differentiate the verbs as the transaction type determines this.  This time contains whatever activities are performed by the underlying consensus implementation to consider the tx accepted.  The sum of the validationDuration and enqueueDuration will be the total processing time for the transaction in the Broadcast service, however, there is no obvious value in exposing this as an additional histogram value, and instead the sum of the two distributions should give a good picture of overall orderer health.  The {{processedCount}} should be a total count of the number of messages handled after Recv().  When there is an error decoding the transaction to determine the channel or type, these labels should be set to the value "unknown".    ></description> </Issue>
