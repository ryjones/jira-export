<Issue id="12906" key="FAB-604" number="604" project="10002" reporter="corecode" creator="corecode" type="10001" summary="sbft: detect that we are behind and need state transfer" priority="3" resolution="10000" status="6" created="2016-10-05 10:51:59.0" updated="2018-07-20 18:54:25.0" resolutiondate="2016-11-02 09:00:28.0" votes="0" watches="2" workflowId="36388"> <description><! CDATA From the code comment after processing the backlog:  We arrived here because either all is fine, we're with the pack.  Or we have messages in the backlog because we're connected asymmetrically, and a close replica already started talking about the next batch while we're still waiting for rounds to arrive for our current batch.  That's still fine.  We might also be here because we lost connectivity, and we either missed some messages, or our connection is bad and we should reconnect to get a working connection going again.   If a noFaultyQuorum (-1, because we're not faulty, just were disconnected) is backlogged, we know that we need to perform a state transfer.  Of course, f of these might be byzantine, and the remaining f that are not backlogged will allow us to get unstuck.  To check against that, we need to only consider backlogged replicas of which we have a hello message that talks about a future Seq.   We need to pick the highest Seq of all the hello messages we received, perform a state transfer to that Batch, and discard all backlogged messages that refer to a lower Seq.  Do we need to detect that a connection is stuck and we should reconnect?   ></description> </Issue>
