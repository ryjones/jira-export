<Issue id="40745" key="FAB-15783" number="15783" project="10002" reporter="marcello_romani_ocyan" creator="marcello_romani_ocyan" type="10004" summary="Container for chaincode built but chaincode list --instantiated -C mychannel returns empty list" priority="3" resolution="10204" status="6" created="2019-06-21 16:18:27.0" updated="2019-06-27 14:10:35.0" resolutiondate="2019-06-27 14:10:35.0" votes="0" watches="2" workflowId="53699"> <description><! CDATA I have a H/F network deployed on Kubernetes, composed of two orderers and two peers. The peers use CouchDB as state backend. The Fabric version I'm using is 1.4.0  I have a simple {{go}} chaincode that I can deploy and instantiate but not invoke, as it doesn't show up in the list of the instantiated chaincodes.  I omit the install command for brevity.  The instantiate command succeeds: {noformat} export CORE_PEER_ADDRESS=peer0.my.network:443 peer chaincode instantiate -n <ccname> -v <ccversion> -C mychannel -c <args> --tls --cafile /path/to/pem {noformat}  When issuing the instantiate command, the k8s logs for the {{peer0}} POD report:  {noformat} 2019-06-21 12:27:20.849 UTC  chaincode  LaunchConfig -> DEBU 1059 launchConfig: executable:"chaincode",Args: chaincode,-peer.address=10.0.3.216:7052 ,Envs: CORE_CHAINCODE_LOGGING_LEVEL=info,CORE_CHAINCODE_LOGGING_SHIM=warning,CORE_CHAINCODE_LOGGING_FORMAT=%{color}%{time:2006-01-02 15:04:05.000 MST}  %{module}  %{shortfunc} -> %{level:.4s} %{id:03x}%{color:reset} %{message},CORE_CHAINCODE_ID_NAME=helloworldcc:v17,CORE_PEER_TLS_ENABLED=false ,Files:   2019-06-21 12:27:20.849 UTC  chaincode  Start -> DEBU 105a start container: helloworldcc:v17 2019-06-21 12:27:20.849 UTC  chaincode  Start -> DEBU 105b start container with args: chaincode -peer.address=10.0.3.216:7052 2019-06-21 12:27:20.849 UTC  chaincode  Start -> DEBU 105c start container with env: 	CORE_CHAINCODE_LOGGING_LEVEL=info 	CORE_CHAINCODE_LOGGING_SHIM=warning 	CORE_CHAINCODE_LOGGING_FORMAT=%{color}%{time:2006-01-02 15:04:05.000 MST}  %{module}  %{shortfunc} -> %{level:.4s} %{id:03x}%{color:reset} %{message} 	CORE_CHAINCODE_ID_NAME=helloworldcc:v17 	CORE_PEER_TLS_ENABLED=false 2019-06-21 12:27:20.849 UTC  container  lockContainer -> DEBU 105d waiting for container(helloworldcc-v17) lock 2019-06-21 12:27:20.849 UTC  container  lockContainer -> DEBU 105e got container (helloworldcc-v17) lock 2019-06-21 12:27:20.850 UTC  dockercontroller  stopInternal -> DEBU 105f stopping container {"id": "nid1-peer0-mynetwork-helloworldcc-v17"} 2019-06-21 12:27:20.850 UTC  dockercontroller  stopInternal -> DEBU 1060 stop container result {"error": "No such container: nid1-peer0-mynetwork-helloworldcc-v17"} 2019-06-21 12:27:20.850 UTC  dockercontroller  stopInternal -> DEBU 1061 killing container {"id": "nid1-peer0-mynetwork-helloworldcc-v17"} 2019-06-21 12:27:20.851 UTC  dockercontroller  stopInternal -> DEBU 1062 kill container result {"id": "nid1-peer0-mynetwork-helloworldcc-v17", "error": "No such container: nid1-peer0-mynetwork-helloworldcc-v17"} 2019-06-21 12:27:20.851 UTC  dockercontroller  stopInternal -> DEBU 1063 removing container {"id": "nid1-peer0-mynetwork-helloworldcc-v17"} 2019-06-21 12:27:20.851 UTC  dockercontroller  stopInternal -> DEBU 1064 remove container result {"id": "nid1-peer0-mynetwork-helloworldcc-v17", "error": "No such container: nid1-peer0-mynetwork-helloworldcc-v17"} 2019-06-21 12:27:20.851 UTC  dockercontroller  createContainer -> DEBU 1065 create container {"imageID": "nid1-peer0-mynetwork-helloworldcc-v17-2d3074b2c8e2609cb5e37d98427c86bcb2cab06d7c6db38afcec728f7093fc52", "containerID": "nid1-peer0-mynetwork-helloworldcc-v17"} 2019-06-21 12:27:20.851 UTC  dockercontroller  getDockerHostConfig -> DEBU 1066 docker container hostconfig NetworkMode: host 2019-06-21 12:27:20.853 UTC  chaincode.platform  GenerateDockerfile -> DEBU 1067 FROM hyperledger/fabric-baseos:amd64-0.4.14 ADD binpackage.tar /usr/local/bin LABEL org.hyperledger.fabric.chaincode.id.name="helloworldcc" \ org.hyperledger.fabric.chaincode.id.version="v17" \ org.hyperledger.fabric.chaincode.type="GOLANG" \ org.hyperledger.fabric.version="1.4.0" \ org.hyperledger.fabric.base.version="0.4.14" ENV CORE_CHAINCODE_BUILDLEVEL=1.4.0 2019-06-21 12:27:20.855 UTC  chaincode.platform.golang  GenerateDockerBuild -> INFO 1068 building chaincode with ldflagsOpt: '-ldflags "-linkmode external -extldflags '-static'"' 2019-06-21 12:27:20.855 UTC  chaincode.platform.util  DockerBuild -> DEBU 1069 Attempting build with image hyperledger/fabric-ccenv:latest 2019-06-21 12:27:22.403 UTC  gossip.election  waitForInterrupt -> DEBU 106a c0dcb14894e9c78780e3950ea1170cb7b09a862422fc5fc1e4c77c93ec767f6c : Exiting 2019-06-21 12:27:22.459 UTC  gossip.election  IsLeader -> DEBU 106b c0dcb14894e9c78780e3950ea1170cb7b09a862422fc5fc1e4c77c93ec767f6c : Returning true 2019-06-21 12:27:22.493 UTC  msp  GetDefaultSigningIdentity -> DEBU 106c Obtaining default signing identity 2019-06-21 12:27:22.493 UTC  msp.identity  Sign -> DEBU 106d Sign: plaintext: 12096D796368616E6E656C1804A20132...120C08F7C38BDAB7BD8DD515106C1801 2019-06-21 12:27:22.493 UTC  msp.identity  Sign -> DEBU 106e Sign: digest: 7892305A8F9EBF350A271D4356D2D789A3BBA190185B7380EECBF020A1717350 2019-06-21 12:27:22.496 UTC  gossip.election  waitForInterrupt -> DEBU 106f c0dcb14894e9c78780e3950ea1170cb7b09a862422fc5fc1e4c77c93ec767f6c : Entering 2019-06-21 12:27:23.605 UTC  msp  GetDefaultSigningIdentity -> DEBU 1070 Obtaining default signing identity 2019-06-21 12:27:23.605 UTC  msp.identity  Sign -> DEBU 1071 Sign: plaintext: 18012A330A221A20C0DCB14894E9C787...6C120D08F7D3C4978BB58DD51510F402 2019-06-21 12:27:23.605 UTC  msp.identity  Sign -> DEBU 1072 Sign: digest: 4427785A085140D2CA45935FFDC7EA9C8DAF53F02A45EAACBADF51A82594723C 2019-06-21 12:27:23.605 UTC  msp  GetDefaultSigningIdentity -> DEBU 1073 Obtaining default signing identity 2019-06-21 12:27:23.605 UTC  msp.identity  Sign -> DEBU 1074 Sign: plaintext: 0A0F31302E302E332E3231363A37303531 2019-06-21 12:27:23.605 UTC  msp.identity  Sign -> DEBU 1075 Sign: digest: 6FCDC791755967AEF545A99BDF3E954E1C9E6249489E1905D6EDBD00BCE195D1 2019-06-21 12:27:24.516 UTC  gossip.discovery  periodicalReconnectToDead -> DEBU 1076 Sleeping 25s 2019-06-21 12:27:24.586 UTC  msp  GetDefaultSigningIdentity -> DEBU 1077 Obtaining default signing identity 2019-06-21 12:27:24.586 UTC  msp.identity  Sign -> DEBU 1078 Sign: plaintext: 18012A330A221A20C0DCB14894E9C787...6C120D08F7D3C4978BB58DD51510F502 2019-06-21 12:27:24.586 UTC  msp.identity  Sign -> DEBU 1079 Sign: digest: 373BEB535E9EAD679E241D908B745392BEEB9C85B885D90786C9A76F1D10444B 2019-06-21 12:27:24.586 UTC  msp  GetDefaultSigningIdentity -> DEBU 107a Obtaining default signing identity 2019-06-21 12:27:24.586 UTC  msp.identity  Sign -> DEBU 107b Sign: plaintext: 0A0F31302E302E332E3231363A37303531 2019-06-21 12:27:24.586 UTC  msp.identity  Sign -> DEBU 107c Sign: digest: 6FCDC791755967AEF545A99BDF3E954E1C9E6249489E1905D6EDBD00BCE195D1 2019-06-21 12:27:24.586 UTC  gossip.discovery  periodicalSendAlive -> DEBU 107d Sleeping 5s 2019-06-21 12:27:26.340 UTC  gossip.privdata  run -> DEBU 107e Start reconcile missing private info 2019-06-21 12:27:26.340 UTC  leveldbhelper  GetIterator -> DEBU 107f Getting iterator for range    byte{0x6d, 0x79, 0x63, 0x68, 0x61, 0x6e, 0x6e, 0x65, 0x6c, 0x0, 0x4, 0x8}  -    byte{0x6d, 0x79, 0x63, 0x68, 0x61, 0x6e, 0x6e, 0x65, 0x6c, 0x0, 0x4, 0x8}  2019-06-21 12:27:26.340 UTC  gossip.privdata  reconcile -> DEBU 1080 Reconciliation cycle finished successfully. no items to reconcile 2019-06-21 12:27:27.531 UTC  gossip.election  waitForInterrupt -> DEBU 1081 c0dcb14894e9c78780e3950ea1170cb7b09a862422fc5fc1e4c77c93ec767f6c : Exiting 2019-06-21 12:27:27.531 UTC  gossip.election  IsLeader -> DEBU 1082 c0dcb14894e9c78780e3950ea1170cb7b09a862422fc5fc1e4c77c93ec767f6c : Returning true 2019-06-21 12:27:27.531 UTC  msp  GetDefaultSigningIdentity -> DEBU 1083 Obtaining default signing identity 2019-06-21 12:27:27.531 UTC  msp.identity  Sign -> DEBU 1084 Sign: plaintext: 12096D796368616E6E656C1804A20132...120C08F7C38BDAB7BD8DD515106D1801 2019-06-21 12:27:27.531 UTC  msp.identity  Sign -> DEBU 1085 Sign: digest: A6FCCA5CBC5CA2AFA5BCADFF48784431F01364535513DE6B9BDF3B30AA9D214E 2019-06-21 12:27:27.533 UTC  gossip.election  waitForInterrupt -> DEBU 1086 c0dcb14894e9c78780e3950ea1170cb7b09a862422fc5fc1e4c77c93ec767f6c : Entering 2019-06-21 12:27:27.617 UTC  msp  GetDefaultSigningIdentity -> DEBU 1087 Obtaining default signing identity 2019-06-21 12:27:27.617 UTC  msp.identity  Sign -> DEBU 1088 Sign: plaintext: 18012A330A221A20C0DCB14894E9C787...6C120D08F7D3C4978BB58DD51510F602 2019-06-21 12:27:27.617 UTC  msp.identity  Sign -> DEBU 1089 Sign: digest: F6CF87A896945F468B101C1EEAD4D86E5481EDEB757B7F00CEE721F9634B0AD4 2019-06-21 12:27:27.617 UTC  msp  GetDefaultSigningIdentity -> DEBU 108a Obtaining default signing identity 2019-06-21 12:27:27.617 UTC  msp.identity  Sign -> DEBU 108b Sign: plaintext: 0A0F31302E302E332E3231363A37303531 2019-06-21 12:27:27.617 UTC  msp.identity  Sign -> DEBU 108c Sign: digest: 6FCDC791755967AEF545A99BDF3E954E1C9E6249489E1905D6EDBD00BCE195D1 2019-06-21 12:27:29.587 UTC  msp  GetDefaultSigningIdentity -> DEBU 108d Obtaining default signing identity 2019-06-21 12:27:29.587 UTC  msp.identity  Sign -> DEBU 108e Sign: plaintext: 18012A330A221A20C0DCB14894E9C787...6C120D08F7D3C4978BB58DD51510F702 2019-06-21 12:27:29.587 UTC  msp.identity  Sign -> DEBU 108f Sign: digest: C92704E2A755F0FB1F1B636A448340CD231579BE01DCCAC8D01CC217D6EEB8B6 2019-06-21 12:27:29.587 UTC  msp  GetDefaultSigningIdentity -> DEBU 1090 Obtaining default signing identity 2019-06-21 12:27:29.587 UTC  msp.identity  Sign -> DEBU 1091 Sign: plaintext: 0A0F31302E302E332E3231363A37303531 2019-06-21 12:27:29.587 UTC  msp.identity  Sign -> DEBU 1092 Sign: digest: 6FCDC791755967AEF545A99BDF3E954E1C9E6249489E1905D6EDBD00BCE195D1 2019-06-21 12:27:29.587 UTC  gossip.discovery  periodicalSendAlive -> DEBU 1093 Sleeping 5s 2019-06-21 12:27:30.586 UTC  chaincode.platform.util  DockerBuild -> DEBU 1094 Build output is # idv /tmp/go-link-282808672/000001.o: In function `pluginOpen': /workdir/go/src/plugin/plugin_dlopen.go:19: warning: Using 'dlopen' in statically linked applications requires at runtime the shared libraries from the glibc version used for linking /tmp/go-link-282808672/000021.o: In function `mygetgrouplist': /workdir/go/src/os/user/getgrouplist_unix.go:16: warning: Using 'getgrouplist' in statically linked applications requires at runtime the shared libraries from the glibc version used for linking /tmp/go-link-282808672/000020.o: In function `mygetgrgid_r': /workdir/go/src/os/user/cgo_lookup_unix.go:38: warning: Using 'getgrgid_r' in statically linked applications requires at runtime the shared libraries from the glibc version used for linking /tmp/go-link-282808672/000020.o: In function `mygetgrnam_r': /workdir/go/src/os/user/cgo_lookup_unix.go:43: warning: Using 'getgrnam_r' in statically linked applications requires at runtime the shared libraries from the glibc version used for linking /tmp/go-link-282808672/000020.o: In function `mygetpwnam_r': /workdir/go/src/os/user/cgo_lookup_unix.go:33: warning: Using 'getpwnam_r' in statically linked applications requires at runtime the shared libraries from the glibc version used for linking /tmp/go-link-282808672/000020.o: In function `mygetpwuid_r': /workdir/go/src/os/user/cgo_lookup_unix.go:28: warning: Using 'getpwuid_r' in statically linked applications requires at runtime the shared libraries from the glibc version used for linking /tmp/go-link-282808672/000006.o: In function `_cgo_18049202ccd9_C2func_getaddrinfo': /tmp/go-build/cgo-gcc-prolog:49: warning: Using 'getaddrinfo' in statically linked applications requires at runtime the shared libraries from the glibc version used for linking 2019-06-21 12:27:31.618 UTC  msp  GetDefaultSigningIdentity -> DEBU 1095 Obtaining default signing identity 2019-06-21 12:27:31.618 UTC  msp.identity  Sign -> DEBU 1096 Sign: plaintext: 18012A330A221A20C0DCB14894E9C787...6C120D08F7D3C4978BB58DD51510F802 2019-06-21 12:27:31.618 UTC  msp.identity  Sign -> DEBU 1097 Sign: digest: 4592B387C3A76105362698A5880349843A09570FFF410171D3FC7D5D1D1194D4 2019-06-21 12:27:31.618 UTC  msp  GetDefaultSigningIdentity -> DEBU 1098 Obtaining default signing identity 2019-06-21 12:27:31.618 UTC  msp.identity  Sign -> DEBU 1099 Sign: plaintext: 0A0F31302E302E332E3231363A37303531 2019-06-21 12:27:31.618 UTC  msp.identity  Sign -> DEBU 109a Sign: digest: 6FCDC791755967AEF545A99BDF3E954E1C9E6249489E1905D6EDBD00BCE195D1 2019-06-21 12:27:32.533 UTC  gossip.election  waitForInterrupt -> DEBU 109b c0dcb14894e9c78780e3950ea1170cb7b09a862422fc5fc1e4c77c93ec767f6c : Exiting 2019-06-21 12:27:32.533 UTC  gossip.election  IsLeader -> DEBU 109c c0dcb14894e9c78780e3950ea1170cb7b09a862422fc5fc1e4c77c93ec767f6c : Returning true 2019-06-21 12:27:32.533 UTC  msp  GetDefaultSigningIdentity -> DEBU 109d Obtaining default signing identity 2019-06-21 12:27:32.533 UTC  msp.identity  Sign -> DEBU 109e Sign: plaintext: 12096D796368616E6E656C1804A20132...120C08F7C38BDAB7BD8DD515106E1801 2019-06-21 12:27:32.533 UTC  msp.identity  Sign -> DEBU 109f Sign: digest: 92E573B8F00A1040E5459661D2606BD8F6C95121A9C71D70036CDE475ED37DB6 2019-06-21 12:27:32.533 UTC  gossip.election  waitForInterrupt -> DEBU 10a0 c0dcb14894e9c78780e3950ea1170cb7b09a862422fc5fc1e4c77c93ec767f6c : Entering 2019-06-21 12:27:32.564 UTC  dockercontroller  deployImage -> DEBU 10a1 Created image: nid1-peer0-mynetwork-helloworldcc-v17-2d3074b2c8e2609cb5e37d98427c86bcb2cab06d7c6db38afcec728f7093fc52 2019-06-21 12:27:32.564 UTC  dockercontroller  createContainer -> DEBU 10a2 create container {"imageID": "nid1-peer0-mynetwork-helloworldcc-v17-2d3074b2c8e2609cb5e37d98427c86bcb2cab06d7c6db38afcec728f7093fc52", "containerID": "nid1-peer0-mynetwork-helloworldcc-v17"} 2019-06-21 12:27:32.565 UTC  dockercontroller  getDockerHostConfig -> DEBU 10a3 docker container hostconfig NetworkMode: host 2019-06-21 12:27:32.623 UTC  dockercontroller  createContainer -> DEBU 10a4 created container {"imageID": "nid1-peer0-mynetwork-helloworldcc-v17-2d3074b2c8e2609cb5e37d98427c86bcb2cab06d7c6db38afcec728f7093fc52", "containerID": "nid1-peer0-mynetwork-helloworldcc-v17"} 2019-06-21 12:27:32.810 UTC  dockercontroller  Start -> DEBU 10a5 Started container nid1-peer0-mynetwork-helloworldcc-v17 2019-06-21 12:27:32.810 UTC  container  unlockContainer -> DEBU 10a6 container lock deleted(helloworldcc-v17) 2019-06-21 12:27:32.826 UTC  chaincode  handleMessage -> DEBU 10a7    Fabric side handling ChaincodeMessage of type: REGISTER in state created 2019-06-21 12:27:32.826 UTC  chaincode  HandleRegister -> DEBU 10a8 Received REGISTER in state created 2019-06-21 12:27:32.826 UTC  chaincode  Register -> DEBU 10a9 registered handler complete for chaincode helloworldcc:v17 2019-06-21 12:27:32.826 UTC  chaincode  HandleRegister -> DEBU 10aa Got REGISTER for chaincodeID = name:"helloworldcc:v17" , sending back REGISTERED 2019-06-21 12:27:32.827 UTC  chaincode  HandleRegister -> DEBU 10ab Changed state to established for name:"helloworldcc:v17" 2019-06-21 12:27:32.827 UTC  chaincode  sendReady -> DEBU 10ac sending READY for chaincode name:"helloworldcc:v17" 2019-06-21 12:27:32.827 UTC  chaincode  sendReady -> DEBU 10ad Changed to state ready for chaincode name:"helloworldcc:v17" 2019-06-21 12:27:32.827 UTC  chaincode  Launch -> DEBU 10ae launch complete 2019-06-21 12:27:32.827 UTC  chaincode  Execute -> DEBU 10af Entry 2019-06-21 12:27:32.827 UTC  chaincode  handleMessage -> DEBU 10b0  2da2620e  Fabric side handling ChaincodeMessage of type: COMPLETED in state ready 2019-06-21 12:27:32.827 UTC  chaincode  Notify -> DEBU 10b1  2da2620e  notifying Txid:2da2620e22076b33e1de11f4af7c5cafc8af79a6f6c25aa1c895b456ee7154c2, channelID:mychannel 2019-06-21 12:27:32.827 UTC  chaincode  Execute -> DEBU 10b2 Exit 2019-06-21 12:27:32.827 UTC  endorser  callChaincode -> INFO 10b3  mychannel  2da2620e  Exit chaincode: name:"lscc"  (11983ms) 2019-06-21 12:27:32.827 UTC  lockbasedtxmgr  GetTxSimulationResults -> DEBU 10b4 Simulation completed, getting simulation results 2019-06-21 12:27:32.827 UTC  lockbasedtxmgr  Done -> DEBU 10b5 Done with transaction simulation / query execution  2da2620e22076b33e1de11f4af7c5cafc8af79a6f6c25aa1c895b456ee7154c2  2019-06-21 12:27:32.828 UTC  endorser  SimulateProposal -> DEBU 10b6  mychannel  2da2620e  Exit {noformat}  I've read the log carefully and from my understanding: * the chaincode conatiner is successfully built * the chaincode container is successfully started * no information about the started chaincode container is added to couchdb  I've also looked around the kubernetes cluster but I couldn't find traces of the chaincode container or its image.  *UPDATE*  I managed to access the docker server on the K8s worker node, and the images are built, the container running. The 'chaincode' binary inside the container seems to be stuck while trying to send a {{REGISTER}} message to the peer node 7052 port  *UPDATE 2*  The {{REGISTER}} message is received and acknowledged by the peer, but the chaincode is not registered within couchdb.  ></description> </Issue>
