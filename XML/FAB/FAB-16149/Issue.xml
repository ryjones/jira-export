<Issue id="41541" key="FAB-16149" number="16149" project="10002" reporter="sstone1" creator="sstone1" type="10004" summary="ProposalResponsePayloads do not match error when chaincode build failed" priority="3" resolution="10000" status="6" created="2019-07-31 12:14:16.0" updated="2019-08-02 09:26:17.0" resolutiondate="2019-07-31 18:38:11.0" votes="0" watches="1" workflowId="54558"> <description><! CDATA The fabric-samples CI intermittently fails with the following error:  {noformat} 12:07:21  Error: could not assemble transaction: ProposalResponsePayloads do not match - proposal response: version:1 response:<status:200 > payload:"\n \254\321TK\331\230\232\\\300H`v\262\315\315\3259\345\272\252\020\347L\231\202\00532C\352\317u\022\315\007\n\266\007\022\233\007\n\006fabcar\022\220\007\032Y\n\004CAR0\032Q{\"color\":\"blue\",\"make\":\"Toyota\",\"model\":\"Prius\",\"owner\":\"Tomoko\",\"docType\":\"car\"}\032V\n\004CAR1\032N{\"color\":\"red\",\"make\":\"Ford\",\"model\":\"Mustang\",\"owner\":\"Brad\",\"docType\":\"car\"}\032 \n\004CAR2\032U{\"color\":\"green\",\"make\":\"Hyundai\",\"model\":\"Tucson\",\"owner\":\"Jin Soo\",\"docType\":\"car\"}\032 \n\004CAR3\032U{\"color\":\"yellow\",\"make\":\"Volkswagen\",\"model\":\"Passat\",\"owner\":\"Max\",\"docType\":\"car\"}\032V\n\004CAR4\032N{\"color\":\"black\",\"make\":\"Tesla\",\"model\":\"S\",\"owner\":\"Adriana\",\"docType\":\"car\"}\032Z\n\004CAR5\032R{\"color\":\"purple\",\"make\":\"Peugeot\",\"model\":\"205\",\"owner\":\"Michel\",\"docType\":\"car\"}\032W\n\004CAR6\032O{\"color\":\"white\",\"make\":\"Chery\",\"model\":\"S22L\",\"owner\":\"Aarav\",\"docType\":\"car\"}\032W\n\004CAR7\032O{\"color\":\"violet\",\"make\":\"Fiat\",\"model\":\"Punto\",\"owner\":\"Pari\",\"docType\":\"car\"}\032Y\n\004CAR8\032Q{\"color\":\"indigo\",\"make\":\"Tata\",\"model\":\"Nano\",\"owner\":\"Valeria\",\"docType\":\"car\"}\032\\\n\004CAR9\032T{\"color\":\"brown\",\"make\":\"Holden\",\"model\":\"Barina\",\"owner\":\"Shotaro\",\"docType\":\"car\"}\022\026\n\004lscc\022\016\n\014\n\006fabcar\022\002\010\003\032\003\010\310\001\"\r\022\006fabcar\032\0031.0" endorsement:<endorser:"\n\007Org1MSP\022\252\006-----BEGIN CERTIFICATE-----\nMIICKDCCAc+gAwIBAgIRAKkeTW8txtSGvUOPLQ4Z58gwCgYIKoZIzj0EAwIwczEL\nMAkGA1UEBhMCVVMxEzARBgNVBAgTCkNhbGlmb3JuaWExFjAUBgNVBAcTDVNhbiBG\ncmFuY2lzY28xGTAXBgNVBAoTEG9yZzEuZXhhbXBsZS5jb20xHDAaBgNVBAMTE2Nh\nLm9yZzEuZXhhbXBsZS5jb20wHhcNMTkwNzMxMTEwMDAwWhcNMjkwNzI4MTEwMDAw\nWjBqMQswCQYDVQQGEwJVUzETMBEGA1UECBMKQ2FsaWZvcm5pYTEWMBQGA1UEBxMN\nU2FuIEZyYW5jaXNjbzENMAsGA1UECxMEcGVlcjEfMB0GA1UEAxMWcGVlcjAub3Jn\nMS5leGFtcGxlLmNvbTBZMBMGByqGSM49AgEGCCqGSM49AwEHA0IABAeS3F0NRcgs\npaC20BHbvXz59x6ys5sZ+6JT3G7sCDaGW4zuOQLBs1hhLvF0R51XixazRkibM7Fv\nYXl9ggR5GRKjTTBLMA4GA1UdDwEB/wQEAwIHgDAMBgNVHRMBAf8EAjAAMCsGA1Ud\nIwQkMCKAIGZYVgiiqBcXBqDUmMDPK+tit989TvnSi9nUknNwywaBMAoGCCqGSM49\nBAMCA0cAMEQCIAfD9XXNI6OX2EfDm2/xRyxYBbcI9V3lInalpzaFDEgTAiAsvqNQ\n038cQxFjvxa72QbYz/F5i2T9CAZ/8Bla/tIUsQ==\n-----END CERTIFICATE-----\n" signature:"0E\002!\000\315\313Om\332rc\315\323\1775R\352>\301\354n\244\334n\311\237<\312\204 \324!.\306*x\002 \\\333/\237\350{W\262x\202\335\302H\177\027\232@;\224\250\264CB\277\303\250UB\306\235\342^" >  {noformat}  The error suggests that the smart contract is non-deterministic, but actually, the chaincode is failing during build time:  {noformat}  31m2019-07-31 11:06:43.872 UTC  endorser  SimulateProposal -> ERRO 068 0m  mychannel  1534454a  failed to invoke chaincode name:"fabcar" , error: Failed to generate platform-specific docker build: Error returned from build: 1 " > @ampretia/x509@0.4.0 install /chaincode/output/node_modules/@ampretia/x509 > node-gyp rebuild  gyp WARN install got an error, rolling back install gyp ERR! configure error  gyp ERR! stack Error: unexpected end of file gyp ERR! stack     at Gunzip.zlibOnError (zlib.js:153:15) gyp ERR! System Linux 4.4.0-97-generic gyp ERR! command "/usr/local/bin/node" "/usr/local/lib/node_modules/npm/node_modules/node-gyp/bin/node-gyp.js" "rebuild" gyp ERR! cwd /chaincode/output/node_modules/@ampretia/x509 gyp ERR! node -v v8.11.3 gyp ERR! node-gyp -v v3.6.2 gyp ERR! not ok  npm WARN fabcar@1.0.0 No repository field. {noformat}  This is happening because the CLI is only checking the response status from the first peer, and then goes on to ensure that all payloads from all peers match. In this case, the peer that fails to build the chaincode is not the first peer, it has an empty payload, and this fails to match with the "proper" payload from the first peer which did not have the same problem.  ></description> </Issue>
