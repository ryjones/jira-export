<Issue id="36917" key="FAB-13745" number="13745" project="10002" reporter="sykesm" assignee="mastersingh24" creator="sykesm" type="10004" summary="concurrent map read and write in gossip tests" priority="3" resolution="10000" status="6" created="2019-01-17 21:09:31.0" updated="2019-03-19 10:57:41.0" resolutiondate="2019-01-21 14:55:48.0" votes="0" watches="2" workflowId="48482"> <description><! CDATA Hit during CR build: https://gerrit.hyperledger.org/r/c/28798/  {code} 20:45:06 fatal error: concurrent map read and map write 20:45:06  20:45:06 goroutine 33056  running : 20:45:06 runtime.throw(0xf00391, 0x21) 20:45:06 	/opt/go/go1.11.1.linux.amd64/src/runtime/panic.go:608 +0x72 fp=0xc0034fb930 sp=0xc0034fb900 pc=0x77f9c2 20:45:06 runtime.mapaccess1_faststr(0xdec3e0, 0xc001a2a8a0, 0xc0003992d0, 0xf, 0xc003748410) 20:45:06 	/opt/go/go1.11.1.linux.amd64/src/runtime/map_faststr.go:21 +0x418 fp=0xc0034fb9a0 sp=0xc0034fb930 pc=0x765698 20:45:06 github.com/hyperledger/fabric/gossip/gossip.(*configurableCryptoService).OrgByPeerIdentity(0xc0048700e0, 0xc0003992d0, 0xf, 0x10, 0xc08b3fc34, 0x16ff040, 0x34630c7df77) 20:45:06 	/w/workspace/fabric-verify-unit-tests-x86_64/gopath/src/github.com/hyperledger/fabric/gossip/gossip/orgs_test.go:52 +0x4e fp=0xc0034fb9d8 sp=0xc0034fb9a0 pc=0xd1367e 20:45:06 github.com/hyperledger/fabric/gossip/identity.(*identityMapperImpl).Put(0xc0039b5d50, 0xc0003992c0, 0xf, 0x10, 0xc0003992d0, 0xf, 0x10, 0x0, 0x0) 20:45:06 	/w/workspace/fabric-verify-unit-tests-x86_64/gopath/src/github.com/hyperledger/fabric/gossip/identity/identity.go:147 +0x2ec fp=0xc0034fba98 sp=0xc0034fb9d8 pc=0xc93e0c 20:45:06 github.com/hyperledger/fabric/gossip/comm.(*commImpl).authenticateRemotePeer(0xc00473d8c0, 0x7f72c72651b0, 0xc0024ffff0, 0x7f72c7265101, 0xc0024ffff0, 0x0, 0xfb6a80) 20:45:06 	/w/workspace/fabric-verify-unit-tests-x86_64/gopath/src/github.com/hyperledger/fabric/gossip/comm/comm_impl.go:472 +0x6f1 fp=0xc0034fbcc8 sp=0xc0034fba98 pc=0xc9a671 20:45:06 github.com/hyperledger/fabric/gossip/comm.(*commImpl).Handshake(0xc00473d8c0, 0xc000b7a7b0, 0x0, 0x0, 0x0, 0x0, 0x0) 20:45:06 	/w/workspace/fabric-verify-unit-tests-x86_64/gopath/src/github.com/hyperledger/fabric/gossip/comm/comm_impl.go:320 +0x49c fp=0xc0034fbdb0 sp=0xc0034fbcc8 pc=0xc9921c 20:45:06 github.com/hyperledger/fabric/gossip/gossip.(*gossipServiceImpl).connect2BootstrapPeers.func1(0x18, 0xc004184ea0, 0xc0036c6f40) 20:45:06 	/w/workspace/fabric-verify-unit-tests-x86_64/gopath/src/github.com/hyperledger/fabric/gossip/gossip/gossip_impl.go:1141 +0xa9 fp=0xc0034fbe90 sp=0xc0034fbdb0 pc=0xd1b3a9 20:45:06 github.com/hyperledger/fabric/gossip/discovery.(*gossipDiscoveryImpl).Connect.func1(0xc005a80c80, 0xc0025e8300, 0xc0036c6f40, 0xf, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, ...) 20:45:06 	/w/workspace/fabric-verify-unit-tests-x86_64/gopath/src/github.com/hyperledger/fabric/gossip/discovery/discovery_impl.go:159 +0x8e fp=0xc0034fbf70 sp=0xc0034fbe90 pc=0xcb161e 20:45:06 runtime.goexit() 20:45:06 	/opt/go/go1.11.1.linux.amd64/src/runtime/asm_amd64.s:1333 +0x1 fp=0xc0034fbf78 sp=0xc0034fbf70 pc=0x7af8a1 20:45:06 created by github.com/hyperledger/fabric/gossip/discovery.(*gossipDiscoveryImpl).Connect 20:45:06 	/w/workspace/fabric-verify-unit-tests-x86_64/gopath/src/github.com/hyperledger/fabric/gossip/discovery/discovery_impl.go:157 +0x2a4 20:45:06  20:45:06 goroutine 1  chan receive : 20:45:06 testing.tRunner.func1(0xc00013a500) 20:45:06 	/opt/go/go1.11.1.linux.amd64/src/testing/testing.go:803 +0x1f3 20:45:06 testing.tRunner(0xc00013a500, 0xc0000bdda0) 20:45:06 	/opt/go/go1.11.1.linux.amd64/src/testing/testing.go:831 +0xc9 20:45:06 testing.runTests(0xc00000d5a0, 0x16b8440, 0x1b, 0x1b, 0x75f45f) 20:45:06 	/opt/go/go1.11.1.linux.amd64/src/testing/testing.go:1117 +0x2aa 20:45:06 testing.(*M).Run(0xc000132200, 0x0) 20:45:06 	/opt/go/go1.11.1.linux.amd64/src/testing/testing.go:1034 +0x165 20:45:06 main.main() 20:45:06 	_testmain.go:150 +0x205 20:45:06  {code}  ></description> </Issue>
