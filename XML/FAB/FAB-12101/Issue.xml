<Issue id="33994" key="FAB-12101" number="12101" project="10002" reporter="denyeart" assignee="ales" creator="denyeart" type="10004" summary="Errors in log with invalid state-based endorsement" priority="3" resolution="10000" status="6" created="2018-09-22 10:05:50.0" updated="2018-10-08 02:07:33.0" resolutiondate="2018-10-08 02:07:33.0" votes="0" watches="1" workflowId="45313"> <description><! CDATA  Using chaincode with state-based endorsement, if I attempt to commit a transaction without the necessary state-based endorsement, the transaction gets invalidated as expected, however there are some ugly errors in the log that are unexpected.     2018-09-22 05:52:12.770 EDT  committer/txvalidator  VSCCValidateTxForCC -> DEBU 438 Validating Tx 9e4aaf26fc09228b955bba2ec237c0a95051d55e6dd5348d22647ec2e01fa3ae, seq 0 out of 1 in block 5 for channel myc with validation plugin vscc with plugin 2018-09-22 05:52:12.770 EDT  lockbasedtxmgr  newQueryExecutor -> DEBU 439 constructing new query executor txid =  34004c4b-15ba-400f-b431-e26dd8356d80  2018-09-22 05:52:12.771 EDT  stateleveldb  GetState -> DEBU 43a GetState(). ns=marbles, key=marble2 2018-09-22 05:52:12.771 EDT  lockbasedtxmgr  Done -> DEBU 43b Done with transaction simulation / query execution  34004c4b-15ba-400f-b431-e26dd8356d80  {color:#de350b}2018-09-22 05:52:12.771 EDT  vscc  Validate -> ERRO 43c VSCC error: stateBasedValidator.Validate failed, err %!s(<nil>){color} {color:#de350b}2018-09-22 05:52:12.771 EDT  vscc  Validate -> DEBU 43d block 5, namespace: marbles, tx 0 validation results is: validation of key marble2 (coll'':ns'marbles') in tx 5:0 failed: Error unmarshaling to SignaturePolicy: proto: common.SignaturePolicyEnvelope: illegal tag 0 (wire type 0){color} {color:#de350b}2018-09-22 05:52:12.771 EDT  committer/txvalidator  ValidateWithPlugin -> DEBU 43e Transaction 9e4aaf26fc09228b955bba2ec237c0a95051d55e6dd5348d22647ec2e01fa3ae appears to be invalid: validation of key marble2 (coll'':ns'marbles') in tx 5:0 failed: Error unmarshaling to SignaturePolicy: proto: common.SignaturePolicyEnvelope: illegal tag 0 (wire type 0){color} 2018-09-22 05:52:12.771 EDT  committer/txvalidator  VSCCValidateTx -> DEBU 43f VSCCValidateTx completes env bytes 0xc422952c80 {color:#de350b}2018-09-22 05:52:12.771 EDT  committer/txvalidator  validateTx -> ERRO 440 VSCCValidateTx for transaction txId = 9e4aaf26fc09228b955bba2ec237c0a95051d55e6dd5348d22647ec2e01fa3ae returned error: validation of key marble2 (coll'':ns'marbles') in tx 5:0 failed: Error unmarshaling to SignaturePolicy: proto: common.SignaturePolicyEnvelope: illegal tag 0 (wire type 0){color} 2018-09-22 05:52:12.771 EDT  committer/txvalidator  validateTx -> DEBU 441 validateTx completes for block 0xc422986240 env 0xc42264dcc0 txn 0 2018-09-22 05:52:12.771 EDT  committer/txvalidator  Validate -> DEBU 442 got result for idx 0, code 10 2018-09-22 05:52:12.771 EDT  committer/txvalidator  Validate -> DEBU 443 END Block Validation 2018-09-22 05:52:12.771 EDT  kvledger  CommitWithPvtData -> DEBU 444 Channel  myc : Validating state for block  5  2018-09-22 05:52:12.771 EDT  lockbasedtxmgr  ValidateAndPrepare -> DEBU 445 Waiting for purge mgr to finish the background job of computing expirying keys for the block 2018-09-22 05:52:12.771 EDT  lockbasedtxmgr  ValidateAndPrepare -> DEBU 446 Validating new block with num trans =  1  2018-09-22 05:52:12.771 EDT  valimpl  ValidateAndPrepareBatch -> DEBU 447 ValidateAndPrepareBatch() for block number =  5  2018-09-22 05:52:12.771 EDT  valimpl  ValidateAndPrepareBatch -> DEBU 448 preprocessing ProtoBlock... {color:#de350b}2018-09-22 05:52:12.771 EDT  valimpl  preprocessProtoBlock -> WARN 449 Channel  myc : Block  5  Transaction index  0  TxId  9e4aaf26fc09228b955bba2ec237c0a95051d55e6dd5348d22647ec2e01fa3ae  marked as invalid by committer. Reason code  ENDORSEMENT_POLICY_FAILURE {color}  ></description> </Issue>
