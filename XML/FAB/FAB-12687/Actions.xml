<Action id="55554" issue="35059" author="yacovm" type="comment" created="2019-01-11 17:41:40.0" updateauthor="yacovm" updated="2019-01-11 17:42:02.0"> <body><! CDATA I think a nice way of dealing this is to have a changing severity level for these log messages:  Let *n* be the number of times the RPC message failed to send. If *n* < 3, log in error. If 2 < *n* < 5, log in warning. If 4 < *n* < 10, log in info. If 9 < *n* , log in debug.  If it succeeds, then reset *n* to 0. what do you think?  ></body> </Action>
<Action id="55558" issue="35059" author="scottz" type="comment" created="2019-01-11 19:13:01.0" updateauthor="scottz" updated="2019-01-11 19:13:01.0"> <body><! CDATA I like both ideas. How about something like: * Print one ERR log when the connection first fails. * Retry every 0.1 sec. Continue for 100s (or long enough for an orderer to restart; we want it to recover quickly in this situation). Print INFO or DEBUG logs for these if you want to see anything. * After the 100sec, extend the retry interval to one per minute. From here on, print INFO or WARN logs every minute: "failed to reconnect to orderer N; still down after X mins Y secs", or "down since xyz". * Upon reconnection, print a WARN log indicating the recovery, and report how long the connection had been down.  ></body> </Action>
<Action id="55560" issue="35059" author="yacovm" type="comment" body="The retry is done by etcdraft, not by fabric. We don&apos;t control it." created="2019-01-11 19:33:02.0" updateauthor="yacovm" updated="2019-01-11 19:33:02.0"/>
<Action id="55563" issue="35059" author="scottz" type="comment" body="If all we can control is the log severity, then after the first ERR log, put the rest in debug, or nowhere, except an occasional (every minute? hour?) log in INFO or WARN saying we are continuing to try to reconnect to ordererN. Maybe include something like &quot;M failed attempts in the last N minutes&quot;, so people can see that we are trying (without seeing a flood of logs." created="2019-01-11 20:27:05.0" updateauthor="scottz" updated="2019-01-11 20:27:05.0"/>
<Action id="55564" issue="35059" author="yacovm" type="comment" created="2019-01-11 20:53:52.0" updateauthor="yacovm" updated="2019-01-11 20:53:52.0"> <body><! CDATA OK then how about:  We have a bit/flag per host. * If we failed sending a message to a remote host, and the bit is off, we print in error, and then turn on the bit. * If we failed sending a message to a remote host and the bit is on, we print in debug. * If we succeed in sending a message while the bit is on, we print an info message that we succeeded in sending, and then turn off the bit.   ~kchristidis   ~guoger  wdyt?  ></body> </Action>
<Action id="55565" issue="35059" author="kchristidis" type="comment" body="^ I like this idea." created="2019-01-11 21:23:18.0" updateauthor="kchristidis" updated="2019-01-11 21:23:18.0"/>
<Action id="55570" issue="35059" author="guoger" type="comment" created="2019-01-12 13:22:34.0" updateauthor="guoger" updated="2019-01-12 13:22:34.0"> <body><! CDATA nice proposal!  i actually like a combination of both: Errorf the first failure and then every 10 consecutive failures. Reset when it succeeds.  This case, we don't pollute debug log neither, since very often we turn on debug log to find something useful, but overwhelmed by loads of failed message delivery. Also, whoever inspects the log at info level still gets periodically alerted that there are still messages failed to be deliver, something like: ERRO: Failed to deliver N messages to x  wdyt?  ></body> </Action>
<Action id="55571" issue="35059" author="yacovm" type="comment" created="2019-01-12 13:51:16.0" updateauthor="yacovm" updated="2019-01-12 13:51:16.0"> <body><! CDATA If we log in error every 10 consecutive failures, we're not solving the problem, we're only reducing it.  If nothing is going on (no transactions) then we're still going to have only error logs, and lots of them.  ></body> </Action>
<Action id="55572" issue="35059" author="scottz" type="comment" created="2019-01-12 18:52:22.0" updateauthor="scottz" updated="2019-01-12 18:52:22.0"> <body><! CDATA Your solution seems good,  ~yacovm . And if anyone wants to throttle the debug logs further, it seems that could be helpful, from our perspective. Knowing we are continually retrying is enough, so we don't have to print a debug log every time - maybe only 1 out of every 10 (or 600 or 1000 or?) of the debug logs. Remember this could be overwhelming if it is happening for multiple channels for multiple stopped orderers. But I defer any decision about the debug logs to you all.  ></body> </Action>
<Action id="55967" issue="35059" author="guoger" type="comment" body="https://gerrit.hyperledger.org/r/c/28883/" created="2019-01-22 07:21:19.0" updateauthor="guoger" updated="2019-01-22 07:21:19.0"/>
