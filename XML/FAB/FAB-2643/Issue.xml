<Issue id="15210" key="FAB-2643" number="2643" project="10002" reporter="yacovm" assignee="yacovm" creator="yacovm" type="10004" summary="NullPointerException in verifyByChannel" priority="3" resolution="10000" status="6" created="2017-03-05 18:06:23.0" updated="2018-07-20 14:11:54.0" resolutiondate="2017-03-13 07:42:24.0" votes="0" watches="1" workflowId="37696"> <description><! CDATA Scenario:   Peer gets an AliveMessage in gossip from an external organization, and the messageCryptoService tries to validate it. The validation first goes to the local MSP (and fails) so it tries validating using one of the channel policies (which were recently introduced), but it fails because the channelPolicyManagerGetter returns a nil policyManager from some reason. This results in a null dereference panic and the unexpected and sorrowful death of the peer.  panic: runtime error: invalid memory address or nil pointer dereference  signal SIGSEGV: segmentation violation code=0x1 addr=0x28 pc=0x756ff5   goroutine 45  running : panic(0xc1ad00, 0xc420016050) /opt/go/src/runtime/panic.go:500 +0x1a1 github.com/hyperledger/fabric/peer/gossip/mcs.(*mspMessageCryptoService).VerifyByChannel(0xc4201dd3b0, 0xc4200c2358, 0x3, 0x8, 0xc420293b00, 0x214, 0x214, 0xc42153ee10, 0x46, 0x46, ...) /opt/gopath/src/github.com/hyperledger/fabric/peer/gossip/mcs/mcs.go:234 +0x225 github.com/hyperledger/fabric/peer/gossip/mcs.(*mspMessageCryptoService).Verify(0xc4201dd3b0, 0xc420293b00, 0x214, 0x214, 0xc42153ee10, 0x46, 0x46, 0xc42153edc0, 0x42, 0x42, ...) /opt/gopath/src/github.com/hyperledger/fabric/peer/gossip/mcs/mcs.go:216 +0x1c0 github.com/hyperledger/fabric/gossip/gossip.(*discoverySecurityAdapter).validateAliveMsgSignature.func1(0xc420293b00, 0x214, 0x214, 0xc42153ee10, 0x46, 0x46, 0xc42153edc0, 0x42, 0x42, 0x3, ...) /opt/gopath/src/github.com/hyperledger/fabric/gossip/gossip/gossip_impl.go:884 +0xa6 github.com/hyperledger/fabric/protos/gossip.(*SignedGossipMessage).Verify(0xc4200bf940, 0xc420293b00, 0x214, 0x214, 0xc4200bfbe0, 0x294, 0xc42148a600) /opt/gopath/src/github.com/hyperledger/fabric/protos/gossip/extensions.go:410 +0xcb github.com/hyperledger/fabric/gossip/gossip.(*discoverySecurityAdapter).validateAliveMsgSignature(0xc4201ada80, 0xc4200bf940, 0xc420293b00, 0x214, 0x214, 0x214) /opt/gopath/src/github.com/hyperledger/fabric/gossip/gossip/gossip_impl.go:888 +0xf2 github.com/hyperledger/fabric/gossip/gossip.(*discoverySecurityAdapter).ValidateAliveMsg(0xc4201ada80, 0xc4200bf940, 0xc42028d5c0) /opt/gopath/src/github.com/hyperledger/fabric/gossip/gossip/gossip_impl.go:854 +0x190 github.com/hyperledger/fabric/gossip/discovery.(*gossipDiscoveryImpl).handleAliveMessage(0xc420086870, 0xc4200bf940) /opt/gopath/src/github.com/hyperledger/fabric/gossip/discovery/discovery_impl.go:431 +0x208 github.com/hyperledger/fabric/gossip/discovery.(*gossipDiscoveryImpl).handleMsgFromComm(0xc420086870, 0xc4200be2f0) /opt/gopath/src/github.com/hyperledger/fabric/gossip/discovery/discovery_impl.go:338 +0x3aa github.com/hyperledger/fabric/gossip/discovery.(*gossipDiscoveryImpl).handleMessages(0xc420086870) /opt/gopath/src/github.com/hyperledger/fabric/gossip/discovery/discovery_impl.go:282 +0x200 created by github.com/hyperledger/fabric/gossip/discovery.NewDiscoveryService /opt/gopath/src/github.com/hyperledger/fabric/gossip/discovery/discovery_impl.go:116 +0x50e   ></description> </Issue>
