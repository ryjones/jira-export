<Issue id="12839" key="FAB-538" number="538" project="10002" reporter="mqshen" creator="mqshen" type="10004" summary="Crash when run chaincode with pbft on 4 nodes." priority="3" resolution="10000" status="6" created="2016-09-30 02:15:14.0" updated="2018-07-20 14:10:19.0" resolutiondate="2017-04-13 23:39:36.0" votes="0" watches="1" workflowId="36330"> <environment><! CDATA OS:Ubuntu 16.04 LTS fabric version: git commit 42ca84b78b9bb9fa29ea8008a7e53a7b01420591  ></environment> <description><! CDATA I run 4 vp nodes on one machine, and it crash when run for a while. Node3's error log:   {code:none} 09:56:27.704  consensus/pbft  execDoneSync -> INFO 093^  0m Replica 2 finished execution 49, trying next 09:56:29.828  consensus/pbft  executeOne -> INFO 094^  0m Replica 2 executing/committing request batch for view=0/seqNo=50 and digest 27Z2b2ltYurwlR5fEeiNiUGZcgdyfE9pCmk45ktEFHGCMAx1oNEesjrntZZlHffzObXLv93ZVo6KYNFv0c0mzA== fatal error: unexpected signal during runtime execution  signal 0xb code=0x80 addr=0x0 pc=0x7f6d299a9618   runtime stack: runtime.throw(0x1028f80, 0x2a) /usr/local/go/src/runtime/panic.go:547 +0x90 runtime.sigpanic() /usr/local/go/src/runtime/sigpanic_unix.go:12 +0x5a  goroutine 12  syscall, locked to thread : runtime.cgocall(0xbec3bd, 0xc8200c78b8, 0x100000000000000) /usr/local/go/src/runtime/cgocall.go:123 +0x11b fp=0xc8200c7880 sp=0xc8200c7850 github.com/hyperledger/fabric/vendor/github.com/tecbot/gorocksdb._Cfunc_rocksdb_write(0x2f54128, 0x3012a80, 0x2fff180, 0xc82013c5d8) github.com/hyperledger/fabric/vendor/github.com/tecbot/gorocksdb/_obj/_cgo_gotypes.go:2903 +0x3a fp=0xc8200c78b8 sp=0xc8200c7880 github.com/hyperledger/fabric/vendor/github.com/tecbot/gorocksdb.(*DB).Write(0xc820255440, 0xc82013c5d0, 0xc82013c5c0, 0x0, 0x0) /home/nginx/go/src/github.com/hyperledger/fabric/vendor/github.com/tecbot/gorocksdb/db.go:358 +0x2ed fp=0xc8200c79a0 sp=0xc8200c78b8 github.com/hyperledger/fabric/core/ledger.(*Ledger).CommitTxBatch(0xc820464160, 0xe72920, 0xc82045eeb0, 0x0, 0x0, 0x0, 0xc8208926a0, 0x4, 0x4, 0xc8203fba88, ...) /home/nginx/go/src/github.com/hyperledger/fabric/core/ledger/ledger.go:196 +0x5d1 fp=0xc8200c7b08 sp=0xc8200c79a0 github.com/hyperledger/fabric/consensus/helper.(*Helper).CommitTxBatch(0xc820468480, 0xe72920, 0xc82045eeb0, 0xc8203fba88, 0x2, 0x8, 0x0, 0x0, 0x0) /home/nginx/go/src/github.com/hyperledger/fabric/consensus/helper/helper.go:215 +0x236 fp=0xc8200c7c10 sp=0xc8200c7b08 github.com/hyperledger/fabric/consensus/executor.(*coordinatorImpl).ProcessEvent(0xc82045eeb0, 0xdd8680, 0xc820453bc0, 0x0, 0x0) /home/nginx/go/src/github.com/hyperledger/fabric/consensus/executor/executor.go:93 +0x9e4 fp=0xc8200c7df8 sp=0xc8200c7c10 github.com/hyperledger/fabric/consensus/util/events.SendEvent(0x7f6d2a77da90, 0xc82045eeb0, 0xdd8680, 0xc820453bc0) /home/nginx/go/src/github.com/hyperledger/fabric/consensus/util/events/events.go:113 +0x45 fp=0xc8200c7e38 sp=0xc8200c7df8 github.com/hyperledger/fabric/consensus/util/events.(*managerImpl).Inject(0xc8204652a0, 0xdd8680, 0xc820453bc0) /home/nginx/go/src/github.com/hyperledger/fabric/consensus/util/events/events.go:123 +0x4f fp=0xc8200c7e60 sp=0xc8200c7e38 github.com/hyperledger/fabric/consensus/util/events.(*managerImpl).eventLoop(0xc8204652a0) /home/nginx/go/src/github.com/hyperledger/fabric/consensus/util/events/events.go:132 +0xdb fp=0xc8200c7f88 sp=0xc8200c7e60 runtime.goexit() /usr/local/go/src/runtime/asm_amd64.s:1998 +0x1 fp=0xc8200c7f90 sp=0xc8200c7f88 created by github.com/hyperledger/fabric/consensus/util/events.(*managerImpl).Start /home/nginx/go/src/github.com/hyperledger/fabric/consensus/util/events/events.go:100 +0x35  {code}  Node4'e error log:  {code:none} 09:56:27.704  consensus/pbft  execDoneSync -> INFO 092^  0m Replica 3 finished execution 49, trying next 09:56:29.833  consensus/pbft  executeOne -> INFO 093^  0m Replica 3 executing/committing request batch for view=0/seqNo=50 and digest 27Z2b2ltYurwlR5fEeiNiUGZcgdyfE9pCmk45ktEFHGCMAx1oNEesjrntZZlHffzObXLv93ZVo6KYNFv0c0mzA== fatal error: unexpected signal during runtime execution  signal 0xb code=0x80 addr=0x0 pc=0x7f5f2184a618   runtime stack: runtime.throw(0x1028f80, 0x2a) /usr/local/go/src/runtime/panic.go:547 +0x90 runtime.sigpanic() /usr/local/go/src/runtime/sigpanic_unix.go:12 +0x5a  goroutine 89  syscall, locked to thread : runtime.cgocall(0xbec3bd, 0xc82012f8b8, 0x100000000000000) /usr/local/go/src/runtime/cgocall.go:123 +0x11b fp=0xc82012f880 sp=0xc82012f850 github.com/hyperledger/fabric/vendor/github.com/tecbot/gorocksdb._Cfunc_rocksdb_write(0x3622128, 0x36e0a60, 0x36cd180, 0xc820144588) github.com/hyperledger/fabric/vendor/github.com/tecbot/gorocksdb/_obj/_cgo_gotypes.go:2903 +0x3a fp=0xc82012f8b8 sp=0xc82012f880 github.com/hyperledger/fabric/vendor/github.com/tecbot/gorocksdb.(*DB).Write(0xc820251820, 0xc820144580, 0xc820144570, 0x0, 0x0) /home/nginx/go/src/github.com/hyperledger/fabric/vendor/github.com/tecbot/gorocksdb/db.go:358 +0x2ed fp=0xc82012f9a0 sp=0xc82012f8b8 github.com/hyperledger/fabric/core/ledger.(*Ledger).CommitTxBatch(0xc82046cd20, 0xe72920, 0xc820012550, 0x0, 0x0, 0x0, 0xc8202f14e0, 0x4, 0x4, 0xc820278e20, ...) /home/nginx/go/src/github.com/hyperledger/fabric/core/ledger/ledger.go:196 +0x5d1 fp=0xc82012fb08 sp=0xc82012f9a0 github.com/hyperledger/fabric/consensus/helper.(*Helper).CommitTxBatch(0xc820253100, 0xe72920, 0xc820012550, 0xc820278e20, 0x2, 0x8, 0x0, 0x0, 0x0) /home/nginx/go/src/github.com/hyperledger/fabric/consensus/helper/helper.go:215 +0x236 fp=0xc82012fc10 sp=0xc82012fb08 github.com/hyperledger/fabric/consensus/executor.(*coordinatorImpl).ProcessEvent(0xc820012550, 0xdd8680, 0xc8202f3aa0, 0x0, 0x0) /home/nginx/go/src/github.com/hyperledger/fabric/consensus/executor/executor.go:93 +0x9e4 fp=0xc82012fdf8 sp=0xc82012fc10 github.com/hyperledger/fabric/consensus/util/events.SendEvent(0x7f5f22661340, 0xc820012550, 0xdd8680, 0xc8202f3aa0) /home/nginx/go/src/github.com/hyperledger/fabric/consensus/util/events/events.go:113 +0x45 fp=0xc82012fe38 sp=0xc82012fdf8 github.com/hyperledger/fabric/consensus/util/events.(*managerImpl).Inject(0xc82000e420, 0xdd8680, 0xc8202f3aa0) /home/nginx/go/src/github.com/hyperledger/fabric/consensus/util/events/events.go:123 +0x4f fp=0xc82012fe60 sp=0xc82012fe38 github.com/hyperledger/fabric/consensus/util/events.(*managerImpl).eventLoop(0xc82000e420) /home/nginx/go/src/github.com/hyperledger/fabric/consensus/util/events/events.go:132 +0xdb fp=0xc82012ff88 sp=0xc82012fe60 runtime.goexit() /usr/local/go/src/runtime/asm_amd64.s:1998 +0x1 fp=0xc82012ff90 sp=0xc82012ff88 created by github.com/hyperledger/fabric/consensus/util/events.(*managerImpl).Start /home/nginx/go/src/github.com/hyperledger/fabric/consensus/util/events/events.go:100 +0x35 {code}   ></description> </Issue>
