<Issue id="17488" key="FAB-4367" number="4367" project="10002" reporter="dongming" assignee="kchristidis" creator="dongming" type="10004" summary="72 hrs long run (FAB-4229) failed with no space but kafka exits" priority="3" resolution="10000" status="6" created="2017-06-05 14:18:47.0" updated="2018-07-20 14:13:07.0" resolutiondate="2017-06-05 14:30:21.0" votes="0" watches="2" workflowId="38818" security="10001"> <description><! CDATA Execution of 72 hours long run with 8 threads,  (FAB-4229: 1 transaction per second per thread, each transaction has 1kb-2kb payload) failed after 44 hours since out of memory. However, kafka exit.  We do not know if it is expected behavior for kafka when out of space.  peer log:  2017-06-04 19:44:19.735 UTC  kvledger  Commit -> INFO 2607b Channel  mychannel2 : Created block  77866  with 8 transaction(s) 2017-06-04 19:44:20.854 UTC  kvledger  Commit -> INFO 2607c Channel  mychannel : Created block  77875  with 6 transaction(s) 2017-06-04 19:44:21.796 UTC  gossip/state  commitBlock -> ERRO 2607d Got error while committing(Error while appending block to file: write /var/hyperledge r/production/ledgersData/chains/chains/mychannel2/blockfile_000059: no space left on device)  orderer log:  root@qa-peer05:~# docker logs orderer0.example.com 2017-06-04 19:44:22.461 UTC  orderer/kafka  listenForErrors -> ERRO 001 kafka: error while consuming mychannel/0: EOF 2017-06-04 19:44:22.469 UTC  orderer/kafka  listenForErrors -> ERRO 002 kafka: error while consuming testchainid/0: EOF 2017-06-04 19:44:22.469 UTC  orderer/kafka  listenForErrors -> ERRO 003 kafka: error while consuming mychannel2/0: EOF 2017-06-04 19:44:22.770 UTC  orderer/kafka  Enqueue -> ERRO 004  channel: mychannel  cannot enqueue envelope: dial tcp 172.19.0.11:9092: getsockopt: connection refused 2017-06-04 19:44:22.770 UTC  orderer/kafka  Enqueue -> ERRO 005  channel: mychannel  cannot enqueue envelope: dial tcp 172.19.0.11:9092: getsockopt: connection refused 2017-06-04 19:44:22.776 UTC  orderer/kafka  Enqueue -> ERRO 006  channel: mychannel2  cannot enqueue envelope: dial tcp 172.19.0.12:9092: getsockopt: connection refused 2017-06-04 19:44:22.776 UTC  orderer/kafka  Enqueue -> ERRO 007  channel: mychannel2  cannot enqueue envelope: dial tcp 172.19.0.12:9092: getsockopt: connection refused 2017-06-04 19:44:23.158 UTC  orderer/kafka  loop -> ERRO 008  channel: mychannel  Cannot post time-to-cut message: dial tcp 172.19.0.11:9092: getsockopt: connection refused     kafka log:   2017-06-04 19:37:41,024  INFO  Group Metadata Manager on Broker 2 : Removed 0 expired offsets in 0 milliseconds. (kafka.coordinator.GroupMetadataManager)  2017-06-04 19:44:22,465  WARN  ReplicaFetcherThread-0-1 , Error in fetch kafka.server.ReplicaFetcherThread$FetchRequest@64871dd6. Possible cause: java.io.IOException: Connection to 1 was disconnected before the response was read (kafka.server.ReplicaFetcherThread)  2017-06-04 19:44:22,470  WARN  ReplicaFetcherThread-0-3 , Error in fetch kafka.server.ReplicaFetcherThread$FetchRequest@3528023e. Possible cause: java.io.IOException: Connection to 3 was disconnected before the response was read (kafka.server.ReplicaFetcherThread)  2017-06-04 19:44:28,049  INFO Creating /controller (is it secure? false) (kafka.utils.ZKCheckedEphemeral)  2017-06-04 19:44:28,054  INFO Result of znode creation is: OK (kafka.utils.ZKCheckedEphemeral)  2017-06-04 19:44:28,055  INFO 2 successfully elected as leader (kafka.server.ZookeeperLeaderElector)  2017-06-04 19:44:28,195  INFO  ReplicaFetcherManager on broker 2  Removed fetcher for partitions  mychannel2,0 , mychannel,0 , testchainid,0  (kafka.server.ReplicaFetcherManager)  2017-06-04 19:44:28,213  INFO  ReplicaFetcherThread-0-3 , Shutting down (kafka.server.ReplicaFetcherThread)  2017-06-04 19:44:28,218  INFO New leader is 2 (kafka.server.ZookeeperLeaderElector$LeaderChangeListener)  2017-06-04 19:44:54,539  INFO  ReplicaFetcherThread-0-3 , Stopped (kafka.server.ReplicaFetcherThread)  2017-06-04 19:44:54,539  INFO  ReplicaFetcherThread-0-3 , Shutdown completed (kafka.server.ReplicaFetcherThread)  2017-06-04 19:44:54,541  INFO  ReplicaFetcherThread-0-1 , Shutting down (kafka.server.ReplicaFetcherThread)  2017-06-04 19:44:54,544  INFO  ReplicaFetcherThread-0-1 , Stopped (kafka.server.ReplicaFetcherThread)  2017-06-04 19:44:54,544  INFO  ReplicaFetcherThread-0-1 , Shutdown completed (kafka.server.ReplicaFetcherThread)  2017-06-04 19:47:41,024  INFO  Group Metadata Manager on Broker 2 : Removed 0 expired offsets in 0 milliseconds. (kafka.coordinator.GroupMetadataManager) log4j:ERROR Failed to flush writer, java.io.IOException: No space left on device at java.io.FileOutputStream.writeBytes(Native Method) at java.io.FileOutputStream.write(FileOutputStream.java:326) at sun.nio.cs.StreamEncoder.writeBytes(StreamEncoder.java:221) at sun.nio.cs.StreamEncoder.implFlushBuffer(StreamEncoder.java:291) at sun.nio.cs.StreamEncoder.implFlush(StreamEncoder.java:295) at sun.nio.cs.StreamEncoder.flush(StreamEncoder.java:141)     ></description> </Issue>
