<Issue id="33134" key="FAB-11689" number="11689" project="10002" reporter="sykesm" assignee="sykesm" creator="sykesm" type="10004" summary="Data race related to fabric/msp" priority="4" resolution="10000" status="6" created="2018-08-22 15:18:13.0" updated="2019-03-20 06:48:14.0" resolutiondate="2018-09-28 09:37:39.0" votes="0" watches="1" workflowId="44344"> <description><! CDATA {code} ================== WARNING: DATA RACE Write at 0x00c4203e7bf8 by goroutine 49: github.com/hyperledger/fabric/msp.(*bccspmsp).setupCrypto() /Users/sykesm/workspace/fabric/src/github.com/hyperledger/fabric/msp/mspimplsetup.go:82 +0x48 github.com/hyperledger/fabric/msp.(*bccspmsp).preSetupV1() /Users/sykesm/workspace/fabric/src/github.com/hyperledger/fabric/msp/mspimplsetup.go:382 +0x5d github.com/hyperledger/fabric/msp.(*bccspmsp).setupV1() /Users/sykesm/workspace/fabric/src/github.com/hyperledger/fabric/msp/mspimplsetup.go:367 +0x46 github.com/hyperledger/fabric/msp.(*bccspmsp).(github.com/hyperledger/fabric/msp.setupV1)-fm() /Users/sykesm/workspace/fabric/src/github.com/hyperledger/fabric/msp/mspimpl.go:112 +0x4b github.com/hyperledger/fabric/msp.(*bccspmsp).Setup() /Users/sykesm/workspace/fabric/src/github.com/hyperledger/fabric/msp/mspimpl.go:225 +0x224 github.com/hyperledger/fabric/msp/cache.(*cachedMSP).Setup() /Users/sykesm/workspace/fabric/src/github.com/hyperledger/fabric/msp/cache/cache.go:101 +0x6a github.com/hyperledger/fabric/msp/mgmt/testtools.LoadMSPSetupForTesting() /Users/sykesm/workspace/fabric/src/github.com/hyperledger/fabric/msp/mgmt/testtools/config.go:28 +0xb9 github.com/hyperledger/fabric/peer/chaincode.initMSP() /Users/sykesm/workspace/fabric/src/github.com/hyperledger/fabric/peer/chaincode/upgrade_test.go:31 +0x33 sync.(*Once).Do() /usr/local/Cellar/go/1.10.3/libexec/src/sync/once.go:44 +0xe1 github.com/hyperledger/fabric/peer/chaincode.InitMSP() /Users/sykesm/workspace/fabric/src/github.com/hyperledger/fabric/peer/chaincode/upgrade_test.go:27 +0x46 github.com/hyperledger/fabric/peer/chaincode.TestChaincodeInvokeOrQuery_waitForEvent() /Users/sykesm/workspace/fabric/src/github.com/hyperledger/fabric/peer/chaincode/common_test.go:537 +0x67 testing.tRunner() /usr/local/Cellar/go/1.10.3/libexec/src/testing/testing.go:777 +0x16d  Previous read at 0x00c4203e7bf8 by goroutine 36: github.com/hyperledger/fabric/msp.(*signingidentity).Sign() /Users/sykesm/workspace/fabric/src/github.com/hyperledger/fabric/msp/identities.go:234 +0x7b github.com/hyperledger/fabric/common/localmsp.(*mspSigner).Sign() /Users/sykesm/workspace/fabric/src/github.com/hyperledger/fabric/common/localmsp/signer.go:68 +0x19d github.com/hyperledger/fabric/protos/utils.CreateSignedEnvelopeWithTLSBinding() /Users/sykesm/workspace/fabric/src/github.com/hyperledger/fabric/protos/utils/txutils.go:100 +0x47e github.com/hyperledger/fabric/peer/chaincode.createDeliverEnvelope() /Users/sykesm/workspace/fabric/src/github.com/hyperledger/fabric/peer/chaincode/common.go:729 +0x48f github.com/hyperledger/fabric/peer/chaincode.(*deliverGroup).ClientConnect() /Users/sykesm/workspace/fabric/src/github.com/hyperledger/fabric/peer/chaincode/common.go:618 +0x40e  Goroutine 49 (running) created at: testing.(*T).Run() /usr/local/Cellar/go/1.10.3/libexec/src/testing/testing.go:824 +0x564 testing.runTests.func1() /usr/local/Cellar/go/1.10.3/libexec/src/testing/testing.go:1063 +0xa4 testing.tRunner() /usr/local/Cellar/go/1.10.3/libexec/src/testing/testing.go:777 +0x16d testing.runTests() /usr/local/Cellar/go/1.10.3/libexec/src/testing/testing.go:1061 +0x4e1 testing.(*M).Run() /usr/local/Cellar/go/1.10.3/libexec/src/testing/testing.go:978 +0x2cd main.main() _testmain.go:190 +0x324  Goroutine 36 (finished) created at: github.com/hyperledger/fabric/peer/chaincode.(*deliverGroup).Connect() /Users/sykesm/workspace/fabric/src/github.com/hyperledger/fabric/peer/chaincode/common.go:585 +0x149 github.com/hyperledger/fabric/peer/chaincode.TestDeliverGroupConnect() /Users/sykesm/workspace/fabric/src/github.com/hyperledger/fabric/peer/chaincode/common_test.go:432 +0x15c8 testing.tRunner() /usr/local/Cellar/go/1.10.3/libexec/src/testing/testing.go:777 +0x16d ================== ================== WARNING: DATA RACE Write at 0x00c4203e7b88 by goroutine 49: github.com/hyperledger/fabric/msp.(*bccspmsp).setupSigningIdentity() /Users/sykesm/workspace/fabric/src/github.com/hyperledger/fabric/msp/mspimplsetup.go:279 +0x2b9 github.com/hyperledger/fabric/msp.(*bccspmsp).preSetupV1() /Users/sykesm/workspace/fabric/src/github.com/hyperledger/fabric/msp/mspimplsetup.go:407 +0x152 github.com/hyperledger/fabric/msp.(*bccspmsp).setupV1() /Users/sykesm/workspace/fabric/src/github.com/hyperledger/fabric/msp/mspimplsetup.go:367 +0x46 github.com/hyperledger/fabric/msp.(*bccspmsp).(github.com/hyperledger/fabric/msp.setupV1)-fm() /Users/sykesm/workspace/fabric/src/github.com/hyperledger/fabric/msp/mspimpl.go:112 +0x4b github.com/hyperledger/fabric/msp.(*bccspmsp).Setup() /Users/sykesm/workspace/fabric/src/github.com/hyperledger/fabric/msp/mspimpl.go:225 +0x224 github.com/hyperledger/fabric/msp/cache.(*cachedMSP).Setup() /Users/sykesm/workspace/fabric/src/github.com/hyperledger/fabric/msp/cache/cache.go:101 +0x6a github.com/hyperledger/fabric/msp/mgmt/testtools.LoadMSPSetupForTesting() /Users/sykesm/workspace/fabric/src/github.com/hyperledger/fabric/msp/mgmt/testtools/config.go:28 +0xb9 github.com/hyperledger/fabric/peer/chaincode.initMSP() /Users/sykesm/workspace/fabric/src/github.com/hyperledger/fabric/peer/chaincode/upgrade_test.go:31 +0x33 sync.(*Once).Do() /usr/local/Cellar/go/1.10.3/libexec/src/sync/once.go:44 +0xe1 github.com/hyperledger/fabric/peer/chaincode.InitMSP() /Users/sykesm/workspace/fabric/src/github.com/hyperledger/fabric/peer/chaincode/upgrade_test.go:27 +0x46 github.com/hyperledger/fabric/peer/chaincode.TestChaincodeInvokeOrQuery_waitForEvent() /Users/sykesm/workspace/fabric/src/github.com/hyperledger/fabric/peer/chaincode/common_test.go:537 +0x67 testing.tRunner() /usr/local/Cellar/go/1.10.3/libexec/src/testing/testing.go:777 +0x16d  Previous read at 0x00c4203e7b88 by goroutine 36: github.com/hyperledger/fabric/msp.(*bccspmsp).GetDefaultSigningIdentity() /Users/sykesm/workspace/fabric/src/github.com/hyperledger/fabric/msp/mspimpl.go:258 +0x8e github.com/hyperledger/fabric/msp/cache.(*cachedMSP).GetDefaultSigningIdentity() <autogenerated>:1 +0x5f github.com/hyperledger/fabric/common/localmsp.(*mspSigner).Sign() /Users/sykesm/workspace/fabric/src/github.com/hyperledger/fabric/common/localmsp/signer.go:63 +0x57 github.com/hyperledger/fabric/protos/utils.CreateSignedEnvelopeWithTLSBinding() /Users/sykesm/workspace/fabric/src/github.com/hyperledger/fabric/protos/utils/txutils.go:100 +0x47e github.com/hyperledger/fabric/peer/chaincode.createDeliverEnvelope() /Users/sykesm/workspace/fabric/src/github.com/hyperledger/fabric/peer/chaincode/common.go:729 +0x48f github.com/hyperledger/fabric/peer/chaincode.(*deliverGroup).ClientConnect() /Users/sykesm/workspace/fabric/src/github.com/hyperledger/fabric/peer/chaincode/common.go:618 +0x40e  Goroutine 49 (running) created at: testing.(*T).Run() /usr/local/Cellar/go/1.10.3/libexec/src/testing/testing.go:824 +0x564 testing.runTests.func1() /usr/local/Cellar/go/1.10.3/libexec/src/testing/testing.go:1063 +0xa4 testing.tRunner() /usr/local/Cellar/go/1.10.3/libexec/src/testing/testing.go:777 +0x16d testing.runTests() /usr/local/Cellar/go/1.10.3/libexec/src/testing/testing.go:1061 +0x4e1 testing.(*M).Run() /usr/local/Cellar/go/1.10.3/libexec/src/testing/testing.go:978 +0x2cd main.main() _testmain.go:190 +0x324  Goroutine 36 (finished) created at: github.com/hyperledger/fabric/peer/chaincode.(*deliverGroup).Connect() /Users/sykesm/workspace/fabric/src/github.com/hyperledger/fabric/peer/chaincode/common.go:585 +0x149 github.com/hyperledger/fabric/peer/chaincode.TestDeliverGroupConnect() /Users/sykesm/workspace/fabric/src/github.com/hyperledger/fabric/peer/chaincode/common_test.go:432 +0x15c8 testing.tRunner() /usr/local/Cellar/go/1.10.3/libexec/src/testing/testing.go:777 +0x16d ================== {code}  ></description> </Issue>
