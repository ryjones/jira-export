<Issue id="46559" key="FAB-18423" number="18423" project="10002" reporter="tommystark" creator="tommystark" type="10004" summary="failed to restore persisted raft data: failed to create or read WAL" priority="3" resolution="10201" status="6" created="2021-02-13 13:37:06.0" updated="2021-02-15 17:11:40.0" resolutiondate="2021-02-15 17:11:40.0" votes="0" watches="2" workflowId="60503" archived="N"> <description><! CDATA image:Â  hyperledger/fabric-orderer:1.4.10  Still getting an inconsistent state where a Raft WAL snapshot was taken but an in-flight block at the associated height is not yet written.  stack trace:  ``` 2021-02-13 13:26:36.374 UTC  orderer.consensus.etcdraft  createOrReadWAL -> INFO 03b Found WAL data at path '/var/hyperledger/production/orderer/etcdraft/wal/channelall', replaying it channel=channelall node=12021-02-13 13:26:36.374 UTC  orderer.consensus.etcdraft  createOrReadWAL -> INFO 03b Found WAL data at path '/var/hyperledger/production/orderer/etcdraft/wal/channelall', replaying it channel=channelall node=12021-02-13 13:26:36.374 UTC  orderer.commmon.multichannel  newChainSupport -> PANI 03c  channel: channelall  Error creating consenter: failed to restore persisted raft data: failed to create or read WAL: failed to open WAL: fileutil: file already lockedpanic:  channel: channelall  Error creating consenter: failed to restore persisted raft data: failed to create or read WAL: failed to open WAL: fileutil: file already locked goroutine 67  running :github.com/hyperledger/fabric/vendor/go.uber.org/zap/zapcore.(*CheckedEntry).Write(0xc00014d550, 0x0, 0x0, 0x0) /opt/gopath/src/github.com/hyperledger/fabric/vendor/go.uber.org/zap/zapcore/entry.go:229 +0x545github.com/hyperledger/fabric/vendor/go.uber.org/zap.(*SugaredLogger).log(0xc000010298, 0x4, 0x14eff5f, 0x2a, 0xc00019ebd8, 0x2, 0x2, 0x0, 0x0, 0x0) /opt/gopath/src/github.com/hyperledger/fabric/vendor/go.uber.org/zap/sugar.go:234 +0x100github.com/hyperledger/fabric/vendor/go.uber.org/zap.(*SugaredLogger).Panicf(...) /opt/gopath/src/github.com/hyperledger/fabric/vendor/go.uber.org/zap/sugar.go:159github.com/hyperledger/fabric/common/flogging.(*FabricLogger).Panicf(...) /opt/gopath/src/github.com/hyperledger/fabric/common/flogging/zap.go:74github.com/hyperledger/fabric/orderer/common/multichannel.newChainSupport(0xc00025e000, 0xc0005185e0, 0xc0002f01b0, 0x16505a0, 0x202eb48, 0xc0002d0880, 0xc0001e6050) /opt/gopath/src/github.com/hyperledger/fabric/orderer/common/multichannel/chainsupport.go:74 +0x925github.com/hyperledger/fabric/orderer/common/multichannel.(*Registrar).newChain(0xc00025e000, 0xc0001e6050) /opt/gopath/src/github.com/hyperledger/fabric/orderer/common/multichannel/registrar.go:327 +0x1e1github.com/hyperledger/fabric/orderer/common/multichannel.(*BlockWriter).WriteConfigBlock(0xc000622400, 0xc0006c8000, 0xc0006e6040, 0x7, 0x7) /opt/gopath/src/github.com/hyperledger/fabric/orderer/common/multichannel/blockwriter.go:118 +0x357github.com/hyperledger/fabric/orderer/consensus/etcdraft.(*Chain).writeConfigBlock(0xc0000b6500, 0xc0006c8000, 0x4) /opt/gopath/src/github.com/hyperledger/fabric/orderer/consensus/etcdraft/chain.go:1284 +0x28fgithub.com/hyperledger/fabric/orderer/consensus/etcdraft.(*Chain).writeBlock(0xc0000b6500, 0xc0006c8000, 0x4) /opt/gopath/src/github.com/hyperledger/fabric/orderer/consensus/etcdraft/chain.go:848 +0x1a9github.com/hyperledger/fabric/orderer/consensus/etcdraft.(*Chain).apply(0xc0000b6500, 0xc0004dd9a0, 0x1, 0x1) /opt/gopath/src/github.com/hyperledger/fabric/orderer/consensus/etcdraft/chain.go:1048 +0x24agithub.com/hyperledger/fabric/orderer/consensus/etcdraft.(*Chain).serveRequest(0xc0000b6500) /opt/gopath/src/github.com/hyperledger/fabric/orderer/consensus/etcdraft/chain.go:757 +0x959created by github.com/hyperledger/fabric/orderer/consensus/etcdraft.(*Chain).Start /opt/gopath/src/github.com/hyperledger/fabric/orderer/consensus/etcdraft/chain.go:340 +0x230 ```  ></description> </Issue>
