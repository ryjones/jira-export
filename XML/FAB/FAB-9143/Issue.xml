<Issue id="28871" key="FAB-9143" number="9143" project="10002" reporter="sykesm" creator="sykesm" type="10003" summary="Data race in TestOrderingServiceStreamFailure" priority="4" resolution="10000" status="6" created="2018-03-26 13:47:23.0" updated="2018-07-20 14:16:07.0" resolutiondate="2018-07-01 12:23:18.0" votes="0" watches="1" workflowId="41644"> <description><! CDATA {code:java} ================== WARNING: DATA RACE Read at 0x00000583e0f0 by goroutine 26:   github.com/hyperledger/fabric/core/deliverservice.(*balancer).Start()       /Users/sykesm/workspace/fabric/src/github.com/hyperledger/fabric/core/deliverservice/client_test.go:47 +0x57   github.com/hyperledger/fabric/vendor/google.golang.org/grpc.(*balancerWrapperBuilder).Build()       /Users/sykesm/workspace/fabric/src/github.com/hyperledger/fabric/vendor/google.golang.org/grpc/balancer_v1_wrapper.go:45 +0x11d   github.com/hyperledger/fabric/vendor/google.golang.org/grpc.newCCBalancerWrapper()       /Users/sykesm/workspace/fabric/src/github.com/hyperledger/fabric/vendor/google.golang.org/grpc/balancer_conn_wrappers.go:114 +0x2e7   github.com/hyperledger/fabric/vendor/google.golang.org/grpc.(*ClientConn).handleResolvedAddrs()       /Users/sykesm/workspace/fabric/src/github.com/hyperledger/fabric/vendor/google.golang.org/grpc/clientconn.go:735 +0x48c   github.com/hyperledger/fabric/vendor/google.golang.org/grpc.(*ccResolverWrapper).watcher()       /Users/sykesm/workspace/fabric/src/github.com/hyperledger/fabric/vendor/google.golang.org/grpc/resolver_conn_wrapper.go:117 +0x53d  Previous write at 0x00000583e0f0 by goroutine 22:   github.com/hyperledger/fabric/core/deliverservice.(*balancer).Close()       /Users/sykesm/workspace/fabric/src/github.com/hyperledger/fabric/core/deliverservice/client_test.go:64 +0x56   github.com/hyperledger/fabric/vendor/google.golang.org/grpc.(*balancerWrapper).Close()       /Users/sykesm/workspace/fabric/src/github.com/hyperledger/fabric/vendor/google.golang.org/grpc/balancer_v1_wrapper.go:284 +0xd0   github.com/hyperledger/fabric/vendor/google.golang.org/grpc.(*ccBalancerWrapper).watcher()       /Users/sykesm/workspace/fabric/src/github.com/hyperledger/fabric/vendor/google.golang.org/grpc/balancer_conn_wrappers.go:135 +0x4ea  Goroutine 26 (running) created at:   github.com/hyperledger/fabric/vendor/google.golang.org/grpc.(*ccResolverWrapper).start()       /Users/sykesm/workspace/fabric/src/github.com/hyperledger/fabric/vendor/google.golang.org/grpc/resolver_conn_wrapper.go:95 +0x4c   github.com/hyperledger/fabric/vendor/google.golang.org/grpc.DialContext()       /Users/sykesm/workspace/fabric/src/github.com/hyperledger/fabric/vendor/google.golang.org/grpc/clientconn.go:557 +0xc11   github.com/hyperledger/fabric/vendor/google.golang.org/grpc.Dial()       /Users/sykesm/workspace/fabric/src/github.com/hyperledger/fabric/vendor/google.golang.org/grpc/clientconn.go:401 +0x98   github.com/hyperledger/fabric/core/deliverservice.newConnection()       /Users/sykesm/workspace/fabric/src/github.com/hyperledger/fabric/core/deliverservice/client_test.go:38 +0xc6   github.com/hyperledger/fabric/core/deliverservice.(*connProducer).NewConnection()       /Users/sykesm/workspace/fabric/src/github.com/hyperledger/fabric/core/deliverservice/client_test.go:142 +0x167   github.com/hyperledger/fabric/core/deliverservice.(*broadcastClient).connect()       /Users/sykesm/workspace/fabric/src/github.com/hyperledger/fabric/core/deliverservice/client.go:137 +0xac   github.com/hyperledger/fabric/core/deliverservice.(*broadcastClient).doAction()       /Users/sykesm/workspace/fabric/src/github.com/hyperledger/fabric/core/deliverservice/client.go:114 +0x106   github.com/hyperledger/fabric/core/deliverservice.(*broadcastClient).try()       /Users/sykesm/workspace/fabric/src/github.com/hyperledger/fabric/core/deliverservice/client.go:91 +0x18b   github.com/hyperledger/fabric/core/deliverservice.(*broadcastClient).Send()       /Users/sykesm/workspace/fabric/src/github.com/hyperledger/fabric/core/deliverservice/client.go:72 +0xa1   github.com/hyperledger/fabric/core/deliverservice.glob..func2()       /Users/sykesm/workspace/fabric/src/github.com/hyperledger/fabric/core/deliverservice/client_test.go:77 +0x90   github.com/hyperledger/fabric/core/deliverservice.testOrderingServiceStreamFailure()       /Users/sykesm/workspace/fabric/src/github.com/hyperledger/fabric/core/deliverservice/client_test.go:228 +0x444   github.com/hyperledger/fabric/core/deliverservice.TestOrderingServiceStreamFailure()       /Users/sykesm/workspace/fabric/src/github.com/hyperledger/fabric/core/deliverservice/client_test.go:199 +0x82   testing.tRunner()       /usr/local/Cellar/go/1.10.3/libexec/src/testing/testing.go:777 +0x16d  Goroutine 22 (finished) created at:   github.com/hyperledger/fabric/vendor/google.golang.org/grpc.newCCBalancerWrapper()       /Users/sykesm/workspace/fabric/src/github.com/hyperledger/fabric/vendor/google.golang.org/grpc/balancer_conn_wrappers.go:113 +0x290   github.com/hyperledger/fabric/vendor/google.golang.org/grpc.(*ClientConn).handleResolvedAddrs()       /Users/sykesm/workspace/fabric/src/github.com/hyperledger/fabric/vendor/google.golang.org/grpc/clientconn.go:735 +0x48c   github.com/hyperledger/fabric/vendor/google.golang.org/grpc.(*ccResolverWrapper).watcher()       /Users/sykesm/workspace/fabric/src/github.com/hyperledger/fabric/vendor/google.golang.org/grpc/resolver_conn_wrapper.go:117 +0x53d ================== 2018-06-19 09:18:14.923 EDT  deliveryClient  try -> WARN 008 Got error: Failed creating ABC , at 1 attempt. Retrying in 0s --- FAIL: TestOrderingServiceStreamFailure (0.00s) testing.go:730: race detected during execution of test{code}  ></description> </Issue>
