<Issue id="28865" key="FAB-9137" number="9137" project="10002" reporter="sykesm" creator="sykesm" type="10003" summary="Multiple data races when running TestStartInProc" priority="4" resolution="10002" status="6" created="2018-03-26 13:43:06.0" updated="2018-07-20 14:17:34.0" resolutiondate="2018-07-20 14:06:31.0" votes="0" watches="1" workflowId="43099"> <description><! CDATA {code:java} unit-tests_1  | ==================  unit-tests_1  | WARNING: DATA RACE  unit-tests_1  | Write at 0x00c4201d9530 by goroutine 26:  unit-tests_1  |   github.com/hyperledger/fabric/core/chaincode/shim.TestInvoke.func1()  unit-tests_1  |       /opt/gopath/src/github.com/hyperledger/fabric/core/chaincode/shim/shim_test.go:564 +0x6d  unit-tests_1  |  unit-tests_1  | Previous write at 0x00c4201d9530 by goroutine 27:  unit-tests_1  |   github.com/hyperledger/fabric/core/chaincode/shim.TestInvoke.func3()  unit-tests_1  |       /opt/gopath/src/github.com/hyperledger/fabric/core/chaincode/shim/shim_test.go:579 +0x400  unit-tests_1  |  unit-tests_1  | Goroutine 26 (running) created at:  unit-tests_1  |   github.com/hyperledger/fabric/core/chaincode/shim.TestInvoke()  unit-tests_1  |       /opt/gopath/src/github.com/hyperledger/fabric/core/chaincode/shim/shim_test.go:563 +0x1a2  unit-tests_1  |   testing.tRunner()  unit-tests_1  |       /opt/go/src/testing/testing.go:746 +0x16c  unit-tests_1  |  unit-tests_1  | Goroutine 27 (finished) created at:  unit-tests_1  |   github.com/hyperledger/fabric/core/chaincode/shim.TestInvoke()  unit-tests_1  |       /opt/gopath/src/github.com/hyperledger/fabric/core/chaincode/shim/shim_test.go:574 +0x274  unit-tests_1  |   testing.tRunner()  unit-tests_1  |       /opt/go/src/testing/testing.go:746 +0x16c  unit-tests_1  | ==================  unit-tests_1  | ==================  unit-tests_1  | WARNING: DATA RACE  unit-tests_1  | Read at 0x00c42006be68 by goroutine 28:  unit-tests_1  |   github.com/hyperledger/fabric/common/mocks/peer.(*MockCCComm).ka()  unit-tests_1  |       /opt/gopath/src/github.com/hyperledger/fabric/common/mocks/peer/mockccstream.go:137 +0xa2  unit-tests_1  |  unit-tests_1  | Previous write at 0x00c42006be68 by goroutine 27:  unit-tests_1  |   github.com/hyperledger/fabric/common/mocks/peer.(*MockCCComm).Run.func1()  unit-tests_1  |       /opt/gopath/src/github.com/hyperledger/fabric/common/mocks/peer/mockccstream.go:152 +0x44  unit-tests_1  |   github.com/hyperledger/fabric/common/mocks/peer.(*MockCCComm).Run()  unit-tests_1  |       /opt/gopath/src/github.com/hyperledger/fabric/common/mocks/peer/mockccstream.go:160 +0x158  unit-tests_1  |   github.com/hyperledger/fabric/core/chaincode/shim.TestInvoke.func3()  unit-tests_1  |       /opt/gopath/src/github.com/hyperledger/fabric/core/chaincode/shim/shim_test.go:579 +0x3d8  unit-tests_1  |  unit-tests_1  | Goroutine 28 (running) created at:  unit-tests_1  |   github.com/hyperledger/fabric/common/mocks/peer.(*MockCCComm).Run()  unit-tests_1  |       /opt/gopath/src/github.com/hyperledger/fabric/common/mocks/peer/mockccstream.go:148 +0x62  unit-tests_1  |   github.com/hyperledger/fabric/core/chaincode/shim.TestInvoke.func3()  unit-tests_1  |       /opt/gopath/src/github.com/hyperledger/fabric/core/chaincode/shim/shim_test.go:579 +0x3d8  unit-tests_1  |  unit-tests_1  | Goroutine 27 (finished) created at:  unit-tests_1  |   github.com/hyperledger/fabric/core/chaincode/shim.TestInvoke()  unit-tests_1  |       /opt/gopath/src/github.com/hyperledger/fabric/core/chaincode/shim/shim_test.go:574 +0x274  unit-tests_1  |   testing.tRunner()  unit-tests_1  |       /opt/go/src/testing/testing.go:746 +0x16c  unit-tests_1  | ==================  unit-tests_1  | ==================  unit-tests_1  | WARNING: DATA RACE  unit-tests_1  | Write at 0x00c42025a120 by goroutine 64:  unit-tests_1  |   runtime.closechan()  unit-tests_1  |       /opt/go/src/runtime/chan.go:313 +0x0  unit-tests_1  |   github.com/hyperledger/fabric/core/chaincode/shim.TestStartInProc()  unit-tests_1  |       /opt/gopath/src/github.com/hyperledger/fabric/common/mocks/peer/mockccstream.go:102 +0x486  unit-tests_1  |   testing.tRunner()  unit-tests_1  |       /opt/go/src/testing/testing.go:746 +0x16c  unit-tests_1  |  unit-tests_1  | Previous read at 0x00c42025a120 by goroutine 61:  unit-tests_1  |   runtime.chansend()  unit-tests_1  |       /opt/go/src/runtime/chan.go:128 +0x0  unit-tests_1  |   github.com/hyperledger/fabric/core/chaincode/shim.(*inProcStream).Send()  unit-tests_1  |       github.com/hyperledger/fabric/core/chaincode/shim/_test/_obj_test/inprocstream.go:41 +0xe0  unit-tests_1  |   github.com/hyperledger/fabric/core/chaincode/shim.(*Handler).serialSend()  unit-tests_1  |       github.com/hyperledger/fabric/core/chaincode/shim/_test/_obj_test/handler.go:62 +0xca  unit-tests_1  |   github.com/hyperledger/fabric/core/chaincode/shim.(*Handler).serialSendAsync.func1()  unit-tests_1  |       github.com/hyperledger/fabric/core/chaincode/shim/_test/_obj_test/handler.go:71 +0x5e  unit-tests_1  |  unit-tests_1  | Goroutine 64 (running) created at:  unit-tests_1  |   testing.(*T).Run()  unit-tests_1  |       /opt/go/src/testing/testing.go:789 +0x568  unit-tests_1  |   testing.runTests.func1()  unit-tests_1  |       /opt/go/src/testing/testing.go:1004 +0xa7  unit-tests_1  |   testing.tRunner()  unit-tests_1  |       /opt/go/src/testing/testing.go:746 +0x16c  unit-tests_1  |   testing.runTests()  unit-tests_1  |       /opt/go/src/testing/testing.go:1002 +0x521  unit-tests_1  |   testing.(*M).Run()  unit-tests_1  |       /opt/go/src/testing/testing.go:921 +0x206  unit-tests_1  |   main.main()  unit-tests_1  |       github.com/hyperledger/fabric/core/chaincode/shim/_test/_testmain.go:134 +0x2f0  unit-tests_1  |  unit-tests_1  | Goroutine 61 (finished) created at:  unit-tests_1  |   github.com/hyperledger/fabric/core/chaincode/shim.(*Handler).serialSendAsync()  unit-tests_1  |       github.com/hyperledger/fabric/core/chaincode/shim/_test/_obj_test/handler.go:69 +0x78  unit-tests_1  |   github.com/hyperledger/fabric/core/chaincode/shim.chatWithPeer.func1()  unit-tests_1  |       github.com/hyperledger/fabric/core/chaincode/shim/_test/_obj_test/chaincode.go:371 +0x68e  unit-tests_1  | ==================  unit-tests_1  | ==================  unit-tests_1  | WARNING: DATA RACE  unit-tests_1  | Write at 0x00c420292070 by goroutine 64:  unit-tests_1  |   github.com/hyperledger/fabric/core/chaincode/shim.TestStartInProc()  unit-tests_1  |       /opt/gopath/src/github.com/hyperledger/fabric/common/mocks/peer/mockccstream.go:103 +0x497  unit-tests_1  |   testing.tRunner()  unit-tests_1  |       /opt/go/src/testing/testing.go:746 +0x16c  unit-tests_1  |  unit-tests_1  | Previous read at 0x00c420292070 by goroutine 66:  unit-tests_1  |   github.com/hyperledger/fabric/common/mocks/peer.(*MockCCComm).Run()  unit-tests_1  |       /opt/gopath/src/github.com/hyperledger/fabric/common/mocks/peer/mockccstream.go:80 +0xa7  unit-tests_1  |   github.com/hyperledger/fabric/core/chaincode/shim.TestStartInProc.func2()  unit-tests_1  |       /opt/gopath/src/github.com/hyperledger/fabric/core/chaincode/shim/shim_test.go:861 +0x3d8  unit-tests_1  |  unit-tests_1  | Goroutine 64 (running) created at:  unit-tests_1  |   testing.(*T).Run()  unit-tests_1  |       /opt/go/src/testing/testing.go:789 +0x568  unit-tests_1  |   testing.runTests.func1()  unit-tests_1  |       /opt/go/src/testing/testing.go:1004 +0xa7  unit-tests_1  |   testing.tRunner()  unit-tests_1  |       /opt/go/src/testing/testing.go:746 +0x16c  unit-tests_1  |   testing.runTests()  unit-tests_1  |       /opt/go/src/testing/testing.go:1002 +0x521  unit-tests_1  |   testing.(*M).Run()  unit-tests_1  |       /opt/go/src/testing/testing.go:921 +0x206  unit-tests_1  |   main.main()  unit-tests_1  |       github.com/hyperledger/fabric/core/chaincode/shim/_test/_testmain.go:134 +0x2f0  unit-tests_1  |  unit-tests_1  | Goroutine 66 (running) created at:  unit-tests_1  |   github.com/hyperledger/fabric/core/chaincode/shim.TestStartInProc()  unit-tests_1  |       /opt/gopath/src/github.com/hyperledger/fabric/core/chaincode/shim/shim_test.go:856 +0x221  unit-tests_1  |   testing.tRunner()  unit-tests_1  |       /opt/go/src/testing/testing.go:746 +0x16c  unit-tests_1  | ==================  unit-tests_1  | ==================  unit-tests_1  | WARNING: DATA RACE  unit-tests_1  | Write at 0x00c42025a180 by goroutine 64:  unit-tests_1  |   runtime.closechan()  unit-tests_1  |       /opt/go/src/runtime/chan.go:313 +0x0  unit-tests_1  |   github.com/hyperledger/fabric/core/chaincode/shim.TestStartInProc()  unit-tests_1  |       /opt/gopath/src/github.com/hyperledger/fabric/common/mocks/peer/mockccstream.go:107 +0x41d  unit-tests_1  |   testing.tRunner()  unit-tests_1  |       /opt/go/src/testing/testing.go:746 +0x16c  unit-tests_1  |  unit-tests_1  | Previous read at 0x00c42025a180 by goroutine 69:  unit-tests_1  |   runtime.chansend()  unit-tests_1  |       /opt/go/src/runtime/chan.go:128 +0x0  unit-tests_1  |   github.com/hyperledger/fabric/common/mocks/peer.(*MockCCComm).Send()  unit-tests_1  |       /opt/gopath/src/github.com/hyperledger/fabric/common/mocks/peer/mockccstream.go:74 +0x94  unit-tests_1  |   github.com/hyperledger/fabric/common/mocks/peer.(*MockCCComm).ka()  unit-tests_1  |       /opt/gopath/src/github.com/hyperledger/fabric/common/mocks/peer/mockccstream.go:140 +0x7b  unit-tests_1  |  unit-tests_1  | Goroutine 64 (running) created at:  unit-tests_1  |   testing.(*T).Run()  unit-tests_1  |       /opt/go/src/testing/testing.go:789 +0x568  unit-tests_1  |   testing.runTests.func1()  unit-tests_1  |       /opt/go/src/testing/testing.go:1004 +0xa7  unit-tests_1  |   testing.tRunner()  unit-tests_1  |       /opt/go/src/testing/testing.go:746 +0x16c  unit-tests_1  |   testing.runTests()  unit-tests_1  |       /opt/go/src/testing/testing.go:1002 +0x521  unit-tests_1  |   testing.(*M).Run()  unit-tests_1  |       /opt/go/src/testing/testing.go:921 +0x206  unit-tests_1  |   main.main()  unit-tests_1  |       github.com/hyperledger/fabric/core/chaincode/shim/_test/_testmain.go:134 +0x2f0  unit-tests_1  |  unit-tests_1  | Goroutine 69 (running) created at:  unit-tests_1  |   github.com/hyperledger/fabric/common/mocks/peer.(*MockCCComm).Run()  unit-tests_1  |       /opt/gopath/src/github.com/hyperledger/fabric/common/mocks/peer/mockccstream.go:148 +0x62  unit-tests_1  |   github.com/hyperledger/fabric/core/chaincode/shim.TestStartInProc.func2()  unit-tests_1  |       /opt/gopath/src/github.com/hyperledger/fabric/core/chaincode/shim/shim_test.go:861 +0x3d8  unit-tests_1  | ==================  unit-tests_1  | ==================  unit-tests_1  | WARNING: DATA RACE  unit-tests_1  | Write at 0x00c420292078 by goroutine 64:  unit-tests_1  |   github.com/hyperledger/fabric/core/chaincode/shim.TestStartInProc()  unit-tests_1  |       /opt/gopath/src/github.com/hyperledger/fabric/common/mocks/peer/mockccstream.go:108 +0x42e  unit-tests_1  |   testing.tRunner()  unit-tests_1  |       /opt/go/src/testing/testing.go:746 +0x16c  unit-tests_1  |  unit-tests_1  | Previous read at 0x00c420292078 by goroutine 69:  unit-tests_1  |   github.com/hyperledger/fabric/common/mocks/peer.(*MockCCComm).Send()  unit-tests_1  |       /opt/gopath/src/github.com/hyperledger/fabric/common/mocks/peer/mockccstream.go:74 +0x78  unit-tests_1  |   github.com/hyperledger/fabric/common/mocks/peer.(*MockCCComm).ka()  unit-tests_1  |       /opt/gopath/src/github.com/hyperledger/fabric/common/mocks/peer/mockccstream.go:140 +0x7b  unit-tests_1  |  unit-tests_1  | Goroutine 64 (running) created at:  unit-tests_1  |   testing.(*T).Run()  unit-tests_1  |       /opt/go/src/testing/testing.go:789 +0x568  unit-tests_1  |   testing.runTests.func1()  unit-tests_1  |       /opt/go/src/testing/testing.go:1004 +0xa7  unit-tests_1  |   testing.tRunner()  unit-tests_1  |       /opt/go/src/testing/testing.go:746 +0x16c  unit-tests_1  |   testing.runTests()  unit-tests_1  |       /opt/go/src/testing/testing.go:1002 +0x521  unit-tests_1  |   testing.(*M).Run()  unit-tests_1  |       /opt/go/src/testing/testing.go:921 +0x206  unit-tests_1  |   main.main()  unit-tests_1  |       github.com/hyperledger/fabric/core/chaincode/shim/_test/_testmain.go:134 +0x2f0  unit-tests_1  |  unit-tests_1  | Goroutine 69 (running) created at:  unit-tests_1  |   github.com/hyperledger/fabric/common/mocks/peer.(*MockCCComm).Run()  unit-tests_1  |       /opt/gopath/src/github.com/hyperledger/fabric/common/mocks/peer/mockccstream.go:148 +0x62  unit-tests_1  |   github.com/hyperledger/fabric/core/chaincode/shim.TestStartInProc.func2()  unit-tests_1  |       /opt/gopath/src/github.com/hyperledger/fabric/core/chaincode/shim/shim_test.go:861 +0x3d8  unit-tests_1  | =================={code}  ></description> </Issue>
