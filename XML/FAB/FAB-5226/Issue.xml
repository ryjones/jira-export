<Issue id="19103" key="FAB-5226" number="5226" project="10002" reporter="hongquan.zhang" assignee="sanchezl" creator="hongquan.zhang" type="10004" summary="orderer can not connect kafka if TLS is enabled" priority="3" resolution="10000" status="6" created="2017-07-10 10:37:35.0" updated="2018-07-20 14:13:43.0" resolutiondate="2017-07-11 08:04:55.0" votes="0" watches="3" workflowId="39403"> <environment><! CDATA ubuntu 14.04   docker 17.05-ce     ></environment> <description><! CDATA At first, there's a minor bug in fabric/orderer/kafka/config.go, function newBrokerConfig. {code:java} for _, certificate := range tlsConfig.RootCAs {     if !rootCAs.AppendCertsFromPEM(  byte(certificate)) {                 logger.Panic(fmt.Sprintf("Unable to parse the root certificate authority certificates (Kafka.Tls.RootCAs)"))    }  {code} rootCAs.AppendCertsFromPEM accpet ca file content, not the file name.  After correcting this by read ca file content into a byte slice and pass the byte slice into AppendCertsFromPEM. orderer can load RooCAs correctly.  But then orderer can not complete tls handshake with kafka.  The error message from orderer is: {code:java} Failed to connect to broker kafka1:9093: tls: first record does not look like a TLS handshake{code} I use openssl s_client -debug -connect kafka1:9093 to verify the tls setting on kafka1 and find it's OK.  ></description> </Issue>
