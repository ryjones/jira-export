<Issue id="38661" key="FAB-14762" number="14762" project="10002" reporter="bharadwajambati1" creator="bharadwajambati1" type="10004" summary="Orderer3rd removed, re-added but is not accepted" priority="3" resolution="10204" status="6" created="2019-03-21 22:17:22.0" updated="2019-03-25 20:58:15.0" resolutiondate="2019-03-25 20:58:15.0" votes="0" watches="5" workflowId="50306"> <description><! CDATA h3. Expected:  While executing FAB-14753 the onboarded orderer should pull blocks from the other OSNs, and then continue as a functioning member of the channel. h3. Observed:  *Revising this description with the new data. Refer to modified testcase (as of March 22), with the added step where we restart the orderer before sending config updates to add the orderer to the channels again.*   We observed that after adding the orderer again to the application channel, its blockheight does not grow. It maintains the same block count from the time when it was removed from the application channel.  We sent the config updates to orderer1. Orderer3rd was removed ok, and then added but it does not seem to know it is a part of the channel again. The channel leader sends something to it, but then almost seems stuck forever processing the config update. Maybe ... is the problem during the processing of the config update, because the certs are the same?  Refer to some interesting logs below.  In the linked logDNA data, you may observe that orderer3rd was removed, and then added, in the channel1. Interestingly, orderer2nd was the leader of the orderersystemchannel and channel1 and continued happily in that role throughout.  URL for orderer logs: Go to  https://cloud.ibm.com/observe/logging  and click on View LogDNA for LogDNA-community-svt-lab  Metrics URL:  https://prometheus.community-svt.us-south.containers.appdomain.cloud/graph?g0.range_input=10s&g0.expr=consensus_etcdraft_committed_block_number&g0.tab=0    Timestamp at which the orderer was removed: Mar 21 17:52:31   Timestamp at which the orderer has added again to the application channel: Mar 21 17:55:47     Some interesting logs, from orderer1st, which occur approximately when the config update was first processed to add the orderer2nd back into the channel1:     {{Mar 21 17:55:46 orderer1st-ordererorg1-67d6bf8749-tll28 orderer1st-ordererorg1 2019-03-21 21:55:46.300 UTC  orderer.consensus.etcdraft  submitSent -> DEBU 63fa8 Sending msg of 5839 bytes to 2 on channel testorgschannel1 took 45.827µs Mar 21 17:55:46 orderer1st-ordererorg1-67d6bf8749-tll28 orderer1st-ordererorg1 2019-03-21 21:55:46.300 UTC  orderer.common.cluster.step  sendMessage -> DEBU 63fa9 Send of SubmitRequest for channel testorgschannel1 with payload of size 5839 to orderer2nd-ordererorg1.ordererorg1(orderer2nd-ordererorg1:7050) took 174.608µs Mar 21 17:55:46 orderer1st-ordererorg1-67d6bf8749-tll28 orderer1st-ordererorg1 2019-03-21 21:55:46.304 UTC  orderer.common.cluster.step  handleMessage -> DEBU 63faa Received message from orderer2nd-ordererorg1.ordererorg1(172.30.8.28:57200): ConsensusRequest for channel testorgschannel1 with payload of size 59080 Mar 21 17:55:46 orderer1st-ordererorg1-67d6bf8749-tll28 orderer1st-ordererorg1 2019-03-21 21:55:46.306 UTC  orderer.consensus.etcdraft  consensusSent -> DEBU 63fab Sending msg of 29 bytes to 2 on channel testorgschannel1 took 12.66µs Mar 21 17:55:46 orderer1st-ordererorg1-67d6bf8749-tll28 orderer1st-ordererorg1 2019-03-21 21:55:46.306 UTC  orderer.common.cluster.step  sendMessage -> DEBU 63fac Send of ConsensusRequest for channel testorgschannel1 with payload of size 29 to orderer2nd-ordererorg1.ordererorg1(orderer2nd-ordererorg1:7050) took 73.836µs Mar 21 17:55:46 orderer1st-ordererorg1-67d6bf8749-tll28 orderer1st-ordererorg1 2019-03-21 21:55:46.307 UTC  orderer.common.cluster.step  handleMessage -> DEBU 63fad Received message from orderer2nd-ordererorg1.ordererorg1(172.30.8.28:57200): ConsensusRequest for channel testorgschannel1 with payload of size 30 Mar 21 17:55:46 orderer1st-ordererorg1-67d6bf8749-tll28 orderer1st-ordererorg1 2019-03-21 21:55:46.307 UTC  orderer.consensus.etcdraft  consensusSent -> DEBU 63fae Sending msg of 29 bytes to 2 on channel testorgschannel1 took 17.395µs Mar 21 17:55:46 orderer1st-ordererorg1-67d6bf8749-tll28 orderer1st-ordererorg1 2019-03-21 21:55:46.307 UTC  orderer.consensus.etcdraft  writeBlock -> INFO 63faf Writing block 1265 (Raft index: 1270) to ledger channel=testorgschannel1 node=1 Mar 21 17:55:46 orderer1st-ordererorg1-67d6bf8749-tll28 orderer1st-ordererorg1 2019-03-21 21:55:46.307 UTC  orderer.common.cluster.step  sendMessage -> DEBU 63fb0 Send of ConsensusRequest for channel testorgschannel1 with payload of size 29 to orderer2nd-ordererorg1.ordererorg1(orderer2nd-ordererorg1:7050) took 65.539µs Mar 21 17:55:46 orderer1st-ordererorg1-67d6bf8749-tll28 orderer1st-ordererorg1 2019-03-21 21:55:46.307 UTC  msp  GetDefaultSigningIdentity -> DEBU 63fb1 Obtaining default signing identity}}     ></description> </Issue>
