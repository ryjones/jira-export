<Issue id="17413" key="FAB-4330" number="4330" project="10002" reporter="rhegde" assignee="jyellick" creator="rhegde" type="10004" summary="Orderer panics with data-persistence and after orderer container restart " priority="1" resolution="10000" status="6" created="2017-06-02 17:25:13.0" updated="2018-07-20 14:13:05.0" resolutiondate="2017-06-03 13:35:06.0" votes="0" watches="2" workflowId="38789" security="10001"> <description><! CDATA {{We were trying the data persistence of fabric-network and found the orderer panic 2017-06-02 16:20:23.913 UTC  orderer/multichain  newLedgerResources -> CRIT 5b6 Error creating configtx manager and handlers: Bad envelope: Not a tx of type CONFIG}}  Following are the steps performed using the alpha3 release of the fabric (published by @rameshthoomu on fabric-ci channel -  https://chat.hyperledger.org/channel/fabric-ci?msg=8KeH9TZbB4aY5Y9Bb  , ({{FABRIC# -f647b6f}})) 1. Run the fabric with data-persistence setup for peer and orderer (mounting of /var/hyperledger/production). This is using the E2E CLI however with some more organizations (5) 2. Deploy chaincode, perform transaction. Verified - this transaction are reflected on the couch-db (and thus ledger). 3. Restart the docker containers (orderer, peer, couchdb, ca (all)  - first time) 4. Perform some transaction, Verified - this transaction are reflected on the couch-db. 5. Restart the docker container - (orderer, peer, couchdb, ca (all) - second time)     6. Orderer panic with above error.  Can you please suggest. {quote}{{2017-06-02 16:58:51.695 UTC  common/config  NewStandardValues -> DEBU 5b1 Initializing protos for *config.ChannelProtos}}}} {{2017-06-02 16:58:51.695 UTC  common/config  initializeProtosStruct -> DEBU 5b2 Processing field: HashingAlgorithm}} {{2017-06-02 16:58:51.695 UTC  common/config  initializeProtosStruct -> DEBU 5b3 Processing field: BlockDataHashingStructure}} {{2017-06-02 16:58:51.695 UTC  common/config  initializeProtosStruct -> DEBU 5b4 Processing field: OrdererAddresses}} {{2017-06-02 16:58:51.695 UTC  common/config  initializeProtosStruct -> DEBU 5b5 Processing field: Consortium}} {{2017-06-02 16:58:51.695 UTC  orderer/multichain  newLedgerResources -> CRIT 5b6 Error creating configtx manager and handlers: Bad envelope: Not a tx of type CONFIG}} {{panic: Error creating configtx manager and handlers: Bad envelope: Not a tx of type CONFIG}}{{goroutine 1  running :}} {{panic(0xb03100, 0xc420163800)}} \{\{ \{\{ /opt/go/src/runtime/panic.go:500 +0x1a1}}}} {{github.com/hyperledger/fabric/vendor/github.com/op/go-logging.(*Logger).Panicf(0xc420183d40, 0xc39f84, 0x30, 0xc420163640, 0x1, 0x1)}} \{\{ \{\{ /opt/gopath/src/github.com/hyperledger/fabric/vendor/github.com/op/go-logging/logger.go:194 +0x127}}}} {{github.com/hyperledger/fabric/orderer/multichain.(*multiLedger).newLedgerResources(0xc42025e0f0, 0xc420cd4960, 0xc420cd4960)}} \{\{ \{\{ /opt/gopath/src/github.com/hyperledger/fabric/orderer/multichain/manager.go:159 +0x393}}}} {{github.com/hyperledger/fabric/orderer/multichain.NewManagerImpl(0x11af3c0, 0xc42032e1e0, 0xc42026c840, 0x11acbc0, 0x11f3900, 0x0, 0x0)}} \{\{ \{\{ /opt/gopath/src/github.com/hyperledger/fabric/orderer/multichain/manager.go:109 +0x23b}}}} {{main.initializeMultiChainManager(0xc4201dbd40, 0x11acbc0, 0x11f3900, 0xc420206701, 0xc420206780)}} \{\{ \{\{ /opt/gopath/src/github.com/hyperledger/fabric/orderer/main.go:199 +0x5c4}}}} {{main.main()}} \{\{ \{\{ /opt/gopath/src/github.com/hyperledger/fabric/orderer/main.go:59 +0xb2}} {quote}  ></description> </Issue>
