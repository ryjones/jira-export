<Issue id="44822" key="FAB-17762" number="17762" project="10002" reporter="dereckluo" assignee="senthil1" creator="dereckluo" type="10004" summary="fix non-determinism in the couchdb index processing " priority="2" resolution="10000" status="6" created="2020-04-15 15:43:53.0" updated="2020-04-28 03:23:13.0" resolutiondate="2020-04-28 03:23:13.0" votes="0" watches="4" workflowId="58741" archived="N"> <description><! CDATA Unit test flake in TestHandleChaincodeDeployErroneousIndexFile, log attached.  Might be related to JIRA https://jira.hyperledger.org/browse/FAB-17737   {code:java} 2020-04-15T15:25:41.8567157Z  36m2020-04-15 15:25:38.539 UTC  statecouchdb  applyAdditionalQueryOptions -> DEBU 236 0m Rewritten query: {"limit":1000,"selector":{"owner":"fred"},"sort": {"size":"desc"} } 2020-04-15T15:25:41.8568585Z  36m2020-04-15 15:25:38.540 UTC  statecouchdb  applyAdditionalQueryOptions -> DEBU 237 0m Rewritten query: {"limit":1000,"selector":{"owner":"fred"},"sort": {"size":"desc"} } 2020-04-15T15:25:41.8570452Z  36m2020-04-15 15:25:38.542 UTC  statecouchdb  executeQueryWithBookmark -> DEBU 238 0m Error calling QueryDocuments(): error handling CouchDB request. Error:no_usable_index,  Status Code:400,  Reason:No index exists for this sort, try indexing by the sort fields. 2020-04-15T15:25:41.8571369Z --- FAIL: TestHandleChaincodeDeployErroneousIndexFile (2.13s) 2020-04-15T15:25:41.8571713Z     statecouchdb_test_export.go:34: Initializing TestVDBEnv 2020-04-15T15:25:41.8572146Z     statecouchdb_test.go:665:  2020-04-15T15:25:41.8572417Z         	Error Trace:	statecouchdb_test.go:665 2020-04-15T15:25:41.8572921Z         	Error:      	Condition never satisfied 2020-04-15T15:25:41.8573231Z         	Test:       	TestHandleChaincodeDeployErroneousIndexFile 2020-04-15T15:25:41.8573802Z         	Messages:   	error executing query with sort 2020-04-15T15:25:41.8574240Z     statecouchdb_test_export.go:89: Cleaningup TestVDBEnv 2020-04-15T15:25:41.8575112Z  36m2020-04-15 15:25:38.658 UTC  statecouchdb  NewVersionedDBProvider -> DEBU 239 0m constructing CouchDB VersionedDBProvider 2020-04-15T15:25:41.8576240Z  36m2020-04-15 15:25:38.686 UTC  statecouchdb  checkExpectedDataformatVersion -> DEBU 23a 0m couch instance is empty. Setting dataformat version to 2.0 2020-04-15T15:25:41.8577355Z  34m2020-04-15 15:25:38.735 UTC  couchdb  CreateDatabaseIfNotExist -> INFO 23b 0m Created state database testpaginatedquery_ 2020-04-15T15:25:41.8579463Z  36m2020-04-15 15:25:38.736 UTC  statecouchdb  newVersionedDB -> DEBU 23c 0m chain  testpaginatedquery : checking for redolog record {code}   ></description> </Issue>
