<Issue id="38451" key="FAB-14639" number="14639" project="10002" reporter="hagarm" assignee="hagarm" creator="hagarm" type="10003" summary="Address data races in gossip/gossip/channel" priority="3" resolution="10000" status="6" created="2019-03-14 10:55:34.0" updated="2019-03-15 10:23:38.0" resolutiondate="2019-03-15 10:23:38.0" votes="0" watches="1" workflowId="50094"> <description><! CDATA WARNING: DATA RACE Write at 0x00c0004b6050 by goroutine 99: github.com/hyperledger/fabric/vendor/github.com/stretchr/testify/mock.(*Mock).On() /Users/hagarmei/golang/src/github.com/hyperledger/fabric/vendor/github.com/stretchr/testify/mock/mock.go:255 +0x45e github.com/hyperledger/fabric/gossip/gossip/channel.(*gossipAdapterMock).wasMocked() /Users/hagarmei/golang/src/github.com/hyperledger/fabric/gossip/gossip/channel/channel_test.go:267 +0xb4 github.com/hyperledger/fabric/gossip/gossip/channel.(*gossipAdapterMock).Lookup() /Users/hagarmei/golang/src/github.com/hyperledger/fabric/gossip/gossip/channel/channel_test.go:223 +0x65 github.com/hyperledger/fabric/gossip/gossip/channel.NewGossipChannel.func4() github.com/hyperledger/fabric/gossip/gossip/channel.(*gossipAdapterMock).wasMocked() /Users/hagarmei/golang/src/github.com/hyperledger/fabric/gossip/gossip/channel/channel_test.go:267 +0xb4 github.com/hyperledger/fabric/gossip/gossip/channel.(*gossipAdapterMock).GetIdentityByPKIID() /Users/hagarmei/golang/src/github.com/hyperledger/fabric/gossip/gossip/channel/channel_test.go:258 +0x65 github.com/hyperledger/fabric/gossip/gossip/channel.NewGossipChannel.func5() /Users/hagarmei/golang/src/github.com/hyperledger/fabric/gossip/gossip/channel/channel.go:230 +0x212 github.com/hyperledger/fabric/gossip/gossip/channel.(*stateInfoCache).Add() /Users/hagarmei/golang/src/github.com/hyperledger/fabric/gossip/gossip/channel/channel.go:966 +0xed github.com/hyperledger/fabric/gossip/gossip/channel.(*gossipChannel).HandleMessage() /Users/hagarmei/golang/src/github.com/hyperledger/fabric/gossip/gossip/channel/channel.go:605 +0xefa github.com/hyperledger/fabric/gossip/gossip/channel.TestGossipChannelEligibility() /Users/hagarmei/golang/src/github.com/hyperledger/fabric/gossip/gossip/channel/channel_test.go:1594 +0x1a25 testing.tRunner() /usr/local/go/src/testing/testing.go:827 +0x162  Previous read at 0x00c00040a000 by goroutine 128: github.com/hyperledger/fabric/gossip/gossip/channel.(*gossipAdapterMock).wasMocked() /Users/hagarmei/golang/src/github.com/hyperledger/fabric/gossip/gossip/channel/channel_test.go:268 +0xc2 github.com/hyperledger/fabric/gossip/gossip/channel.(*gossipAdapterMock).GetIdentityByPKIID() /Users/hagarmei/golang/src/github.com/hyperledger/fabric/gossip/gossip/channel/channel_test.go:258 +0x65 github.com/hyperledger/fabric/gossip/gossip/channel.(*gossipChannel).EligibleForChannel() /Users/hagarmei/golang/src/github.com/hyperledger/fabric/gossip/gossip/channel/channel.go:505 +0x93 github.com/hyperledger/fabric/gossip/gossip/channel.(*gossipChannel).GetPeers() /Users/hagarmei/golang/src/github.com/hyperledger/fabric/gossip/gossip/channel/channel.go:357 +0x1e5 github.com/hyperledger/fabric/gossip/gossip/channel.(*gossipChannel).GetPeers-fm() /Users/hagarmei/golang/src/github.com/hyperledger/fabric/gossip/gossip/channel/channel.go:282 +0x41 github.com/hyperledger/fabric/gossip/gossip/channel.(*membershipTracker).trackMembershipChanges() /Users/hagarmei/golang/src/github.com/hyperledger/fabric/gossip/gossip/channel/channel.go:1063 +0xc2  Goroutine 36 (running) created at: testing.(*T).Run() /usr/local/go/src/testing/testing.go:878 +0x659 testing.runTests.func1() /usr/local/go/src/testing/testing.go:1119 +0xa8 testing.tRunner() /usr/local/go/src/testing/testing.go:827 +0x162 testing.runTests() /usr/local/go/src/testing/testing.go:1117 +0x4ee testing.(*M).Run() /usr/local/go/src/testing/testing.go:1034 +0x2ee main.main() _testmain.go:140 +0x332  Goroutine 128 (running) created at: github.com/hyperledger/fabric/gossip/gossip/channel.NewGossipChannel() /Users/hagarmei/golang/src/github.com/hyperledger/fabric/gossip/gossip/channel/channel.go:290 +0x12bd github.com/hyperledger/fabric/gossip/gossip/channel.TestGossipChannelEligibility() /Users/hagarmei/golang/src/github.com/hyperledger/fabric/gossip/gossip/channel/channel_test.go:1586 +0x1617 testing.tRunner() /usr/local/go/src/testing/testing.go:827 +0x162     WARNING: DATA RACE Write at 0x00c000103b80 by goroutine 6: github.com/hyperledger/fabric/gossip/gossip/channel.TestOnDemandGossip() /Users/hagarmei/golang/src/github.com/hyperledger/fabric/gossip/gossip/channel/channel_test.go:1769 +0xc4c testing.tRunner() /usr/local/go/src/testing/testing.go:827 +0x162  Previous read at 0x00c000103b80 by goroutine 15: github.com/hyperledger/fabric/gossip/gossip/channel.(*gossipChannel).publishStateInfo() /Users/hagarmei/golang/src/github.com/hyperledger/fabric/gossip/gossip/channel/channel.go:405 +0xd3 github.com/hyperledger/fabric/gossip/gossip/channel.(*gossipChannel).publishStateInfo-fm() /Users/hagarmei/golang/src/github.com/hyperledger/fabric/gossip/gossip/channel/channel.go:281 +0x41 github.com/hyperledger/fabric/gossip/gossip/channel.(*gossipChannel).periodicalInvocation() /Users/hagarmei/golang/src/github.com/hyperledger/fabric/gossip/gossip/channel/channel.go:319 +0x4e  Goroutine 6 (running) created at: testing.(*T).Run() /usr/local/go/src/testing/testing.go:878 +0x659 testing.runTests.func1() /usr/local/go/src/testing/testing.go:1119 +0xa8 testing.tRunner() /usr/local/go/src/testing/testing.go:827 +0x162 testing.runTests() /usr/local/go/src/testing/testing.go:1117 +0x4ee testing.(*M).Run() /usr/local/go/src/testing/testing.go:1034 +0x2ee main.main() _testmain.go:92 +0x221  Goroutine 15 (running) created at: github.com/hyperledger/fabric/gossip/gossip/channel.NewGossipChannel() /Users/hagarmei/golang/src/github.com/hyperledger/fabric/gossip/gossip/channel/channel.go:281 +0xd50 github.com/hyperledger/fabric/gossip/gossip/channel.TestOnDemandGossip() /Users/hagarmei/golang/src/github.com/hyperledger/fabric/gossip/gossip/channel/channel_test.go:1744 +0x73c testing.tRunner() /usr/local/go/src/testing/testing.go:827 +0x162     ></description> </Issue>
