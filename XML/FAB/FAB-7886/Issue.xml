<Issue id="27049" key="FAB-7886" number="7886" project="10002" reporter="adnanchoudhury" assignee="chris.elder" creator="adnanchoudhury" type="10004" summary="Node and golang chaincode do not consistently validate couchdb index file extension (.json)" priority="3" resolution="10000" status="6" created="2018-01-24 20:40:31.0" updated="2018-07-20 14:15:32.0" resolutiondate="2018-02-22 02:21:23.0" votes="0" watches="4" workflowId="41042"> <description><! CDATA When using Golang CC, the presence of a *.txt file (containing multiple json indexes) does not cause any issues in creating indexes from valid index definition files, but while using Node CC, the peer crashes with following error:    Â  {code:java}  36m2018-01-24 18:25:09.185 UTC  statecouchdb  HandleChaincodeDeploy -> DEBU 937 0m Reading artifact from file: META-INF/statedb/couchdb/indexes/backup.txt  36m2018-01-24 18:25:09.185 UTC  statecouchdb  HandleChaincodeDeploy -> DEBU 938 0m Creating index from file file: backup.txt  36m2018-01-24 18:25:09.185 UTC  couchdb  CreateIndex -> DEBU 939 0m Entering CreateIndex() indexdefinition={"index":{"fields": "data.docType","data.owner" },"name":"indexOwner","type":"json"} {"index":{"fields": "data.owner" },"name":"indexOwnerOnly","type":"json"} {"index":{"fields": "data.docType","data.owner", "data.color", "data.size" },"name":"indexAll","type":"json"}  33m2018-01-24 18:25:09.185 UTC  cceventmgmt  HandleChaincodeDeploy -> WARN 93a 0m Error while invoking a listener for handling chaincode install event: JSON format is not valid  31m2018-01-24 18:25:09.186 UTC  gossip/state  commitBlock -> ERRO 93b 0m Got error while committing(JSON format is not valid commit failed github.com/hyperledger/fabric/gossip/privdata.(*coordinator).StoreBlock /opt/gopath/src/github.com/hyperledger/fabric/gossip/privdata/coordinator.go:225 github.com/hyperledger/fabric/gossip/state.(*GossipStateProviderImpl).commitBlock /opt/gopath/src/github.com/hyperledger/fabric/gossip/state/state.go:781 github.com/hyperledger/fabric/gossip/state.(*GossipStateProviderImpl).deliverPayloads /opt/gopath/src/github.com/hyperledger/fabric/gossip/state/state.go:561 runtime.goexit /opt/go/src/runtime/asm_amd64.s:2337 github.com/hyperledger/fabric/gossip/state.(*GossipStateProviderImpl).commitBlock /opt/gopath/src/github.com/hyperledger/fabric/gossip/state/state.go:782 github.com/hyperledger/fabric/gossip/state.(*GossipStateProviderImpl).deliverPayloads /opt/gopath/src/github.com/hyperledger/fabric/gossip/state/state.go:561 runtime.goexit /opt/go/src/runtime/asm_amd64.s:2337)  35m2018-01-24 18:25:09.186 UTC  gossip/state  deliverPayloads -> CRIT 93c 0m Cannot commit block to the ledger due to JSON format is not valid commit failed github.com/hyperledger/fabric/gossip/privdata.(*coordinator).StoreBlock /opt/gopath/src/github.com/hyperledger/fabric/gossip/privdata/coordinator.go:225 github.com/hyperledger/fabric/gossip/state.(*GossipStateProviderImpl).commitBlock /opt/gopath/src/github.com/hyperledger/fabric/gossip/state/state.go:781 github.com/hyperledger/fabric/gossip/state.(*GossipStateProviderImpl).deliverPayloads /opt/gopath/src/github.com/hyperledger/fabric/gossip/state/state.go:561 runtime.goexit /opt/go/src/runtime/asm_amd64.s:2337 github.com/hyperledger/fabric/gossip/state.(*GossipStateProviderImpl).deliverPayloads /opt/gopath/src/github.com/hyperledger/fabric/gossip/state/state.go:566 runtime.goexit /opt/go/src/runtime/asm_amd64.s:2337 panic: Cannot commit block to the ledger due to JSON format is not valid commit failed github.com/hyperledger/fabric/gossip/privdata.(*coordinator).StoreBlock /opt/gopath/src/github.com/hyperledger/fabric/gossip/privdata/coordinator.go:225 github.com/hyperledger/fabric/gossip/state.(*GossipStateProviderImpl).commitBlock /opt/gopath/src/github.com/hyperledger/fabric/gossip/state/state.go:781 github.com/hyperledger/fabric/gossip/state.(*GossipStateProviderImpl).deliverPayloads /opt/gopath/src/github.com/hyperledger/fabric/gossip/state/state.go:561 runtime.goexit /opt/go/src/runtime/asm_amd64.s:2337 github.com/hyperledger/fabric/gossip/state.(*GossipStateProviderImpl).deliverPayloads /opt/gopath/src/github.com/hyperledger/fabric/gossip/state/state.go:566 runtime.goexit /opt/go/src/runtime/asm_amd64.s:2337 goroutine 409  running : github.com/hyperledger/fabric/vendor/github.com/op/go-logging.(*Logger).Panicf(0xc4201e2840, 0xf0c2f5, 0x2c, 0xc421532330, 0x1, 0x1) /opt/gopath/src/github.com/hyperledger/fabric/vendor/github.com/op/go-logging/logger.go:194 {code} *Expected:*  From the description from FAB-3067, the expected behavior is that the txt file is ignored and normal operation continues in *both* cases.  Attached is the peer log with Golang CC and Node CC.  ></description> </Issue>
