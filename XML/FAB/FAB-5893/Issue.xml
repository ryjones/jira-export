<Issue id="20367" key="FAB-5893" number="5893" project="10002" reporter="jkirke" assignee="muralisr" creator="jkirke" type="10004" summary="invokes fail on org added after chaincode is instantiated" priority="3" resolution="10000" status="6" created="2017-08-23 17:43:11.0" updated="2019-01-02 07:20:24.0" resolutiondate="2018-02-19 20:58:41.0" votes="0" watches="4" workflowId="39824"> <description><! CDATA Invokes fail on org added after chaincode is instantiated. Executed on Fabric 1.0.1  Steps: Create channel with org01 and org02 Join each org to channel Add 2 peers per org Attempt to join channel with org03 (fails appropriately) Edit channel and add org03 Join org03 to channel Add 2 peers for org03 Install cc on all 6 peers Instantiate on org01 peer Query on all 6 peers Invoke on all 6 peers Query on all 6 peers Attempt to join channel with org04 (fails appropriately) Edit channel and add org04 Join org04 to channel Add 2 peers for org04 Install cc on all org04 peers Query on all 8 peers Invoke on all 8 peers (fails on org04 peers)  SDK output:  root@JasonHSBN1:/home/ibmadmin/quality/v1.0_sdk_tests# node app.js invoke -c lateadd -i lateadd -v 1 -m 1 -o b -p fabric-peer-org4-28780c info: Clearing Cached Key Value Stores TAP version 13 # ***** invoke transaction to move money ***** # getMember, name: admin, client.getUserContext(admin, true) ok 1 Successfully enrolled user 'admin' ok 2 Successfully enrolled org: PeerOrg4 info:  invoke-chaincode : create new peer grpcs://tor-zbc06c.3.secure.blockchain.ibm.com:28780 info:  invoke-chaincode : create new eventhub grpcs://tor-zbc06c.3.secure.blockchain.ibm.com:22572 info:  EventHub.js : _connect - options \{} info:  invoke-chaincode : setConfigSetting("E2E_TX_ID") = 4894d1a43cc538f47cfa9e6aac4c541e0ee8262a141a345bbe518d9c69c04782 # Sending transaction "4894d1a43cc538f47cfa9e6aac4c541e0ee8262a141a345bbe518d9c69c04782" # ***************************************************************************** # stop and start the peer event hub ---- N O W ----- you have 0 millis # ***************************************************************************** ok 3 transaction proposal has response status of good ok 4 transaction proposal signature and endorser are valid ok 5 compareProposalResponseResults execution did not throw an error ok 6 All proposals have a matching read/writes sets ok 7 Successfully sent Proposal and received ProposalResponse: Status - 200, message - "OK", metadata - "", endorsement signature: 0D "▒▒r)d )?�"o8'��;f����� V˚��k7k����\{��T��&���P y��� not ok 8 The balance transfer transaction was invalid, code = ENDORSEMENT_POLICY_FAILURE --- operator: fail at: EventHub._processTxOnEvents (/home/ibmadmin/quality/v1.0_sdk_tests/node_modules/fabric-client/lib/EventHub.js:775:5) stack: |- Error: The balance transfer transaction was invalid, code = ENDORSEMENT_POLICY_FAILURE at Test.assert  as _assert  (/home/ibmadmin/quality/v1.0_sdk_tests/node_modules/tape/lib/test.js:212:54) at Test.bound  as _assert  (/home/ibmadmin/quality/v1.0_sdk_tests/node_modules/tape/lib/test.js:64:32) at Test.fail (/home/ibmadmin/quality/v1.0_sdk_tests/node_modules/tape/lib/test.js:277:10) at Test.bound  as fail  (/home/ibmadmin/quality/v1.0_sdk_tests/node_modules/tape/lib/test.js:64:32) at /home/ibmadmin/quality/v1.0_sdk_tests/tests.js:976:39 at EventHub._processTxOnEvents (/home/ibmadmin/quality/v1.0_sdk_tests/node_modules/fabric-client/lib/EventHub.js:775:5) at ClientDuplexStream. (/home/ibmadmin/quality/v1.0_sdk_tests/node_modules/fabric-client/lib/EventHub.js:310:10) at emitOne (events.js:96:13) at ClientDuplexStream.emit (events.js:188:7) at readableAddChunk (_stream_readable.js:176:18) ... not ok 9 Failed to send transaction and get notifications within the timeout period. --- operator: fail at: process._tickCallback (internal/process/next_tick.js:109:7) stack: |- Error: Failed to send transaction and get notifications within the timeout period. at Test.assert  as _assert  (/home/ibmadmin/quality/v1.0_sdk_tests/node_modules/tape/lib/test.js:212:54) at Test.bound  as _assert  (/home/ibmadmin/quality/v1.0_sdk_tests/node_modules/tape/lib/test.js:64:32) at Test.fail (/home/ibmadmin/quality/v1.0_sdk_tests/node_modules/tape/lib/test.js:277:10) at Test.bound  as fail  (/home/ibmadmin/quality/v1.0_sdk_tests/node_modules/tape/lib/test.js:64:32) at /home/ibmadmin/quality/v1.0_sdk_tests/tests.js:1003:27 at process._tickCallback (internal/process/next_tick.js:109:7) ... not ok 10 Error: Failed to send transaction and get notifications within the timeout period. at /home/ibmadmin/quality/v1.0_sdk_tests/tests.js:1004:31 at process._tickCallback (internal/process/next_tick.js:109:7) --- operator: fail at: process._tickCallback (internal/process/next_tick.js:109:7) stack: |- Error: Error: Failed to send transaction and get notifications within the timeout period. at /home/ibmadmin/quality/v1.0_sdk_tests/tests.js:1004:31 at process._tickCallback (internal/process/next_tick.js:109:7) at Test.assert  as _assert  (/home/ibmadmin/quality/v1.0_sdk_tests/node_modules/tape/lib/test.js:212:54) at Test.bound  as _assert  (/home/ibmadmin/quality/v1.0_sdk_tests/node_modules/tape/lib/test.js:64:32) at Test.fail (/home/ibmadmin/quality/v1.0_sdk_tests/node_modules/tape/lib/test.js:277:10) at Test.bound  as fail  (/home/ibmadmin/quality/v1.0_sdk_tests/node_modules/tape/lib/test.js:64:32) at /home/ibmadmin/quality/v1.0_sdk_tests/tests.js:1032:15 at process._tickCallback (internal/process/next_tick.js:109:7) ... info:  invoke-chaincode : Disconnecting the event hub not ok 11 Error: Error: Failed to send transaction and get notifications within the timeout period. at /home/ibmadmin/quality/v1.0_sdk_tests/tests.js:1004:31 at process._tickCallback (internal/process/next_tick.js:109:7) --- operator: error expected: |- undefined actual: |-  Error: Error: Failed to send transaction and get notifications within the timeout period. at /home/ibmadmin/quality/v1.0_sdk_tests/tests.js:1004:31 at process._tickCallback (internal/process/next_tick.js:109:7)  at: Test.onetime (/home/ibmadmin/quality/v1.0_sdk_tests/node_modules/onetime/index.js:22:12) stack: |- Error: Error: Failed to send transaction and get notifications within the timeout period. at /home/ibmadmin/quality/v1.0_sdk_tests/tests.js:1004:31 at process._tickCallback (internal/process/next_tick.js:109:7) at /home/ibmadmin/quality/v1.0_sdk_tests/tests.js:1033:19 at process._tickCallback (internal/process/next_tick.js:109:7) ... 1..11 # tests 11 # pass 7 # fail 4  ></description> </Issue>
