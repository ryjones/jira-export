<Issue id="36169" key="FAB-13286" number="13286" project="10002" reporter="adnanchoudhury" assignee="denyeart" creator="adnanchoudhury" type="10100" summary="Peer crashes while doing invokes and then index-rebuild + invokes + queries - Need to document index update impact on peer" priority="2" status="10000" created="2018-12-14 16:18:35.0" updated="2019-12-02 13:58:42.0" votes="0" watches="2" workflowId="48020"> <description><! CDATA From system test FAB-8251 run in cluster.  Setup:  Network Topology: 2 channels, 2 org, 2 peers per org, each peer with CouchDB container for stateDB, 4 kafka, 3 zookeepers, 3 orderers, 2 ca, TLS enabled, both org associate with all channels. Client Driver: PTE Test Steps: 1) chaincode: each channel has one chancode, marbles02 go chaincode, instantiated 2) 1 million transactions: 4 threads, each thread sends 250000 invokes concurrently with tx id from 1 to 250000  thread 1 sends to org1 peer1 on channel 1 thread 2 sends to org2 peer1 on channel 1 thread 3 sends to org1 peer1 on channel 2 thread 4 sends to org2 peer1 on channel 2 3) do the following 3 concurrently  a) upgrade the chaincode with a new index to force an index rebuild  b) 1 million transactions (like step 2 but with newer keys) c) 2 million rich-queries of 2-field spread among the 4 threads on the 2 channels  Observation: 1) Peer crashes after step 2 is completed and step 3 has started. 3) PTE log indicates failure to reach peer  {code:java}   32minfo^  39m:  PTE 2 main : stdout: ^  32minfo^  39m:  PTE 2 exec :  Nid:chan:org:id=0:testorgschannel1:org2:0 queryValidation  query return: Error: failed to execute transaction 5daa42c33b62f48e876d0d8cac2b94f2aaf3197ad1351394fc392b86099cbfd7: error sending: timeout expired while executing transaction  ^  32minfo^  39m:  PTE 1 main : stdout: ^  32minfo^  39m:  PTE 1 exec :  Nid:chan:org:id=0:testorgschannel2:org2:0 invoke_move_const_evtBlock  proposal failed 9, "9d067a43528440e39ab9d6275ad35c65bf0a93b4956e0c0861f748433558c82f"  {code}   peer log (attached) shows the peer Panics after it is unable to commit. CouchDB containers show CPU usage of near 100% that time.  ></description> </Issue>
