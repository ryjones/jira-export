<Issue id="17802" key="FAB-4588" number="4588" project="10002" reporter="andrasfe" assignee="muralisr" creator="andrasfe" type="10004" summary="Sending instantiateTransaction to orderer hangs" priority="3" resolution="10000" status="6" created="2017-06-12 22:55:27.0" updated="2018-07-20 14:13:18.0" duedate="2017-06-16 00:00:00.0" resolutiondate="2017-06-22 00:07:27.0" votes="0" watches="5" workflowId="38980" security="10001"> <description><! CDATA Running End2endIT.java unit test results in sendTransaction hanging at the time of chain code instantiation. Issue has been observed in both versions 1.0.0-alpha2 and 1.0.0-beta.  *Java logs shown below:*  2017-06-12 22:35:10,465 DEBUG Channel:2083 - Channel foo send proposal to peer peer0.org1.example.com at url grpc://localhost:7051  2017-06-12 22:35:10,466 DEBUG Peer:147 - peer.sendProposalAsync name: peer0.org1.example.com, url: grpc://localhost:7051  2017-06-12 22:35:10,467 DEBUG Channel:2083 - Channel foo send proposal to peer peer1.org1.example.com at url grpc://localhost:7056  2017-06-12 22:35:10,477 DEBUG Peer:147 - peer.sendProposalAsync name: peer1.org1.example.com, url: grpc://localhost:7056  2017-06-12 22:35:11,700 DEBUG Channel:2098 - Channel foo got back from peer peer0.org1.example.com status: 200, message: OK  2017-06-12 22:35:11,709 DEBUG Channel:2098 - Channel foo got back from peer peer1.org1.example.com status: 200, message: OK  Succesful instantiate proposal response Txid: c604a9ebcce27ee03c3f7702fccbb4956b15ed7af48673c4a6e4cd3c3160a615 from peer peer0.org1.example.com  Succesful instantiate proposal response Txid: c604a9ebcce27ee03c3f7702fccbb4956b15ed7af48673c4a6e4cd3c3160a615 from peer peer1.org1.example.com  Received 2 instantiate proposal responses. Successful+verified: 2 . Failed: 0  Sending instantiateTransaction to orderer with a and b set to 100 and 200 respectively  2017-06-12 22:35:11,737 DEBUG Channel:2253 - Channel foo sending transaction to orderer(s) with TxID c604a9ebcce27ee03c3f7702fccbb4956b15ed7af48673c4a6e4cd3c3160a615  2017-06-12 22:35:11,738 DEBUG Orderer:122 - Order.sendTransaction name: orderer.example.com, url: grpc://localhost:7050  2017-06-12 22:35:11,748 DEBUG OrdererClient:107 - resp status value: 200, resp: SUCCESS  2017-06-12 22:35:11,749 DEBUG OrdererClient:147 - Done waiting for reply! Got:status: SUCCESS     2017-06-12 22:35:11,749 DEBUG Channel:2281 - Channel foo successful sent to Orderer transaction id: c604a9ebcce27ee03c3f7702fccbb4956b15ed7af48673c4a6e4cd3c3160a615     *Peer logs:*  *docker logs peer0.org1.example.com:*  2017-06-12 22:35:11.662 UTC  chaincode  Execute -> DEBU 35b chaincode canonical name: example_cc_go:1  2017-06-12 22:35:11.662 UTC  chaincode  sendExecuteMessage -> DEBU 35c  c604a9eb Inside sendExecuteMessage. Message INIT  2017-06-12 22:35:11.662 UTC  chaincode  setChaincodeProposal -> DEBU 35d Setting chaincode proposal context...  2017-06-12 22:35:11.662 UTC  chaincode  setChaincodeProposal -> DEBU 35e Proposal different from nil. Creating chaincode proposal context...  2017-06-12 22:35:11.662 UTC  chaincode  sendExecuteMessage -> DEBU 35f  c604a9eb sendExecuteMsg trigger event INIT  2017-06-12 22:35:11.662 UTC  chaincode  processStream -> DEBU 360  c604a9eb Move state message INIT  2017-06-12 22:35:11.662 UTC  chaincode  HandleMessage -> DEBU 361  c604a9eb Fabric side Handling ChaincodeMessage of type: INIT in state ready  2017-06-12 22:35:11.662 UTC  chaincode  filterError -> DEBU 362 Ignoring NoTransitionError: no transition  2017-06-12 22:35:11.662 UTC  chaincode  processStream -> DEBU 363  c604a9eb sending state message INIT  2017-06-12 22:35:11.669 UTC  chaincode  processStream -> DEBU 364  c604a9eb Received message PUT_STATE from shim  2017-06-12 22:35:11.670 UTC  chaincode  HandleMessage -> DEBU 365  c604a9eb Fabric side Handling ChaincodeMessage of type: PUT_STATE in state ready  2017-06-12 22:35:11.670 UTC  chaincode  filterError -> DEBU 366 Ignoring NoTransitionError: no transition  2017-06-12 22:35:11.670 UTC  chaincode  func1 -> DEBU 367  c604a9eb state is ready  2017-06-12 22:35:11.670 UTC  chaincode  func1 -> DEBU 368  c604a9eb Completed PUT_STATE. Sending RESPONSE  2017-06-12 22:35:11.671 UTC  chaincode  1 -> DEBU 369  c604a9eb enterBusyState trigger event RESPONSE  2017-06-12 22:35:11.671 UTC  chaincode  processStream -> DEBU 36a  c604a9eb Move state message RESPONSE  2017-06-12 22:35:11.671 UTC  chaincode  HandleMessage -> DEBU 36b  c604a9eb Fabric side Handling ChaincodeMessage of type: RESPONSE in state ready  2017-06-12 22:35:11.671 UTC  chaincode  filterError -> DEBU 36c Ignoring NoTransitionError: no transition  2017-06-12 22:35:11.671 UTC  chaincode  processStream -> DEBU 36d  c604a9eb sending state message RESPONSE  2017-06-12 22:35:11.675 UTC  chaincode  processStream -> DEBU 36e  c604a9eb Received message PUT_STATE from shim  2017-06-12 22:35:11.675 UTC  chaincode  HandleMessage -> DEBU 36f  c604a9eb Fabric side Handling ChaincodeMessage of type: PUT_STATE in state ready  2017-06-12 22:35:11.675 UTC  chaincode  filterError -> DEBU 370 Ignoring NoTransitionError: no transition  2017-06-12 22:35:11.676 UTC  chaincode  func1 -> DEBU 371  c604a9eb state is ready  2017-06-12 22:35:11.676 UTC  chaincode  func1 -> DEBU 372  c604a9eb Completed PUT_STATE. Sending RESPONSE  2017-06-12 22:35:11.676 UTC  chaincode  1 -> DEBU 373  c604a9eb enterBusyState trigger event RESPONSE  2017-06-12 22:35:11.677 UTC  chaincode  processStream -> DEBU 374  c604a9eb Move state message RESPONSE  2017-06-12 22:35:11.677 UTC  chaincode  HandleMessage -> DEBU 375  c604a9eb Fabric side Handling ChaincodeMessage of type: RESPONSE in state ready  2017-06-12 22:35:11.677 UTC  chaincode  filterError -> DEBU 376 Ignoring NoTransitionError: no transition  2017-06-12 22:35:11.677 UTC  chaincode  processStream -> DEBU 377  c604a9eb sending state message RESPONSE  2017-06-12 22:35:11.686 UTC  chaincode  processStream -> DEBU 378  c604a9eb Received message COMPLETED from shim  2017-06-12 22:35:11.686 UTC  chaincode  HandleMessage -> DEBU 379  c604a9eb Fabric side Handling ChaincodeMessage of type: COMPLETED in state ready  2017-06-12 22:35:11.687 UTC  chaincode  HandleMessage -> DEBU 37a  c604a9ebcce27ee03c3f7702fccbb4956b15ed7af48673c4a6e4cd3c3160a615 HandleMessage- COMPLETED. Notify  2017-06-12 22:35:11.687 UTC  chaincode  notify -> DEBU 37b notifying Txid:c604a9ebcce27ee03c3f7702fccbb4956b15ed7af48673c4a6e4cd3c3160a615  2017-06-12 22:35:11.687 UTC  chaincode  Execute -> DEBU 37c Exit  2017-06-12 22:35:11.687 UTC  endorser  callChaincode -> DEBU 37d Exit  2017-06-12 22:35:11.687 UTC  lockbasedtxmgr  GetTxSimulationResults -> DEBU 37e Simulation completed, getting simulation results  2017-06-12 22:35:11.688 UTC  lockbasedtxmgr  Done -> DEBU 37f Done with transaction simulation / query execution  0e0d0a37-c692-4c60-9c68-b94ddb092963   2017-06-12 22:35:11.689 UTC  endorser  simulateProposal -> DEBU 380 Exit  2017-06-12 22:35:11.689 UTC  endorser  endorseProposal -> DEBU 381 Entry - txid: c604a9ebcce27ee03c3f7702fccbb4956b15ed7af48673c4a6e4cd3c3160a615 channel id: foo chaincode id: name:"lscc"   2017-06-12 22:35:11.689 UTC  endorser  endorseProposal -> DEBU 382 info: escc for chaincode id name:"lscc"  is escc  2017-06-12 22:35:11.689 UTC  endorser  callChaincode -> DEBU 383 Entry - txid: c604a9ebcce27ee03c3f7702fccbb4956b15ed7af48673c4a6e4cd3c3160a615 channel id: foo version: 1.0.0-beta  2017-06-12 22:35:11.689 UTC  ccprovider  NewCCContext -> DEBU 384 NewCCCC (chain=foo,chaincode=escc,version=1.0.0-beta,txid=c604a9ebcce27ee03c3f7702fccbb4956b15ed7af48673c4a6e4cd3c3160a615,syscc=true,proposal=0xc421afdc20,canname=escc:1.0.0-beta  2017-06-12 22:35:11.689 UTC  chaincode  Launch -> DEBU 385 chaincode is running(no need to launch) : escc:1.0.0-beta  2017-06-12 22:35:11.689 UTC  chaincode  Execute -> DEBU 386 Entry  2017-06-12 22:35:11.689 UTC  chaincode  Execute -> DEBU 387 chaincode canonical name: escc:1.0.0-beta  2017-06-12 22:35:11.690 UTC  chaincode  sendExecuteMessage -> DEBU 388  c604a9eb Inside sendExecuteMessage. Message TRANSACTION  2017-06-12 22:35:11.690 UTC  chaincode  setChaincodeProposal -> DEBU 389 Setting chaincode proposal context...  2017-06-12 22:35:11.690 UTC  chaincode  setChaincodeProposal -> DEBU 38a Proposal different from nil. Creating chaincode proposal context...  2017-06-12 22:35:11.690 UTC  chaincode  sendExecuteMessage -> DEBU 38b  c604a9eb sendExecuteMsg trigger event TRANSACTION  2017-06-12 22:35:11.691 UTC  chaincode  processStream -> DEBU 38c  c604a9eb Move state message TRANSACTION  2017-06-12 22:35:11.691 UTC  chaincode  HandleMessage -> DEBU 38d  c604a9eb Fabric side Handling ChaincodeMessage of type: TRANSACTION in state ready  2017-06-12 22:35:11.691 UTC  chaincode  filterError -> DEBU 38e Ignoring NoTransitionError: no transition  2017-06-12 22:35:11.691 UTC  chaincode  processStream -> DEBU 38f  c604a9eb sending state message TRANSACTION  2017-06-12 22:35:11.691 UTC  shim  func1 -> DEBU 390  c604a9eb Received message TRANSACTION from shim  2017-06-12 22:35:11.691 UTC  shim  handleMessage -> DEBU 391  c604a9eb Handling ChaincodeMessage of type: TRANSACTION(state:ready)  2017-06-12 22:35:11.691 UTC  shim  beforeTransaction -> DEBU 392  c604a9eb Received TRANSACTION, invoking transaction on chaincode(Src:ready, Dst:ready)  2017-06-12 22:35:11.691 UTC  escc  Invoke -> DEBU 393 ESCC starts: 8 args  2017-06-12 22:35:11.694 UTC  escc  Invoke -> DEBU 394 ESCC exits successfully  2017-06-12 22:35:11.694 UTC  shim  func1 -> DEBU 395  c604a9eb Transaction completed. Sending COMPLETED  2017-06-12 22:35:11.694 UTC  shim  func1 -> DEBU 396  c604a9eb Move state message COMPLETED  2017-06-12 22:35:11.694 UTC  shim  handleMessage -> DEBU 397  c604a9eb Handling ChaincodeMessage of type: COMPLETED(state:ready)  2017-06-12 22:35:11.695 UTC  shim  func1 -> DEBU 398  c604a9eb send state message COMPLETED  2017-06-12 22:35:11.695 UTC  chaincode  processStream -> DEBU 399  c604a9eb Received message COMPLETED from shim  2017-06-12 22:35:11.695 UTC  chaincode  HandleMessage -> DEBU 39a  c604a9eb Fabric side Handling ChaincodeMessage of type: COMPLETED in state ready  2017-06-12 22:35:11.695 UTC  chaincode  HandleMessage -> DEBU 39b  c604a9ebcce27ee03c3f7702fccbb4956b15ed7af48673c4a6e4cd3c3160a615 HandleMessage- COMPLETED. Notify  2017-06-12 22:35:11.695 UTC  chaincode  notify -> DEBU 39c notifying Txid:c604a9ebcce27ee03c3f7702fccbb4956b15ed7af48673c4a6e4cd3c3160a615  2017-06-12 22:35:11.696 UTC  chaincode  Execute -> DEBU 39d Exit  2017-06-12 22:35:11.696 UTC  endorser  callChaincode -> DEBU 39e Exit  2017-06-12 22:35:11.697 UTC  endorser  endorseProposal -> DEBU 39f Exit  2017-06-12 22:35:11.697 UTC  lockbasedtxmgr  Done -> DEBU 3a0 Done with transaction simulation / query execution  0e0d0a37-c692-4c60-9c68-b94ddb092963   2017-06-12 22:35:11.697 UTC  endorser  ProcessProposal -> DEBU 3a1 Exit  2017-06-12 22:35:15.882 UTC  deliveryClient  StartDeliverForChannel -> DEBU 3a2 This peer will pass blocks from orderer service to other peers for channel foo  2017-06-12 22:35:18.883 UTC  ConnProducer  NewConnection -> ERRO 3a3 Failed connecting to orderer.example.com:7050 , error: context deadline exceeded  2017-06-12 22:35:18.883 UTC  deliveryClient  connect -> ERRO 3a4 Failed obtaining connection: Could not connect to any of the endpoints:  orderer.example.com:7050   2017-06-12 22:35:22.885 UTC  ConnProducer  NewConnection -> ERRO 3a5 Failed connecting to orderer.example.com:7050 , error: context deadline exceeded  2017-06-12 22:35:22.885 UTC  deliveryClient  connect -> ERRO 3a6 Failed obtaining connection: Could not connect to any of the endpoints:  orderer.example.com:7050   2017-06-12 22:35:27.887 UTC  ConnProducer  NewConnection -> ERRO 3a7 Failed connecting to orderer.example.com:7050 , error: context deadline exceeded  2017-06-12 22:35:27.887 UTC  deliveryClient  connect -> ERRO 3a8 Failed obtaining connection: Could not connect to any of the endpoints:  orderer.example.com:7050   2017-06-12 22:35:34.892 UTC  ConnProducer  NewConnection -> ERRO 3a9 Failed connecting to orderer.example.com:7050 , error: context deadline exceeded  2017-06-12 22:35:34.892 UTC  deliveryClient  connect -> ERRO 3aa Failed obtaining connection: Could not connect to any of the endpoints:  orderer.example.com:7050   2017-06-12 22:35:46.021 UTC  ConnProducer  NewConnection -> ERRO 3ab Failed connecting to orderer.example.com:7050 , error: context deadline exceeded  2017-06-12 22:35:46.022 UTC  deliveryClient  connect -> ERRO 3ac Failed obtaining connection: Could not connect to any of the endpoints:  orderer.example.com:7050   2017-06-12 22:36:05.023 UTC  ConnProducer  NewConnection -> ERRO 3ad Failed connecting to orderer.example.com:7050 , error: context deadline exceeded  2017-06-12 22:36:05.024 UTC  deliveryClient  connect -> ERRO 3ae Failed obtaining connection: Could not connect to any of the endpoints:  orderer.example.com:7050   2017-06-12 22:36:40.026 UTC  ConnProducer  NewConnection -> ERRO 3af Failed connecting to orderer.example.com:7050 , error: context deadline exceeded  2017-06-12 22:36:40.026 UTC  deliveryClient  connect -> ERRO 3b0 Failed obtaining connection: Could not connect to any of the endpoints:  orderer.example.com:7050   2017-06-12 22:37:47.027 UTC  ConnProducer  NewConnection -> ERRO 3b1 Failed connecting to orderer.example.com:7050 , error: context deadline exceeded  2017-06-12 22:37:47.028 UTC  deliveryClient  connect -> ERRO 3b2 Failed obtaining connection: Could not connect to any of the endpoints:  orderer.example.com:7050   2017-06-12 22:39:58.029 UTC  ConnProducer  NewConnection -> ERRO 3b3 Failed connecting to orderer.example.com:7050 , error: context deadline exceeded  2017-06-12 22:39:58.029 UTC  deliveryClient  connect -> ERRO 3b4 Failed obtaining connection: Could not connect to any of the endpoints:  orderer.example.com:7050   2017-06-12 22:44:17.030 UTC  ConnProducer  NewConnection -> ERRO 3b5 Failed connecting to orderer.example.com:7050 , error: context deadline exceeded  2017-06-12 22:44:17.030 UTC  deliveryClient  connect -> ERRO 3b6 Failed obtaining connection: Could not connect to any of the endpoints:  orderer.example.com:7050   2017-06-12 22:44:17.030 UTC  blocksProvider  DeliverBlocks -> WARN 3b7  foo  Receive error: Attempts (10) or elapsed time (9m1.14813744s) exhausted  *Orderer logs:*  *docker logs orderer.example.com*  2017-06-12 22:35:11.759 UTC  cauthdsl  func2 -> DEBU 818 Principal evaluation succeeds: (&\{0}) (used  false )  2017-06-12 22:35:11.759 UTC  cauthdsl  func1 -> DEBU 819 Gate evaluation succeeds: (&\{n:1 rules:<signed_by:0 > })  2017-06-12 22:35:11.759 UTC  orderer/common/sigfilter  Apply -> DEBU 81a Forwarding validly signed message for policy &\{%!s(*common.ImplicitMetaPolicy=&\{Writers 0}) %!s(int=1)  %!s(*policies.implicitMetaPolicy=&\{0xc420aa2160 1  0xc420024bb0 0xc420024c48 }) %!s(*policies.implicitMetaPolicy=&\{0xc4207b1aa0 1  0xc420024b08 }) }  2017-06-12 22:35:11.760 UTC  orderer/common/blockcutter  Ordered -> DEBU 81b Enqueuing message into batch  2017-06-12 22:35:13.760 UTC  orderer/solo  main -> DEBU 81c Batch timer expired, creating block  2017-06-12 22:35:13.760 UTC  fsblkstorage  retrieveBlockByNumber -> DEBU 81d retrieveBlockByNumber() - blockNum =  0   2017-06-12 22:35:13.760 UTC  fsblkstorage  newBlockfileStream -> DEBU 81e newBlockfileStream(): filePath= /var/hyperledger/production/orderer/chains/foo/blockfile_000000 , startOffset= 0   2017-06-12 22:35:13.761 UTC  fsblkstorage  nextBlockBytesAndPlacementInfo -> DEBU 81f Remaining bytes= 9674 , Going to peek  8  bytes  2017-06-12 22:35:13.761 UTC  fsblkstorage  nextBlockBytesAndPlacementInfo -> DEBU 820 Returning blockbytes - length= 9672 , placementInfo=\{fileNum= 0 , startOffset= 0 , bytesOffset= 2 }  2017-06-12 22:35:13.762 UTC  orderer/multichain  addBlockSignature -> DEBU 821 &\{ledgerResources:0xc42033a140 chain:0xc42031d530 cutter:0xc4202e4780 filters:0xc42033a660 signer:0x1261e08 lastConfig:0 lastConfigSeq:1}  2017-06-12 22:35:13.762 UTC  orderer/multichain  addBlockSignature -> DEBU 822 &\{}  2017-06-12 22:35:13.762 UTC  msp  GetLocalMSP -> DEBU 823 Returning existing local MSP  2017-06-12 22:35:13.762 UTC  msp  GetDefaultSigningIdentity -> DEBU 824 Obtaining default signing identity  2017-06-12 22:35:13.763 UTC  msp  GetLocalMSP -> DEBU 825 Returning existing local MSP  2017-06-12 22:35:13.763 UTC  msp  GetDefaultSigningIdentity -> DEBU 826 Obtaining default signing identity  2017-06-12 22:35:13.763 UTC  msp/identity  Sign -> DEBU 827 Sign: plaintext: 0AD4060A0A4F7264657265724D535012...26E0F43D0CD16973BDF27E3683998226   2017-06-12 22:35:13.763 UTC  msp/identity  Sign -> DEBU 828 Sign: digest: 736AE0BA0E1A8E9F2115F4D869564A9364E05B25F6E88B3F2AC2EC7A441F8338   2017-06-12 22:35:13.764 UTC  msp  GetLocalMSP -> DEBU 829 Returning existing local MSP  2017-06-12 22:35:13.764 UTC  msp  GetDefaultSigningIdentity -> DEBU 82a Obtaining default signing identity  2017-06-12 22:35:13.764 UTC  orderer/multichain  addLastConfigSignature -> DEBU 82b  channel: foo  About to write block, setting its LAST_CONFIG to 0  2017-06-12 22:35:13.764 UTC  msp  GetLocalMSP -> DEBU 82c Returning existing local MSP  2017-06-12 22:35:13.764 UTC  msp  GetDefaultSigningIdentity -> DEBU 82d Obtaining default signing identity  2017-06-12 22:35:13.764 UTC  msp/identity  Sign -> DEBU 82e Sign: plaintext: 0AD4060A0A4F7264657265724D535012...26E0F43D0CD16973BDF27E3683998226   2017-06-12 22:35:13.764 UTC  msp/identity  Sign -> DEBU 82f Sign: digest: 8CE6F3E9629784CFE67D1F2B55BCEFFB95560837D68E53692E5B43050CC770B4   2017-06-12 22:35:13.778 UTC  fsblkstorage  indexBlock -> DEBU 830 Indexing block  blockNum=1, blockHash=  byte\{0xd3, 0xa, 0xde, 0xc1, 0xe, 0x52, 0xc3, 0xa2, 0xc4, 0xab, 0x4b, 0x6e, 0xca, 0x83, 0x31, 0xd7, 0xf, 0x3b, 0x92, 0x15, 0x76, 0x3a, 0xc9, 0x21, 0x60, 0x32, 0xc7, 0xbd, 0x1f, 0x64, 0x84, 0xc1} txOffsets=  txId=c604a9ebcce27ee03c3f7702fccbb4956b15ed7af48673c4a6e4cd3c3160a615 locPointer=offset=70, bytesLength=4709     2017-06-12 22:35:13.778 UTC  fsblkstorage  updateCheckpoint -> DEBU 831 Broadcasting about update checkpointInfo: latestFileChunkSuffixNum= 0 , latestFileChunksize= 16379 , isChainEmpty= false , lastBlockNumber= 1   2017-06-12 22:35:13.778 UTC  orderer/multichain  WriteBlock -> DEBU 832  channel: foo  Wrote block 1     ></description> </Issue>
