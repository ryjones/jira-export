<Issue id="43836" key="FAB-17309" number="17309" project="10002" reporter="sykesm" assignee="sykesm" creator="sykesm" type="10004" summary="CFT integration tests fail with &quot;resource temporarily available&quot; panic" priority="3" resolution="10000" status="6" created="2020-01-07 19:10:46.0" updated="2020-01-08 15:46:17.0" resolutiondate="2020-01-08 15:46:17.0" votes="0" watches="1" workflowId="57691"> <description><! CDATA This failure: {code} â€¢ Failure  62.124 seconds  EndToEnd Crash Fault Tolerance /Users/sykesm/workspace/fabric/src/github.com/hyperledger/fabric/integration/raft/cft_test.go:43 when orderer TLS certificates expire /Users/sykesm/workspace/fabric/src/github.com/hyperledger/fabric/integration/raft/cft_test.go:343 is still possible to recover  It  /Users/sykesm/workspace/fabric/src/github.com/hyperledger/fabric/integration/raft/cft_test.go:344  Timed out after 60.001s. Expected <<-chan struct {} | len:0, cap:0>: 0xc001bea420 to be closed  /Users/sykesm/workspace/fabric/src/github.com/hyperledger/fabric/integration/raft/cft_test.go:434 {code}  happens when the orderer panics: {code}  e  OrdererOrg.orderer1  2020-01-07 13:32:59.912 EST  orderer.common.server  initializeServerConfig -> INFO 00f Starting orderer with TLS enabled  e  OrdererOrg.orderer1  panic: Error opening leveldb: resource temporarily unavailable  e  OrdererOrg.orderer1    e  OrdererOrg.orderer1  goroutine 1  running :  e  OrdererOrg.orderer1  github.com/hyperledger/fabric/common/ledger/util/leveldbhelper.(*DB).Open(0xc000178e10)  e  OrdererOrg.orderer1  	/Users/sykesm/workspace/fabric/src/github.com/hyperledger/fabric/common/ledger/util/leveldbhelper/leveldb_helper.go:75 +0x285  e  OrdererOrg.orderer1  github.com/hyperledger/fabric/common/ledger/util/leveldbhelper.openDBAndCheckFormat(0xc000361580, 0x0, 0x0, 0x0)  e  OrdererOrg.orderer1  	/Users/sykesm/workspace/fabric/src/github.com/hyperledger/fabric/common/ledger/util/leveldbhelper/leveldb_provider.go:63 +0x11b  e  OrdererOrg.orderer1  github.com/hyperledger/fabric/common/ledger/util/leveldbhelper.NewProvider(0xc000361580, 0xc000361580, 0x4, 0xc00014c700)  e  OrdererOrg.orderer1  	/Users/sykesm/workspace/fabric/src/github.com/hyperledger/fabric/common/ledger/util/leveldbhelper/leveldb_provider.go:51 +0x2f  e  OrdererOrg.orderer1  github.com/hyperledger/fabric/common/ledger/blkstorage/fsblkstorage.NewProvider(0xc000361540, 0xc000361560, 0x4df0e80, 0x55ed2e0, 0xc00014c690, 0x6d, 0x0, 0x0)  e  OrdererOrg.orderer1  	/Users/sykesm/workspace/fabric/src/github.com/hyperledger/fabric/common/ledger/blkstorage/fsblkstorage/fs_blockstore_provider.go:43 +0x158  e  OrdererOrg.orderer1  github.com/hyperledger/fabric/common/ledger/blockledger/fileledger.New(0xc00014ca80, 0x61, 0x4df0e80, 0x55ed2e0, 0x8c00008, 0x0, 0xc000429630, 0x400f158)  e  OrdererOrg.orderer1  	/Users/sykesm/workspace/fabric/src/github.com/hyperledger/fabric/common/ledger/blockledger/fileledger/factory.go:71 +0x107  e  OrdererOrg.orderer1  github.com/hyperledger/fabric/orderer/common/server.createLedgerFactory(0xc0002f7200, 0x4df0e80, 0x55ed2e0, 0xc000014700, 0x45b, 0x65b, 0xc000018300, 0xf1, 0x2f1)  e  OrdererOrg.orderer1  	/Users/sykesm/workspace/fabric/src/github.com/hyperledger/fabric/orderer/common/server/util.go:29 +0xf8  e  OrdererOrg.orderer1  github.com/hyperledger/fabric/orderer/common/server.Main()  e  OrdererOrg.orderer1  	/Users/sykesm/workspace/fabric/src/github.com/hyperledger/fabric/orderer/common/server/main.go:113 +0x664  e  OrdererOrg.orderer1  main.main()  e  OrdererOrg.orderer1  	/Users/sykesm/workspace/fabric/src/github.com/hyperledger/fabric/cmd/orderer/main.go:15 +0x20  d  OrdererOrg.orderer2  spawned /var/folders/tw/dsbwtnf50w7dhvhh0tkg7fwr0000gn/T/gexec_artifacts750850912/g028006345/orderer (pid: 15850) {code}  and that seems to be caused by a restart of the orderer before the previous process completely terminated. {code}  e  OrdererOrg.orderer2  2020-01-07 13:32:59.815 EST  core.comm  ServerHandshake -> ERRO 02d TLS handshake failed with error remote error: tls: bad certificate server=Orderer remoteaddress=127.0.0.1:61409  e  OrdererOrg.orderer3  2020-01-07 13:32:59.815 EST  core.comm  ServerHandshake -> ERRO 02b TLS handshake failed with error remote error: tls: bad certificate server=Orderer remoteaddress=127.0.0.1:61410 STEP: Killing orderers STEP: Launching orderers again  e  OrdererOrg.orderer1  2020-01-07 13:32:59.825 EST  orderer.common.server  handleSignals -> INFO 02d Received signal: 15 (terminated)  e  OrdererOrg.orderer2  2020-01-07 13:32:59.825 EST  orderer.common.server  handleSignals -> INFO 02e Received signal: 15 (terminated) {code}  After we terminate the orderers, we should wait for the termination to complete.  ></description> </Issue>
