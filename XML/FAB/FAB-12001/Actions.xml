<Action id="50947" issue="33756" author="ratnakar" type="comment" created="2018-09-21 14:04:57.0" updateauthor="ratnakar" updated="2018-09-21 14:04:57.0"> <body><! CDATA ||Integration Test Suite||Node.js SDK||Fabric (peer/orderer)||Fabric-CA||logs||Result|| |1.2|1.2.2|1.2|*1.3*|  ^case1.txt  |*2 tests failed* with a similar root cause| |1.2|1.2.2|*1.3*|1.2|  ^case2.txt  |*14+ tests failed* most of them are Evenhub related| |1.2|1.2.2|*1.3*|*1.3*|  ^case3.txt  |*16+ tests failed* same reasons as above two cases combined| |1.2|*1.3*|*1.3*|*1.3*|  ^case4.txt  |tests are failed with exit code 1|  Please note that *1.3* referred in the above is *_amd64-1.3.0-snapshot-<commit>_* More details to follow   ></body> </Action>
<Action id="50950" issue="33756" author="ratnakar" type="comment" created="2018-09-21 14:31:28.0" updateauthor="ratnakar" updated="2018-09-24 13:51:35.0"> <body><! CDATA *Case 1*:  Tests are failing due to the error message (*Authorization failure*) change in Fabric CA   {code:java} not ok 828 Got expected error to enroll user using a caName in another org. Error: Enrollment failed with errors   \{"code":20,"message":"Authentication failure"}   {code}    *Case 2:*   Most of the tests are failing due to eventhub EvenHub support has been removed in Fabric *V1.3* which causes most of the failures {code:java} not ok 736 Failed transaction ::undefined not ok 737 Error: Failed transaction ::undefined at Promise.all.then.catch (/Users/ratnakar/workspace/go/src/github.com/hyperledger/fabric-sdk-node/test/integration/invoke.js:293:11) at <anonymous> not ok 738 Failed to invoke transaction chaincode not ok 749 Failed transaction ::undefined not ok 750 Error: Failed transaction ::undefined at Promise.all.then.catch (/Users/ratnakar/workspace/go/src/github.com/hyperledger/fabric-sdk-node/test/integration/invoke.js:293:11) at <anonymous> not ok 845 Test failed with TypeError: Cannot read property 'registerBlockEvent' of null not ok 846 transaction proposal was bad not ok 847 transaction proposal was bad not ok 848 Failed to send invoke Proposal or receive valid response. Response null or status is not 200. exiting... not ok 849 Test failed with Error: Failed to send invoke Proposal or receive valid response. Response null or status is not 200. exiting... not ok 851 Test failed with Error: 2 UNKNOWN: access denied: channel  adminconfig  creator org  Org1MSP  not ok 853 Failed to find our channel in the result list not ok 867 TypeError: Cannot read property 'name' of undefined {code}    *Case 3:*   The errors are due to the upgrade of images in both *Fabric* and *Fabric-ca* (case 1 + case 2) {code:java} not ok 533 Expecting a rejected promise from the 2nd transaction should be invalid not ok 736 Failed transaction ::undefined not ok 737 Error: Failed transaction ::undefined at Promise.all.then.catch (/Users/ratnakar/workspace/go/src/github.com/hyperledger/fabric-sdk-node/test/integration/invoke.js:293:11) at <anonymous> not ok 738 Failed to invoke transaction chaincode not ok 749 Failed transaction ::undefined not ok 750 Error: Failed transaction ::undefined at Promise.all.then.catch (/Users/ratnakar/workspace/go/src/github.com/hyperledger/fabric-sdk-node/test/integration/invoke.js:293:11) at <anonymous> not ok 827 Got expected error to enroll user using a caName in another org. Error: Enrollment failed with errors   {"code":20,"message":"Authentication failure"}   not ok 845 Test failed with TypeError: Cannot read property 'registerBlockEvent' of null not ok 846 transaction proposal was bad not ok 847 transaction proposal was bad not ok 848 Failed to send invoke Proposal or receive valid response. Response null or status is not 200. exiting... not ok 849 Test failed with Error: Failed to send invoke Proposal or receive valid response. Response null or status is not 200. exiting... not ok 851 Test failed with Error: 2 UNKNOWN: access denied: channel  adminconfig  creator org  Org1MSP  not ok 853 Failed to find our channel in the result list not ok 867 TypeError: Cannot read property 'name' of undefined {code}    *Case 4:* Unable to execute the tests when upgraded SDK to latest along with Fabric and Fabric CA. {code:java} test/typescript/test.ts(42,2): error TS2305: Module '"/Users/ratnakar/workspace/go/src/github.com/hyperledger/fabric-sdk-node/node_modules/fabric-client/types/index"' has no exported member 'EventHub'. test/typescript/test.ts(392,5): error TS2322: Type '{ proposalResponses: ProposalResponse  ; proposal: Proposal; admin: boolean; }' is not assignable to type 'TransactionRequest'. Object literal may only specify known properties, and 'admin' does not exist in type 'TransactionRequest'.  19:09:45  gulp-debug: fabric-client/lib/User.js  19:09:45  'compile' errored after 5.32 s  19:09:45  ^  31mError^  39m in plugin "^  36mgulp-shell^  39m" Message: Command `npm run compile` failed with exit code 2  .... .....   19:09:50  'test' errored after 13 s  19:09:50  ^  31mError^  39m in plugin "^  36mgulp-shell^  39m" Message: Command `./node_modules/nyc/bin/nyc.js gulp run-test` failed with exit code 1 {code}   The error seems to be coming from *TypeScript* than the Javascript.   After deleteing the file *test/typescript/test.ts* , I could run the tests and I see the following failures and most of these failures are due to the Evenhub/CA return message etc.,  {code} not ok 481 TypeError: FabricCAClient is not a constructor not ok 523 Expecting a rejected promise from the 2nd transaction should be invalid not ok 724 Failed to enroll user 'admin'. TypeError: client.newEventHub is not a function not ok 725 Error: Failed to enroll user 'admin'. TypeError: client.newEventHub is not a function at e2eUtils.tlsEnroll.then.then.then (/Users/ratnakar/workspace/go/src/github.com/hyperledger/fabric-sdk-node/test/integration/invoke.js:199:9) at <anonymous> not ok 726 Error: Error: Failed to enroll user 'admin'. TypeError: client.newEventHub is not a function at e2eUtils.tlsEnroll.then.then.then (/Users/ratnakar/workspace/go/src/github.com/hyperledger/fabric-sdk-node/test/integration/invoke.js:199:9) at <anonymous> at e2eUtils.tlsEnroll.then.then.then.then (/Users/ratnakar/workspace/go/src/github.com/hyperledger/fabric-sdk-node/test/integration/invoke.js:301:9) at <anonymous> not ok 727 Failed to invoke transaction chaincode not ok 731 Failed to enroll user 'admin'. TypeError: client.newEventHub is not a function not ok 732 Error: Failed to enroll user 'admin'. TypeError: client.newEventHub is not a function at e2eUtils.tlsEnroll.then.then.then (/Users/ratnakar/workspace/go/src/github.com/hyperledger/fabric-sdk-node/test/integration/invoke.js:199:9) at <anonymous> not ok 733 Error: Error: Failed to enroll user 'admin'. TypeError: client.newEventHub is not a function at e2eUtils.tlsEnroll.then.then.then (/Users/ratnakar/workspace/go/src/github.com/hyperledger/fabric-sdk-node/test/integration/invoke.js:199:9) at <anonymous> at e2eUtils.tlsEnroll.then.then.then.then (/Users/ratnakar/workspace/go/src/github.com/hyperledger/fabric-sdk-node/test/integration/invoke.js:301:9) at <anonymous> not ok 801 Got unexpected error when testing setUserContext with caName. Error: user.getName is not a function not ok 807 Got expected error to enroll user using a caName in another org. Error: Enrollment failed with errors   {"code":20,"message":"Authentication failure"}   not ok 825 Test failed with TypeError: client.getEventHub is not a function not ok 826 transaction proposal was bad not ok 827 transaction proposal was bad not ok 828 Failed to send invoke Proposal or receive valid response. Response null or status is not 200. exiting... not ok 829 Test failed with Error: Failed to send invoke Proposal or receive valid response. Response null or status is not 200. exiting... not ok 831 Test failed with Error: 2 UNKNOWN: access denied: channel  adminconfig  creator org  Org1MSP  not ok 833 Failed to find our channel in the result list not ok 847 Error: 2 UNKNOWN: access denied: channel  adminconfig  creator org  Org1MSP  {code}  ></body> </Action>
<Action id="51093" issue="33756" author="ratnakar" type="comment" body=" ~harrisob@us.ibm.com   I see root cause for almost all the failures are due to the Evenhub deprication in *Fabric 1.3*. Could you please take a look at the above analysis and provide your comments if any." created="2018-09-24 13:43:43.0" updateauthor="ratnakar" updated="2018-09-24 13:43:43.0"/>
