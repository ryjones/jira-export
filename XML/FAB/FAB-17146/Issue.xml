<Issue id="43460" key="FAB-17146" number="17146" project="10002" reporter="sykesm" assignee="baidang201" creator="sykesm" type="10004" summary="Validation tests do not clean up their temporary directories" priority="3" resolution="10000" status="6" created="2019-11-26 15:40:47.0" updated="2019-12-02 03:29:47.0" resolutiondate="2019-12-02 03:29:47.0" votes="0" watches="2" workflowId="56574"> <description><! CDATA My tmpfs filled up today. When I looked, I saw hundreds of directories like this: {code} drwx------   2 sykesm sykesm  4096 Nov 19 11:16 v1.3-validation610594591 drwx------   2 sykesm sykesm  4096 Jun 19 18:10 v1.3-validation619593636 drwx------   2 sykesm sykesm  4096 Nov 12 14:19 v1.3-validation639568270 drwx------   2 sykesm sykesm  4096 Oct 28 19:25 v1.3-validation663285767 drwx------   2 sykesm sykesm  4096 Nov  5 19:57 v1.3-validation718410289 drwx------   2 sykesm sykesm  4096 Nov 12 14:19 v1.3-validation767029207 drwx------   2 sykesm sykesm  4096 Nov 21 12:01 v1.3-validation781949214 drwx------   2 sykesm sykesm  4096 Jul 16 15:03 v1.3-validation798632841 drwx------   2 sykesm sykesm  4096 Jun 11 18:01 v1.3-validation807957324 drwx------   2 sykesm sykesm  4096 Jul 16 15:03 v1.3-validation814011149 drwx------   2 sykesm sykesm  4096 Sep 11 13:15 v1.3-validation846409913 {code}  This is due to the following code in TestMain: {code} func TestMain(m *testing.M) { 	testDir, err := ioutil.TempDir("", "v1.3-validation") 	if err != nil { 		fmt.Printf("Could not create temp dir: %s", err) 		os.Exit(-1) 	} 	defer os.RemoveAll(testDir) {code}  A defer from TestMain will never execute.  And, with most things validation, the code was duplicated.  {code} workspace/fabric/src/github.com/hyperledger/fabric/core/handlers/validation/builtin/v20/validation_logic_test.go workspace/fabric/src/github.com/hyperledger/fabric/core/handlers/validation/builtin/v13/validation_logic_test.go {code}  ></description> </Issue>
