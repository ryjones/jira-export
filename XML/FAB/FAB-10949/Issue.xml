<Issue id="31497" key="FAB-10949" number="10949" project="10002" reporter="sykesm" assignee="sykesm" creator="sykesm" type="10003" summary="data race when running TestResubmission" priority="4" resolution="10000" status="6" created="2018-06-29 16:45:59.0" updated="2018-07-20 14:17:05.0" resolutiondate="2018-07-02 12:29:51.0" votes="0" watches="1" workflowId="42573"> <description><! CDATA {code:java} --- FAIL: TestResubmission (9.34s)     --- FAIL: TestResubmission/Normal (4.01s)         --- FAIL: TestResubmission/Normal/ValidResubmit (1.00s)         testing.go:730: race detected during execution of test     testing.go:730: race detected during execution of test testing.go:730: race detected during execution of test{code} {code:java} ================== WARNING: DATA RACE Read at 0x00c42038ae80 by goroutine 143:   github.com/hyperledger/fabric/protos/orderer._KafkaMessage_OneofMarshaler()       /Users/sykesm/workspace/fabric/src/github.com/hyperledger/fabric/protos/orderer/kafka.pb.go:110 +0x68   github.com/hyperledger/fabric/vendor/github.com/golang/protobuf/proto.(*Buffer).enc_struct()       /Users/sykesm/workspace/fabric/src/github.com/hyperledger/fabric/vendor/github.com/golang/protobuf/proto/encode.go:1257 +0xa6a   github.com/hyperledger/fabric/vendor/github.com/golang/protobuf/proto.(*Buffer).Marshal()       /Users/sykesm/workspace/fabric/src/github.com/hyperledger/fabric/vendor/github.com/golang/protobuf/proto/encode.go:274 +0x38d   github.com/hyperledger/fabric/vendor/github.com/golang/protobuf/proto.Marshal()       /Users/sykesm/workspace/fabric/src/github.com/hyperledger/fabric/vendor/github.com/golang/protobuf/proto/encode.go:236 +0x12d   github.com/hyperledger/fabric/protos/utils.MarshalOrPanic()       /Users/sykesm/workspace/fabric/src/github.com/hyperledger/fabric/protos/utils/commonutils.go:33 +0x46   github.com/hyperledger/fabric/orderer/consensus/kafka.newMockConsumerMessage()       /Users/sykesm/workspace/fabric/src/github.com/hyperledger/fabric/orderer/consensus/kafka/consenter_test.go:129 +0x48   github.com/hyperledger/fabric/orderer/consensus/kafka.TestResubmission.func3.4()       /Users/sykesm/workspace/fabric/src/github.com/hyperledger/fabric/orderer/consensus/kafka/chain_test.go:2540 +0x102e   testing.tRunner()       /usr/local/Cellar/go/1.10.3/libexec/src/testing/testing.go:777 +0x16d  Previous write at 0x00c42038ae80 by goroutine 53:   github.com/hyperledger/fabric/protos/orderer._KafkaMessage_OneofUnmarshaler()       /Users/sykesm/workspace/fabric/src/github.com/hyperledger/fabric/protos/orderer/kafka.pb.go:142 +0x120   github.com/hyperledger/fabric/vendor/github.com/golang/protobuf/proto.(*Buffer).unmarshalType()       /Users/sykesm/workspace/fabric/src/github.com/hyperledger/fabric/vendor/github.com/golang/protobuf/proto/decode.go:508 +0xc6e   github.com/hyperledger/fabric/vendor/github.com/golang/protobuf/proto.(*Buffer).Unmarshal()       /Users/sykesm/workspace/fabric/src/github.com/hyperledger/fabric/vendor/github.com/golang/protobuf/proto/decode.go:452 +0x2c9   github.com/hyperledger/fabric/vendor/github.com/golang/protobuf/proto.UnmarshalMerge()       /Users/sykesm/workspace/fabric/src/github.com/hyperledger/fabric/vendor/github.com/golang/protobuf/proto/decode.go:412 +0x118   github.com/hyperledger/fabric/vendor/github.com/golang/protobuf/proto.Unmarshal()       /Users/sykesm/workspace/fabric/src/github.com/hyperledger/fabric/vendor/github.com/golang/protobuf/proto/decode.go:398 +0x78   github.com/hyperledger/fabric/orderer/consensus/kafka.TestResubmission.func3.4.1()       /Users/sykesm/workspace/fabric/src/github.com/hyperledger/fabric/orderer/consensus/kafka/chain_test.go:2470 +0x9d   github.com/hyperledger/fabric/vendor/github.com/Shopify/sarama/mocks.(*SyncProducer).SendMessage()       /Users/sykesm/workspace/fabric/src/github.com/hyperledger/fabric/vendor/github.com/Shopify/sarama/mocks/sync_producer.go:55 +0x5be   github.com/hyperledger/fabric/orderer/consensus/kafka.(*chainImpl).enqueue()       /Users/sykesm/workspace/fabric/src/github.com/hyperledger/fabric/orderer/consensus/kafka/chain.go:241 +0x61f   github.com/hyperledger/fabric/orderer/consensus/kafka.(*chainImpl).order()       /Users/sykesm/workspace/fabric/src/github.com/hyperledger/fabric/orderer/consensus/kafka/chain.go:203 +0x2c5   github.com/hyperledger/fabric/orderer/consensus/kafka.(*chainImpl).processRegular()       /Users/sykesm/workspace/fabric/src/github.com/hyperledger/fabric/orderer/consensus/kafka/chain.go:754 +0x2446   github.com/hyperledger/fabric/orderer/consensus/kafka.(*chainImpl).processMessagesToBlocks()       /Users/sykesm/workspace/fabric/src/github.com/hyperledger/fabric/orderer/consensus/kafka/chain.go:433 +0x123c   github.com/hyperledger/fabric/orderer/consensus/kafka.TestResubmission.func3.4.2()       /Users/sykesm/workspace/fabric/src/github.com/hyperledger/fabric/orderer/consensus/kafka/chain_test.go:2510 +0x3c  Goroutine 143 (running) created at:   testing.(*T).Run()       /usr/local/Cellar/go/1.10.3/libexec/src/testing/testing.go:824 +0x564   github.com/hyperledger/fabric/orderer/consensus/kafka.TestResubmission.func3()       /Users/sykesm/workspace/fabric/src/github.com/hyperledger/fabric/orderer/consensus/kafka/chain_test.go:2436 +0x63c   testing.tRunner()       /usr/local/Cellar/go/1.10.3/libexec/src/testing/testing.go:777 +0x16d  Goroutine 53 (running) created at:   github.com/hyperledger/fabric/orderer/consensus/kafka.TestResubmission.func3.4()       /Users/sykesm/workspace/fabric/src/github.com/hyperledger/fabric/orderer/consensus/kafka/chain_test.go:2509 +0xc1d   testing.tRunner()       /usr/local/Cellar/go/1.10.3/libexec/src/testing/testing.go:777 +0x16d =================={code}    ></description> </Issue>
