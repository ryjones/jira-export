<Issue id="26649" key="FAB-7641" number="7641" project="10002" reporter="bstasyszyn" assignee="yacovm" creator="bstasyszyn" type="10004" summary="Peer panics when pulling private data" priority="2" resolution="10000" status="6" created="2018-01-07 17:54:54.0" updated="2018-07-20 14:15:22.0" resolutiondate="2018-01-08 15:08:48.0" votes="0" watches="3" workflowId="40907"> <description><! CDATA I'm testing in a configuration composed of 4 MSPs, 1 peer per MSP for a total of 4 peers, and 2 (Kafka) orderers. Two chaincodes make use of private data:  CC#1 - contains 3 private data collections (fmpconfig,fmpstatus,fmpmsg), each with the following config: - RequiredPeerCount=1 - MaximumPeerCount=2 - Policy includes all 4 MSPs   CC#2 - contains 1 private data collection (quotes), with the following config: - RequiredPeerCount=3 - MaximumPeerCount=5 - Policy includes all 4 MSPs  I'm sending 20 concurrent requests which write/read private data. Every time I run my test I see at least one peer panic:  peer0.org2.com    | 2018-01-06 22:39:05.634 UTC  gossip/privdata  func1 -> DEBU 2e78 Returning 172.18.0.13:44692 0 elements peer0.org2.com    | panic: runtime error: invalid memory address or nil pointer dereference peer0.org2.com    |  signal SIGSEGV: segmentation violation code=0x1 addr=0x8 pc=0x10cf332  peer0.org2.com    |  peer0.org2.com    | goroutine 352  running : peer0.org2.com    | github.com/hyperledger/fabric/gossip/privdata.(*dataRetriever).CollectionRWSet(0xc4228dc1e0, 0xc422b0ab00, 0x0, 0x0, 0x0) peer0.org2.com    | 	/opt/gopath/src/github.com/hyperledger/fabric/gossip/privdata/dataretriever.go:93 +0xfa2 peer0.org2.com    | github.com/hyperledger/fabric/gossip/privdata.(*puller).createResponse(0xc4228ad620, 0x1afbd40, 0xc4227482d0, 0x0, 0x0, 0x0) peer0.org2.com    | 	/opt/gopath/src/github.com/hyperledger/fabric/gossip/privdata/pull.go:162 +0x739 peer0.org2.com    | github.com/hyperledger/fabric/gossip/privdata.(*puller).handleRequest(0xc4228ad620, 0x1afbd40, 0xc4227482d0) peer0.org2.com    | 	/opt/gopath/src/github.com/hyperledger/fabric/gossip/privdata/pull.go:122 +0x20b peer0.org2.com    | github.com/hyperledger/fabric/gossip/privdata.(*puller).listen(0xc4228ad620) peer0.org2.com    | 	/opt/gopath/src/github.com/hyperledger/fabric/gossip/privdata/pull.go:108 +0x1dc peer0.org2.com    | created by github.com/hyperledger/fabric/gossip/privdata.NewPuller peer0.org2.com    | 	/opt/gopath/src/github.com/hyperledger/fabric/gossip/privdata/pull.go:89 +0x228 peer0.org2.com exited with code 2  Attached are the logs from two peers that panic'd during one of my test runs.   ></description> </Issue>
