<Action id="28235" issue="19208" author="kchristidis" type="comment" created="2017-07-12 13:16:03.0" updateauthor="kchristidis" updated="2017-07-12 13:16:03.0"> <body><! CDATA > I'd like to know, what would be the consequence on the blockchain if I remove the orderer side ledger to enable restart of this component?  If you remove the orderer-side ledger (and still keep the genesis block around), your orderer will start producing a broken chain. Suppose it produced blocks 1-2-3. You stop the orderer, remove the ledger, restart the orderer with just the genesis block. The next block that the orderer creates is block 1, but this time it's different to the original block 1. You now have a broken chain.  > As ledger are also stored on the peer side I'm not sure to understand the need to store it on the orderer side also.  New org (`orgFoo`) joins with genesis block, how does it catch up to the most recent block? (It cannot reach out to the other orgs in the channel for gossip because orgFoo's gossip module is rejecting the "join" channel call because it cannot find `orgFoo`'s info in the genesis block.)  This is why the ordering service needs to keep a copy of the ledger – to allow syncing. (BTW, we'll be working on archiving soon, which means the orderer won't have to keep the entire ledger, but it'll be able to prune it to configuration blocks.)  ></body> </Action>
<Action id="28237" issue="19208" author="kchristidis" type="comment" created="2017-07-12 13:18:49.0" updateauthor="kchristidis" updated="2017-07-12 13:18:49.0"> <body><! CDATA Any particular reason you're still on alpha-2? Please switch to 1.0.  It's not entirely clear to me whether you were modifying the ledger on the orderer side when you got this error. (As we explained above, this is not allowed.) The error message seems to indicate that you're pointing the orderer to a directory that no longer holds a ledger beginning with a config (genesis) block.  If you did modify the ledger, let's please close this JIRA.  ></body> </Action>
<Action id="28429" issue="19208" author="mffrench" type="comment" created="2017-07-14 19:22:10.0" updateauthor="mffrench" updated="2017-07-14 19:31:13.0"> <body><! CDATA Thank you for your answers  ~kchristidis . The orderer ledger is configured as a docker volume pointing to a dedicated directory on the host to store it. We do same for the configuration folder : {code:java} volumes: - ./tmp/conf/Org0/o0:/etc/hyperledger/fabric/orderer - ./tmp/data/Org0/o0/ledger:/var/hyperledger/production/orderer  {code} To reproduce the issue I just docker-compose stop / rm the orderer container and docker-compose up -d again several times. I didn't touch anything in the ledger directory.  That said, I did my test on OSX and some time I notice Docker issue on Volume (where the container don't see the volume configured even if it exists on the host). I will continue investigate this issue and particularly to be sure this bug is not derived from this docker volume issue.   We're still on alpha2 because we didn't get the time to migrate on beta or new v1.      About orderer ledger, your input was pretty interesting. Is this the same behavior with Kafka ordering ? Is there some documentation about ledger persistence on the orderer (solo or kafka) ?   ></body> </Action>
<Action id="28433" issue="19208" author="kchristidis" type="comment" created="2017-07-14 20:24:34.0" updateauthor="kchristidis" updated="2017-07-14 20:24:34.0"> <body><! CDATA Thanks for following up on this.  I'm tempted to say this might be a Docker issue, as I cannot think of a reason our code would fail because of this.  For good measure, I would also move the the host directory to a path outside of `/tmp` (if you're on `/tmp` – that's not crystal clear). {quote}About orderer ledger, your input was pretty interesting. Is this the same behavior with Kafka ordering ? Is there some documentation about ledger persistence on the orderer (solo or kafka) ? {quote} I captured all the thinking that went behind the Kafka-based solution here:  https://docs.google.com/document/d/1vNMaM7XhOlu9tB_10dKnlrhy5d7b1u8lSY8a-kVjCO4/edit   This covers the need for a ledger at the orderer.  ></body> </Action>
<Action id="28434" issue="19208" author="kchristidis" type="comment" body="I&apos;m assigning this JIRA to you – feel free to post your findings when you got them." created="2017-07-14 20:26:45.0" updateauthor="kchristidis" updated="2017-07-14 20:26:45.0"/>
<Action id="28446" issue="19208" author="mffrench" type="comment" body="FYI : the host directory isn&apos;t in /tmp but in ./tmp where tmp is a subdirectory of my development directory. Will come back to you when I&apos;m sure this is or not a docker issue.  " created="2017-07-15 07:51:39.0" updateauthor="mffrench" updated="2017-07-15 07:51:39.0"/>
<Action id="28453" issue="19208" author="kchristidis" type="comment" body="Ah, got it, thanks for that update." created="2017-07-15 14:47:10.0" updateauthor="kchristidis" updated="2017-07-15 14:47:10.0"/>
<Action id="29710" issue="19208" author="kchristidis" type="comment" body=" ~mffrench : Any updates on this one? If it cannot be reproduced, or is not being investigated I propose that we close." created="2017-08-11 13:36:21.0" updateauthor="kchristidis" updated="2017-08-11 13:36:21.0"/>
<Action id="29713" issue="19208" author="mffrench" type="comment" created="2017-08-11 13:42:44.0" updateauthor="mffrench" updated="2017-08-11 13:43:27.0"> <body><! CDATA Hi Kostas,  I just didn't get the time to have a new check on this issue - currently I just avoid restart my pre-prod orderer.  Anyway, if you want you can close it if you prefer. When things will calm down on my current project I will take time to upgrade to new fabric version, redo the test and upgrade this ticket to tell about my last tests (reproduced or not).  Kind regards,     ></body> </Action>
<Action id="29714" issue="19208" author="kchristidis" type="comment" created="2017-08-11 13:47:36.0" updateauthor="kchristidis" updated="2017-08-11 13:47:36.0"> <body><! CDATA Ah, no problem, if you plan to look into this, we'll leave it open, sure.  (Just wanted to make sure it's not forgotten. Will check back in 6 weeks or so.)  ></body> </Action>
