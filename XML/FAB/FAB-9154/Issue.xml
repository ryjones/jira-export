<Issue id="28882" key="FAB-9154" number="9154" project="10002" reporter="sykesm" creator="sykesm" type="10003" summary="Data race when running TestOrdererBenchmarkSolo" priority="4" resolution="10200" status="6" created="2018-03-26 14:58:22.0" updated="2018-07-20 14:17:30.0" resolutiondate="2018-07-20 14:05:21.0" votes="0" watches="1" workflowId="43013"> <description><! CDATA {code:java} unit-tests_1  | ==================  unit-tests_1  | WARNING: DATA RACE  unit-tests_1  | Write at 0x00c42024b2d0 by goroutine 22:  unit-tests_1  |   github.com/hyperledger/fabric/orderer/common/multichannel.(*Registrar).newChain()  unit-tests_1  |       /opt/gopath/src/github.com/hyperledger/fabric/orderer/common/multichannel/registrar.go:289 +0x4b2  unit-tests_1  |   github.com/hyperledger/fabric/orderer/common/multichannel.(*BlockWriter).WriteConfigBlock()  unit-tests_1  |       /opt/gopath/src/github.com/hyperledger/fabric/orderer/common/multichannel/blockwriter.go:118 +0x504  unit-tests_1  |   github.com/hyperledger/fabric/orderer/common/multichannel.(*ChainSupport).WriteConfigBlock()  unit-tests_1  |       <autogenerated>:1 +0x83  unit-tests_1  |   github.com/hyperledger/fabric/orderer/consensus/solo.(*chain).main()  unit-tests_1  |       /opt/gopath/src/github.com/hyperledger/fabric/orderer/consensus/solo/consensus.go:165 +0x5ea  unit-tests_1  |  unit-tests_1  | Previous read at 0x00c42024b2d0 by goroutine 30:  unit-tests_1  |   github.com/hyperledger/fabric/orderer/common/server.deliverSupport.GetChain()  unit-tests_1  |       /opt/gopath/src/github.com/hyperledger/fabric/orderer/common/multichannel/registrar.go:227 +0x57  unit-tests_1  |   github.com/hyperledger/fabric/common/deliver.(*deliverHandler).deliverBlocks()  unit-tests_1  |       /opt/gopath/src/github.com/hyperledger/fabric/common/deliver/deliver.go:178 +0x869  unit-tests_1  |   github.com/hyperledger/fabric/common/deliver.(*deliverHandler).Handle()  unit-tests_1  |       /opt/gopath/src/github.com/hyperledger/fabric/common/deliver/deliver.go:145 +0x39f  unit-tests_1  |   github.com/hyperledger/fabric/orderer/common/server.(*server).Deliver()  unit-tests_1  |       github.com/hyperledger/fabric/orderer/common/server/_test/_obj_test/server.go:198 +0x3c0  unit-tests_1  |   github.com/hyperledger/fabric/orderer/common/performance.(*BenchmarkServer).CreateDeliverClient.func1()  unit-tests_1  |       /opt/gopath/src/github.com/hyperledger/fabric/orderer/common/performance/server.go:179 +0x6b  unit-tests_1  |  unit-tests_1  | Goroutine 22 (running) created at:  unit-tests_1  |   github.com/hyperledger/fabric/orderer/consensus/solo.(*chain).Start()  unit-tests_1  |       /opt/gopath/src/github.com/hyperledger/fabric/orderer/consensus/solo/consensus.go:72 +0x4c  unit-tests_1  |   github.com/hyperledger/fabric/orderer/common/multichannel.(*ChainSupport).start()  unit-tests_1  |       /opt/gopath/src/github.com/hyperledger/fabric/orderer/common/multichannel/chainsupport.go:87 +0x53  unit-tests_1  |   github.com/hyperledger/fabric/orderer/common/multichannel.NewRegistrar()  unit-tests_1  |       /opt/gopath/src/github.com/hyperledger/fabric/orderer/common/multichannel/registrar.go:193 +0x1691  unit-tests_1  |   github.com/hyperledger/fabric/orderer/common/server.initializeMultichannelRegistrar()  unit-tests_1  |       github.com/hyperledger/fabric/orderer/common/server/_test/_obj_test/main.go:305 +0x328  unit-tests_1  |   github.com/hyperledger/fabric/common/viperutil.getKeysRecursively()  unit-tests_1  |       /opt/gopath/src/github.com/hyperledger/fabric/common/viperutil/config_util.go:51 +0x31d  unit-tests_1  |   github.com/hyperledger/fabric/common/viperutil.getKeysRecursively()  unit-tests_1  |       /opt/gopath/src/github.com/hyperledger/fabric/common/viperutil/config_util.go:51 +0x31d  unit-tests_1  |   github.com/hyperledger/fabric/common/viperutil.getKeysRecursively()  unit-tests_1  |       /opt/gopath/src/github.com/hyperledger/fabric/common/viperutil/config_util.go:51 +0x31d  unit-tests_1  |   github.com/hyperledger/fabric/common/viperutil.getKeysRecursively()  unit-tests_1  |       /opt/gopath/src/github.com/hyperledger/fabric/common/viperutil/config_util.go:48 +0xdbd  unit-tests_1  |   github.com/hyperledger/fabric/common/viperutil.EnhancedExactUnmarshal()  unit-tests_1  |       /opt/gopath/src/github.com/hyperledger/fabric/common/viperutil/config_util.go:294 +0xf4  unit-tests_1  |   github.com/hyperledger/fabric/common/tools/configtxgen/localconfig.Load()  unit-tests_1  |       /opt/gopath/src/github.com/hyperledger/fabric/common/tools/configtxgen/localconfig/config.go:232 +0x951  unit-tests_1  |   github.com/hyperledger/fabric/orderer/common/server.initializeBootstrapChannel()  unit-tests_1  |       github.com/hyperledger/fabric/orderer/common/server/_test/_obj_test/main.go:228 +0x7c8  unit-tests_1  |   github.com/hyperledger/fabric/orderer/common/server.initializeMultichannelRegistrar()  unit-tests_1  |       github.com/hyperledger/fabric/orderer/common/server/_test/_obj_test/main.go:294 +0xe0  unit-tests_1  |   github.com/hyperledger/fabric/vendor/github.com/syndtr/goleveldb/leveldb/storage.fsParseName()  unit-tests_1  |       /opt/gopath/src/github.com/hyperledger/fabric/vendor/github.com/syndtr/goleveldb/leveldb/storage/file_storage.go:571 +0x18c  unit-tests_1  |   github.com/hyperledger/fabric/vendor/github.com/syndtr/goleveldb/leveldb/storage.(*fileStorage).List()  unit-tests_1  |       /opt/gopath/src/github.com/hyperledger/fabric/vendor/github.com/syndtr/goleveldb/leveldb/storage/file_storage.go:386 +0x2dd  unit-tests_1  |   fmt.(*ss).doScanf()  unit-tests_1  |       /opt/go/src/fmt/scan.go:1201 +0x35e  unit-tests_1  |   fmt.Fscanf()  unit-tests_1  |       /opt/go/src/fmt/scan.go:143 +0xf5  unit-tests_1  |   fmt.Sscanf()  unit-tests_1  |       /opt/go/src/fmt/scan.go:114 +0xbe  unit-tests_1  |   github.com/hyperledger/fabric/vendor/github.com/syndtr/goleveldb/leveldb/storage.fsParseName()  unit-tests_1  |       /opt/gopath/src/github.com/hyperledger/fabric/vendor/github.com/syndtr/goleveldb/leveldb/storage/file_storage.go:571 +0x18c  unit-tests_1  |   github.com/hyperledger/fabric/vendor/github.com/syndtr/goleveldb/leveldb/storage.(*fileStorage).List()  unit-tests_1  |       /opt/gopath/src/github.com/hyperledger/fabric/vendor/github.com/syndtr/goleveldb/leveldb/storage/file_storage.go:386 +0x2dd  unit-tests_1  |   fmt.(*ss).doScanf()  unit-tests_1  |       /opt/go/src/fmt/scan.go:1201 +0x35e  unit-tests_1  |   fmt.Fscanf()  unit-tests_1  |       /opt/go/src/fmt/scan.go:143 +0xf5  unit-tests_1  |   fmt.Sscanf()  unit-tests_1  |       /opt/go/src/fmt/scan.go:114 +0xbe  unit-tests_1  |   github.com/hyperledger/fabric/vendor/github.com/syndtr/goleveldb/leveldb/storage.fsParseName()  unit-tests_1  |       /opt/gopath/src/github.com/hyperledger/fabric/vendor/github.com/syndtr/goleveldb/leveldb/storage/file_storage.go:571 +0x18c  unit-tests_1  |   github.com/hyperledger/fabric/vendor/github.com/syndtr/goleveldb/leveldb/storage.(*fileStorage).List()  unit-tests_1  |       /opt/gopath/src/github.com/hyperledger/fabric/vendor/github.com/syndtr/goleveldb/leveldb/storage/file_storage.go:386 +0x2dd  unit-tests_1  |   github.com/hyperledger/fabric/vendor/github.com/syndtr/goleveldb/leveldb.(*DB).checkAndCleanFiles()  unit-tests_1  |       /opt/gopath/src/github.com/hyperledger/fabric/vendor/github.com/syndtr/goleveldb/leveldb/db_util.go:52 +0x2ff  unit-tests_1  |   github.com/hyperledger/fabric/vendor/github.com/syndtr/goleveldb/leveldb.openDB()  unit-tests_1  |       /opt/gopath/src/github.com/hyperledger/fabric/vendor/github.com/syndtr/goleveldb/leveldb/db.go:129 +0xaaa  unit-tests_1  |   fmt.Sscanf()  unit-tests_1  |       /opt/go/src/fmt/scan.go:114 +0xbe  unit-tests_1  |   github.com/hyperledger/fabric/vendor/github.com/syndtr/goleveldb/leveldb/storage.fsParseName()  unit-tests_1  |       /opt/gopath/src/github.com/hyperledger/fabric/vendor/github.com/syndtr/goleveldb/leveldb/storage/file_storage.go:571 +0x18c  unit-tests_1  |   github.com/hyperledger/fabric/vendor/github.com/syndtr/goleveldb/leveldb/storage.(*fileStorage).List()  unit-tests_1  |       /opt/gopath/src/github.com/hyperledger/fabric/vendor/github.com/syndtr/goleveldb/leveldb/storage/file_storage.go:386 +0x2dd  unit-tests_1  |   fmt.Sscanf()  unit-tests_1  |       /opt/go/src/fmt/scan.go:114 +0xbe  unit-tests_1  |   github.com/hyperledger/fabric/vendor/github.com/syndtr/goleveldb/leveldb/storage.fsParseName()  unit-tests_1  |       /opt/gopath/src/github.com/hyperledger/fabric/vendor/github.com/syndtr/goleveldb/leveldb/storage/file_storage.go:585 +0x276  unit-tests_1  |   fmt.(*ss).doScanf()  unit-tests_1  |       /opt/go/src/fmt/scan.go:1201 +0x35e  unit-tests_1  |   fmt.Fscanf()  unit-tests_1  |       /opt/go/src/fmt/scan.go:143 +0xf5  unit-tests_1  |   fmt.Sscanf()  unit-tests_1  |       /opt/go/src/fmt/scan.go:114 +0xbe  unit-tests_1  |   github.com/hyperledger/fabric/vendor/github.com/syndtr/goleveldb/leveldb/storage.fsParseName()  unit-tests_1  |       /opt/gopath/src/github.com/hyperledger/fabric/vendor/github.com/syndtr/goleveldb/leveldb/storage/file_storage.go:571 +0x18c  unit-tests_1  |   github.com/hyperledger/fabric/vendor/github.com/syndtr/goleveldb/leveldb/storage.(*fileStorage).List()  unit-tests_1  |       /opt/gopath/src/github.com/hyperledger/fabric/vendor/github.com/syndtr/goleveldb/leveldb/storage/file_storage.go:386 +0x2dd  unit-tests_1  |   fmt.(*ss).doScanf()  unit-tests_1  |       /opt/go/src/fmt/scan.go:1201 +0x35e  unit-tests_1  |   fmt.Fscanf()  unit-tests_1  |       /opt/go/src/fmt/scan.go:143 +0xf5  unit-tests_1  |   fmt.Sscanf()  unit-tests_1  |       /opt/go/src/fmt/scan.go:114 +0xbe  unit-tests_1  |   github.com/hyperledger/fabric/vendor/github.com/syndtr/goleveldb/leveldb/storage.fsParseName()  unit-tests_1  |       /opt/gopath/src/github.com/hyperledger/fabric/vendor/github.com/syndtr/goleveldb/leveldb/storage/file_storage.go:571 +0x18c  unit-tests_1  |   github.com/hyperledger/fabric/vendor/github.com/syndtr/goleveldb/leveldb/storage.(*fileStorage).List()  unit-tests_1  |       /opt/gopath/src/github.com/hyperledger/fabric/vendor/github.com/syndtr/goleveldb/leveldb/storage/file_storage.go:386 +0x2dd  unit-tests_1  |   fmt.(*ss).doScanf()  unit-tests_1  |       /opt/go/src/fmt/scan.go:1201 +0x35e  unit-tests_1  |   fmt.Fscanf()  unit-tests_1  |       /opt/go/src/fmt/scan.go:143 +0xf5  unit-tests_1  |   fmt.Sscanf()  unit-tests_1  |       /opt/go/src/fmt/scan.go:114 +0xbe  unit-tests_1  |   github.com/hyperledger/fabric/vendor/github.com/syndtr/goleveldb/leveldb/storage.fsParseName()  unit-tests_1  |       /opt/gopath/src/github.com/hyperledger/fabric/vendor/github.com/syndtr/goleveldb/leveldb/storage/file_storage.go:571 +0x18c  unit-tests_1  |   github.com/hyperledger/fabric/vendor/github.com/syndtr/goleveldb/leveldb/storage.(*fileStorage).List()  unit-tests_1  |       /opt/gopath/src/github.com/hyperledger/fabric/vendor/github.com/syndtr/goleveldb/leveldb/storage/file_storage.go:386 +0x2dd  unit-tests_1  |   github.com/hyperledger/fabric/vendor/github.com/syndtr/goleveldb/leveldb.(*DB).recoverJournal()  unit-tests_1  |       /opt/gopath/src/github.com/hyperledger/fabric/vendor/github.com/syndtr/goleveldb/leveldb/db.go:475 +0xdc  unit-tests_1  |   github.com/hyperledger/fabric/vendor/github.com/syndtr/goleveldb/leveldb.openDB()  unit-tests_1  |       /opt/gopath/src/github.com/hyperledger/fabric/vendor/github.com/syndtr/goleveldb/leveldb/db.go:124 +0xa86  unit-tests_1  |   github.com/hyperledger/fabric/vendor/github.com/syndtr/goleveldb/leveldb.Open()  unit-tests_1  |       /opt/gopath/src/github.com/hyperledger/fabric/vendor/github.com/syndtr/goleveldb/leveldb/db.go:196 +0x193  unit-tests_1  |   github.com/hyperledger/fabric/vendor/github.com/syndtr/goleveldb/leveldb/storage.fsParseName()  unit-tests_1  |       /opt/gopath/src/github.com/hyperledger/fabric/vendor/github.com/syndtr/goleveldb/leveldb/storage/file_storage.go:571 +0x18c  unit-tests_1  |   github.com/hyperledger/fabric/vendor/github.com/syndtr/goleveldb/leveldb/storage.(*fileStorage).List()  unit-tests_1  |       /opt/gopath/src/github.com/hyperledger/fabric/vendor/github.com/syndtr/goleveldb/leveldb/storage/file_storage.go:386 +0x2dd  unit-tests_1  |   fmt.(*ss).doScanf()  unit-tests_1  |       /opt/go/src/fmt/scan.go:1201 +0x35e  unit-tests_1  |   fmt.Fscanf()  unit-tests_1  |       /opt/go/src/fmt/scan.go:143 +0xf5  unit-tests_1  |   fmt.Sscanf()  unit-tests_1  |       /opt/go/src/fmt/scan.go:114 +0xbe  unit-tests_1  |   github.com/hyperledger/fabric/vendor/github.com/syndtr/goleveldb/leveldb/storage.fsParseName()  unit-tests_1  |       /opt/gopath/src/github.com/hyperledger/fabric/vendor/github.com/syndtr/goleveldb/leveldb/storage/file_storage.go:571 +0x18c  unit-tests_1  |   github.com/hyperledger/fabric/vendor/github.com/syndtr/goleveldb/leveldb/storage.(*fileStorage).List()  unit-tests_1  |       /opt/gopath/src/github.com/hyperledger/fabric/vendor/github.com/syndtr/goleveldb/leveldb/storage/file_storage.go:386 +0x2dd  unit-tests_1  |   github.com/hyperledger/fabric/vendor/github.com/syndtr/goleveldb/leveldb.(*session).recover.func1()  unit-tests_1  |       /opt/gopath/src/github.com/hyperledger/fabric/vendor/github.com/syndtr/goleveldb/leveldb/session.go:113 +0xc6  unit-tests_1  |   github.com/hyperledger/fabric/vendor/github.com/syndtr/goleveldb/leveldb.(*session).recover()  unit-tests_1  |       /opt/gopath/src/github.com/hyperledger/fabric/vendor/github.com/syndtr/goleveldb/leveldb/session.go:121 +0x1a63  unit-tests_1  |   github.com/hyperledger/fabric/vendor/github.com/syndtr/goleveldb/leveldb.Open()  unit-tests_1  |       /opt/gopath/src/github.com/hyperledger/fabric/vendor/github.com/syndtr/goleveldb/leveldb/db.go:182 +0xd5  unit-tests_1  |   github.com/hyperledger/fabric/vendor/github.com/syndtr/goleveldb/leveldb.OpenFile()  unit-tests_1  |       /opt/gopath/src/github.com/hyperledger/fabric/vendor/github.com/syndtr/goleveldb/leveldb/db.go:218 +0x9f  unit-tests_1  |   github.com/hyperledger/fabric/common/ledger/util/leveldbhelper.(*DB).Open()  unit-tests_1  |       /opt/gopath/src/github.com/hyperledger/fabric/common/ledger/util/leveldbhelper/leveldb_helper.go:87 +0x1ea  unit-tests_1  |   github.com/hyperledger/fabric/common/ledger/util/leveldbhelper.NewProvider()  unit-tests_1  |       /opt/gopath/src/github.com/hyperledger/fabric/common/ledger/util/leveldbhelper/leveldb_provider.go:40 +0x243  unit-tests_1  |   github.com/hyperledger/fabric/common/ledger/blkstorage/fsblkstorage.NewProvider()  unit-tests_1  |       /opt/gopath/src/github.com/hyperledger/fabric/common/ledger/blkstorage/fsblkstorage/fs_blockstore_provider.go:34 +0xa3  unit-tests_1  |   github.com/hyperledger/fabric/common/ledger/blockledger/file.New()  unit-tests_1  |       /opt/gopath/src/github.com/hyperledger/fabric/common/ledger/blockledger/file/factory.go:71 +0x158  unit-tests_1  |   github.com/hyperledger/fabric/orderer/common/server.createLedgerFactory()  unit-tests_1  |       github.com/hyperledger/fabric/orderer/common/server/_test/_obj_test/util.go:32 +0x69c  unit-tests_1  |   github.com/hyperledger/fabric/orderer/common/server.initializeMultichannelRegistrar()  unit-tests_1  |       github.com/hyperledger/fabric/orderer/common/server/_test/_obj_test/main.go:290 +0x6b  unit-tests_1  |   github.com/hyperledger/fabric/orderer/common/server.Start()  unit-tests_1  |       github.com/hyperledger/fabric/orderer/common/server/_test/_obj_test/main.go:105 +0x39c  unit-tests_1  |  unit-tests_1  | Goroutine 30 (finished) created at:  unit-tests_1  |   github.com/hyperledger/fabric/orderer/common/performance.(*BenchmarkServer).CreateDeliverClient()  unit-tests_1  |       /opt/gopath/src/github.com/hyperledger/fabric/orderer/common/performance/server.go:178 +0x1b8  unit-tests_1  |   github.com/hyperledger/fabric/orderer/common/performance.WaitForChannels.func1()  unit-tests_1  |       /opt/gopath/src/github.com/hyperledger/fabric/orderer/common/performance/utils.go:119 +0x148  unit-tests_1  | =================={code}  ></description> </Issue>
