<Action id="46305" issue="31238" author="denyeart" type="comment" created="2018-06-20 17:01:36.0" updateauthor="denyeart" updated="2018-06-20 17:21:19.0"> <body><! CDATA This private data for keyÂ *marble_testorgschannel1_org1_0_2_86* including hash key of *kDzX0l+QGeABRxIOIeGnaXD4WSfAM0BDcBDtsj2AsIQ=* was committed to state database in block 14 at {code:java}  36m2018-06-20 15:24:56.100 UTC  couchdb  BatchUpdateDocuments{code} Then after block 16 is committed a simulation attempts to read it and gets the cached version of hash: {code:java}  36m2018-06-20 15:27:18.104 UTC  statecouchdb  GetCachedVersion -> DEBU 2c637 0m Retrieving cached version: kDzX0l+QGeABRxIOIeGnaXD4WSfAM0BDcBDtsj2AsIQ=~marbles02_private_go_ch1$$hcollectionMarblePrivateDetails{code} The cached version must have been nil incorrectly, since we get: {code:java}  31m2018-06-20 15:27:18.104 UTC  chaincode  HandleTransaction -> ERRO 2c638 0m  27082332  Failed to handle GET_STATE. error: Private data matching public hash version is not available. Public hash version = (*version.Height)(nil), Private data version = &version.Height{BlockNum:0xe, TxNum:0x0}{code} Note that the private version was found (at block 14 transaction 0), but the hashed version was not found.  For a case of missing private data, we would have seen the opposite.Â  So I believe this problem indicates a problem in the hash version cache.  Â   ></body> </Action>
<Action id="46370" issue="31238" author="denyeart" type="comment" body="https://gerrit.hyperledger.org/r/#/c/23443/" created="2018-06-21 13:27:28.0" updateauthor="denyeart" updated="2018-06-21 13:27:28.0"/>
<Action id="46387" issue="31238" author="denyeart" type="comment" created="2018-06-21 15:10:06.0" updateauthor="denyeart" updated="2018-06-21 15:11:10.0"> <body><! CDATA This error would have happened if at least one key is expiring in the next block (yet to come block) and query is made on some other key (other than the expiring ones) in the same namespace.Â  As this has a large impact on private data scenarios, I've labeled as must-fix.  I've confirmed the fix resolves the issue.  ></body> </Action>
