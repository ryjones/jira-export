<Issue id="19338" key="FAB-5369" number="5369" project="10002" reporter="sstone1" creator="sstone1" type="10001" summary="Peer overwrites limit/skip fields in CouchDB query string" priority="1" resolution="10000" status="6" created="2017-07-18 21:10:33.0" updated="2018-07-20 18:56:36.0" resolutiondate="2018-03-11 14:13:58.0" votes="3" watches="11" workflowId="39486"> <description><! CDATA If I pass in a CouchDB query string that specifies either `limit` or `skip`, then the query results are not as I would expect.  It seems that the peer has some code in it that forcibly sets `limit` to a configuration value from `core.yaml`, and forcibly sets `skip` to 0. It does this without checking whether `limit` or `skip` are already specified by the user in the query string.  This is the query string that we send in: {code:java} {"selector":{"$class":"systest.queries.SampleAsset","$registryType":"Asset","$registryId":"systest.queries.SampleAsset"},"limit":2}{code} This is the output of the peer rewriting the query: {code:java}  statecouchdb  ApplyQueryWrapper -> DEBU 1f62 Rewritten query with data wrapper: {"limit":10000,"selector":{"$and": \{"chaincodeid":"systest-queries"},\{"data.$class":"systest.queries.SampleAsset","data.$registryId":"systest.queries.SampleAsset","data.$registryType":"Asset"} },"skip":0}{code} This is the offending code:   https://github.com/hyperledger/fabric/blob/d9c320297bd2a4eff2eb253ce84dc431ef860972/core/ledger/kvledger/txmgmt/statedb/statecouchdb/query_wrapper.go#L101   IMHO the code should check for existing `limit` or `skip` values before overwriting them ;)  ></description> </Issue>
