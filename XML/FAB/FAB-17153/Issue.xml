<Issue id="43467" key="FAB-17153" number="17153" project="10002" reporter="sykesm" assignee="baidang201" creator="sykesm" type="10004" summary="Test_WriteFolderToTarPackageFailure4 prevents cleanup of temporary directory used by test" priority="3" resolution="10000" status="6" created="2019-11-26 16:29:52.0" updated="2020-07-08 03:07:13.0" resolutiondate="2019-12-01 13:45:39.0" votes="0" watches="2" workflowId="56581"> <description><! CDATA My tmpfs filled up today. While I was looking through the contents I noticed a handful of entires like this: {code} drw-r--r-- 2 sykesm sykesm 4096 Oct 14 17:56 WriteFolderToTarPackageFailure4BadFileMode105951842 drw-r--r-- 2 sykesm sykesm 4096 Nov 12 14:15 WriteFolderToTarPackageFailure4BadFileMode261939118 drw-r--r-- 2 sykesm sykesm 4096 Oct 24 13:13 WriteFolderToTarPackageFailure4BadFileMode311178017 drw-r--r-- 2 sykesm sykesm 4096 Oct 31 18:53 WriteFolderToTarPackageFailure4BadFileMode354042733 drw-r--r-- 2 sykesm sykesm 4096 Nov  5 18:31 WriteFolderToTarPackageFailure4BadFileMode705955383 drw-r--r-- 2 sykesm sykesm 4096 Oct 24 15:15 WriteFolderToTarPackageFailure4BadFileMode867083399 {code}  There were only a few entries but I assume that's because this test was only added in September.  It appears this is coming from this test in core/chaincode/platforms/util/writer_test: {code} func Test_WriteFolderToTarPackageFailure4(t *testing.T) { 	tempDir, err := ioutil.TempDir("", "WriteFolderToTarPackageFailure4BadFileMode") 	require.NoError(t, err) 	defer os.RemoveAll(tempDir) 	testFile := filepath.Join(tempDir, "test.java") 	err = ioutil.WriteFile(testFile,   byte("Content"), 0644) 	require.NoError(t, err, "Error creating file", testFile) 	err = os.Chmod(tempDir, 0644) 	require.NoError(t, err)  	buf := bytes.NewBuffer(nil) 	tw := tar.NewWriter(buf) 	defer tw.Close()  	err = WriteFolderToTarPackage(tw, tempDir,   string{}, nil, nil) 	assert.Error(t, err, "Should have received error writing folder to package") 	assert.Contains(t, err.Error(), "permission denied") } {code} changes the permission of the temporary directory to 0644. By making this change, the {{defer os.RemoveAll(tempDir)}} call may not succeed.  Either the directory permissions need to be restored or a subdirectory needs to be created.  ></description> </Issue>
