<Issue id="39724" key="FAB-15396" number="15396" project="10002" reporter="wlahti" assignee="dereckluo" creator="wlahti" type="10004" summary="Intermittent test failures related to couchDB containers - increase couchdb startup timeout" priority="2" resolution="10000" status="6" created="2019-05-08 19:52:44.0" updated="2019-11-14 14:52:47.0" resolutiondate="2019-11-14 14:50:12.0" votes="0" watches="6" workflowId="52610"> <description><! CDATA Hit multiple times earlier today in a few of my CRs and I haven't seen this before.   Full log:  ^consoleText.txt  {code:java} 15:29:27 --- FAIL: TestPrivateDataMetadataRetrievalByHash (37.10s) 15:29:27 panic: failed to start couchDB: database in container 99400b3a1227cda0b322bb4a7b29699bd60ba9d9a04549a16783a8c00397a063 did not start: context deadline exceeded  recovered  15:29:27 	panic: failed to start couchDB: database in container 99400b3a1227cda0b322bb4a7b29699bd60ba9d9a04549a16783a8c00397a063 did not start: context deadline exceeded 15:29:27  15:29:27 goroutine 87  running : 15:29:27 testing.tRunner.func1(0xc000156700) 15:29:27 	/opt/go/go1.11.5.linux.amd64/src/testing/testing.go:792 +0x6a7 15:29:27 panic(0x159f0c0, 0xc001334a60) 15:29:27 	/opt/go/go1.11.5.linux.amd64/src/runtime/panic.go:513 +0x1b9 15:29:27 github.com/hyperledger/fabric/core/ledger/kvledger/txmgmt/privacyenabledstate.(*CouchDBCommonStorageTestEnv).setupCouch(0x22a80c0, 0x4, 0x16e0ab6) 15:29:27 	/w/workspace/fabric-verify-unit-tests-x86_64/gopath/src/github.com/hyperledger/fabric/core/ledger/kvledger/txmgmt/privacyenabledstate/test_exports.go:110 +0x39c 15:29:27 github.com/hyperledger/fabric/core/ledger/kvledger/txmgmt/privacyenabledstate.(*CouchDBCommonStorageTestEnv).Init(0x22a80c0, 0x1842f00, 0xc000156700) 15:29:27 	/w/workspace/fabric-verify-unit-tests-x86_64/gopath/src/github.com/hyperledger/fabric/core/ledger/kvledger/txmgmt/privacyenabledstate/test_exports.go:122 +0x14a 15:29:27 github.com/hyperledger/fabric/core/ledger/kvledger/txmgmt/txmgr/lockbasedtxmgr.(*lockBasedEnv).init(0x21b49c0, 0xc000156700, 0x17037b6, 0x2a, 0x1826f20, 0xc00195e060) 15:29:27 	/w/workspace/fabric-verify-unit-tests-x86_64/gopath/src/github.com/hyperledger/fabric/core/ledger/kvledger/txmgmt/txmgr/lockbasedtxmgr/pkg_test.go:75 +0xc6 15:29:27 github.com/hyperledger/fabric/core/ledger/kvledger/txmgmt/txmgr/lockbasedtxmgr.testPrivateDataMetadataRetrievalByHash(0xc000156700, 0x18399a0, 0x21b49c0) 15:29:27 	/w/workspace/fabric-verify-unit-tests-x86_64/gopath/src/github.com/hyperledger/fabric/core/ledger/kvledger/txmgmt/txmgr/lockbasedtxmgr/helper_test.go:90 +0x147 15:29:27 github.com/hyperledger/fabric/core/ledger/kvledger/txmgmt/txmgr/lockbasedtxmgr.TestPrivateDataMetadataRetrievalByHash(0xc000156700) 15:29:27 	/w/workspace/fabric-verify-unit-tests-x86_64/gopath/src/github.com/hyperledger/fabric/core/ledger/kvledger/txmgmt/txmgr/lockbasedtxmgr/helper_test.go:79 +0xa3 15:29:27 testing.tRunner(0xc000156700, 0x171d7e0) 15:29:27 	/opt/go/go1.11.5.linux.amd64/src/testing/testing.go:827 +0x163 15:29:27 created by testing.(*T).Run 15:29:27 	/opt/go/go1.11.5.linux.amd64/src/testing/testing.go:878 +0x65a 15:29:27 FAIL	github.com/hyperledger/fabric/core/ledger/kvledger/txmgmt/txmgr/lockbasedtxmgr	37.863s{code} Also can be hit here: {code:java} 12:23:33 	panic: failed to start couchDB: database in container e7a939555eb0d88e0cbcda577d3810bd6f7d0d212ceafed4c4cf1f214f1764b0 did not start: context deadline exceeded 12:23:33  12:23:33 goroutine 76  running : 12:23:33 testing.tRunner.func1(0xc0000e2500) 12:23:33 	/opt/go/go1.11.5.linux.amd64/src/testing/testing.go:792 +0x6a7 12:23:33 panic(0x1427f40, 0xc00037ace0) 12:23:33 	/opt/go/go1.11.5.linux.amd64/src/runtime/panic.go:513 +0x1b9 12:23:33 github.com/hyperledger/fabric/core/ledger/kvledger/txmgmt/privacyenabledstate.(*CouchDBCommonStorageTestEnv).setupCouch(0xc000218800, 0x4, 0x154d5f8) 12:23:33 	/w/workspace/fabric-verify-unit-tests-x86_64/gopath/src/github.com/hyperledger/fabric/core/ledger/kvledger/txmgmt/privacyenabledstate/test_exports.go:110 +0x39c 12:23:33 github.com/hyperledger/fabric/core/ledger/kvledger/txmgmt/privacyenabledstate.(*CouchDBCommonStorageTestEnv).Init(0xc000218800, 0x168afe0, 0xc0000e2500) 12:23:33 	/w/workspace/fabric-verify-unit-tests-x86_64/gopath/src/github.com/hyperledger/fabric/core/ledger/kvledger/txmgmt/privacyenabledstate/test_exports.go:122 +0x14a 12:23:33 github.com/hyperledger/fabric/core/ledger/kvledger/txmgmt/pvtstatepurgemgmt.(*testHelper).init(0xc0000b1ef0, 0xc0000e2500, 0x1559763, 0x14, 0x1671ac0, 0xc000152c20, 0x1681580, 0xc000218800) 12:23:33 	/w/workspace/fabric-verify-unit-tests-x86_64/gopath/src/github.com/hyperledger/fabric/core/ledger/kvledger/txmgmt/pvtstatepurgemgmt/purge_mgr_test.go:287 +0x106 12:23:33 github.com/hyperledger/fabric/core/ledger/kvledger/txmgmt/pvtstatepurgemgmt.testPurgeMgr(0xc0000e2500, 0x1681580, 0xc000218800) 12:23:33 	/w/workspace/fabric-verify-unit-tests-x86_64/gopath/src/github.com/hyperledger/fabric/core/ledger/kvledger/txmgmt/pvtstatepurgemgmt/purge_mgr_test.go:51 +0x369 12:23:33 github.com/hyperledger/fabric/core/ledger/kvledger/txmgmt/pvtstatepurgemgmt.TestPurgeMgr.func1(0xc0000e2500) 12:23:33 	/w/workspace/fabric-verify-unit-tests-x86_64/gopath/src/github.com/hyperledger/fabric/core/ledger/kvledger/txmgmt/pvtstatepurgemgmt/purge_mgr_test.go:35 +0x6b 12:23:33 testing.tRunner(0xc0000e2500, 0xc000387a30) 12:23:33 	/opt/go/go1.11.5.linux.amd64/src/testing/testing.go:827 +0x163 12:23:33 created by testing.(*T).Run 12:23:33 	/opt/go/go1.11.5.linux.amd64/src/testing/testing.go:878 +0x65a 12:23:33 FAIL	github.com/hyperledger/fabric/core/ledger/kvledger/txmgmt/pvtstatepurgemgmt	31.821s {code} I've also seen this error:  {code:java} 13:39:33 --- FAIL: TestNotCreateCouchGlobalChangesDB (1.10s) 13:39:33     <autogenerated>:1:  13:39:33         	Error Trace:	couchdbutil_test.go:48 13:39:33         	Error:      	Expected value not to be nil. 13:39:33         	Test:       	TestNotCreateCouchGlobalChangesDB  . . . 13:39:33 FAIL	github.com/hyperledger/fabric/core/ledger/util/couchdb	26.131s{code}  ></description> </Issue>
