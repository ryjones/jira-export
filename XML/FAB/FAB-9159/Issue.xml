<Issue id="28888" key="FAB-9159" number="9159" project="10002" reporter="sykesm" assignee="sykesm" creator="sykesm" type="10003" summary="Data races in logging when running Kafka tests" priority="4" resolution="10000" status="6" created="2018-03-26 15:01:56.0" updated="2018-07-20 14:16:08.0" resolutiondate="2018-07-01 12:23:14.0" votes="0" watches="2" workflowId="41652"> <description><! CDATA {code:java} ================== WARNING: DATA RACE Read at 0x00c4202402b8 by goroutine 155:   github.com/hyperledger/fabric/orderer/consensus/kafka.TestLogPossibleKafkaVersionMismatch()       /usr/local/Cellar/go/1.10.3/libexec/src/bytes/buffer.go:66 +0x15c1   testing.tRunner()       /usr/local/Cellar/go/1.10.3/libexec/src/testing/testing.go:777 +0x16d  Previous write at 0x00c4202402b8 by goroutine 16:   bytes.(*Buffer).grow()       /usr/local/Cellar/go/1.10.3/libexec/src/bytes/buffer.go:149 +0x276   bytes.(*Buffer).Write()       /usr/local/Cellar/go/1.10.3/libexec/src/bytes/buffer.go:174 +0x14f   log.(*Logger).Output()       /usr/local/Cellar/go/1.10.3/libexec/src/log/log.go:172 +0x37a   github.com/hyperledger/fabric/vendor/github.com/op/go-logging.(*LogBackend).Log()       /Users/sykesm/workspace/fabric/src/github.com/hyperledger/fabric/vendor/github.com/op/go-logging/log_nix.go:75 +0x5ad   github.com/hyperledger/fabric/vendor/github.com/op/go-logging.(*moduleLeveled).Log()       /Users/sykesm/workspace/fabric/src/github.com/hyperledger/fabric/vendor/github.com/op/go-logging/level.go:121 +0x14d   github.com/hyperledger/fabric/vendor/github.com/op/go-logging.(*multiLogger).Log()       /Users/sykesm/workspace/fabric/src/github.com/hyperledger/fabric/vendor/github.com/op/go-logging/multi.go:31 +0x1cc   github.com/hyperledger/fabric/vendor/github.com/op/go-logging.(*Logger).log()       /Users/sykesm/workspace/fabric/src/github.com/hyperledger/fabric/vendor/github.com/op/go-logging/logger.go:166 +0x2e8   github.com/hyperledger/fabric/vendor/github.com/op/go-logging.(*Logger).Critical()       /Users/sykesm/workspace/fabric/src/github.com/hyperledger/fabric/vendor/github.com/op/go-logging/logger.go:199 +0x5e   github.com/hyperledger/fabric/orderer/consensus/kafka.init.2.func1()       /Users/sykesm/workspace/fabric/src/github.com/hyperledger/fabric/orderer/consensus/kafka/logger.go:54 +0x6c  Goroutine 155 (running) created at:   testing.(*T).Run()       /usr/local/Cellar/go/1.10.3/libexec/src/testing/testing.go:824 +0x564   testing.runTests.func1()       /usr/local/Cellar/go/1.10.3/libexec/src/testing/testing.go:1063 +0xa4   testing.tRunner()       /usr/local/Cellar/go/1.10.3/libexec/src/testing/testing.go:777 +0x16d   testing.runTests()       /usr/local/Cellar/go/1.10.3/libexec/src/testing/testing.go:1061 +0x4e1   testing.(*M).Run()       /usr/local/Cellar/go/1.10.3/libexec/src/testing/testing.go:978 +0x2cd   main.main()       _testmain.go:86 +0x22a  Goroutine 16 (running) created at:   github.com/hyperledger/fabric/orderer/consensus/kafka.init.2()       /Users/sykesm/workspace/fabric/src/github.com/hyperledger/fabric/orderer/consensus/kafka/logger.go:50 +0x8d   github.com/hyperledger/fabric/orderer/consensus/kafka.init()       <autogenerated>:1 +0x131   main.init()       <autogenerated>:1 +0xa5 ================== ================== WARNING: DATA RACE Read at 0x00c4202402a0 by goroutine 155:   github.com/hyperledger/fabric/orderer/consensus/kafka.TestLogPossibleKafkaVersionMismatch()       /usr/local/Cellar/go/1.10.3/libexec/src/bytes/buffer.go:66 +0x15db   testing.tRunner()       /usr/local/Cellar/go/1.10.3/libexec/src/testing/testing.go:777 +0x16d  Previous write at 0x00c4202402a0 by goroutine 16:   bytes.(*Buffer).grow()       /usr/local/Cellar/go/1.10.3/libexec/src/bytes/buffer.go:146 +0x235   bytes.(*Buffer).Write()       /usr/local/Cellar/go/1.10.3/libexec/src/bytes/buffer.go:174 +0x14f   log.(*Logger).Output()       /usr/local/Cellar/go/1.10.3/libexec/src/log/log.go:172 +0x37a   github.com/hyperledger/fabric/vendor/github.com/op/go-logging.(*LogBackend).Log()       /Users/sykesm/workspace/fabric/src/github.com/hyperledger/fabric/vendor/github.com/op/go-logging/log_nix.go:75 +0x5ad   github.com/hyperledger/fabric/vendor/github.com/op/go-logging.(*moduleLeveled).Log()       /Users/sykesm/workspace/fabric/src/github.com/hyperledger/fabric/vendor/github.com/op/go-logging/level.go:121 +0x14d   github.com/hyperledger/fabric/vendor/github.com/op/go-logging.(*multiLogger).Log()       /Users/sykesm/workspace/fabric/src/github.com/hyperledger/fabric/vendor/github.com/op/go-logging/multi.go:31 +0x1cc   github.com/hyperledger/fabric/vendor/github.com/op/go-logging.(*Logger).log()       /Users/sykesm/workspace/fabric/src/github.com/hyperledger/fabric/vendor/github.com/op/go-logging/logger.go:166 +0x2e8   github.com/hyperledger/fabric/vendor/github.com/op/go-logging.(*Logger).Critical()       /Users/sykesm/workspace/fabric/src/github.com/hyperledger/fabric/vendor/github.com/op/go-logging/logger.go:199 +0x5e   github.com/hyperledger/fabric/orderer/consensus/kafka.init.2.func1()       /Users/sykesm/workspace/fabric/src/github.com/hyperledger/fabric/orderer/consensus/kafka/logger.go:54 +0x6c  Goroutine 155 (running) created at:   testing.(*T).Run()       /usr/local/Cellar/go/1.10.3/libexec/src/testing/testing.go:824 +0x564   testing.runTests.func1()       /usr/local/Cellar/go/1.10.3/libexec/src/testing/testing.go:1063 +0xa4   testing.tRunner()       /usr/local/Cellar/go/1.10.3/libexec/src/testing/testing.go:777 +0x16d   testing.runTests()       /usr/local/Cellar/go/1.10.3/libexec/src/testing/testing.go:1061 +0x4e1   testing.(*M).Run()       /usr/local/Cellar/go/1.10.3/libexec/src/testing/testing.go:978 +0x2cd   main.main()       _testmain.go:86 +0x22a  Goroutine 16 (running) created at:   github.com/hyperledger/fabric/orderer/consensus/kafka.init.2()       /Users/sykesm/workspace/fabric/src/github.com/hyperledger/fabric/orderer/consensus/kafka/logger.go:50 +0x8d   github.com/hyperledger/fabric/orderer/consensus/kafka.init()       <autogenerated>:1 +0x131   main.init()       <autogenerated>:1 +0xa5 =================={code}  ></description> </Issue>
