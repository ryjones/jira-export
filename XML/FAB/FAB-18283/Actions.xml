<Action id="70567" issue="46227" author="tock" type="comment" created="2020-10-27 09:09:41.0" updateauthor="tock" updated="2020-10-27 09:09:41.0"> <body><! CDATA This happens because when an etcdraft.Chain is evicted (and system channel exists), it calls the halt() which calls haltCallback(), which registers the channel on to the InactiveChainRegistry. However, the chain remains in the Registrar's chains map as stopped, forever, or until the orderer is re-added to the consenters set. The inactive.Chain is only set into the Registrar's chains map at restart, but not on eviction.  The solution: to change the ClusterRelation & Status reported by an etcdraft.Chain after it is stopped. - at creation, set ClusterRelation="member" & Status="active" - after stop(), set  & Status="inactive" - after the haltCallback() is invoked, set ClusterRelation="config-tracker". Note that if the haltCallback() is replacing the etcdraft.Chain with a follower.Chain (no system channel), then the new follower will report correct StatusReport, and the replaced chain is GC.  ></body> </Action>
