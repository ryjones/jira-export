<Action id="29512" issue="19892" author="harsha544" type="comment" created="2017-08-07 18:47:12.0" updateauthor="harsha544" updated="2017-08-07 18:48:31.0"> <body><! CDATA make kubernetes passes through and later when I have issued *kubectl create --f- build/kubernetes.yaml --save-config* it fails with following error message on screen : *error: error converting YAML to JSON: yaml: line 8: could not find expected ':'*  Further investigation with yamllint yields following information :-  yamllint ./build/kubernetes.yaml -f parsable ./build/kubernetes.yaml:4:81:  error  line too long (89 > 80 characters) (line-length) ./build/kubernetes.yaml:6:81:  error  line too long (90 > 80 characters) (line-length) ./build/kubernetes.yaml:7:81:  error  line too long (87 > 80 characters) (line-length) ./build/kubernetes.yaml:8:81:  error  line too long (88 > 80 characters) (line-length) ./build/kubernetes.yaml:9:81:  error  line too long (86 > 80 characters) (line-length) ./build/kubernetes.yaml:10:81:  error  line too long (89 > 80 characters) (line-length) ./build/kubernetes.yaml:11:81:  error  line too long (90 > 80 characters) (line-length) ./build/kubernetes.yaml:14:81:  error  line too long (81 > 80 characters) (line-length) ./build/kubernetes.yaml:15:81:  error  line too long (88 > 80 characters) (line-length) ./build/kubernetes.yaml:16:81:  error  line too long (83 > 80 characters) (line-length) ./build/kubernetes.yaml:20:81:  error  line too long (87 > 80 characters) (line-length) ./build/kubernetes.yaml:21:81:  error  line too long (86 > 80 characters) (line-length) ./build/kubernetes.yaml:24:81:  error  line too long (83 > 80 characters) (line-length) ./build/kubernetes.yaml:25:81:  error  line too long (84 > 80 characters) (line-length) ./build/kubernetes.yaml:38:81:  error  line too long (90 > 80 characters) (line-length) ./build/kubernetes.yaml:39:81:  error  line too long (81 > 80 characters) (line-length) ./build/kubernetes.yaml:41:81:  error  line too long (82 > 80 characters) (line-length) ./build/kubernetes.yaml:59:81:  error  line too long (90 > 80 characters) (line-length) *./build/kubernetes.yaml:61:1:  error  syntax error: could not found expected ':'* ./build/kubernetes.yaml:134:81:  error  line too long (90 > 80 characters) (line-length) ./build/kubernetes.yaml:506:81:  error  line too long (90 > 80 characters) (line-length) ./build/kubernetes.yaml:767:81:  error  line too long (90 > 80 characters) (line-length) ./build/kubernetes.yaml:950:81:  error  line too long (90 > 80 characters) (line-length) ./build/kubernetes.yaml:1133:81:  error  line too long (90 > 80 characters) (line-length) ./build/kubernetes.yaml:1316:81:  error  line too long (90 > 80 characters) (line-length) ./build/kubernetes.yaml:1498:81:  error  line too long (90 > 80 characters) (line-length) ./build/kubernetes.yaml:1608:81:  error  line too long (139 > 80 characters) (line-length) ./build/kubernetes.yaml:1682:81:  error  line too long (96 > 80 characters) (line-length) ./build/kubernetes.yaml:1777:81:  error  line too long (116 > 80 characters) (line-length) ./build/kubernetes.yaml:1864:81:  error  line too long (105 > 80 characters) (line-length) ./build/kubernetes.yaml:1990:81:  error  line too long (105 > 80 characters) (line-length) ./build/kubernetes.yaml:2116:81:  error  line too long (105 > 80 characters) (line-length) ./build/kubernetes.yaml:2242:81:  error  line too long (105 > 80 characters) (line-length) ./build/kubernetes.yaml:2295:1:  error  trailing spaces (trailing-spaces) ./build/kubernetes.yaml:2298:1:  error  trailing spaces (trailing-spaces) ./build/kubernetes.yaml:2301:1:  error  trailing spaces (trailing-spaces) ./build/kubernetes.yaml:2303:1:  error  trailing spaces (trailing-spaces) ./build/kubernetes.yaml:2305:81:  error  line too long (110 > 80 characters) (line-length) ./build/kubernetes.yaml:2306:81:  error  line too long (126 > 80 characters) (line-length) ./build/kubernetes.yaml:2307:1:  error  trailing spaces (trailing-spaces) ./build/kubernetes.yaml:2309:81:  error  line too long (136 > 80 characters) (line-length) ./build/kubernetes.yaml:2311:1:  error  trailing spaces (trailing-spaces) ./build/kubernetes.yaml:2317:1:  error  trailing spaces (trailing-spaces) ./build/kubernetes.yaml:2324:1:  error  trailing spaces (trailing-spaces) ./build/kubernetes.yaml:2331:1:  error  trailing spaces (trailing-spaces) ./build/kubernetes.yaml:2332:81:  error  line too long (90 > 80 characters) (line-length) ./build/kubernetes.yaml:2334:1:  error  trailing spaces (trailing-spaces) ./build/kubernetes.yaml:2371:81:  error  line too long (109 > 80 characters) (line-length) ./build/kubernetes.yaml:2393:81:  error  line too long (93 > 80 characters) (line-length)  ></body> </Action>
<Action id="29513" issue="19892" author="greg.haskins" type="comment" body="Interesting.  This all works for me on openshift origin v1.5.1.  I wonder if there is a kubernetes version issue.  Ill see what I can do." created="2017-08-07 19:57:55.0" updateauthor="greg.haskins" updated="2017-08-07 19:57:55.0"/>
<Action id="29892" issue="19892" author="harsha544" type="comment" body="If it helps, the K8 version that I was making use of is v1.7.3." created="2017-08-16 08:43:59.0" updateauthor="harsha544" updated="2017-08-16 08:43:59.0"/>
<Action id="29907" issue="19892" author="rblaine95" type="comment" created="2017-08-16 14:44:55.0" updateauthor="rblaine95" updated="2017-08-17 08:07:39.0"> <body><! CDATA After running _kubectl create --f- build/kubernetes.yaml --save-config_ I get this error:   {code:java} $ kubectl create -f build/kubernetes.yaml --save-config error: error converting YAML to JSON: yaml: line 8: could not find expected ':'{code}  I'm running this on a local _oc cluster up_ on Arch Linux. {code:java} $ oc version  oc v3.6.0+c4dd4cf kubernetes v1.6.1+5115d708d7 features: Basic-Auth GSSAPI Kerberos SPNEGO  Server https://127.0.0.1:8443 openshift v3.6.0+c4dd4cf kubernetes v1.6.1+5115d708d7 {code}  I tested  fabric-v1.0.0|https://github.com/chawlanikhil24/hyperledger-fabric-k8s  referenced in  this|https://jira.hyperledger.org/browse/CE-72  Jira ticket. Deployment works fine (just need to unrestrict the restricted scc, create a useroot account on openshift that has anyuid scc assigned to it, and give the pods the `serviceAccountName: useroot` flag before deploying) but the tests fail (probably due to routes or something, haven't gotten that far in the testing yet)  *Edit:* Figured out the issue, the _config.tgz_ hashes weren't being read as a single line, using Atom with multi-cursor package and deleting the end-lines of every. single. config.tgz hash so the hash is on a single line fixed it. All but peer pods deploy, error in OpenShift is about Security Context Constraints.  *Edit:* Opened up the Restricted SCC Set the image version numbers in kubernetes.yaml from latest to x86_64-1.0.1 to fix image pulling errors. All pods are deploying, but the peer/couchdb pods keep crashing.   {code:java} $ oc describe pod peer1-886879254-pg2td  {snip} Events: FirstSeen	LastSeen	Count	From			SubObjectPath			Type		Reason		Message ---------	--------	-----	----			-------------			--------	------		------- 2m		2m		1	default-scheduler					Normal		Scheduled	Successfully assigned peer1-886879254-pg2td to localhost 2m		2m		1	kubelet, localhost	spec.containers{peer1}		Normal		Pulling		pulling image "hyperledger/fabric-peer:x86_64-1.0.1" 2m		2m		1	kubelet, localhost	spec.containers{peer1}		Normal		Pulled		Successfully pulled image "hyperledger/fabric-peer:x86_64-1.0.1" 2m		2m		1	kubelet, localhost	spec.containers{peer1}		Normal		Created		Created container 2m		2m		1	kubelet, localhost	spec.containers{peer1}		Normal		Started		Started container 2m		2m		3	kubelet, localhost	spec.containers{couchdb1}	Normal		Pulled		Container image "hyperledger/fabric-couchdb:x86_64-1.0.1" already present on machine 2m		2m		3	kubelet, localhost	spec.containers{couchdb1}	Normal		Created		Created container 2m		2m		3	kubelet, localhost	spec.containers{couchdb1}	Normal		Started		Started container 1m		1m		1	kubelet, localhost	spec.containers{peer1}		Warning		Unhealthy	Liveness probe failed: dial tcp 172.17.0.4:7051: getsockopt: connection refused 2m		1m		3	kubelet, localhost	spec.containers{peer1}		Warning		Unhealthy	Readiness probe failed: dial tcp 172.17.0.4:7051: getsockopt: connection refused 2m		1m		4	kubelet, localhost	spec.containers{couchdb1}	Warning		BackOff		Back-off restarting failed container 2m		1m		4	kubelet, localhost					Warning		FailedSync	Error syncing pod {code}   ></body> </Action>
<Action id="29944" issue="19892" author="rblaine95" type="comment" created="2017-08-17 08:49:29.0" updateauthor="rblaine95" updated="2017-08-17 08:49:50.0"> <body><! CDATA CouchDB1 Logs: {code:java} **************************************************** WARNING: CouchDB is running in Admin Party mode. This will allow anyone with access to the CouchDB port to access your database. In Docker's default configuration, this is effectively any other container on the same system. Use "-e COUCHDB_USER=admin -e COUCHDB_PASSWORD=password" to set it in "docker run". **************************************************** Configuration Settings:  attachments  compressible_types="text/*, application/javascript, application/json, application/xml, application/octet-stream"  attachments  compression_level="8"  chttpd  backlog="512"  chttpd  bind_address="0.0.0.0"  chttpd  docroot="./share/www"  chttpd  port="5984"  chttpd  socket_options=" {recbuf, 262144}, {sndbuf, 262144}, {nodelay, true} "  cluster  n="1"  cluster  q="8"  compaction_daemon  check_interval="300"  compaction_daemon  min_file_size="131072"  cors  credentials="false"  couch_httpd_auth  allow_persistent_cookies="false"  couch_httpd_auth  auth_cache_size="50"  couch_httpd_auth  authentication_db="_users"  couch_httpd_auth  authentication_redirect="/_utils/session.html"  couch_httpd_auth  iterations="1000"  couch_httpd_auth  require_valid_user="false"  couch_httpd_auth  timeout="600"  couch_httpd_oauth  use_users_db="false"  couch_peruser  delete_dbs="false"  couch_peruser  enable="false"  couchdb  attachment_stream_buffer_size="4096"  couchdb  database_dir="/var/couchdb/data/"  couchdb  default_security="admin_local"  couchdb  delayed_commits="true"  couchdb  file_compression="snappy"  couchdb  max_dbs_open="8000"  couchdb  max_document_size="67108864"  couchdb  os_process_timeout="5000"  couchdb  uri_file="/var/couchdb/data/couch.uri"  couchdb  view_index_dir="/var/couchdb/data/"  csp  enable="true"  daemons  auth_cache="{couch_auth_cache, start_link,   }"  daemons  compaction_daemon="{couch_compaction_daemon, start_link,   }"  daemons  couch_peruser="{couch_peruser, start_link,   }"  daemons  external_manager="{couch_external_manager, start_link,   }"  daemons  httpd="{couch_httpd, start_link,   }"  daemons  index_server="{couch_index_server, start_link,   }"  daemons  os_daemons="{couch_os_daemons, start_link,   }"  daemons  query_servers="{couch_proc_manager, start_link,   }"  daemons  uuids="{couch_uuids, start,   }"  daemons  vhosts="{couch_httpd_vhost, start_link,   }"  database_compaction  checkpoint_after="5242880"  database_compaction  doc_buffer_size="524288"  httpd  allow_jsonp="false"  httpd  authentication_handlers="{couch_httpd_oauth, oauth_authentication_handler}, {couch_httpd_auth, cookie_authentication_handler}, {couch_httpd_auth, default_authentication_handler}"  httpd  bind_address="127.0.0.1"  httpd  default_handler="{couch_httpd_db, handle_request}"  httpd  enable_cors="false"  httpd  port="5986"  httpd  secure_rewrites="true"  httpd  socket_options=" {recbuf, 262144}, {sndbuf, 262144} "  httpd  vhost_global_handlers="_utils, _uuids, _session, _oauth, _users"  httpd_db_handlers  _all_docs="{couch_mrview_http, handle_all_docs_req}"  httpd_db_handlers  _changes="{couch_httpd_db, handle_db_changes_req}"  httpd_db_handlers  _compact="{couch_httpd_db, handle_compact_req}"  httpd_db_handlers  _design="{couch_httpd_db, handle_design_req}"  httpd_db_handlers  _design_docs="{couch_mrview_http, handle_design_docs_req}"  httpd_db_handlers  _local_docs="{couch_mrview_http, handle_local_docs_req}"  httpd_db_handlers  _temp_view="{couch_mrview_http, handle_temp_view_req}"  httpd_db_handlers  _view_cleanup="{couch_mrview_http, handle_cleanup_req}"  httpd_design_handlers  _compact="{couch_mrview_http, handle_compact_req}"  httpd_design_handlers  _info="{couch_mrview_http, handle_info_req}"  httpd_design_handlers  _list="{couch_mrview_show, handle_view_list_req}"  httpd_design_handlers  _rewrite="{couch_httpd_rewrite, handle_rewrite_req}"  httpd_design_handlers  _show="{couch_mrview_show, handle_doc_show_req}"  httpd_design_handlers  _update="{couch_mrview_show, handle_doc_update_req}"  httpd_design_handlers  _view="{couch_mrview_http, handle_view_req}"  httpd_design_handlers  _view_changes="{couch_mrview_http, handle_view_changes_req}"  httpd_global_handlers  /="{couch_httpd_misc_handlers, handle_welcome_req, <<\"Welcome\">>}"  httpd_global_handlers  _active_tasks="{couch_httpd_misc_handlers, handle_task_status_req}"  httpd_global_handlers  _all_dbs="{couch_httpd_misc_handlers, handle_all_dbs_req}"  httpd_global_handlers  _config="{couch_httpd_misc_handlers, handle_config_req}"  httpd_global_handlers  _oauth="{couch_httpd_oauth, handle_oauth_req}"  httpd_global_handlers  _plugins="{couch_plugins_httpd, handle_req}"  httpd_global_handlers  _replicate="{couch_replicator_httpd, handle_req}"  httpd_global_handlers  _restart="{couch_httpd_misc_handlers, handle_restart_req}"  httpd_global_handlers  _session="{couch_httpd_auth, handle_session_req}"  httpd_global_handlers  _stats="{couch_stats_httpd, handle_stats_req}"  httpd_global_handlers  _system="{chttpd_misc, handle_system_req}"  httpd_global_handlers  _utils="{couch_httpd_misc_handlers, handle_utils_dir_req, \"./share/www\"}"  httpd_global_handlers  _uuids="{couch_httpd_misc_handlers, handle_uuids_req}"  httpd_global_handlers  favicon.ico="{couch_httpd_misc_handlers, handle_favicon_req, \"./share/www\"}"  indexers  couch_mrview="true"  log  level="debug"  log  writer="stderr"  native_query_servers  query="{mango_native_proc, start_link,   }"  query_server_config  os_process_limit="25"  query_server_config  reduce_limit="true"  query_servers  coffeescript="./bin/couchjs ./share/server/main-coffee.js"  query_servers  javascript="./bin/couchjs ./share/server/main.js"  replicator  connection_timeout="30000"  replicator  http_connections="20"  replicator  max_replication_retry_count="10"  replicator  retries_per_request="10"  replicator  socket_options=" {keepalive, true}, {nodelay, false} "  replicator  ssl_certificate_max_depth="3"  replicator  start_delay="0"  replicator  start_splay="0"  replicator  verify_ssl_certificates="false"  replicator  worker_batch_size="500"  replicator  worker_processes="4"  ssl  port="6984"  uuids  algorithm="sequential"  uuids  max_count="1000"  vendor  name="The Apache Software Foundation"  view_compaction  keyvalue_buffer_size="2097152"  debug  2017-08-17T08:42:37.930684Z nonode@nohost <0.105.0> -------- Supervisor couch_log_sup started couch_log_monitor:start_link() at pid <0.108.0>  debug  2017-08-17T08:42:37.932406Z nonode@nohost <0.105.0> -------- Supervisor couch_log_sup started config_listener_mon:start_link(couch_log_sup, nil) at pid <0.109.0>  info  2017-08-17T08:42:37.932430Z nonode@nohost <0.7.0> -------- Application couch_log started on node nonode@nohost  debug  2017-08-17T08:42:37.933615Z nonode@nohost <0.113.0> -------- Supervisor folsom_sup started folsom_sample_slide_sup:start_link() at pid <0.114.0>  debug  2017-08-17T08:42:37.934661Z nonode@nohost <0.113.0> -------- Supervisor folsom_sup started folsom_meter_timer_server:start_link() at pid <0.115.0>  debug  2017-08-17T08:42:37.935688Z nonode@nohost <0.113.0> -------- Supervisor folsom_sup started folsom_metrics_histogram_ets:start_link() at pid <0.116.0>  info  2017-08-17T08:42:37.935835Z nonode@nohost <0.7.0> -------- Application folsom started on node nonode@nohost  debug  2017-08-17T08:42:37.959086Z nonode@nohost <0.120.0> -------- Supervisor couch_stats_sup started couch_stats_aggregator:start_link() at pid <0.121.0>  debug  2017-08-17T08:42:37.961394Z nonode@nohost <0.120.0> -------- Supervisor couch_stats_sup started couch_stats_process_tracker:start_link() at pid <0.171.0>  info  2017-08-17T08:42:37.961551Z nonode@nohost <0.7.0> -------- Application couch_stats started on node nonode@nohost  info  2017-08-17T08:42:37.961694Z nonode@nohost <0.7.0> -------- Application khash started on node nonode@nohost  debug  2017-08-17T08:42:37.965901Z nonode@nohost <0.176.0> -------- Supervisor couch_event_sup2 started couch_event_server:start_link() at pid <0.177.0>  debug  2017-08-17T08:42:37.967072Z nonode@nohost <0.179.0> -------- Supervisor couch_event_os_sup started config_listener_mon:start_link(couch_event_os_sup, nil) at pid <0.180.0>  debug  2017-08-17T08:42:37.967137Z nonode@nohost <0.176.0> -------- Supervisor couch_event_sup2 started couch_event_os_sup:start_link() at pid <0.179.0>  info  2017-08-17T08:42:37.967332Z nonode@nohost <0.7.0> -------- Application couch_event started on node nonode@nohost  debug  2017-08-17T08:42:37.972488Z nonode@nohost <0.184.0> -------- Supervisor ibrowse_sup started ibrowse:start_link() at pid <0.185.0>  info  2017-08-17T08:42:37.972643Z nonode@nohost <0.7.0> -------- Application ibrowse started on node nonode@nohost  debug  2017-08-17T08:42:37.975004Z nonode@nohost <0.190.0> -------- Supervisor ioq_sup started config_listener_mon:start_link(ioq_sup, nil) at pid <0.191.0>  debug  2017-08-17T08:42:37.976448Z nonode@nohost <0.190.0> -------- Supervisor ioq_sup started ioq:start_link() at pid <0.192.0>  info  2017-08-17T08:42:37.976586Z nonode@nohost <0.7.0> -------- Application ioq started on node nonode@nohost  info  2017-08-17T08:42:37.976718Z nonode@nohost <0.7.0> -------- Application mochiweb started on node nonode@nohost  info  2017-08-17T08:42:37.976836Z nonode@nohost <0.7.0> -------- Application oauth started on node nonode@nohost  info  2017-08-17T08:42:37.982584Z nonode@nohost <0.198.0> -------- Apache CouchDB 2.0.0 is starting.   info  2017-08-17T08:42:37.982652Z nonode@nohost <0.199.0> -------- Starting couch_sup  debug  2017-08-17T08:42:37.982827Z nonode@nohost <0.199.0> -------- Supervisor couch_sup started config_listener_mon:start_link(couch_sup, nil) at pid <0.200.0>  debug  2017-08-17T08:42:37.991983Z nonode@nohost <0.201.0> -------- Supervisor couch_primary_services started couch_drv:start_link() at pid <0.202.0>  debug  2017-08-17T08:42:37.993662Z nonode@nohost <0.201.0> -------- Supervisor couch_primary_services started couch_task_status:start_link() at pid <0.203.0>  debug  2017-08-17T08:42:37.998419Z nonode@nohost <0.201.0> -------- Supervisor couch_primary_services started couch_server:sup_start_link() at pid <0.204.0>  debug  2017-08-17T08:42:37.998494Z nonode@nohost <0.199.0> -------- Supervisor couch_sup started couch_primary_sup:start_link() at pid <0.201.0>  debug  2017-08-17T08:42:38.001130Z nonode@nohost <0.207.0> -------- Supervisor couch_secondary_services started gen_event:start_link({local,couch_plugin}) at pid <0.208.0>  debug  2017-08-17T08:42:38.003346Z nonode@nohost <0.207.0> -------- Supervisor couch_secondary_services started couch_proc_manager:start_link() at pid <0.209.0>  debug  2017-08-17T08:42:38.006049Z nonode@nohost <0.207.0> -------- Supervisor couch_secondary_services started couch_peruser:start_link() at pid <0.211.0>  debug  2017-08-17T08:42:38.012413Z nonode@nohost <0.207.0> -------- Supervisor couch_secondary_services started couch_index_server:start_link() at pid <0.212.0>  notice  2017-08-17T08:42:38.017081Z nonode@nohost <0.82.0> -------- config:  couchdb  uuid set to 5d605d084b9dba41a64fc93929813fe1 for reason nil  error  2017-08-17T08:42:38.018578Z nonode@nohost <0.82.0> -------- gen_server config terminated with reason: no match of right hand value {error,eacces} at config_writer:save_to_file/2(line:38) <= config:handle_call/3(line:222) <= gen_server:try_handle_call/4(line:629) <= gen_server:handle_msg/5(line:661) <= proc_lib:init_p_do_apply/3(line:240) last msg: {set,"couchdb","uuid","5d605d084b9dba41a64fc93929813fe1",true,nil} state: {config,  , "/opt/couchdb/bin/../etc/default.ini","/opt/couchdb/bin/../etc/local.ini","/opt/couchdb/bin/../etc/local.d/local.ini" ,"/opt/couchdb/bin/../etc/local.d/local.ini"}  error  2017-08-17T08:42:38.020080Z nonode@nohost <0.82.0> -------- CRASH REPORT Process config (<0.82.0>) with 0 neighbors exited with reason: no match of right hand value {error,eacces} at config_writer:save_to_file/2(line:38) <= config:handle_call/3(line:222) <= gen_server:try_handle_call/4(line:629) <= gen_server:handle_msg/5(line:661) <= proc_lib:init_p_do_apply/3(line:240) at gen_server:terminate/7(line:826) <= proc_lib:init_p_do_apply/3(line:240); initial_call: {config,init, 'Argument__1' }, ancestors:  config_sup,<0.80.0> , messages:   , links:  <0.81.0> , dictionary:   , trap_exit: false, status: running, heap_size: 6772, stack_size: 27, reductions: 82113  error  2017-08-17T08:42:38.020335Z nonode@nohost <0.81.0> -------- Supervisor config_sup had child config started with config:start_link( "/opt/couchdb/bin/../etc/default.ini","/opt/couchdb/bin/../etc/local.ini","/opt/couchdb/bin/../..." ) at <0.82.0> exit with reason no match of right hand value {error,eacces} at config_writer:save_to_file/2(line:38) <= config:handle_call/3(line:222) <= gen_server:try_handle_call/4(line:629) <= gen_server:handle_msg/5(line:661) <= proc_lib:init_p_do_apply/3(line:240) in context child_terminated  error  2017-08-17T08:42:38.020527Z nonode@nohost <0.207.0> -------- Supervisor couch_secondary_services had child httpd started with couch_httpd:start_link() at undefined exit with reason {'EXIT',{{{badmatch,{error,eacces}}, {config_writer,save_to_file,2, {file,"src/config_writer.erl"},{line,38} },{config,handle_call,3, {file,"src/config.erl"},{line,222} },{gen_server,try_handle_call,4, {file,"gen_server.erl"},{line,629} },{gen_server,handle_msg,5, {file,"gen_server.erl"},{line,661} },{proc_lib,init_p_do_apply,3, {file,"proc_lib.erl"},{line,240} } },{gen_server,call, config,{set,"couchdb","uuid","5d605d084b9dba41a64fc93929813fe1",true,nil} }}} in context start_error  error  2017-08-17T08:42:38.020768Z nonode@nohost <0.199.0> -------- Supervisor couch_sup had child couch_secondary_services started with couch_secondary_sup:start_link() at undefined exit with reason {shutdown,{failed_to_start_child,httpd,{'EXIT',{{{badmatch,{error,eacces}}, {config_writer,save_to_file,2, {file,"src/config_writer.erl"},{line,38} },{config,handle_call,3, {file,"src/config.erl"},{line,222} },{gen_server,try_handle_call,4, {file,"gen_server.erl"},{line,629} },{gen_server,handle_msg,5, {file,"gen_server.erl"},{line,661} },{proc_lib,init_p_do_apply,3, {file,"proc_lib.erl"},{line,240} } },{gen_server,call, config,{set,"couchdb","uuid","5d605d084b9dba41a64fc93929813fe1",true,nil} }}}}} in context start_error  error  2017-08-17T08:42:38.021063Z nonode@nohost <0.198.0> -------- Error starting Apache CouchDB:  {error,{shutdown,{failed_to_start_child,couch_secondary_services,{shutdown,{failed_to_start_child,httpd,{'EXIT',{{{badmatch,{error,eacces}}, {config_writer,save_to_file,2, {file,"src/config_writer.erl"},{line,38} },{config,handle_call,3, {file,"src/config.erl"},{line,222} },{gen_server,try_handle_call,4, {file,"gen_server.erl"},{line,629} },{gen_server,handle_msg,5, {file,"gen_server.erl"},{line,661} },{proc_lib,init_p_do_apply,3, {file,"proc_lib.erl"},{line,240} } },{gen_server,call, config,{set,"couchdb","uuid","5d605d084b9dba41a64fc93929813fe1",true,nil} }}}}}}}}    error  2017-08-17T08:42:38.021270Z nonode@nohost <0.197.0> -------- CRASH REPORT Process  (<0.197.0>) with 0 neighbors exited with reason: {{shutdown,{failed_to_start_child,couch_secondary_services,{shutdown,{failed_to_start_child,httpd,{'EXIT',{{{badmatch,{error,eacces}}, {config_writer,save_to_file,2, {file,"src/config_writer.erl"},{line,38} },{config,handle_call,3, {file,"src/config.erl"},{line,222} },{gen_server,try_handle_call,4, {file,"gen_server.erl"},{line,629} },{gen_server,handle_msg,5, {file,"gen_server.erl"},{line,661} },{proc_lib,init_p_do_apply,3, {file,"proc_lib.erl"},{line,240} } },{gen_server,call, config,{set,...} }}}}}}},...} at application_master:init/4(line:134) <= proc_lib:init_p_do_apply/3(line:240); initial_call: {application_master,init, 'Argument__1','Argument__2',... }, ancestors:  <0.196.0> , messages:  {'EXIT',<0.198.0>,normal} , links:  <0.196.0>,<0.7.0> , dictionary:   , trap_exit: true, status: running, heap_size: 987, stack_size: 27, reductions: 151  info  2017-08-17T08:42:38.021582Z nonode@nohost <0.7.0> -------- Application couch exited with reason: {{shutdown,{failed_to_start_child,couch_secondary_services,{shutdown,{failed_to_start_child,httpd,{'EXIT',{{{badmatch,{error,eacces}}, {config_writer,save_to_file,2, {file,"src/config_writer.erl"},{line,38} },{config,handle_call,3, {file,"src/config.erl"},{line,222} },{gen_server,try_handle_call,4, {file,"gen_server.erl"},{line,629} },{gen_server,handle_msg,5, {file,"gen_server.erl"},{line,661} },{proc_lib,init_p_do_apply,3, {file,"proc_lib.erl"},{line,240} } },{gen_server,call, config,{set,...} }}}}}}},...} Configuration Settings:  attachments  compressible_types="text/*, application/javascript, application/json, application/xml, application/octet-stream"  attachments  compression_level="8"  chttpd  backlog="512"  chttpd  bind_address="0.0.0.0"  chttpd  docroot="./share/www"  chttpd  port="5984"  chttpd  socket_options=" {recbuf, 262144}, {sndbuf, 262144}, {nodelay, true} "  cluster  n="1"  cluster  q="8"  compaction_daemon  check_interval="300"  compaction_daemon  min_file_size="131072"  cors  credentials="false"  couch_httpd_auth  allow_persistent_cookies="false"  couch_httpd_auth  auth_cache_size="50"  couch_httpd_auth  authentication_db="_users"  couch_httpd_auth  authentication_redirect="/_utils/session.html"  couch_httpd_auth  iterations="1000"  couch_httpd_auth  require_valid_user="false"  couch_httpd_auth  timeout="600"  couch_httpd_oauth  use_users_db="false"  couch_peruser  delete_dbs="false"  couch_peruser  enable="false"  couchdb  attachment_stream_buffer_size="4096"  couchdb  database_dir="/var/couchdb/data/"  couchdb  default_security="admin_local"  couchdb  delayed_commits="true"  couchdb  file_compression="snappy"  couchdb  max_dbs_open="8000"  couchdb  max_document_size="67108864"  couchdb  os_process_timeout="5000"  couchdb  uri_file="/var/couchdb/data/couch.uri"  couchdb  view_index_dir="/var/couchdb/data/"  csp  enable="true"  daemons  auth_cache="{couch_auth_cache, start_link,   }"  daemons  compaction_daemon="{couch_compaction_daemon, start_link,   }"  daemons  couch_peruser="{couch_peruser, start_link,   }"  daemons  external_manager="{couch_external_manager, start_link,   }"  daemons  httpd="{couch_httpd, start_link,   }"  daemons  index_server="{couch_index_server, start_link,   }"  daemons  os_daemons="{couch_os_daemons, start_link,   }"  daemons  query_servers="{couch_proc_manager, start_link,   }"  daemons  uuids="{couch_uuids, start,   }"  daemons  vhosts="{couch_httpd_vhost, start_link,   }"  database_compaction  checkpoint_after="5242880"  database_compaction  doc_buffer_size="524288"  httpd  allow_jsonp="false"  httpd  authentication_handlers="{couch_httpd_oauth, oauth_authentication_handler}, {couch_httpd_auth, cookie_authentication_handler}, {couch_httpd_auth, default_authentication_handler}"  httpd  bind_address="127.0.0.1"  httpd  default_handler="{couch_httpd_db, handle_request}"  httpd  enable_cors="false"  httpd  port="5986"  httpd  secure_rewrites="true"  httpd  socket_options=" {recbuf, 262144}, {sndbuf, 262144} "  httpd  vhost_global_handlers="_utils, _uuids, _session, _oauth, _users"  httpd_db_handlers  _all_docs="{couch_mrview_http, handle_all_docs_req}"  httpd_db_handlers  _changes="{couch_httpd_db, handle_db_changes_req}"  httpd_db_handlers  _compact="{couch_httpd_db, handle_compact_req}"  httpd_db_handlers  _design="{couch_httpd_db, handle_design_req}"  httpd_db_handlers  _design_docs="{couch_mrview_http, handle_design_docs_req}"  httpd_db_handlers  _local_docs="{couch_mrview_http, handle_local_docs_req}"  httpd_db_handlers  _temp_view="{couch_mrview_http, handle_temp_view_req}"  httpd_db_handlers  _view_cleanup="{couch_mrview_http, handle_cleanup_req}"  httpd_design_handlers  _compact="{couch_mrview_http, handle_compact_req}"  httpd_design_handlers  _info="{couch_mrview_http, handle_info_req}"  httpd_design_handlers  _list="{couch_mrview_show, handle_view_list_req}"  httpd_design_handlers  _rewrite="{couch_httpd_rewrite, handle_rewrite_req}"  httpd_design_handlers  _show="{couch_mrview_show, handle_doc_show_req}"  httpd_design_handlers  _update="{couch_mrview_show, handle_doc_update_req}"  httpd_design_handlers  _view="{couch_mrview_http, handle_view_req}"  httpd_design_handlers  _view_changes="{couch_mrview_http, handle_view_changes_req}"  httpd_global_handlers  /="{couch_httpd_misc_handlers, handle_welcome_req, <<\"Welcome\">>}"  httpd_global_handlers  _active_tasks="{couch_httpd_misc_handlers, handle_task_status_req}"  httpd_global_handlers  _all_dbs="{couch_httpd_misc_handlers, handle_all_dbs_req}"  httpd_global_handlers  _config="{couch_httpd_misc_handlers, handle_config_req}"  httpd_global_handlers  _oauth="{couch_httpd_oauth, handle_oauth_req}"  httpd_global_handlers  _plugins="{couch_plugins_httpd, handle_req}"  httpd_global_handlers  _replicate="{couch_replicator_httpd, handle_req}"  httpd_global_handlers  _restart="{couch_httpd_misc_handlers, handle_restart_req}"  httpd_global_handlers  _session="{couch_httpd_auth, handle_session_req}"  httpd_global_handlers  _stats="{couch_stats_httpd, handle_stats_req}"  httpd_global_handlers  _system="{chttpd_misc, handle_system_req}"  httpd_global_handlers  _utils="{couch_httpd_misc_handlers, handle_utils_dir_req, \"./share/www\"}"  httpd_global_handlers  _uuids="{couch_httpd_misc_handlers, handle_uuids_req}"  httpd_global_handlers  favicon.ico="{couch_httpd_misc_handlers, handle_favicon_req, \"./share/www\"}"  indexers  couch_mrview="true"  log  level="debug"  log  writer="stderr"  native_query_servers  query="{mango_native_proc, start_link,   }"  query_server_config  os_process_limit="25"  query_server_config  reduce_limit="true"  query_servers  coffeescript="./bin/couchjs ./share/server/main-coffee.js"  query_servers  javascript="./bin/couchjs ./share/server/main.js"  replicator  connection_timeout="30000"  replicator  http_connections="20"  replicator  max_replication_retry_count="10"  replicator  retries_per_request="10"  replicator  socket_options=" {keepalive, true}, {nodelay, false} "  replicator  ssl_certificate_max_depth="3"  replicator  start_delay="0"  replicator  start_splay="0"  replicator  verify_ssl_certificates="false"  replicator  worker_batch_size="500"  replicator  worker_processes="4"  ssl  port="6984"  uuids  algorithm="sequential"  uuids  max_count="1000"  vendor  name="The Apache Software Foundation"  view_compaction  keyvalue_buffer_size="2097152"  os_mon  memory supervisor port (memsup): Erlang has closed  os_mon  cpu supervisor port (cpu_sup): Erlang has closed {"Kernel pid terminated",application_controller,"{application_start_failure,couch,{{shutdown,{failed_to_start_child,couch_secondary_services,{shutdown,{failed_to_start_child,httpd,{'EXIT',{{{badmatch,{error,eacces}}, {config_writer,save_to_file,2, {file,\"src/config_writer.erl\"},{line,38} },{config,handle_call,3, {file,\"src/config.erl\"},{line,222} },{gen_server,try_handle_call,4, {file,\"gen_server.erl\"},{line,629} },{gen_server,handle_msg,5, {file,\"gen_server.erl\"},{line,661} },{proc_lib,init_p_do_apply,3, {file,\"proc_lib.erl\"},{line,240} } },{gen_server,call, config,{set,\"couchdb\",\"uuid\",\"5d605d084b9dba41a64fc93929813fe1\",true,nil} }}}}}}},{couch_app,start, normal,   }}}"} {code} Peer1 logs: {code:java} 2017-08-17 08:47:30.630 UTC  nodeCmd  serve -> INFO 001 Starting peer: Version: 1.0.1 Go version: go1.7.5 OS/Arch: linux/amd64 Chaincode: Base Image Version: 0.3.1 Base Docker Namespace: hyperledger Base Docker Label: org.hyperledger.fabric Docker Namespace: hyperledger  2017-08-17 08:47:30.630 UTC  ledgermgmt  initialize -> INFO 002 Initializing ledger mgmt 2017-08-17 08:47:30.630 UTC  kvledger  NewProvider -> INFO 003 Initializing ledger provider 2017-08-17 08:47:30.630 UTC  kvledger.util  CreateDirIfMissing -> DEBU 004 CreateDirIfMissing  /var/hyperledger/fabric/peer/ledgersData/ledgerProvider/  2017-08-17 08:47:30.630 UTC  kvledger.util  logDirStatus -> DEBU 005 Before creating dir -  /var/hyperledger/fabric/peer/ledgersData/ledgerProvider/  exists 2017-08-17 08:47:30.630 UTC  kvledger.util  logDirStatus -> DEBU 006 After creating dir -  /var/hyperledger/fabric/peer/ledgersData/ledgerProvider/  exists 2017-08-17 08:47:30.633 UTC  kvledger.util  CreateDirIfMissing -> DEBU 007 CreateDirIfMissing  /var/hyperledger/fabric/peer/ledgersData/chains/index/  2017-08-17 08:47:30.633 UTC  kvledger.util  logDirStatus -> DEBU 008 Before creating dir -  /var/hyperledger/fabric/peer/ledgersData/chains/index/  exists 2017-08-17 08:47:30.633 UTC  kvledger.util  logDirStatus -> DEBU 009 After creating dir -  /var/hyperledger/fabric/peer/ledgersData/chains/index/  exists 2017-08-17 08:47:30.633 UTC  kvledger  NewProvider -> DEBU 00a Constructing CouchDB VersionedDBProvider 2017-08-17 08:47:30.633 UTC  statecouchdb  NewVersionedDBProvider -> DEBU 00b constructing CouchDB VersionedDBProvider 2017-08-17 08:47:30.634 UTC  couchdb  CreateConnectionDefinition -> DEBU 00c Entering CreateConnectionDefinition() 2017-08-17 08:47:30.634 UTC  couchdb  CreateConnectionDefinition -> DEBU 00d Created database configuration  URL= http://127.0.0.1:5984  2017-08-17 08:47:30.634 UTC  couchdb  CreateConnectionDefinition -> DEBU 00e Exiting CreateConnectionDefinition() 2017-08-17 08:47:30.634 UTC  couchdb  VerifyCouchConfig -> DEBU 00f Entering VerifyCouchConfig() 2017-08-17 08:47:30.634 UTC  couchdb  handleRequest -> DEBU 010 Entering handleRequest()  method=GET  url=http://127.0.0.1:5984/ 2017-08-17 08:47:30.634 UTC  couchdb  handleRequest -> DEBU 011 HTTP Request: GET / HTTP/1.1 | Host: 127.0.0.1:5984 | User-Agent: Go-http-client/1.1 | Accept: multipart/related | Accept-Encoding: gzip |  |  2017-08-17 08:47:30.635 UTC  couchdb  handleRequest -> WARN 012 Retrying couchdb request in 125ms. Attempt:1  Error:Get http://127.0.0.1:5984/: dial tcp 127.0.0.1:5984: getsockopt: connection refused 2017-08-17 08:47:30.761 UTC  couchdb  handleRequest -> DEBU 013 HTTP Request: GET / HTTP/1.1 | Host: 127.0.0.1:5984 | User-Agent: Go-http-client/1.1 | Accept: multipart/related | Accept-Encoding: gzip |  |  2017-08-17 08:47:30.761 UTC  couchdb  handleRequest -> WARN 014 Retrying couchdb request in 250ms. Attempt:2  Error:Get http://127.0.0.1:5984/: dial tcp 127.0.0.1:5984: getsockopt: connection refused 2017-08-17 08:47:31.012 UTC  couchdb  handleRequest -> DEBU 015 HTTP Request: GET / HTTP/1.1 | Host: 127.0.0.1:5984 | User-Agent: Go-http-client/1.1 | Accept: multipart/related | Accept-Encoding: gzip |  |  2017-08-17 08:47:31.012 UTC  couchdb  handleRequest -> WARN 016 Retrying couchdb request in 500ms. Attempt:3  Error:Get http://127.0.0.1:5984/: dial tcp 127.0.0.1:5984: getsockopt: connection refused 2017-08-17 08:47:31.512 UTC  couchdb  handleRequest -> DEBU 017 HTTP Request: GET / HTTP/1.1 | Host: 127.0.0.1:5984 | User-Agent: Go-http-client/1.1 | Accept: multipart/related | Accept-Encoding: gzip |  |  2017-08-17 08:47:31.512 UTC  couchdb  handleRequest -> WARN 018 Retrying couchdb request in 1s. Attempt:4  Error:Get http://127.0.0.1:5984/: dial tcp 127.0.0.1:5984: getsockopt: connection refused 2017-08-17 08:47:32.512 UTC  couchdb  handleRequest -> DEBU 019 HTTP Request: GET / HTTP/1.1 | Host: 127.0.0.1:5984 | User-Agent: Go-http-client/1.1 | Accept: multipart/related | Accept-Encoding: gzip |  |  2017-08-17 08:47:32.513 UTC  couchdb  handleRequest -> WARN 01a Retrying couchdb request in 2s. Attempt:5  Error:Get http://127.0.0.1:5984/: dial tcp 127.0.0.1:5984: getsockopt: connection refused 2017-08-17 08:47:34.513 UTC  couchdb  handleRequest -> DEBU 01b HTTP Request: GET / HTTP/1.1 | Host: 127.0.0.1:5984 | User-Agent: Go-http-client/1.1 | Accept: multipart/related | Accept-Encoding: gzip |  |  2017-08-17 08:47:34.513 UTC  couchdb  handleRequest -> WARN 01c Retrying couchdb request in 4s. Attempt:6  Error:Get http://127.0.0.1:5984/: dial tcp 127.0.0.1:5984: getsockopt: connection refused 2017-08-17 08:47:38.513 UTC  couchdb  handleRequest -> DEBU 01d HTTP Request: GET / HTTP/1.1 | Host: 127.0.0.1:5984 | User-Agent: Go-http-client/1.1 | Accept: multipart/related | Accept-Encoding: gzip |  |  2017-08-17 08:47:38.514 UTC  couchdb  handleRequest -> WARN 01e Retrying couchdb request in 8s. Attempt:7  Error:Get http://127.0.0.1:5984/: dial tcp 127.0.0.1:5984: getsockopt: connection refused 2017-08-17 08:47:46.514 UTC  couchdb  handleRequest -> DEBU 01f HTTP Request: GET / HTTP/1.1 | Host: 127.0.0.1:5984 | User-Agent: Go-http-client/1.1 | Accept: multipart/related | Accept-Encoding: gzip |  |  2017-08-17 08:47:46.514 UTC  couchdb  handleRequest -> WARN 020 Retrying couchdb request in 16s. Attempt:8  Error:Get http://127.0.0.1:5984/: dial tcp 127.0.0.1:5984: getsockopt: connection refused 2017-08-17 08:48:02.514 UTC  couchdb  handleRequest -> DEBU 021 HTTP Request: GET / HTTP/1.1 | Host: 127.0.0.1:5984 | User-Agent: Go-http-client/1.1 | Accept: multipart/related | Accept-Encoding: gzip |  |  2017-08-17 08:48:02.514 UTC  couchdb  handleRequest -> WARN 022 Retrying couchdb request in 32s. Attempt:9 Error:Get http://127.0.0.1:5984/: dial tcp 127.0.0.1:5984: getsockopt: connection refused {code}  ></body> </Action>
<Action id="43026" issue="19892" author="mrkiouak" type="comment" body="Stripping all special characters from the couchdb configmap solved this issue for me. It is not clear to me what introduced the error, however I was using atom as my editor, which I see mentioned above. I suspect there is some issue between atom, k8s configmap parsing &amp; couchdb erlang configwriter proc." created="2018-04-16 21:13:19.0" updateauthor="mrkiouak" updated="2018-04-16 21:13:19.0"/>
<Action id="59049" issue="19892" author="mastersingh24" type="comment" body="We can open something separate if we really want to do something broader for Kube support" created="2019-04-09 08:46:41.0" updateauthor="mastersingh24" updated="2019-04-09 08:46:41.0"/>
