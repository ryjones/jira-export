<Action id="50104" issue="33581" author="sykesm" type="comment" created="2018-09-07 17:43:17.0" updateauthor="sykesm" updated="2018-09-07 17:43:17.0"> <body><! CDATA Additional races: {code:java} ================== WARNING: DATA RACE Write at 0x00c0001901a0 by goroutine 62:   github.com/hyperledger/fabric/core/deliverservice.(*broadcastClient).Disconnect()       /Users/sykesm/workspace/fabric/src/github.com/hyperledger/fabric/core/deliverservice/client.go:235 +0x1f3   github.com/hyperledger/fabric/core/deliverservice/blocksprovider.(*blocksProviderImpl).UpdateOrderingEndpoints()       /Users/sykesm/workspace/fabric/src/github.com/hyperledger/fabric/core/deliverservice/blocksprovider/blocksprovider.go:216 +0x216   github.com/hyperledger/fabric/core/deliverservice.(*deliverServiceImpl).UpdateEndpoints()       /Users/sykesm/workspace/fabric/src/github.com/hyperledger/fabric/core/deliverservice/deliveryclient.go:115 +0x216   github.com/hyperledger/fabric/core/deliverservice.TestDeliverServiceUpdateEndpoints()       /Users/sykesm/workspace/fabric/src/github.com/hyperledger/fabric/core/deliverservice/deliveryclient_test.go:288 +0x603   testing.tRunner()       /usr/local/Cellar/go/1.11/libexec/src/testing/testing.go:827 +0x162   Previous read at 0x00c0001901a0 by goroutine 79:   github.com/hyperledger/fabric/core/deliverservice.(*broadcastClient).doAction()       /Users/sykesm/workspace/fabric/src/github.com/hyperledger/fabric/core/deliverservice/client.go:113 +0x42   github.com/hyperledger/fabric/core/deliverservice.(*broadcastClient).try()       /Users/sykesm/workspace/fabric/src/github.com/hyperledger/fabric/core/deliverservice/client.go:91 +0x24f   github.com/hyperledger/fabric/core/deliverservice.(*broadcastClient).Recv()       /Users/sykesm/workspace/fabric/src/github.com/hyperledger/fabric/core/deliverservice/client.go:58 +0x5f   github.com/hyperledger/fabric/core/deliverservice/blocksprovider.(*blocksProviderImpl).DeliverBlocks()       /Users/sykesm/workspace/fabric/src/github.com/hyperledger/fabric/core/deliverservice/blocksprovider/blocksprovider.go:125 +0xf0   github.com/hyperledger/fabric/core/deliverservice.(*deliverServiceImpl).launchBlockProvider()       /Users/sykesm/workspace/fabric/src/github.com/hyperledger/fabric/core/deliverservice/deliveryclient.go:174 +0xfb   Goroutine 62 (running) created at:   testing.(*T).Run()       /usr/local/Cellar/go/1.11/libexec/src/testing/testing.go:878 +0x650   testing.runTests.func1()       /usr/local/Cellar/go/1.11/libexec/src/testing/testing.go:1119 +0xa8   testing.tRunner()       /usr/local/Cellar/go/1.11/libexec/src/testing/testing.go:827 +0x162   testing.runTests()       /usr/local/Cellar/go/1.11/libexec/src/testing/testing.go:1117 +0x4ee   testing.(*M).Run()       /usr/local/Cellar/go/1.11/libexec/src/testing/testing.go:1034 +0x2ee   main.main()       _testmain.go:94 +0x221   Goroutine 79 (running) created at:   github.com/hyperledger/fabric/core/deliverservice.(*deliverServiceImpl).StartDeliverForChannel()       /Users/sykesm/workspace/fabric/src/github.com/hyperledger/fabric/core/deliverservice/deliveryclient.go:161 +0x7f5   github.com/hyperledger/fabric/core/deliverservice.TestDeliverServiceUpdateEndpoints()       /Users/sykesm/workspace/fabric/src/github.com/hyperledger/fabric/core/deliverservice/deliveryclient_test.go:278 +0x421   testing.tRunner()       /usr/local/Cellar/go/1.11/libexec/src/testing/testing.go:827 +0x162 ================== ================== WARNING: DATA RACE Write at 0x00c000190190 by goroutine 62:   github.com/hyperledger/fabric/core/deliverservice.(*broadcastClient).Disconnect()       /Users/sykesm/workspace/fabric/src/github.com/hyperledger/fabric/core/deliverservice/client.go:236 +0x219   github.com/hyperledger/fabric/core/deliverservice/blocksprovider.(*blocksProviderImpl).UpdateOrderingEndpoints()       /Users/sykesm/workspace/fabric/src/github.com/hyperledger/fabric/core/deliverservice/blocksprovider/blocksprovider.go:216 +0x216   github.com/hyperledger/fabric/core/deliverservice.(*deliverServiceImpl).UpdateEndpoints()       /Users/sykesm/workspace/fabric/src/github.com/hyperledger/fabric/core/deliverservice/deliveryclient.go:115 +0x216   github.com/hyperledger/fabric/core/deliverservice.TestDeliverServiceUpdateEndpoints()       /Users/sykesm/workspace/fabric/src/github.com/hyperledger/fabric/core/deliverservice/deliveryclient_test.go:288 +0x603   testing.tRunner()       /usr/local/Cellar/go/1.11/libexec/src/testing/testing.go:827 +0x162   Previous read at 0x00c000190190 by goroutine 79:   github.com/hyperledger/fabric/core/deliverservice.(*broadcastClient).Recv.func1()       /Users/sykesm/workspace/fabric/src/github.com/hyperledger/fabric/core/deliverservice/client.go:62 +0xe6   github.com/hyperledger/fabric/core/deliverservice.(*broadcastClient).doAction()       /Users/sykesm/workspace/fabric/src/github.com/hyperledger/fabric/core/deliverservice/client.go:120 +0x5c   github.com/hyperledger/fabric/core/deliverservice.(*broadcastClient).try()       /Users/sykesm/workspace/fabric/src/github.com/hyperledger/fabric/core/deliverservice/client.go:91 +0x24f   github.com/hyperledger/fabric/core/deliverservice.(*broadcastClient).Recv()       /Users/sykesm/workspace/fabric/src/github.com/hyperledger/fabric/core/deliverservice/client.go:58 +0x5f   github.com/hyperledger/fabric/core/deliverservice/blocksprovider.(*blocksProviderImpl).DeliverBlocks()       /Users/sykesm/workspace/fabric/src/github.com/hyperledger/fabric/core/deliverservice/blocksprovider/blocksprovider.go:125 +0xf0   github.com/hyperledger/fabric/core/deliverservice.(*deliverServiceImpl).launchBlockProvider()       /Users/sykesm/workspace/fabric/src/github.com/hyperledger/fabric/core/deliverservice/deliveryclient.go:174 +0xfb   Goroutine 62 (running) created at:   testing.(*T).Run()       /usr/local/Cellar/go/1.11/libexec/src/testing/testing.go:878 +0x650   testing.runTests.func1()       /usr/local/Cellar/go/1.11/libexec/src/testing/testing.go:1119 +0xa8   testing.tRunner()       /usr/local/Cellar/go/1.11/libexec/src/testing/testing.go:827 +0x162   testing.runTests()       /usr/local/Cellar/go/1.11/libexec/src/testing/testing.go:1117 +0x4ee   testing.(*M).Run()       /usr/local/Cellar/go/1.11/libexec/src/testing/testing.go:1034 +0x2ee   main.main()       _testmain.go:94 +0x221   Goroutine 79 (running) created at:   github.com/hyperledger/fabric/core/deliverservice.(*deliverServiceImpl).StartDeliverForChannel()       /Users/sykesm/workspace/fabric/src/github.com/hyperledger/fabric/core/deliverservice/deliveryclient.go:161 +0x7f5   github.com/hyperledger/fabric/core/deliverservice.TestDeliverServiceUpdateEndpoints()       /Users/sykesm/workspace/fabric/src/github.com/hyperledger/fabric/core/deliverservice/deliveryclient_test.go:278 +0x421   testing.tRunner()       /usr/local/Cellar/go/1.11/libexec/src/testing/testing.go:827 +0x162 ================== {code}  ></body> </Action>
<Action id="50105" issue="33581" author="sykesm" type="comment" body="these are on top of master @ 3bd6e845c83acc95b20237e14ce98e6953ada8ca" created="2018-09-07 17:43:49.0" updateauthor="sykesm" updated="2018-09-07 17:43:49.0"/>
<Action id="50111" issue="33581" author="yacovm" type="comment" created="2018-09-07 19:29:52.0" updateauthor="yacovm" updated="2018-09-07 19:29:52.0"> <body><! CDATA {quote}  and previous "tactical" attempts to introduce locking for races hasn't really worked.  {quote}     How about attempts that have no tact such as  https://gerrit.hyperledger.org/r/#/c/26170/  ?  ></body> </Action>
