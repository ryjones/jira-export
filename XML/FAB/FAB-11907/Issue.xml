<Issue id="33581" key="FAB-11907" number="11907" project="10002" reporter="sykesm" assignee="yacovm" creator="sykesm" type="10004" summary="Data races in core/deliverservice TestDisconnectAndDisableEndpoint" priority="3" resolution="10000" status="6" created="2018-09-07 17:41:48.0" updated="2018-09-11 20:26:02.0" resolutiondate="2018-09-11 15:12:22.0" votes="0" watches="3" workflowId="44874"> <description><! CDATA The locking inside of the delivery service client needs a thorough review. The conn and endpoint fields are not consistently referenced with locks and previous "tactical" attempts to introduce locking for races hasn't really worked. {code:java} ================== WARNING: DATA RACE Read at 0x00c000190d70 by goroutine 24:   github.com/hyperledger/fabric/core/deliverservice.(*broadcastClient).doAction()       /Users/sykesm/workspace/fabric/src/github.com/hyperledger/fabric/core/deliverservice/client.go:113 +0x42   github.com/hyperledger/fabric/core/deliverservice.(*broadcastClient).try()       /Users/sykesm/workspace/fabric/src/github.com/hyperledger/fabric/core/deliverservice/client.go:91 +0x24f   github.com/hyperledger/fabric/core/deliverservice.(*broadcastClient).Recv()       /Users/sykesm/workspace/fabric/src/github.com/hyperledger/fabric/core/deliverservice/client.go:58 +0x5f   github.com/hyperledger/fabric/core/deliverservice.TestDisconnectAndDisableEndpoint.func6()       /Users/sykesm/workspace/fabric/src/github.com/hyperledger/fabric/core/deliverservice/client_test.go:718 +0x38   Previous write at 0x00c000190d70 by goroutine 74:   github.com/hyperledger/fabric/core/deliverservice.(*broadcastClient).afterConnect()       /Users/sykesm/workspace/fabric/src/github.com/hyperledger/fabric/core/deliverservice/client.go:169 +0x26b   github.com/hyperledger/fabric/core/deliverservice.(*broadcastClient).connect()       /Users/sykesm/workspace/fabric/src/github.com/hyperledger/fabric/core/deliverservice/client.go:153 +0x624   github.com/hyperledger/fabric/core/deliverservice.(*broadcastClient).doAction()       /Users/sykesm/workspace/fabric/src/github.com/hyperledger/fabric/core/deliverservice/client.go:114 +0x106   github.com/hyperledger/fabric/core/deliverservice.(*broadcastClient).try()       /Users/sykesm/workspace/fabric/src/github.com/hyperledger/fabric/core/deliverservice/client.go:91 +0x24f   github.com/hyperledger/fabric/core/deliverservice.(*broadcastClient).Recv()       /Users/sykesm/workspace/fabric/src/github.com/hyperledger/fabric/core/deliverservice/client.go:58 +0x5f   github.com/hyperledger/fabric/core/deliverservice.TestDisconnectAndDisableEndpoint.func9()       /Users/sykesm/workspace/fabric/src/github.com/hyperledger/fabric/core/deliverservice/client_test.go:742 +0x38   Goroutine 24 (running) created at:   github.com/hyperledger/fabric/core/deliverservice.TestDisconnectAndDisableEndpoint()       /Users/sykesm/workspace/fabric/src/github.com/hyperledger/fabric/core/deliverservice/client_test.go:717 +0x4bc   testing.tRunner()       /usr/local/Cellar/go/1.11/libexec/src/testing/testing.go:827 +0x162   Goroutine 74 (running) created at:   github.com/hyperledger/fabric/core/deliverservice.TestDisconnectAndDisableEndpoint()       /Users/sykesm/workspace/fabric/src/github.com/hyperledger/fabric/core/deliverservice/client_test.go:741 +0x6c9   testing.tRunner()       /usr/local/Cellar/go/1.11/libexec/src/testing/testing.go:827 +0x162 ================== {code}  ~yacovm , this might be something you want to review.  ></description> </Issue>
