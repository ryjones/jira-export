<Issue id="38080" key="FAB-14413" number="14413" project="10002" reporter="guoger" assignee="guoger" creator="guoger" type="10004" summary="Flaky integration test:  EndToEnd reconfiguration and onboarding when an orderer node is joined  It  isn&apos;t influenced by outdated orderer" priority="3" resolution="10000" status="6" created="2019-02-28 09:13:50.0" updated="2019-03-19 10:57:38.0" resolutiondate="2019-03-07 16:44:22.0" votes="0" watches="3" workflowId="49700"> <description><! CDATA h2. Problem Statement As the integration test suggests: - cluster contains <1, 2, 3, 4> - <1, 2, 3> are started - add <5> - kill <1, 2, 3> - start <4> - start <1, 2, 3> - if <5> is elected as new leader, <4> will never be able to participate in cluster, because it does not know the addition of <5>, and does not have its certificate to communicate with leader (<5>)  h2. Solution Send artificial signal via `snapC` during eviction suspicion, to trigger catchup   h2. Background  https://jenkins.hyperledger.org/job/fabric-verify-integration-tests-x86_64/6356/consoleFull   The apparent reason of this failure is that {{orderer4}} does not receive any msg from leader {{orderer5}} (orderer1new), and stays in Candidate state indefinitely, while performing periodical campaign and eviction suspicion.  Although the reason behind that is yet to be found. An interesting pattern i observed by skimming over the log is: {code:java}  e  OrdererOrg.orderer1new  2019-02-28 07:31:45.016 UTC  orderer.consensus.etcdraft  logSendFailure -> ERRO 0b1 Failed to send StepRequest to 4, because: aborted channel=systemchannel node=5  e  OrdererOrg.orderer1new  2019-02-28 07:31:45.517 UTC  orderer.consensus.etcdraft  send -> INFO 0b2 Successfully sent StepRequest to 4 after failed attempt(s) channel=systemchannel node=5  e  OrdererOrg.orderer4  2019-02-28 07:31:45.518 UTC  comm.grpc.server  1 -> INFO 0f1 streaming call completed grpc.service=orderer.Cluster grpc.method=Step grpc.peer_address=127.0.0.1:52624 grpc.peer_subject="CN=orderer1new.example.com,L=San Francisco,ST=California,C=US" error="certificate extracted from TLS connection isn't authorized" grpc.code=Unknown grpc.call_duration=321.679µs  e  OrdererOrg.orderer1new  2019-02-28 07:31:46.516 UTC  orderer.consensus.etcdraft  logSendFailure -> ERRO 0b3 Failed to send StepRequest to 4, because: aborted channel=systemchannel node=5  e  OrdererOrg.orderer1new  2019-02-28 07:31:47.018 UTC  orderer.consensus.etcdraft  send -> INFO 0b4 Successfully sent StepRequest to 4 after failed attempt(s) channel=systemchannel node=5  e  OrdererOrg.orderer4  2019-02-28 07:31:47.019 UTC  comm.grpc.server  1 -> INFO 116 streaming call completed grpc.service=orderer.Cluster grpc.method=Step grpc.peer_address=127.0.0.1:52624 grpc.peer_subject="CN=orderer1new.example.com,L=San Francisco,ST=California,C=US" error="certificate extracted from TLS connection isn't authorized" grpc.code=Unknown grpc.call_duration=258.742µs  e  OrdererOrg.orderer1new  2019-02-28 07:31:48.017 UTC  orderer.consensus.etcdraft  logSendFailure -> ERRO 0b5 Failed to send StepRequest to 4, because: aborted channel=systemchannel node=5  e  OrdererOrg.orderer1new  2019-02-28 07:31:48.517 UTC  orderer.consensus.etcdraft  send -> INFO 0b6 Successfully sent StepRequest to 4 after failed attempt(s) channel=systemchannel node=5  e  OrdererOrg.orderer4  2019-02-28 07:31:48.518 UTC  comm.grpc.server  1 -> INFO 156 streaming call completed grpc.service=orderer.Cluster grpc.method=Step grpc.peer_address=127.0.0.1:52624 grpc.peer_subject="CN=orderer1new.example.com,L=San Francisco,ST=California,C=US" error="certificate extracted from TLS connection isn't authorized" grpc.code=Unknown grpc.call_duration=235.413µs  e  OrdererOrg.orderer1new  2019-02-28 07:31:49.516 UTC  orderer.consensus.etcdraft  logSendFailure -> ERRO 0b7 Failed to send StepRequest to 4, because: aborted channel=systemchannel node=5  e  OrdererOrg.orderer1new  2019-02-28 07:31:50.017 UTC  orderer.consensus.etcdraft  send -> INFO 0b8 Successfully sent StepRequest to 4 after failed attempt(s) channel=systemchannel node=5  e  OrdererOrg.orderer4  2019-02-28 07:31:50.017 UTC  comm.grpc.server  1 -> INFO 178 streaming call completed grpc.service=orderer.Cluster grpc.method=Step grpc.peer_address=127.0.0.1:52624 grpc.peer_subject="CN=orderer1new.example.com,L=San Francisco,ST=California,C=US" error="certificate extracted from TLS connection isn't authorized" grpc.code=Unknown grpc.call_duration=331.337µs  e  OrdererOrg.orderer1new  2019-02-28 07:31:51.016 UTC  orderer.consensus.etcdraft  logSendFailure -> ERRO 0b9 Failed to send StepRequest to 4, because: aborted channel=systemchannel node=5  e  OrdererOrg.orderer1new  2019-02-28 07:31:51.517 UTC  orderer.consensus.etcdraft  send -> INFO 0ba Successfully sent StepRequest to 4 after failed attempt(s) channel=systemchannel node=5  e  OrdererOrg.orderer4  2019-02-28 07:31:51.518 UTC  comm.grpc.server  1 -> INFO 19d streaming call completed grpc.service=orderer.Cluster grpc.method=Step grpc.peer_address=127.0.0.1:52624 grpc.peer_subject="CN=orderer1new.example.com,L=San Francisco,ST=California,C=US" error="certificate extracted from TLS connection isn't authorized" grpc.code=Unknown grpc.call_duration=272.188µs {code} Every 500ms {{orderer1new}} sends a heartbeat msg to {{orderer4}}, and it regularly failed to send this msg, with success in between. I suspect is that this message is actually not delivered to {{orderer4}}     ></description> </Issue>
