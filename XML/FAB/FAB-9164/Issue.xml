<Issue id="28893" key="FAB-9164" number="9164" project="10002" reporter="sykesm" creator="sykesm" type="10003" summary="Data race in viper between node start and gossip discovery" priority="4" resolution="10200" status="6" created="2018-03-26 15:20:34.0" updated="2018-07-20 14:17:30.0" resolutiondate="2018-07-20 14:05:32.0" votes="0" watches="1" workflowId="43015"> <description><! CDATA {code:java} unit-tests_1  | ==================  unit-tests_1  | WARNING: DATA RACE  unit-tests_1  | Write at 0x00c42016ecc0 by goroutine 66:  unit-tests_1  |   runtime.mapassign_faststr()  unit-tests_1  |       /opt/go/src/runtime/hashmap_fast.go:598 +0x0  unit-tests_1  |   github.com/hyperledger/fabric/vendor/github.com/spf13/viper.(*Viper).Set()  unit-tests_1  |       /opt/gopath/src/github.com/hyperledger/fabric/vendor/github.com/spf13/viper/viper.go:772 +0xc6  unit-tests_1  |   github.com/hyperledger/fabric/vendor/github.com/spf13/viper.Set()  unit-tests_1  |       /opt/gopath/src/github.com/hyperledger/fabric/vendor/github.com/spf13/viper/viper.go:768 +0x72  unit-tests_1  |   github.com/hyperledger/fabric/peer/node.TestComputeChaincodeEndpoint()  unit-tests_1  |       /opt/gopath/src/github.com/hyperledger/fabric/peer/node/start_test.go:149 +0x6d  unit-tests_1  |   testing.tRunner()  unit-tests_1  |       /opt/go/src/testing/testing.go:746 +0x16c  unit-tests_1  |  unit-tests_1  | Previous read at 0x00c42016ecc0 by goroutine 48:  unit-tests_1  |   runtime.mapaccess2_faststr()  unit-tests_1  |       /opt/go/src/runtime/hashmap_fast.go:315 +0x0  unit-tests_1  |   github.com/hyperledger/fabric/vendor/github.com/spf13/viper.(*Viper).find()  unit-tests_1  |       /opt/gopath/src/github.com/hyperledger/fabric/vendor/github.com/spf13/viper/viper.go:628 +0x16d  unit-tests_1  |   github.com/hyperledger/fabric/vendor/github.com/spf13/viper.(*Viper).Get()  unit-tests_1  |       /opt/gopath/src/github.com/hyperledger/fabric/vendor/github.com/spf13/viper/viper.go:407 +0x83a  unit-tests_1  |   github.com/hyperledger/fabric/vendor/github.com/spf13/viper.(*Viper).GetDuration()  unit-tests_1  |       /opt/gopath/src/github.com/hyperledger/fabric/vendor/github.com/spf13/viper/viper.go:481 +0x4c  unit-tests_1  |   github.com/hyperledger/fabric/vendor/github.com/spf13/viper.GetDuration()  unit-tests_1  |       /opt/gopath/src/github.com/hyperledger/fabric/vendor/github.com/spf13/viper/viper.go:479 +0x5e  unit-tests_1  |   github.com/hyperledger/fabric/gossip/util.GetDurationOrDefault()  unit-tests_1  |       /opt/gopath/src/github.com/hyperledger/fabric/gossip/util/misc.go:165 +0x87  unit-tests_1  |   github.com/hyperledger/fabric/gossip/discovery.getReconnectInterval()  unit-tests_1  |       /opt/gopath/src/github.com/hyperledger/fabric/gossip/discovery/discovery_impl.go:1002 +0x51  unit-tests_1  |   github.com/hyperledger/fabric/gossip/discovery.(*gossipDiscoveryImpl).periodicalReconnectToDead()  unit-tests_1  |       /opt/gopath/src/github.com/hyperledger/fabric/gossip/discovery/discovery_impl.go:608 +0x36d unit-tests_1  | Goroutine 66 (running) created at:  unit-tests_1  |   testing.(*T).Run()  unit-tests_1  |       /opt/go/src/testing/testing.go:789 +0x568  unit-tests_1  |   testing.runTests.func1()  unit-tests_1  |       /opt/go/src/testing/testing.go:1004 +0xa7  unit-tests_1  |   testing.tRunner()  unit-tests_1  |       /opt/go/src/testing/testing.go:746 +0x16c  unit-tests_1  |   testing.runTests()  unit-tests_1  |       /opt/go/src/testing/testing.go:1002 +0x521  unit-tests_1  |   testing.(*M).Run()  unit-tests_1  |       /opt/go/src/testing/testing.go:921 +0x206  unit-tests_1  |   main.main()  unit-tests_1  |       github.com/hyperledger/fabric/peer/node/_test/_testmain.go:106 +0x2f0  unit-tests_1  |  unit-tests_1  | Goroutine 48 (running) created at:  unit-tests_1  |   github.com/hyperledger/fabric/gossip/discovery.NewDiscoveryService()  unit-tests_1  |       /opt/gopath/src/github.com/hyperledger/fabric/gossip/discovery/discovery_impl.go:121 +0x9b2  unit-tests_1  |   github.com/hyperledger/fabric/gossip/gossip.NewGossipService()  unit-tests_1  |       /opt/gopath/src/github.com/hyperledger/fabric/gossip/gossip/gossip_impl.go:114 +0x131c  unit-tests_1  |   github.com/hyperledger/fabric/gossip/integration.NewGossipComponent()  unit-tests_1  |       /opt/gopath/src/github.com/hyperledger/fabric/gossip/integration/integration.go:71 +0x1a5 ... unit-tests_1  |       /opt/gopath/src/github.com/hyperledger/fabric/core/ledger/ledgermgmt/ledger_mgmt.go:51 +0x8c  unit-tests_1  |   github.com/hyperledger/fabric/peer/node.serve()  unit-tests_1  |       github.com/hyperledger/fabric/peer/node/_test/_obj_test/start.go:106 +0x1f4  unit-tests_1  |   github.com/hyperledger/fabric/peer/node.glob..func1()  unit-tests_1  |       github.com/hyperledger/fabric/peer/node/_test/_obj_test/start.go:81 +0x68  unit-tests_1  |   github.com/hyperledger/fabric/vendor/github.com/spf13/cobra.(*Command).execute()  unit-tests_1  |       /opt/gopath/src/github.com/hyperledger/fabric/vendor/github.com/spf13/cobra/command.go:698 +0x4ec  unit-tests_1  |   github.com/hyperledger/fabric/vendor/github.com/spf13/cobra.(*Command).ExecuteC()  unit-tests_1  |       /opt/gopath/src/github.com/hyperledger/fabric/vendor/github.com/spf13/cobra/command.go:783 +0x444  unit-tests_1  |   github.com/hyperledger/fabric/vendor/github.com/spf13/cobra.(*Command).Execute()  unit-tests_1  |       /opt/gopath/src/github.com/hyperledger/fabric/vendor/github.com/spf13/cobra/command.go:736 +0x38  unit-tests_1  |   github.com/hyperledger/fabric/peer/node.TestStartCmd.func1()  unit-tests_1  |       /opt/gopath/src/github.com/hyperledger/fabric/peer/node/start_test.go:51 +0x38{code}  ></description> </Issue>
