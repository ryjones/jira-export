<Issue id="27436" key="FAB-8075" number="8075" project="10002" reporter="rhegde" assignee="yacovm" creator="rhegde" type="10004" summary="Peer is not able to re-establish connection with other available orderer " priority="3" resolution="10000" status="6" created="2018-02-05 21:39:53.0" updated="2018-07-20 14:15:37.0" resolutiondate="2018-02-07 14:36:40.0" votes="0" watches="4" workflowId="41134"> <description><! CDATA Fabric Release v.1.0.4 Kafka Consensus Setup with 3 Orderer, 4 Kafka and 3 ZK.  steps to reproduce # During boot-up, peer connects successfully to one of the available orderer say ord02. Here ord01 and ord03 is down.  {code:java} 2018-02-05 21:41:21.060 CET  eventhub_producer  Chat -> ERRO 033 error during Chat, stopping handler: rpc error: code = Canceled desc = context canceled 2018-02-05 21:41:23.053 CET  kvledger  Commit -> INFO 034 Channel  afb1jhb-anz2mel : Created block  4038  with 2 transaction(s) 2018-02-05 21:41:25.857 CET  kvledger  Commit -> INFO 035 Channel  afb1jhb-anz2mel : Created block  4039  with 1 transaction(s) 2018-02-05 21:43:34.537 CET  ConnProducer  NewConnection -> ERRO 036 Failed connecting to ord03.clsorder.cit.clsnet:7050 , error: context deadline exceeded 2018-02-05 21:45:50.242 CET  eventhub_producer  Chat -> ERRO 037 error during Chat, stopping handler: rpc error: code = Canceled desc = context canceled 2018-02-05 21:45:50.242 CET  eventhub_producer  Chat -> ERRO 038 error during Chat, stopping handler: rpc error: code = Canceled desc = context canceled 2018-02-05 21:45:50.242 CET  eventhub_producer  Chat -> ERRO 039 error during Chat, stopping handler: rpc error: code = Canceled desc = context canceled 2018-02-05 21:45:50.242 CET  eventhub_producer  Chat -> ERRO 03a error during Chat, stopping handler: rpc error: code = Canceled desc = context canceled 2018-02-05 21:45:50.242 CET  eventhub_producer  Chat -> ERRO 03b error during Chat, stopping handler: rpc error: code = Canceled desc = context canceled 2018-02-05 21:45:50.242 CET  eventhub_producer  Chat -> ERRO 03c error during Chat, stopping handler: rpc error: code = Canceled desc = context canceled{code} {code:java}  clsnet@dusd1devrhap065 ~ $ docker exec -it 1ea7fa53abfa bash root@peer01:/opt/gopath/src/github.com/hyperledger/fabric/peer# netstat -a Active Internet connections (servers and established) Proto Recv-Q Send-Q Local Address           Foreign Address         State tcp        0      0 127.0.0.11:45411        *:*                     LISTEN tcp        0      0 peer01.afb1jhb1.c:59324 172.16.212.18:7050      ESTABLISHED tcp6       0      0  :: :7051                :: :*                  LISTEN tcp6       0      0  :: :7053                :: :*                  LISTEN tcp6       0      0 peer01.afb1jhb1.ci:7051 dev-peer01.afb1jh:46346 ESTABLISHED tcp6       0      0 peer01.afb1jhb1.ci:7051 dev-peer01.afb1jh:33554 ESTABLISHED udp        0      0 127.0.0.11:42642        *:* Active UNIX domain sockets (servers and established) Proto RefCnt Flags       Type       State         I-Node   Path{code}    2.  Don't perform any ledger transaction for say >15mins {code:java}  clsnet@dusd1devrhap065 ~ $ date Mon Feb  5 22:04:45 CET 2018{code} 3. Bring up the ord01  4. Bring down the ord02 {code:java} 2018-02-05 21:43:34.537 CET  ConnProducer  NewConnection -> ERRO 036 Failed connecting to ord03.clsorder.cit.clsnet:7050 , error: context deadline exceeded 2018-02-05 21:45:50.242 CET  eventhub_producer  Chat -> ERRO 037 error during Chat, stopping handler: rpc error: code = Canceled desc = context canceled 2018-02-05 21:45:50.242 CET  eventhub_producer  Chat -> ERRO 038 error during Chat, stopping handler: rpc error: code = Canceled desc = context canceled 2018-02-05 21:45:50.242 CET  eventhub_producer  Chat -> ERRO 039 error during Chat, stopping handler: rpc error: code = Canceled desc = context canceled 2018-02-05 21:45:50.242 CET  eventhub_producer  Chat -> ERRO 03a error during Chat, stopping handler: rpc error: code = Canceled desc = context canceled 2018-02-05 21:45:50.242 CET  eventhub_producer  Chat -> ERRO 03b error during Chat, stopping handler: rpc error: code = Canceled desc = context canceled 2018-02-05 21:45:50.242 CET  eventhub_producer  Chat -> ERRO 03c error during Chat, stopping handler: rpc error: code = Canceled desc = context canceled 2018-02-05 22:01:34.807 CET  eventhub_producer  Chat -> ERRO 03d error during Chat, stopping handler: rpc error: code = Canceled desc = context canceled 2018-02-05 22:18:14.256 CET  eventhub_producer  Chat -> ERRO 03e error during Chat, stopping handler: rpc error: code = Canceled desc = context canceled 2018-02-05 22:18:14.256 CET  eventhub_producer  Chat -> ERRO 040 error during Chat, stopping handler: rpc error: code = Canceled desc = context canceled 2018-02-05 22:18:14.256 CET  eventhub_producer  Chat -> ERRO 041 error during Chat, stopping handler: rpc error: code = Canceled desc = context canceled{code} 5. Peer looses connection with ord02 however does not connect to the ord01. {code:java} root@peer01:/opt/gopath/src/github.com/hyperledger/fabric/peer# netstat -a Active Internet connections (servers and established) Proto Recv-Q Send-Q Local Address           Foreign Address         State tcp        0      0 127.0.0.11:45411        *:*                     LISTEN tcp6       0      0  :: :7051                :: :*                  LISTEN tcp6       0      0  :: :7053                :: :*                  LISTEN tcp6       0      0 peer01.afb1jhb1.ci:7051 fd9ae51b7998.clsn:46346 ESTABLISHED tcp6       0      0 peer01.afb1jhb1.ci:7051 dev-peer01.afb1jh:33554 ESTABLISHED udp        0      0 127.0.0.11:42642        *:* Active UNIX domain sockets (servers and established) Proto RefCnt Flags       Type       State         I-Node   Path{code} 6. Peer was then restarted and it was able to establish connection with orderer. {code:java}  clsnet@dusd1devrhap065 ~ $ docker  ps | grep 1ea7fa53abfa 1ea7fa53abfa        dusd1devrhap061.dev.local/clsnet/fabric-peer:1.0.4                                                                  "/docker-entrypoin..."   About an hour ago   Up About an hour                                     cit23_peer01_afb1jhb1_cit_clsnet.1.fpqb5kay1k4qjq8n7ops690op  clsnet@dusd1devrhap065 ~ $ date Mon Feb  5 22:28:54 CET 2018  clsnet@dusd1devrhap065 ~ $ docker  ps | grep 1ea7fa53abfa^C  clsnet@dusd1devrhap065 ~ $ docker exec -it 1ea7fa53abfa bash root@peer01:/opt/gopath/src/github.com/hyperledger/fabric/peer# netstat -a Active Internet connections (servers and established) Proto Recv-Q Send-Q Local Address           Foreign Address         State tcp        0      0 127.0.0.11:45411        *:*                     LISTEN tcp6       0      0  :: :7051                :: :*                  LISTEN tcp6       0      0  :: :7053                :: :*                  LISTEN tcp6       0      0 peer01.afb1jhb1.ci:7051 fd9ae51b7998.clsn:46346 ESTABLISHED tcp6       0      0 peer01.afb1jhb1.ci:7051 dev-peer01.afb1jh:33554 ESTABLISHED udp        0      0 127.0.0.11:42642        *:* Active UNIX domain sockets (servers and established) Proto RefCnt Flags       Type       State         I-Node   Path root@peer01:/opt/gopath/src/github.com/hyperledger/fabric/peer# exit exit  clsnet@dusd1devrhap065 ~ $ docker ^C  clsnet@dusd1devrhap065 ~ $ docker stop 1ea7fa53abfa 1ea7fa53abfa  clsnet@dusd1devrhap065 ~ $ date Mon Feb  5 22:29:37 CET 2018  clsnet@dusd1devrhap065 ~ $ docker  ps | grep peer01_afb1jhb1 2a356e49a21a        dusd1devrhap061.dev.local/clsnet/fabric-peer:1.0.4                                                                  "/docker-entrypoin..."   15 seconds ago      Up 8 seconds                                         cit23_peer01_afb1jhb1_cit_clsnet.1.tof39e9i6wugwe9s8hcex812n  clsnet@dusd1devrhap065 ~ $ docker exec -it 2a356e49a21a bash root@peer01:/opt/gopath/src/github.com/hyperledger/fabric/peer# netstat -a Active Internet connections (servers and established) Proto Recv-Q Send-Q Local Address           Foreign Address         State tcp        0      0 127.0.0.11:37998        *:*                     LISTEN tcp        0      0 peer01.afb1jhb1.c:60718 172.16.212.18:7050      ESTABLISHED tcp        0      0 peer01.afb1jhb1.c:60714 172.16.212.18:7050      ESTABLISHED tcp        0      0 peer01.afb1jhb1.c:60728 172.16.212.18:7050      ESTABLISHED tcp        0      0 peer01.afb1jhb1.c:60988 172.16.212.38:5984      ESTABLISHED tcp        0      0 peer01.afb1jhb1.c:60716 172.16.212.18:7050      ESTABLISHED tcp        0      0 peer01.afb1jhb1.c:60726 172.16.212.18:7050      ESTABLISHED tcp        0      0 peer01.afb1jhb1.c:60990 172.16.212.38:5984      TIME_WAIT tcp        0      0 peer01.afb1jhb1.c:60978 172.16.212.38:5984      ESTABLISHED tcp        0      0 peer01.afb1jhb1.c:60720 172.16.212.18:7050      ESTABLISHED tcp6       0      0  :: :7051                :: :*                  LISTEN tcp6       0      0  :: :7053                :: :*                  LISTEN udp        0      0 127.0.0.11:41007        *:* Active UNIX domain sockets (servers and established) Proto RefCnt Flags       Type       State         I-Node   Path root@peer01:/opt/gopath/src/github.com/hyperledger/fabric/peer# exit exit  clsnet@dusd1devrhap065 ~ $ date Mon Feb  5 22:30:30 CET 2018  clsnet@dusd1devrhap065 ~ ${code} + Expected Result+ Peer must be able to establish connection with available orderers.  ></description> </Issue>
