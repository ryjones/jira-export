<Issue id="37852" key="FAB-14275" number="14275" project="10002" reporter="sykesm" assignee="sykesm" creator="sykesm" type="10004" summary="Make protos is broken on current master when running in alpine based buildenv container" priority="3" resolution="10000" status="6" created="2019-02-20 21:32:47.0" updated="2019-03-20 06:19:54.0" resolutiondate="2019-03-20 06:19:54.0" votes="0" watches="1" workflowId="49468"> <description><! CDATA When our build environment was based on ubuntu, we were using the GNU. coreutils with lots of extra-fancy helper thingies available to us that don't exist in the "standard" unix core utility set that's available in busy box or some BSD variants (eh, macOS - not that it matters here).  The protobuf compilation script that we use in fabric uses {{dirname}} with multiple paths as arguments and this does not work in busy box.  {code} ++ for dir in $PROTO_ROOT_DIRS +++ echo '-path /go/src/github.com/hyperledger/fabric/protos -prune -o ' ++ find /go/src/github.com/hyperledger/fabric -path /go/src/github.com/hyperledger/fabric/protos -prune -o -path /go/src/github.com/hyperledger/fabric/vendor -prune -o -path /go/src/github.com/hyperledger/fabric/.build -prune -o -path /go/src/github.com/hyperledger/fabric/core/chaincode/shim/java -prune -o -name '*.proto' -exec readlink -f '{}' ';' + ROOTLESS_PROTO_FILES='/go/src/github.com/hyperledger/fabric/core/ledger/kvledger/txmgmt/statedb/statecouchdb/msgs/msgs.proto /go/src/github.com/hyperledger/fabric/core/ledger/kvledger/txmgmt/statedb/stateleveldb/msgs/storage.proto /go/src/github.com/hyperledger/fabric/core/ledger/kvledger/txmgmt/pvtstatepurgemgmt/pvtdata_key.proto /go/src/github.com/hyperledger/fabric/core/ledger/pvtdatastorage/persistent_msgs.proto /go/src/github.com/hyperledger/fabric/core/comm/testdata/grpc/test.proto /go/src/github.com/hyperledger/fabric/common/tools/protolator/testprotos/sample.proto /go/src/github.com/hyperledger/fabric/common/grpclogging/testpb/echo.proto /go/src/github.com/hyperledger/fabric/common/grpcmetrics/testpb/echo.proto /go/src/github.com/hyperledger/fabric/idemix/idemix.proto' ++ dirname /go/src/github.com/hyperledger/fabric/core/ledger/kvledger/txmgmt/statedb/statecouchdb/msgs/msgs.proto /go/src/github.com/hyperledger/fabric/core/ledger/kvledger/txmgmt/statedb/stateleveldb/msgs/storage.proto /go/src/github.com/hyperledger/fabric/core/ledger/kvledger/txmgmt/pvtstatepurgemgmt/pvtdata_key.proto /go/src/github.com/hyperledger/fabric/core/ledger/pvtdatastorage/persistent_msgs.proto /go/src/github.com/hyperledger/fabric/core/comm/testdata/grpc/test.proto /go/src/github.com/hyperledger/fabric/common/tools/protolator/testprotos/sample.proto /go/src/github.com/hyperledger/fabric/common/grpclogging/testpb/echo.proto /go/src/github.com/hyperledger/fabric/common/grpcmetrics/testpb/echo.proto /go/src/github.com/hyperledger/fabric/idemix/idemix.proto ++ sort ++ uniq BusyBox v1.29.3 (2019-01-24 07:45:07 UTC) multi-call binary.  Usage: dirname FILENAME  Strip non-directory suffix from FILENAME + ROOTLESS_PROTO_DIRS= {code}  We need to fix the script (and set the pipefail option).  ></description> </Issue>
