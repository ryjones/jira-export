<Action id="58415" issue="38660" author="sykesm" type="comment" body="/cc  ~denyeart " created="2019-03-21 20:08:23.0" updateauthor="sykesm" updated="2019-03-21 20:08:23.0"/>
<Action id="58416" issue="38660" author="sykesm" type="comment" created="2019-03-21 20:23:45.0" updateauthor="sykesm" updated="2019-03-21 20:23:45.0"> <body><! CDATA Example stacks:  {code} goroutine 1231582  syscall : syscall.Syscall6(0x11, 0x3f, 0xc00b092600, 0xfaf, 0x6c630, 0x0, 0x0, 0xc000272d50, 0xc00b195e98, 0x4a79fd) 	/opt/go/src/syscall/asm_linux_amd64.s:44 +0x5 syscall.Pread(0x3f, 0xc00b092600, 0xfaf, 0x1005, 0x6c630, 0x3, 0xc000052570, 0xc000052500) 	/opt/go/src/syscall/zsyscall_linux_amd64.go:1311 +0x72 internal/poll.(*FD).Pread(0xc002f901e0, 0xc00b092600, 0xfaf, 0x1005, 0x6c630, 0x2a3e64859d02b800, 0xc00b195f58, 0xc00b196020) 	/opt/go/src/internal/poll/fd_unix.go:196 +0x9f os.(*File).pread(0xc002c7c270, 0xc00b092600, 0xfaf, 0x1005, 0x6c630, 0x552eb640aee0ccb0, 0xd38da93b5979815, 0xc00013a900) 	/opt/go/src/os/file_unix.go:258 +0x58 os.(*File).ReadAt(0xc002c7c270, 0xc00b092600, 0xfaf, 0x1005, 0x6c630, 0x0, 0x0, 0x0) 	/opt/go/src/os/file.go:126 +0xfd github.com/hyperledger/fabric/vendor/github.com/syndtr/goleveldb/leveldb.(*iStorageReader).ReadAt(0xc002ad5540, 0xc00b092600, 0xfaf, 0x1005, 0x6c630, 0x4c7ad96ea5cfab83, 0xbaa4b2f0838145ab, 0x8b9acd932fe89f20) 	/opt/gopath/src/github.com/hyperledger/fabric/vendor/github.com/syndtr/goleveldb/leveldb/storage.go:49 +0x5f github.com/hyperledger/fabric/vendor/github.com/syndtr/goleveldb/leveldb/table.(*Reader).readRawBlock(0xc0027d88f0, 0x6c630, 0xfaa, 0xc00b0a9101, 0xc00b196260, 0xb1a2ea, 0xc000272bd0, 0xc00b0a91f0, 0xc0000c6900) 	/opt/gopath/src/github.com/hyperledger/fabric/vendor/github.com/syndtr/goleveldb/leveldb/table/reader.go:564 +0xb5 github.com/hyperledger/fabric/vendor/github.com/syndtr/goleveldb/leveldb/table.(*Reader).readBlock(0xc0027d88f0, 0x6c630, 0xfaa, 0x1, 0xc000000008, 0xc008f9e380, 0x60) 	/opt/gopath/src/github.com/hyperledger/fabric/vendor/github.com/syndtr/goleveldb/leveldb/table/reader.go:603 +0x55 github.com/hyperledger/fabric/vendor/github.com/syndtr/goleveldb/leveldb/table.(*Reader).readBlockCached.func1(0xc00b0a9210, 0xc000142740, 0xc000142700) 	/opt/gopath/src/github.com/hyperledger/fabric/vendor/github.com/syndtr/goleveldb/leveldb/table/reader.go:627 +0x51 github.com/hyperledger/fabric/vendor/github.com/syndtr/goleveldb/leveldb/cache.(*Cache).Get(0xc000142740, 0x117b, 0x6c630, 0xc00b196360, 0x0) 	/opt/gopath/src/github.com/hyperledger/fabric/vendor/github.com/syndtr/goleveldb/leveldb/cache/cache.go:389 +0x1d8 github.com/hyperledger/fabric/vendor/github.com/syndtr/goleveldb/leveldb/cache.(*NamespaceGetter).Get(0xc002985450, 0x6c630, 0xc00b196360, 0x52) 	/opt/gopath/src/github.com/hyperledger/fabric/vendor/github.com/syndtr/goleveldb/leveldb/cache/cache.go:58 +0x4b github.com/hyperledger/fabric/vendor/github.com/syndtr/goleveldb/leveldb/table.(*Reader).readBlockCached(0xc0027d88f0, 0x6c630, 0xfaa, 0xb20101, 0xc009759bcd, 0x2, 0x70ea, 0xfaa, 0x2) 	/opt/gopath/src/github.com/hyperledger/fabric/vendor/github.com/syndtr/goleveldb/leveldb/table/reader.go:625 +0xc3 github.com/hyperledger/fabric/vendor/github.com/syndtr/goleveldb/leveldb/table.(*Reader).getDataIter(0xc0027d88f0, 0x6c630, 0xfaa, 0x0, 0x101, 0x5, 0xc00b18a4b0) 	/opt/gopath/src/github.com/hyperledger/fabric/vendor/github.com/syndtr/goleveldb/leveldb/table/reader.go:765 +0x5b github.com/hyperledger/fabric/vendor/github.com/syndtr/goleveldb/leveldb/table.(*Reader).find(0xc0027d88f0, 0xc00b15c6c0, 0x5a, 0x5a, 0xc00b196501, 0xc0001e30b0, 0xc000142900, 0x0, 0x0, 0x0, ...) 	/opt/gopath/src/github.com/hyperledger/fabric/vendor/github.com/syndtr/goleveldb/leveldb/table/reader.go:861 +0x475 github.com/hyperledger/fabric/vendor/github.com/syndtr/goleveldb/leveldb/table.(*Reader).Find(0xc0027d88f0, 0xc00b15c6c0, 0x5a, 0x5a, 0x1, 0xc0001e30b0, 0xc000140400, 0xc0001bee40, 0x52, 0x5a, ...) 	/opt/gopath/src/github.com/hyperledger/fabric/vendor/github.com/syndtr/goleveldb/leveldb/table/reader.go:918 +0x7a github.com/hyperledger/fabric/vendor/github.com/syndtr/goleveldb/leveldb.(*tOps).find(0xc0002730e0, 0xc0003d7e00, 0xc00b15c6c0, 0x5a, 0x5a, 0xc0001e30b0, 0x0, 0x0, 0x0, 0x0, ...) 	/opt/gopath/src/github.com/hyperledger/fabric/vendor/github.com/syndtr/goleveldb/leveldb/table.go:382 +0x132 github.com/hyperledger/fabric/vendor/github.com/syndtr/goleveldb/leveldb.(*version).get.func1(0x2, 0xc0003d7e00, 0x52) 	/opt/gopath/src/github.com/hyperledger/fabric/vendor/github.com/syndtr/goleveldb/leveldb/version.go:176 +0x452 github.com/hyperledger/fabric/vendor/github.com/syndtr/goleveldb/leveldb.(*version).walkOverlapping(0xc0027f34f0, 0x0, 0x0, 0x0, 0xc00b15c6c0, 0x5a, 0x5a, 0xc00b196880, 0xc00b196850) 	/opt/gopath/src/github.com/hyperledger/fabric/vendor/github.com/syndtr/goleveldb/leveldb/version.go:125 +0x477 github.com/hyperledger/fabric/vendor/github.com/syndtr/goleveldb/leveldb.(*version).get(0xc0027f34f0, 0x0, 0x0, 0x0, 0xc00b15c6c0, 0x5a, 0x5a, 0xc0001e30b0, 0x3fff00, 0x0, ...) 	/opt/gopath/src/github.com/hyperledger/fabric/vendor/github.com/syndtr/goleveldb/leveldb/version.go:160 +0x2b2 github.com/hyperledger/fabric/vendor/github.com/syndtr/goleveldb/leveldb.(*DB).get(0xc000162d00, 0x0, 0x0, 0x0, 0x0, 0xc00b15c660, 0x52, 0x60, 0x3ecb18, 0xc0001e30b0, ...) 	/opt/gopath/src/github.com/hyperledger/fabric/vendor/github.com/syndtr/goleveldb/leveldb/db.go:779 +0x397 github.com/hyperledger/fabric/vendor/github.com/syndtr/goleveldb/leveldb.(*DB).Get(0xc000162d00, 0xc00b15c660, 0x52, 0x60, 0xc0001e30b0, 0x0, 0x0, 0x0, 0x0, 0x0) 	/opt/gopath/src/github.com/hyperledger/fabric/vendor/github.com/syndtr/goleveldb/leveldb/db.go:845 +0x12f github.com/hyperledger/fabric/common/ledger/util/leveldbhelper.(*DB).Get(0xc000142600, 0xc00b15c660, 0x52, 0x60, 0x52, 0xc00b15c660, 0x11, 0x60, 0xc00b15aac0) 	/opt/gopath/src/github.com/hyperledger/fabric/common/ledger/util/leveldbhelper/leveldb_helper.go:99 +0x74 github.com/hyperledger/fabric/common/ledger/util/leveldbhelper.(*DBHandle).Get(0xc00128d180, 0xc00b0d8910, 0x41, 0x50, 0x41, 0xc00b0d8910, 0x1, 0x50, 0x27) 	/opt/gopath/src/github.com/hyperledger/fabric/common/ledger/util/leveldbhelper/leveldb_provider.go:69 +0x135 github.com/hyperledger/fabric/common/ledger/blkstorage/fsblkstorage.(*blockIndex).getTxLoc(0xc00128fe20, 0xc00b15aa80, 0x40, 0xc00b196d48, 0x1, 0x1) 	/opt/gopath/src/github.com/hyperledger/fabric/common/ledger/blkstorage/fsblkstorage/blockindex.go:236 +0x12f github.com/hyperledger/fabric/common/ledger/blkstorage/fsblkstorage.(*blockfileMgr).retrieveTransactionByID(0xc0012be600, 0xc00b15aa80, 0x40, 0x42c5f1, 0x126e0d8, 0xc00b196dd0) 	/opt/gopath/src/github.com/hyperledger/fabric/common/ledger/blkstorage/fsblkstorage/blockfile_mgr.go:515 +0xd7 github.com/hyperledger/fabric/common/ledger/blkstorage/fsblkstorage.(*fsBlockStore).RetrieveTxByID(0xc00128d4a0, 0xc00b15aa80, 0x40, 0xc00b196e00, 0xcd704e, 0x1f27720) 	/opt/gopath/src/github.com/hyperledger/fabric/common/ledger/blkstorage/fsblkstorage/fs_blockstore.go:72 +0x43 github.com/hyperledger/fabric/core/ledger/kvledger.(*kvLedger).GetTransactionByID(0xc0012bfaa0, 0xc00b15aa80, 0x40, 0x10, 0x13899a0, 0xc001228280) 	/opt/gopath/src/github.com/hyperledger/fabric/core/ledger/kvledger/kv_ledger.go:204 +0x4f github.com/hyperledger/fabric/core/endorser.(*SupportImpl).GetTransactionByID(0xc0003b60c0, 0xc00b03dad0, 0x10, 0xc00b15aa80, 0x40, 0x3, 0x0, 0x0) 	/opt/gopath/src/github.com/hyperledger/fabric/core/endorser/support.go:86 +0x89 github.com/hyperledger/fabric/core/endorser.(*Endorser).preProcess(0xc0003a1140, 0xc007a758b0, 0xc00014c6e8, 0xc00b197228, 0x2) 	/opt/gopath/src/github.com/hyperledger/fabric/core/endorser/endorser.go:375 +0x709 github.com/hyperledger/fabric/core/endorser.(*Endorser).ProcessProposal(0xc0003a1140, 0x137e360, 0xc008171aa0, 0xc007a758b0, 0x0, 0x0, 0x0) 	/opt/gopath/src/github.com/hyperledger/fabric/core/endorser/endorser.go:408 +0x20b github.com/hyperledger/fabric/core/handlers/auth/filter.(*expirationCheckFilter).ProcessProposal(0xc0003b10d0, 0x137e360, 0xc008171aa0, 0xc007a758b0, 0x107a3a0, 0x40d100, 0x2b54a05b4f10) 	/opt/gopath/src/github.com/hyperledger/fabric/core/handlers/auth/filter/expiration.go:61 +0x8f github.com/hyperledger/fabric/core/handlers/auth/filter.(*filter).ProcessProposal(0xc0003b1090, 0x137e360, 0xc008171aa0, 0xc007a758b0, 0xc0003b1090, 0x16, 0x0) 	/opt/gopath/src/github.com/hyperledger/fabric/core/handlers/auth/filter/filter.go:32 +0x51 github.com/hyperledger/fabric/protos/peer._Endorser_ProcessProposal_Handler.func1(0x137e360, 0xc008171aa0, 0x1171b80, 0xc007a758b0, 0xc009fcf438, 0x7891b8, 0xc00b0aafc0, 0xc008171afe) 	/opt/gopath/src/github.com/hyperledger/fabric/protos/peer/peer.pb.go:169 +0x86 github.com/hyperledger/fabric/vendor/github.com/grpc-ecosystem/go-grpc-middleware.ChainUnaryServer.func1.1(0x137e360, 0xc008171aa0, 0x1171b80, 0xc007a758b0, 0x0, 0x137e3fe, 0xc008171aa0, 0xc00aedb980) 	/opt/gopath/src/github.com/hyperledger/fabric/vendor/github.com/grpc-ecosystem/go-grpc-middleware/chain.go:31 +0x118 github.com/hyperledger/fabric/common/grpclogging.UnaryServerInterceptor.func1(0x137e360, 0xc008171aa0, 0x1171b80, 0xc007a758b0, 0xc00b079f40, 0xc007a75900, 0xc0038da980, 0x49fa26, 0x5c196cac, 0xc026dcee45) 	/opt/gopath/src/github.com/hyperledger/fabric/common/grpclogging/server.go:91 +0x265 github.com/hyperledger/fabric/vendor/github.com/grpc-ecosystem/go-grpc-middleware.ChainUnaryServer.func1.1(0x137e360, 0xc008171830, 0x1171b80, 0xc007a758b0, 0x1369020, 0xc00b03fae0, 0x116d980, 0xc00b070101) 	/opt/gopath/src/github.com/hyperledger/fabric/vendor/github.com/grpc-ecosystem/go-grpc-middleware/chain.go:34 +0x9f github.com/hyperledger/fabric/common/grpcmetrics.UnaryServerInterceptor.func1(0x137e360, 0xc008171830, 0x1171b80, 0xc007a758b0, 0xc00b079f40, 0xc007a75900, 0x106c640, 0x1f4ed58, 0xc0038daae8, 0x40d1d8) 	/opt/gopath/src/github.com/hyperledger/fabric/common/grpcmetrics/interceptor.go:30 +0x1d6 github.com/hyperledger/fabric/vendor/github.com/grpc-ecosystem/go-grpc-middleware.ChainUnaryServer.func1(0x137e360, 0xc008171830, 0x1171b80, 0xc007a758b0, 0xc00b079f40, 0xc00b079f60, 0x106c640, 0x1f4ed58, 0x11d8500, 0xc001e35600) 	/opt/gopath/src/github.com/hyperledger/fabric/vendor/github.com/grpc-ecosystem/go-grpc-middleware/chain.go:39 +0x153 github.com/hyperledger/fabric/protos/peer._Endorser_ProcessProposal_Handler(0x107a3a0, 0xc0003b1090, 0x137e360, 0xc008171830, 0xc00b0a8ee0, 0xc00025dfb0, 0x0, 0x0, 0xc001e35600, 0x50) 	/opt/gopath/src/github.com/hyperledger/fabric/protos/peer/peer.pb.go:171 +0x158 github.com/hyperledger/fabric/vendor/google.golang.org/grpc.(*Server).processUnaryRPC(0xc000344180, 0x13851e0, 0xc003903680, 0xc001e35600, 0xc0003a11d0, 0x1e30740, 0xc003291aa0, 0x0, 0x0) 	/opt/gopath/src/github.com/hyperledger/fabric/vendor/google.golang.org/grpc/server.go:982 +0x4cd github.com/hyperledger/fabric/vendor/google.golang.org/grpc.(*Server).handleStream(0xc000344180, 0x13851e0, 0xc003903680, 0xc001e35600, 0xc003291aa0) 	/opt/gopath/src/github.com/hyperledger/fabric/vendor/google.golang.org/grpc/server.go:1208 +0x1308 github.com/hyperledger/fabric/vendor/google.golang.org/grpc.(*Server).serveStreams.func1.1(0xc0032e21e0, 0xc000344180, 0x13851e0, 0xc003903680, 0xc001e35600) 	/opt/gopath/src/github.com/hyperledger/fabric/vendor/google.golang.org/grpc/server.go:686 +0x9f created by github.com/hyperledger/fabric/vendor/google.golang.org/grpc.(*Server).serveStreams.func1 	/opt/gopath/src/github.com/hyperledger/fabric/vendor/google.golang.org/grpc/server.go:684 +0xa1 {code}  {code} goroutine 1268651  syscall : syscall.Syscall6(0x101, 0xffffffffffffff9c, 0xc026a751d0, 0x80000, 0x180, 0x0, 0x0, 0xc00a043570, 0x7891b8, 0xc00013ad20) 	/opt/go/src/syscall/asm_linux_amd64.s:44 +0x5 syscall.openat(0xffffffffffffff9c, 0xc026a75180, 0x48, 0x80000, 0x180, 0xc02ff08900, 0x81, 0xfe64e0) 	/opt/go/src/syscall/zsyscall_linux_amd64.go:68 +0xab syscall.Open(0xc026a75180, 0x48, 0x80000, 0x180, 0xc00a043770, 0x2, 0x2) 	/opt/go/src/syscall/syscall_linux.go:138 +0x50 os.openFileNolog(0xc026a75180, 0x48, 0x0, 0x180, 0xc00a043770, 0x2, 0x2) 	/opt/go/src/os/file_unix.go:190 +0x85 os.OpenFile(0xc026a75180, 0x48, 0x0, 0xc000000180, 0x2, 0x2, 0x8) 	/opt/go/src/os/file.go:284 +0x5f github.com/hyperledger/fabric/common/ledger/blkstorage/fsblkstorage.newBlockfileStream(0xc000440880, 0x37, 0x8, 0xa06db2, 0xc03077a580, 0xc01d68b0f8, 0x6) 	/opt/gopath/src/github.com/hyperledger/fabric/common/ledger/blkstorage/fsblkstorage/block_stream.go:59 +0x16f github.com/hyperledger/fabric/common/ledger/blkstorage/fsblkstorage.(*blockfileMgr).fetchBlockBytes(0xc0012be600, 0xc03077a580, 0x0, 0x0, 0x0, 0x0, 0x0) 	/opt/gopath/src/github.com/hyperledger/fabric/common/ledger/blkstorage/fsblkstorage/blockfile_mgr.go:555 +0x67 github.com/hyperledger/fabric/common/ledger/blkstorage/fsblkstorage.(*blockfileMgr).fetchBlock(0xc0012be600, 0xc03077a580, 0xc03077a580, 0x0, 0x0) 	/opt/gopath/src/github.com/hyperledger/fabric/common/ledger/blkstorage/fsblkstorage/blockfile_mgr.go:532 +0x39 github.com/hyperledger/fabric/common/ledger/blkstorage/fsblkstorage.(*blockfileMgr).retrieveBlockByNumber(0xc0012be600, 0x1120, 0xc00043d4c0, 0x10000c03077a420, 0x15) 	/opt/gopath/src/github.com/hyperledger/fabric/common/ledger/blkstorage/fsblkstorage/blockfile_mgr.go:473 +0x15d github.com/hyperledger/fabric/common/ledger/blkstorage/fsblkstorage.(*fsBlockStore).RetrieveBlockByNumber(0xc00128d4a0, 0x1120, 0x0, 0x2b549954b6c0, 0x0) 	/opt/gopath/src/github.com/hyperledger/fabric/common/ledger/blkstorage/fsblkstorage/fs_blockstore.go:67 +0x39 github.com/hyperledger/fabric/core/ledger/kvledger.(*kvLedger).GetBlockByNumber(0xc0012bfaa0, 0x1120, 0xc01d68aff8, 0x4, 0xffffffffffffffff) 	/opt/gopath/src/github.com/hyperledger/fabric/core/ledger/kvledger/kv_ledger.go:229 +0x45 github.com/hyperledger/fabric/core/scc/qscc.getBlockByNumber(0x13899a0, 0xc001228280, 0xc01d68aff8, 0x4, 0x8, 0x0, 0x0, 0x0, 0x0, 0x0, ...) 	/opt/gopath/src/github.com/hyperledger/fabric/core/scc/qscc/query.go:149 +0x1a4 github.com/hyperledger/fabric/core/scc/qscc.(*LedgerQuerier).Invoke(0xc000263860, 0x138e780, 0xc0307480b0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, ...) 	/opt/gopath/src/github.com/hyperledger/fabric/core/scc/qscc/query.go:111 +0xa09 github.com/hyperledger/fabric/core/chaincode/shim.(*Handler).handleTransaction.func1(0xc0011fecc0, 0xc00004bda0, 0xc044995c00) 	/opt/gopath/src/github.com/hyperledger/fabric/core/chaincode/shim/handler.go:273 +0x4eb created by github.com/hyperledger/fabric/core/chaincode/shim.(*Handler).handleTransaction 	/opt/gopath/src/github.com/hyperledger/fabric/core/chaincode/shim/handler.go:242 +0x53 {code}  ></body> </Action>
<Action id="66828" issue="38660" author="ryjones" type="comment" body="Is this a security issue? Does it need the restricted access?" created="2020-01-21 01:12:53.0" updateauthor="ryjones" updated="2020-01-21 01:12:53.0"/>
<Action id="66829" issue="38660" author="denyeart" type="comment" body=" ~ryjones  Yes it is a security issue since it describes how to crash peer." created="2020-01-21 02:32:50.0" updateauthor="denyeart" updated="2020-01-21 02:32:50.0"/>
<Action id="66845" issue="38660" author="dhuseby" type="comment" body=" ~denyeart  is this scheduled to be fixed soon? 1.4? 2.0?" created="2020-01-21 17:20:58.0" updateauthor="dhuseby" updated="2020-01-21 17:20:58.0"/>
<Action id="66865" issue="38660" author="denyeart" type="comment" body=" ~dhuseby  It is being actively worked, targeted for 2.1 at this time. After it is done we&apos;ll assess feasibility of backport." created="2020-01-21 19:27:18.0" updateauthor="denyeart" updated="2020-01-21 19:27:18.0"/>
<Action id="67703" issue="38660" author="dhuseby" type="comment" created="2020-01-28 20:05:27.0" updateauthor="dhuseby" updated="2020-01-28 20:05:27.0"> <body><! CDATA Sounds good. We have a responsibility to disclose this. Should have disclosed it last year, 90 days after it was filed. Even if it isn't fixed. Either it's a high/critical security bug and therefor higher priority than everything else or it isn't. Its sounds like it isn't higher priority. There's a few others marked as security bugs laying around we should disclose as well.  Thoughts? I think a blog post talking about known security bugs and potential mitigations is in order.  ></body> </Action>
<Action id="67981" issue="38660" author="denyeart" type="comment" body="This has been merged in master and will release in v2.1. The fix ensures that requesters will receive an error if there are more than the threshold of requests already being processed, rather than allowing the peer to reach the maximum number of operating system threads and panic. The peer is built to tolerate panics well anyways, so in my opinion this is not a very important security fix. I think a mention in the v2.1 release notes will be sufficient. The maintainers do not see a need to backport to prior releases." created="2020-02-17 18:49:38.0" updateauthor="denyeart" updated="2020-02-17 18:49:38.0"/>
