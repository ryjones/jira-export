<Issue id="39127" key="FAB-15093" number="15093" project="10002" reporter="c0rwin" assignee="ronenschafferibm" creator="c0rwin" type="10004" summary="TestGossipChannelEligibility not initialized mock" priority="3" resolution="10000" status="6" created="2019-04-07 22:10:36.0" updated="2019-06-06 06:37:52.0" resolutiondate="2019-06-06 06:37:52.0" votes="0" watches="2" workflowId="52003"> <description><! CDATA {code} 21:29:37 ok  	github.com/hyperledger/fabric/gossip/gossip/algo	5.620s	coverage: 96.9% of statements 21:29:39 2019-04-07 21:29:39.734 UTC  gossip.channel#test  verifyMsg -> WARN 001 Messsage is nil 21:29:39 2019-04-07 21:29:39.734 UTC  gossip.channel#test  verifyMsg -> WARN 002 Message content is empty 21:29:39 2019-04-07 21:29:39.742 UTC  gossip.channel#test  verifyMsg -> WARN 003 Message has nil PKI-ID 21:29:39 2019-04-07 21:29:39.742 UTC  gossip.channel#test  HandleMessage -> WARN 004 Failed verifying message: channel:"A" tag:CHAN_AND_ORG data_msg:<payload:<seq_num:5 > >  21:29:39 2019-04-07 21:29:39.743 UTC  gossip.channel#test  HandleMessage -> WARN 005 Point to point message came from  706b694944696e4f726732 , org( ORG2 ) but it's not eligible for the channel A 21:29:39 2019-04-07 21:29:39.743 UTC  gossip.channel#test  func5 -> WARN 006 peer  112 107 105 73 68 105 110 79 114 103 50  's organization( ORG2 ) isn't in the channel A 21:29:39 2019-04-07 21:29:39.743 UTC  gossip.channel#test  func5 -> WARN 007 Peer  112 107 105 73 68 73 110 79 114 103 49  isn't eligible for channel A : Not eligible 21:29:39 github.com/hyperledger/fabric/gossip/gossip/channel.NewGossipChannel.func5 21:29:39 	/w/workspace/fabric-verify-unit-tests-x86_64/gopath/src/github.com/hyperledger/fabric/gossip/gossip/channel/channel.go:268 21:29:39 github.com/hyperledger/fabric/gossip/gossip/channel.(*stateInfoCache).validate 21:29:39 	/w/workspace/fabric-verify-unit-tests-x86_64/gopath/src/github.com/hyperledger/fabric/gossip/gossip/channel/channel.go:979 21:29:39 github.com/hyperledger/fabric/gossip/gossip/channel.(*gossipChannel).ConfigureChannel 21:29:39 	/w/workspace/fabric-verify-unit-tests-x86_64/gopath/src/github.com/hyperledger/fabric/gossip/gossip/channel/channel.go:563 21:29:39 github.com/hyperledger/fabric/gossip/gossip/channel.TestChannelGetPeers 21:29:39 	/w/workspace/fabric-verify-unit-tests-x86_64/gopath/src/github.com/hyperledger/fabric/gossip/gossip/channel/channel_test.go:1721 21:29:39 testing.tRunner 21:29:39 	/opt/go/go1.11.5.linux.amd64/src/testing/testing.go:827 21:29:39 runtime.goexit 21:29:39 	/opt/go/go1.11.5.linux.amd64/src/runtime/asm_amd64.s:1333 21:29:39 2019-04-07 21:29:39.743 UTC  gossip.channel#test  HandleMessage -> WARN 008 Point to point message came from  706b694944696e4f726732 , org( ORG2 ) but it's not eligible for the channel A 21:29:39 2019-04-07 21:29:39.744 UTC  gossip.channel#test  func5 -> WARN 009 Peer  112 107 105 73 68 73 110 79 114 103 49 66 117 116 78 111 116 69 108 105 103 105 98 108 101  isn't eligible for channel A : Not eligible 21:29:39 github.com/hyperledger/fabric/gossip/gossip/channel.NewGossipChannel.func5 21:29:39 	/w/workspace/fabric-verify-unit-tests-x86_64/gopath/src/github.com/hyperledger/fabric/gossip/gossip/channel/channel.go:268 21:29:39 github.com/hyperledger/fabric/gossip/gossip/channel.(*stateInfoCache).validate 21:29:39 	/w/workspace/fabric-verify-unit-tests-x86_64/gopath/src/github.com/hyperledger/fabric/gossip/gossip/channel/channel.go:979 21:29:39 github.com/hyperledger/fabric/gossip/gossip/channel.(*gossipChannel).ConfigureChannel 21:29:39 	/w/workspace/fabric-verify-unit-tests-x86_64/gopath/src/github.com/hyperledger/fabric/gossip/gossip/channel/channel.go:563 21:29:39 github.com/hyperledger/fabric/gossip/gossip/channel.TestChannelGetPeers 21:29:39 	/w/workspace/fabric-verify-unit-tests-x86_64/gopath/src/github.com/hyperledger/fabric/gossip/gossip/channel/channel_test.go:1721 21:29:39 testing.tRunner 21:29:39 	/opt/go/go1.11.5.linux.amd64/src/testing/testing.go:827 21:29:39 runtime.goexit 21:29:39 	/opt/go/go1.11.5.linux.amd64/src/runtime/asm_amd64.s:1333 21:29:39 2019-04-07 21:29:39.745 UTC  gossip.channel#test  verifyMsg -> WARN 00a Message contains wrong channel MAC(  236 254 103 42 92 15 128 69 128 23 93 211 64 117 4 245 122 169 53 61 97 52 130 122 122 247 124 49 223 8 78 79  ), expected  223 190 237 241 229 126 55 153 124 7 243 164 172 139 78 65 62 107 7 154 203 163 4 26 100 24 146 10 59 53 199 167  21:29:39 2019-04-07 21:29:39.745 UTC  gossip.channel#test  HandleMessage -> WARN 00b Failed verifying message: tag:CHAN_OR_ORG state_info:<timestamp:<inc_num:1554672579745005189 seq_num:1 > pki_id:"pkiIDInOrg1" channel_MAC:"\354\376g*\\\017\200E\200\027 \323@u\004\365z\2515=a4\202zz\367|1\337\010NO" properties:<ledger_height:1 > >  21:29:39 2019-04-07 21:29:39.746 UTC  gossip.channel#test  HandleMessage -> WARN 00c Point to point message came from  706b694944696e4f726733 , org( ORG3 ) but it's not eligible for the channel A 21:29:39 2019-04-07 21:29:39.746 UTC  gossip.channel#test  func5 -> WARN 00d peer  112 107 105 73 68 105 110 79 114 103 50  's organization( ORG2 ) isn't in the channel A 21:29:39 2019-04-07 21:29:39.747 UTC  gossip.channel#test  ConfigureChannel -> WARN 00e Already have a more updated JoinChannel message( 1554672579847322498 ) than 1554672579747322638 21:29:39 2019-04-07 21:29:39.747 UTC  gossip.channel#test  func5 -> WARN 00f Peer  112 107 105 73 68 73 110 79 114 103 49 66 117 116 78 111 116 69 108 105 103 105 98 108 101  isn't eligible for channel A : Not a channel reader 21:29:39 github.com/hyperledger/fabric/gossip/gossip/channel.NewGossipChannel.func5 21:29:39 	/w/workspace/fabric-verify-unit-tests-x86_64/gopath/src/github.com/hyperledger/fabric/gossip/gossip/channel/channel.go:268 21:29:39 github.com/hyperledger/fabric/gossip/gossip/channel.(*stateInfoCache).validate 21:29:39 	/w/workspace/fabric-verify-unit-tests-x86_64/gopath/src/github.com/hyperledger/fabric/gossip/gossip/channel/channel.go:979 21:29:39 github.com/hyperledger/fabric/gossip/gossip/channel.(*gossipChannel).ConfigureChannel 21:29:39 	/w/workspace/fabric-verify-unit-tests-x86_64/gopath/src/github.com/hyperledger/fabric/gossip/gossip/channel/channel.go:563 21:29:39 github.com/hyperledger/fabric/gossip/gossip/channel.TestGossipChannelEligibility 21:29:39 	/w/workspace/fabric-verify-unit-tests-x86_64/gopath/src/github.com/hyperledger/fabric/gossip/gossip/channel/channel_test.go:1649 21:29:39 testing.tRunner 21:29:39 	/opt/go/go1.11.5.linux.amd64/src/testing/testing.go:827 21:29:39 runtime.goexit 21:29:39 	/opt/go/go1.11.5.linux.amd64/src/runtime/asm_amd64.s:1333 21:29:39 2019-04-07 21:29:39.747 UTC  gossip.channel#test  EligibleForChannel -> WARN 010 Identity for peer 706b694944496e4f726731 doesn't exist 21:29:39 2019-04-07 21:29:39.747 UTC  gossip.channel#test  HandleMessage -> WARN 011 Point to point message came from  706b694944496e4f726731 , org( ORG1 ) but it's not eligible for the channel A 21:29:39 2019-04-07 21:29:39.747 UTC  gossip.channel#test  EligibleForChannel -> WARN 012 Identity for peer 706b694944496e4f726731 doesn't exist 21:29:39 panic:  21:29:39  21:29:39 mock: Unexpected Method Call 21:29:39 ----------------------------- 21:29:39  21:29:39 GetIdentityByPKIID(common.PKIidType) 21:29:39 		0: common.PKIidType{0x70, 0x6b, 0x69, 0x49, 0x44, 0x49, 0x6e, 0x4f, 0x72, 0x67, 0x31, 0x42, 0x75, 0x74, 0x4e, 0x6f, 0x74, 0x45, 0x6c, 0x69, 0x67, 0x69, 0x62, 0x6c, 0x65} 21:29:39  21:29:39 The closest call I have is:  21:29:39  21:29:39 GetIdentityByPKIID(common.PKIidType) 21:29:39 		0: common.PKIidType{0x70, 0x6b, 0x69, 0x49, 0x44, 0x49, 0x6e, 0x4f, 0x72, 0x67, 0x31} 21:29:39  21:29:39 Difference found in argument 0: 21:29:39  21:29:39 --- Expected 21:29:39 +++ Actual 21:29:39 @@ -1,2 +1,2 @@ 21:29:39 -(common.PKIidType) (len=11) 706b694944496e4f726731 21:29:39 +(common.PKIidType) (len=25) 706b694944496e4f7267314275744e6f74456c696769626c65 21:29:39   21:29:39  21:29:39 Diff: 0: FAIL:  (common.PKIidType=706b694944496e4f7267314275744e6f74456c696769626c65) != (common.PKIidType=706b694944496e4f726731) {code}  https://jenkins.hyperledger.org/job/fabric-verify-unit-tests-x86_64/11393/console  {code} common.PKIidType{0x70, 0x6b, 0x69, 0x49, 0x44, 0x49, 0x6e, 0x4f, 0x72, 0x67, 0x31, 0x42, 0x75, 0x74, 0x4e, 0x6f, 0x74, 0x45, 0x6c, 0x69, 0x67, 0x69, 0x62, 0x6c, 0x65} == pkiIDInOrg1ButNotEligible {code}  and   {code} common.PKIidType{0x70, 0x6b, 0x69, 0x49, 0x44, 0x49, 0x6e, 0x4f, 0x72, 0x67, 0x31} == pkiIDInOrg1 {code}  ></description> </Issue>
