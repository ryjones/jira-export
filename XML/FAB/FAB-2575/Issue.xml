<Issue id="15142" key="FAB-2575" number="2575" project="10002" reporter="scottz" assignee="nickgaski" creator="scottz" type="10001" summary="orderer service kills grpc connection with broadcast client after kafka brokers all stopped and started" priority="5" resolution="10001" status="6" created="2017-03-01 20:12:09.0" updated="2020-01-09 16:54:17.0" resolutiondate="2020-01-09 16:54:17.0" votes="0" watches="4" workflowId="35086"> <description><! CDATA During retests after FAB-2259 was fixed, using Feb 27 conmit # 29d7fc035df697a68d271d628e693c556354486f, we encountered other errors.  Execute test ORD97. This includes a sequence of events while traffic is running: docker stop kafka0 kafka1 kafka2 && sleep 20 && docker start kafka0 kafka1 kafka2  Problems observed: 1. Seven transactions are unaccounted for; they were acknowledged received by the orderer service, but never delivered in a batch 2. Although the orderer does not panic, the service never resumes as expected after KBs recover:  $ go test -run ORD97 ========== OTE testname=ORD-97 TX=50000 Channels=1 Orderers=3 ordererType=kafka kafka-brokers=3 oteSpy=OFF producersPerCh=1  Files are attached, but here are some of the key output and logs:  Total TX broadcasts Requested to Send     50000 Total TX broadcasts send success ACK      17397 Total TX broadcasts sendFailed - NACK     32603 Total Send-LOST TX (Not Ack or Nack))         0 Total Recv-LOST TX (Ack but not Recvd)        7 Total deliveries received TX on each ordrr        17390   17390   17390  Total deliveries received Blocks on each ordrr     1739    1739    1739   2017-03-01 18:24:26.867 UTC  orderer/kafka  Send -> INFO 31744 Failed to send message to chain partition 74657374636861696e6964/0 on the Kafka cluster: kafka: client has run out of available brokers to talk to (Is your cluster reachable?) 2017-03-01 18:24:26.867 UTC  orderer/kafka  Enqueue -> ERRO 31745 Couldn't post to 74657374636861696e6964/0: kafka: client has run out of available brokers to talk to (Is your cluster reachable?)   ></description> </Issue>
