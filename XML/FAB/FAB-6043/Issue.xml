<Issue id="20624" key="FAB-6043" number="6043" project="10002" reporter="yacovm" assignee="yacovm" creator="yacovm" type="10002" summary="gradually migrate gossip stateInfo metadata to proto structures" priority="3" resolution="10000" status="6" created="2017-09-06 07:50:20.0" updated="2018-07-20 14:14:18.0" resolutiondate="2017-09-13 03:36:35.0" votes="0" watches="1" workflowId="39927"> <description><! CDATA In gossip we use StateInfo messages to convey channel related metadata like block height to peers, in order to build channel membership. {code} message StateInfo { bytes metadata     = 1; PeerTime timestamp = 2; bytes pki_id       = 3;  // channel_MAC is an authentication code that proves // that the peer that sent this message knows // the name of the channel. bytes channel_MAC  = 4; } {code}  The metadata is a marshalled struct and therefore isn't extendable.  I propose to add another field (properties? attributes?) that would be a proto message, and: * Populate the ledger height in the new field as well as in the old metadata field so that peers of v1.0.x would work with peers of version v1.1 in the following fashion: ** When evaluating a StateInfo message, first look at the new field. If it's nil - look at the old field (metadata). If it's a zero length slice - the message would be deemed invalid. * At some point in the future we would eventually deprecate the metadata field.   ~C0rWin   ~mastersingh24   ></description> </Issue>
