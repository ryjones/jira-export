<Issue id="20826" key="FAB-6161" number="6161" project="10002" reporter="gbolo" creator="gbolo" type="10001" summary="pkcs11 and an official community build of fabric docker images" priority="2" resolution="10000" status="6" created="2017-09-14 14:14:00.0" updated="2020-08-19 17:01:53.0" resolutiondate="2017-12-03 17:02:55.0" votes="0" watches="5" workflowId="40010"> <description><! CDATA Following up on a previously closed ticket ---FAB-3196--- (won't ix)  Let's start the discussion about the usefulness of a static binary that is unable to provide pkcs11 functionality due to linking issues (see ticket).  I understand that pkcs11 is not a popular feature, however, it is almost a requirement for enterprise grade deployments. Ideally, one can take the fabric images and layer on top their own pkcs11 libraries needed for their HSM integration.  I guess I am having a hard time understanding why the docker images are the targets of the statically linked binary? Considering that docker is a *PERFECT* candidate for dynamic linking (since its a container, and its libraries are isolated from the host).      What are your thoughts?     Current Behaviour when trying to use pkcs11:  {{ peer0.org1.example.com|http://peer0.org1.example.com/  | fatal error: unexpected signal during runtime execution}} {{ peer0.org1.example.com|http://peer0.org1.example.com/  |  signal SIGSEGV: segmentation violation code=0x1 addr=0x0 pc=0x0 }} {{ peer0.org1.example.com|http://peer0.org1.example.com/  |}} {{ peer0.org1.example.com|http://peer0.org1.example.com/  | runtime stack:}} {{ peer0.org1.example.com|http://peer0.org1.example.com/  | runtime.throw(0xe16822, 0x2a)}} {{ peer0.org1.example.com|http://peer0.org1.example.com/  | /opt/go/src/runtime/panic.go:566 +0x95}} {{ peer0.org1.example.com|http://peer0.org1.example.com/  | runtime.sigpanic()}} {{ peer0.org1.example.com|http://peer0.org1.example.com/  | /opt/go/src/runtime/sigpanic_unix.go:12 +0x2cc}} {{ peer0.org1.example.com|http://peer0.org1.example.com/  |}} {{ peer0.org1.example.com|http://peer0.org1.example.com/  | goroutine 1  syscall, locked to thread :}} {{ peer0.org1.example.com|http://peer0.org1.example.com/  | runtime.cgocall(0xb49dc0, 0xc42017d440, 0xc400000000)}} {{ peer0.org1.example.com|http://peer0.org1.example.com/  | /opt/go/src/runtime/cgocall.go:131 +0x110 fp=0xc42017d410 sp=0xc42017d3d0}} {{ peer0.org1.example.com|http://peer0.org1.example.com/  |  github.com/hyperledger/fabric/vendor/github.com/miekg/pkcs11._Cfunc_New(0x2939be0|http://github.com/hyperledger/fabric/vendor/github.com/miekg/pkcs11._Cfunc_New(0x2939be0 , 0x0)}} {{ peer0.org1.example.com|http://peer0.org1.example.com/  | ??:0 +0x4a fp=0xc42017d440 sp=0xc42017d410}} {{ peer0.org1.example.com|http://peer0.org1.example.com/  |  github.com/hyperledger/fabric/vendor/github.com/miekg/pkcs11.New(0xc420231290|http://github.com/hyperledger/fabric/vendor/github.com/miekg/pkcs11.New(0xc420231290 , 0x30, 0x0)}} {{ peer0.org1.example.com|http://peer0.org1.example.com/  | /opt/gopath/src/ github.com/hyperledger/fabric/vendor/github.com/miekg/pkcs11/pkcs11.go:763|http://github.com/hyperledger/fabric/vendor/github.com/miekg/pkcs11/pkcs11.go:763  +0xc4 fp=0xc42017d480 sp=0xc42017d440}} {{ peer0.org1.example.com|http://peer0.org1.example.com/  |  github.com/hyperledger/fabric/bccsp/pkcs11.loadLib(0xc420231290|http://github.com/hyperledger/fabric/bccsp/pkcs11.loadLib(0xc420231290 , 0x30, 0xc42020d780, 0x8, 0xc42020d770, 0x9, 0xc420295560, 0x0, 0x0, 0x0, ...)}} {{ peer0.org1.example.com|http://peer0.org1.example.com/  | /opt/gopath/src/ github.com/hyperledger/fabric/bccsp/pkcs11/pkcs11.go:39|http://github.com/hyperledger/fabric/bccsp/pkcs11/pkcs11.go:39  +0x13d fp=0xc42017d720 sp=0xc42017d480}} {{ peer0.org1.example.com|http://peer0.org1.example.com/  |  github.com/hyperledger/fabric/bccsp/pkcs11.New(0x100|http://github.com/hyperledger/fabric/bccsp/pkcs11.New(0x100 , 0xc42020d7e8, 0x4, 0x0, 0xc420298fe0, 0x0, 0xc420231290, 0x30, 0xc42020d770, 0x9, ...)}} {{ peer0.org1.example.com|http://peer0.org1.example.com/  | /opt/gopath/src/ github.com/hyperledger/fabric/bccsp/pkcs11/impl.go:64|http://github.com/hyperledger/fabric/bccsp/pkcs11/impl.go:64  +0x259 fp=0xc42017d870 sp=0xc42017d720}} {{ peer0.org1.example.com|http://peer0.org1.example.com/  |  github.com/hyperledger/fabric/bccsp/factory.(*PKCS11Factory).Get(0x14c2fa8|http://github.com/hyperledger/fabric/bccsp/factory.(*PKCS11Factory).Get(0x14c2fa8 , 0xc42025fb80, 0xc42017d9a8, 0xc42017d998, 0x1, 0x1)}}  ></description> </Issue>
