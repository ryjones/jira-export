<Action id="55896" issue="35718" author="guoger" type="comment" created="2019-01-21 10:45:00.0" updateauthor="guoger" updated="2019-01-22 04:57:44.0"> <body><! CDATA https://gerrit.hyperledger.org/r/c/28849/ https://gerrit.hyperledger.org/r/c/28850 https://gerrit.hyperledger.org/r/c/28880  ></body> </Action>
<Action id="55978" issue="35718" author="yacovm" type="comment" created="2019-01-22 09:13:10.0" updateauthor="yacovm" updated="2019-01-22 09:13:10.0"> <body><! CDATA If a ledger file is corrupted then you can in theory remove it and delete the index files. However I don't see how this is relevant? We're talking here about automatic recovery vs. manual recovery, no?  ></body> </Action>
<Action id="55981" issue="35718" author="guoger" type="comment" created="2019-01-22 10:29:07.0" updateauthor="guoger" updated="2019-01-22 10:29:07.0"> <body><! CDATA my thinking process is, you can do exactly the same to raft: {quote} If a -ledger- wal file is corrupted then you can in theory remove it -and delete the index files.- {quote} so, i guess we don't need to retain extra wal/snap files in case of corruption, since we don't do that to ledger files anyway.  obviously, delete of files need to be done manually...  ></body> </Action>
<Action id="55987" issue="35718" author="yacovm" type="comment" body="But does etcdraft use the alternative files if it files that some files are corrupt or do you need a manual intervention?" created="2019-01-22 13:33:34.0" updateauthor="yacovm" updated="2019-01-22 13:33:34.0"/>
<Action id="56129" issue="35718" author="kchristidis" type="comment" created="2019-01-24 00:07:37.0" updateauthor="kchristidis" updated="2019-01-24 00:07:37.0"> <body><! CDATA {quote}so, i guess we don't need to retain extra wal/snap files in case of corruption, since we don't do that to ledger files anyway.{quote} I'm not sure I follow, can you expand? (I'd lean towards yes, on keeping older WAL files, but I want to make sure I get everything.)  I also think Yacov's question is key here.  ></body> </Action>
<Action id="56132" issue="35718" author="guoger" type="comment" created="2019-01-24 02:38:33.0" updateauthor="guoger" updated="2019-01-24 02:38:33.0"> <body><! CDATA the question is: *how many wal/snap files should we retain?*  Theoretically speaking, we only need the *latest* snap file _and_ wal files *after* that. (my current CR does this)  However, if that snap file is corrupted, etcd/snap would attempt to read an older one. Otherwise, operator needs to manually copy from other orderers.  To make a decision like this, i took a look at how we handle corrupted ledger files, and realized (i may be wrong) that we don't...  cc  ~kchristidis   ></body> </Action>
<Action id="56136" issue="35718" author="kchristidis" type="comment" created="2019-01-24 03:11:34.0" updateauthor="kchristidis" updated="2019-01-24 03:11:44.0"> <body><! CDATA So, it sounds like the {{etcd/raft}} library will automatically pick an older snapshot if the most recent one is corrupted. Presumably, this means that we're also keeping all the WAL files needed to restore us to the what {{etcd/raft}} deems as the most recent state _from_ the oldest snapshot file we have laying around?  I still don't get why we're looking at corrupted ledger files though? This seems completely orthogonal?  ></body> </Action>
<Action id="56141" issue="35718" author="guoger" type="comment" created="2019-01-24 06:26:06.0" updateauthor="guoger" updated="2019-01-24 06:26:06.0"> <body><! CDATA {quote}Presumably, this means that we're also keeping all the WAL files needed to restore us to the what etcd/raft deems as the most recent state from the oldest snapshot file we have laying around? {quote} yep  {quote} I still don't get why we're looking at corrupted ledger files though? This seems completely orthogonal? {quote} it *is* orthogonal. i was just using this as a reference, since it's in the same problem space as we have in raft here.  if we could agree on following statement, i guess we could go with the simple solution for now (keeping the latest snap only): {quote} If some orderer files (ledger or raft) are corrupted, user intervention is required {quote}  ></body> </Action>
<Action id="56216" issue="35718" author="kchristidis" type="comment" body="Just to recap the conclusions we reached during yesterday&apos;s scrum: Irrespective of what happens in the ledger component, if we can get this protection against corrupted files by the {{etcd/raft}} library cheaply, then we should go for it. (And we&apos;ll go for it.)" created="2019-01-25 15:07:34.0" updateauthor="kchristidis" updated="2019-01-25 15:07:34.0"/>
<Action id="56345" issue="35718" author="kchristidis" type="comment" created="2019-01-29 17:07:51.0" updateauthor="kchristidis" updated="2019-01-29 17:07:51.0"> <body><! CDATA  https://gerrit.hyperledger.org/r/c/28849/    https://gerrit.hyperledger.org/r/c/28850/   Â   ></body> </Action>
