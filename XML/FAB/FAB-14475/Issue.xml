<Issue id="38179" key="FAB-14475" number="14475" project="10002" reporter="hagarm" assignee="hagarm" creator="hagarm" type="10003" summary="Address data race in gossip/channel.GenerateMAC()" priority="3" resolution="10000" status="6" created="2019-03-04 14:51:16.0" updated="2019-03-05 15:35:10.0" resolutiondate="2019-03-05 15:35:10.0" votes="0" watches="1" workflowId="49799"> <description><! CDATA ================== WARNING: DATA RACE Write at 0x00c0006c92ef by goroutine 29: runtime.slicecopy() /usr/local/go/src/runtime/slice.go:221 +0x0 github.com/hyperledger/fabric/gossip/gossip/channel.GenerateMAC() /Users/hagarmei/golang/src/github.com/hyperledger/fabric/gossip/gossip/channel/channel.go:993 +0xd3 github.com/hyperledger/fabric/gossip/gossip.(*channelState).getGossipChannelByMAC() /Users/hagarmei/golang/src/github.com/hyperledger/fabric/gossip/gossip/chanstate.go:81 +0x20b github.com/hyperledger/fabric/gossip/gossip.(*channelState).lookupChannelForGossipMsg() /Users/hagarmei/golang/src/github.com/hyperledger/fabric/gossip/gossip/chanstate.go:70 +0x168 github.com/hyperledger/fabric/gossip/gossip.(*gossipServiceImpl).gossipBatch() /Users/hagarmei/golang/src/github.com/hyperledger/fabric/gossip/gossip/gossip_impl.go:488 +0x752 github.com/hyperledger/fabric/gossip/gossip.(*gossipServiceImpl).sendGossipBatch() /Users/hagarmei/golang/src/github.com/hyperledger/fabric/gossip/gossip/gossip_impl.go:425 +0x1a8 github.com/hyperledger/fabric/gossip/gossip.(*gossipServiceImpl).sendGossipBatch-fm() /Users/hagarmei/golang/src/github.com/hyperledger/fabric/gossip/gossip/gossip_impl.go:118 +0x5f github.com/hyperledger/fabric/gossip/gossip.(*batchingEmitterImpl).emit() /Users/hagarmei/golang/src/github.com/hyperledger/fabric/gossip/gossip/batcher.go:81 +0x2ab github.com/hyperledger/fabric/gossip/gossip.(*batchingEmitterImpl).periodicEmit() /Users/hagarmei/golang/src/github.com/hyperledger/fabric/gossip/gossip/batcher.go:64 +0xc0  Previous read at 0x00c0006c92e8 by goroutine 217: runtime.slicecopy() /usr/local/go/src/runtime/slice.go:221 +0x0 crypto/sha256.(*digest).Write() /usr/local/go/src/crypto/sha256/sha256.go:221 +0x1dc github.com/hyperledger/fabric/bccsp/sw.(*hasher).Hash() /Users/hagarmei/golang/src/github.com/hyperledger/fabric/bccsp/sw/hash.go:31 +0x8c github.com/hyperledger/fabric/bccsp/sw.(*CSP).Hash() /Users/hagarmei/golang/src/github.com/hyperledger/fabric/bccsp/sw/impl.go:188 +0x255 github.com/hyperledger/fabric/common/util.ComputeSHA256() /Users/hagarmei/golang/src/github.com/hyperledger/fabric/common/util/utils.go:46 +0xbe github.com/hyperledger/fabric/gossip/gossip/channel.GenerateMAC() /Users/hagarmei/golang/src/github.com/hyperledger/fabric/gossip/gossip/channel/channel.go:994 +0xf5 github.com/hyperledger/fabric/gossip/gossip/channel.(*gossipChannel).createStateInfoRequest() /Users/hagarmei/golang/src/github.com/hyperledger/fabric/gossip/gossip/channel/channel.go:832 +0xdd github.com/hyperledger/fabric/gossip/gossip/channel.(*gossipChannel).requestStateInfo() /Users/hagarmei/golang/src/github.com/hyperledger/fabric/gossip/gossip/channel/channel.go:376 +0x53 github.com/hyperledger/fabric/gossip/gossip/channel.(*gossipChannel).requestStateInfo-fm() /Users/hagarmei/golang/src/github.com/hyperledger/fabric/gossip/gossip/channel/channel.go:278 +0x41 github.com/hyperledger/fabric/gossip/gossip/channel.(*gossipChannel).periodicalInvocation() /Users/hagarmei/golang/src/github.com/hyperledger/fabric/gossip/gossip/channel/channel.go:314 +0x4e  Goroutine 29 (running) created at: github.com/hyperledger/fabric/gossip/gossip.newBatchingEmitter() /Users/hagarmei/golang/src/github.com/hyperledger/fabric/gossip/gossip/batcher.go:54 +0x2ad github.com/hyperledger/fabric/gossip/gossip.NewGossipService() /Users/hagarmei/golang/src/github.com/hyperledger/fabric/gossip/gossip/gossip_impl.go:116 +0xea8 github.com/hyperledger/fabric/gossip/gossip.newGossipInstanceWithGrpcMcsMetrics() /Users/hagarmei/golang/src/github.com/hyperledger/fabric/gossip/gossip/gossip_test.go:269 +0x8ec github.com/hyperledger/fabric/gossip/gossip.TestMembershipMetrics() /Users/hagarmei/golang/src/github.com/hyperledger/fabric/gossip/gossip/gossip_test.go:1802 +0x46a testing.tRunner() /usr/local/go/src/testing/testing.go:827 +0x162  Goroutine 217 (running) created at: github.com/hyperledger/fabric/gossip/gossip/channel.NewGossipChannel() /Users/hagarmei/golang/src/github.com/hyperledger/fabric/gossip/gossip/channel/channel.go:278 +0xea8 github.com/hyperledger/fabric/gossip/gossip.(*channelState).joinChannel() /Users/hagarmei/golang/src/github.com/hyperledger/fabric/gossip/gossip/chanstate.go:108 +0x53a github.com/hyperledger/fabric/gossip/gossip.(*gossipServiceImpl).JoinChan() /Users/hagarmei/golang/src/github.com/hyperledger/fabric/gossip/gossip/gossip_impl.go:185 +0x121 github.com/hyperledger/fabric/gossip/gossip.(*gossipGRPC).JoinChan() <autogenerated>:1 +0x8f github.com/hyperledger/fabric/gossip/gossip.TestMembershipMetrics() /Users/hagarmei/golang/src/github.com/hyperledger/fabric/gossip/gossip/gossip_test.go:1803 +0x51b testing.tRunner() /usr/local/go/src/testing/testing.go:827 +0x162 ==================  ></description> </Issue>
