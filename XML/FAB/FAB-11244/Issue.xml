<Issue id="32081" key="FAB-11244" number="11244" project="10002" reporter="denyeart" assignee="manish-sethi" creator="denyeart" type="10004" summary="Nil pointer when passing empty string to getHistoryForKey()" priority="3" resolution="10000" status="6" created="2018-07-20 12:08:48.0" updated="2019-08-13 17:59:37.0" resolutiondate="2018-09-29 15:04:40.0" votes="0" watches="4" workflowId="35984" security="10000"> <description><! CDATA From mailing list 7/19/2018:  Getting the following error when passing an empty string, “”, to ChaincodeStub.getHistoryForKey() in NodeJS chaincode (1.1) using levelDB (seems to be fine with CouchDB). Don’t have much of a use-case for passing an empty string, but thought I would bring this up since I observed that this error brings down the peer and thus also the chaincode containers:  2018-07-19 18:01:05.366 UTC  chaincode  processStream -> DEBU 209c  134e4e3f Received message GET_HISTORY_FOR_KEY from shim  2018-07-19 18:01:05.366 UTC  chaincode  handleMessage -> DEBU 209d  134e4e3f Fabric side Handling ChaincodeMessage of type: GET_HISTORY_FOR_KEY in state ready  2018-07-19 18:01:05.366 UTC  chaincode  afterGetHistoryForKey -> DEBU 209e Received GET_HISTORY_FOR_KEY, invoking get state from ledger  2018-07-19 18:01:05.366 UTC  chaincode  afterGetHistoryForKey -> DEBU 209f Exiting GET_HISTORY_FOR_KEY  2018-07-19 18:01:05.366 UTC  chaincode  filterError -> DEBU 20a0 Ignoring NoTransitionError: no transition  2018-07-19 18:01:05.366 UTC  leveldbhelper  GetIterator -> DEBU 20a1 Getting iterator for range    byte\{0x77, 0x65, 0x6c, 0x6c, 0x6c, 0x69, 0x6e, 0x63, 0x2d, 0x31, 0x73, 0x69, 0x6e, 0x67, 0x6c, 0x65, 0x68, 0x6f, 0x73, 0x74, 0x0, 0x77, 0x6c, 0x63, 0x68, 0x61, 0x69, 0x6e, 0x63, 0x6f, 0x64, 0x65, 0x0, 0x0}  -    byte\{0x77, 0x65, 0x6c, 0x6c, 0x6c, 0x69, 0x6e, 0x63, 0x2d, 0x31, 0x73, 0x69, 0x6e, 0x67, 0x6c, 0x65, 0x68, 0x6f, 0x73, 0x74, 0x0, 0x77, 0x6c, 0x63, 0x68, 0x61, 0x69, 0x6e, 0x63, 0x6f, 0x64, 0x65, 0x0, 0x0, 0xff}   panic: runtime error: slice bounds out of range          panic: runtime error: invalid memory address or nil pointer dereference   signal SIGSEGV: segmentation violation code=0x1 addr=0x28 pc=0xbae1b0      goroutine 1651  running :  github.com/hyperledger/fabric/core/chaincode.(*Handler).handleGetHistoryForKey.func1.1(0xc420347a80, 0xc424564b40, 0xc421a2fee8)          /opt/gopath/src/github.com/hyperledger/fabric/core/chaincode/handler.go:1102 +0x60  panic(0xdc3e40, 0x1642100)          /opt/go/src/runtime/panic.go:491 +0x283  github.com/hyperledger/fabric/common/ledger/util.DecodeOrderPreservingVarUint64(0xc4244a6482, 0xb5, 0xbe, 0xc42452d2d0, 0xd)          /opt/gopath/src/github.com/hyperledger/fabric/common/ledger/util/util.go:59 +0xd9  github.com/hyperledger/fabric/core/ledger/kvledger/history/historydb/historyleveldb.(*historyScanner).Next(0xc424565f20, 0xc4245de450, 0xc42453f800, 0x24, 0xc4245a9408)          /opt/gopath/src/github.com/hyperledger/fabric/core/ledger/kvledger/history/historydb/historyleveldb/historyleveldb_query_executer.go:79 +0xe8  github.com/hyperledger/fabric/core/chaincode.getQueryResponse(0xc420347a80, 0xc424549da0, 0x165f0c0, 0xc424565f20, 0xc42453f800, 0x24, 0xc424565f20, 0x0, 0x0)          /opt/gopath/src/github.com/hyperledger/fabric/core/chaincode/handler.go:770 +0x91  github.com/hyperledger/fabric/core/chaincode.(*Handler).handleGetHistoryForKey.func1(0xc420347a80, 0xc424564b40)          /opt/gopath/src/github.com/hyperledger/fabric/core/chaincode/handler.go:1141 +0x69b  created by github.com/hyperledger/fabric/core/chaincode.(*Handler).handleGetHistoryForKey          /opt/gopath/src/github.com/hyperledger/fabric/core/chaincode/handler.go:1089 +0x49  ></description> </Issue>
