<Action id="55910" issue="36965" author="guoger" type="comment" created="2019-01-21 13:55:35.0" updateauthor="guoger" updated="2019-01-21 13:58:13.0"> <body><! CDATA This issue could be rephrased to: {quote} When a node, either leader or follower, is down and restarted, *AND* there is *no* traffic happened during its offline, it most likely will campaign and be elected as new leader {quote}  Suppose we have a network of node A, B, C, where A is offline, and B is the leader among B & C.  The reason is that when A is offline, B attempts to establish connection with A to send Heartbeats, *with exponential backoff*. However, when A is restarted, it *instantly establish connection with B and C*. While B is still waiting for backoff, A most likely will start campaign after {{ElectionTimeout}}. Since there was no traffic during A's offline, *the raft log index was not advanced*, and there's no reason for C to reject A's Vote Request. Therefore, A can be elected as new leader.  However, i don't see this happen very often, unless the network is super idle. Otherwise, we need to devise something at communication layer...  I think this *is* an issue, however with relatively low priority.  cc  ~yacovm   ~kchristidis   ~scottz   ></body> </Action>
<Action id="55930" issue="36965" author="scottz" type="comment" body="Even with plenty of traffic in the application channels, there could easily be zero transactions on the orderersystemchannel, which means the orderersystemchannel would elect a new leader every time an orderer recovers. Would the new orderer become leader of the channel ONLY when zero blocks were cut while the orderer had been down/disconnected?" created="2019-01-21 15:37:52.0" updateauthor="scottz" updated="2019-01-21 15:37:52.0"/>
<Action id="55936" issue="36965" author="guoger" type="comment" created="2019-01-21 16:31:20.0" updateauthor="guoger" updated="2019-01-21 16:31:20.0"> <body><! CDATA {quote} Would the new orderer become leader of the channel ONLY when zero blocks were cut while the orderer had been down/disconnected? {quote} Yes.  {quote} Even with plenty of traffic in the application channels, there could easily be zero transactions on the orderersystemchannel {quote} that's a fair point. for the time being, i think we can afford occasional leader switch in a very idle channel, while we definitely should revisit this later on.   ~scottz   ></body> </Action>
<Action id="55942" issue="36965" author="kchristidis" type="comment" created="2019-01-21 18:09:39.0" updateauthor="kchristidis" updated="2019-01-21 18:09:39.0"> <body><! CDATA Good find, and excellent description of the bug. Thanks!   ~guoger : Thanks for explaining what's going on here. +1 on tackling this a bit later on.  ></body> </Action>
<Action id="55988" issue="36965" author="bmos299" type="comment" body=" ~guoger   ~scottz .  So the net is that if an OSN bounces and there has been no activity on the orderer system channel....the OSN that bounced will most likely become the leader for the orderer system channel as the leader has been in backoff mode sending heartbeats?  I am just asking to get the picture in my head.    Thanks. " created="2019-01-22 13:44:19.0" updateauthor="bmos299" updated="2019-01-22 13:44:19.0"/>
<Action id="56010" issue="36965" author="guoger" type="comment" body=" ~bmos299  yes thatâ€™s accurate" created="2019-01-22 15:03:02.0" updateauthor="guoger" updated="2019-01-22 15:03:02.0"/>
<Action id="56429" issue="36965" author="guoger" type="comment" body="commit ba2bd90 that enables {{CheckQuorum}} fixes this by lease mechanism in raft. Mark it closed" created="2019-01-31 06:29:25.0" updateauthor="guoger" updated="2019-01-31 06:29:25.0"/>
