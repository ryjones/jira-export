<Issue id="17206" key="FAB-4196" number="4196" project="10002" reporter="yacovm" assignee="c0rwin" creator="yacovm" type="10004" summary="delivery service goroutine leak check fails in CI" priority="3" resolution="10000" status="6" created="2017-05-28 14:57:01.0" updated="2018-07-20 14:12:59.0" resolutiondate="2017-06-11 09:07:42.0" votes="0" watches="2" workflowId="38698" security="10001"> <description><! CDATA From: https://jenkins.hyperledger.org/job/fabric-verify-x86_64/12300/console  {code} 13:42:29 unit-tests_1  | 		goroutine 140  select : 13:42:29 unit-tests_1  | 		github.com/hyperledger/fabric/vendor/google.golang.org/grpc/transport.(*recvBufferReader).Read(0xc4202eb0c0, 0xc4202ed110, 0x5, 0x5, 0x0, 0x0, 0x0) 13:42:29 unit-tests_1  | 			/opt/gopath/src/github.com/hyperledger/fabric/vendor/google.golang.org/grpc/transport/transport.go:145 +0x69a 13:42:29 unit-tests_1  | 		github.com/hyperledger/fabric/vendor/google.golang.org/grpc/transport.(*transportReader).Read(0xc4201712f0, 0xc4202ed110, 0x5, 0x5, 0xa505e8, 0xc420072040, 0x0) 13:42:29 unit-tests_1  | 			/opt/gopath/src/github.com/hyperledger/fabric/vendor/google.golang.org/grpc/transport/transport.go:349 +0x55 13:42:29 unit-tests_1  | 		io.ReadAtLeast(0xec6360, 0xc4201712f0, 0xc4202ed110, 0x5, 0x5, 0x5, 0xc42014e300, 0xc420106900, 0x5) 13:42:29 unit-tests_1  | 			/opt/go/src/io/io.go:307 +0xa4 13:42:29 unit-tests_1  | 		io.ReadFull(0xec6360, 0xc4201712f0, 0xc4202ed110, 0x5, 0x5, 0x0, 0x0, 0xc42004dae8) 13:42:29 unit-tests_1  | 			/opt/go/src/io/io.go:325 +0x58 13:42:29 unit-tests_1  | 		github.com/hyperledger/fabric/vendor/google.golang.org/grpc/transport.(*Stream).Read(0xc420106900, 0xc4202ed110, 0x5, 0x5, 0xc42005e000, 0x7f0eccf62960, 0x0) 13:42:29 unit-tests_1  | 			/opt/gopath/src/github.com/hyperledger/fabric/vendor/google.golang.org/grpc/transport/transport.go:333 +0xa8 13:42:29 unit-tests_1  | 		github.com/hyperledger/fabric/vendor/google.golang.org/grpc.(*parser).recvMsg(0xc4202ed100, 0x6400000, 0x0, 0x1300000000, 0x61aaf0, 0xc420403ba0, 0xc420310be0, 0xc420359300) 13:42:29 unit-tests_1  | 			/opt/gopath/src/github.com/hyperledger/fabric/vendor/google.golang.org/grpc/rpc_util.go:280 +0x6b 13:42:29 unit-tests_1  | 		github.com/hyperledger/fabric/vendor/google.golang.org/grpc.recv(0xc4202ed100, 0xecf3a0, 0xf07b60, 0xc420106900, 0x0, 0x0, 0x9b2240, 0xc4202dae30, 0x6400000, 0x0, ...) 13:42:29 unit-tests_1  | 			/opt/gopath/src/github.com/hyperledger/fabric/vendor/google.golang.org/grpc/rpc_util.go:376 +0x4d 13:42:29 unit-tests_1  | 		github.com/hyperledger/fabric/vendor/google.golang.org/grpc.(*clientStream).RecvMsg(0xc42016cc60, 0x9b2240, 0xc4202dae30, 0x0, 0x0) 13:42:29 unit-tests_1  | 			/opt/gopath/src/github.com/hyperledger/fabric/vendor/google.golang.org/grpc/stream.go:393 +0xf6 13:42:29 unit-tests_1  | 		github.com/hyperledger/fabric/protos/orderer.(*atomicBroadcastDeliverClient).Recv(0xc420306a30, 0x300430b00, 0xc42005e000, 0x10) 13:42:29 unit-tests_1  | 			/opt/gopath/src/github.com/hyperledger/fabric/protos/orderer/ab.pb.go:523 +0x62 13:42:29 unit-tests_1  | 		github.com/hyperledger/fabric/core/deliverservice.(*broadcastClient).Recv.func1(0x592ad3b7, 0xcea7234, 0xc42004dd20, 0x485097) 13:42:29 unit-tests_1  | 			github.com/hyperledger/fabric/core/deliverservice/_test/_obj_test/client.go:60 +0x67 13:42:29 unit-tests_1  | 		github.com/hyperledger/fabric/core/deliverservice.(*broadcastClient).doAction(0xc42035db00, 0xc42004de00, 0xeea860, 0xa0364b, 0x0, 0x0) 13:42:29 unit-tests_1  | 			github.com/hyperledger/fabric/core/deliverservice/_test/_obj_test/client.go:131 +0x51 13:42:29 unit-tests_1  | 		github.com/hyperledger/fabric/core/deliverservice.(*broadcastClient).try(0xc42035db00, 0xc42004de00, 0x1, 0xc42004de10, 0x540261, 0x5086a1) 13:42:29 unit-tests_1  | 			github.com/hyperledger/fabric/core/deliverservice/_test/_obj_test/client.go:96 +0xc0 13:42:29 unit-tests_1  | 		github.com/hyperledger/fabric/core/deliverservice.(*broadcastClient).Recv(0xc42035db00, 0xc420359300, 0x2c, 0xc4202216b0) 13:42:29 unit-tests_1  | 			github.com/hyperledger/fabric/core/deliverservice/_test/_obj_test/client.go:61 +0x5d 13:42:29 unit-tests_1  | 		github.com/hyperledger/fabric/core/deliverservice/blocksprovider.(*blocksProviderImpl).DeliverBlocks(0xc42036cf00) 13:42:29 unit-tests_1  | 			/opt/gopath/src/github.com/hyperledger/fabric/core/deliverservice/blocksprovider/blocksprovider.go:118 +0x9e 13:42:29 unit-tests_1  | 		created by github.com/hyperledger/fabric/core/deliverservice.(*deliverServiceImpl).StartDeliverForChannel 13:42:29 unit-tests_1  | 			github.com/hyperledger/fabric/core/deliverservice/_test/_obj_test/deliveryclient.go:149 +0x747 {code}  A smoking gun here is the log that says: {code} 13:42:29 unit-tests_1  | 2017-05-28 13:42:02.704 UTC  blocksProvider  DeliverBlocks -> WARN 037  TEST_CHAINID  Receive error: Client is closing 13:42:29 unit-tests_1  | 2017-05-28 13:42:11.211 UTC  ConnProducer  NewConnection -> ERRO 038 Failed connecting to localhost:5613 , error: context deadline exceeded 13:42:29 unit-tests_1  | 2017-05-28 13:42:15.214 UTC  ConnProducer  NewConnection -> ERRO 039 Failed connecting to localhost:5612 , error: context deadline exceeded {code}   ~C0rWin   ></description> </Issue>
