<Issue id="38246" key="FAB-14510" number="14510" project="10002" reporter="hagarm" assignee="hagarm" creator="hagarm" type="10003" summary="Address data races in gossip/comm/conn" priority="3" resolution="10000" status="6" created="2019-03-06 13:41:37.0" updated="2019-03-13 17:12:26.0" resolutiondate="2019-03-13 17:12:26.0" votes="0" watches="1" workflowId="49873"> <description><! CDATA ================== WARNING: DATA RACE Write at 0x00c0004cecd0 by goroutine 1172: github.com/hyperledger/fabric/vendor/google.golang.org/grpc.(*clientStream).CloseSend() /Users/hagarmei/golang/src/github.com/hyperledger/fabric/vendor/google.golang.org/grpc/stream.go:751 +0x5e github.com/hyperledger/fabric/protos/gossip.(*gossipGossipStreamClient).CloseSend() <autogenerated>:1 +0x62 github.com/hyperledger/fabric/gossip/comm.(*connection).close() /Users/hagarmei/golang/src/github.com/hyperledger/fabric/gossip/comm/conn.go:256 +0x2b2 github.com/hyperledger/fabric/gossip/comm.(*connectionStore).closeByPKIid() /Users/hagarmei/golang/src/github.com/hyperledger/fabric/gossip/comm/conn.go:194 +0x19b github.com/hyperledger/fabric/gossip/comm.(*connectionStore).shutdown.func1() /Users/hagarmei/golang/src/github.com/hyperledger/fabric/gossip/comm/conn.go:161 +0x88  Previous read at 0x00c0004cecd0 by goroutine 680: github.com/hyperledger/fabric/vendor/google.golang.org/grpc.(*clientStream).SendMsg() /Users/hagarmei/golang/src/github.com/hyperledger/fabric/vendor/google.golang.org/grpc/stream.go:668 +0xf8 github.com/hyperledger/fabric/protos/gossip.(*gossipGossipStreamClient).Send() /Users/hagarmei/golang/src/github.com/hyperledger/fabric/protos/gossip/message.pb.go:2725 +0x6a github.com/hyperledger/fabric/gossip/comm.(*connection).writeToStream() /Users/hagarmei/golang/src/github.com/hyperledger/fabric/gossip/comm/conn.go:332 +0x2d6  Goroutine 1172 (running) created at: github.com/hyperledger/fabric/gossip/comm.(*connectionStore).shutdown() /Users/hagarmei/golang/src/github.com/hyperledger/fabric/gossip/comm/conn.go:160 +0x36a github.com/hyperledger/fabric/gossip/comm.(*commImpl).Stop() /Users/hagarmei/golang/src/github.com/hyperledger/fabric/gossip/comm/comm_impl.go:375 +0x206 github.com/hyperledger/fabric/gossip/comm.(*commGRPC).Stop() /Users/hagarmei/golang/src/github.com/hyperledger/fabric/gossip/comm/comm_test.go:152 +0x4b github.com/hyperledger/fabric/gossip/comm.TestMetrics() /Users/hagarmei/golang/src/github.com/hyperledger/fabric/gossip/comm/metrics_test.go:87 +0x7bd testing.tRunner() /usr/local/go/src/testing/testing.go:827 +0x162  Goroutine 680 (running) created at: github.com/hyperledger/fabric/gossip/comm.(*connection).serviceConnection() /Users/hagarmei/golang/src/github.com/hyperledger/fabric/gossip/comm/conn.go:306 +0x13b ================== --- FAIL: TestMetrics (0.43s)  ></description> </Issue>
