<Issue id="34636" key="FAB-12436" number="12436" project="10002" reporter="sykesm" assignee="manish-sethi" creator="sykesm" type="10004" summary="Data race related to viper in ledger tests" priority="3" resolution="10000" status="6" created="2018-10-12 15:33:50.0" updated="2019-03-19 10:57:41.0" resolutiondate="2018-10-13 11:23:00.0" votes="0" watches="2" workflowId="46040"> <description><! CDATA {code} unit-tests_1  | ================== unit-tests_1  | WARNING: DATA RACE unit-tests_1  | Write at 0x00c0002087b0 by goroutine 40: unit-tests_1  |   runtime.mapassign_faststr() unit-tests_1  |       /opt/go/src/runtime/map_faststr.go:190 +0x0 unit-tests_1  |   github.com/hyperledger/fabric/vendor/github.com/spf13/viper.(*Viper).Set() unit-tests_1  |       /opt/gopath/src/github.com/hyperledger/fabric/vendor/github.com/spf13/viper/viper.go:772 +0xc8 unit-tests_1  |   github.com/hyperledger/fabric/vendor/github.com/spf13/viper.Set() unit-tests_1  |       /opt/gopath/src/github.com/hyperledger/fabric/vendor/github.com/spf13/viper/viper.go:768 +0x72 unit-tests_1  |   github.com/hyperledger/fabric/core/ledger/kvledger.createTestEnv() unit-tests_1  |       /opt/gopath/src/github.com/hyperledger/fabric/core/ledger/kvledger/pkg_test.go:49 +0xe2 unit-tests_1  |   github.com/hyperledger/fabric/core/ledger/kvledger.newTestEnv() unit-tests_1  |       /opt/gopath/src/github.com/hyperledger/fabric/core/ledger/kvledger/pkg_test.go:41 +0x100 unit-tests_1  |   github.com/hyperledger/fabric/core/ledger/kvledger.TestMultipleLedgerBasicRW() unit-tests_1  |       /opt/gopath/src/github.com/hyperledger/fabric/core/ledger/kvledger/kv_ledger_provider_test.go:140 +0x5f unit-tests_1  |   testing.tRunner() unit-tests_1  |       /opt/go/src/testing/testing.go:827 +0x162 unit-tests_1  |  unit-tests_1  | Previous read at 0x00c0002087b0 by goroutine 153: unit-tests_1  |   runtime.mapaccess2_faststr() unit-tests_1  |       /opt/go/src/runtime/map_faststr.go:101 +0x0 unit-tests_1  |   github.com/hyperledger/fabric/vendor/github.com/spf13/viper.(*Viper).find() unit-tests_1  |       /opt/gopath/src/github.com/hyperledger/fabric/vendor/github.com/spf13/viper/viper.go:628 +0x173 unit-tests_1  |   github.com/hyperledger/fabric/vendor/github.com/spf13/viper.(*Viper).Get() unit-tests_1  |       /opt/gopath/src/github.com/hyperledger/fabric/vendor/github.com/spf13/viper/viper.go:407 +0x9eb unit-tests_1  |   github.com/hyperledger/fabric/vendor/github.com/spf13/viper.(*Viper).GetInt() unit-tests_1  |       /opt/gopath/src/github.com/hyperledger/fabric/vendor/github.com/spf13/viper/viper.go:463 +0x4c unit-tests_1  |   github.com/hyperledger/fabric/vendor/github.com/spf13/viper.GetInt() unit-tests_1  |       /opt/gopath/src/github.com/hyperledger/fabric/vendor/github.com/spf13/viper/viper.go:461 +0x5e unit-tests_1  |   github.com/hyperledger/fabric/core/ledger/ledgerconfig.GetPvtdataStoreCollElgProcDbBatchesInterval() unit-tests_1  |       /opt/gopath/src/github.com/hyperledger/fabric/core/ledger/ledgerconfig/ledger_config.go:144 +0x6f unit-tests_1  |   github.com/hyperledger/fabric/core/ledger/pvtdatastorage.(*store).processCollElgEvents() unit-tests_1  |       /opt/gopath/src/github.com/hyperledger/fabric/core/ledger/pvtdatastorage/store_impl.go:453 +0x9e unit-tests_1  |   github.com/hyperledger/fabric/core/ledger/pvtdatastorage.(*store).launchCollElgProc.func1() unit-tests_1  |       /opt/gopath/src/github.com/hyperledger/fabric/core/ledger/pvtdatastorage/store_impl.go:440 +0x3c unit-tests_1  |  unit-tests_1  | Goroutine 40 (running) created at: unit-tests_1  |   testing.(*T).Run() unit-tests_1  |       /opt/go/src/testing/testing.go:878 +0x650 unit-tests_1  |   testing.runTests.func1() unit-tests_1  |       /opt/go/src/testing/testing.go:1119 +0xa8 unit-tests_1  |   testing.tRunner() unit-tests_1  |       /opt/go/src/testing/testing.go:827 +0x162 unit-tests_1  |   testing.runTests() unit-tests_1  |       /opt/go/src/testing/testing.go:1117 +0x4ee unit-tests_1  |   testing.(*M).Run() unit-tests_1  |       /opt/go/src/testing/testing.go:1034 +0x2ee unit-tests_1  |   github.com/hyperledger/fabric/core/ledger/kvledger.TestMain() unit-tests_1  |       /opt/gopath/src/github.com/hyperledger/fabric/core/ledger/kvledger/kv_ledger_test.go:38 +0x193 unit-tests_1  |   main.main() unit-tests_1  |       _testmain.go:116 +0x32e unit-tests_1  |  unit-tests_1  | Goroutine 153 (running) created at: unit-tests_1  |   github.com/hyperledger/fabric/core/ledger/pvtdatastorage.(*store).launchCollElgProc() unit-tests_1  |       /opt/gopath/src/github.com/hyperledger/fabric/core/ledger/pvtdatastorage/store_impl.go:439 +0x4c unit-tests_1  |   github.com/hyperledger/fabric/core/ledger/pvtdatastorage.(*provider).OpenStore() unit-tests_1  |       /opt/gopath/src/github.com/hyperledger/fabric/core/ledger/pvtdatastorage/store_impl.go:102 +0x29e unit-tests_1  |   github.com/hyperledger/fabric/core/ledger/ledgerstorage.(*Provider).Open() unit-tests_1  |       /opt/gopath/src/github.com/hyperledger/fabric/core/ledger/ledgerstorage/store.go:68 +0xf5 unit-tests_1  |   github.com/hyperledger/fabric/core/ledger/kvledger.(*Provider).openInternal() unit-tests_1  |       /opt/gopath/src/github.com/hyperledger/fabric/core/ledger/kvledger/kv_ledger_provider.go:150 +0xa0 unit-tests_1  |   github.com/hyperledger/fabric/core/ledger/kvledger.(*Provider).recoverUnderConstructionLedger() unit-tests_1  |       /opt/gopath/src/github.com/hyperledger/fabric/core/ledger/kvledger/kv_ledger_provider.go:211 +0x214 unit-tests_1  |   github.com/hyperledger/fabric/core/ledger/kvledger.(*Provider).Initialize() unit-tests_1  |       /opt/gopath/src/github.com/hyperledger/fabric/core/ledger/kvledger/kv_ledger_provider.go:94 +0x387 unit-tests_1  |   github.com/hyperledger/fabric/vendor/github.com/syndtr/goleveldb/leveldb/storage.fsParseName() unit-tests_1  |       /opt/gopath/src/github.com/hyperledger/fabric/vendor/github.com/syndtr/goleveldb/leveldb/storage/file_storage.go:643 +0x144 {code}  /cc  ~manish-sethi ,  ~denyeart   ></description> </Issue>
