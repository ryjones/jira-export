<Issue id="43465" key="FAB-17151" number="17151" project="10002" reporter="sykesm" assignee="samyuan1990" creator="sykesm" type="10004" summary="Some test(s) that use privacyenabledstate.LevelDBCommonStorageTestEnv are not cleaning up temporary directories" priority="3" resolution="10001" status="6" created="2019-11-26 16:13:00.0" updated="2020-01-16 18:40:38.0" resolutiondate="2020-01-16 18:40:38.0" votes="0" watches="2" workflowId="56579"> <description><! CDATA My tmpfs filled up today. When I looked in the directory, I found hundreds of entries that looked like this: {code} cstestenv072366535 cstestenv074520508 cstestenv076032059 cstestenv077341542 cstestenv091877446 cstestenv104409189 cstestenv104890682 cstestenv115057085 cstestenv120858038 cstestenv125365950 cstestenv126977062 cstestenv138696046 cstestenv153095697 cstestenv164608714 cstestenv181554453 cstestenv183530194 cstestenv188863274 cstestenv196294917 cstestenv224370685 cstestenv288701315 cstestenv312191459 cstestenv313577638 cstestenv329698434 cstestenv331762666 cstestenv341185534 cstestenv350604082 cstestenv365473810 cstestenv379606714 cstestenv384572262 {code}  It appears these directories are being created by the following test helper code in the privacyenabledstate package: {code} // Init implements corresponding function from interface TestEnv func (env *LevelDBCommonStorageTestEnv) Init(t testing.TB) { 	dbPath, err := ioutil.TempDir("", "cstestenv") 	if err != nil { 		t.Fatalf("Failed to create level db storage directory: %s", err) 	} {code}  There is a corresponding {{Cleanup}} method on {{LevelDBCommonStorageTestEnv}} but one or more tests do not appear to be calling it.  The following files seem to reference the helper object: {code} core/ledger/kvledger/txmgmt/validator/internal/tx_ops_preparation_test.go core/ledger/kvledger/txmgmt/validator/statebasedval/state_based_validator_test.go core/ledger/kvledger/txmgmt/validator/valimpl/helper_test.go core/ledger/kvledger/txmgmt/validator/internal/val_test.go core/ledger/kvledger/txmgmt/pvtstatepurgemgmt/purge_mgr_test.go core/ledger/kvledger/txmgmt/txmgr/lockbasedtxmgr/pkg_test.go core/ledger/kvledger/history/pkg_test.go {code}  ></description> </Issue>
