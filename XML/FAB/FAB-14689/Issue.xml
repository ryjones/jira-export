<Issue id="38537" key="FAB-14689" number="14689" project="10002" reporter="hagarm" assignee="hagarm" creator="hagarm" type="10003" summary="Address data races in gossip msgstore and certstore" priority="3" resolution="10000" status="6" created="2019-03-17 09:45:35.0" updated="2019-03-18 15:42:10.0" resolutiondate="2019-03-18 15:42:10.0" votes="0" watches="1" workflowId="50180"> <description><! CDATA WARNING: DATA RACE Write at 0x00c00022f358 by goroutine 41: github.com/hyperledger/fabric/gossip/gossip.TestCertRevocation() /Users/hagarmei/golang/src/github.com/hyperledger/fabric/gossip/gossip/certstore_test.go:148 +0x2ed github.com/hyperledger/fabric/gossip/gossip.TestCertRevocation() /Users/hagarmei/golang/src/github.com/hyperledger/fabric/gossip/gossip/certstore_test.go:138 +0x1b5 testing.tRunner() /usr/local/go/src/testing/testing.go:827 +0x162  Previous write at 0x00c00022f358 by goroutine 47: sync/atomic.AddInt32() /usr/local/go/src/runtime/race_amd64.s:269 +0xb sync.(*Mutex).Unlock() /usr/local/go/src/sync/mutex.go:182 +0x54 github.com/hyperledger/fabric/vendor/github.com/stretchr/testify/mock.(*Mock).MethodCalled() /Users/hagarmei/golang/src/github.com/hyperledger/fabric/vendor/github.com/stretchr/testify/mock/mock.go:396 +0x52f github.com/hyperledger/fabric/vendor/github.com/stretchr/testify/mock.(*Mock).Called() /Users/hagarmei/golang/src/github.com/hyperledger/fabric/vendor/github.com/stretchr/testify/mock/mock.go:333 +0x18c github.com/hyperledger/fabric/gossip/gossip.(*senderMock).Send() /Users/hagarmei/golang/src/github.com/hyperledger/fabric/gossip/gossip/certstore_test.go:78 +0x127 github.com/hyperledger/fabric/gossip/gossip/pull.(*pullMediatorImpl).SendReq() /Users/hagarmei/golang/src/github.com/hyperledger/fabric/gossip/gossip/pull/pullstore.go:330 +0x841 github.com/hyperledger/fabric/gossip/gossip/algo.(*PullEngine).processIncomingDigests() /Users/hagarmei/golang/src/github.com/hyperledger/fabric/gossip/gossip/algo/pull.go:211 +0x6ee github.com/hyperledger/fabric/gossip/gossip/algo.(*PullEngine).initiatePull.func1() /Users/hagarmei/golang/src/github.com/hyperledger/fabric/gossip/gossip/algo/pull.go:187 +0x41  Goroutine 41 (running) created at: testing.(*T).Run() /usr/local/go/src/testing/testing.go:878 +0x659 testing.runTests.func1() /usr/local/go/src/testing/testing.go:1119 +0xa8 testing.tRunner() /usr/local/go/src/testing/testing.go:827 +0x162 testing.runTests() /usr/local/go/src/testing/testing.go:1117 +0x4ee testing.(*M).Run() /usr/local/go/src/testing/testing.go:1034 +0x2ee main.main() _testmain.go:152 +0x332  Goroutine 47 (finished) created at: time.goFunc() /usr/local/go/src/time/sleep.go:172 +0x51 ================== --- FAIL: TestCertRevocation (7.19s)        WARNING: DATA RACE Write at 0x00c0001b72e0 by goroutine 17: github.com/hyperledger/fabric/gossip/gossip/msgstore.TestExpiration.func1() /Users/hagarmei/golang/src/github.com/hyperledger/fabric/gossip/gossip/msgstore/msgs_test.go:151 +0x100 github.com/hyperledger/fabric/gossip/gossip/msgstore.(*messageStoreImpl).expireMessages() /Users/hagarmei/golang/src/github.com/hyperledger/fabric/gossip/gossip/msgstore/msgs.go:212 +0x611 github.com/hyperledger/fabric/gossip/gossip/msgstore.(*messageStoreImpl).expirationRoutine() /Users/hagarmei/golang/src/github.com/hyperledger/fabric/gossip/gossip/msgstore/msgs.go:253 +0x205  Previous read at 0x00c0001b72e0 by goroutine 12: github.com/hyperledger/fabric/gossip/gossip/msgstore.TestExpiration() /Users/hagarmei/golang/src/github.com/hyperledger/fabric/gossip/gossip/msgstore/msgs_test.go:181 +0x8dd testing.tRunner() /usr/local/go/src/testing/testing.go:827 +0x162  Goroutine 17 (running) created at: github.com/hyperledger/fabric/gossip/gossip/msgstore.NewMessageStoreExpirable() /Users/hagarmei/golang/src/github.com/hyperledger/fabric/gossip/gossip/msgstore/msgs.go:53 +0x115 github.com/hyperledger/fabric/gossip/gossip/msgstore.TestExpiration() /Users/hagarmei/golang/src/github.com/hyperledger/fabric/gossip/gossip/msgstore/msgs_test.go:150 +0x199 testing.tRunner() /usr/local/go/src/testing/testing.go:827 +0x162  Goroutine 12 (running) created at: testing.(*T).Run() /usr/local/go/src/testing/testing.go:878 +0x659 testing.runTests.func1() /usr/local/go/src/testing/testing.go:1119 +0xa8 testing.tRunner() /usr/local/go/src/testing/testing.go:827 +0x162 testing.runTests() /usr/local/go/src/testing/testing.go:1117 +0x4ee testing.(*M).Run() /usr/local/go/src/testing/testing.go:1034 +0x2ee main.main() _testmain.go:106 +0x332 ================== --- FAIL: TestExpiration (8.01s)  ></description> </Issue>
