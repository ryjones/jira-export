<Issue id="30765" key="FABG-338" number="338" project="10610" reporter="bstasyszyn" assignee="bstasyszyn" creator="bstasyszyn" type="10004" summary="Data race in configless test" priority="3" resolution="10000" status="6" created="2018-05-31 12:18:28.0" updated="2018-07-18 23:52:33.0" resolutiondate="2018-05-31 16:55:19.0" votes="0" watches="1" workflowId="33137"> <description><! CDATA 00:52:48 integration-tests_1  | ok  	github.com/hyperledger/fabric-sdk-go/test/integration/e2e	18.796s 00:52:51 integration-tests_1  | ================== 00:52:51 integration-tests_1  | WARNING: DATA RACE 00:52:51 integration-tests_1  | Write at 0x0000013e7050 by goroutine 7: 00:52:51 integration-tests_1  |   github.com/hyperledger/fabric-sdk-go/pkg/core/config/endpoint.(*TLSConfig).LoadBytes() 00:52:51 integration-tests_1  |       /opt/gopath/src/github.com/hyperledger/fabric-sdk-go/pkg/core/config/endpoint/endpoint.go:101 +0x1f9 00:52:51 integration-tests_1  |   github.com/hyperledger/fabric-sdk-go/test/integration/e2e/configless.(*exampleTLSClientCerts).TLSClientCerts() 00:52:51 integration-tests_1  |       /opt/gopath/src/github.com/hyperledger/fabric-sdk-go/test/integration/e2e/configless/endpointconfig_override_test.go:739 +0xd8 00:52:51 integration-tests_1  |   github.com/hyperledger/fabric-sdk-go/pkg/fab.(*EndpointConfigOptions).TLSClientCerts() 00:52:51 integration-tests_1  |       <autogenerated>:1 +0x6c 00:52:51 integration-tests_1  |   github.com/hyperledger/fabric-sdk-go/pkg/core/config/comm.TLSConfig() 00:52:51 integration-tests_1  |       /opt/gopath/src/github.com/hyperledger/fabric-sdk-go/pkg/core/config/comm/comm.go:38 +0x154 00:52:51 integration-tests_1  |   github.com/hyperledger/fabric-sdk-go/pkg/fab/orderer.New() 00:52:51 integration-tests_1  |       /opt/gopath/src/github.com/hyperledger/fabric-sdk-go/pkg/fab/orderer/orderer.go:78 +0x47a 00:52:51 integration-tests_1  |   github.com/hyperledger/fabric-sdk-go/pkg/fabsdk/provider/fabpvdr.(*InfraProvider).CreateOrdererFromConfig() 00:52:51 integration-tests_1  |       /opt/gopath/src/github.com/hyperledger/fabric-sdk-go/pkg/fabsdk/provider/fabpvdr/fabpvdr.go:61 +0xfc 00:52:51 integration-tests_1  |   github.com/hyperledger/fabric-sdk-go/pkg/fab/channel.orderersFromChannel() 00:52:51 integration-tests_1  |       /opt/gopath/src/github.com/hyperledger/fabric-sdk-go/pkg/fab/channel/transactor.go:130 +0x215 00:52:51 integration-tests_1  |   github.com/hyperledger/fabric-sdk-go/pkg/fab/channel.orderersFromChannelCfg() 00:52:51 integration-tests_1  |       /opt/gopath/src/github.com/hyperledger/fabric-sdk-go/pkg/fab/channel/transactor.go:60 +0x8e 00:52:51 integration-tests_1  |   github.com/hyperledger/fabric-sdk-go/pkg/fab/channel.NewTransactor() 00:52:51 integration-tests_1  |       /opt/gopath/src/github.com/hyperledger/fabric-sdk-go/pkg/fab/channel/transactor.go:39 +0x9c 00:52:51 integration-tests_1  |   github.com/hyperledger/fabric-sdk-go/pkg/fabsdk/provider/chpvdr.(*ChannelService).Transactor() 00:52:51 integration-tests_1  |       /opt/gopath/src/github.com/hyperledger/fabric-sdk-go/pkg/fabsdk/provider/chpvdr/chprovider.go:281 +0xc5 00:52:51 integration-tests_1  |   github.com/hyperledger/fabric-sdk-go/pkg/client/channel.(*Client).prepareHandlerContexts() 00:52:51 integration-tests_1  |       /opt/gopath/src/github.com/hyperledger/fabric-sdk-go/pkg/client/channel/chclient.go:221 +0x13f 00:52:51 integration-tests_1  |   github.com/hyperledger/fabric-sdk-go/pkg/client/channel.(*Client).InvokeHandler() 00:52:51 integration-tests_1  |       /opt/gopath/src/github.com/hyperledger/fabric-sdk-go/pkg/client/channel/chclient.go:157 +0x2ed 00:52:51 integration-tests_1  |   github.com/hyperledger/fabric-sdk-go/pkg/client/channel.(*Client).Query() 00:52:51 integration-tests_1  |       /opt/gopath/src/github.com/hyperledger/fabric-sdk-go/pkg/client/channel/chclient.go:101 +0x2bc 00:52:51 integration-tests_1  |   github.com/hyperledger/fabric-sdk-go/test/integration/e2e.queryCC() 00:52:51 integration-tests_1  |       /opt/gopath/src/github.com/hyperledger/fabric-sdk-go/test/integration/e2e/end_to_end.go:170 +0x1f4 00:52:51 integration-tests_1  |   github.com/hyperledger/fabric-sdk-go/test/integration/e2e.setupAndRun() 00:52:51 integration-tests_1  |       /opt/gopath/src/github.com/hyperledger/fabric-sdk-go/test/integration/e2e/end_to_end.go:85 +0x403 00:52:51 integration-tests_1  |   github.com/hyperledger/fabric-sdk-go/test/integration/e2e.RunWithoutSetup() 00:52:51 integration-tests_1  |       /opt/gopath/src/github.com/hyperledger/fabric-sdk-go/test/integration/e2e/end_to_end.go:48 +0x65 00:52:51 integration-tests_1  |   github.com/hyperledger/fabric-sdk-go/test/integration/e2e/configless.TestE2E() 00:52:51 integration-tests_1  |       /opt/gopath/src/github.com/hyperledger/fabric-sdk-go/test/integration/e2e/configless/end_to_end_test.go:28 +0x18a 00:52:51 integration-tests_1  |   testing.tRunner() 00:52:51 integration-tests_1  |       /opt/go/src/testing/testing.go:746 +0x16c 00:52:51 integration-tests_1  |  00:52:51 integration-tests_1  | Previous write at 0x0000013e7050 by goroutine 8: 00:52:51 integration-tests_1  |   github.com/hyperledger/fabric-sdk-go/pkg/core/config/endpoint.(*TLSConfig).LoadBytes() 00:52:51 integration-tests_1  |       /opt/gopath/src/github.com/hyperledger/fabric-sdk-go/pkg/core/config/endpoint/endpoint.go:101 +0x1f9 00:52:51 integration-tests_1  |   github.com/hyperledger/fabric-sdk-go/test/integration/e2e/configless.(*exampleTLSClientCerts).TLSClientCerts() 00:52:51 integration-tests_1  |       /opt/gopath/src/github.com/hyperledger/fabric-sdk-go/test/integration/e2e/configless/endpointconfig_override_test.go:739 +0xd8 00:52:51 integration-tests_1  |   github.com/hyperledger/fabric-sdk-go/pkg/fab.(*EndpointConfigOptions).TLSClientCerts() 00:52:51 integration-tests_1  |       <autogenerated>:1 +0x6c 00:52:51 integration-tests_1  |   github.com/hyperledger/fabric-sdk-go/pkg/core/config/comm.TLSConfig() 00:52:51 integration-tests_1  |       /opt/gopath/src/github.com/hyperledger/fabric-sdk-go/pkg/core/config/comm/comm.go:38 +0x154 00:52:51 integration-tests_1  |   github.com/hyperledger/fabric-sdk-go/pkg/fab/peer.newPeerEndorser() 00:52:51 integration-tests_1  |       /opt/gopath/src/github.com/hyperledger/fabric-sdk-go/pkg/fab/peer/peerendorser.go:73 +0x2cb 00:52:51 integration-tests_1  |   github.com/hyperledger/fabric-sdk-go/pkg/fab/peer.New() 00:52:51 integration-tests_1  |       /opt/gopath/src/github.com/hyperledger/fabric-sdk-go/pkg/fab/peer/peer.go:71 +0x3e7 00:52:51 integration-tests_1  |   github.com/hyperledger/fabric-sdk-go/pkg/fabsdk/provider/fabpvdr.(*InfraProvider).CreatePeerFromConfig() 00:52:51 integration-tests_1  |       /opt/gopath/src/github.com/hyperledger/fabric-sdk-go/pkg/fabsdk/provider/fabpvdr/fabpvdr.go:56 +0xd9 00:52:51 integration-tests_1  |   github.com/hyperledger/fabric-sdk-go/pkg/fab/chconfig.(*ChannelConfig).calculateTargetsFromConfig() 00:52:51 integration-tests_1  |       /opt/gopath/src/github.com/hyperledger/fabric-sdk-go/pkg/fab/chconfig/chconfig.go:202 +0x26e 00:52:51 integration-tests_1  |   github.com/hyperledger/fabric-sdk-go/pkg/fab/chconfig.(*ChannelConfig).queryPeers() 00:52:51 integration-tests_1  |       /opt/gopath/src/github.com/hyperledger/fabric-sdk-go/pkg/fab/chconfig/chconfig.go:166 +0x983 00:52:51 integration-tests_1  |   github.com/hyperledger/fabric-sdk-go/pkg/fab/chconfig.(*ChannelConfig).Query() 00:52:51 integration-tests_1  |       /opt/gopath/src/github.com/hyperledger/fabric-sdk-go/pkg/fab/chconfig/chconfig.go:145 +0xe5 00:52:51 integration-tests_1  |   github.com/hyperledger/fabric-sdk-go/pkg/fab/chconfig.(*Ref).initializer.func1() 00:52:51 integration-tests_1  |       /opt/gopath/src/github.com/hyperledger/fabric-sdk-go/pkg/fab/chconfig/reference.go:52 +0x32a 00:52:51 integration-tests_1  |   github.com/hyperledger/fabric-sdk-go/pkg/util/concurrent/lazyref.New.func1() 00:52:51 integration-tests_1  |       /opt/gopath/src/github.com/hyperledger/fabric-sdk-go/pkg/util/concurrent/lazyref/lazyref.go:102 +0x53 00:52:51 integration-tests_1  |   github.com/hyperledger/fabric-sdk-go/pkg/util/concurrent/lazyref.(*Reference).refreshValue() 00:52:51 integration-tests_1  |       /opt/gopath/src/github.com/hyperledger/fabric-sdk-go/pkg/util/concurrent/lazyref/lazyref.go:349 +0x4e 00:52:51 integration-tests_1  |   github.com/hyperledger/fabric-sdk-go/pkg/util/concurrent/lazyref.(*Reference).(github.com/hyperledger/fabric-sdk-go/pkg/util/concurrent/lazyref.refreshValue)-fm() 00:52:51 integration-tests_1  |       /opt/gopath/src/github.com/hyperledger/fabric-sdk-go/pkg/util/concurrent/lazyref/options.go:68 +0x41 00:52:51 integration-tests_1  |   github.com/hyperledger/fabric-sdk-go/pkg/util/concurrent/lazyref.(*Reference).handleExpiration() 00:52:51 integration-tests_1  |       /opt/gopath/src/github.com/hyperledger/fabric-sdk-go/pkg/util/concurrent/lazyref/lazyref.go:328 +0x11b 00:52:51 integration-tests_1  |   github.com/hyperledger/fabric-sdk-go/pkg/util/concurrent/lazyref.checkTimeStarted() 00:52:51 integration-tests_1  |       /opt/gopath/src/github.com/hyperledger/fabric-sdk-go/pkg/util/concurrent/lazyref/lazyref.go:287 +0x2e1   ></description> </Issue>
