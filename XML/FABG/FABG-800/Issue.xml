<Issue id="35651" key="FABG-800" number="800" project="10610" reporter="gotoxu" assignee="gotoxu" creator="gotoxu" type="10001" summary="Proposal: channel client and resmgmt client use same orderer selection mechanisms" priority="2" resolution="10000" status="6" created="2018-11-28 10:28:45.0" updated="2018-12-22 12:50:54.0" resolutiondate="2018-12-22 12:50:54.0" votes="0" watches="1" workflowId="47125"> <description><! CDATA In the channel client, first query the orderer configuration from the channels section. If not configured, query from the orderers section. {code:java} //代码占位符 func orderersFromChannelCfg(ctx context.Client, cfg fab.ChannelCfg) (  fab.Orderer, error) {     //below call to get orderers from endpoint config 'channels.<CHANNEL ID>.orderers' is not recommended.     //To override any orderer configuration items, entity matchers should be used.     orderers, err := orderersFromChannel(ctx, cfg.ID())     if err != nil {         return nil, err     }     if len(orderers) > 0 {         return orderers, nil     }      ordererDict, err := orderersByTarget(ctx)     if err != nil {         return nil, err     }     // Add orderer if specified in channel config     for _, target := range cfg.Orderers() {         // Figure out orderer configuration         oCfg, ok := ordererDict target          //try entity matcher         if !ok {             logger.Debugf("Failed to get channel Cfg orderer  %s  from ordererDict, now trying orderer Matchers in Entity Matchers", target)             // Try to find a match from entityMatchers config             matchingOrdererConfig, found := ctx.EndpointConfig().OrdererConfig(strings.ToLower(target))             if found {                 logger.Debugf("Found matching ordererConfig from entity Matchers for channel Cfg Orderer  %s ", target)                 oCfg = *matchingOrdererConfig                 ok = true             }         }         //create orderer using channel config block orderer address         if !ok {             logger.Debugf("Unable to find matching ordererConfig from entity Matchers for channel Cfg Orderer  %s ", target)             oCfg = fab.OrdererConfig{                 URL: target,             }             logger.Debugf("Created a new OrdererConfig with URL as  %s ", target)         }          o, err := ctx.InfraProvider().CreateOrdererFromConfig(&oCfg)         if err != nil {             return nil, errors.WithMessage(err, "failed to create orderer from config")         }         orderers = append(orderers, o)     }     return orderers, nil } {code} But in the resmgmt client, it will only be queried from the channels section.    {code:java} //代码占位符 func (rc *Client) ordererConfig(channelID string) (*fab.OrdererConfig, error) {     orderers := rc.ctx.EndpointConfig().ChannelOrderers(channelID)     // TODO: Not sure that we should fallback to global orderers section.     // For now - not doing so.     //if err != nil || len(orderers) == 0 {     //  orderers, err = rc.ctx.Config().OrderersConfig()    //}     if len(orderers) == 0 {         return nil, errors.New("no orderers found")     }      // random channel orderer     randomNumber := rand.Intn(len(orderers))     return &orderers randomNumber , nil }{code}  I can't see what is necessary to do this.  We should unify these two different mechanisms.  ></description> </Issue>
