<Issue id="17867" key="INDY-219" number="219" project="10303" reporter="mgbailey" assignee="danielhardman" creator="mgbailey" type="10004" summary="Sovrin Alpha unstable / unable to add stewards" priority="1" resolution="10000" status="10001" created="2017-06-14 05:42:34.0" updated="2019-03-29 20:33:05.0" resolutiondate="2019-03-29 20:33:05.0" votes="0" watches="4" workflowId="17872"> <description><! CDATA Jason, as trustee was trying to add stewards.  The network was unstable, one of the validator processes went down, and disconnect / reconnect messages were being reported b the CLI.  This must be debugged urgently.  The transcript of the chat session with Jason follows:  jlaw  11:02 PM   So, it connected OK... but I don't know if it actually added the txn.   11:02   >>>sovrin> connect live Active keyring "Default" saved (/home/jlaw/.sovrin/keyrings/no-env/default.wallet) Current active keyring got moved to 'live' environment. Here is the detail: keyring name: Default old location: /home/jlaw/.sovrin/keyrings/no-env/default.wallet new location: /home/jlaw/.sovrin/keyrings/live/default.wallet  Saved keyring "Default" restored (/home/jlaw/.sovrin/keyrings/live/default.wallet) Active keyring set to "Default" Client sovrinwohTc0 initialized with the following node registry: danubeC listens at 128.130.204.35 on port 9722 BIGAWSUSEAST1-001C listens at 34.224.255.108 on port 9796 BYUC listens at 54.71.209.105 on port 9722 ev1C listens at 54.94.255.14 on port 9702 Active client set to sovrinwohTc0 cpRcDUxGvbLGQRvqXTmJozvWXfmfPsPohiEs1D7dh1y listening for other nodes at 0.0.0.0:6101 cpRcDUxGvbLGQRvqXTmJozvWXfmfPsPohiEs1D7dh1y looking for BYUC at 54.71.209.105:9722 cpRcDUxGvbLGQRvqXTmJozvWXfmfPsPohiEs1D7dh1y looking for danubeC at 128.130.204.35:9722 cpRcDUxGvbLGQRvqXTmJozvWXfmfPsPohiEs1D7dh1y looking for ev1C at 54.94.255.14:9702 cpRcDUxGvbLGQRvqXTmJozvWXfmfPsPohiEs1D7dh1y looking for BIGAWSUSEAST1-001C at 34.224.255.108:9796 Connecting to live... cpRcDUxGvbLGQRvqXTmJozvWXfmfPsPohiEs1D7dh1y now connected to BYUC cpRcDUxGvbLGQRvqXTmJozvWXfmfPsPohiEs1D7dh1y now connected to BIGAWSUSEAST1-001C Connected to live. cpRcDUxGvbLGQRvqXTmJozvWXfmfPsPohiEs1D7dh1y now connected to danubeC cpRcDUxGvbLGQRvqXTmJozvWXfmfPsPohiEs1D7dh1y now connected to ev1C sovrin@live> send NYM dest=3RnYQprW2oA7X2Z78CxN53Hj8MAjmhGETTscVgXEbiXd role=STEWARD Adding nym 3RnYQprW2oA7X2Z78CxN53Hj8MAjmhGETTscVgXEbiXd sovrin@live>   11:02   Seems I'd see more than the "Adding nym..." message   11:03   How can I confirm it was added?  mike.bailey  11:04 PM   If it worked, it should look like this:   11:04   sovrin@live> send NYM dest=FrCMTG7Njkfjsu25tVLEnQymMQwN8J6fZZGdSW5ycK7V Adding nym FrCMTG7Njkfjsu25tVLEnQymMQwN8J6fZZGdSW5ycK7V Nym FrCMTG7Njkfjsu25tVLEnQymMQwN8J6fZZGdSW5ycK7V added  jlaw  11:05 PM   I don't see the last line :confused: no error message   11:05   There should be more info in the log, right?  mike.bailey  11:06 PM   there is a cli.log in the directory in your home directory   11:06   sorry, getting tired  jlaw  11:08 PM   I see it. It looks like the client is continuing to retry ever 15 seconds.   11:09   It's getting a REQACK back from the nodes, but there is no completed txn comming back it appears. So I think it's retrying.  mike.bailey  11:11 PM   I see this in the log in the evernym validator   11:11   Jun 14 05:00:00 ip-172-31-46-122 start_sovrin_node 32680 : self._validateNewNym(req, op, originRole) Jun 14 05:00:00 ip-172-31-46-122 start_sovrin_node 32680 : File "/usr/local/lib/python3.5/dist-packages/sovrin_node/server/domain_req_handler.py", line 160, in _validateNewNym Jun 14 05:00:00 ip-172-31-46-122 start_sovrin_node 32680 : Roles.nameFromValue(originRole), Jun 14 05:00:00 ip-172-31-46-122 start_sovrin_node 32680 : File "/usr/local/lib/python3.5/dist-packages/sovrin_common/roles.py", line 22, in nameFromValue Jun 14 05:00:00 ip-172-31-46-122 start_sovrin_node 32680 : return Roles(value).name if value else 'None role' Jun 14 05:00:00 ip-172-31-46-122 start_sovrin_node 32680 : File "/usr/lib/python3.5/enum.py", line 241, in __call__ Jun 14 05:00:00 ip-172-31-46-122 start_sovrin_node 32680 : return cls.__new__(cls, value) Jun 14 05:00:00 ip-172-31-46-122 start_sovrin_node 32680 : File "/usr/lib/python3.5/enum.py", line 476, in __new__ Jun 14 05:00:00 ip-172-31-46-122 start_sovrin_node 32680 : raise ValueError("%r is not a valid %s" % (value, cls.__name__)) Jun 14 05:00:00 ip-172-31-46-122 start_sovrin_node 32680 : ValueError: 'TRUSTEE' is not a valid Roles   11:13   It is actually in syslog, not in our ev1.log  jlaw  11:15 PM   That's odd. Is ev1.log being updated?   11:15   That timestamp is 15 minutes ago.  mike.bailey  11:17 PM   It looks like the service is down. It is no longer responding to a connection request. The others do.   11:17   The error message also makes no sense. TRUSTEE is a valid role.   11:18   I will restart the service on the ev1 node. Crossing fingers.   11:21   well, it came back up ok. I can connect to all nodes from a cli  jlaw  11:21 PM   Me too  mike.bailey  11:23 PM   the cli shows disconnections / reconnections happening. this is unusual  jlaw  11:23 PM   This is really strange: >>>sovrin@live> send NYM dest=3RnYQprW2oA7X2Z78CxN53Hj8MAjmhGETTscVgXEbiXd role=STEWARD Adding nym 3RnYQprW2oA7X2Z78CxN53Hj8MAjmhGETTscVgXEbiXd 7xZxp3XAFU4bMNSYiDnEohGCuAfeHZVNv6Eym39QWFrp disconnected from BIGAWSUSEAST1-001C 7xZxp3XAFU4bMNSYiDnEohGCuAfeHZVNv6Eym39QWFrp disconnected from BYUC 7xZxp3XAFU4bMNSYiDnEohGCuAfeHZVNv6Eym39QWFrp now connected to BIGAWSUSEAST1-001C Remote BYUC is not connected - message will not be sent immediately.If this problem does not resolve itself - check your firewall settings 7xZxp3XAFU4bMNSYiDnEohGCuAfeHZVNv6Eym39QWFrp now connected to BYUC   11:23   I'm seeing the same.     The log for the ev1 validator node is on a log aggregation server.  To get access, copy down the attached pem file, chmod it to 600, then run:  ssh -i alpha-logger.pem ubuntu@34.225.141.74  The file is logs/ev1.log  ></description> </Issue>
