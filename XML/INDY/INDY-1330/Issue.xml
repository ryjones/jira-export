<Issue id="30170" key="INDY-1330" number="1330" project="10303" reporter="vladimirwork" assignee="vladimirwork" creator="vladimirwork" type="10004" summary="Upgrade from 1.2.223 (1.3.55 stable analogue) to 1.3.410 (rocksdb) doesn&apos;t work" priority="2" resolution="10000" status="10001" created="2018-05-14 15:55:03.0" updated="2019-03-29 20:34:51.0" resolutiondate="2019-03-29 20:34:51.0" votes="0" watches="2" workflowId="30177"> <description><! CDATA Size: M (PoA + fix)  Build Info: python3-base58=0.2.4 libindy-crypto=0.1.6 python3-indy-crypto=0.1.6 indy-plenum=1.2.180 indy-node=1.2.223  Steps to Reproduce: 1. Install 1.2.223 pool (1.3.55 stable analogue). 2. Add ~10 NYMs to ledger. 3. Upgrade pool to 1.3.410. 4. Try to add NYM to ledger. 5. Check indy-node version \ status and journalctl at all nodes.  Actual Results: Pool is upgraded successfully but doesn't write NYMs and all nodes restart spontaneously each ~5 seconds. There is an error in journalctl:  {noformat} May 14 14:09:04 9b1cb6eeb215 env 9129 : 2018-05-14 14:09:04,956 | DEBUG    | __init__.py          (  60) | register | Registered VCS backend: git May 14 14:09:05 9b1cb6eeb215 env 9129 : 2018-05-14 14:09:05,754 | DEBUG    | __init__.py          (  60) | register | Registered VCS backend: hg May 14 14:09:06 9b1cb6eeb215 env 9129 : 2018-05-14 14:09:06,711 | DEBUG    | __init__.py          (  60) | register | Registered VCS backend: svn May 14 14:09:06 9b1cb6eeb215 env 9129 : 2018-05-14 14:09:06,712 | DEBUG    | __init__.py          (  60) | register | Registered VCS backend: bzr May 14 14:09:07 9b1cb6eeb215 env 9130 : 2018-05-14 14:09:07,283 | DEBUG    | __init__.py          (  60) | register | Registered VCS backend: git May 14 14:09:08 9b1cb6eeb215 env 9130 : 2018-05-14 14:09:08,104 | DEBUG    | __init__.py          (  60) | register | Registered VCS backend: hg May 14 14:09:09 9b1cb6eeb215 env 9130 : 2018-05-14 14:09:09,021 | DEBUG    | __init__.py          (  60) | register | Registered VCS backend: svn May 14 14:09:09 9b1cb6eeb215 env 9130 : 2018-05-14 14:09:09,022 | DEBUG    | __init__.py          (  60) | register | Registered VCS backend: bzr May 14 14:09:09 9b1cb6eeb215 env 9129 : 2018-05-14 14:09:09,479 | INFO     | node_control_tool.py (  78) | __init__ | Node control tool is starting up on localhost port 30003 May 14 14:09:21 9b1cb6eeb215 env 9129 : E: Unable to locate package May 14 14:09:21 9b1cb6eeb215 env 9129 : Traceback (most recent call last): May 14 14:09:21 9b1cb6eeb215 env 9129 :   File "/usr/local/bin/start_node_control_tool", line 22, in <module> May 14 14:09:21 9b1cb6eeb215 env 9129 :     nodeControlTool.start() May 14 14:09:21 9b1cb6eeb215 env 9129 :   File "/usr/local/lib/python3.5/dist-packages/indy_node/utils/node_control_tool.py", line 289, in start May 14 14:09:21 9b1cb6eeb215 env 9129 :     self._hold_packages() May 14 14:09:21 9b1cb6eeb215 env 9129 :   File "/usr/local/lib/python3.5/dist-packages/indy_node/utils/node_control_tool.py", line 107, in _hold_packages May 14 14:09:21 9b1cb6eeb215 env 9129 :     ret = self._run_shell_command(cmd) May 14 14:09:21 9b1cb6eeb215 env 9129 :   File "/usr/local/lib/python3.5/dist-packages/indy_node/utils/node_control_tool.py", line 280, in _run_shell_command May 14 14:09:21 9b1cb6eeb215 env 9129 :     timeout=TIMEOUT) May 14 14:09:21 9b1cb6eeb215 env 9129 :   File "/usr/lib/python3.5/subprocess.py", line 708, in run May 14 14:09:21 9b1cb6eeb215 env 9129 :     output=stdout, stderr=stderr) May 14 14:09:21 9b1cb6eeb215 env 9129 : subprocess.CalledProcessError: Command 'apt-mark hold indy-anoncreds indy-plenum indy-node python3-indy-crypto ""' returned non-zero exit status 100 May 14 14:09:22 9b1cb6eeb215 systemd 1 : indy-node-control.service: Main process exited, code=exited, status=1/FAILURE May 14 14:09:22 9b1cb6eeb215 systemd 1 : indy-node-control.service: Unit entered failed state. May 14 14:09:22 9b1cb6eeb215 systemd 1 : indy-node-control.service: Failed with result 'exit-code'. root@9b1cb6eeb215:/home/indy# vim /usr/local/lib/python3.5/dist-packages/plenum/config.py root@9b1cb6eeb215:/home/indy# journalctl -ex May 14 14:34:01 9b1cb6eeb215 env 13849 :   File "/usr/local/lib/python3.5/dist-packages/indy_node/utils/node_control_tool.py", line 107, in _hold_packages May 14 14:34:01 9b1cb6eeb215 env 13849 :     ret = self._run_shell_command(cmd) May 14 14:34:01 9b1cb6eeb215 env 13849 :   File "/usr/local/lib/python3.5/dist-packages/indy_node/utils/node_control_tool.py", line 280, in _run_shell_command May 14 14:34:01 9b1cb6eeb215 env 13849 :     timeout=TIMEOUT) May 14 14:34:01 9b1cb6eeb215 env 13849 :   File "/usr/lib/python3.5/subprocess.py", line 708, in run May 14 14:34:01 9b1cb6eeb215 env 13849 :     output=stdout, stderr=stderr) May 14 14:34:01 9b1cb6eeb215 env 13849 : subprocess.CalledProcessError: Command 'apt-mark hold indy-anoncreds indy-plenum indy-node python3-indy-crypto ""' returned non-zero exit status 100 May 14 14:34:02 9b1cb6eeb215 systemd 1 : indy-node-control.service: Main process exited, code=exited, status=1/FAILURE May 14 14:34:02 9b1cb6eeb215 systemd 1 : indy-node-control.service: Unit entered failed state. May 14 14:34:02 9b1cb6eeb215 systemd 1 : indy-node-control.service: Failed with result 'exit-code'. May 14 14:34:12 9b1cb6eeb215 systemd 1 : indy-node-control.service: Service hold-off time over, scheduling restart. May 14 14:34:12 9b1cb6eeb215 systemd 1 : Stopping Indy Node... {noformat}  Expected Results: Pool should work normally after the upgrade.  Additional Info: Upgrades  1.3.375 (1.3.57 stable analogue) -> 1.3.410  and  1.3.395 -> 1.3.410  perform successfully.  ></description> </Issue>
