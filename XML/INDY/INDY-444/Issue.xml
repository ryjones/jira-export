<Issue id="19378" key="INDY-444" number="444" project="10303" reporter="ozheregelya" assignee="andkononykhin" creator="ozheregelya" type="10004" summary="Unclear error appears in CLI and pool is crashed after changing node data" priority="3" resolution="10200" status="10001" created="2017-07-20 12:21:26.0" updated="2019-03-29 20:33:38.0" resolutiondate="2019-03-29 20:33:38.0" votes="0" watches="1" workflowId="19378"> <environment><! CDATA Build Info:   indy-anoncreds 0.4.18   python3-rlp 0.5.1   python3-sha3 0.2.1   python3-pyzmq 16.0.2   indy-plenum 0.4.61   indy-node 0.4.46   sovrin 0.2.10 OS/Platform: Ubuntu 16.04.2 LTS Setup: 4+2 nodes, 1 client  ></environment> <description><! CDATA *Steps to Reproduce:* # Set up pool of 4 nodes. # Init additional node #1 (ip 10.0.0.6 in this example)  {code:java} init_sovrin_node Node5 9701 9702 000000000000000000000000000node5 generate_sovrin_pool_transactions --nodes 4 --clients 4 --ips  '10.0.0.2,10.0.0.3,10.0.0.4,10.0.0.5'{code} # Add additional node #1 to pool, try to send NYM to test communication.  {code:java} send NODE dest=4Tn3wZMNCvhSTXPcLinQDnHyj56DTLQtL61ki4jo2Loc data={'client_port': 9702, 'client_ip': '10.0.0.6', 'alias':'Node5', 'node_ip': '10.0.0.6', 'node_port': 9701, 'services':  'VALIDATOR' }{code} => Node is added, consensus reached, NYM is successfully added. # Stop services on additional node #1, try to send NYM to test communication. => Count of nodes is n-f, consensus is reached, NYM is successfully added. # Init additional node #2 (ip 10.0.0.7 in this example)  {code:java} init_sovrin_node Node5 9701 9702 000000000000000000000000000node5 generate_sovrin_pool_transactions --nodes 4 --clients 4 --ips  '10.0.0.2,10.0.0.3,10.0.0.4,10.0.0.5'{code} # Add additional node #2 to pool, try to send NYM to test communication.  {code:java} send NODE dest=4Tn3wZMNCvhSTXPcLinQDnHyj56DTLQtL61ki4jo2Loc data={'client_port': 9702, 'client_ip': '10.0.0.6', 'alias':'Node5', 'node_ip': '10.0.0.6', 'node_port': 9701, 'services':  'VALIDATOR' }{code} => Node is added, consensus reached, NYM is successfully added. # Stop services on additional node #2, try to send NYM to test communication. => Count of nodes is n-f, consensus is reached, NYM is successfully added. # Exit the CLI. # Open the CLI again, try to connect to test environment.  *Actual Results:* {code:java} sovrin> connect test Saved keyring "Default-dd49d5" restored (/home/sovrin/.sovrin/keyrings/test/default-dd49d5.wallet) Active keyring set to "Default-dd49d5" Client sovrin3c4a29 initialized with the following node registry: Node1C listens at 10.0.0.2 on port 9702 Node2C listens at 10.0.0.3 on port 9704 Node3C listens at 10.0.0.4 on port 9706 Node4C listens at 10.0.0.5 on port 9708 Active client set to sovrin3c4a29 G8MVTMHZdsPTmxbaUX78Z5xkWnUg14cDtxFMUiKzyGtX listening for other nodes at 0.0.0.0:6029 G8MVTMHZdsPTmxbaUX78Z5xkWnUg14cDtxFMUiKzyGtX looking for Node2C at 10.0.0.3:9704 G8MVTMHZdsPTmxbaUX78Z5xkWnUg14cDtxFMUiKzyGtX looking for Node1C at 10.0.0.2:9702 G8MVTMHZdsPTmxbaUX78Z5xkWnUg14cDtxFMUiKzyGtX looking for Node3C at 10.0.0.4:9706 G8MVTMHZdsPTmxbaUX78Z5xkWnUg14cDtxFMUiKzyGtX looking for Node4C at 10.0.0.5:9708 Connecting to test... G8MVTMHZdsPTmxbaUX78Z5xkWnUg14cDtxFMUiKzyGtX now connected to Node2C G8MVTMHZdsPTmxbaUX78Z5xkWnUg14cDtxFMUiKzyGtX now connected to Node3C G8MVTMHZdsPTmxbaUX78Z5xkWnUg14cDtxFMUiKzyGtX now connected to Node1C G8MVTMHZdsPTmxbaUX78Z5xkWnUg14cDtxFMUiKzyGtX now connected to Node4C Connected to test. G8MVTMHZdsPTmxbaUX78Z5xkWnUg14cDtxFMUiKzyGtX could not verify catchup reply CATCHUP_REP{'txns': {'5': {'identifier': 'XhYtvJqezMUKfF6KVNaGmT', 'type': '0', 'txnTime': 1500466694, 'signature': '3F6YEvZRGWY8DeYKJGykJjL4LhsidxWPCWjqQYd7mLTQQCfB9NkYycxf6cfEe46buA3773htHSSFCHd8BuGoVg9Q', 'reqId': 1500466694263116, 'dest': '4Tn3wZMNCvhSTXPcLinQDnHyj56DTLQtL61ki4jo2Loc', 'data': {'client_ip': '10.0.0.6', 'alias': 'Node5', 'services':  'VALIDATOR' , 'node_port': 9701, 'client_port': 9702, 'node_ip': '10.0.0.6'}}}, 'consProof':  'BALn3uTnmGbyLpwspvZq99qB8aTtzvrz1gPpHCvb8N3r', '8ayqSLxRaqzM7LAv7yMvfcUPXVpgrabwbjCtiZXd7753', 'BZYapF9k1VgPp6Qv7A5Lm7tJy97ty7mTYGFFt1r8LTUR', '6mQmSGzvyAeSpp5E7rBcYyAwgim9pTdggDXwL4quw8HA' , 'ledgerId': 0} since Inconsistency: first root hash does not match. Expected hash: b'e5d008ade2ffe0debf65d1d018bad655a8758d00223ee1299f15041bd6355fd2', computed hash: b'a0bd5c80d48d2069a27489bcdf2ac6b2bfb89ed4cb4348361875c6336c5a65e9' {code}    *Expected Results:* Error should not appear, pool should work.  *Additional Information:* * pool_ledger file:  {code:java} {"data":{"alias":"Node1","client_ip":"10.0.0.2","client_port":9702,"node_ip":"10.0.0.2","node_port":9701,"services": "VALIDATOR" },"dest":"Gw6pDLhcBcoQesN72qfotTgFa7cbuqZpkX3Xo6pLhPhv","identifier":"Th7MpTaRZVRYnPiabds81Y","txnId":"fea82e10e894419fe2bea7d96296a6d46f50f93f9eeda954ec461b2ed2950b62","type":"0"} {"data":{"alias":"Node2","client_ip":"10.0.0.3","client_port":9704,"node_ip":"10.0.0.3","node_port":9703,"services": "VALIDATOR" },"dest":"8ECVSk179mjsjKRLWiQtssMLgp6EPhWXtaYyStWPSGAb","identifier":"EbP4aYNeTHL6q385GuVpRV","txnId":"1ac8aece2a18ced660fef8694b61aac3af08ba875ce3026a160acbc3a3af35fc","type":"0"} {"data":{"alias":"Node3","client_ip":"10.0.0.4","client_port":9706,"node_ip":"10.0.0.4","node_port":9705,"services": "VALIDATOR" },"dest":"DKVxG2fXXTU8yT5N7hGEbXB3dfdAnYv1JczDUHpmDxya","identifier":"4cU41vWW82ArfxJxHkzXPG","txnId":"7e9f355dffa78ed24668f0e0e369fd8c224076571c51e2ea8be5f26479edebe4","type":"0"} {"data":{"alias":"Node4","client_ip":"10.0.0.5","client_port":9708,"node_ip":"10.0.0.5","node_port":9707,"services": "VALIDATOR" },"dest":"4PS3EDQ3dW1tci1Bp6543CfuuebjFrg36kLAUcskGfaA","identifier":"TWwCRQRZ2ZHMJFn9TzLp7W","txnId":"aa5e817d7cc626170eca175822029339a444eb0ee8f0bd20d3b0b76e566fb008","type":"0"} {"data":{"alias":"Node5","client_ip":"10.0.0.6","client_port":9702,"node_ip":"10.0.0.6","node_port":9701,"services": "VALIDATOR" },"dest":"4Tn3wZMNCvhSTXPcLinQDnHyj56DTLQtL61ki4jo2Loc","identifier":"XhYtvJqezMUKfF6KVNaGmT","reqId":1500466694263116,"signature":"3F6YEvZRGWY8DeYKJGykJjL4LhsidxWPCWjqQYd7mLTQQCfB9NkYycxf6cfEe46buA3773htHSSFCHd8BuGoVg9Q","txnTime":1500466694,"type":"0"} {"data":{"alias":"Node5","services":  },"dest":"4Tn3wZMNCvhSTXPcLinQDnHyj56DTLQtL61ki4jo2Loc","identifier":"V4SGRU86Z58d6TV7PBUe6f","reqId":1500467102695168,"signature":"4vcbkSwr2ppBY1jn5QEzNmADQ6KJX7eYnyTw9hcjUkDqK4LfUvFcHzKfioZRuiT5h4DLqNJ6LihY23Grc3Ut7CGM","txnTime":1500467102,"type":"0"} {"data":{"alias":"Node5","client_ip":"10.0.0.6","client_port":9702,"node_ip":"10.0.0.6","node_port":9701,"services": "VALIDATOR" },"dest":"4Tn3wZMNCvhSTXPcLinQDnHyj56DTLQtL61ki4jo2Loc","identifier":"V4SGRU86Z58d6TV7PBUe6f","reqId":1500467708380544,"signature":"58bcdLHdmq66Hd4NWWhUNjVNq6WuTWzUseKMhtSa3p9xR5rS6UGFoF3YGfqMHRwhUuRzTUJ8dbrXpVhfaCGsxNjy","txnTime":1500467708,"type":"0"} {"data":{"alias":"Node5","client_ip":"10.0.0.7","client_port":9702,"node_ip":"10.0.0.7","node_port":9701,"services": "VALIDATOR" },"dest":"4Tn3wZMNCvhSTXPcLinQDnHyj56DTLQtL61ki4jo2Loc","identifier":"XhYtvJqezMUKfF6KVNaGmT","reqId":1500467756471212,"signature":"259eWdbRVzLUqmFMZ5xvjxJs6eGKwF5TYBJTADpXzg3aTy5SwAgsnQCnugrYTLN9GDzMjgRzqc78ZzZuVVdgA1WY","txnTime":1500467756,"type":"0"}{code} *  Logs of 7 nodes are attached, but Node 7 was used only for invalid case and it was not connected to the pool.  ></description> </Issue>
