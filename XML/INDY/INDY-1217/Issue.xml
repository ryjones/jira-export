<Issue id="28421" key="INDY-1217" number="1217" project="10303" reporter="ozheregelya" creator="ozheregelya" type="10004" summary="Clear_node script issues " priority="4" status="10200" created="2018-03-12 13:53:36.0" updated="2018-04-24 14:43:17.0" votes="0" watches="1" workflowId="28424"> <description><! CDATA *Case 1:* Backup can't be removed. *Steps to Reproduce:* 1. Setup the pool with 1.2.50 version. 2. Upgrade it to 1.3.55 version. 3. Run the clear_node as indy user: sudo su - indy -c "clear_node.py --full FULL"  *Actual Results:* {code:java} ubuntu@canadaQALive2:~$ sudo su - indy -c "clear_node.py --full FULL" Traceback (most recent call last): File "/usr/local/bin/clear_node.py", line 30, in <module> clean(config, args.full, args.network) File "/usr/local/bin/clear_node.py", line 20, in clean shutil.rmtree(config_helper.ledger_base_dir) File "/usr/lib/python3.5/shutil.py", line 474, in rmtree _rmtree_safe_fd(fd, path, onerror) File "/usr/lib/python3.5/shutil.py", line 412, in _rmtree_safe_fd _rmtree_safe_fd(dirfd, fullname, onerror) File "/usr/lib/python3.5/shutil.py", line 432, in _rmtree_safe_fd onerror(os.unlink, fullname, sys.exc_info()) File "/usr/lib/python3.5/shutil.py", line 430, in _rmtree_safe_fd os.unlink(name, dir_fd=topfd) PermissionError:  Errno 13  Permission denied: 'sandbox_backup_1.2.50.zip'{code} Expected Results: Backup should be removed.  *Case 2:* Script fails if any directory doesn't exist. Steps to Reproduce: 1. After Case 1 change owner of sandbox_backup_1.2.50.zip to indy. 2. Run clear_node again.  Actual Results: {code:java} root@77785ea1d587:/home/indy# sudo su - indy -c "clear_node.py --full FULL" Traceback (most recent call last): File "/usr/local/bin/clear_node.py", line 30, in <module> clean(config, args.full, args.network) File "/usr/local/bin/clear_node.py", line 15, in clean shutil.rmtree(config_helper.log_dir) File "/usr/lib/python3.5/shutil.py", line 465, in rmtree onerror(os.lstat, path, sys.exc_info()) File "/usr/lib/python3.5/shutil.py", line 463, in rmtree orig_st = os.lstat(path) FileNotFoundError:  Errno 2  No such file or directory: '/var/log/indy/sandbox'{code}    Expected Result: Not existing directories should be ignored. Ideally, if some files/directories can't be removed, need to show this information to user and try to remove the rest files/directories.  *Case 3 (need to discuss):* Configs remove.  From help:    {code:java} root@77785ea1d587:/home/indy# sudo su - indy -c "clear_node.py --help" usage: clear_node.py  -h   --full FULL   --network NETWORK  Removes node data and configuration optional arguments: -h, --help show this help message and exit --full FULL remove configs and logs too --network NETWORK Network to clean  {code} > remove configs and logs too In fact, we don't remove configs in /etc/indy.  Should we remove general configs in scope of node cleaning?  ></description> </Issue>
