<Action id="47774" issue="32163" author="vladimirwork" type="comment" created="2018-07-25 08:49:57.0" updateauthor="vladimirwork" updated="2018-07-25 08:49:57.0"> <body><! CDATA I've rechecked 1.3 -> 1.4 and 1.3 -> 1.5 upgrades against 7 nodes pool *without the 1st node in schedule*:  1. After *1.3 -> 1.4* upgrade nodes restart with `plenum.common.exceptions.MissingProtocolVersionError: validation error  LedgerStatus ` stacktrace one or two times and then works normally.  ^upgrade_ok_1_4.tar.gz    2. After *1.3 -> 1.5* upgrade nodes restart constantly with the same stacktrace.  ^upgrade_not_ok_1_5.tar.gz    ></body> </Action>
<Action id="47926" issue="32163" author="spivachuk" type="comment" created="2018-07-26 17:06:03.0" updateauthor="spivachuk" updated="2018-07-26 17:06:03.0"> <body><! CDATA *Problem reason:* - Exceptions about an invalid structure of a replied message from a message reply were not handled. Due to this the upgraded nodes crashed when were performing catch-up and received message replies with {{LedgerStatuses}} in outdated format (without {{protocolVersion}} field) from the not upgraded node.  *Changes:* - Added an integration test from  ~Toktar  verifying catch-up in case one of nodes sends {{MessageReps}} with {{LedgerStatuses}} in outdated format. - Added unit tests for some unhandled cases in message request / response handling logic. - Added handling for these cases to message request / response processing logic.  *PRs:* - Hotfix in stable: -- https://github.com/hyperledger/indy-plenum/pull/840 -- https://github.com/hyperledger/indy-node/pull/842 - The same fix with additional corrections in names and comments in master: -- https://github.com/hyperledger/indy-plenum/pull/841 -- https://github.com/hyperledger/indy-node/pull/845  *Version:* - rc: -- indy-node 1.5.68-rc -- indy-plenum 1.5.48-rc - master: -- indy-node 1.5.525-master -- indy-plenum 1.5.478-master  *Risk factors:* - Nothing is expected.  *Risk:* - Low  *Covered with tests:* - {{test_node_rejects_msg_reps_with_invalid_msg_structure}} - {{test_node_rejects_msg_reps_with_mismatched_params}} - {{test_node_catchup_with_new_ls_form}} (stable) / {{test_catchup_with_ledger_statuses_in_old_format_from_one_node}} (master)  ></body> </Action>
<Action id="48025" issue="32163" author="ozheregelya" type="comment" created="2018-07-27 11:02:34.0" updateauthor="ozheregelya" updated="2018-07-27 14:32:55.0"> <body><! CDATA *Environment:* indy-node 1.5.68 rc  *Steps to Validate:* 1. Setup the docker pool with 1.3.62 version. 2. Send upgrade transaction for all nodes exclude the first one. => All nodes exclude the first one were successfully upgraded. 3. Check the 'systemctl status indy-node'. => No errors. 4. Send txn. => Txn was written on all nodes exclude the first one. 5. Upgrade the first node manually and send txn.  *Actual Results:* The first node was successfully upgraded, all missed txns were processed, new txns were written.Â   *Additional Information:* The fix was verified on indy-node 1.5.527 (master) version and works as well.  ></body> </Action>
