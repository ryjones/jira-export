<Action id="62071" issue="41368" author="ashcherbakov" type="comment" created="2019-07-24 09:26:29.0" updateauthor="ashcherbakov" updated="2019-07-24 09:44:38.0"> <body><! CDATA *General conclusion* * There are no issues with catchup, it was finished successfully * The problem was with ZMQ connection: Node1 wasn't able to connect to two nodes (node 4 and node 7), but these two nodes connected to Node1. A separate ticket INDY-2183 is created for this issue.  *Details* # Node1 connected to *3 nodes only*:  {code:java} 2019-07-23 13:19:20,385|NOTIFICATION|keep_in_touch.py|Node1's connections changed from {'Node5', 'Node3'} to {'Node5', 'Node3', 'Node2'} {code} This was enough (F+1) to finish catchup, so Node 1 caught up till (2, 3) # The pool continued ordering while Node 1 was doing catchup, and ordered till ~(2,30) # Node 1 stashed all 3PC messages received during catchup and started unstashing it when catchup was finished. # However, since Node1 connected to F+1 nodes only, but needed at least N-F nodes for quorum, it wasn't able to apply stashed 3PC messages and continue ordering.  *Missing connection to two nodes* * Node1 was trying to connect to Nodes 4 and 7 all the time. It re-created sockets and sent pings, but didn't receive pongs.  {code:java} ..... 2019-07-23 13:19:42,029|TRACE|remote.py|disconnecting socket 147 2019-07-23 13:19:42,029|TRACE|remote.py|connecting socket 158 to remote Node7:HA(host='10.0.0.8', port=9713), addr: tcp://0.0.0.0:0;10.0.0.8:9713 2019-07-23 13:19:42,029|DEBUG|zstack.py|Node1 pinged Node7 -- 2019-07-23 13:19:42,030|TRACE|remote.py|disconnecting socket 154 2019-07-23 13:19:42,030|TRACE|remote.py|connecting socket 147 to remote Node4:HA(host='10.0.0.5', port=9707), addr: tcp://0.0.0.0:0;10.0.0.5:9707 2019-07-23 13:19:42,031|DEBUG|zstack.py|Node1 pinged Node4 -- 2019-07-23 13:20:12,046|TRACE|remote.py|disconnecting socket 158 2019-07-23 13:20:12,046|TRACE|remote.py|connecting socket 155 to remote Node7:HA(host='10.0.0.8', port=9713), addr: tcp://0.0.0.0:0;10.0.0.8:9713 2019-07-23 13:20:12,047|DEBUG|zstack.py|Node1 pinged Node7 -- 2019-07-23 13:20:12,047|TRACE|remote.py|disconnecting socket 147 2019-07-23 13:20:12,048|TRACE|remote.py|connecting socket 174 to remote Node4:HA(host='10.0.0.5', port=9707), addr: tcp://0.0.0.0:0;10.0.0.5:9707 2019-07-23 13:20:12,048|DEBUG|zstack.py|Node1 pinged Node4 -- 2019-07-23 13:20:42,053|TRACE|remote.py|disconnecting socket 155 2019-07-23 13:20:42,056|TRACE|remote.py|connecting socket 147 to remote Node7:HA(host='10.0.0.8', port=9713), addr: tcp://0.0.0.0:0;10.0.0.8:9713 2019-07-23 13:20:42,056|DEBUG|zstack.py|Node1 pinged Node7 ..... {code} * However, Nodes 4 and 7 were able to connect to Node1:  {code:java} 2019-07-23 13:17:12,365|NOTIFICATION|keep_in_touch.py|Node4's connections changed from {'Node3', 'Node7', 'Node5', 'Node6'} to {'Node1', 'Node3', 'Node7', 'Node5', 'Node6'} ------------ 2019-07-23 13:17:12,378|NOTIFICATION|keep_in_touch.py|Node7's connections changed from {'Node6', 'Node4', 'Node3', 'Node5'} to {'Node6', 'Node4', 'Node3', 'Node5', 'Node1'} {code} * A possible issue here is that Nodes4 and 7 were able to connect and didn't re-created (close and create) the socket anymore. However, Node1 wasn't able and started to close and re-create sockets. For some reasons, Node4 and 7 were not able to detect that Node1's socket is closed. It may indicate a problem with closing a socket, or a problem in a monitor socket responsible for getting Disconnect events. * The hypothesis above is proved by the fact that Node 1 also experience problems with connection to Node2, but was eventually able to connect to it. Node 2 at the same time also wasn't able to connect to Node1 and was re-creating sockets the same way as Node 1 did:  {code:java} Node1: 2019-07-23 13:17:11,961|TRACE|remote.py|connecting socket 157 to remote Node2:HA(host='10.0.0.3', port=9703), addr: tcp://0.0.0.0:0;10.0.0.3:9703 2019-07-23 13:17:11,961|INFO|zstack.py|CONNECTION: Node1 looking for Node2 at 10.0.0.3:9703 2019-07-23 13:17:11,961|DEBUG|zstack.py|Node1 pinged Node2 -- 2019-07-23 13:17:41,976|DEBUG|remote.py|disconnecting remote Node2:HA(host='10.0.0.3', port=9703) 2019-07-23 13:17:41,977|TRACE|remote.py|disconnecting socket 157 2019-07-23 13:17:41,977|TRACE|remote.py|connecting socket 162 to remote Node2:HA(host='10.0.0.3', port=9703), addr: tcp://0.0.0.0:0;10.0.0.3:9703 2019-07-23 13:17:41,977|DEBUG|zstack.py|Node1 pinged Node2 2019-07-23 13:17:41,978|TRACE|kit_zstack.py|Node1 next check for retries in 15.00 seconds -- 2019-07-23 13:18:11,996|DEBUG|remote.py|disconnecting remote Node2:HA(host='10.0.0.3', port=9703) 2019-07-23 13:18:11,997|TRACE|remote.py|disconnecting socket 162 2019-07-23 13:18:11,997|TRACE|remote.py|connecting socket 155 to remote Node2:HA(host='10.0.0.3', port=9703), addr: tcp://0.0.0.0:0;10.0.0.3:9703 2019-07-23 13:18:11,997|DEBUG|zstack.py|Node1 pinged Node2 2019-07-23 13:18:11,999|TRACE|kit_zstack.py|Node1 next check for retries in 15.00 seconds -- 2019-07-23 13:18:42,012|DEBUG|remote.py|disconnecting remote Node2:HA(host='10.0.0.3', port=9703) 2019-07-23 13:18:42,012|TRACE|remote.py|disconnecting socket 155 2019-07-23 13:18:42,012|TRACE|remote.py|connecting socket 169 to remote Node2:HA(host='10.0.0.3', port=9703), addr: tcp://0.0.0.0:0;10.0.0.3:9703 2019-07-23 13:18:42,013|DEBUG|zstack.py|Node1 pinged Node2 2019-07-23 13:18:42,013|TRACE|kit_zstack.py|Node1 next check for retries in 15.00 seconds -- 2019-07-23 13:19:12,025|DEBUG|remote.py|disconnecting remote Node2:HA(host='10.0.0.3', port=9703) 2019-07-23 13:19:12,025|TRACE|remote.py|disconnecting socket 169 2019-07-23 13:19:12,025|TRACE|remote.py|connecting socket 161 to remote Node2:HA(host='10.0.0.3', port=9703), addr: tcp://0.0.0.0:0;10.0.0.3:9703 2019-07-23 13:19:12,026|DEBUG|zstack.py|Node1 pinged Node2  --------  Node2: 9-07-23 13:14:51,340|TRACE|remote.py|disconnecting socket 109 2019-07-23 13:14:51,340|TRACE|remote.py|Node1:HA(host='10.0.0.2', port=9701) closing monitor socket 2019-07-23 13:14:51,340|TRACE|remote.py|connecting socket 115 to remote Node1:HA(host='10.0.0.2', port=9701), addr: tcp://0.0.0.0:0;10.0.0.2:9701 2019-07-23 13:14:51,341|DEBUG|zstack.py|Node2 pinged Node1 2019-07-23 13:14:51,341|TRACE|kit_zstack.py|Node2 next check for retries in 15.00 seconds -- 2019-07-23 13:15:21,349|DEBUG|remote.py|disconnecting remote Node1:HA(host='10.0.0.2', port=9701) 2019-07-23 13:15:21,349|TRACE|remote.py|disconnecting socket 115 2019-07-23 13:15:21,349|TRACE|remote.py|connecting socket 109 to remote Node1:HA(host='10.0.0.2', port=9701), addr: tcp://0.0.0.0:0;10.0.0.2:9701 2019-07-23 13:15:21,349|DEBUG|zstack.py|Node2 pinged Node1 2019-07-23 13:15:21,350|TRACE|kit_zstack.py|Node2 next check for retries in 15.00 seconds -- 2019-07-23 13:15:51,861|DEBUG|remote.py|disconnecting remote Node1:HA(host='10.0.0.2', port=9701) 2019-07-23 13:15:51,862|TRACE|remote.py|disconnecting socket 109 2019-07-23 13:15:51,862|TRACE|remote.py|connecting socket 115 to remote Node1:HA(host='10.0.0.2', port=9701), addr: tcp://0.0.0.0:0;10.0.0.2:9701 2019-07-23 13:15:51,862|DEBUG|zstack.py|Node2 pinged Node1 2019-07-23 13:15:51,863|TRACE|kit_zstack.py|Node2 next check for retries in 15.00 seconds -- 2019-07-23 13:16:21,877|DEBUG|remote.py|disconnecting remote Node1:HA(host='10.0.0.2', port=9701) 2019-07-23 13:16:21,877|TRACE|remote.py|disconnecting socket 115 2019-07-23 13:16:21,878|TRACE|remote.py|connecting socket 109 to remote Node1:HA(host='10.0.0.2', port=9701), addr: tcp://0.0.0.0:0;10.0.0.2:9701 2019-07-23 13:16:21,878|DEBUG|zstack.py|Node2 pinged Node1 2019-07-23 13:16:21,879|TRACE|kit_zstack.py|Node2 next check for retries in 15.00 seconds -- 2019-07-23 13:16:51,894|DEBUG|remote.py|disconnecting remote Node1:HA(host='10.0.0.2', port=9701) 2019-07-23 13:16:51,894|TRACE|remote.py|disconnecting socket 109 2019-07-23 13:16:51,894|TRACE|remote.py|connecting socket 109 to remote Node1:HA(host='10.0.0.2', port=9701), addr: tcp://0.0.0.0:0;10.0.0.2:9701 2019-07-23 13:16:51,895|DEBUG|zstack.py|Node2 pinged Node1 2019-07-23 13:16:51,895|DEBUG|zstack.py|Node2 pinged Node6 -- 2019-07-23 13:19:20,296|DEBUG|zstack.py|Node2 pinged Node5 2019-07-23 13:19:20,296|TRACE|zstack.py|Node2 stashed pongs: set() 2019-07-23 13:19:20,296|TRACE|remote.py|connecting socket 153 to remote Node1:HA(host='10.0.0.2', port=9701), addr: tcp://0.0.0.0:0;10.0.0.2:9701 2019-07-23 13:19:20,296|INFO|zstack.py|CONNECTION: Node2 looking for Node1 at 10.0.0.2:9701 2019-07-23 13:19:20,297|DEBUG|zstack.py|Node2 pinged Node1 {code}  ></body> </Action>
