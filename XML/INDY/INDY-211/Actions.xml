<Action id="28505" issue="17841" author="andkononykhin" type="comment" created="2017-07-17 15:29:17.0" updateauthor="andkononykhin" updated="2017-07-18 12:35:45.0"> <body><! CDATA *Problem reason:* Node services are started in default non-optimized mode and it's non appropriate for production  *Changes:* Improved the way services are started.  *Committed into:*  https://github.com/evernym/sovrin-packaging/pull/17/files   *Risk factors:* Nothing is expected.  *Risk:* Low  *Recommendations for QA (optional):* # Install indy-node==4.39 # start services ** systemctl start sovrin-node ** systemctl start sovrin-node-control # check their statuses: ** systemctl status sovrin-node ** systemctl status sovrin-node-control # should see something like that:  {code:java} sovrin-node.service - Sovrin Node Loaded: loaded (/etc/systemd/system/sovrin-node.service; disabled; vendor preset: enabled) Active: active (running) since Mon 2017-07-17 15:07:16 UTC; 1min 26s ago Main PID: 427 (python3) CGroup: /docker/93d52a6715c48e712b74a9787b0ab7034b1af9e0b5a0542ccf331d888e25e96e/system.slice/sovrin-node.s └─427 python3 -OO /usr/local/bin/start_sovrin_node Node2 9703 9704{code} It means "python3 -OO" is used to run our script  ></body> </Action>
<Action id="29019" issue="17841" author="vladimirwork" type="comment" body=" ~andkononykhin   ~ashcherbakov  There is a &quot;python3 -O&quot; on 1.0.67, not a &quot;python3 -OO&quot;. Is it ok? !Screenshot.PNG|thumbnail! " created="2017-07-26 09:56:05.0" updateauthor="vladimirwork" updated="2017-07-26 09:56:05.0"/>
<Action id="29022" issue="17841" author="ashcherbakov" type="comment" created="2017-07-26 10:02:52.0" updateauthor="ashcherbakov" updated="2017-07-26 10:02:52.0"> <body><! CDATA Actually there is a difference between '-O' and '-OO': -O     : optimize generated bytecode slightly; also PYTHONOPTIMIZE=x -OO    : remove doc-strings in addition to the -O optimizations   ></body> </Action>
<Action id="29024" issue="17841" author="alexander.shekhovcov" type="comment" created="2017-07-26 10:34:18.0" updateauthor="alexander.shekhovcov" updated="2017-07-26 10:37:26.0"> <body><! CDATA During installation we use a post-install script which calls: {code} py3compile -O -p {package_name} /usr/local/lib/python3.5/dist-packages/ {code}  Unfortunately,  py3compile does not support -OO. So for the sovrin-node service we also use -O for consistency.  In additional I'd suggest the following test scenario:  1. measure the time of running the load_test script, 10 clients 1000 requests (10000 total requests) 2. stop all sovrin-node services 3. clean up all compiled files {code} find /usr/local/lib/python3.5/dist-packages/ -name "*.pyc" -delete {code} 4. make sure what there are no "*.pyc" files in /usr/local/lib/python3.5/dist-packages/ 5. start all sovrin-node services and make sure what ".pyc" are absent in /usr/local/lib/python3.5/dist-packages/ 6. measure the time of running the load_test script, 10 clients 1000 requests (10000 total requests)  Compere the measurements #1 and #6. I expect #1 should be less than #6 at least 10%.   ></body> </Action>
<Action id="29051" issue="17841" author="vladimirwork" type="comment" created="2017-07-26 16:05:10.0" updateauthor="vladimirwork" updated="2017-07-26 16:05:10.0"> <body><! CDATA Step #1  ================================ Test time: 3865.5972917079926 Average latency: 3.5295646245718 Throughput: 2.58692234223435 Error rate: 0.0 Succeeded: 10000 Failed: 0 ================================  Step #6  	================================ Test time: 4377.404090881348 Average latency: 3.925942998981476 Throughput: 2.2844589606957206 Error rate: 0.0 Succeeded: 10000 Failed: 0 ================================  #1 is about 13% less than #6.  ></body> </Action>
<Action id="29053" issue="17841" author="vladimirwork" type="comment" body=" ~alexander.shekhovcov   ~ashcherbakov  Does -O work as well as -OO according to results above?" created="2017-07-26 16:19:07.0" updateauthor="vladimirwork" updated="2017-07-26 16:19:07.0"/>
<Action id="29076" issue="17841" author="alexander.shekhovcov" type="comment" body="-OO works like -O but in additional it removes doc strings. Removing doc string should affect only on sovrin-node start time. I do not expect significant improvement from -OO comparing -O. Moreover we have to carefully use -O (and -OO) because it removes assert statements from code, it can be dangerous. " created="2017-07-27 09:42:46.0" updateauthor="alexander.shekhovcov" updated="2017-07-27 09:42:46.0"/>
