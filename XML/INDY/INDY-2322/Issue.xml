<Issue id="43805" key="INDY-2322" number="2322" project="10303" reporter="ashcherbakov" assignee="ashcherbakov" creator="ashcherbakov" type="10002" summary="A lagging node may be the only one who started view change in case of F Nodes added/promoted in 1 batch" priority="3" resolution="10000" status="10001" created="2019-12-27 16:20:26.0" updated="2020-01-22 15:05:55.0" resolutiondate="2020-01-17 13:11:42.0" votes="0" watches="1" workflowId="57658"> <description><! CDATA *Issue:* * Pool of 4 Nodes * Adding Node5 * Node5 is committed on Nodes1-3 (so their N=5 now), but not committed yet on Node4 (so N is still 4 there) * Nodes 1-3 sending InstanceChange as they added a new Node ** No quorum yet for Nodes1-3 (they expect N-F=4 Instance Changes) ** Quorum for Node4 (N-F=3 for Node4) * So, Node4 only started the view change * Other nodes will not start it since Node4 hasn't ordered NODE txn for Node5 yet so it hasn't sent Instance Change  *Possible Options for Fixes:* * O1: Change the logic how and when we calculate N and F ** For example, update N and F not on every committed Node txn, but at the beginning of new View only. * O2: Enhance Instance Change triggering logic to include N value into InstanceChanges, and start view change only if Nodes' N is equal to the one in the quorum of Instance Changes. * O3: Do not allow 3PC batches to Pool Ledger with more than 1 txn * O4: Allow only one NODE txn per view with adding/demoting * O5: Start View Change immediately (without waiting for a quorum of Instance Changes) once a node is added or promoted. ** It may make sense to send Instance Change as well to propagate view change to lagged nodes.  ></description> </Issue>
