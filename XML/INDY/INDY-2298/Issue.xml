<Issue id="43389" key="INDY-2298" number="2298" project="10303" reporter="ashcherbakov" assignee="vladimirwork" creator="ashcherbakov" type="10002" summary="Do not restore Primaries from the audit ledger" priority="2" resolution="10000" status="10001" created="2019-11-20 08:27:26.0" updated="2019-11-25 07:16:55.0" resolutiondate="2019-11-25 07:16:55.0" votes="0" watches="1" workflowId="56497"> <description><! CDATA We made Primary selection pretty deterministic in the scope of INDY-2262. Because of the situation reproduced in SN-10 on MainNet after upgrade that some lagging nodes restored primaries from the audit that aren't equal to the current primaries on most of the Nodes, we will need to do the following:  *Changes:* * Do not restore Primaries from the audit ledger after initial catchup, but rather calculate them using the common primary selection logic  *Integration Test* * Mock writing primaries to audit so that it always writes Node4 as a Primary * Restart Nodes 3 and 4 * Make sure that these Nodes selected the same Primary as the other Nodes have (Node1) and the the pool can ordering  *System Test* * Install version 1.11.0, pool of 4 Nodes * Demote Node1 => view change to viewNo=1, Primary - Node3 * Promote Node1 => view change to viewNo=3 (skip viewNo=2 since the same Primary is chosen), Primary - Node4 * Update 3 Nodes to the latest master * Make sure that they order anything (NODE_UPGRADE txns for example).  * Update the 4th Node * Make sure that the 4th node selected the same Primary as other 3 nodes and all nodes are in consensus   ></description> </Issue>
