<Action id="31105" issue="20942" author="krw910" type="comment" body=" ~ashcherbakov  I would like someone to investigate this to make sure we don&apos;t have an upgrade issue that could affect us on the next upgrade." created="2017-09-22 18:42:51.0" updateauthor="krw910" updated="2017-09-22 18:42:51.0"/>
<Action id="31128" issue="20942" author="andrey.goncharov" type="comment" body=" ~mgbailey  the logs are not completely informative. Could you provide journalctl logs and upgrade_log in .sovrin?" created="2017-09-25 10:27:10.0" updateauthor="andrey.goncharov" updated="2017-09-25 10:27:10.0"/>
<Action id="31137" issue="20942" author="mgbailey" type="comment" created="2017-09-25 15:22:13.0" updateauthor="mgbailey" updated="2017-09-25 15:22:13.0"> <body><! CDATA  ~andrey.goncharov , I don't see journalctl logs: {code:java} sovrin@majiyan:~/.sovrin/data/nodes/majiyan$ locate journalctl /bin/journalctl /usr/share/bash-completion/completions/journalctl /usr/share/man/man1/journalctl.1.gz /usr/share/zsh/vendor-completions/_journalctl {code} Here is what is in the upgrade_log: {code:java} sovrin@majiyan:~/.sovrin/data/nodes/majiyan$ cat upgrade_log 2017-09-05 20:04:33.575341	scheduled	2017-09-05 15:05:33.555000-06:00	1.1.33 2017-09-05 21:05:32.577123	scheduled	2017-09-05 15:05:33.555000-06:00	1.1.33 2017-09-20 17:17:14.348492	scheduled	2017-09-05 15:05:33.555000-06:00	1.1.33	1504641873449143 2017-09-20 17:17:14.356783	started	2017-09-05 15:05:33.555000-06:00	1.1.33	1504641873449143 2017-09-20 17:17:37.979255	succeeded	2017-09-05 15:05:33.555000-06:00	1.1.33	1504641873449143 {code}       ></body> </Action>
<Action id="31138" issue="20942" author="andrey.goncharov" type="comment" body=" ~mgbailey  try running &quot;journalctl&quot; command on your machine" created="2017-09-25 15:25:13.0" updateauthor="andrey.goncharov" updated="2017-09-25 15:25:13.0"/>
<Action id="31139" issue="20942" author="mgbailey" type="comment" body="Additional note: I upgraded each of the nodes in the pool to 1.1.37 twice.  After the first upgrade, each node auto-downgraded back to 1.1.33.  After the second upgrade, each node remained at 1.1.37." created="2017-09-25 15:25:33.0" updateauthor="mgbailey" updated="2017-09-25 15:25:33.0"/>
<Action id="31140" issue="20942" author="mgbailey" type="comment" body=" ^journalctl.tgz  output attached" created="2017-09-25 15:31:20.0" updateauthor="mgbailey" updated="2017-09-25 15:31:20.0"/>
<Action id="32002" issue="20942" author="krw910" type="comment" created="2017-10-11 17:14:00.0" updateauthor="krw910" updated="2017-10-11 17:14:00.0"> <body><! CDATA I was easily able to reproduce this issue. Basically its the following: # upgrade pool using a transaction (in this case it also used force=True # next manually upgrade to the next version # on one node stop the services (sovrin-node, sovrin-node-control) and delete the config_transactions directory  # when you start the services the config ledger has to sync and when it does it runs the last transaction # in this case the last version is not the version on the system so it downgrades  I reproduced this because we have a version greater in the RC repo than in the Stable repo. So I installed 1.0.28 from stable, upgraded to 1.1.37 (the lastest) and then edit /etc/apt/sources.list to point to the RC repo instead of Stable. Now you can manually upgrade from that repo to 1.1.40. This puts you in a position to downgrade because the last transaction is for 1.1.37 and the current installed version is 1.1.40  ></body> </Action>
<Action id="32611" issue="20942" author="spivachuk" type="comment" created="2017-10-18 11:25:05.0" updateauthor="spivachuk" updated="2017-10-18 11:27:30.0"> <body><! CDATA *Problem reason:* - When a node got new transactions to config ledger on catch-up, it processed the last {{POOL_UPGRADE}} {{start}} transaction from the ledger (if later there was no {{cancel}} transaction for this upgrade). Generally this logic was right. But in case a manual upgrade to a higher version had been made previously on a node, this logic resulted in that after catch-up the node upgraded to a lower version.  *Changes:* - Added a constraint on a version that is lower than the current one to validation of {{POOL_UPGRADE}} transaction. - Added prevention of upgrade to a lower version to {{Upgrader}}. - Fixed a bug in {{Upgrader}} in search for a {{cancel}} transaction for the last upgrade {{start}} transaction. - Added a test verifying prevention of upgrade to a lower version. - Corrected existing tests according to introduced prevention of upgrade to a lower version. - Made minor corrections in existing tests.  *Committed into:* - https://github.com/hyperledger/indy-node/pull/402 - indy-node 1.1.42 rc  *Risk factors:* - Validation and processing of {{POOL_UPGRADE}} transaction.  *Risk:* - Low  *Covered with tests:* - {{testPoolUpgradeFailsIfVersionIsLowerThanCurrent}} - {{test_versions}}  ></body> </Action>
<Action id="32710" issue="20942" author="vladimirwork" type="comment" created="2017-10-19 15:07:22.0" updateauthor="vladimirwork" updated="2017-10-19 15:07:22.0"> <body><! CDATA Build Info: 1.1.42  Steps to Validate: 1. Upgrade pool using a transaction (in this case it also used force=True). 2. Next manually upgrade to the next version. 3. On one node stop the services (sovrin-node, sovrin-node-control) and delete the config_transactions directory. 4. When you start the services the config ledger has to sync and when it does it runs the last transaction.  Actual Results: Downgrade is not performed. Pool works normally.  Additional Info: - Added a constraint on a version that is lower than the current one to validation of POOL_UPGRADE transaction in the CLI. - Fixed a bug in Upgrader in search for a cancel transaction for the last upgrade start transaction.  ></body> </Action>
