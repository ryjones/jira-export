<Issue id="17555" key="INDY-156" number="156" project="10303" reporter="alexander.shekhovcov" assignee="danielhardman" creator="alexander.shekhovcov" type="10004" summary="POOL_UPGRADE txn unclear error message" priority="3" resolution="10000" status="10001" created="2017-06-06 12:17:40.0" updated="2019-03-29 20:33:02.0" resolutiondate="2019-03-29 20:33:02.0" votes="0" watches="4" timeoriginalestimate="10800" timeestimate="10800" workflowId="17559"> <description><! CDATA  *Steps:* # send POOL_UPGRADE txn with name "NAME" # make sure that the txn was accepted # send yet another POOL_UPGRADE txn with name "NAME"  *Result:* {code:java} Pool upgrade failed: client request invalid: UnauthorizedClientRequest('TRUSTEE cannot do POOL_UPGRADE',) {code} *Expected result:* * The error message should be clear, for example "Upgrade 'NAME' is already scheduled"  {code:java} Pool upgrade failed: client request invalid: UnauthorizedClientRequest('Upgrade 'NAME' is already scheduled',) {code}   * Or we can end up with accepting a POOL_UPGRADE txn with a name which is use already. Maybe having two upgrades with the same name is not a problem. In such a case the txn should be accepted without an error.     *The details:*  1. Send POOL_UPGRADE with name _upgrade-060617_     {code:java} send POOL_UPGRADE name=upgrade-060617 version=0.3.129 sha256=aad1242 action=start schedule={'Gw6pDLhcBcoQesN72qfotTgFa7cbuqZpk X3Xo6pLhPhv': '2017-06-06T14:25:00.258870+00:00', '8ECVSk179mjsjKRLWiQtssMLgp6EPhWXtaYyStWPSGAb': '2017-06-06T14:30:00.258870+00:00', 'DKVx G2fXXTU8yT5N7hGEbXB3dfdAnYv1JczDUHpmDxya':'2017-06-06T14:35:00.258870+00:00','4PS3EDQ3dW1tci1Bp6543CfuuebjFrg36kLAUcskGfaA':'2017-06-06T14: 40:00.258870+00:00'} timeout=10{code} 2. Previous POOL_UPGRADE had a mistake in schedule so another POOL_UPGRADE is send with same name {code:java} send POOL_UPGRADE name=upgrade-060617 version=0.3.129 sha256=aad1242 action=start schedule={'Gw6pDLhcBcoQesN72qfotTgFa7cbuqZpk X3Xo6pLhPhv': '2017-06-06T14:25:00.258870+00:00', '8ECVSk179mjsjKRLWiQtssMLgp6EPhWXtaYyStWPSGAb': '2017-06-06T14:30:00.258870+00:00', 'DKVx G2fXXTU8yT5N7hGEbXB3dfdAnYv1JczDUHpmDxya':'2017-06-06T14:35:00.258870+00:00','4PS3EDQ3dW1tci1Bp6543CfuuebjFrg36kLAUcskGfaA':'2017-06-06T14: 40:00.258870+00:00'} timeout=10 Sending pool upgrade upgrade-060617 for version 0.3.129 Pool upgrade failed: client request invalid: UnauthorizedClientRequest('TRUSTEE cannot do POOL_UPGRADE',){code} The error message *"TRUSTEE cannot do POOL_UPGRADE"* does not reflect the actual cause  3. Send POOL_UPGRADE with another name {code:java} send POOL_UPGRADE name=upgrade-060617-2 version=0.3.129 sha256=aad1242 action=start schedule={'Gw6pDLhcBcoQesN72qfotTgFa7cbuqZpkX3Xo6pLhPhv': '2017-06-06T14:45:00.258870+03:00', '8ECVSk179mjsjKRLWiQ tssMLgp6EPhWXtaYyStWPSGAb': '2017-06-06T14:50:00.258870+03:00', 'DKVxG2fXXTU8yT5N7hGEbXB3dfdAnYv1JczDUHpmDxya':'2017-06-06T14:55:00.258870+03:00','4PS3EDQ3dW1tci1Bp6543CfuuebjFrg36kLAUcskGfaA':'2017-06-06T15:00: 00.258870+03:00'} timeout=10 Sending pool upgrade upgrade-060617-2 for version 0.3.129 Pool upgrade successful {code} The upgrade is scheduled successfully.     ></description> </Issue>
