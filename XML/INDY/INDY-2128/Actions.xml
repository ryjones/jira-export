<Action id="60641" issue="40352" author="ashcherbakov" type="comment" created="2019-06-04 09:15:03.0" updateauthor="ashcherbakov" updated="2019-06-04 12:56:20.0"> <body><! CDATA *Summary*  The issue is not caused by Pool Upgrade. The upgrade went well. The pool was in consensus and wrote txns.  The issue is caused by the following: # An audit ledger-related bug in Plenum (see *Issue Reason* and INDY-2129) # A tricky sequence of steps (demotions-promotions) not mentioned in the ticket (see *Sequence of steps led to the issue*)     *Next Steps:* # Fix the Pool The following needs to be done: ## Stop all nodes ## It would be great to have the audit ledger from one of the Nodes as-is, that is the whole rocksdb database (/var/lib/indy/NETWORK_NAME/data/NODE_NAME/audit_transactions) instead of `read_ledger` output. This is needed to make sure that our fix script will work. ## It would be great to have `validator-info` script output (in verbose (-v) mode) from all nodes (a local script output, not remote command, since the pool doesn't response to any requests now) {code:java} validator_info -v {code} ## Run the script (fixing the data in audit ledger) that we will create and attach here (see *How to recover the Pool*) ## Start all nodes # Fix the issue: INDY-2129. See *How to fix the issue* # Issue a hotfix release?     *Important Consequences* * Please do not demote any nodes on StagingNet and MainNet until the fix from INDY-2129 is applied there * If a node has to be demoted, please make sure that it's not in the current list of primaries.     *Sequence of steps led to the issue:*  * 4:20 PM (UTC): The upgraded finished successfully ** "primaries": "datum-sovrin","uvs_val2","validatedid","OgNode","fetch-ai" ,  * 5:28:46 PM: "SYGNET1" was demoted ** primaries changed:  "primaries": "datum-sovrin","uvs_val2","validatedid","OgNode"  * 5:42:26 PM: The pool was restarted * {color:#de350b}*5:43:28 PM**: "validatedid" was demoted*{color} ** {color:#172b4d}primaries not changed: "primaries": "datum-sovrin","uvs_val2","validatedid"{color},"OgNode"  ** *primaries haven't been changed by the pool, but "validatedid" is one of the primaries, and it was demoted.*  * 6:13:40 PM: "SYGNET1" was promoted (added to the pool again) ** primaries not changed: "primaries": "datum-sovrin","uvs_val2","{color:#de350b}validatedid{color}","OgNode"   * *{color:#de350b}6:38:09 PM: The pool was restarted{color}* ** primaries not changed: "primaries": "datum-sovrin","uvs_val2","{color:#de350b}validatedid{color}","OgNode"  * The pool wasn't able to start-up correctly after this as it caught the following exception: `LogicError('Audit ledger has inconsistent names of nodes')`. This is caused by the fact, that {color:#172b4d}"validatedid" is one of the primaries, and it was demoted.{color} * The nodes stopped due to the exception, started up (automatically), and catch the exception again in a loop.     *Issue Reason:*  INDY-2129 was created. * The primaries are not changed (updated) if one of them is demoted and F (number of replicas) is not changed. ** For example, we had 6 nodes (F=1), and demoting 1 (F is still 1) * The list of primaries is stored in the audit ledger for recovering after restart. If a node (or a pool) is restarted, then the primaries will be restored from the audit ledger. So, if one of the primaries is demoted, it will not be found, and the pool raises `LogicError('Audit ledger has inconsistent names of nodes')`.     *How to recover the Pool*  We will create a script that will do the following: # Delete audit ledger hash store # Modify the last audit txn where the primaries are changed (a txn with seqNo=32322), so that the instead of {code:java} "primaries": "datum-sovrin","uvs_val2","validatedid","OgNode" `{code} it will have {code:java} "primaries": "datum-sovrin","uvs_val2","OgNode","fetch-ai" {code} that is `validatedid` is removed # When the node is started, the audit ledger hash store will be restored     *How to fix the issue* * Integration test will be written * The primaries in audit ledger needs to be updated if a demoted node is in the list of current primaries * A view change needs to be triggered if a demoted node is in the list of current primaries * Non-critical (recoverable) cases during node start-up (catch-up, post-catchup, primary selection) should not raise the LogicErrors. ** in particular, in `on_catchup_complete` method in `PrimarySelector`        ></body> </Action>
<Action id="60647" issue="40352" author="esplinr" type="comment" created="2019-06-04 13:21:23.0" updateauthor="esplinr" updated="2019-06-04 13:21:23.0"> <body><! CDATA Root cause analysis:  There was a long standing bug in how demotion was handled, such that the  demoted replica would silently fail. With the introduction of the Audit Ledger we added stricter checking of what we considered an impossible scenario which exposed the problem and resulted in the failure.  ></body> </Action>
<Action id="60649" issue="40352" author="lbendixsen" type="comment" body="I added attachment audit_transactions.tar with the requested rocksdb files in it.  tarred with &quot;cjvf&quot; parms.  " created="2019-06-04 14:08:29.0" updateauthor="lbendixsen" updated="2019-06-04 14:08:29.0"/>
<Action id="60651" issue="40352" author="lbendixsen" type="comment" created="2019-06-04 14:16:51.0" updateauthor="lbendixsen" updated="2019-06-04 14:16:51.0"> <body><! CDATA I will request 'validator-info -v' from all nodes, but in the meantime, here it is from FoundationBuilder (Sovrin's node):  *ubuntu@ip-172-31-35-134*:*~*$ sudo validator-info -v  "Hardware":           "HDD_all":      2692 Mbs        "RAM_all_free":  28657 Mbs        "RAM_used_by_node":  880 Mbs     "Node_info":          "BLS_key":      3gmhmqpPLqznZF3g3niodaHjbpsB6TEeE9SpgXgBnZJLmXgeRzJqTLajVwbhxrkomJFTFU4ohDC4ZRXKbUPCQywJuPAQnst8XBtCFredMECn4Z3goi1mNt5QVRdU8Ue2xMSkdLpsQMjCsNwYUsBguwXYUQnDXQXnHqRkK9qrivucQ5Z       "Catchup_status":             "Last_txn_3PC_keys":                  "0":                                 "Certisign":                               None                                  None                            "OgNode":                                  None                                  None                            "datum-sovrin":                             None                                  None                            "fetch-ai":                                None                                  None                            "makolab01":                               None                                  None                            "uvs_val2":                                None                                  None                            "vnode1":                                  None                                  None                            "xsvalidatorec2irl":                             None                                  None                       "1":                            "1001":                         "2":                            "3":                                 "Certisign":                               None                                  None                            "OgNode":                                  None                                  None                            "danube":                                  None                                  None                            "fetch-ai":                                None                                  None                            "uvs_val2":                                None                                  None                            "vnode1":                                  None                                  None                            "xsvalidatorec2irl":                             None                                  None                  "Ledger_statuses":                  "0":            synced                     "1":            not_synced                 "1001":         not_synced                 "2":            not_synced                 "3":            not_synced            "Number_txns_in_catchup":                  "0":            0                          "1":            0                          "1001":         0                          "2":            0                          "3":            0                     "Received_LedgerStatus":                        "Waiting_consistency_proof_msgs":                  "0":            None                       "1":            None                       "1001":         None                       "2":            None                       "3":            None             "Client_ip":    172.31.128.254       "Client_port":  9702             "Client_protocol":  tcp              "Committed_ledger_root_hashes":             "0":            b'5QEs5tSKGoMeW7mnQXAqHDrurVsLFumfJMPay1qu5zSB'            "1":            b'79YZKB72LSY68dbuYMvFk1rAyRfnMbUdSwVAtuj2vR5q'            "1001":         b'Hd5dtr5cwAodDUdPDUZkdMCHdaR1KdiqQLBUUxCQwRrP'            "2":            b'GD6oWhf2ZGwmrKRCXrugyz7R1evmPVkrygs9dcBHN9xJ'            "3":            b'7nBHLR1xP9yxkRyTVKUKmiCErNQF5mNSheXPWgYyBXdV'       "Committed_state_root_hashes":             "0":            b'CGuyq6T4ASsqDbSJVn7sAhhybjD4rhjpxSAQkjuPo2Tx'            "1":            b'78LWbD7o46dA2C8cYT8da1kRtLwnsXwJkch5obWdqQLd'            "1001":         b'7Mut4DkZsjAzJwxNRFWmFNN5zi3v9wj3xL28TpbaWDXG'            "2":            b'EDHc8pEcGBq9tTy8zbEA1wFoZy3an5eMo3VJN16Rv2ec'       "Count_of_replicas":  4                "Freshness_status":             "0":                            "Has_write_consensus":  True                       "Last_updated_time":  2019-06-04 14:10:35+00:00            "1":                            "Has_write_consensus":  True                       "Last_updated_time":  2019-06-04 14:10:35+00:00            "1001":                         "Has_write_consensus":  True                       "Last_updated_time":  2019-06-04 14:10:35+00:00            "2":                            "Has_write_consensus":  True                       "Last_updated_time":  2019-06-04 14:10:35+00:00       "Metrics":                 "Delta":        0.1                   "Lambda":       240                   "Omega":        20                    "average-per-second":                  "read-transactions":  0.08236989762391617                 "write-transactions":  0.0                   "avg backup throughput":  None                  "client avg request latencies":                  "0":            None                       "1":            None                       "2":            None                       "3":            None                  "instances started":                  "0":            7316415.736191218                 "1":            7316415.737209168                 "2":            7316415.738143472                 "3":            7316415.739143314            "master throughput":  None                  "master throughput ratio":  None                  "max master request latencies":  0                     "ordered request counts":                  "0":            0                          "1":            0                          "2":            0                          "3":            0                     "ordered request durations":                  "0":            0                          "1":            0                          "2":            0                          "3":            0                     "throughput":                  "0":            None                       "1":            None                       "2":            None                       "3":            None                  "total requests":  0                     "transaction-count":                  "1001":         10                         "audit":        32368                      "config":       86                         "ledger":       109                        "pool":         32                    "uptime":       60               "Mode":         discovering       "Name":         FoundationBuilder       "Node_ip":      172.31.35.134       "Node_port":    9701             "Node_protocol":  tcp              "Replicas_status":             "FoundationBuilder:0":                  "Last_ordered_3PC":                        0                                0                          "Primary":      None                       "Stashed_txns":                       "Stashed_PrePrepare":  0                               "Stashed_checkpoints":  0                          "Watermarks":   0:300                 "FoundationBuilder:1":                  "Last_ordered_3PC":                        0                                0                          "Primary":      None                       "Stashed_txns":                       "Stashed_PrePrepare":  0                               "Stashed_checkpoints":  0                          "Watermarks":   0:300                 "FoundationBuilder:2":                  "Last_ordered_3PC":                        0                                0                          "Primary":      None                       "Stashed_txns":                       "Stashed_PrePrepare":  0                               "Stashed_checkpoints":  0                          "Watermarks":   0:300                 "FoundationBuilder:3":                  "Last_ordered_3PC":                        0                                0                          "Primary":      None                       "Stashed_txns":                       "Stashed_PrePrepare":  0                               "Stashed_checkpoints":  0                          "Watermarks":   0:300            "Requests_timeouts":             "Ordering_phase_req_timeouts":  0                     "Propagates_phase_req_timeouts":  0                "Uncommitted_ledger_root_hashes":        "Uncommitted_ledger_txns":             "0":                            "Count":        0                     "1":                            "Count":        0                     "1001":                         "Count":        0                     "2":                            "Count":        0                     "3":                            "Count":        0                "Uncommitted_state_root_hashes":             "0":            b'CGuyq6T4ASsqDbSJVn7sAhhybjD4rhjpxSAQkjuPo2Tx'            "1":            b'78LWbD7o46dA2C8cYT8da1kRtLwnsXwJkch5obWdqQLd'            "1001":         b'7Mut4DkZsjAzJwxNRFWmFNN5zi3v9wj3xL28TpbaWDXG'            "2":            b'EDHc8pEcGBq9tTy8zbEA1wFoZy3an5eMo3VJN16Rv2ec'       "View_change_status":             "IC_queue":                     "8":                                 "Voters":                                 "FoundationBuilder":                                 "reason":       43                                   "fetch-ai":                                    "reason":       43                                   "uvs_val2":                                    "reason":       43                                   "validatedid":                                 "reason":       20                    "Last_complete_view_no":  0                     "Last_view_change_started_at":  1970-01-01 00:00:00            "VCDone_queue":             "VC_in_progress":  False                 "View_No":      0                "did":          GVvdyd7Y6hsBEy5yDDHjqkXgH8zW34K74RsxUiUCZDCE       "verkey":       46EM3ARvGqR1Z8FBUdQBscfDmDBdk3866oopEjbGjpMsjwVBfVL7cdf  "Pool_info":          "Blacklisted_nodes":        "Quorums":      {'strong': Quorum(9), 'n': 12, 'consistency_proof': Quorum(4), 'timestamp': Quorum(4), 'commit': Quorum(9), 'bls_signatures': Quorum(9), 'view_change_done': Quorum(9), 'reply': Quorum(4), 'checkpoint': Quorum(8), 'same_consistency_proof': Quorum(4), 'view_change': Quorum(9), 'ledger_status': Quorum(8), 'observer_data': Quorum(4), 'election': Quorum(9), 'weak': Quorum(4), 'propagate': Quorum(4), 'backup_instance_faulty': Quorum(4), 'prepare': Quorum(8), 'ledger_status_last_3PC': Quorum(4), 'f': 3}       "Reachable_nodes":               'Certisign', None               'FoundationBuilder', None               'OgNode', None               'danube', None               'fetch-ai', None               'uvs_val2', None               'vnode1', None        "Reachable_nodes_count":  7                "Read_only":    False            "Suspicious_nodes":                   "Total_nodes_count":  12               "Unreachable_nodes":               'SYGNET1', None               'datum-sovrin', None               'makolab01', None               'ovvalidator', None               'xsvalidatorec2irl', None        "Unreachable_nodes_count":  5                "f_value":      3           "Protocol":      "Software":           "Indy_packages":              hi  indy-node                        1.8.0                                      amd64        Indy node             hi  indy-plenum                      1.8.0                                      amd64        Plenum Byzantine Fault Tolerant Protocol             hi  libindy-crypto                   0.4.5                                      amd64        This is the shared crypto libirary for Hyperledger Indy components.             hi  python3-indy-crypto              0.4.5                                      amd64        This is the official wrapper for Hyperledger Indy Crypto library (https://www.hyperledger.org/projects).       "Installed_packages":              sovtokenfees 0.9.12             semver 2.7.9             psutil 5.4.3             portalocker 0.5.7             Pympler 0.5             intervaltree 2.1.0             python-dateutil 2.6.1             sovrin 1.1.45             timeout-decorator 0.4.0             setuptools 38.5.2             indy-crypto 0.4.5-23             ioflo 1.5.4             sortedcontainers 1.5.7             python-rocksdb 0.6.9             jsonpickle 0.9.6             indy-plenum 1.8.0             six 1.11.0             libnacl 1.6.1             orderedset 2.0             sha3 0.2.1             rlp 0.5.1              Pygments 2.2.0             distro 1.3.0             pyzmq 17.0.0             packaging 19.0             base58 1.0.0             sovtoken 0.9.12             indy-node 1.8.0       "OS_version":   Linux-4.4.0-1075-aws-x86_64-with-Ubuntu-16.04-xenial       "indy-node":    1.8.0            "sovrin":       1.1.45      "Update_time":  Tuesday, June 4, 2019 2:11:35 PM +0000  "response-version":  0.0.1       "timestamp":    1559657495     "Configuration":        "Config":                  "Main_config":                   # Current network                  NETWORK_NAME = 'net3'                  # Disable stdout logging                  enableStdOutLogging = False                  # Directory to store ledger.                  LEDGER_DIR = '/var/lib/indy'                  # Directory to store logs.                  LOG_DIR = '/var/log/indy'                  # Directory to store keys.                  KEYS_DIR = '/var/lib/indy'                  # Directory to store genesis transactions files.                  GENESIS_DIR = '/var/lib/indy'                  # Directory to store backups.                  BACKUP_DIR = '/var/lib/indy/backup'                  # Directory to store plugins.                  PLUGINS_DIR = '/var/lib/indy/plugins'                  # Directory to store node info.                  NODE_INFO_DIR = '/var/lib/indy'                  ENABLED_PLUGINS=                    ANYONE_CAN_WRITE = False                  UPGRADE_ENTRY = 'sovrin'                                            ENABLED_PLUGINS.append('sovtoken')                  ENABLED_PLUGINS.append('sovtokenfees')            "Network_config":             "User_config":        "Genesis_txns":             "domain_txns":                   {"reqSignature":{},"txn":\{"data":{"alias":"Phil Windley","dest":"NMjQb59rKTJXKNqVYfcZFi","role":"0","verkey":"Ce9jZ2bQcLRCrY3eT5AbjsU5mXFa4jMF6dDSF21tyeFJ"},"metadata":{},"type":"1"},"txnMetadata":\{"seqNo":1},"ver":"1"}                  {"reqSignature":{},"txn":\{"data":{"alias":"Jason Law","dest":"K2ze2xR8MAxkQscdkboKnD","role":"0","verkey":"~KhvZWs1QSS8bS1RxB55NE3"},"metadata":{},"type":"1"},"txnMetadata":\{"seqNo":2},"ver":"1"}                  {"reqSignature":{},"txn":\{"data":{"alias":"Drummond Reed","dest":"Jv4afJBghiuJ2tiZDduarJ","role":"0","verkey":"AmKnoVceCaEHBCaDjtSYqwLLpmVQLBbZMgAZHfSyv936"},"metadata":{},"type":"1"},"txnMetadata":\{"seqNo":3},"ver":"1"}                  {"reqSignature":{},"txn":\{"data":{"alias":"Peter Simpson","dest":"JX29L7h6UpDNEThiaTYx9N","role":"0","verkey":"AYmPQJTcpsH1YxRQUwwRgGzQVLFf8JRvmuS5LKNZN1gA"},"metadata":{},"type":"1"},"txnMetadata":\{"seqNo":4},"ver":"1"}                  {"reqSignature":{},"txn":\{"data":{"alias":"Ron Amstutz","dest":"7jJe9ArRfRchSKL2sYgFDj","role":"0","verkey":"4fjHSUqU9RmeXWXHV6MnKFDtEyEcBUipovhNCDuei5XW"},"metadata":{},"type":"1"},"txnMetadata":\{"seqNo":5},"ver":"1"}                  {"reqSignature":{},"txn":\{"data":{"alias":"Mawaki Chango","dest":"CPU9r7iLSXcSdn79FzbUvQ","role":"0","verkey":"7CyhcN7gsqo9VxAV1V7ZhiqTetAadY2S4QYcUdo3Uh4p"},"metadata":{},"type":"1"},"txnMetadata":\{"seqNo":6},"ver":"1"}                  {"reqSignature":{},"txn":\{"data":{"alias":"Mike Bailey","dest":"6feBTywcmJUriqqnGc1zSJ","role":"0","verkey":"~EpnvDMWiFSSu1YksE1Cg3n"},"metadata":{},"type":"1"},"txnMetadata":\{"seqNo":7},"ver":"1"}                  {"reqSignature":{},"txn":\{"data":{"alias":"Lynn Bendixsen","dest":"5M3i1PbpvEQmTk25EmAY6N","role":"0","verkey":"~7iwFwParUgTffA22Q5Tgvg"},"metadata":{},"type":"1"},"txnMetadata":\{"seqNo":8},"ver":"1"}                  {"reqSignature":{},"txn":\{"data":{"dest":"V5qJo72nMeF7x3ci8Zv2WP","role":"2","verkey":"~8gjR6mxPymhQV5pEERHYLJ"},"metadata":\{"from":"5M3i1PbpvEQmTk25EmAY6N"},"type":"1"},"txnMetadata":\{"seqNo":9},"ver":"1"}                  {"reqSignature":{},"txn":\{"data":{"dest":"FzAaV9Waa1DccDa72qwg13","role":"2","verkey":"~D5bNaxMVhMzi2bFVzZRtmG"},"metadata":\{"from":"5M3i1PbpvEQmTk25EmAY6N"},"type":"1"},"txnMetadata":\{"seqNo":10},"ver":"1"}                  {"reqSignature":{},"txn":\{"data":{"dest":"QuCBjYx4CbGCiMcoqQg1y","role":"2","verkey":"~NqriEDc1sz9yiY2ft2QGmx"},"metadata":\{"from":"5M3i1PbpvEQmTk25EmAY6N"},"type":"1"},"txnMetadata":\{"seqNo":11},"ver":"1"}                  {"reqSignature":{},"txn":\{"data":{"dest":"VbPQNHsvoLZdaNU7fTBeFx","role":"2","verkey":"~C8m3zsBqvEu1sHoeiGZpht"},"metadata":\{"from":"5M3i1PbpvEQmTk25EmAY6N"},"type":"1"},"txnMetadata":\{"seqNo":12},"ver":"1"}            "pool_txns":                     {"reqSignature":{},"txn":\{"data":{"data":{"alias":"FoundationBuilder","blskey":"3gmhmqpPLqznZF3g3niodaHjbpsB6TEeE9SpgXgBnZJLmXgeRzJqTLajVwbhxrkomJFTFU4ohDC4ZRXKbUPCQywJuPAQnst8XBtCFredMECn4Z3goi1mNt5QVRdU8Ue2xMSkdLpsQMjCsNwYUsBguwXYUQnDXQXnHqRkK9qrivucQ5Z","blskey_pop":"RHWacPhUNc9JWsGNdmWYHrAvvhsow399x3ttNKKLDpz9GkxxnTKxtiZqarkx4uP5ByTwF4kM8nZddFKWuzoKizVLttALQ2Sc2BNJfRzzUZMNeQSnESkKZ7U5vE2NhUDff6pjANczrrDAXd12AjSG61QADWdg8CVciZFYtEGmKepwzP","client_ip":"35.161.146.16","client_port":"9702","node_ip":"50.112.53.5","node_port":"9701","services": "VALIDATOR" },"dest":"GVvdyd7Y6hsBEy5yDDHjqkXgH8zW34K74RsxUiUCZDCE"},"metadata":\{"from":"V5qJo72nMeF7x3ci8Zv2WP"},"type":"0"},"txnMetadata":\{"seqNo":1,"txnId":"fe991cd590fff10f596bb6fe2362229de47d49dd50748e38b96f368152be29c7"},"ver":"1"}                  {"reqSignature":{},"txn":\{"data":{"data":{"alias":"vnode1","blskey":"t5jtREu8au2dwFwtH6QWopmTGxu6qmJ3iSnk321yLgeu7mHQRXf2ZCBuez8KCAQvFZGqqAoy2FcYvDGCqQxRCz9qXKgiBtykzxjDjYu87JECwwddnktz5UabPfZmfu6EoDn4rFxvd4myPu2hksb5Z9GT6UeoEYi7Ub3yLFQ3xxaQXc","blskey_pop":"QuHB7tiuFBPQ6zPkwHfMtjzWqXJBLACtfggm7zCRHHgdva18VN4tNg7LUU2FfKGQSLZz1M7oRxhhgJkZLL19aGvaHB2MPtnBWK9Hr8LMiwi95UjX3TVXJri4EvPjQ6UUvHrjZGUFvKQphPyVTMZBJwfkpGAGhpbTQuQpEH7f56m1X5","client_ip":"206.189.143.34","client_port":"9796","node_ip":"206.189.143.34","node_port":"9797","services": "VALIDATOR" },"dest":"9Aj2LjQ2fwszJRSdZqg53q5e6ayScmtpeZyPGgKDswT8"},"metadata":\{"from":"FzAaV9Waa1DccDa72qwg13"},"type":"0"},"txnMetadata":\{"seqNo":2,"txnId":"5afc282bf9a7a5e3674c09ee48e54d73d129aa86aa226691b042e56ff9eaf59b"},"ver":"1"}                  {"reqSignature":{},"txn":\{"data":{"data":{"alias":"xsvalidatorec2irl","blskey":"4ge1yEvjdcV6sDSqbevqPRWq72SgkZqLqfavBXC4LxnYh4QHFpHkrwzMNjpVefvhn1cgejHayXTfTE2Fhpu1grZreUajV36T6sT4BiewAisdEw59mjMxkp9teYDYLQqwPUFPgaGKDbFCUBEaNdAP4E8Q4UFiF13Qo5842pAY13mKC23","blskey_pop":"R5PoEfWvni5BKvy7EbUbwFMQrsgcuzuU1ksxfvySH6FC5jpmisvcHMdVNik6LMvAeSdt6K4sTLrqnaaQCf5aCHkeTcQRgDVR7oFYgyZCkF953m4kSwUM9QHzqWZP89C6GkBx6VPuL1RgPahuBHDJHHiK73xLaEJzzFZtZZxwoWYABH","client_ip":"52.50.114.133","client_port":"9702","node_ip":"52.209.6.196","node_port":"9701","services": "VALIDATOR" },"dest":"DXn8PUYKZZkq8gC7CZ2PqwECzUs2bpxYiA5TWgoYARa7"},"metadata":\{"from":"QuCBjYx4CbGCiMcoqQg1y"},"type":"0"},"txnMetadata":\{"seqNo":3,"txnId":"1972fce7af84b7f63b7f0c00495a84425cce3b0c552008576e7996524cca04cb"},"ver":"1"}                  {"reqSignature":{},"txn":\{"data":{"data":{"alias":"danube","blskey":"3Vt8fxn7xg8n8pR872cvGWNuR7STFzFSPMftX96zF6871wYVTR27aspxGSeEtx9wj8g4D3GdCxHJbQ4FsxQz6TATQswiiZfxAVNjLLUci8WSH4t1GPx9CvGXB2uzDfVnnJyhhnASxJEbvykLUBBFG3fW4tMQixujpowUADz5jHm427u","blskey_pop":"RJpXXLkjRRv9Lk8tJz8LTkhhC7RWjHQcB9CG8J8U8fXT6arTDMYc62zXtToBAmGkGu8Udsmo3Hh7mv4KB9JAf8ufGY9WsnppCVwar7zEXyBfLpCnDhvVcBAzkhRpHmqHygN24DeBu9aH6tw4uXxVJvRRGSbPtxjWa379BmfQWzXHCb","client_ip":"207.180.207.73","client_port":"9702","node_ip":"173.249.14.196","node_port":"9701","services": "VALIDATOR" },"dest":"52muwfE7EjTGDKxiQCYWr58D8BcrgyKVjhHgRQdaLiMw"},"metadata":\{"from":"VbPQNHsvoLZdaNU7fTBeFx"},"type":"0"},"txnMetadata":\{"seqNo":4,"txnId":"ebf340b317c044d970fcd0ca018d8903726fa70c8d8854752cd65e29d443686c"},"ver":"1"}       "indy-node-control.service":               Unit                  Description=Service for upgrade of existing Indy Node and other operations             #Requires=indy.service             #After=indy.service             After=network.target                                     Service               Type=simple             EnvironmentFile=/etc/indy/node_control.conf             ExecStart=/usr/bin/env python3 -O /usr/local/bin/start_node_control_tool $TEST_MODE --hold-ext ${HOLD_EXT}             Restart=on-failure             RestartSec=10             StartLimitBurst=10             StartLimitInterval=200             TimeoutSec=300               Install               WantedBy=multi-user.target       "indy-node.service":               Unit                  Description=Indy Node             Requires=indy-node-control.service              Service               EnvironmentFile=/etc/indy/indy.env             ExecStart=/usr/bin/env python3 -O /usr/local/bin/start_indy_node ${NODE_NAME} ${NODE_IP} ${NODE_PORT} ${NODE_CLIENT_IP} ${NODE_CLIENT_PORT}             User=indy              Group=indy             Restart=on-failure             RestartSec=10             StartLimitBurst=10             StartLimitInterval=200             TimeoutSec=300             LimitNOFILE=65536:131072              Install               WantedBy=multi-user.target                      "indy.env":                 NODE_NAME=FoundationBuilder             NODE_IP=172.31.35.134             NODE_PORT=9701             NODE_CLIENT_IP=172.31.128.254             NODE_CLIENT_PORT=9702             CLIENT_CONNECTIONS_LIMIT=500       "iptables_config":        "node_control.conf":              # Uncomment this to run agent in test mode:             #TEST_MODE=--test             TEST_MODE=             HOLD_EXT=sovtoken sovtokenfees sovrin  ></body> </Action>
<Action id="60652" issue="40352" author="sergey.khoroshavin" type="comment" created="2019-06-04 14:26:29.0" updateauthor="sergey.khoroshavin" updated="2019-06-04 15:32:09.0"> <body><! CDATA *Script for patching audit ledger:*  ^fix_audit_ledger.py    *This script expects that there is only one node installation with one network on each machine running BuilderNet* *This script should be run on every machine running BuilderNet*  How to use: * copy script to target machines * stop indy-node service * run script with superuser privileges (it will patch audit ledger transaction log and delete merkle tree databases) * make sure it outputs "Patch applied successfully!" * after all nodes are patched start indy-node service (it will rebuild merkle tree databases on startup, which can take some time)  Script will abort if: * it cannot open audit ledger database (for example, if it is locked by running indy node) * it cannot read transaction with expected seq no * transaction doesn't contain expected primaries  Also script detects if audit ledger was already patched, and reports and aborts if so.  ></body> </Action>
