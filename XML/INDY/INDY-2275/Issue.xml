<Issue id="43016" key="INDY-2275" number="2275" project="10303" reporter="ashcherbakov" assignee="anikitindsr" creator="ashcherbakov" type="10002" summary="A Node missing a View Change may not be able to finish it if NODE txns have been sent" priority="3" resolution="10000" status="10001" created="2019-10-28 16:29:18.0" updated="2019-11-05 08:24:15.0" resolutiondate="2019-11-05 08:24:15.0" votes="0" watches="1" workflowId="56120"> <description><! CDATA *Issue* * There are NODE txns affecting primary selection (promotion/demotion/new nodes + specific viewNo) * A node didn't finish view change from X to X+1 while the pool finished, and the node tries to do a view change from X to X+2 * A node doesn't know who was the Primary on view X+1 during re-ordering, so it gets wrong audit ledger (since Primary is part of audit txn) * The Node will have to wait for a quorum of checkpoints from other nodes (~200 batches) to be able to continue ordering  *Possible fix* * Keep a map of primaries for every view (it needs to be cleaned up on GC) * Get primaries from Audit ledger's uncommitted txns if a primary for view X is unknown * Add Primaries to PrePrepare * Get Primaries from PrePrepare if it can not be get audit ledger as well (it means re-ordering after the view change, so that we can trust such primaries as they have prepared certificate).   ></description> </Issue>
