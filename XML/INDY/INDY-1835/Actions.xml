<Action id="53302" issue="35240" author="ashcherbakov" type="comment" created="2018-11-12 07:49:26.0" updateauthor="ashcherbakov" updated="2018-11-12 07:49:26.0"> <body><! CDATA We need to get the following information from load test runs: 1) How many txns pool was able to write (on every node) 2) Whether the pool continues to write txns 3) Was there any failures in jornalctl; did the node restart by OOM or other errors 4) How many view changes completed 5) How much time each View Change took 6) Whether View Changes were finished by last_prepared_certificate, or by catchup 7) Whether the ledger is broken on any nodes 8) Provide graphs for metrics  ></body> </Action>
<Action id="53313" issue="35240" author="anikitindsr" type="comment" created="2018-11-12 12:13:11.0" updateauthor="anikitindsr" updated="2018-11-15 10:48:34.0"> <body><! CDATA As a result of logs investigation: 1. On all nodes except 4, 13 and 19 wrote the same count of transaction, about 2.2 million. Nodes 4, 13 and 19 had OOM errors and was not restarted (process is alive, but there is no any activities from it, like log writing or etc) 2. All the time, during 3 days, pool wrote transactions 3. There is several OOM errors in journalctl. Also, all of the nodes were restarted after this and continued to accept transactions after initial catchup, except 3 nodes 4. Before stopping the test 106 view_change rounds were completed (view change was forced each 1 hour). 5. Average time for view_change was about several seconds (5-10). Also there was some long view_change, like 5 minutes. The reason why is that half of prepared certificate was (33, 2640) and from other was (33, 2641). In that case we will do catchup rounds until timeout estimation. 6. The most of view_changes were completed by last_prepared_certificate (103 of 106). 7. There was some "Incorrect state tree errors", but it was after node restarted by OOM error. Other comments: - it looks, like VCStartStrategy works fine, because of the most of view changes were completed by last_prepared_certificate. - time, which was spent for strategy working is quite small in comparison of all view_change time (about 100 ms vs 5 min for whole view_change)  ></body> </Action>
<Action id="53472" issue="35240" author="anikitindsr" type="comment" created="2018-11-15 08:46:42.0" updateauthor="anikitindsr" updated="2018-11-15 09:26:22.0"> <body><! CDATA During log analizing was found a bug, which associated with batch handling. There is a lot of errors in logs, like "discard batch "<some message>" because Expected object or value", that means, that error was raised on string 'pi' or 'po' serialization. In this case, all batch will be discarded with some other messages inside, like Propogate, for example. This behaivour was catched in a previous logs too, therefore it was not impacted by view_change strategy. For this issue was created a bug INDY-1849.  As for strategy working: As i described above, the most of view_changes were completed by last_prepared_certificate. Also there is some spikes on throughput graph that means that strategy can give some real chance to ordering before view_change starting or get the most suitable last_prepared_certificate. !image.png|thumbnail!  ></body> </Action>
