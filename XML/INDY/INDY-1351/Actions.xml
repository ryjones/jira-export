<Action id="44732" issue="30408" author="esplinr" type="comment" created="2018-05-21 14:12:12.0" updateauthor="esplinr" updated="2018-05-21 14:12:12.0"> <body><! CDATA  ~mgbailey : We plan to take this into the next sprint. Can you provide some additional information for all nodes? * results from validator_info * log files * journal_ctl  ></body> </Action>
<Action id="45120" issue="30408" author="ashcherbakov" type="comment" created="2018-05-25 08:57:36.0" updateauthor="ashcherbakov" updated="2018-05-25 08:57:36.0"> <body><! CDATA  ~mgbailey  can you please also give us `pool_ledger` results  ></body> </Action>
<Action id="45226" issue="30408" author="sergey.khoroshavin" type="comment" created="2018-05-29 10:12:06.0" updateauthor="sergey.khoroshavin" updated="2018-05-29 10:33:56.0"> <body><! CDATA Results of analyzing all _send NYM_ found in _cli.log_ that were run against STN:  *#1* {code:java} 2018-05-14 20:26:04,329 | INFO     | cli.py               (1965) | parse | CLI command entered: send NYM dest=QDpRcG3NzCdebPYMfGHLCu verkey=~64fSD6sumsMw7cbXEvjx6e {code} According to client logs it had reqId _1526329564330712_, was received by pool but was _not ordered_, although pool was sending REQACK for more than a minute. Unfortunatelly it's impossible to find out what happened in pool because logs from pool start from 2018-05-17.  *#2* {code:java} 2018-05-14 21:01:40,952 | INFO     | cli.py               (1965) | parse | CLI command entered: send NYM dest=QDpRcG3NzCdebPYMfGHLCv verkey=~64fSD6sumsMw7cbXEvjx6e {code} According to client logs it had reqId _1526331700953882_, was received by pool but was _not ordered_ before entering _exit_ command, which happened just 15 seconds later. As with #1 it's impossible to find out what happened in pool because logs from pool start from 2018-05-17.  *#3* {code:java} 2018-05-14 21:44:31,307 | INFO     | cli.py               (1965) | parse | CLI command entered: send NYM dest=QDpRcG3NzCdebPYMfGHLCw verkey=~64fSD6sumsMw7cbXEvjx6e {code} According to client logs it had reqId _1526334271308655_ and was _ordered_. Although pool logs start much later there was one trace of this transaction in them, saying that this request was freed from previous checkpoints, which means that request was ordered in past and after some time volatile data was garbage collected (but request stayed in ledger).  *#4* {code:java} 2018-05-16 19:05:56,937 | INFO     | cli.py               (1965) | parse | CLI command entered: send NYM dest=QZ6oA5DRYeXcTjZ9wcz6W6 verkey=~3fSg4QSYqib6m5k1uYTM6J {code} According to client logs it had reqId _1526497556938749_ and was _ordered_. Pool logs are as with #3.  *#5* {code:java} 2018-05-17 21:10:08,361 | INFO     | cli.py               (1965) | parse | CLI command entered: send NYM dest=K7nyddFfeig8TZyywTGdBP verkey=~8zxeohE2qitTcN116TrS8e {code} According to client logs it had reqId _1526591408362386_ and was _ordered_. Pool logs confirm that: {code:java} 2018-05-17 21:10:08,908 | INFO     | replica.py           (1644) | order_3pc_key | REPLICA:(australia:0) australia:0 ordered batch request, view no 2, ppSeqNo 1, ledger 1, state root GBKDV9XmGVgqEBkwkKYD9gUwULJXMZA5dxyYf6iWwiPo, txn root HHgwcMagafGrVur8DBNLgawXisiCq2adnv6gWvedgmgt, requests ordered  ('3U8HUen8WcgpbnEz1etnai', 1526591408362386) , discarded    2018-05-17 21:10:08,929 | INFO     | replica.py           (1644) | order_3pc_key | REPLICA:(brazil:0) brazil:0 ordered batch request, view no 2, ppSeqNo 1, ledger 1, state root GBKDV9XmGVgqEBkwkKYD9gUwULJXMZA5dxyYf6iWwiPo, txn root HHgwcMagafGrVur8DBNLgawXisiCq2adnv6gWvedgmgt, requests ordered  ('3U8HUen8WcgpbnEz1etnai', 1526591408362386) , discarded    2018-05-17 21:10:08,883 | INFO     | replica.py           (1644) | order_3pc_key | REPLICA:(canada:0) canada:0 ordered batch request, view no 2, ppSeqNo 1, ledger 1, state root GBKDV9XmGVgqEBkwkKYD9gUwULJXMZA5dxyYf6iWwiPo, txn root HHgwcMagafGrVur8DBNLgawXisiCq2adnv6gWvedgmgt, requests ordered  ('3U8HUen8WcgpbnEz1etnai', 1526591408362386) , discarded    2018-05-17 21:10:08,905 | INFO     | replica.py           (1644) | order_3pc_key | REPLICA:(england:0) england:0 ordered batch request, view no 2, ppSeqNo 1, ledger 1, state root GBKDV9XmGVgqEBkwkKYD9gUwULJXMZA5dxyYf6iWwiPo, txn root HHgwcMagafGrVur8DBNLgawXisiCq2adnv6gWvedgmgt, requests ordered  ('3U8HUen8WcgpbnEz1etnai', 1526591408362386) , discarded    2018-05-17 21:10:08,902 | INFO     | replica.py           (1644) | order_3pc_key | REPLICA:(korea:0) korea:0 ordered batch request, view no 2, ppSeqNo 1, ledger 1, state root GBKDV9XmGVgqEBkwkKYD9gUwULJXMZA5dxyYf6iWwiPo, txn root HHgwcMagafGrVur8DBNLgawXisiCq2adnv6gWvedgmgt, requests ordered  ('3U8HUen8WcgpbnEz1etnai', 1526591408362386) , discarded    2018-05-17 21:10:08,887 | INFO     | replica.py           (1644) | order_3pc_key | REPLICA:(singapore:0) singapore:0 ordered batch request, view no 2, ppSeqNo 1, ledger 1, state root GBKDV9XmGVgqEBkwkKYD9gUwULJXMZA5dxyYf6iWwiPo, txn root HHgwcMagafGrVur8DBNLgawXisiCq2adnv6gWvedgmgt, requests ordered  ('3U8HUen8WcgpbnEz1etnai', 1526591408362386) , discarded    2018-05-17 21:10:08,875 | INFO     | replica.py           (1644) | order_3pc_key | REPLICA:(virginia:0) virginia:0 ordered batch request, view no 2, ppSeqNo 1, ledger 1, state root GBKDV9XmGVgqEBkwkKYD9gUwULJXMZA5dxyYf6iWwiPo, txn root HHgwcMagafGrVur8DBNLgawXisiCq2adnv6gWvedgmgt, requests ordered  ('3U8HUen8WcgpbnEz1etnai', 1526591408362386) , discarded    {code} *#6* {code:java} 2018-05-18 15:21:19,101 | INFO     | cli.py               (1965) | parse | CLI command entered: send NYM dest=QCBRocePuf5Uh25t2gvxVF verkey=~5XLxgQMj3TGF4NDinf5zN {code} According to client logs it had reqId _1526656879102446_ and was _ordered_. Pool logs confirm that: {code:java} 2018-05-18 15:37:34,910 | DEBUG    | node.py              (1999) | processRequest | australia received client request: SafeRequest: {'protocolVersion': 1, 'operation': {'verkey': '~5XLxgQMj3TGF4NDinf5zN7', 'type': '1', 'dest': 'QCBRocePuf5Uh25t2gvxVF'}, 'signature': 'EcH7bEDjMieexXpyUSvbnmpUuXapR9QgFgF75d5c5W6eP1H8dkCSbk6gamwkc3WaWnF6aARxszufGL86g47vP1n', 'reqId': 1526656879102446, 'identifier': '3U8HUen8WcgpbnEz1etnai'} from b'B?9LSJnT#gd1K/*0npJmEE1aoKPj6Qtcr8!IVg$n' 2018-05-18 15:37:34,919 | DEBUG    | node.py              (1999) | processRequest | brazil received client request: SafeRequest: {'signature': 'EcH7bEDjMieexXpyUSvbnmpUuXapR9QgFgF75d5c5W6eP1H8dkCSbk6gamwkc3WaWnF6aARxszufGL86g47vP1n', 'operation': {'dest': 'QCBRocePuf5Uh25t2gvxVF', 'verkey': '~5XLxgQMj3TGF4NDinf5zN7', 'type': '1'}, 'protocolVersion': 1, 'identifier': '3U8HUen8WcgpbnEz1etnai', 'reqId': 1526656879102446} from b'B?9LSJnT#gd1K/*0npJmEE1aoKPj6Qtcr8!IVg$n' 2018-05-18 15:37:34,860 | DEBUG    | node.py              (1999) | processRequest | canada received client request: SafeRequest: {'operation': {'type': '1', 'verkey': '~5XLxgQMj3TGF4NDinf5zN7', 'dest': 'QCBRocePuf5Uh25t2gvxVF'}, 'protocolVersion': 1, 'signature': 'EcH7bEDjMieexXpyUSvbnmpUuXapR9QgFgF75d5c5W6eP1H8dkCSbk6gamwkc3WaWnF6aARxszufGL86g47vP1n', 'reqId': 1526656879102446, 'identifier': '3U8HUen8WcgpbnEz1etnai'} from b'B?9LSJnT#gd1K/*0npJmEE1aoKPj6Qtcr8!IVg$n' 2018-05-18 15:37:34,900 | DEBUG    | node.py              (1999) | processRequest | england received client request: SafeRequest: {'identifier': '3U8HUen8WcgpbnEz1etnai', 'reqId': 1526656879102446, 'operation': {'dest': 'QCBRocePuf5Uh25t2gvxVF', 'type': '1', 'verkey': '~5XLxgQMj3TGF4NDinf5zN7'}, 'signature': 'EcH7bEDjMieexXpyUSvbnmpUuXapR9QgFgF75d5c5W6eP1H8dkCSbk6gamwkc3WaWnF6aARxszufGL86g47vP1n', 'protocolVersion': 1} from b'B?9LSJnT#gd1K/*0npJmEE1aoKPj6Qtcr8!IVg$n' 2018-05-18 15:37:34,895 | DEBUG    | node.py              (1999) | processRequest | korea received client request: SafeRequest: {'reqId': 1526656879102446, 'signature': 'EcH7bEDjMieexXpyUSvbnmpUuXapR9QgFgF75d5c5W6eP1H8dkCSbk6gamwkc3WaWnF6aARxszufGL86g47vP1n', 'protocolVersion': 1, 'operation': {'verkey': '~5XLxgQMj3TGF4NDinf5zN7', 'dest': 'QCBRocePuf5Uh25t2gvxVF', 'type': '1'}, 'identifier': '3U8HUen8WcgpbnEz1etnai'} from b'B?9LSJnT#gd1K/*0npJmEE1aoKPj6Qtcr8!IVg$n' 2018-05-18 15:37:34,913 | DEBUG    | node.py              (1999) | processRequest | singapore received client request: SafeRequest: {'identifier': '3U8HUen8WcgpbnEz1etnai', 'protocolVersion': 1, 'operation': {'verkey': '~5XLxgQMj3TGF4NDinf5zN7', 'dest': 'QCBRocePuf5Uh25t2gvxVF', 'type': '1'}, 'reqId': 1526656879102446, 'signature': 'EcH7bEDjMieexXpyUSvbnmpUuXapR9QgFgF75d5c5W6eP1H8dkCSbk6gamwkc3WaWnF6aARxszufGL86g47vP1n'} from b'B?9LSJnT#gd1K/*0npJmEE1aoKPj6Qtcr8!IVg$n' 2018-05-18 15:37:34,856 | DEBUG    | node.py              (1999) | processRequest | virginia received client request: SafeRequest: {'operation': {'verkey': '~5XLxgQMj3TGF4NDinf5zN7', 'type': '1', 'dest': 'QCBRocePuf5Uh25t2gvxVF'}, 'identifier': '3U8HUen8WcgpbnEz1etnai', 'signature': 'EcH7bEDjMieexXpyUSvbnmpUuXapR9QgFgF75d5c5W6eP1H8dkCSbk6gamwkc3WaWnF6aARxszufGL86g47vP1n', 'reqId': 1526656879102446, 'protocolVersion': 1} from b'B?9LSJnT#gd1K/*0npJmEE1aoKPj6Qtcr8!IVg$n'  2018-05-18 15:37:35,451 | INFO     | replica.py           (1644) | order_3pc_key | REPLICA:(australia:0) australia:0 ordered batch request, view no 0, ppSeqNo 1, ledger 1, state root tY6WXMe5e87ZmTt1u8CWC3VkkDEN4FCfBA9ZC95UyMm, txn root 33Bpy7rZZDa3DnSF6kvr5om3La19JougCiu1mBBHmvy9, requests ordered  ('3U8HUen8WcgpbnEz1etnai', 1526656879102446) , discarded    2018-05-18 15:37:35,512 | INFO     | replica.py           (1644) | order_3pc_key | REPLICA:(brazil:0) brazil:0 ordered batch request, view no 0, ppSeqNo 1, ledger 1, state root tY6WXMe5e87ZmTt1u8CWC3VkkDEN4FCfBA9ZC95UyMm, txn root 33Bpy7rZZDa3DnSF6kvr5om3La19JougCiu1mBBHmvy9, requests ordered  ('3U8HUen8WcgpbnEz1etnai', 1526656879102446) , discarded    2018-05-18 15:37:35,460 | INFO     | replica.py           (1644) | order_3pc_key | REPLICA:(canada:0) canada:0 ordered batch request, view no 0, ppSeqNo 1, ledger 1, state root tY6WXMe5e87ZmTt1u8CWC3VkkDEN4FCfBA9ZC95UyMm, txn root 33Bpy7rZZDa3DnSF6kvr5om3La19JougCiu1mBBHmvy9, requests ordered  ('3U8HUen8WcgpbnEz1etnai', 1526656879102446) , discarded    2018-05-18 15:37:35,485 | INFO     | replica.py           (1644) | order_3pc_key | REPLICA:(england:0) england:0 ordered batch request, view no 0, ppSeqNo 1, ledger 1, state root tY6WXMe5e87ZmTt1u8CWC3VkkDEN4FCfBA9ZC95UyMm, txn root 33Bpy7rZZDa3DnSF6kvr5om3La19JougCiu1mBBHmvy9, requests ordered  ('3U8HUen8WcgpbnEz1etnai', 1526656879102446) , discarded    2018-05-18 15:37:35,419 | INFO     | replica.py           (1644) | order_3pc_key | REPLICA:(korea:0) korea:0 ordered batch request, view no 0, ppSeqNo 1, ledger 1, state root tY6WXMe5e87ZmTt1u8CWC3VkkDEN4FCfBA9ZC95UyMm, txn root 33Bpy7rZZDa3DnSF6kvr5om3La19JougCiu1mBBHmvy9, requests ordered  ('3U8HUen8WcgpbnEz1etnai', 1526656879102446) , discarded    2018-05-18 15:37:35,446 | INFO     | replica.py           (1644) | order_3pc_key | REPLICA:(singapore:0) singapore:0 ordered batch request, view no 0, ppSeqNo 1, ledger 1, state root tY6WXMe5e87ZmTt1u8CWC3VkkDEN4FCfBA9ZC95UyMm, txn root 33Bpy7rZZDa3DnSF6kvr5om3La19JougCiu1mBBHmvy9, requests ordered  ('3U8HUen8WcgpbnEz1etnai', 1526656879102446) , discarded    2018-05-18 15:37:35,456 | INFO     | replica.py           (1644) | order_3pc_key | REPLICA:(virginia:0) virginia:0 ordered batch request, view no 0, ppSeqNo 1, ledger 1, state root tY6WXMe5e87ZmTt1u8CWC3VkkDEN4FCfBA9ZC95UyMm, txn root 33Bpy7rZZDa3DnSF6kvr5om3La19JougCiu1mBBHmvy9, requests ordered  ('3U8HUen8WcgpbnEz1etnai', 1526656879102446) , discarded    {code} Also it seems that time on client and in pool was off by more than 15 minutes.  *#7* {code:java} 2018-05-18 19:31:39,672 | INFO     | cli.py               (1965) | parse | CLI command entered: send NYM dest=S1JyATGKWBg8WvoVydsbmW verkey=~9oe3weBSuwTwnTELUVi7Ai {code} According to client logs there were no replies at all from pool. Also there are no traces of this request in pool: {code:java} $ ls australia.log  brazil.log  canada.log  cli.log  england.log  korea.log  singapore.log  virginia.log  $ find *.log -exec cat {} \; | grep "S1JyATGKWBg8WvoVydsbmW" 2018-05-18 19:31:39,672 | INFO     | cli.py               (1965) | parse | CLI command entered: send NYM dest=S1JyATGKWBg8WvoVydsbmW verkey=~9oe3weBSuwTwnTELUVi7Ai {code} although for most nodes logs were available for much later time: {code:java} $ find *.log -exec echo {} \; -exec tail -n 1 {} \; australia.log 2018-05-18 21:27:39,236 | DEBUG    | message_processor.py (  29) | discard | australia discarding message deque( b'po' ) because CONNECTION: rid b'mCCh!JxOp$OwLp#m{bh)FPMMB:Q*m*DLSZ&*e1>4' no longer available brazil.log 2018-05-18 21:27:39,923 | DEBUG    | message_processor.py (  29) | discard | brazil discarding message deque( b'po' ) because CONNECTION: rid b'mCCh!JxOp$OwLp#m{bh)FPMMB:Q*m*DLSZ&*e1>4' no longer available canada.log 2018-05-18 21:27:39,404 | DEBUG    | message_processor.py (  29) | discard | canada discarding message deque( b'po' ) because CONNECTION: rid b'mCCh!JxOp$OwLp#m{bh)FPMMB:Q*m*DLSZ&*e1>4' no longer available cli.log 2018-05-18 20:13:14,065 | INFO     | looper.py            ( 282) | shutdown | Looper shut down in 0.016 seconds. england.log 2018-05-18 21:27:39,141 | DEBUG    | message_processor.py (  29) | discard | england discarding message deque( b'po' ) because CONNECTION: rid b'mCCh!JxOp$OwLp#m{bh)FPMMB:Q*m*DLSZ&*e1>4' no longer available korea.log 2018-05-18 16:07:08,119 | DEBUG    | looper.py            ( 285) | shutdown | Unsetting handler for SIGTERM singapore.log 2018-05-18 21:27:40,406 | DEBUG    | message_processor.py (  29) | discard | singapore discarding message deque( b'po' ) because CONNECTION: rid b'mCCh!JxOp$OwLp#m{bh)FPMMB:Q*m*DLSZ&*e1>4' no longer available virginia.log 2018-05-18 21:27:39,109 | DEBUG    | message_processor.py (  29) | discard | virginia discarding message deque( b'po' ) because CONNECTION: rid b'mCCh!JxOp$OwLp#m{bh)FPMMB:Q*m*DLSZ&*e1>4' no longer available {code} This means that unless client had very large local time offset (which is highly unlikely I hope) the only reason for this is that pool did not receive request at all, not even single node. I'm going to investigate logs from pool during this time period.     As a side note - it would be very helpful if further bug reports like these (STN not accepting transactions) contained not only logs but also some info about time when problem occured so we can better focus on problem.  ></body> </Action>
<Action id="45231" issue="30408" author="sergey.khoroshavin" type="comment" created="2018-05-29 11:14:48.0" updateauthor="sergey.khoroshavin" updated="2018-05-29 11:14:48.0"> <body><! CDATA Further log analysis around _2018-05-18 19:31:39_ showed that there was request posted to pool (although it had destination different from ones found in _cli.log_). I'm posting here filtered logs from _australia_ (they are the most interesting since _australia_ was primary on master instance), but logs from other nodes contain very similar information (they received same request and same number of _PREPARE_): {code} 2018-05-18 19:36:44.475000 | australia | australia received client request: SafeRequest: {'protocolVersion': 1, 'operation': {'verkey': '~Uo9bXMbYHPTzZtpnwTdapL', 'type': '1', 'dest': 'KypizRsg73qrX75NPFY6H2'}, 'signature': 'AkmVpx5tVMrSgaoVaQ6Wb8A74foMKaAJMTdVmdwWw5zLfBWq44Z5FRk5CWSCYXqxFNVbxjPijPak3mFCou453LU', 'reqId': 1526671235863619430, 'identifier': 'RtMtkBrkHCEDtGXXqRfGoV'} from b' Sa3Q.==%.kjGRpmeuAE3U(@x^}XcXq Y{fK%Fr+' 2018-05-18 19:36:44.518000 | australia | australia sending message PREPREPARE{'txnRootHash': 'F7wzzYTPRZ3dyWMmrpgJnMkfXc7GEng1eGvjD9RBwg8W', 'stateRootHash': '9fNC4BboZcD7in2Cjj3ZAMSbHreM9XAwUQZ1E6a24uJ4', 'viewNo': 0, 'instId': 0, 'ppSeqNo': 2, 'digest': 'c95900a51c10cbcfa487c19d99b90bd5af5588402b8978d907da3f0fcb080afb', 'ppTime': 1526672204, 'blsMultiSig':  'RLjZ1GGzWfQSRSc45sxtgcGcxKrAsKn8KBeFxdgscCAqhyVT7vfRLr6bdLSpLvNFtxi69vzMVTfmeQ5DjwticaWDbqT3W7nj83SDmmxwWsvFKNH6MRPhtTKHbaY62k1XLfMzYoGwtfv9XHQWLBAVtSaVXumyWPW6QwRE9iKf4uBskB',  'ibm', 'canada', 'virginia', 'singapore', 'england', 'korea', 'australia', 'brazil' ,  1, 'tY6WXMe5e87ZmTt1u8CWC3VkkDEN4FCfBA9ZC95UyMm', 'GzjYafMVAJBDujzjXMmKtwxzxHQpmz1U9xt1eaB8p5ge', '33Bpy7rZZDa3DnSF6kvr5om3La19JougCiu1mBBHmvy9', 1526657854  , 'discarded': 1, 'reqIdr':  ('RtMtkBrkHCEDtGXXqRfGoV', 1526671235863619430) , 'ledgerId': 1} to all recipients:  'canada', 'ibm', 'korea', 'VeridiumIDC', 'virginia', 'findentity', 'RFCU', 'england', 'singapore', 'brazil'  2018-05-18 19:36:44.756000 | australia | australia received node message from ibm: PREPARE{'txnRootHash': 'F7wzzYTPRZ3dyWMmrpgJnMkfXc7GEng1eGvjD9RBwg8W', 'viewNo': 0, 'instId': 0, 'ppSeqNo': 2, 'digest': 'c95900a51c10cbcfa487c19d99b90bd5af5588402b8978d907da3f0fcb080afb', 'ppTime': 1526672204, 'stateRootHash': '9fNC4BboZcD7in2Cjj3ZAMSbHreM9XAwUQZ1E6a24uJ4'} 2018-05-18 19:36:44.763000 | australia | australia received node message from singapore: PREPARE{'txnRootHash': 'F7wzzYTPRZ3dyWMmrpgJnMkfXc7GEng1eGvjD9RBwg8W', 'viewNo': 0, 'instId': 0, 'ppSeqNo': 2, 'digest': 'c95900a51c10cbcfa487c19d99b90bd5af5588402b8978d907da3f0fcb080afb', 'ppTime': 1526672204, 'stateRootHash': '9fNC4BboZcD7in2Cjj3ZAMSbHreM9XAwUQZ1E6a24uJ4'} 2018-05-18 19:36:44.779000 | australia | australia received node message from virginia: PREPARE{'txnRootHash': 'F7wzzYTPRZ3dyWMmrpgJnMkfXc7GEng1eGvjD9RBwg8W', 'viewNo': 0, 'instId': 0, 'ppSeqNo': 2, 'digest': 'c95900a51c10cbcfa487c19d99b90bd5af5588402b8978d907da3f0fcb080afb', 'ppTime': 1526672204, 'stateRootHash': '9fNC4BboZcD7in2Cjj3ZAMSbHreM9XAwUQZ1E6a24uJ4'} 2018-05-18 19:36:44.797000 | australia | australia received node message from canada: PREPARE{'txnRootHash': 'F7wzzYTPRZ3dyWMmrpgJnMkfXc7GEng1eGvjD9RBwg8W', 'viewNo': 0, 'instId': 0, 'ppSeqNo': 2, 'digest': 'c95900a51c10cbcfa487c19d99b90bd5af5588402b8978d907da3f0fcb080afb', 'ppTime': 1526672204, 'stateRootHash': '9fNC4BboZcD7in2Cjj3ZAMSbHreM9XAwUQZ1E6a24uJ4'} 2018-05-18 19:36:44.862000 | australia | australia received node message from england: PREPARE{'txnRootHash': 'F7wzzYTPRZ3dyWMmrpgJnMkfXc7GEng1eGvjD9RBwg8W', 'viewNo': 0, 'instId': 0, 'ppSeqNo': 2, 'digest': 'c95900a51c10cbcfa487c19d99b90bd5af5588402b8978d907da3f0fcb080afb', 'ppTime': 1526672204, 'stateRootHash': '9fNC4BboZcD7in2Cjj3ZAMSbHreM9XAwUQZ1E6a24uJ4'} 2018-05-18 19:36:44.903000 | australia | australia received node message from brazil: PREPARE{'txnRootHash': 'F7wzzYTPRZ3dyWMmrpgJnMkfXc7GEng1eGvjD9RBwg8W', 'viewNo': 0, 'instId': 0, 'ppSeqNo': 2, 'digest': 'c95900a51c10cbcfa487c19d99b90bd5af5588402b8978d907da3f0fcb080afb', 'ppTime': 1526672204, 'stateRootHash': '9fNC4BboZcD7in2Cjj3ZAMSbHreM9XAwUQZ1E6a24uJ4'} {code}  What can be seen here is that _PREPREPARE_ for received request was generated and sent to all other nodes. Also 6 _PREPAREs_ were were received, which is insufficient for achieving prepare certificate and issuing _COMMIT_ (in fact 7 were required). Nodes that did not send _PREPAREs_ were _korea_ (which was down), _VeridiumIDC_, _findentity_ and _RFCU_.   All in all this means that when _korea_ was online pool had just minimum number of nodes to process requests and turning _korea_ down reduced number participating of nodes below this minimum, so it's expected that STN stopped accepting transactions.  ></body> </Action>
<Action id="45260" issue="30408" author="sergey.khoroshavin" type="comment" created="2018-05-29 17:01:58.0" updateauthor="sergey.khoroshavin" updated="2018-05-29 17:01:58.0"> <body><! CDATA Further investigation of CLI logs showed more things.  *#1* Regarding connection to TNO. This is a _bug_ in CLI. During initial pool ledger catchup there was _CATCHUP_REP_ from _england_ containing transaction where _TNO_ is indeed validator node: {code} '23': {'identifier': 'FzUUYiVKCDnSWd77NHfhpZ', 'dest': 'TZxmZoXwNk1X5o48pXqbDFz6mTJT5QkiRme9z5p86KQ', 'txnTime': 1521195244, 'type': '0', 'signatures': None, 'reqId': 1521195244613677, 'signature': '3Q3ijuEPihRyGsZFvmb414AWWQ7iMskCHoP7bC14FgPesNdPNY3pdfddEfPf5FrCg4wzdvdAFjKaBunHHwXCG4V3', 'data': {'node_port': 9701, 'node_ip': '134.221.127.143', 'client_ip': '134.221.127.143', 'services':  'VALIDATOR' , 'alias': 'TNO', 'blskey': '37d7DmcwGWM7yfnpwLGzwVy6zZwoc6cAgeeSJFBWbVh6jq5tP8dPf7s2XDxxtWafmr1JdyzycBcNztEsE8Uf9qX2jRoXzhCnjEEYJCAByEn5hWC2VQ9EqkuKzq28Vob7Piof7rEJeUPxuBZtrXL1khyTN2waQtix6CYtv9QejNPZVJ2', 'client_port': 9702}} {code} but there was another _CATCHUP_REP_ from _singapore_ containing later transaction in which _TNO_ was demoted: {code} '29': {'identifier': '6feBTywcmJUriqqnGc1zSJ', 'dest': 'TZxmZoXwNk1X5o48pXqbDFz6mTJT5QkiRme9z5p86KQ', 'txnTime': 1522073964, 'type': '0', 'signatures': None, 'reqId': 1522073964061797, 'signature': 'xzjjfKfJJJeQxZb5WhMYyHDcDG5dZCAvsYmBh6FtP9J1ckQUazaJ7AC2ksHzjARW9kkcFBS4B1M4R7y5Bc3BN5S', 'data': {'services':   , 'alias': 'TNO'}} {code} I checked two different sessions (#6 and #7 from previous comment) and in both of them there was a connection attempt, although only in #7 it was successful.  *#2* One more thing regarding losing consensus. According to _CONSISTENCY_PROOFs_ received by client: {code} 2018-05-18 19:26:25,442 | INFO     | client.py            ( 346) | handleOneNodeMsg | Client CqviWMMFNdi5nSn1UKz6LHVmV3LSw1H8WgHMaTLdZpDg got msg from node virginiaC: {'ppSeqNo': 0, 'oldMerkleRoot': 'AWJrEjCRsAvXEJryWWGcpDuKYWop5yfgAsD6PhVFNU2a', 'viewNo': 0, 'newMerkleRoot': 'EqNHLGkrjeiD9hFU7xrX1VRELW3MGYEsKYVzVvkVuuAk', 'seqNoEnd': 35, 'seqNoStart': 7, 'hashes':  '6dTvY3hdgwyf9QgrwwHda82w4io7L1XSHiS4z4aUuRvi', '6PiBHFqi1Ggzu1vqg5wFuXRnRDknqKsR85ipQvS1TTii', '9Gxsi1LUfPoS5QS5CVPqhF4qb7B2ETFDqYPwCM1Bo24p', 'Hx7wWN6N7RHFPSGcaRc2mszECpV4W9ZEUoeqhBoZxqjC', '2BU2FYa5cjSvrZZ6TzjHPLhJgXjMug7mJUwgBWwKaPoW', 'BzdDypK9W4vhhPLQCaujx2CteCjwp1dNujSeuuPGHJiB', 'GQg9SVd4oRariiESNo2jiG4NVeS9Y2TEDquByrmiKm87' , 'ledgerId': 0, 'op': 'CONSISTENCY_PROOF'}  2018-05-18 19:26:25,457 | INFO     | client.py            ( 346) | handleOneNodeMsg | Client CqviWMMFNdi5nSn1UKz6LHVmV3LSw1H8WgHMaTLdZpDg got msg from node canadaC: {'ppSeqNo': 0, 'oldMerkleRoot': 'AWJrEjCRsAvXEJryWWGcpDuKYWop5yfgAsD6PhVFNU2a', 'viewNo': 0, 'newMerkleRoot': 'EqNHLGkrjeiD9hFU7xrX1VRELW3MGYEsKYVzVvkVuuAk', 'seqNoEnd': 35, 'seqNoStart': 7, 'hashes':  '6dTvY3hdgwyf9QgrwwHda82w4io7L1XSHiS4z4aUuRvi', '6PiBHFqi1Ggzu1vqg5wFuXRnRDknqKsR85ipQvS1TTii', '9Gxsi1LUfPoS5QS5CVPqhF4qb7B2ETFDqYPwCM1Bo24p', 'Hx7wWN6N7RHFPSGcaRc2mszECpV4W9ZEUoeqhBoZxqjC', '2BU2FYa5cjSvrZZ6TzjHPLhJgXjMug7mJUwgBWwKaPoW', 'BzdDypK9W4vhhPLQCaujx2CteCjwp1dNujSeuuPGHJiB', 'GQg9SVd4oRariiESNo2jiG4NVeS9Y2TEDquByrmiKm87' , 'ledgerId': 0, 'op': 'CONSISTENCY_PROOF'}  2018-05-18 19:26:25,952 | INFO     | client.py            ( 346) | handleOneNodeMsg | Client CqviWMMFNdi5nSn1UKz6LHVmV3LSw1H8WgHMaTLdZpDg got msg from node englandC: {'ppSeqNo': 0, 'oldMerkleRoot': 'AWJrEjCRsAvXEJryWWGcpDuKYWop5yfgAsD6PhVFNU2a', 'viewNo': 0, 'newMerkleRoot': 'EqNHLGkrjeiD9hFU7xrX1VRELW3MGYEsKYVzVvkVuuAk', 'seqNoEnd': 35, 'seqNoStart': 7, 'hashes':  '6dTvY3hdgwyf9QgrwwHda82w4io7L1XSHiS4z4aUuRvi', '6PiBHFqi1Ggzu1vqg5wFuXRnRDknqKsR85ipQvS1TTii', '9Gxsi1LUfPoS5QS5CVPqhF4qb7B2ETFDqYPwCM1Bo24p', 'Hx7wWN6N7RHFPSGcaRc2mszECpV4W9ZEUoeqhBoZxqjC', '2BU2FYa5cjSvrZZ6TzjHPLhJgXjMug7mJUwgBWwKaPoW', 'BzdDypK9W4vhhPLQCaujx2CteCjwp1dNujSeuuPGHJiB', 'GQg9SVd4oRariiESNo2jiG4NVeS9Y2TEDquByrmiKm87' , 'ledgerId': 0, 'op': 'CONSISTENCY_PROOF'}  2018-05-18 19:26:26,039 | INFO     | client.py            ( 346) | handleOneNodeMsg | Client CqviWMMFNdi5nSn1UKz6LHVmV3LSw1H8WgHMaTLdZpDg got msg from node singaporeC: {'ppSeqNo': 0, 'oldMerkleRoot': 'AWJrEjCRsAvXEJryWWGcpDuKYWop5yfgAsD6PhVFNU2a', 'viewNo': 0, 'newMerkleRoot': 'EqNHLGkrjeiD9hFU7xrX1VRELW3MGYEsKYVzVvkVuuAk', 'seqNoEnd': 35, 'seqNoStart': 7, 'op': 'CONSISTENCY_PROOF', 'ledgerId': 0, 'hashes':  '6dTvY3hdgwyf9QgrwwHda82w4io7L1XSHiS4z4aUuRvi', '6PiBHFqi1Ggzu1vqg5wFuXRnRDknqKsR85ipQvS1TTii', '9Gxsi1LUfPoS5QS5CVPqhF4qb7B2ETFDqYPwCM1Bo24p', 'Hx7wWN6N7RHFPSGcaRc2mszECpV4W9ZEUoeqhBoZxqjC', '2BU2FYa5cjSvrZZ6TzjHPLhJgXjMug7mJUwgBWwKaPoW', 'BzdDypK9W4vhhPLQCaujx2CteCjwp1dNujSeuuPGHJiB', 'GQg9SVd4oRariiESNo2jiG4NVeS9Y2TEDquByrmiKm87' }  2018-05-18 19:26:26,039 | INFO     | client.py            ( 346) | handleOneNodeMsg | Client CqviWMMFNdi5nSn1UKz6LHVmV3LSw1H8WgHMaTLdZpDg got msg from node australiaC: {'ppSeqNo': 0, 'oldMerkleRoot': 'AWJrEjCRsAvXEJryWWGcpDuKYWop5yfgAsD6PhVFNU2a', 'viewNo': 0, 'newMerkleRoot': 'EqNHLGkrjeiD9hFU7xrX1VRELW3MGYEsKYVzVvkVuuAk', 'seqNoEnd': 35, 'seqNoStart': 7, 'hashes':  '6dTvY3hdgwyf9QgrwwHda82w4io7L1XSHiS4z4aUuRvi', '6PiBHFqi1Ggzu1vqg5wFuXRnRDknqKsR85ipQvS1TTii', '9Gxsi1LUfPoS5QS5CVPqhF4qb7B2ETFDqYPwCM1Bo24p', 'Hx7wWN6N7RHFPSGcaRc2mszECpV4W9ZEUoeqhBoZxqjC', '2BU2FYa5cjSvrZZ6TzjHPLhJgXjMug7mJUwgBWwKaPoW', 'BzdDypK9W4vhhPLQCaujx2CteCjwp1dNujSeuuPGHJiB', 'GQg9SVd4oRariiESNo2jiG4NVeS9Y2TEDquByrmiKm87' , 'ledgerId': 0, 'op': 'CONSISTENCY_PROOF'}  2018-05-18 19:26:26,175 | INFO     | client.py            ( 346) | handleOneNodeMsg | Client CqviWMMFNdi5nSn1UKz6LHVmV3LSw1H8WgHMaTLdZpDg got msg from node brazilC: {'ppSeqNo': 0, 'oldMerkleRoot': 'AWJrEjCRsAvXEJryWWGcpDuKYWop5yfgAsD6PhVFNU2a', 'viewNo': 0, 'newMerkleRoot': 'EqNHLGkrjeiD9hFU7xrX1VRELW3MGYEsKYVzVvkVuuAk', 'seqNoEnd': 35, 'seqNoStart': 7, 'hashes':  '6dTvY3hdgwyf9QgrwwHda82w4io7L1XSHiS4z4aUuRvi', '6PiBHFqi1Ggzu1vqg5wFuXRnRDknqKsR85ipQvS1TTii', '9Gxsi1LUfPoS5QS5CVPqhF4qb7B2ETFDqYPwCM1Bo24p', 'Hx7wWN6N7RHFPSGcaRc2mszECpV4W9ZEUoeqhBoZxqjC', '2BU2FYa5cjSvrZZ6TzjHPLhJgXjMug7mJUwgBWwKaPoW', 'BzdDypK9W4vhhPLQCaujx2CteCjwp1dNujSeuuPGHJiB', 'GQg9SVd4oRariiESNo2jiG4NVeS9Y2TEDquByrmiKm87' , 'ledgerId': 0, 'op': 'CONSISTENCY_PROOF'}  2018-05-18 19:26:32,584 | INFO     | client.py            ( 346) | handleOneNodeMsg | Client CqviWMMFNdi5nSn1UKz6LHVmV3LSw1H8WgHMaTLdZpDg got msg from node RFCUC: {'ppSeqNo': 6, 'oldMerkleRoot': 'HrTzhpj2xhPZsCoHx5FvMpa16DxvY947QAHQTaz6eXmi', 'viewNo': 1, 'newMerkleRoot': 'EqNHLGkrjeiD9hFU7xrX1VRELW3MGYEsKYVzVvkVuuAk', 'seqNoEnd': 35, 'seqNoStart': 23, 'hashes':  '3GpAThdsKFtjHBqZEdJKGEYt8KdMrbqZyZkEPTBqMsoF', 'DEMjYAfHYJcn7QSyYV9cUPJruQ71CRZZFHpcKZAuvXBH', '5WaTGgtS1coqKcbJeR7EkWAyKbzD4coCBHAQqHDTLnFd', '362orio8KomXSEm9MRJXVRB74VADABfxrEU5xQ5gvpQK', 'FHQoUKKNVh1Cyi6gLAUvZtEKcnMQBgmprq1RuKUZvfcN', 'HTAkRXkbYyiLKE1FJoi7TLefLxN8WnEkSb2Hb3YLTUrB', 'GQg9SVd4oRariiESNo2jiG4NVeS9Y2TEDquByrmiKm87' , 'ledgerId': 0, 'op': 'CONSISTENCY_PROOF'}  2018-05-18 19:26:32,827 | INFO     | client.py            ( 346) | handleOneNodeMsg | Client CqviWMMFNdi5nSn1UKz6LHVmV3LSw1H8WgHMaTLdZpDg got msg from node ibmC: {'ppSeqNo': 0, 'oldMerkleRoot': 'HrTzhpj2xhPZsCoHx5FvMpa16DxvY947QAHQTaz6eXmi', 'viewNo': 0, 'newMerkleRoot': 'EqNHLGkrjeiD9hFU7xrX1VRELW3MGYEsKYVzVvkVuuAk', 'seqNoEnd': 35, 'seqNoStart': 23, 'op': 'CONSISTENCY_PROOF', 'ledgerId': 0, 'hashes':  '3GpAThdsKFtjHBqZEdJKGEYt8KdMrbqZyZkEPTBqMsoF', 'DEMjYAfHYJcn7QSyYV9cUPJruQ71CRZZFHpcKZAuvXBH', '5WaTGgtS1coqKcbJeR7EkWAyKbzD4coCBHAQqHDTLnFd', '362orio8KomXSEm9MRJXVRB74VADABfxrEU5xQ5gvpQK', 'FHQoUKKNVh1Cyi6gLAUvZtEKcnMQBgmprq1RuKUZvfcN', 'HTAkRXkbYyiLKE1FJoi7TLefLxN8WnEkSb2Hb3YLTUrB', 'GQg9SVd4oRariiESNo2jiG4NVeS9Y2TEDquByrmiKm87' } {code} _RFCU_ had later viewNo compared to majority of nodes, and there were no responses (and no connection attempts to) _VeridiumIDC_, _findentity_. I suspect that majority of nodes controlled by Sovrin were restarted, leading to problem described in  INDY-1199|https://jira.hyperledger.org/browse/INDY-1199 .  ></body> </Action>
<Action id="45261" issue="30408" author="sergey.khoroshavin" type="comment" created="2018-05-29 17:06:28.0" updateauthor="sergey.khoroshavin" updated="2018-05-29 17:06:28.0"> <body><! CDATA *Summary* 1. STN lost consensus after shutting down just one node because it had minimum required amount of participating nodes. 2. Some nodes were not participating because Sovrin nodes were restarted, and others not, leading to already known problem  INDY-1199|https://jira.hyperledger.org/browse/INDY-1199  3. Attempt to connect to TNO and other demoted nodes is bug in CLI and will be addressed in separate issue. 4. It is still unknown why transaction logged in CLI didn't get to pool at all, and what was origin of another transaction that did get to pool roughly at same time  ></body> </Action>
<Action id="45264" issue="30408" author="mgbailey" type="comment" body="Thanks for the analysis,  ~sergey.khoroshavin . The key info here is that we now know that 3 of the external steward nodes were not functioning properly, so we can look at those in more depth to see why. I am looking forward to upcoming logging enhancements where information like this will be easy to find." created="2018-05-29 17:33:58.0" updateauthor="mgbailey" updated="2018-05-29 17:33:58.0"/>
<Action id="45279" issue="30408" author="sergey.khoroshavin" type="comment" created="2018-05-30 09:14:25.0" updateauthor="sergey.khoroshavin" updated="2018-05-30 09:14:25.0"> <body><! CDATA  ~mgbailey  I looked a bit more at CLI logs, and I can see that in previous session (#6) more nodes reported their status: {code} 2018-05-18 15:16:11,459 | INFO     | client.py            ( 346) | handleOneNodeMsg | Client GEDD6TWU5n5BVgGt6R2vqZvjMhBs3uXwmWvjyVWGuBou got msg from node canadaC: {'ledgerId': 0, 'seqNoStart': 7, 'oldMerkleRoot': 'AWJrEjCRsAvXEJryWWGcpDuKYWop5yfgAsD6PhVFNU2a', 'op': 'CONSISTENCY_PROOF', 'hashes':  '6dTvY3hdgwyf9QgrwwHda82w4io7L1XSHiS4z4aUuRvi', '6PiBHFqi1Ggzu1vqg5wFuXRnRDknqKsR85ipQvS1TTii', '9Gxsi1LUfPoS5QS5CVPqhF4qb7B2ETFDqYPwCM1Bo24p', 'Hx7wWN6N7RHFPSGcaRc2mszECpV4W9ZEUoeqhBoZxqjC', '2BU2FYa5cjSvrZZ6TzjHPLhJgXjMug7mJUwgBWwKaPoW', 'BzdDypK9W4vhhPLQCaujx2CteCjwp1dNujSeuuPGHJiB', 'GQg9SVd4oRariiESNo2jiG4NVeS9Y2TEDquByrmiKm87' , 'seqNoEnd': 35, 'ppSeqNo': 0, 'newMerkleRoot': 'EqNHLGkrjeiD9hFU7xrX1VRELW3MGYEsKYVzVvkVuuAk', 'viewNo': 0} 2018-05-18 15:16:11,486 | INFO     | client.py            ( 346) | handleOneNodeMsg | Client GEDD6TWU5n5BVgGt6R2vqZvjMhBs3uXwmWvjyVWGuBou got msg from node virginiaC: {'ledgerId': 0, 'seqNoStart': 7, 'oldMerkleRoot': 'AWJrEjCRsAvXEJryWWGcpDuKYWop5yfgAsD6PhVFNU2a', 'op': 'CONSISTENCY_PROOF', 'hashes':  '6dTvY3hdgwyf9QgrwwHda82w4io7L1XSHiS4z4aUuRvi', '6PiBHFqi1Ggzu1vqg5wFuXRnRDknqKsR85ipQvS1TTii', '9Gxsi1LUfPoS5QS5CVPqhF4qb7B2ETFDqYPwCM1Bo24p', 'Hx7wWN6N7RHFPSGcaRc2mszECpV4W9ZEUoeqhBoZxqjC', '2BU2FYa5cjSvrZZ6TzjHPLhJgXjMug7mJUwgBWwKaPoW', 'BzdDypK9W4vhhPLQCaujx2CteCjwp1dNujSeuuPGHJiB', 'GQg9SVd4oRariiESNo2jiG4NVeS9Y2TEDquByrmiKm87' , 'seqNoEnd': 35, 'newMerkleRoot': 'EqNHLGkrjeiD9hFU7xrX1VRELW3MGYEsKYVzVvkVuuAk', 'viewNo': 0, 'ppSeqNo': 0} 2018-05-18 15:16:11,824 | INFO     | client.py            ( 346) | handleOneNodeMsg | Client GEDD6TWU5n5BVgGt6R2vqZvjMhBs3uXwmWvjyVWGuBou got msg from node koreaC: {'ledgerId': 0, 'seqNoStart': 7, 'oldMerkleRoot': 'AWJrEjCRsAvXEJryWWGcpDuKYWop5yfgAsD6PhVFNU2a', 'ppSeqNo': 0, 'hashes':  '6dTvY3hdgwyf9QgrwwHda82w4io7L1XSHiS4z4aUuRvi', '6PiBHFqi1Ggzu1vqg5wFuXRnRDknqKsR85ipQvS1TTii', '9Gxsi1LUfPoS5QS5CVPqhF4qb7B2ETFDqYPwCM1Bo24p', 'Hx7wWN6N7RHFPSGcaRc2mszECpV4W9ZEUoeqhBoZxqjC', '2BU2FYa5cjSvrZZ6TzjHPLhJgXjMug7mJUwgBWwKaPoW', 'BzdDypK9W4vhhPLQCaujx2CteCjwp1dNujSeuuPGHJiB', 'GQg9SVd4oRariiESNo2jiG4NVeS9Y2TEDquByrmiKm87' , 'seqNoEnd': 35, 'newMerkleRoot': 'EqNHLGkrjeiD9hFU7xrX1VRELW3MGYEsKYVzVvkVuuAk', 'viewNo': 0, 'op': 'CONSISTENCY_PROOF'} 2018-05-18 15:16:11,982 | INFO     | client.py            ( 346) | handleOneNodeMsg | Client GEDD6TWU5n5BVgGt6R2vqZvjMhBs3uXwmWvjyVWGuBou got msg from node englandC: {'ledgerId': 0, 'seqNoStart': 7, 'oldMerkleRoot': 'AWJrEjCRsAvXEJryWWGcpDuKYWop5yfgAsD6PhVFNU2a', 'op': 'CONSISTENCY_PROOF', 'hashes':  '6dTvY3hdgwyf9QgrwwHda82w4io7L1XSHiS4z4aUuRvi', '6PiBHFqi1Ggzu1vqg5wFuXRnRDknqKsR85ipQvS1TTii', '9Gxsi1LUfPoS5QS5CVPqhF4qb7B2ETFDqYPwCM1Bo24p', 'Hx7wWN6N7RHFPSGcaRc2mszECpV4W9ZEUoeqhBoZxqjC', '2BU2FYa5cjSvrZZ6TzjHPLhJgXjMug7mJUwgBWwKaPoW', 'BzdDypK9W4vhhPLQCaujx2CteCjwp1dNujSeuuPGHJiB', 'GQg9SVd4oRariiESNo2jiG4NVeS9Y2TEDquByrmiKm87' , 'seqNoEnd': 35, 'ppSeqNo': 0, 'newMerkleRoot': 'EqNHLGkrjeiD9hFU7xrX1VRELW3MGYEsKYVzVvkVuuAk', 'viewNo': 0} 2018-05-18 15:16:12,489 | INFO     | client.py            ( 346) | handleOneNodeMsg | Client GEDD6TWU5n5BVgGt6R2vqZvjMhBs3uXwmWvjyVWGuBou got msg from node brazilC: {'ledgerId': 0, 'seqNoStart': 7, 'oldMerkleRoot': 'AWJrEjCRsAvXEJryWWGcpDuKYWop5yfgAsD6PhVFNU2a', 'op': 'CONSISTENCY_PROOF', 'hashes':  '6dTvY3hdgwyf9QgrwwHda82w4io7L1XSHiS4z4aUuRvi', '6PiBHFqi1Ggzu1vqg5wFuXRnRDknqKsR85ipQvS1TTii', '9Gxsi1LUfPoS5QS5CVPqhF4qb7B2ETFDqYPwCM1Bo24p', 'Hx7wWN6N7RHFPSGcaRc2mszECpV4W9ZEUoeqhBoZxqjC', '2BU2FYa5cjSvrZZ6TzjHPLhJgXjMug7mJUwgBWwKaPoW', 'BzdDypK9W4vhhPLQCaujx2CteCjwp1dNujSeuuPGHJiB', 'GQg9SVd4oRariiESNo2jiG4NVeS9Y2TEDquByrmiKm87' , 'seqNoEnd': 35, 'newMerkleRoot': 'EqNHLGkrjeiD9hFU7xrX1VRELW3MGYEsKYVzVvkVuuAk', 'viewNo': 0, 'ppSeqNo': 0} 2018-05-18 15:16:12,490 | INFO     | client.py            ( 346) | handleOneNodeMsg | Client GEDD6TWU5n5BVgGt6R2vqZvjMhBs3uXwmWvjyVWGuBou got msg from node singaporeC: {'ledgerId': 0, 'seqNoStart': 7, 'oldMerkleRoot': 'AWJrEjCRsAvXEJryWWGcpDuKYWop5yfgAsD6PhVFNU2a', 'ppSeqNo': 0, 'hashes':  '6dTvY3hdgwyf9QgrwwHda82w4io7L1XSHiS4z4aUuRvi', '6PiBHFqi1Ggzu1vqg5wFuXRnRDknqKsR85ipQvS1TTii', '9Gxsi1LUfPoS5QS5CVPqhF4qb7B2ETFDqYPwCM1Bo24p', 'Hx7wWN6N7RHFPSGcaRc2mszECpV4W9ZEUoeqhBoZxqjC', '2BU2FYa5cjSvrZZ6TzjHPLhJgXjMug7mJUwgBWwKaPoW', 'BzdDypK9W4vhhPLQCaujx2CteCjwp1dNujSeuuPGHJiB', 'GQg9SVd4oRariiESNo2jiG4NVeS9Y2TEDquByrmiKm87' , 'seqNoEnd': 35, 'newMerkleRoot': 'EqNHLGkrjeiD9hFU7xrX1VRELW3MGYEsKYVzVvkVuuAk', 'viewNo': 0, 'op': 'CONSISTENCY_PROOF'} 2018-05-18 15:16:12,490 | INFO     | client.py            ( 346) | handleOneNodeMsg | Client GEDD6TWU5n5BVgGt6R2vqZvjMhBs3uXwmWvjyVWGuBou got msg from node australiaC: {'ledgerId': 0, 'seqNoStart': 7, 'oldMerkleRoot': 'AWJrEjCRsAvXEJryWWGcpDuKYWop5yfgAsD6PhVFNU2a', 'op': 'CONSISTENCY_PROOF', 'hashes':  '6dTvY3hdgwyf9QgrwwHda82w4io7L1XSHiS4z4aUuRvi', '6PiBHFqi1Ggzu1vqg5wFuXRnRDknqKsR85ipQvS1TTii', '9Gxsi1LUfPoS5QS5CVPqhF4qb7B2ETFDqYPwCM1Bo24p', 'Hx7wWN6N7RHFPSGcaRc2mszECpV4W9ZEUoeqhBoZxqjC', '2BU2FYa5cjSvrZZ6TzjHPLhJgXjMug7mJUwgBWwKaPoW', 'BzdDypK9W4vhhPLQCaujx2CteCjwp1dNujSeuuPGHJiB', 'GQg9SVd4oRariiESNo2jiG4NVeS9Y2TEDquByrmiKm87' , 'seqNoEnd': 35, 'ppSeqNo': 0, 'newMerkleRoot': 'EqNHLGkrjeiD9hFU7xrX1VRELW3MGYEsKYVzVvkVuuAk', 'viewNo': 0} 2018-05-18 15:16:18,567 | INFO     | client.py            ( 346) | handleOneNodeMsg | Client GEDD6TWU5n5BVgGt6R2vqZvjMhBs3uXwmWvjyVWGuBou got msg from node ibmC: {'ledgerId': 0, 'ppSeqNo': None, 'op': 'LEDGER_STATUS', 'txnSeqNo': 35, 'viewNo': None, 'merkleRoot': 'EqNHLGkrjeiD9hFU7xrX1VRELW3MGYEsKYVzVvkVuuAk'} 2018-05-18 15:16:18,778 | INFO     | client.py            ( 346) | handleOneNodeMsg | Client GEDD6TWU5n5BVgGt6R2vqZvjMhBs3uXwmWvjyVWGuBou got msg from node RFCUC: {'ledgerId': 0, 'ppSeqNo': 6, 'op': 'LEDGER_STATUS', 'txnSeqNo': 35, 'merkleRoot': 'EqNHLGkrjeiD9hFU7xrX1VRELW3MGYEsKYVzVvkVuuAk', 'viewNo': 1} 2018-05-18 15:16:19,509 | INFO     | client.py            ( 346) | handleOneNodeMsg | Client GEDD6TWU5n5BVgGt6R2vqZvjMhBs3uXwmWvjyVWGuBou got msg from node VeridiumIDCC: {'ledgerId': 0, 'ppSeqNo': 6, 'op': 'LEDGER_STATUS', 'txnSeqNo': 35, 'merkleRoot': 'EqNHLGkrjeiD9hFU7xrX1VRELW3MGYEsKYVzVvkVuuAk', 'viewNo': 1} {code} As you can see the majority of pool is at viewNo 0, but _RFCU_ and _VeridiumIDC_ are at viewNo 1. Most likely this happened due to restart of Sovrin nodes, and I believe these two nodes can be brought back to consensus by restarting them as well.  All in all, I think this is a known problem  INDY-1199|https://jira.hyperledger.org/browse/INDY-1199 , and until it is solved general recommendation is that _nodes should be restarted either one by one or all at once, otherwise some nodes can stop participating because of inability to downgrade their viewNo, and if this still happened it should be solved by restarting nodes with higher viewNo_.  Also, to diagnose this kind of problem you can look at _CONSISTENCY_PROOF_ and _LEDGER_STATUS_ messages received by client during connection as they contain info about current viewNo on nodes. It should be same everywhere, but if logs show that on some minority of nodes it's higher than on others then these nodes should be restarted. To make this easier following command can be used: {code} egrep "CONSISTENCY_PROOF|LEDGER_STATUS" cli.log | grep viewNo {code}  ></body> </Action>
<Action id="45599" issue="30408" author="esplinr" type="comment" created="2018-06-06 14:55:52.0" updateauthor="esplinr" updated="2018-06-06 14:55:52.0"> <body><! CDATA  ~sergey.khoroshavin  Please also create an issue in the Indy SDK project for:  {quote} 3. Attempt to connect to TNO and other demoted nodes is bug in CLI and will be addressed in separate issue. {quote}  And link it to this issue. Thank you.  ></body> </Action>
