<Action id="25886" issue="17473" author="alexander.shekhovcov" type="comment" created="2017-06-09 17:34:03.0" updateauthor="alexander.shekhovcov" updated="2017-06-09 17:34:50.0"> <body><! CDATA Ubuntu 16.04 VM   *Steps:* # create LVM disk  https://wiki.ubuntu.com/Lvm  # set flakey mode for the lvm disk  {code:java} sudo dmsetup load /dev/mapper/g1-d1 --table '0 2097152 flakey 8:5 2048 1 1'{code} 3. try to remount the disk and restart the node until the flakey behavioral has appeared  {code:java} sudo umount /dev/mapper/g1-d1 &&  sudo mount /dev/mapper/g1-d1 /home/sovrin/.sovrin/data/nodes/Node1/transactions_sandbox/ && sudo systemctl restart sovrin-node{code}    *Result:*  The node failed the startup procedure with exception: {code:java} июн 09 20:25:13 sovrin-node1 start_sovrin_node 4285 : Traceback (most recent call last): июн 09 20:25:13 sovrin-node1 start_sovrin_node 4285 : File "/usr/local/bin/start_sovrin_node", line 47, in <module> июн 09 20:25:13 sovrin-node1 start_sovrin_node 4285 : cliha=cliha) июн 09 20:25:13 sovrin-node1 start_sovrin_node 4285 : File "/usr/local/lib/python3.5/dist-packages/sovrin_node/server/node.py", line 81, in __init__ июн 09 20:25:13 sovrin-node1 start_sovrin_node 4285 : config=self.config) июн 09 20:25:13 sovrin-node1 start_sovrin_node 4285 : File "/usr/local/lib/python3.5/dist-packages/plenum/server/node.py", line 149, in __init__ июн 09 20:25:13 sovrin-node1 start_sovrin_node 4285 : self.primaryStorage = storage or self.getPrimaryStorage() июн 09 20:25:13 sovrin-node1 start_sovrin_node 4285 : File "/usr/local/lib/python3.5/dist-packages/sovrin_node/server/node.py", line 123, in getPrimaryStorage июн 09 20:25:13 sovrin-node1 start_sovrin_node 4285 : defaultFile=defaultTxnFile) июн 09 20:25:13 sovrin-node1 start_sovrin_node 4285 : File "/usr/local/lib/python3.5/dist-packages/plenum/common/ledger.py", line 26, in __init__ июн 09 20:25:13 sovrin-node1 start_sovrin_node 4285 : super().__init__(*args, **kwargs) июн 09 20:25:13 sovrin-node1 start_sovrin_node 4285 : File "/usr/local/lib/python3.5/dist-packages/ledger/ledger.py", line 61, in __init__ июн 09 20:25:13 sovrin-node1 start_sovrin_node 4285 : self.start() июн 09 20:25:13 sovrin-node1 start_sovrin_node 4285 : File "/usr/local/lib/python3.5/dist-packages/ledger/ledger.py", line 210, in start июн 09 20:25:13 sovrin-node1 start_sovrin_node 4285 : self.defaultFile) июн 09 20:25:13 sovrin-node1 start_sovrin_node 4285 : File "/usr/local/lib/python3.5/dist-packages/plenum/common/ledger.py", line 23, in _defaultStore июн 09 20:25:13 sovrin-node1 start_sovrin_node 4285 : defaultFile=defaultFile) июн 09 20:25:13 sovrin-node1 start_sovrin_node 4285 : File "/usr/local/lib/python3.5/dist-packages/ledger/stores/chunked_file_store.py", line 73, in __init__ июн 09 20:25:13 sovrin-node1 start_sovrin_node 4285 : self._initDB(dbDir, dbName) июн 09 20:25:13 sovrin-node1 start_sovrin_node 4285 : File "/usr/local/lib/python3.5/dist-packages/ledger/stores/chunked_file_store.py", line 95, in _initDB июн 09 20:25:13 sovrin-node1 start_sovrin_node 4285 : self._useLatestChunk() июн 09 20:25:13 sovrin-node1 start_sovrin_node 4285 : File "/usr/local/lib/python3.5/dist-packages/ledger/stores/chunked_file_store.py", line 101, in _useLatestChunk июн 09 20:25:13 sovrin-node1 start_sovrin_node 4285 : self._useChunk(self._findLatestChunk()) июн 09 20:25:13 sovrin-node1 start_sovrin_node 4285 : File "/usr/local/lib/python3.5/dist-packages/ledger/stores/chunked_file_store.py", line 137, in _useChunk июн 09 20:25:13 sovrin-node1 start_sovrin_node 4285 : self.itemNum = self.currentChunk.numKeys + 1 июн 09 20:25:13 sovrin-node1 start_sovrin_node 4285 : File "/usr/local/lib/python3.5/dist-packages/ledger/stores/file_store.py", line 191, in numKeys июн 09 20:25:13 sovrin-node1 start_sovrin_node 4285 : return sum(1 for l in self.iterator()) июн 09 20:25:13 sovrin-node1 start_sovrin_node 4285 : File "/usr/local/lib/python3.5/dist-packages/ledger/stores/file_store.py", line 155, in iterator июн 09 20:25:13 sovrin-node1 start_sovrin_node 4285 : lines = self._getLines() июн 09 20:25:13 sovrin-node1 start_sovrin_node 4285 : File "/usr/local/lib/python3.5/dist-packages/ledger/stores/text_file_store.py", line 31, in _getLines июн 09 20:25:13 sovrin-node1 start_sovrin_node 4285 : return list(store_utils.cleanLines(self.dbFile)) июн 09 20:25:13 sovrin-node1 start_sovrin_node 4285 : File "/usr/local/lib/python3.5/dist-packages/ledger/stores/store_utils.py", line 11, in <genexpr> июн 09 20:25:13 sovrin-node1 start_sovrin_node 4285 : return (line for line in stripped if len(line) != 0) июн 09 20:25:13 sovrin-node1 start_sovrin_node 4285 : File "/usr/local/lib/python3.5/dist-packages/ledger/stores/store_utils.py", line 10, in <genexpr> июн 09 20:25:13 sovrin-node1 start_sovrin_node 4285 : stripped = (line.strip(lineSep) for line in source) июн 09 20:25:13 sovrin-node1 start_sovrin_node 4285 : OSError:  Errno 5  Input/output error {code}          ></body> </Action>
<Action id="26487" issue="17473" author="danielhardman" type="comment" created="2017-06-15 22:56:40.0" updateauthor="danielhardman" updated="2017-06-15 22:56:40.0"> <body><! CDATA  ~alexander.shekhovcov : This is a great discovery. Please create a new ticket that says "fix the ledger so a corrupt database record doesn't prevent the service from starting". Then you can move this ticket to Customer Validation and I will clear it out.  success criteria for the new ticket: either the service runs with a corrupted record (simply failing to retrieve that record with a graceful error) --or, if the database is too damaged to use, the service exits with a graceful error and says something like this to the log and the screen: "The database is corrupt. To fix the problem, delete the database and rebuild."  ></body> </Action>
<Action id="26517" issue="17473" author="alexander.shekhovcov" type="comment" body="The new ticket https://jira.hyperledger.org/browse/INDY-243" created="2017-06-16 12:48:20.0" updateauthor="alexander.shekhovcov" updated="2017-06-16 12:48:20.0"/>
