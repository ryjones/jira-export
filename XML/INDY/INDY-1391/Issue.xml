<Issue id="30925" key="INDY-1391" number="1391" project="10303" reporter="ozheregelya" assignee="vladimirwork" creator="ozheregelya" type="10004" summary="3PC batch which initiated processing of missed batches was not written on promoted node" priority="2" resolution="10000" status="10001" created="2018-06-06 18:17:36.0" updated="2019-03-29 20:34:06.0" resolutiondate="2019-03-29 20:34:06.0" votes="0" watches="2" workflowId="30933"> <environment><! CDATA indy-node 1.3.443 docker pool 4 + 1 nodes  ></environment> <description><! CDATA *Steps to Reproduce:* 1. Setup the pool of 4 nodes. 2. Add one more node: 2.1. Copy genesis files from active nodes to additional one. 2.2. Run `sudo su - indy -c "init_indy_node Node5 10.0.0.6 9701 10.0.0.6 9702 000000000000000000000000000node5"`. 2.3. Start and enable indy-node. 2.4. Send node txn using indy-cli: `ledger node target=4Tn3wZMNCvhSTXPcLinQDnHyj56DTLQtL61ki4jo2Loc client_port=9702 client_ip=10.0.0.6 alias=Node5 node_ip=10.0.0.6 node_port=9701 services=VALIDATOR blskey=2RdajPq6rCidK5gQbMzSJo1NfBMYiS3e44GxjTqZUk3RhBdtF28qEABHRo4MgHS2hwekoLWRTza9XiGEMRCompeujWpX85MPt87WdbTMysXZfb7J1ZXUEMrtE5aZahfx6p2YdhZdrArFvTmFWdojaD2V5SuvuaQL4G92anZ1yteay3R` => Node was successfully added and it processed all missed batches. Domain ledger size on all nodes is 11 txns (9 genesis + 2 nyms). 3. Make sure that node works by adding new txns. => Domain ledger size on all nodes is 13 txns. 4. Demote added node: `ledger node target=4Tn3wZMNCvhSTXPcLinQDnHyj56DTLQtL61ki4jo2Loc client_port=9702 client_ip=10.0.0.6 alias=Node5 node_ip=10.0.0.6 node_port=9701 services=` 5. Add several txns. => Domain ledger size on demoted node is 13 txns, for the rest ones domain ledger size is 16. 6. Promote demoted node: `ledger node target=4Tn3wZMNCvhSTXPcLinQDnHyj56DTLQtL61ki4jo2Loc client_port=9702 client_ip=10.0.0.6 alias=Node5 node_ip=10.0.0.6 node_port=9701 services=VALIDATOR` => Domain ledger sizes are not changed. 7. Send one txn.  *Actual Results:* Domain ledger size on node which was demoted is 16 txns, for the rest ones domain ledger size is 17. Domain ledger size on node which was demoted is not changing after writting more txns.  *Expected Results:* 17th txn should be also written after processing of missed batches.  ></description> </Issue>
