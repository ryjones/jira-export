<Action id="53584" issue="35125" author="ashcherbakov" type="comment" created="2018-11-19 09:41:40.0" updateauthor="ashcherbakov" updated="2018-11-19 14:47:20.0"> <body><! CDATA *PoA:* * Start indy-cli * get all nodes in the STN using pool ledger from https://jira.hyperledger.org/browse/INDY-1842 * send 10 GET_SCHEMA and 10 GET_CRED_DEF reqs to each node 1 by 1 * Calculate the average time of response for every node * check if we got fast reply from all the nodes * if not, then some nodes in STN are unavailable, and we need to investigate why  ></body> </Action>
<Action id="53591" issue="35125" author="vladimirwork" type="comment" created="2018-11-19 13:36:24.0" updateauthor="vladimirwork" updated="2018-11-19 13:36:24.0"> <body><! CDATA Build Info: STN pool libindy \ indy-cli 1.6.7~850 master  Steps to Reproduce: 1. Run GET_NYM txn using CLI against the pool connected with one pre-ordered node for each node of the pool (13). 2. Run GET_SCHEMA txn using CLI against the pool connected with one pre-ordered node for each node of the pool (13).  Actual Results: There is less than 1 second response time for GET_NYM txn (for nonexistent in the ledger NYM). There is from ~1 to ~5 seconds response time for GET_SCHEMA txn (for existing in the ledger SCHEMAs with seqNo 9726 and 9738).  ></body> </Action>
<Action id="53595" issue="35125" author="vladimirwork" type="comment" body="If we also want to check GET_CRED_DEF txns we should know their tags and origins (maker&apos;s DIDs)." created="2018-11-19 14:16:26.0" updateauthor="vladimirwork" updated="2018-11-19 14:16:26.0"/>
<Action id="53631" issue="35125" author="vladimirwork" type="comment" created="2018-11-20 11:27:22.0" updateauthor="vladimirwork" updated="2018-11-20 15:58:09.0"> <body><! CDATA Build Info: STN pool libindy \ indy-cli 1.6.7~850 master  Steps to Reproduce: 1. Run schema and cred_def getting test for each node as pre-ordered multiple times to check timing for get requests. 2. Run schema and cred_def getting test for any single node as pre-ordered with client debug logging to check action sequence and timing for each action. 3. Run schema and cred_def getting test for random five nodes except 'dativa_validator' (unreachable) to check timing for get requests.  Autotest to Reproduce: https://github.com/VladimirWork/tests/blob/3b6bdeb984275c0d36abbd8e80ec5176a07ff853/test_misc.py#L90-L115  Actual Results: 1. We have unexpected big response time even if we send request to reachable preoredered node and we have additional 20 seconds (default timeout) if there was unreachable one in the next 4 entries of pre-ordered list tail: {noformat} ITERATION:  0 NODE:  NodeTwinPeek SCHEMA BUILD TIME:  0.0007428050157614052 SCHEMA SUBMIT TIME:  6.747999059967697 ITERATION:  0 NODE:  NodeTwinPeek CRED DEF BUILD TIME:  0.005250868038274348 CRED DEF SUBMIT TIME:  7.223027279949747 ITERATION:  0 NODE:  RFCU SCHEMA BUILD TIME:  0.0005116660031490028 SCHEMA SUBMIT TIME:  6.563439471006859 ITERATION:  0 NODE:  RFCU CRED DEF BUILD TIME:  0.0004822569899260998 CRED DEF SUBMIT TIME:  26.230110621021595 ITERATION:  0 NODE:  australia SCHEMA BUILD TIME:  0.00046328100143000484 SCHEMA SUBMIT TIME:  27.83221844898071 ITERATION:  0 NODE:  australia CRED DEF BUILD TIME:  0.00045420601963996887 CRED DEF SUBMIT TIME:  10.201110676978715 ITERATION:  0 NODE:  brazil SCHEMA BUILD TIME:  0.0021047089830972254 SCHEMA SUBMIT TIME:  3.969035710033495 ITERATION:  0 NODE:  brazil CRED DEF BUILD TIME:  0.004435696988366544 CRED DEF SUBMIT TIME:  1.1642644249950536 ITERATION:  0 NODE:  canada SCHEMA BUILD TIME:  0.0006781350239180028 SCHEMA SUBMIT TIME:  8.935560951998923 ITERATION:  0 NODE:  canada CRED DEF BUILD TIME:  0.0006650919676758349 CRED DEF SUBMIT TIME:  24.076956228993367 ITERATION:  0 NODE:  england SCHEMA BUILD TIME:  0.00040230300510302186 SCHEMA SUBMIT TIME:  5.816180295951199 ITERATION:  0 NODE:  england CRED DEF BUILD TIME:  0.0003891229862347245 CRED DEF SUBMIT TIME:  26.58307822298957 ITERATION:  0 NODE:  ibmTest SCHEMA BUILD TIME:  0.00041242700535804033 SCHEMA SUBMIT TIME:  5.056306323967874 ITERATION:  0 NODE:  ibmTest CRED DEF BUILD TIME:  0.0005199289880692959 CRED DEF SUBMIT TIME:  27.814586043998133 ITERATION:  0 NODE:  korea SCHEMA BUILD TIME:  0.0005641109892167151 SCHEMA SUBMIT TIME:  6.0966269439668395 ITERATION:  0 NODE:  korea CRED DEF BUILD TIME:  0.0004341330495662987 CRED DEF SUBMIT TIME:  26.55214010697091 ITERATION:  0 NODE:  lab10 SCHEMA BUILD TIME:  0.0005217199795879424 SCHEMA SUBMIT TIME:  4.680699171032757 ITERATION:  0 NODE:  lab10 CRED DEF BUILD TIME:  0.0005471630138345063 CRED DEF SUBMIT TIME:  1.5173250649822876 ITERATION:  0 NODE:  singapore SCHEMA BUILD TIME:  0.00035651400685310364 SCHEMA SUBMIT TIME:  4.467870036023669 ITERATION:  0 NODE:  singapore CRED DEF BUILD TIME:  0.0004103579558432102 CRED DEF SUBMIT TIME:  1.3965592519962229 ITERATION:  0 NODE:  virginia SCHEMA BUILD TIME:  0.0014563830336555839 SCHEMA SUBMIT TIME:  26.497049494995736 ITERATION:  0 NODE:  virginia CRED DEF BUILD TIME:  0.0003750630421563983 CRED DEF SUBMIT TIME:  6.159671655972488 ITERATION:  0 NODE:  vnode1 SCHEMA BUILD TIME:  0.0003925340133719146 SCHEMA SUBMIT TIME:  28.38528107397724 ITERATION:  0 NODE:  vnode1 CRED DEF BUILD TIME:  0.002173338958527893 CRED DEF SUBMIT TIME:  25.24589255900355 ITERATION:  0 NODE:  xsvalidatorec2irl SCHEMA BUILD TIME:  0.0005049919709563255 SCHEMA SUBMIT TIME:  24.317779342003632 ITERATION:  0 NODE:  xsvalidatorec2irl CRED DEF BUILD TIME:  0.00040826998883858323 CRED DEF SUBMIT TIME:  25.69578657101374 ITERATION:  1 NODE:  NodeTwinPeek SCHEMA BUILD TIME:  0.0006035700207576156 SCHEMA SUBMIT TIME:  26.326870853023138 ITERATION:  1 NODE:  NodeTwinPeek CRED DEF BUILD TIME:  0.0004900849889963865 CRED DEF SUBMIT TIME:  8.417115608986933 ITERATION:  1 NODE:  RFCU SCHEMA BUILD TIME:  0.0003499230369925499 SCHEMA SUBMIT TIME:  5.841705403989181 ITERATION:  1 NODE:  RFCU CRED DEF BUILD TIME:  0.0003617530455812812 CRED DEF SUBMIT TIME:  26.091539084969554 ITERATION:  1 NODE:  australia SCHEMA BUILD TIME:  0.00042970303911715746 SCHEMA SUBMIT TIME:  26.30412693496328 ITERATION:  1 NODE:  australia CRED DEF BUILD TIME:  0.0003939750022254884 CRED DEF SUBMIT TIME:  28.584586251992732 ITERATION:  1 NODE:  brazil SCHEMA BUILD TIME:  0.00037106999661773443 SCHEMA SUBMIT TIME:  6.658427752030548 ITERATION:  1 NODE:  brazil CRED DEF BUILD TIME:  0.000631252012681216 CRED DEF SUBMIT TIME:  6.67594048299361 ITERATION:  1 NODE:  canada SCHEMA BUILD TIME:  0.0006730200257152319 SCHEMA SUBMIT TIME:  26.454359997005668 ITERATION:  1 NODE:  canada CRED DEF BUILD TIME:  0.000525923038367182 CRED DEF SUBMIT TIME:  27.552015827968717 ITERATION:  1 NODE:  england SCHEMA BUILD TIME:  0.0009118529851548374 SCHEMA SUBMIT TIME:  30.226472131034825 ITERATION:  1 NODE:  england CRED DEF BUILD TIME:  0.0005074020009487867 CRED DEF SUBMIT TIME:  25.69875141500961 ITERATION:  1 NODE:  ibmTest SCHEMA BUILD TIME:  0.00042560294969007373 SCHEMA SUBMIT TIME:  6.649003875034396 ITERATION:  1 NODE:  ibmTest CRED DEF BUILD TIME:  0.00038876099279150367 CRED DEF SUBMIT TIME:  8.237650988041423 ITERATION:  1 NODE:  korea SCHEMA BUILD TIME:  0.00039756897604092956 SCHEMA SUBMIT TIME:  8.15620059001958 ITERATION:  1 NODE:  korea CRED DEF BUILD TIME:  0.00034331600181758404 CRED DEF SUBMIT TIME:  7.019242018985096 ITERATION:  1 NODE:  lab10 SCHEMA BUILD TIME:  0.00036118796560913324 SCHEMA SUBMIT TIME:  5.59081495803548 ITERATION:  1 NODE:  lab10 CRED DEF BUILD TIME:  0.0003800999838858843 CRED DEF SUBMIT TIME:  6.191560307983309 ITERATION:  1 NODE:  singapore SCHEMA BUILD TIME:  0.0015356229851022363 SCHEMA SUBMIT TIME:  5.790958840050735 ITERATION:  1 NODE:  singapore CRED DEF BUILD TIME:  0.0004955320036970079 CRED DEF SUBMIT TIME:  8.70689561899053 ITERATION:  1 NODE:  virginia SCHEMA BUILD TIME:  0.0005372230079956353 SCHEMA SUBMIT TIME:  24.28011533000972 ITERATION:  1 NODE:  virginia CRED DEF BUILD TIME:  0.00045196397695690393 CRED DEF SUBMIT TIME:  5.5334381670109 ITERATION:  1 NODE:  vnode1 SCHEMA BUILD TIME:  0.000547519011888653 SCHEMA SUBMIT TIME:  27.127038303995505 ITERATION:  1 NODE:  vnode1 CRED DEF BUILD TIME:  0.0003628379781730473 CRED DEF SUBMIT TIME:  24.95290285698138 ITERATION:  1 NODE:  xsvalidatorec2irl SCHEMA BUILD TIME:  0.000395810988266021 SCHEMA SUBMIT TIME:  6.546137069992255 ITERATION:  1 NODE:  xsvalidatorec2irl CRED DEF BUILD TIME:  0.0004190409672446549 CRED DEF SUBMIT TIME:  6.459483966056723 ITERATION:  2 NODE:  NodeTwinPeek SCHEMA BUILD TIME:  0.00038561999099329114 SCHEMA SUBMIT TIME:  5.363953482010402 ITERATION:  2 NODE:  NodeTwinPeek CRED DEF BUILD TIME:  0.0004304379690438509 CRED DEF SUBMIT TIME:  28.477671108033974 ITERATION:  2 NODE:  RFCU SCHEMA BUILD TIME:  0.00040399900171905756 SCHEMA SUBMIT TIME:  26.042088654008694 ITERATION:  2 NODE:  RFCU CRED DEF BUILD TIME:  0.0003950360114686191 CRED DEF SUBMIT TIME:  7.361472717020661 ITERATION:  2 NODE:  australia SCHEMA BUILD TIME:  0.00035825197119265795 SCHEMA SUBMIT TIME:  25.825570926012006 ITERATION:  2 NODE:  australia CRED DEF BUILD TIME:  0.00037559698102995753 CRED DEF SUBMIT TIME:  10.436239817005116 ITERATION:  2 NODE:  brazil SCHEMA BUILD TIME:  0.0003781939740292728 SCHEMA SUBMIT TIME:  23.99490367702674 ITERATION:  2 NODE:  brazil CRED DEF BUILD TIME:  0.0004229489713907242 CRED DEF SUBMIT TIME:  6.475907411018852 ITERATION:  2 NODE:  canada SCHEMA BUILD TIME:  0.00041440397035330534 SCHEMA SUBMIT TIME:  5.294093917007558 ITERATION:  2 NODE:  canada CRED DEF BUILD TIME:  0.0003922300529666245 CRED DEF SUBMIT TIME:  9.017383576952852 ITERATION:  2 NODE:  england SCHEMA BUILD TIME:  0.0003447070484980941 SCHEMA SUBMIT TIME:  7.1536829869728535 ITERATION:  2 NODE:  england CRED DEF BUILD TIME:  0.0004314139951020479 CRED DEF SUBMIT TIME:  6.70012780604884 ITERATION:  2 NODE:  ibmTest SCHEMA BUILD TIME:  0.0003784529981203377 SCHEMA SUBMIT TIME:  27.339088546985295 ITERATION:  2 NODE:  ibmTest CRED DEF BUILD TIME:  0.0004486889811232686 CRED DEF SUBMIT TIME:  8.554044977005105 ITERATION:  2 NODE:  korea SCHEMA BUILD TIME:  0.0006445790058933198 SCHEMA SUBMIT TIME:  8.09631814394379 ITERATION:  2 NODE:  korea CRED DEF BUILD TIME:  0.0005855240160599351 CRED DEF SUBMIT TIME:  27.640831064025406 ITERATION:  2 NODE:  lab10 SCHEMA BUILD TIME:  0.0004396539879962802 SCHEMA SUBMIT TIME:  5.3167560120346025 ITERATION:  2 NODE:  lab10 CRED DEF BUILD TIME:  0.0007042420329526067 CRED DEF SUBMIT TIME:  12.470109855988994 ITERATION:  2 NODE:  singapore SCHEMA BUILD TIME:  0.0003895619884133339 SCHEMA SUBMIT TIME:  7.138290948001668 ITERATION:  2 NODE:  singapore CRED DEF BUILD TIME:  0.0003913450054824352 CRED DEF SUBMIT TIME:  26.39183896803297 ITERATION:  2 NODE:  virginia SCHEMA BUILD TIME:  0.00042729696724563837 SCHEMA SUBMIT TIME:  5.164014468027744 ITERATION:  2 NODE:  virginia CRED DEF BUILD TIME:  0.0007933389861136675 CRED DEF SUBMIT TIME:  6.977192924998235 ITERATION:  2 NODE:  vnode1 SCHEMA BUILD TIME:  0.0006357830134220421 SCHEMA SUBMIT TIME:  5.26071064901771 ITERATION:  2 NODE:  vnode1 CRED DEF BUILD TIME:  0.00040973396971821785 CRED DEF SUBMIT TIME:  6.362914098019246 ITERATION:  2 NODE:  xsvalidatorec2irl SCHEMA BUILD TIME:  0.0004897679900750518 SCHEMA SUBMIT TIME:  5.905505531001836 ITERATION:  2 NODE:  xsvalidatorec2irl CRED DEF BUILD TIME:  0.0006524560158140957 CRED DEF SUBMIT TIME:  9.286057751975022 {noformat}  2. We *discard valid state proofs as invalid* during state proof check and fall into consensus reading way (see log file for more info).  ^1816_DEBUG_LOG.txt   3. First and second items are proved by this case - we have no timeout entries (20+ seconds) if we have no unreachable nodes in the first five entries of pre-ordered list: {noformat} ITERATION:  0    NODE:   'australia', 'brazil', 'canada', 'england', 'korea'     SCHEMA BUILD TIME:  0.00071936403401196     SCHEMA SUBMIT TIME:  10.674949111999013 ITERATION:  0    NODE:   'australia', 'brazil', 'canada', 'england', 'korea'     CRED DEF BUILD TIME:  0.0008700769976712763     CRED DEF SUBMIT TIME:  15.243298737041187 {"preordered_nodes":  "australia", "brazil", "canada", "england", "korea" , "genesis_txn": "/home/indy/stn_genesis"} ITERATION:  1    NODE:   'australia', 'brazil', 'canada', 'england', 'korea'     SCHEMA BUILD TIME:  0.0004818529705516994   SCHEMA SUBMIT TIME:  15.210919820005074 ITERATION:  1    NODE:   'australia', 'brazil', 'canada', 'england', 'korea'     CRED DEF BUILD TIME:  0.0017988579929806292     CRED DEF SUBMIT TIME:  12.489982932980638 {"preordered_nodes":  "australia", "brazil", "canada", "england", "korea" , "genesis_txn": "/home/indy/stn_genesis"} ITERATION:  2    NODE:   'australia', 'brazil', 'canada', 'england', 'korea'     SCHEMA BUILD TIME:  0.00038085499545559287      SCHEMA SUBMIT TIME:  9.789947590965312 ITERATION:  2    NODE:   'australia', 'brazil', 'canada', 'england', 'korea'     CRED DEF BUILD TIME:  0.0005322149954736233     CRED DEF SUBMIT TIME:  10.98095233400818 {"preordered_nodes":  "australia", "brazil", "canada", "england", "korea" , "genesis_txn": "/home/indy/stn_genesis"} ITERATION:  3    NODE:   'australia', 'brazil', 'canada', 'england', 'korea'     SCHEMA BUILD TIME:  0.00041271501686424017      SCHEMA SUBMIT TIME:  9.11812746297801 ITERATION:  3    NODE:   'australia', 'brazil', 'canada', 'england', 'korea'     CRED DEF BUILD TIME:  0.00039006100269034505    CRED DEF SUBMIT TIME:  12.334778853983153 {"preordered_nodes":  "australia", "brazil", "canada", "england", "korea" , "genesis_txn": "/home/indy/stn_genesis"} ITERATION:  4    NODE:   'australia', 'brazil', 'canada', 'england', 'korea'     SCHEMA BUILD TIME:  0.0015980950556695461   SCHEMA SUBMIT TIME:  8.034286240988877 ITERATION:  4    NODE:   'australia', 'brazil', 'canada', 'england', 'korea'     CRED DEF BUILD TIME:  0.0005512820207513869     CRED DEF SUBMIT TIME:  12.350479895947501 {"preordered_nodes":  "australia", "brazil", "canada", "england", "korea" , "genesis_txn": "/home/indy/stn_genesis"} ITERATION:  5    NODE:   'australia', 'brazil', 'canada', 'england', 'korea'     SCHEMA BUILD TIME:  0.0004467319813556969   SCHEMA SUBMIT TIME:  8.49566237104591 ITERATION:  5    NODE:   'australia', 'brazil', 'canada', 'england', 'korea'     CRED DEF BUILD TIME:  0.0007589649758301675     CRED DEF SUBMIT TIME:  8.675111969001591 {"preordered_nodes":  "australia", "brazil", "canada", "england", "korea" , "genesis_txn": "/home/indy/stn_genesis"} ITERATION:  6    NODE:   'australia', 'brazil', 'canada', 'england', 'korea'     SCHEMA BUILD TIME:  0.0004481080104596913   SCHEMA SUBMIT TIME:  6.685532119998243 ITERATION:  6    NODE:   'australia', 'brazil', 'canada', 'england', 'korea'     CRED DEF BUILD TIME:  0.0009117420413531363     CRED DEF SUBMIT TIME:  7.367479664972052 {"preordered_nodes":  "australia", "brazil", "canada", "england", "korea" , "genesis_txn": "/home/indy/stn_genesis"} ITERATION:  7    NODE:   'australia', 'brazil', 'canada', 'england', 'korea'     SCHEMA BUILD TIME:  0.000632074021268636    SCHEMA SUBMIT TIME:  6.785294690984301 ITERATION:  7    NODE:   'australia', 'brazil', 'canada', 'england', 'korea'     CRED DEF BUILD TIME:  0.0004784189513884485     CRED DEF SUBMIT TIME:  8.227590443042573 {"preordered_nodes":  "australia", "brazil", "canada", "england", "korea" , "genesis_txn": "/home/indy/stn_genesis"} ITERATION:  8    NODE:   'australia', 'brazil', 'canada', 'england', 'korea'     SCHEMA BUILD TIME:  0.00046138401376083493      SCHEMA SUBMIT TIME:  7.372021807997953 ITERATION:  8    NODE:   'australia', 'brazil', 'canada', 'england', 'korea'     CRED DEF BUILD TIME:  0.00039455003570765257    CRED DEF SUBMIT TIME:  8.3099751159898 {"preordered_nodes":  "australia", "brazil", "canada", "england", "korea" , "genesis_txn": "/home/indy/stn_genesis"} ITERATION:  9    NODE:   'australia', 'brazil', 'canada', 'england', 'korea'     SCHEMA BUILD TIME:  0.00047961296513676643      SCHEMA SUBMIT TIME:  7.599210688029416 ITERATION:  9    NODE:   'australia', 'brazil', 'canada', 'england', 'korea'     CRED DEF BUILD TIME:  0.00042169197695329785    CRED DEF SUBMIT TIME:  7.6668213860248215 {"preordered_nodes":  "australia", "brazil", "canada", "england", "korea" , "genesis_txn": "/home/indy/stn_genesis"} ITERATION:  10   NODE:   'australia', 'brazil', 'canada', 'england', 'korea'     SCHEMA BUILD TIME:  0.0005553200026042759   SCHEMA SUBMIT TIME:  7.3137635180028155 ITERATION:  10   NODE:   'australia', 'brazil', 'canada', 'england', 'korea'     CRED DEF BUILD TIME:  0.0004580419627018273     CRED DEF SUBMIT TIME:  8.760852812032681 {"preordered_nodes":  "australia", "brazil", "canada", "england", "korea" , "genesis_txn": "/home/indy/stn_genesis"} ITERATION:  11   NODE:   'australia', 'brazil', 'canada', 'england', 'korea'     SCHEMA BUILD TIME:  0.0003568860120140016   SCHEMA SUBMIT TIME:  9.630284291983116 ITERATION:  11   NODE:   'australia', 'brazil', 'canada', 'england', 'korea'     CRED DEF BUILD TIME:  0.0003572659916244447     CRED DEF SUBMIT TIME:  7.676376082992647 {"preordered_nodes":  "australia", "brazil", "canada", "england", "korea" , "genesis_txn": "/home/indy/stn_genesis"} ITERATION:  12   NODE:   'australia', 'brazil', 'canada', 'england', 'korea'     SCHEMA BUILD TIME:  0.00041842699283733964      SCHEMA SUBMIT TIME:  7.292544230003841 ITERATION:  12   NODE:   'australia', 'brazil', 'canada', 'england', 'korea'     CRED DEF BUILD TIME:  0.000414306006859988      CRED DEF SUBMIT TIME:  9.098214313969947 {"preordered_nodes":  "australia", "brazil", "canada", "england", "korea" , "genesis_txn": "/home/indy/stn_genesis"} ITERATION:  13   NODE:   'australia', 'brazil', 'canada', 'england', 'korea'     SCHEMA BUILD TIME:  0.0003788279718719423   SCHEMA SUBMIT TIME:  8.337549212970771 ITERATION:  13   NODE:   'australia', 'brazil', 'canada', 'england', 'korea'     CRED DEF BUILD TIME:  0.0004444450023584068     CRED DEF SUBMIT TIME:  8.011969352024607 {"preordered_nodes":  "australia", "brazil", "canada", "england", "korea" , "genesis_txn": "/home/indy/stn_genesis"} ITERATION:  14   NODE:   'australia', 'brazil', 'canada', 'england', 'korea'     SCHEMA BUILD TIME:  0.0003712259931489825   SCHEMA SUBMIT TIME:  7.516635962005239 ITERATION:  14   NODE:   'australia', 'brazil', 'canada', 'england', 'korea'     CRED DEF BUILD TIME:  0.0003985959920100868     CRED DEF SUBMIT TIME:  8.016342504997738 {"preordered_nodes":  "australia", "brazil", "canada", "england", "korea" , "genesis_txn": "/home/indy/stn_genesis"} ITERATION:  15   NODE:   'australia', 'brazil', 'canada', 'england', 'korea'     SCHEMA BUILD TIME:  0.0004995050258003175   SCHEMA SUBMIT TIME:  6.590662899019662 ITERATION:  15   NODE:   'australia', 'brazil', 'canada', 'england', 'korea'     CRED DEF BUILD TIME:  0.0005240379832684994     CRED DEF SUBMIT TIME:  8.55104955600109 {"preordered_nodes":  "australia", "brazil", "canada", "england", "korea" , "genesis_txn": "/home/indy/stn_genesis"} ITERATION:  16   NODE:   'australia', 'brazil', 'canada', 'england', 'korea'     SCHEMA BUILD TIME:  0.00038845796370878816      SCHEMA SUBMIT TIME:  7.00814802601235 ITERATION:  16   NODE:   'australia', 'brazil', 'canada', 'england', 'korea'     CRED DEF BUILD TIME:  0.0005056080408394337     CRED DEF SUBMIT TIME:  7.852209976990707 {"preordered_nodes":  "australia", "brazil", "canada", "england", "korea" , "genesis_txn": "/home/indy/stn_genesis"} ITERATION:  17   NODE:   'australia', 'brazil', 'canada', 'england', 'korea'     SCHEMA BUILD TIME:  0.0005048540187999606   SCHEMA SUBMIT TIME:  7.684812290011905 ITERATION:  17   NODE:   'australia', 'brazil', 'canada', 'england', 'korea'     CRED DEF BUILD TIME:  0.0005052060005255044     CRED DEF SUBMIT TIME:  8.639466541993897 {"preordered_nodes":  "australia", "brazil", "canada", "england", "korea" , "genesis_txn": "/home/indy/stn_genesis"} ITERATION:  18   NODE:   'australia', 'brazil', 'canada', 'england', 'korea'     SCHEMA BUILD TIME:  0.0004395670257508755   SCHEMA SUBMIT TIME:  6.781523112964351 ITERATION:  18   NODE:   'australia', 'brazil', 'canada', 'england', 'korea'     CRED DEF BUILD TIME:  0.000595680030528456      CRED DEF SUBMIT TIME:  8.58199124597013 {"preordered_nodes":  "australia", "brazil", "canada", "england", "korea" , "genesis_txn": "/home/indy/stn_genesis"} ITERATION:  19   NODE:   'australia', 'brazil', 'canada', 'england', 'korea'     SCHEMA BUILD TIME:  0.0004052059957757592   SCHEMA SUBMIT TIME:  6.98533082898939 ITERATION:  19   NODE:   'australia', 'brazil', 'canada', 'england', 'korea'     CRED DEF BUILD TIME:  0.0004211320192553103     CRED DEF SUBMIT TIME:  9.060357490961906 {noformat}    ></body> </Action>
<Action id="53653" issue="35125" author="ashcherbakov" type="comment" created="2018-11-20 15:51:23.0" updateauthor="ashcherbakov" updated="2018-11-20 15:54:07.0"> <body><! CDATA *The cause of the issue* * The Main reason ** Inconsistency in communication between libindy and indy-node. It turned out that libindy and indy-node use different values for the state keys in Schemas, Nyms and CredDefs which leads to State Proof verification failure and a lot of re-sending. *** After txn format migration, indy-node started using string values for txn types for Nyms, Schemas and CredDefs, while libindy still uses hex values. *** So, State proof validation always fails, and client sends requests one by one to every node and validates state proofs and BLS multi-sigs until it receives f+1 equal replies.  * Additional reason ** It looks like there is a new (14th) Validator Node added to STN recently: *dativa_validator* which doesn't reply to read requests. So, if a request is sent to this node (1/14 probability), it will wait for 20 secs before sending to the next node  * Example: ** Send RequestX to Node1 => Reply1 => validate BLS-multi-sig (OK) => Validate State Proof (FAIL) ** Send RequestX to Node2 => Reply2 => validate BLS-multi-sig (OK) => Validate State Proof (FAIL) ** .... ** _<If NodeY=unreachable node, then the next re-sent is done in 20 secs only!!!>_ ** .... ** Send RequestX to NodeF => ReplyF => validate BLS-multi-sig (OK) => Validate State Proof (FAIL) ** Send RequestX to NodeF+1 => ReplyF+1 => validate BLS-multi-sig (OK) => Validate State Proof (FAIL) ** Got F+1 equal replies => SUCCESS (but too long!)  Â   *How to fix*  We need to decide if we go with Option1 or Option2.  Option3 must be done in any case, but it may mitigate the slowness issue in a short term. * Option1: in Indy-Node ** What needs to be done: *** Change state keys to use hex values for Nyms, Schemas and ClaimDefs (that is revert it back) *** Create a migration to delete domain state tree (it will be restored from the ledger) ** Pros: *** No changes in libindy and other apps ** Cons: *** A need for migration and restoring State Trie from the ledger on all nodes (may take some time) *** A need to upgrade STN *** libindy will still need to deal with non-string values in keys (which are public IDs) * Option2: in libindy ** What needs to be done: *** Use string values instead of hex when verifying state proofs ** Pros: *** It's better to have string values there, since state key is a public ID used in many places, so it makes sense to consider this change in any case *** No need for STN upgrade and migration ** Cons: *** A need to update all apps including libsovtoken, Verity, Agency, Connect.me  * Option3: in VCX ** What needs to be done: *** Cache Schemas and CredDefs and do not request them from the Ledger on each proof generation ** Pros: *** Needs to be done in any case *** Touches less dependencies than a fix in libindy ** Cons: *** Still requires update of a lot of apps (Verity, Agency, Connect.me)  *When to fix* * Option A: A hotfix ASAP (either for Option1 or Option2) * Option B: In the next Service Pack release next Sprint (on Dec, 07)  *Action Items* * Create deterministic tests to make sure that BLS multi-signature and State Proofs work as expected (asking only 1 node)  *  ** it turned out that we already had such a test, but it was incorrect ** fixed in  https://github.com/hyperledger/indy-node/pull/1046  * It was decided to go with Option2+A, that is created a hotfix libindy 1.6.8 (IS-1066)  ></body> </Action>
<Action id="53654" issue="35125" author="esplinr" type="comment" body="We will also work on Option 3 in IS-1075." created="2018-11-20 16:04:55.0" updateauthor="esplinr" updated="2018-11-20 16:04:55.0"/>
