<Issue id="36730" key="INDY-1935" number="1935" project="10303" reporter="ashcherbakov" creator="ashcherbakov" type="10004" summary="A node may use incorrect BLS key for signature" priority="3" status="10200" created="2019-01-14 08:32:43.0" updated="2019-12-26 13:29:24.0" votes="0" watches="2" workflowId="48283"> <description><! CDATA *Problem:*** * Incorrect BLS multi-sig appears in the load test sometimes.  *Problem Reason:* * The reason is that BLS multi-signature is created against the current uncommitted pool state (the one sent in PrePrepare), but nodes use the BLS keys for signature according to their committed pool state (Node's BLS keys are updated only when a 3PC batch is ordered, that is the state is committed).  *Test scenario:* * A Primary sends a PRE-PREPARE with BLS keys update against POOL_STATE1 * A Primary sends a PRE-PREPARE with another BLS keys update against POOL_STATE2 *before* the firest PRE-PREPARE is committed and ordered (just delay Ordered msgs on all nodes) * {color:#de350b}For the second PRE-PREPARE, all nodes use BLS keys for signature against POOL_STATE1, but the signature will be validated by others against POOL_STATE2{color}  *{color:#172b4d}Acceptance criteria{color}* * {color:#172b4d}Write the integration test for the test case above {color} * {color:#172b4d}Write a PoA and fix the problem{color}  ></description> </Issue>
