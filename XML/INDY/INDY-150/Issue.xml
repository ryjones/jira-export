<Issue id="17478" key="INDY-150" number="150" project="10303" reporter="dsurnin" assignee="danielhardman" creator="dsurnin" type="10004" summary="Node crash with corrupted pool ledger file" priority="3" resolution="10000" status="10001" created="2017-06-05 13:31:03.0" updated="2019-03-29 20:32:47.0" resolutiondate="2019-03-29 20:32:47.0" votes="0" watches="7" workflowId="17482"> <description><! CDATA install client and node in one machine from rc repo;  run 4 nodes locally as described  https://github.com/sovrin-foundation/sovrin-node/blob/master/docs/Sovrin_Running_Locally.md ;  on running node1 change pool ledger fileÂ   ~.sovrin/data/nodes/Node1/pool_transactions_sandbox/1  edit some base58 field - add character '#' to the field  stop and rerun node1;  have crash log like this {code:java} $ start_sovrin_node Node2 9703 9704 2017-06-05 16:30:19,986 | INFO | log.py ( 79) | setupRaet | Setting RAET log level 2 2017-06-05 16:30:20,000 | DEBUG | start_sovrin_node ( 38) | <module> | You can find logs in /home/tmh/.sovrin/Node2.log 2017-06-05 16:30:20,000 | DEBUG | start_sovrin_node ( 41) | <module> | Sovrin related env vars:    2017-06-05 16:30:21,237 | DEBUG | __init__.py ( 59) | register | Registered VCS backend: git 2017-06-05 16:30:21,291 | DEBUG | __init__.py ( 59) | register | Registered VCS backend: hg 2017-06-05 16:30:21,358 | DEBUG | __init__.py ( 59) | register | Registered VCS backend: svn 2017-06-05 16:30:21,359 | DEBUG | __init__.py ( 59) | register | Registered VCS backend: bzr 2017-06-05 16:30:21,973 | DEBUG | selector_events.py ( 53) | __init__ | Using selector: EpollSelector 2017-06-05 16:30:21,974 | DEBUG | looper.py ( 123) | __init__ | Setting handler for SIGINT 2017-06-05 16:30:21,995 | DEBUG | ledger.py ( 203) | start | Starting ledger... 2017-06-05 16:30:22,000 | DEBUG | file_store.py ( 176) | appendNewLineIfReq | new line check for file: /home/tmh/.sovrin/data/nodes/Node2/transactions_sandbox/1 2017-06-05 16:30:22,000 | DEBUG | file_store.py ( 185) | appendNewLineIfReq | new line added for file: /home/tmh/.sovrin/data/nodes/Node2/transactions_sandbox/1 2017-06-05 16:30:22,001 | DEBUG | ledger.py ( 96) | recoverTree | Recovering tree from transaction log 2017-06-05 16:30:22,182 | DEBUG | ledger.py ( 102) | recoverTree | Recovered tree from transaction log in 0.18086004903307185 seconds 2017-06-05 16:30:22,192 | DEBUG | idr_cache.py ( 25) | __init__ | Initializing identity cache Node2 2017-06-05 16:30:22,220 | DEBUG | ledger.py ( 203) | start | Starting ledger... 2017-06-05 16:30:22,221 | DEBUG | file_store.py ( 176) | appendNewLineIfReq | new line check for file: /home/tmh/.sovrin/data/nodes/Node2/pool_transactions_sandbox/1 2017-06-05 16:30:22,221 | DEBUG | file_store.py ( 185) | appendNewLineIfReq | new line added for file: /home/tmh/.sovrin/data/nodes/Node2/pool_transactions_sandbox/1 2017-06-05 16:30:22,221 | DEBUG | ledger.py ( 96) | recoverTree | Recovering tree from transaction log 2017-06-05 16:30:22,233 | DEBUG | ledger.py ( 102) | recoverTree | Recovered tree from transaction log in 0.011491347977425903 seconds 2017-06-05 16:30:22,235 | INFO | looper.py ( 267) | shutdown | Looper shutting down now... 2017-06-05 16:30:22,247 | INFO | looper.py ( 274) | shutdown | Looper shut down in 0.011 seconds. Traceback (most recent call last): File "/usr/local/bin/start_sovrin_node", line 47, in <module> cliha=cliha) File "/usr/local/lib/python3.5/dist-packages/sovrin_node/server/node.py", line 80, in __init__ config=self.config) File "/usr/local/lib/python3.5/dist-packages/plenum/server/node.py", line 163, in __init__ self.initPoolManager(nodeRegistry, ha, cliname, cliha) File "/usr/local/lib/python3.5/dist-packages/sovrin_node/server/node.py", line 101, in initPoolManager HasPoolManager.__init__(self, nodeRegistry, ha, cliname, cliha) File "/usr/local/lib/python3.5/dist-packages/sovrin_node/server/pool_manager.py", line 12, in __init__ cliha=cliha) File "/usr/local/lib/python3.5/dist-packages/sovrin_node/server/pool_manager.py", line 23, in __init__ super().__init__(node=node, ha=ha, cliname=cliname, cliha=cliha) File "/usr/local/lib/python3.5/dist-packages/plenum/server/pool_manager.py", line 75, in __init__ cliname=cliname, cliha=cliha) File "/usr/local/lib/python3.5/dist-packages/plenum/server/pool_manager.py", line 115, in getStackParamsAndNodeReg nodeReg, cliNodeReg, nodeKeys = self.parseLedgerForHaAndKeys(self.ledger) File "/usr/local/lib/python3.5/dist-packages/plenum/common/stack_manager.py", line 91, in parseLedgerForHaAndKeys verkey = cryptonymToHex(txn TARGET_NYM ) File "/usr/local/lib/python3.5/dist-packages/plenum/common/util.py", line 317, in cryptonymToHex return hexlify(base58.b58decode(cryptonym.encode())) File "/usr/local/lib/python3.5/dist-packages/base58.py", line 66, in b58decode acc += p * alphabet.index(c) ValueError: substring not found{code}  ></description> </Issue>
