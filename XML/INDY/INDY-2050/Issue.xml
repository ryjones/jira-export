<Issue id="39198" key="INDY-2050" number="2050" project="10303" reporter="vladimirwork" assignee="ashcherbakov" creator="vladimirwork" type="10004" summary="Some nodes are stalled and throw an error under load" priority="3" resolution="10000" status="10001" created="2019-04-10 13:48:25.0" updated="2019-04-21 13:33:14.0" resolutiondate="2019-04-21 13:33:14.0" votes="0" watches="3" workflowId="52075"> <description><! CDATA Build Info: indy-node 1.7.0~dev888  Steps to Reproduce: 1. Run domain + config load test (load rate 10) with forced VCs every 1800 seconds.  Actual Results: We have 1 and 22 nodes that stop ordering and catching up and have view different from other nodes. Also there are some stacktraces in journalctl: {noformat} Apr 09 23:32:08 sydneyQALive7.qatest.evernym.com env 8784 :   File "/usr/local/lib/python3.5/dist-packages/plenum/server/node.py", line 1347, in serviceReplicas Apr 09 23:32:08 sydneyQALive7.qatest.evernym.com env 8784 :     return self._process_replica_messages(limit) Apr 09 23:32:08 sydneyQALive7.qatest.evernym.com env 8784 :   File "/usr/local/lib/python3.5/dist-packages/plenum/server/node.py", line 1350, in _process_replica_messages Apr 09 23:32:08 sydneyQALive7.qatest.evernym.com env 8784 :     inbox_processed = self.replicas.service_inboxes(limit) Apr 09 23:32:08 sydneyQALive7.qatest.evernym.com env 8784 :   File "/usr/local/lib/python3.5/dist-packages/plenum/server/replicas.py", line 100, in service_inboxes Apr 09 23:32:08 sydneyQALive7.qatest.evernym.com env 8784 :     sum(replica.serviceQueues(limit) for replica in self._replicas.values()) Apr 09 23:32:08 sydneyQALive7.qatest.evernym.com env 8784 :   File "/usr/local/lib/python3.5/dist-packages/plenum/server/replicas.py", line 100, in <genexpr> Apr 09 23:32:08 sydneyQALive7.qatest.evernym.com env 8784 :     sum(replica.serviceQueues(limit) for replica in self._replicas.values()) Apr 09 23:32:08 sydneyQALive7.qatest.evernym.com env 8784 :   File "/usr/local/lib/python3.5/dist-packages/plenum/server/replica.py", line 216, in wrapper Apr 09 23:32:08 sydneyQALive7.qatest.evernym.com env 8784 :     return f(self, *args, **kwargs) Apr 09 23:32:08 sydneyQALive7.qatest.evernym.com env 8784 :   File "/usr/lib/python3.5/contextlib.py", line 77, in __exit__ Apr 09 23:32:08 sydneyQALive7.qatest.evernym.com env 8784 :     self.gen.throw(type, value, traceback) Apr 09 23:32:08 sydneyQALive7.qatest.evernym.com env 8784 :   File "/usr/local/lib/python3.5/dist-packages/plenum/common/metrics_collector.py", line 352, in measure_time Apr 09 23:32:08 sydneyQALive7.qatest.evernym.com env 8784 :     yield Apr 09 23:32:08 sydneyQALive7.qatest.evernym.com env 8784 :   File "/usr/local/lib/python3.5/dist-packages/plenum/server/replica.py", line 216, in wrapper Apr 09 23:32:08 sydneyQALive7.qatest.evernym.com env 8784 :     return f(self, *args, **kwargs) Apr 09 23:32:08 sydneyQALive7.qatest.evernym.com env 8784 :   File "/usr/local/lib/python3.5/dist-packages/plenum/server/replica.py", line 1028, in serviceQueues Apr 09 23:32:08 sydneyQALive7.qatest.evernym.com env 8784 :     r = self.dequeue_pre_prepares() Apr 09 23:32:08 sydneyQALive7.qatest.evernym.com env 8784 :   File "/usr/local/lib/python3.5/dist-packages/plenum/server/replica.py", line 2377, in dequeue_pre_prepares Apr 09 23:32:08 sydneyQALive7.qatest.evernym.com env 8784 :     *self.prePreparesPendingPrevPP.iloc 0 ): Apr 09 23:32:08 sydneyQALive7.qatest.evernym.com env 8784 :   File "/usr/local/lib/python3.5/dist-packages/plenum/server/replica.py", line 1395, in __is_next_pre_prepare Apr 09 23:32:08 sydneyQALive7.qatest.evernym.com env 8784 :     .format(self, view_no, self.viewNo) Apr 09 23:32:08 sydneyQALive7.qatest.evernym.com env 8784 : common.exceptions.LogicError: Node7:5 'view_no' 21 is not equal to current view_no 22 {noformat}   Expected Results: There should be no stalled nodes at this load rate. Pool should sustain this load rate more time than just ~10 hours.  Logs and metrics: ev@evernymr33:logs/10_04_2019_view_changes_two_ledgers_logs.tar.gz ev@evernymr33:logs/10_04_2019_view_changes_two_ledgers_metrics.tar.gz  ></description> </Issue>
