<Action id="46675" issue="31443" author="ashcherbakov" type="comment" created="2018-06-28 13:25:58.0" updateauthor="ashcherbakov" updated="2018-06-29 06:59:11.0"> <body><! CDATA Problem reason:  - State trie is re-created after the Upgrade and BLS signature store is deleted.  - There were some nodes in the pool which didn't have BLS keys correctly initialized - Since we don't requite that all (n-f) Commits need to have BLS for ordering, it's possible that for a couple of first writes BLS signature was still not created for the latest state. - When we send read request, and there is no BLS signature for the currently committed state (` get_value_from_state`), we call `self.state.get_for_root_hash`, and there was a bug in this branch of code, *that parameters were switched*. - There were no unit tests for this branches  Changes:  - Added unit tests for all branches - Fixed order of arguments for `get_for_root_hash` in `get_value_from_state`.  PR: - https://github.com/hyperledger/indy-plenum/pull/778  Version: - RC 1.4.66  Risk factors: - Read requests  Risk: - Low  Covered with tests: - test_get_value_default_head_hash - test_get_value_old_head_hash  Recommendations for QA - create a new pool and try to read genesis txn data without any writes (like in INDY-1428) - have a pool with some data (after some write txns), remove `signature_store` on all nodes, and try to read the data - read data after migration (test on RC?)  ></body> </Action>
<Action id="46756" issue="31443" author="vladimirwork" type="comment" created="2018-06-29 15:36:11.0" updateauthor="vladimirwork" updated="2018-06-29 15:36:59.0"> <body><! CDATA Build Info: indy-node 1.4.66 rc  Steps to Validate: 1. Create a new 1.4.66 pool / upgrade it from 1.3.62 to 1.4.66 and try to read genesis txn data without any writes. 2. Upgrade a pool from 1.3.62 to 1.4.66 -> remove /state_signature/ folder at all nodes and restart them -> try to read data from ledger without any writes.  Actual Results: Get txns works correct in both cases. Persistent pool (where an issue was found) upgraded from 1.4.64 to 1.4.66 also works normally.  ></body> </Action>
