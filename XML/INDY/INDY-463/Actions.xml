<Action id="29114" issue="19532" author="slafranca" type="comment" created="2017-07-27 19:17:01.0" updateauthor="slafranca" updated="2017-07-27 19:17:01.0"> <body><! CDATA After following the steps listed in the description, my pool does not process any transactions.  Nodes 2-6 are running.  Restarting the services does not make a difference.  The node log for 2-6 have the same information, they show: {code} .sovrin/Node6.log:2017-07-27 17:20:56,105 | DISPLAY  | primary_selector.py  ( 284) | _startSelection | Node6:0 selected primary Node3:0 for instance 0 (view 2) {code}  The log on node 1 shows: {code} .sovrin/Node1.log:2017-07-27 17:19:20,005 | DISPLAY  | primary_selector.py  ( 284) | _startSelection | Node1:0 selected primary Node1:0 for instance 0 (view 0) {code}  ></body> </Action>
<Action id="29390" issue="19532" author="ashcherbakov" type="comment" created="2017-08-03 09:48:43.0" updateauthor="ashcherbakov" updated="2017-08-03 09:48:43.0"> <body><! CDATA Even if Node 1 is set as a primary initially, the view change will not finish as it required to have an ACK from the selected Primary as well, In this case Node 1 will not send ACK, we will select the next node after some timeout.   ></body> </Action>
<Action id="29397" issue="19532" author="vladimirwork" type="comment" created="2017-08-03 12:26:40.0" updateauthor="vladimirwork" updated="2017-08-03 12:28:04.0"> <body><! CDATA Steps to Reproduce - Case 1:  1. Send "new key with seed 000000000000000000000000Trustee1". 2. Send "send NODE dest=Gw6pDLhcBcoQesN72qfotTgFa7cbuqZpkX3Xo6pLhPhv data={'alias': 'Node1', 'services':   }". 3. Restart the entire pool.  Actual Results: NYMs are not adding (but primary seems to be elected in log).  ^_node1_case1.txt    ^_node1_case2.txt    ^_node2_case1.txt    ^_node2_case2.txt    ^_node3_case1.txt    ^_node3_case2.txt    ^_node4_case1.txt    ^_node4_case2.txt    Steps to Reproduce - Case 2:  1. Send "new key with seed 000000000000000000000000Trustee1". 2. Send "send NODE dest=4PS3EDQ3dW1tci1Bp6543CfuuebjFrg36kLAUcskGfaA data={'alias': 'Node4', 'services':   }". 3. Restart the entire pool.  Actual Results: NYMs are not adding. There is a stack trace in systemctl status sovrin-node.service on Node 1:  Aug 03 12:06:10 8990aa3fcd5b env 110 :     if self.monitor.isMasterDegraded(): Aug 03 12:06:10 8990aa3fcd5b env 110 :   File "/usr/local/lib/python3.5/dist-packages/plenum/server/monitor.py", line 266, in isMasterDegraded Aug 03 12:06:10 8990aa3fcd5b env 110 :     (self.isMasterThroughputTooLow() or Aug 03 12:06:10 8990aa3fcd5b env 110 :   File "/usr/local/lib/python3.5/dist-packages/plenum/server/monitor.py", line 287, in isMasterThroughputTooLow Aug 03 12:06:10 8990aa3fcd5b env 110 :     r = self.masterThroughputRatio() Aug 03 12:06:10 8990aa3fcd5b env 110 :   File "/usr/local/lib/python3.5/dist-packages/plenum/server/monitor.py", line 275, in masterThroughputRatio Aug 03 12:06:10 8990aa3fcd5b env 110 :     masterThrp, backupThrp = self.getThroughputs(self.instances.masterId) Aug 03 12:06:10 8990aa3fcd5b env 110 :   File "/usr/local/lib/python3.5/dist-packages/plenum/server/monitor.py", line 361, in getThroughputs Aug 03 12:06:10 8990aa3fcd5b env 110 :     avgReqsPerInst = totalReqs / self.instances.count Aug 03 12:06:10 8990aa3fcd5b env 110 : TypeError: unsupported operand type(s) for /: 'NoneType' and 'int'  Expected Results: Pool should work normally in both cases.  ></body> </Action>
<Action id="29727" issue="19532" author="mzk-vct" type="comment" created="2017-08-11 15:20:54.0" updateauthor="mzk-vct" updated="2017-08-11 15:21:48.0"> <body><! CDATA The reason is that node uses *TxnPoolManager.get_name_by_rank* which reads NODE transactions directly from pool ledger. It traverses ledger searching first occurrence of NODE transaction with required id, ignoring other occurrence and without checking node for demotion - so, demoted node can be nominated to be next primary.  Stack trace in a comment of  ~VladimirWork  is not caused by this problem. It happens when `totalReqs` is None, what happens when there were no requests.  ></body> </Action>
<Action id="30314" issue="19532" author="andkononykhin" type="comment" created="2017-08-29 13:58:25.0" updateauthor="andkononykhin" updated="2017-08-29 13:58:25.0"> <body><! CDATA Fixed by  PR-354|https://github.com/hyperledger/indy-plenum/pull/354 : for now demoted node is not taken into account during primary selection, so after restart it won't be selected as primary  How it could be tested: repeat steps from the description  ></body> </Action>
<Action id="30358" issue="19532" author="vladimirwork" type="comment" created="2017-08-30 11:09:35.0" updateauthor="vladimirwork" updated="2017-08-30 11:09:35.0"> <body><! CDATA Build Info: indy-node 1.1.125  Steps to Reproduce - Case 1: 1. Send "new key with seed 000000000000000000000000Trustee1". 2. Send "send NODE dest=Gw6pDLhcBcoQesN72qfotTgFa7cbuqZpkX3Xo6pLhPhv data={'alias': 'Node1', 'services':   }". 3. Restart the entire pool.  Steps to Reproduce - Case 2: 1. Send "new key with seed 000000000000000000000000Trustee1". 2. Send "send NODE dest=4PS3EDQ3dW1tci1Bp6543CfuuebjFrg36kLAUcskGfaA data={'alias': 'Node4', 'services':   }". 3. Restart the entire pool.  Actual Results: Pool works normally in both cases - NYMs are added and are got.  ></body> </Action>
