<Issue id="18672" key="INDY-331" number="331" project="10303" reporter="danielhardman" assignee="danielhardman" creator="danielhardman" type="10002" summary="make keep-alive mechanism more robust" priority="1" resolution="10000" status="10001" created="2017-06-26 15:10:51.0" updated="2019-03-29 20:33:03.0" resolutiondate="2019-03-29 20:33:03.0" votes="0" watches="5" workflowId="18672"> <description><! CDATA After a lot of experimentation, we have determined that the bug we are seeing with Unicorn, where a validator node seems to disconnect, is caused by failure of keepalives. We ran an experiment where we sent a transaction through the pool every few seconds, and the node maintained its connection for 24 hours without any trouble. This means the reason for the keepalive failure is likely that a firewall in front of the problem node decided to kill idle sessions and didn't send signals in all directions.  What we need to do is make our keepalive more robust. If the theory of  ~dfarns  is correct, we may have a constant that has units of seconds where we thought it was millisecondsâ€“but even if that turns out to be true, I recommend that we consider pinging any node that hasn't talked to us for, say, 15 seconds. This would shift the keepalive burden from low-level sockets config to higher-level protocol. h4. App level heartbeats:  *Merits: cross-platform, transport agnostic and debuggability* A hybrid solution where for well tested platforms like Ubuntu 16/Centos7 etc, we default to using TCP keepalives only but for any others, TCP keepalives can happen too but app level heartbeat would happen too. Also this app level heartbeat can be changed in the config file, so even if i am on Ubuntu and doubtful that i am not getting messages, i can simply enable heartbeating in config files and restart the node, i will start seeing pings being sent and pongs received, of course i will not receive pings unless the other node disconnects or has changed it's config (though it can be used as DoS mechanism). If we switch to RAET we will set heartbeating to True in config by default  ></description> </Issue>
