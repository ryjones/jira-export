<Issue id="27020" key="INDY-1101" number="1101" project="10303" reporter="ozheregelya" creator="ozheregelya" type="10004" summary="Upgrade from 1.2.214 (~1.2.50stable) to 1.2.279 don&apos;t work" priority="1" resolution="10000" status="10001" created="2018-01-23 16:33:18.0" updated="2019-03-29 20:35:03.0" resolutiondate="2019-03-29 20:35:03.0" votes="0" watches="2" workflowId="27021"> <environment><! CDATA indy-node 1.2.214->1.2.279 pool: 25 AWS nodes (QA Live pool)  ></environment> <description><! CDATA *Steps to Reproduce:* 1. Setup the pool using 1.2.214 version (master analog of latest stable). 2. Schedule valid upgrade like {code:java} send POOL_UPGRADE name=upgrade12279 version=1.2.279 sha256=e3b0c44298fc1c149afbf4c8996fb92427ae41e4649b934ca495991b7852b855 action=start schedule={'Gw6pDLhcBcoQesN72qfotTgFa7cbuqZpkX3Xo6pLhPhv': '2018-01-23T11:30:00.000000+00:00', '8ECVSk179mjsjKRLWiQtssMLgp6EPhWXtaYyStWPSGAb': '2018-01-23T11:35:00.000000+00:00', 'DKVxG2fXXTU8yT5N7hGEbXB3dfdAnYv1JczDUHpmDxya': '2018-01-23T11:40:00.000000+00:00', '4PS3EDQ3dW1tci1Bp6543CfuuebjFrg36kLAUcskGfaA': '2018-01-23T11:45:00.000000+00:00', '4SWokCJWJc69Tn74VvLS6t2G2ucvXqM9FDMsWJjmsUxe': '2018-01-23T11:50:00.000000+00:00', 'Cv1Ehj43DDM5ttNBmC6VPpEfwXWwfGktHwjDJsTV5Fz8': '2018-01-23T11:55:00.000000+00:00', 'BM8dTooz5uykCbYSAAFwKNkYfT4koomBHsSWHTDtkjhW': '2018-01-23T12:00:00.000000+00:00', '98VysG35LxrutKTNXvhaztPFHnx5u9kHtT7PnUGqDa8x': '2018-01-23T12:05:00.000000+00:00', '6pfbFuX5tx7u3XKz8MNK4BJiHxvEcnGRBs1AQyNaiEQL': '2018-01-23T12:10:00.000000+00:00', 'HaNW78ayPK4b8vTggD4smURBZw7icxJpjZvCMLdUueiN': '2018-01-23T12:15:00.000000+00:00', '2zUsJuF9suBy2iKkcgmm8uoMB6u5Dq2oHoRuchrZbj2N': '2018-01-23T12:20:00.000000+00:00', 'BXV4SXKEJeYQ8XCRHgpw1Xume5ntqALsRhbUYcF85Mse': '2018-01-23T12:25:00.000000+00:00', '71WAtEevzz8aZr8baNJhQCUDLwRhM7LeaErSKNWWKxzn': '2018-01-23T12:30:00.000000+00:00', 'FEUGMFWCSAM725vyH8JZnsitiNUy31NPhugVKb8zDpng': '2018-01-23T12:35:00.000000+00:00', 'DPZ8GJ1NyNZGJMU6qQZVuBsumY1aVzvcV4FqQK9Y215x': '2018-01-23T12:40:00.000000+00:00', 'FYDoBrDhfGuSwt39Sgd3DZETihpnXy6SzZBggyD9HMrD': '2018-01-23T12:45:00.000000+00:00', 'EMNhsHNsEpuffxCmgC3fpwVj7LgwtSm3riSizCMN6MBo': '2018-01-23T12:50:00.000000+00:00', 'HD1XnVG6jXqGdmFMDTdJk3AoChxaqTfa6zGLkyXTtHwH': '2018-01-23T12:55:00.000000+00:00', 'DUGXi5vxRZcrDC8VPZFU6bpiHDMhnWic9tDaoDJv3Bj6': '2018-01-23T13:00:00.000000+00:00', 'D7jphMASPQAD6UFvT2ULjEfYybCJVDzwvfG5ZWJoXa69': '2018-01-23T13:05:00.000000+00:00', '7vcRBffPvKuGQz4F1ThYAo3Ucq3rXgU62enf6d23u8KX': '2018-01-23T13:10:00.000000+00:00', 'DfSoxVHbbdZrAmwTJcRqM2arwUSvK3L6PXjqWHGo58xD': '2018-01-23T13:15:00.000000+00:00', 'FTBmYnhxVd8zXZFRzca5WFKh7taW9J573T8pXEWL8Wbb': '2018-01-23T13:20:00.000000+00:00', 'EjZrHfLTBR38d67HasBxpyKRBvrPBJ5RiAMubPWXLxWr': '2018-01-23T13:25:00.000000+00:00', 'koKn32jREPYR642DQsFftPoCkTf3XCPcfvc3x9RhRK7': '2018-01-23T13:30:00.000000+00:00'} timeout=10{code} 3. Wait for upgrade.  *Actual Results:* 1) Pool upgrade had failed {code:java} Jan 23 11:30:16 californiaQALive1.qatest.evernym.com env 16689 : 2018-01-23 11:30:16,659 | WARNING | node_control_tool.py (172) | _restore_from_backup | Copying last_version failed due to  Errno 2  No such file or directory: '/root/.indy/sandbox/last_version' Jan 23 11:30:16 californiaQALive1.qatest.evernym.com env 16689 : 2018-01-23 11:30:16,659 | WARNING | node_control_tool.py (172) | _restore_from_backup | Copying next_version failed due to  Errno 2  No such file or directory: '/root/.indy/sandbox/next_version' Jan 23 11:30:16 californiaQALive1.qatest.evernym.com env 16689 : 2018-01-23 11:30:16,659 | WARNING | node_control_tool.py (172) | _restore_from_backup | Copying upgrade_log failed due to  Errno 2  No such file or directory: '/root/.indy/sandbox/upgrade_log' Jan 23 11:30:16 californiaQALive1.qatest.evernym.com env 16689 : 2018-01-23 11:30:16,660 | WARNING | node_control_tool.py (172) | _restore_from_backup | Copying last_version_file failed due to  Errno 2  No such file or directory: '/root/.indy/sandbox/last_version_file' Jan 23 11:30:16 californiaQALive1.qatest.evernym.com env 16689 : 2018-01-23 11:30:16,660 | DEBUG | node_control_tool.py (192) | _remove_old_backups | Removing old backups Jan 23 11:30:16 californiaQALive1.qatest.evernym.com env 16689 : 2018-01-23 11:30:16,660 | ERROR | node_control_tool.py (250) | _declare_upgrade_failed | Upgrade from 1.2.213 to 1.2.279 failed:  Errno 2  No such file or directory: '/var/lib/indy/backup' Jan 23 11:30:16 californiaQALive1.qatest.evernym.com env 16689 : 2018-01-23 11:30:16,660 | ERROR | node_control_tool.py (226) | _upgrade | Trying to rollback to the previous version  Errno 2  No such file or directory: '/var/lib/indy/backup'{code} 2) Pool can't restore previous version: {code:java} Jan 23 11:30:23 californiaQALive1.qatest.evernym.com env 16689 : Reading package lists... Jan 23 11:30:23 californiaQALive1.qatest.evernym.com env 16689 : + apt-get --download-only -y --allow-downgrades --allow-change-held-packages install indy-anoncreds=1.0.32 indy-plenum=1.2.173 indy-node=1.2.213 Jan 23 11:30:24 californiaQALive1.qatest.evernym.com env 16689 : Reading package lists... Jan 23 11:30:24 californiaQALive1.qatest.evernym.com env 16689 : Building dependency tree... Jan 23 11:30:24 californiaQALive1.qatest.evernym.com env 16689 : Reading state information... Jan 23 11:30:24 californiaQALive1.qatest.evernym.com env 16689 : indy-anoncreds is already the newest version (1.0.32). Jan 23 11:30:24 californiaQALive1.qatest.evernym.com env 16689 : Some packages could not be installed. This may mean that you have Jan 23 11:30:24 californiaQALive1.qatest.evernym.com env 16689 : requested an impossible situation or if you are using the unstable Jan 23 11:30:24 californiaQALive1.qatest.evernym.com env 16689 : distribution that some required packages have not yet been created Jan 23 11:30:24 californiaQALive1.qatest.evernym.com env 16689 : or been moved out of Incoming. Jan 23 11:30:24 californiaQALive1.qatest.evernym.com env 16689 : The following information may help to resolve the situation: Jan 23 11:30:24 californiaQALive1.qatest.evernym.com env 16689 : The following packages have unmet dependencies: Jan 23 11:30:24 californiaQALive1.qatest.evernym.com env 16689 : indy-plenum : Depends: python3-indy-crypto (= 0.1.6) but 0.2.0 is to be installed Jan 23 11:30:24 californiaQALive1.qatest.evernym.com env 16689 : E: Unable to correct problems, you have held broken packages. Jan 23 11:30:24 californiaQALive1.qatest.evernym.com env 16689 : + ret=100 Jan 23 11:30:24 californiaQALive1.qatest.evernym.com env 16689 : + ' ' 100 -ne 0 ' ' Jan 23 11:30:24 californiaQALive1.qatest.evernym.com env 16689 : + echo 'Failed to obtain indy-anoncreds=1.0.32 indy-plenum=1.2.173 indy-node=1.2.213' Jan 23 11:30:24 californiaQALive1.qatest.evernym.com env 16689 : Failed to obtain indy-anoncreds=1.0.32 indy-plenum=1.2.173 indy-node=1.2.213{code} As result, pool upgraded to 1.2.279 version, indy-node was not started, pool is not able to restore 1.2.214 version.  *Expected Results:* Upgrade should work.  ></description> </Issue>
