<Issue id="43107" key="INDY-2280" number="2280" project="10303" reporter="ashcherbakov" assignee="vladimirwork" creator="ashcherbakov" type="10002" summary="Improve BLS signature performance" priority="3" resolution="10000" status="10001" created="2019-11-05 09:14:27.0" updated="2019-12-10 10:51:40.0" resolutiondate="2019-12-10 10:51:40.0" votes="0" watches="3" workflowId="56213"> <description><! CDATA Currently about 15% of all time is spent on validation of BLS signatures in Commits (see metrics below). One of the reason, is that we have to sign both Domain and Token states if FEEs are enabled.  *Acceptance Criteria* - Investigate how we can improve performance (INDY-2252 is one of the ways) - Do necessary fixes.  - Create follow-up tickets for further improvements if needed.   *Metrics* Start time: 2019-10-22 00:04:00 End time: 2019-10-22 00:14:00 Duration: 0:10:00 Number of messages processed in one looper run: Node:   236 samples, 94906.00 None, 26.00/402.14/1000.00 min/avg/max, 356.38 stddev Client: 236 samples, 5917.00 None, 4.00/25.07/51.00 min/avg/max, 10.70 stddev Seconds passed between looper runs: 236 samples, 591.61 None, 0.33/2.51/5.37 min/avg/max, 1.10 stddev Number of messages in one transport batch: 5808 samples, 341460.00 None, 2.00/58.79/134.00 min/avg/max, 28.76 stddev Node message size, bytes: Outgoing: 5808 samples, 240228528.00 None, 7028.00/41361.66/130387.00 min/avg/max, 25096.80 stddev Incoming: 94906 samples, 240158125.00 None, 53.00/2530.48/90366.00 min/avg/max, 5589.89 stddev Client message size, bytes: Outgoing: 11399 samples, 14249723.00 None, 81.00/1250.09/11572.00 min/avg/max, 1851.20 stddev Incoming: 5917 samples, 7277834.00 None, 644.00/1229.99/9478.00 min/avg/max, 1947.02 stddev Number of requests in one 3PC batch: Created: 521 samples, 5954.00 None, 0.00/11.43/28.00 min/avg/max, 3.48 stddev Ordered: 482 samples, 5477.00 None, 0.00/11.36/27.00 min/avg/max, 3.33 stddev Time spent on write request processing, ms: 10.59/16.06/264.80 ms min/avg/max, 4.32 stddev Monitor throughput, TPS Master: 8.22/9.53/10.31 min/avg/max, 0.45 stddev Backup: 8.26/9.51/10.17 min/avg/max, 0.44 stddev Monitor latency, seconds Master: 4.30/13.92/39.08 min/avg/max, 7.93 stddev Backup: 4.21/13.79/38.48 min/avg/max, 8.09 stddev RAM info: Available, Mb: 6504.41/6536.23/6540.99 min/avg/max, 5.75 stddev Node RSS, Mb: 1099.84/1103.71/1113.77 min/avg/max, 3.82 stddev Node VMS, Mb: 1542.84/1547.76/1550.84 min/avg/max, 3.93 stddev Additional statistics: Client incoming/outgoing: 0.52 messages, 0.51 traffic Node incoming/outgoing traffic: 1.00 Node/client traffic: 22.31 Node traffic per batch: 996652.81 Node traffic per request: 87709.81 Profiling info: BACKUP_REQUEST_PROCESSING_TIME : 45020 samples, 0.07 seconds, 0.00/0.00/0.05 ms min/avg/max, 0.00 stddev REQUEST_PROCESSING_TIME : 5954 samples, 95.62 seconds, 10.59/16.06/264.80 ms min/avg/max, 4.32 stddev GC_GEN0_TIME : 3898 samples, 1.28 seconds, 0.07/0.33/4.13 ms min/avg/max, 0.54 stddev GC_GEN1_TIME : 354 samples, 1.39 seconds, 1.78/3.94/6.34 ms min/avg/max, 0.91 stddev GC_GEN2_TIME : 32 samples, 8.28 seconds, 218.85/258.84/310.44 ms min/avg/max, 21.70 stddev NODE_PROD_TIME : 236 samples, 591.60 seconds, 328.18/2506.76/5371.07 ms min/avg/max, 1103.59 stddev SERVICE_REPLICAS_TIME : 236 samples, 331.08 seconds, 28.46/1402.89/3807.80 ms min/avg/max, 740.81 stddev SERVICE_NODE_MSGS_TIME : 236 samples, 199.49 seconds, 264.44/845.30/1594.13 ms min/avg/max, 311.43 stddev SERVICE_CLIENT_MSGS_TIME : 236 samples, 9.70 seconds, 9.56/41.09/120.63 ms min/avg/max, 18.61 stddev SERVICE_NODE_ACTIONS_TIME : 236 samples, 2.68 seconds, 0.01/11.35/70.10 ms min/avg/max, 20.99 stddev SERVICE_VIEW_CHANGER_TIME : 236 samples, 0.01 seconds, 0.03/0.03/0.07 ms min/avg/max, 0.01 stddev SERVICE_OBSERVABLE_TIME : 236 samples, 0.02 seconds, 0.01/0.10/0.26 ms min/avg/max, 0.05 stddev SERVICE_OBSERVER_TIME : 236 samples, 0.00 seconds, 0.01/0.01/0.03 ms min/avg/max, 0.00 stddev FLUSH_OUTBOXES_TIME : 236 samples, 48.27 seconds, 22.03/204.52/523.24 ms min/avg/max, 108.24 stddev SERVICE_NODE_LIFECYCLE_TIME : 236 samples, 1.25 seconds, 2.29/5.30/16.60 ms min/avg/max, 1.52 stddev SERVICE_CLIENT_STACK_TIME : 236 samples, 0.29 seconds, 0.21/1.21/3.04 ms min/avg/max, 0.51 stddev SERVICE_MONITOR_ACTIONS_TIME : 236 samples, 0.01 seconds, 0.00/0.03/1.09 ms min/avg/max, 0.12 stddev SERVICE_TIMERS_TIME : 236 samples, 0.01 seconds, 0.01/0.05/0.46 ms min/avg/max, 0.10 stddev SERVICE_NODE_STACK_TIME : 236 samples, 149.57 seconds, 187.95/633.75/1286.02 ms min/avg/max, 247.05 stddev PROCESS_NODE_INBOX_TIME : 236 samples, 49.91 seconds, 73.57/211.49/323.07 ms min/avg/max, 68.53 stddev SEND_TO_REPLICA_TIME : 233458 samples, 2.69 seconds, 0.01/0.01/0.15 ms min/avg/max, 0.00 stddev NODE_CHECK_PERFORMANCE_TIME : 52 samples, 0.04 seconds, 0.59/0.74/1.08 ms min/avg/max, 0.14 stddev NODE_CHECK_NODE_REQUEST_SPIKE : 10 samples, 0.00 seconds, 0.02/0.03/0.04 ms min/avg/max, 0.01 stddev UNPACK_BATCH_TIME : 59490 samples, 122.06 seconds, 0.19/2.05/313.04 ms min/avg/max, 6.12 stddev VERIFY_SIGNATURE_TIME : 142496 samples, 15.47 seconds, 0.01/0.11/236.43 ms min/avg/max, 0.66 stddev SERVICE_REPLICAS_OUTBOX_TIME : 236 samples, 13.09 seconds, 0.52/55.48/174.41 ms min/avg/max, 36.29 stddev NODE_SEND_TIME : 15602 samples, 1.36 seconds, 0.04/0.09/1.27 ms min/avg/max, 0.04 stddev NODE_SEND_REJECT_TIME : no samples VALIDATE_NODE_MSG_TIME : 429527 samples, 116.12 seconds, 0.05/0.27/311.31 ms min/avg/max, 2.20 stddev INT_VALIDATE_NODE_MSG_TIME : 429527 samples, 51.20 seconds, 0.03/0.12/310.87 ms min/avg/max, 2.15 stddev PROCESS_ORDERED_TIME : 4605 samples, 11.98 seconds, 0.04/2.60/64.74 ms min/avg/max, 7.78 stddev MONITOR_REQUEST_ORDERED_TIME : 4605 samples, 0.56 seconds, 0.02/0.12/0.73 ms min/avg/max, 0.09 stddev EXECUTE_BATCH_TIME : 482 samples, 11.22 seconds, 0.99/23.28/64.10 ms min/avg/max, 9.13 stddev SERVICE_REPLICA_QUEUES_TIME : 236 samples, 281.30 seconds, 2.63/1191.94/3411.61 ms min/avg/max, 668.92 stddev SERVICE_BACKUP_REPLICAS_QUEUES_TIME : 1888 samples, 36.64 seconds, 1.35/19.41/303.59 ms min/avg/max, 14.13 stddev PROCESS_PREPREPARE_TIME : 521 samples, 162.39 seconds, 2.01/311.69/799.74 ms min/avg/max, 146.81 stddev PROCESS_PREPARE_TIME : 14365 samples, 55.33 seconds, 0.01/3.85/415.72 ms min/avg/max, 27.95 stddev PROCESS_COMMIT_TIME : 14526 samples, 167.67 seconds, 0.01/11.54/89.20 ms min/avg/max, 10.89 stddev PROCESS_CHECKPOINT_TIME : 114 samples, 0.33 seconds, 0.10/2.92/125.58 ms min/avg/max, 14.42 stddev SEND_PREPREPARE_TIME : no samples SEND_PREPARE_TIME : 521 samples, 0.18 seconds, 0.26/0.35/3.76 ms min/avg/max, 0.16 stddev SEND_COMMIT_TIME : 462 samples, 1.50 seconds, 2.12/3.24/12.12 ms min/avg/max, 0.97 stddev SEND_CHECKPOINT_TIME : 5 samples, 0.00 seconds, 0.25/0.25/0.26 ms min/avg/max, 0.00 stddev CREATE_3PC_BATCH_TIME : no samples ORDER_3PC_BATCH_TIME : 482 samples, 5.49 seconds, 7.84/11.38/38.69 ms min/avg/max, 2.76 stddev BACKUP_PROCESS_PREPREPARE_TIME : 4256 samples, 14.71 seconds, 0.69/3.46/274.13 ms min/avg/max, 5.33 stddev BACKUP_PROCESS_PREPARE_TIME : 145205 samples, 17.57 seconds, 0.01/0.12/271.80 ms min/avg/max, 0.93 stddev BACKUP_PROCESS_COMMIT_TIME : 145781 samples, 12.65 seconds, 0.01/0.09/137.15 ms min/avg/max, 0.49 stddev BACKUP_PROCESS_CHECKPOINT_TIME : 1058 samples, 1.02 seconds, 0.09/0.96/79.24 ms min/avg/max, 5.37 stddev BACKUP_SEND_PREPREPARE_TIME : no samples BACKUP_SEND_PREPARE_TIME : 4256 samples, 0.59 seconds, 0.11/0.14/4.57 ms min/avg/max, 0.07 stddev BACKUP_SEND_COMMIT_TIME : 2994 samples, 0.51 seconds, 0.09/0.17/55.01 ms min/avg/max, 1.05 stddev BACKUP_SEND_CHECKPOINT_TIME : 40 samples, 0.01 seconds, 0.17/0.19/0.25 ms min/avg/max, 0.02 stddev BACKUP_CREATE_3PC_BATCH_TIME : no samples BACKUP_ORDER_3PC_BATCH_TIME : 4123 samples, 2.92 seconds, 0.39/0.71/137.03 ms min/avg/max, 2.95 stddev PROCESS_PROPAGATE_TIME : 136579 samples, 33.41 seconds, 0.14/0.24/9.34 ms min/avg/max, 0.13 stddev PROCESS_MESSAGE_REQ_TIME : no samples PROCESS_MESSAGE_REP_TIME : 1115 samples, 0.25 seconds, 0.13/0.22/0.93 ms min/avg/max, 0.09 stddev PROCESS_LEDGER_STATUS_TIME : no samples PROCESS_CONSISTENCY_PROOF_TIME : no samples PROCESS_CATCHUP_REQ_TIME : no samples PROCESS_CATCHUP_REP_TIME : no samples PROCESS_REQUEST_TIME : 5917 samples, 2.50 seconds, 0.20/0.42/7.38 ms min/avg/max, 0.23 stddev SEND_PROPAGATE_TIME : 5917 samples, 2.23 seconds, 0.24/0.38/1.15 ms min/avg/max, 0.11 stddev SEND_MESSAGE_REQ_TIME : 5386 samples, 0.38 seconds, 0.02/0.07/8.47 ms min/avg/max, 0.14 stddev SEND_MESSAGE_REP_TIME : no samples BLS_VALIDATE_PREPREPARE_TIME : 4777 samples, 11.64 seconds, 0.00/2.44/67.94 ms min/avg/max, 8.04 stddev BLS_VALIDATE_COMMIT_TIME : 77201 samples, 160.54 seconds, 0.00/2.08/69.12 ms min/avg/max, 6.20 stddev BLS_UPDATE_PREPREPARE_TIME : no samples BLS_UPDATE_COMMIT_TIME : 462 samples, 1.39 seconds, 1.95/3.00/6.25 ms min/avg/max, 0.86 stddev DESERIALIZE_DURING_UNPACK_TIME : no samples  ></description> </Issue>
