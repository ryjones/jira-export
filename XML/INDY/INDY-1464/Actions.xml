<Action id="47196" issue="31774" author="anikitindsr" type="comment" created="2018-07-11 08:27:23.0" updateauthor="anikitindsr" updated="2018-07-11 08:38:50.0"> <body><! CDATA Some code investigation showed, that problem was in processing MessageResponse for PROPAGATE. MessageResponse has field 'params' and 'msg', which contain digest in 'params' section and request in msg. Therefore, the main assumption is that there is bug in MessageResponse building.  Traceback for this AttributeError is: Jul 11 06:14:25 virginaQALive.qatest.evernym.com env 3208 : Traceback (most recent call last): Jul 11 06:14:25 virginaQALive.qatest.evernym.com env 3208 : File "/usr/local/bin/start_indy_node", line 19, in <module> Jul 11 06:14:25 virginaQALive.qatest.evernym.com env 3208 : client_ip=sys.argv 4 , client_port=int(sys.argv 5 )) Jul 11 06:14:25 virginaQALive.qatest.evernym.com env 3208 : File "/usr/local/lib/python3.5/dist-packages/indy_node/utils/node_runner.py", line 54, in run_node Jul 11 06:14:25 virginaQALive.qatest.evernym.com env 3208 : looper.run() Jul 11 06:14:25 virginaQALive.qatest.evernym.com env 3208 : File "/usr/local/lib/python3.5/dist-packages/stp_core/loop/looper.py", line 263, in run Jul 11 06:14:25 virginaQALive.qatest.evernym.com env 3208 : return self.loop.run_until_complete(what) Jul 11 06:14:25 virginaQALive.qatest.evernym.com env 3208 : File "/usr/lib/python3.5/asyncio/base_events.py", line 387, in run_until_complete Jul 11 06:14:25 virginaQALive.qatest.evernym.com env 3208 : return future.result() Jul 11 06:14:25 virginaQALive.qatest.evernym.com env 3208 : File "/usr/lib/python3.5/asyncio/futures.py", line 274, in result Jul 11 06:14:25 virginaQALive.qatest.evernym.com env 3208 : raise self._exception Jul 11 06:14:25 virginaQALive.qatest.evernym.com env 3208 : File "/usr/lib/python3.5/asyncio/tasks.py", line 239, in _step Jul 11 06:14:25 virginaQALive.qatest.evernym.com env 3208 : result = coro.send(None) Jul 11 06:14:25 virginaQALive.qatest.evernym.com env 3208 : File "/usr/local/lib/python3.5/dist-packages/stp_core/loop/looper.py", line 227, in runForever Jul 11 06:14:25 virginaQALive.qatest.evernym.com env 3208 : await self.runOnceNicely() Jul 11 06:14:25 virginaQALive.qatest.evernym.com env 3208 : File "/usr/local/lib/python3.5/dist-packages/stp_core/loop/looper.py", line 210, in runOnceNicely Jul 11 06:14:25 virginaQALive.qatest.evernym.com env 3208 : msgsProcessed = await self.prodAllOnce() Jul 11 06:14:25 virginaQALive.qatest.evernym.com env 3208 : File "/usr/local/lib/python3.5/dist-packages/stp_core/loop/looper.py", line 152, in prodAllOnce Jul 11 06:14:25 virginaQALive.qatest.evernym.com env 3208 : s += await n.prod(limit) Jul 11 06:14:25 virginaQALive.qatest.evernym.com env 3208 : File "/usr/local/lib/python3.5/dist-packages/indy_node/server/node.py", line 297, in prod Jul 11 06:14:25 virginaQALive.qatest.evernym.com env 3208 : c = await super().prod(limit) Jul 11 06:14:25 virginaQALive.qatest.evernym.com env 3208 : File "/usr/local/lib/python3.5/dist-packages/plenum/server/node.py", line 1046, in prod Jul 11 06:14:25 virginaQALive.qatest.evernym.com env 3208 : c += await self.serviceNodeMsgs(limit) Jul 11 06:14:25 virginaQALive.qatest.evernym.com env 3208 : File "/usr/local/lib/python3.5/dist-packages/plenum/server/node.py", line 1080, in serviceNodeMsgs Jul 11 06:14:25 virginaQALive.qatest.evernym.com env 3208 : await self.processNodeInBox() Jul 11 06:14:25 virginaQALive.qatest.evernym.com env 3208 : File "/usr/local/lib/python3.5/dist-packages/plenum/server/node.py", line 1642, in processNodeInBox Jul 11 06:14:25 virginaQALive.qatest.evernym.com env 3208 : await self.nodeMsgRouter.handle(m) Jul 11 06:14:25 virginaQALive.qatest.evernym.com env 3208 : File "/usr/local/lib/python3.5/dist-packages/plenum/server/router.py", line 81, in handle Jul 11 06:14:25 virginaQALive.qatest.evernym.com env 3208 : res = self.handleSync(msg) Jul 11 06:14:25 virginaQALive.qatest.evernym.com env 3208 : File "/usr/local/lib/python3.5/dist-packages/plenum/server/router.py", line 70, in handleSync Jul 11 06:14:25 virginaQALive.qatest.evernym.com env 3208 : return self.getFunc(msg 0 )(*msg) Jul 11 06:14:25 virginaQALive.qatest.evernym.com env 3208 : File "/usr/local/lib/python3.5/dist-packages/plenum/server/message_req_processor.py", line 51, in process_message_re Jul 11 06:14:25 virginaQALive.qatest.evernym.com env 3208 : return handler.process(msg, frm) Jul 11 06:14:25 virginaQALive.qatest.evernym.com env 3208 : File "/usr/local/lib/python3.5/dist-packages/plenum/server/message_handlers.py", line 63, in process Jul 11 06:14:25 virginaQALive.qatest.evernym.com env 3208 : return self.processor(valid_msg, params, frm) Jul 11 06:14:25 virginaQALive.qatest.evernym.com env 3208 : File "/usr/local/lib/python3.5/dist-packages/plenum/server/message_handlers.py", line 238, in processor Jul 11 06:14:25 virginaQALive.qatest.evernym.com env 3208 : self.node.processPropagate(validated_msg, frm) Jul 11 06:14:25 virginaQALive.qatest.evernym.com env 3208 : File "/usr/local/lib/python3.5/dist-packages/plenum/server/node.py", line 2215, in processPropagate Jul 11 06:14:25 virginaQALive.qatest.evernym.com env 3208 : reqDict = msg.request Jul 11 06:14:25 virginaQALive.qatest.evernym.com env 3208 : AttributeError: 'NoneType' object has no attribute 'request'  ></body> </Action>
<Action id="47255" issue="31774" author="ashcherbakov" type="comment" created="2018-07-12 08:41:23.0" updateauthor="ashcherbakov" updated="2018-07-12 08:41:23.0"> <body><! CDATA Problem reason: - Client Request class is overridden in IndyNode. IndyNode's Request overrides calculation of digests for ATTRIB txns - Propagate requestor used Request class of IndyPlenum which calculated digest for ATTRIB differently.  - Propagate requestor compared digests, they were different, and returned None. The code didn't expect None there. - Additionally found: incorrect Request class (from Plenum) is used in `reqToTxn` method. - Additionally found: a bug in SigningSerializer (INDY-1469)  Changes:  - use correct Request class when processing requested PROPAGATE (since request class is overridden in indy-node) - use correct Request class in `reqToTxn` - fixed a small issue in SigningSerializer - added tests for SigningSerializer (there is an issue there: INDY-1469) - added tests for PROPGATE requests of ATTRIB, NYM, SCHEMA and CLAIM_DEF - handle None values as result of request  PR: - https://github.com/hyperledger/indy-plenum/pull/807 - https://github.com/hyperledger/indy-node/pull/816  Version: - master Indy Node 1.4.500  Risk factors: - ATTRIB txns  Risk: - Low  Covered with tests: - test_attrib_txn_digest.py - test_request_propagates.py  Recommendations for QA: - Run load tests with ATTRIB txns   ></body> </Action>
<Action id="47352" issue="31774" author="zhigunenko.dsr" type="comment" created="2018-07-16 13:05:17.0" updateauthor="zhigunenko.dsr" updated="2018-07-16 13:05:17.0"> <body><! CDATA *Environment:* indy-node 1.4.500 libindy 1.5.610  *Steps to Validate:* Run load tests with ATTRIB txns  *Actual results:* ATTRIB txns have been read and written successfully  ></body> </Action>
