<Issue id="17080" key="INDY-14" number="14" project="10303" reporter="lovesh" assignee="lovesh" creator="krw910" type="10002" summary="The Pre-Prepare needs to have both pre state root and post state root. Also reverting the state root needs to happen reactively." priority="4" resolution="10001" status="10001" created="2017-05-24 21:02:20.0" updated="2019-10-09 09:48:44.0" resolutiondate="2019-10-09 09:48:44.0" votes="0" watches="4" workflowId="17084"> <description><! CDATA Currently a primary reverts PRE-PREPARE when it sees that those will not have consensus and the view will change but this needs to stop. The PRE-PREPARE will contain state roots for both before applying it and after applying it. That information should be used to revert, eg: If B has applied 7, but ordered is 6, then it's uncommitted root hash will be 7 and it's committed root will be 6. When a new primary sends a new batch 7, then B checks if the post-hash in the PRE-PREPARE is the same as it's uncommitted root hash. If they are different, then B reverts the uncommitted back to committed root hash, and then applies batch 7. If they are the same, then it considers batch 7 already applied. A benefit that these pre-roots give us is a way to prove the maliciousness of the primary since if a primary is sending correct pre-root and incorrect post root, it is malicious and since the messages would be signed, they serve as a proof. POA https://docs.google.com/document/d/1KixMMdD7cMfaA4yg-ghL72LEESOkcP8TPccvRrhgW5U/edit  ></description> </Issue>
