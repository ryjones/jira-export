<Action id="41793" issue="27709" author="toktar" type="comment" created="2018-03-19 09:57:58.0" updateauthor="toktar" updated="2018-04-13 11:30:35.0"> <body><! CDATA Input transaction format: {code:java} {'reqId': 98262, 'signature': 'cNAkmqSySHTckJg5rhtdyda3z1fQcV6ZVo1rvcd8mKmm7Fn4hnRChebts1ur7rGPrXeF1Q3B9N7PATYzwQNzdZZ', 'protocolVersion': 1, 'identifier': 'M9BJDuS24bqbJNvBRsoGg3', 'operation': {         'datetime': '2018-03-29T15:38:34.464106+00:00',         'action': 'start',         'type': '118'         } }{code} Input transaction example: {code:java} {'op': 'REPLY', 'result': {         'reqId': 98262,         'isSuccess': True,         'type': '118',         'identifier': 'M9BJDuS24bqbJNvBRsoGg3',         'msg': None         } }{code}  ></body> </Action>
<Action id="42906" issue="27709" author="toktar" type="comment" created="2018-04-13 11:29:04.0" updateauthor="toktar" updated="2018-04-13 11:29:04.0"> <body><! CDATA PR:  https://github.com/hyperledger/indy-node/pull/624  * Added mechanism of restart command *  Changed the architecture of handler classes. An abstraction has been added for separating handlers for action transactions and writing and reading transactions *  Above the classes restarter and upgrader is created an abstract class to avoid duplication of code.  ></body> </Action>
<Action id="43154" issue="27709" author="toktar" type="comment" created="2018-04-19 14:56:46.0" updateauthor="toktar" updated="2018-04-19 14:58:15.0"> <body><! CDATA Problem reason: Trustee can't restart all nodes in the some time.  Changes:  Added mechanism of restart command Changed the architecture of handler classes. An abstraction has been added for separating handlers for action transactions and writing and reading transactions Above the classes restarter and upgrader is created an abstract class to avoid duplication of code. PR: *  https://github.com/hyperledger/indy-plenum/pull/582  *  https://github.com/hyperledger/indy-node/pull/624   Version: * indy-plenum 1.2.319-master * indy-node 1.3.380-master  Risk factors: * Problems with upgrade and handling message can be found.  Risk: * Medium  Covered with tests: *  test_node_control_tool_for_restart.py|https://github.com/hyperledger/indy-node/blob/master/indy_node/test/pool_restart/test_node_control_tool_for_restart.py  *  test_pool_restart.py|https://github.com/hyperledger/indy-node/blob/master/indy_node/test/pool_restart/test_pool_restart.py  *  test_restart_log.py|https://github.com/hyperledger/indy-node/blob/master/indy_node/test/pool_restart/test_restart_log.py   Recommendations for QA: * POOL_UPGRADE and receiving may not work correctly. They need testing. * POOL_RESTART can have a small delay between nodes due to network features. The documentation for the restart command - https://github.com/hyperledger/indy-node/blob/master/design/pool_restart_txn.md * A restart is not a transaction and is not written to the ladder.  ></body> </Action>
<Action id="43416" issue="27709" author="zhigunenko.dsr" type="comment" created="2018-04-25 13:48:09.0" updateauthor="zhigunenko.dsr" updated="2018-04-25 13:48:09.0"> <body><! CDATA *Environment:* indy-plenum=1.2.323 indy-node=1.3.382  *Reason for rejection* Steps to reproduce: 1) run pool with 4 nodes 2) execute  {code} ledger pool-upgrade name=upgrade-383 version=1.3.383 action=start sha256=f284bdc3c1c9e24a494e285cb387c69510f28de51c15bb93179d9c7f28705388 schedule={"Gw6pDLhcBcoQesN72qfotTgFa7cbuqZpkX3Xo6pLhPhv":"2018-04-25T13:31:00+00:00","8ECVSk179mjsjKRLWiQtssMLgp6EPhWXtaYyStWPSGAb":"2018-04-25T13:31:00+00:00","DKVxG2fXXTU8yT5N7hGEbXB3dfdAnYv1JczDUHpmDxya":"2018-04-25T13:31:00+00:00","4PS3EDQ3dW1tci1Bp6543CfuuebjFrg36kLAUcskGfaA":"2018-04-25T13:31:00+00:00"} force=true {code} Actual results: Nodes are rebooted but still have 1.3.382 version   Logs|https://drive.google.com/open?id=1ZCgDm-SbBVixxxPhHr1ELU8HfvUmwtjR   *Additional info:* These cases are succesful: * action=start with timestamp in future * action=start with timestamp in past * double-sending action=start (pool have restarted in the last sent timestamp) * action=cancel with same timestamp (restart cancelled) * action=cancel with wrong timestamp (restart cancelled)  ></body> </Action>
<Action id="43444" issue="27709" author="toktar" type="comment" created="2018-04-25 21:59:34.0" updateauthor="toktar" updated="2018-04-25 22:01:43.0"> <body><! CDATA  ~zhigunenko.dsr , It's the old problem with base 58, could be fixed in the last versions. Please, retry this  case again with last version.   {code:java} Apr 25 13:26:23 40b7012e39aa env 720 : indy-plenum : Depends: python3-base58 (= 0.2.5) but 0.2.4 is to be installed {code}    ></body> </Action>
<Action id="43741" issue="27709" author="ozheregelya" type="comment" created="2018-05-02 18:57:25.0" updateauthor="ozheregelya" updated="2018-05-02 18:57:25.0"> <body><! CDATA TGB member is able to restart the pool. Is it expected behavior? {code:java} pool(p1):wallet(wa):did(V4S...e6f):indy> ledger nym did=M2wWfkx2WFEFQgzTSnv9cm role=TGB verkey=~RtCDJNb6qrihuAmSvJyn8w Nym request has been sent to Ledger. Metadata: +---------------------+---------------------+ | Request ID | Transaction time | +---------------------+---------------------+ | 1525287221943132979 | 2018-05-02 18:53:41 | +---------------------+---------------------+ Data: +------------------------+-------------------------+------+ | Did | Verkey | Role | +------------------------+-------------------------+------+ | M2wWfkx2WFEFQgzTSnv9cm | ~RtCDJNb6qrihuAmSvJyn8w | TGB | +------------------------+-------------------------+------+ pool(p1):wallet(wa):did(V4S...e6f):indy> did use M2wWfkx2WFEFQgzTSnv9cm Did "M2wWfkx2WFEFQgzTSnv9cm" has been set as active pool(p1):wallet(wa):did(M2w...9cm):indy> ledger pool-restart action=start datetime=0 Restart pool request has been sent to Ledger. Metadata: +------------------------+---------------------+ | Identifier | Request ID | +------------------------+---------------------+ | M2wWfkx2WFEFQgzTSnv9cm | 1525287235665722374 | +------------------------+---------------------+ Data: +--------+----------+ | Action | Datetime | +--------+----------+ | start | 0 | +--------+----------+ pool(p1):wallet(wa):did(M2w...9cm):indy> ledger pool-restart action=cancel datetime=0 Restart pool request has been sent to Ledger. Metadata: +------------------------+---------------------+ | Identifier | Request ID | +------------------------+---------------------+ | M2wWfkx2WFEFQgzTSnv9cm | 1525287377625071365 | +------------------------+---------------------+ Data: +--------+----------+ | Action | Datetime | +--------+----------+ | cancel | 0 | +--------+----------+ {code}  ></body> </Action>
<Action id="43744" issue="27709" author="ozheregelya" type="comment" created="2018-05-02 20:02:28.0" updateauthor="ozheregelya" updated="2018-05-02 20:02:55.0"> <body><! CDATA *Environment:* indy-node=1.3.396 AWS pool of 4 nodes  *Reasons for Rejection:* *Case 1:* 1. Send cancellation of pool-restart with datetime=0 or datetime=2007-05-02T19:35:00.000000+00:00 {code:java} ledger pool-restart action=cancel datetime=0{code}    *Actual Results:* Pool is restarted right after sending the command, `cancel` record was not written to the restart_log.  *Expected Results:* Pool should not restart if the action is `cancel`, `cancel` record should be written to the restart_log.  *Case 2* (may be it's ok): 1. Send pool-restart to the future. 2. Send pool-restart with datetime=0 or to the past. 3. Send pool-restart to the future.  *Actual Result:* `Cancel` was not written for pool-upgrade from step 1.  *Expected Result:* First pool-upgrade should be cancelled. ( ? ) (At least steward will be confused looking into restart_log.)  ></body> </Action>
<Action id="43808" issue="27709" author="toktar" type="comment" created="2018-05-04 09:25:55.0" updateauthor="toktar" updated="2018-05-07 07:42:02.0"> <body><! CDATA *Problem reason:* * `Cancel` was not written for sequence: future restart, now restart, future restart * restart node with command for cancel without time * TGB should not have permission to restart pool * SDK send commands with datetime=""  *Changes:* * removed permission to restart pool by TGB * fixed restart with cancel command * added opportunity to send restart command with datetime="" * added cancel of previous restart action to restart now  *PR:* *  https://github.com/hyperledger/indy-node/pull/684   *Version:* * indy-node 1.3.404-master  *Risk factors:* * Problems with restart now can be found.  *Risk:* * Low  *Covered with tests:* *  test_pool_restart.py|https://github.com/hyperledger/indy-node/blob/master/indy_node/test/pool_restart/test_pool_restart.py   ></body> </Action>
<Action id="43998" issue="27709" author="zhigunenko.dsr" type="comment" created="2018-05-07 14:37:48.0" updateauthor="zhigunenko.dsr" updated="2018-05-07 14:37:48.0"> <body><! CDATA *Environment:* indy-anoncreds 1.0.32 indy-cli 1.4.0~21 indy-node 1.3.404 indy-plenum 1.2.347 libindy 1.3.1~505 libindy-crypto 0.4.0 python3-indy-crypto 0.4.0  *Reason for rejection:* There is problem if _datetime_ omitted  *Additional info:* These cases are valid: 1) action=start with timestamp in future (also with timezone shifting) 2) action=start with timestamp in past (also with datetime = 0) 3) double-sending action=start (pool have restarted in the last sent timestamp) 4) action=cancel with same timestamp (restart cancelled) 5) action=cancel with wrong timestamp or datetime = 0 (restart cancelled) 6) future restart, now restart, future restart - all cancellations have logged 7) Steward and TGB should not have permission to restart pool  ></body> </Action>
<Action id="44167" issue="27709" author="toktar" type="comment" created="2018-05-10 09:42:03.0" updateauthor="toktar" updated="2018-05-10 09:42:03.0"> <body><! CDATA *Problem reason:* * SDK send commands with datetime="", it's invalid message for node  *Changes:* * added opportunity to send restart command with datetime="". Added field type for datetime and its validation.  *PR:* *  https://github.com/hyperledger/indy-plenum/pull/670  *  https://github.com/hyperledger/indy-node/pull/688   *Version:* * indy-node 1.3.407-master * indy-plenum 1.2.353-master  *Risk factors:* * Problems with client messages validation  *Risk:* * Low  *Covered with tests:* *  test_pool_restart.py|https://github.com/hyperledger/indy-node/blob/master/indy_node/test/pool_restart/test_pool_restart.py  *  test_fail_pool_restart.py|https://github.com/hyperledger/indy-node/blob/master/indy_node/test/pool_restart/test_fail_pool_restart.py   ></body> </Action>
<Action id="44189" issue="27709" author="vladimirwork" type="comment" created="2018-05-10 14:48:16.0" updateauthor="vladimirwork" updated="2018-05-10 14:48:16.0"> <body><! CDATA Build Info: indy-node 1.3.407  Steps to Validate: 1. Send restart command with datetime omitted.  Actual Results: Pool restarts right after command is sent.  Additional Info: All cases from https://jira.hyperledger.org/browse/INDY-1173?focusedCommentId=43998&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-43998 are rechecked to avoid regression issues.  ></body> </Action>
