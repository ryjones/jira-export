<Action id="45870" issue="30733" author="ashcherbakov" type="comment" created="2018-06-13 12:52:50.0" updateauthor="ashcherbakov" updated="2018-06-14 06:57:14.0"> <body><! CDATA Problem reason: * we need to be able to created multiple CRED_DEF for the same Schema by the same Issuer. In order to support this, a new attribute needs to be added to the CRED_DEF key in state trie. Since this is a breaking change, we did it in the scope of 1.4  Changes: * added optional {{tag}} field to CLAIM_DEF * use utility methods for SCHEMA and CLAIM_DEF * added more tests * doc is updated (requests.md and transactions.md)  PR: Â  https://github.com/hyperledger/indy-node/pull/755  https://github.com/hyperledger/indy-node/pull/760  |https://github.com/hyperledger/indy-node/pull/755 |  Version: - master 1.4.453  Risk factors: - CRED_DEF txn and request (write and get) - SCHEMA txn and request (write and get)  Risk: - Low  Covered with tests: - test_req_utils_schema - test_req_utils_claim_def - test_state_path - fixes and improvements in existing tests  Recommendations for QA - make sure that SCHEMA and CRED_DEF write and read work - there is no way to test that a new `tag` parameter works now from CLI. A default tag is set is it's not set explicitly in a request.  ></body> </Action>
<Action id="45922" issue="30733" author="zhigunenko.dsr" type="comment" created="2018-06-14 12:38:32.0" updateauthor="zhigunenko.dsr" updated="2018-06-14 12:38:32.0"> <body><! CDATA *Environment:* indy-cli 1.4.0~566 indy-node 1.4.457  *Steps to Validate:* 1. Create new schema 2. Read created schema 3 .Modify schema 4. Read schema again 5. Create cred-def 6. Read cred-def 7. Modify cred-def JSON 8. Read cred-def again  *Actual Results:* All changes have been written successfully  ></body> </Action>
<Action id="46107" issue="30733" author="anikitindsr" type="comment" created="2018-06-18 12:45:01.0" updateauthor="anikitindsr" updated="2018-06-18 12:45:01.0"> <body><! CDATA Need to test migration for indy-node with following steps: * install indy-node ( < 1.3.428) * write some REVOC_REG_DEF transactions * do upgrade to version 1.4.464 * check, that migration was successfully done and previous written REVOC_REG_DEF transacions can be read from pool.  ></body> </Action>
<Action id="46388" issue="30733" author="vladimirwork" type="comment" created="2018-06-21 15:34:12.0" updateauthor="vladimirwork" updated="2018-06-21 15:34:12.0"> <body><! CDATA Build Info: indy-node 1.3.375 -> 1.4.470  Steps to Reproduce: 1. Install pool 1.3.375 master. 2. Send REVOC_REG_DEF and REVOC_REG_ENTRY txns to ledger. 3. Upgrade pool to 1.4.470 master. 4. Check `journalctl -ex`.  Actual Results: {noformat} Jun 21 13:43:46 7605f1e9ecb8 env 3658 : Traceback (most recent call last): Jun 21 13:43:46 7605f1e9ecb8 env 3658 :   File "/usr/local/bin/start_indy_node", line 19, in <module> Jun 21 13:43:46 7605f1e9ecb8 env 3658 :     client_ip=sys.argv 4 , client_port=int(sys.argv 5 )) Jun 21 13:43:46 7605f1e9ecb8 env 3658 :   File "/usr/local/lib/python3.5/dist-packages/indy_node/utils/node_runner.py", line 54, in run_node Jun 21 13:43:46 7605f1e9ecb8 env 3658 :     ha=node_ha, cliha=client_ha) Jun 21 13:43:46 7605f1e9ecb8 env 3658 :   File "/usr/local/lib/python3.5/dist-packages/indy_node/server/node.py", line 94, in __init__ Jun 21 13:43:46 7605f1e9ecb8 env 3658 :     config=config) Jun 21 13:43:46 7605f1e9ecb8 env 3658 :   File "/usr/local/lib/python3.5/dist-packages/plenum/server/node.py", line 205, in __init__ Jun 21 13:43:46 7605f1e9ecb8 env 3658 :     self.initDomainState() Jun 21 13:43:46 7605f1e9ecb8 env 3658 :   File "/usr/local/lib/python3.5/dist-packages/plenum/server/node.py", line 2804, in initDomainState Jun 21 13:43:46 7605f1e9ecb8 env 3658 :     self.domainLedger, self.get_req_handler(DOMAIN_LEDGER_ID)) Jun 21 13:43:46 7605f1e9ecb8 env 3658 :   File "/usr/local/lib/python3.5/dist-packages/plenum/server/node.py", line 2799, in initStateFromLedger Jun 21 13:43:46 7605f1e9ecb8 env 3658 :     reqHandler.updateState( txn,  , isCommitted=True) Jun 21 13:43:46 7605f1e9ecb8 env 3658 :   File "/usr/local/lib/python3.5/dist-packages/plenum/server/domain_req_handler.py", line 69, in updateState Jun 21 13:43:46 7605f1e9ecb8 env 3658 :     self._updateStateWithSingleTxn(txn, isCommitted=isCommitted) Jun 21 13:43:46 7605f1e9ecb8 env 3658 :   File "/usr/local/lib/python3.5/dist-packages/indy_node/server/domain_req_handler.py", line 72, in _updateStateWithSingleTxn Jun 21 13:43:46 7605f1e9ecb8 env 3658 :     self.state_update_handlers txn_type (txn, isCommitted) Jun 21 13:43:46 7605f1e9ecb8 env 3658 :   File "/usr/local/lib/python3.5/dist-packages/indy_node/server/domain_req_handler.py", line 778, in _addRevocRegEntry Jun 21 13:43:46 7605f1e9ecb8 env 3658 :     req_id=get_req_id(txn) Jun 21 13:43:46 7605f1e9ecb8 env 3658 :   File "/usr/local/lib/python3.5/dist-packages/indy_node/server/domain_req_handler.py", line 334, in _get_current_revoc_entry_and_revoc_def Jun 21 13:43:46 7605f1e9ecb8 env 3658 :     "There is no any REVOC_REG_DEF by path: {}".format(revoc_reg_def_id)) Jun 21 13:43:46 7605f1e9ecb8 env 3658 : plenum.common.exceptions.InvalidClientRequest: InvalidClientRequest('There is no any REVOC_REG_DEF by path: 5YKabdJyAEDpAUwKGhwhhr:4:5YKabdJyAEDpAUwKGhwhhr:3:CL:48: Jun 21 13:43:46 7605f1e9ecb8 systemd 1 : indy-node.service: Main process exited, code=exited, status=1/FAILURE {noformat}  REVOC_REG_DEF and REVOC_REG_ENTRY before migration: {noformat}  50,{"credDefId":"5YKabdJyAEDpAUwKGhwhhr:3:CL:48","id":"5YKabdJyAEDpAUwKGhwhhr:4:5YKabdJyAEDpAUwKGhwhhr:3:CL:48:CL_ACCUM:tag","identifier":"5YKabdJyAEDpAUwKGhwhhr","reqId":1529587664836135531,"revocDefType":"CL_ACCUM","signature":"5PZXXvUXERLn87732Rd4YvCNen56VnVdRCFcZyN6iM1UuXk19ZfFGNwzzVxtadWCWT8fSBxYr6vVp8GZJsy19D1L","signatures":null,"tag":"tag","txnTime":1529587664,"type":"113","value":{"issuanceType":"ISSUANCE_ON_DEMAND","maxCredNum":10,"publicKeys":{"accumKey":{"z":"1279C06C12B5B4 EDAC0C50787B80 71E0FB8D721708 1DF3ACC7F662B6 6A17E6A 6B0C5FDB018AB8 1B3DA9606B28F C64F437386E28F FF1339D9A8DB91 2373714 94660DE158F294 846C6EEDE688A8 86D79CE45B4B3A DC9BA0C3207FAF 29E633C BD6017C76F7EC5 BE2B47069A49CD B351D27F4DCDB0 D5E80795C3AE02 1F9BA234 8F7A711E9CC9F4 998E066B1390F1 E0E9DBD991DAC0 92AA1AB5686CCB 5EA5CD 532C2B60C22875 430E80EE85042F B9FC830EBDBC96 BAC68257A701E8 22B0217B ED6BC79DAB6534 DF72EECA97FF2A 91515778F6735C 3793D923624175 123EA4 DC3F4FFCE79E0D AD35E14FA56BC4 B941CBC949E756 AFF57CA00BDD7E 12AD584B 287AFE59932A91 FD3EACEE786F99 F4BD2A1AE0FC29 5EA078EE2ABB36 58483CD FE84CC49FE12EF 8669DFA153B409 F99F67DB34AA42 7A0A39AD21715C 98E50A8 349B90CA4FBE42 A29D3631C6780 FDD0B11EA84C11 F2080418316618 24468423 3E12E9C33763D1 336A01AC988D0F 1FFD575D7F9593 138407DB562A9B 17C045EC"}},"tailsHash":"7hcdv6iZvq4mfKbSQq8jrN5qjTvxHvmB5H4dm3mgjTj9","tailsLocation":"tails/7hcdv6iZvq4mfKbSQq8jrN5qjTvxHvmB5H4dm3mgjTj9"}}   51,{"identifier":"5YKabdJyAEDpAUwKGhwhhr","reqId":1529587665060067475,"revocDefType":"CL_ACCUM","revocRegDefId":"5YKabdJyAEDpAUwKGhwhhr:4:5YKabdJyAEDpAUwKGhwhhr:3:CL:48:CL_ACCUM:tag","signature":"62hB8nE2CymQZcE29kZeDR1gk73M8yEiKA2dS7wSQgAm6rP1js4uA45uo9gvRnRxt3WbD2s5eNMM3MmBDt5sEnwL","signatures":null,"txnTime":1529587665,"type":"114","value":{"accum":"true 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0"}}  {noformat}   REVOC_REG_DEF and REVOC_REG_ENTRY after migration: {noformat} 50 {"reqSignature":{"type":"ED25519","values": {"from":"5YKabdJyAEDpAUwKGhwhhr","value":"5PZXXvUXERLn87732Rd4YvCNen56VnVdRCFcZyN6iM1UuXk19ZfFGNwzzVxtadWCWT8fSBxYr6vVp8GZJsy19D1L"} },"txn":{"data":{"credDefId":"5YKabdJyAEDpAUwKGhwhhr:3:CL:48:tag","id":"5YKabdJyAEDpAUwKGhwhhr:4:5YKabdJyAEDpAUwKGhwhhr:3:CL:48:CL_ACCUM:tag","revocDefType":"CL_ACCUM","tag":"tag","value":{"issuanceType":"ISSUANCE_ON_DEMAND","maxCredNum":10,"publicKeys":{"accumKey":{"z":"1279C06C12B5B4 EDAC0C50787B80 71E0FB8D721708 1DF3ACC7F662B6 6A17E6A 6B0C5FDB018AB8 1B3DA9606B28F C64F437386E28F FF1339D9A8DB91 2373714 94660DE158F294 846C6EEDE688A8 86D79CE45B4B3A DC9BA0C3207FAF 29E633C BD6017C76F7EC5 BE2B47069A49CD B351D27F4DCDB0 D5E80795C3AE02 1F9BA234 8F7A711E9CC9F4 998E066B1390F1 E0E9DBD991DAC0 92AA1AB5686CCB 5EA5CD 532C2B60C22875 430E80EE85042F B9FC830EBDBC96 BAC68257A701E8 22B0217B ED6BC79DAB6534 DF72EECA97FF2A 91515778F6735C 3793D923624175 123EA4 DC3F4FFCE79E0D AD35E14FA56BC4 B941CBC949E756 AFF57CA00BDD7E 12AD584B 287AFE59932A91 FD3EACEE786F99 F4BD2A1AE0FC29 5EA078EE2ABB36 58483CD FE84CC49FE12EF 8669DFA153B409 F99F67DB34AA42 7A0A39AD21715C 98E50A8 349B90CA4FBE42 A29D3631C6780 FDD0B11EA84C11 F2080418316618 24468423 3E12E9C33763D1 336A01AC988D0F 1FFD575D7F9593 138407DB562A9B 17C045EC"}},"tailsHash":"7hcdv6iZvq4mfKbSQq8jrN5qjTvxHvmB5H4dm3mgjTj9","tailsLocation":"tails/7hcdv6iZvq4mfKbSQq8jrN5qjTvxHvmB5H4dm3mgjTj9"}},"metadata":{"digest":"e86c3b0350483bd91a55de59b37155f418516e4748bc83ae5070d81ffbd78e1b","from":"5YKabdJyAEDpAUwKGhwhhr","reqId":1529587664836135531},"type":"113"},"txnMetadata":{"seqNo":50,"txnId":"5YKabdJyAEDpAUwKGhwhhr:4:5YKabdJyAEDpAUwKGhwhhr:3:CL:48:tag:CL_ACCUM:tag","txnTime":1529587664},"ver":"1"} 51 {"reqSignature":{"type":"ED25519","values": {"from":"5YKabdJyAEDpAUwKGhwhhr","value":"62hB8nE2CymQZcE29kZeDR1gk73M8yEiKA2dS7wSQgAm6rP1js4uA45uo9gvRnRxt3WbD2s5eNMM3MmBDt5sEnwL"} },"txn":{"data":{"revocDefType":"CL_ACCUM","revocRegDefId":"5YKabdJyAEDpAUwKGhwhhr:4:5YKabdJyAEDpAUwKGhwhhr:3:CL:48:CL_ACCUM:tag","value":{"accum":"true 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0"}},"metadata":{"digest":"8c5829c92e45ad0a12e686208e6aad59d12078d4713825161d90868c752064a0","from":"5YKabdJyAEDpAUwKGhwhhr","reqId":1529587665060067475},"type":"114"},"txnMetadata":{"seqNo":51,"txnId":"5:5YKabdJyAEDpAUwKGhwhhr:4:5YKabdJyAEDpAUwKGhwhhr:3:CL:48:CL_ACCUM:tag","txnTime":1529587665},"ver":"1"} {noformat}   Expected Results: There should be no errors after migration.  ></body> </Action>
<Action id="46425" issue="30733" author="ashcherbakov" type="comment" body="Fixed in 1.4.472" created="2018-06-22 07:18:42.0" updateauthor="ashcherbakov" updated="2018-06-22 07:18:42.0"/>
<Action id="46428" issue="30733" author="zhigunenko.dsr" type="comment" created="2018-06-22 09:35:46.0" updateauthor="zhigunenko.dsr" updated="2018-06-22 09:35:46.0"> <body><! CDATA *Environment:* indy-node 1.3.375 -> 1.4.472  *Steps to Validate:* 1. Install pool 1.3.375 master. 2. Send all types of txns to ledger. 3. Upgrade pool to 1.4.472 master. 4. Check `journalctl -ex`.  *Actual Results:* read_ledger haven't show unexpectable diffs  *Additional Information:* INDY-1424 revealed  ></body> </Action>
