<Action id="48353" issue="32479" author="derashe" type="comment" created="2018-08-03 12:14:21.0" updateauthor="derashe" updated="2018-08-03 12:14:21.0"> <body><! CDATA Problem reason: * When node notice that primary disconnected, it starts to send INSTANCE_CHANGES every 60 seconds, even if Primary is already connected. We need to change it.  Changes: * Now, we check if primary node had reconnected before sending another INSTANCE_CHANGE  Committed into: * https://github.com/hyperledger/indy-plenum/pull/851  Risk: * Low  Covered with tests: *  plenum/test/view_change/test_if_primary_disconnected.py|https://github.com/hyperledger/indy-plenum/pull/851/files#diff-a35e383d9c6ae289b71d342ffb0e1f20  *  plenum/test/view_change/test_instance_change_if_needed.py|https://github.com/hyperledger/indy-plenum/pull/851/files#diff-a3c8948587705f1d966837e2a2fe4ad2   ></body> </Action>
<Action id="48693" issue="32479" author="ashcherbakov" type="comment" created="2018-08-10 08:22:36.0" updateauthor="ashcherbakov" updated="2018-08-10 08:22:36.0"> <body><! CDATA Recommendation for QA: * Disconnect 1 non-primary node from the Primary and re-connect back * Make sure that non-Primary sent only 1 INSTANCE_CHANGE message with Primary Disconnected, not more.  ></body> </Action>
<Action id="48731" issue="32479" author="ozheregelya" type="comment" created="2018-08-10 17:54:36.0" updateauthor="ozheregelya" updated="2018-08-11 09:12:01.0"> <body><! CDATA *Environment:* indy-node 1.6.558 libindy 1.6.1~655  *Reason for Reopen:* Non-Primary node which was disconnected from primary sends INSTANCE_CHANGE on each txn sending after re-connection back.  *Steps to Reproduce:* 1. Setup the docker pool of 7 nodes. 2. On one of the nodes (node 5) block the Primary (node 1) IP: iptables -A INPUT -s 10.0.0.2 -j DROP 3. Check nodes logs. => Only 1 INSTANCE_CHANGE\{'viewNo': 1, 'reason': 25} was send by Node5, but one more INSTANCE_CHANGE\{'viewNo': 1, 'reason': 26} was send by Node7. 4. Unblock the Primary IP: iptables -D INPUT -s 10.0.0.2 -j DROP 5. Send several txns.  *Actual Results:* Node5 sends INSTANCE_CHANGE\{'viewNo': 1, 'reason': 25} after each txn sending even if it don't have network issues in connection to Primary. New txns are not written on Node5.  *Expected Results:* Node5 should work with Primary correctly, new txns should be written.  See logs in attachment.  ></body> </Action>
<Action id="48749" issue="32479" author="ashcherbakov" type="comment" created="2018-08-11 04:46:46.0" updateauthor="ashcherbakov" updated="2018-08-11 04:46:46.0"> <body><! CDATA  ~ozheregelya  reason:25 means 'Primary of master protocol instance degraded the performance'. This is expected, since backup instances order requests, and the master doesn't (since primary is blocked).  The Instance Change because of primary disconnected has code 26 (Primary of master protocol instance disconnected), it was sent only once as expected.     ></body> </Action>
<Action id="48759" issue="32479" author="ozheregelya" type="comment" body="After internal discussion it was decided that the problem described above is not connected with fix of this ticket. So, it was moved to separated ticket (INDY-1580) and this ticket will be closed." created="2018-08-11 13:24:29.0" updateauthor="ozheregelya" updated="2018-08-11 13:24:29.0"/>
