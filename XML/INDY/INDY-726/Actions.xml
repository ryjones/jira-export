<Action id="29740" issue="20113" author="alexander.shekhovcov" type="comment" created="2017-08-11 17:51:03.0" updateauthor="alexander.shekhovcov" updated="2017-08-11 17:51:03.0"> <body><! CDATA  ~mgbailey  First of all, thank you for a great description!   Looks like a timezone issue. I've found in the *metis* log the following: {code} 2017-08-09 17:11:35,561 | ERROR    | replica.py           (2004) | is_pre_prepare_time_acceptable | metis:0 found PREPREPARE{'viewNo': 0, 'reqIdr':  ('RRbkXVEr8UZ1Z9RidHmu25', 1502316696034239) , 'ppTime': 15023 16696, 'instId': 0, 'txnRootHash': '5xHbjpEmnMxafwrPPNQgYXNYsyLkkN1puy9P2eeTNx31', 'ledgerId': 1, 'discarded': 1, 'ppSeqNo': 124, 'stateRootHash': '2G1KeraEJM7tfWrpV96JoPd8j8mWzFfYM2x1G4DoYU5x', 'digest': '4a022 af4196648b0cc326bbcb288b2e847823a85f57f8246749593b0f382b233'} to have incorrect time. 2017-08-09 17:11:35,562 | WARNING  | node.py              (2494) | reportSuspiciousNode | metis raised suspicion on node play for PRE-PREPARE time not acceptable; suspicion code is 18 {code}  We have some issue fixed which is not in stable branch yet https://github.com/hyperledger/indy-plenum/commit/aec69eb25748be2e6e30a1ef5eb0ca0a7acbb0d3   ~lovesh  Could you add more details about this?     ></body> </Action>
<Action id="29774" issue="20113" author="mgbailey" type="comment" created="2017-08-11 22:03:29.0" updateauthor="mgbailey" updated="2017-08-11 22:03:29.0"> <body><! CDATA Alex,  Great clue!  We got on with the customer today and discovered that indeed they were in a different timezone.  It is puzzling that many transactions were able to get through to metis before this problem manifested, and then nothing got through after that.   Today we changed the timezone on metis to match the rest (UTC), and restarted the sovrin-node process on it.  We then posted a transaction to the ledger, which failed to be written to metis.    Next we killed the primary (play), and metis immediately caught up.  We posted another transaction to the ledger, which was successfully written to metis.  It will be interesting to see if metis will once again get into a state where it does not accept transactions, now that its timezone is in sync with the others.  We will post a transaction to the ESN ledger when we get in on Monday and see.  ></body> </Action>
<Action id="29811" issue="20113" author="mgbailey" type="comment" created="2017-08-14 15:57:44.0" updateauthor="mgbailey" updated="2017-08-14 16:02:27.0"> <body><! CDATA I added a transaction to the ESN ledger this morning, and the ledger on metis updated fine with it.   ~krw910 , please try this test to see if it replicates the issue.  On a test validator network, set the timezone on one node (not the primary) to be CDT, the others all UDT.  Put a few transactions on the ledger.  Wait 24 hours.  Add another transaction.  Did the node in the different timezone keep sync?  ></body> </Action>
<Action id="29819" issue="20113" author="krw910" type="comment" body=" ~mgbailey  I have confirmed that if one node is not in UTC time it will get out of sync. I have 7 nodes and put one in CDT. I sent 500 transactions and after 400 the node in CDT fell out of sync. This issue should be addressed in INDY-466" created="2017-08-14 19:23:51.0" updateauthor="krw910" updated="2017-08-14 19:23:51.0"/>
<Action id="29820" issue="20113" author="lovesh" type="comment" body="The timezone being wrong on one node should not matter, only if timezone is inconsistent on more than f nodes, it becomes a problem. So &gt;=n-f nodes are correct, the f nodes should continue to function even if they have wrong timezone" created="2017-08-14 19:30:46.0" updateauthor="lovesh" updated="2017-08-14 19:31:43.0"/>
<Action id="29822" issue="20113" author="krw910" type="comment" body=" ~lovesh  we are not sure why it is happening, but it should be the same issue that was fixed after we released. We are just waiting until the next stable to roll out that fix. For some reason if the nodes are in UTC, but one node is not then that node will eventually stop taking transactions and get out of sync. I have confirmed this in my test pool." created="2017-08-14 20:02:23.0" updateauthor="krw910" updated="2017-08-14 20:02:23.0"/>
<Action id="29844" issue="20113" author="alexander.shekhovcov" type="comment" created="2017-08-15 11:14:03.0" updateauthor="alexander.shekhovcov" updated="2017-08-15 11:14:03.0"> <body><! CDATA *Summary:* A pool build on the current stable build does not support nodes in different timezone.  Workaround is to set UTC timezone for each node in the pool.  In case a non primary node has another timezone it adds to the blacklist other nodes whereas the pool works well.  The issue already fixed in  master|https://github.com/hyperledger/indy-plenum/commit/aec69eb25748be2e6e30a1ef5eb0ca0a7acbb0d3 .   ></body> </Action>
