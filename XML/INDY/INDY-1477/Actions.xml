<Action id="48237" issue="31892" author="sergey-shilov" type="comment" created="2018-08-01 10:58:46.0" updateauthor="sergey-shilov" updated="2018-08-01 11:19:41.0"> <body><! CDATA *Current results of ticket research:*  View Changes reasons: ==================================================================================== 0 -> 1: PRIMARY_DISCONNECTED (reason 26) 1 -> 2: PRIMARY_DEGRADED (reason 25) 2 -> 3: PRIMARY_DEGRADED (reason 25) 3 -> 4: PRIMARY_DEGRADED (reason 25) 4 -> 5: INSTANCE_CHANGE_TIMEOUT (reason 28) 5 -> 6: PRIMARY_DEGRADED (reason 25) 6 -> 7: INSTANCE_CHANGE_TIMEOUT (reason 28) 7 -> 8: PRIMARY_DISCONNECTED (reason 26) 8 -> 9: INSTANCE_CHANGE_TIMEOUT (reason 28) 9 -> 10: PRIMARY_DEGRADED (reason 25) 10 -> 11: 16 - PRIMARY_DEGRADED (reason 25), 14 - INSTANCE_CHANGE_TIMEOUT (reason 28) ====================================================================================   After 11 view change several nodes (Node10, Node13, Node18, Node24, Node3, Node4) failed with "No space left" error approximately at the same time: ==================================================================================== Node10 restart: Jul 14 10:12:27 Node13 restart: Jul 14 10:12:39 Node18 restart: Jul 14 10:12:44 Node24 restart: Jul 14 10:12:32 Node3 restart: Jul 14 10:12:28 Node4 restart: Jul 14 10:12:26 ====================================================================================  Considering several fallen behind nodes (Node15, Node17, Node21) that blacklisted other nodes (Sent transactions that could not be verified) the pool was in lost consensus state. Seems like it cause inconsistent uncommitted domain ledger root that occurred after 11 view change (committed roots are the same): ==================================================================================== vldtr.node12: "1": b'zMfuFA7YzHSi1gYqRNrKUyUs97n56DDwxL71tHZMtqE' vldtr.node14: "1": b'zMfuFA7YzHSi1gYqRNrKUyUs97n56DDwxL71tHZMtqE' vldtr.node16: "1": b'zMfuFA7YzHSi1gYqRNrKUyUs97n56DDwxL71tHZMtqE' vldtr.node2: "1": b'zMfuFA7YzHSi1gYqRNrKUyUs97n56DDwxL71tHZMtqE' vldtr.node20: "1": b'zMfuFA7YzHSi1gYqRNrKUyUs97n56DDwxL71tHZMtqE' vldtr.node22: "1": b'zMfuFA7YzHSi1gYqRNrKUyUs97n56DDwxL71tHZMtqE' vldtr.node23: "1": b'zMfuFA7YzHSi1gYqRNrKUyUs97n56DDwxL71tHZMtqE' vldtr.node6: "1": b'zMfuFA7YzHSi1gYqRNrKUyUs97n56DDwxL71tHZMtqE' vldtr.node7: "1": b'zMfuFA7YzHSi1gYqRNrKUyUs97n56DDwxL71tHZMtqE'  vldtr.node10: "1": b'CnWAL84bgEeztexgCo2Fj79xc6kNZKyKTx9ki5jnrumD' vldtr.node13: "1": b'CnWAL84bgEeztexgCo2Fj79xc6kNZKyKTx9ki5jnrumD' vldtr.node18: "1": b'CnWAL84bgEeztexgCo2Fj79xc6kNZKyKTx9ki5jnrumD' vldtr.node24: "1": b'CnWAL84bgEeztexgCo2Fj79xc6kNZKyKTx9ki5jnrumD' vldtr.node3: "1": b'CnWAL84bgEeztexgCo2Fj79xc6kNZKyKTx9ki5jnrumD' vldtr.node4: "1": b'CnWAL84bgEeztexgCo2Fj79xc6kNZKyKTx9ki5jnrumD' ====================================================================================  All nodes from the second group are nodes that failed with "No space left" error (described above). The main difference between two groups is the fact that nodes from the second group flushed their last prepared certificate and uncommitted roots during restart: ==================================================================================== 2018-07-14 10:14:21.440000 | Node10:0 setting last prepared for master to None ====================================================================================  while nodes from the first group has it: ==================================================================================== 2018-07-14 10:04:31.480000 | Node12:0 setting last prepared for master to (7, 14) ====================================================================================  There were no any discards of Pre-Prepares after 11th view change and "incorrect state trie" log messages. Log level was INFO.  Last ordered transaction was in 5 view.  Unfortunately validator info and logs does not provide state roots.  ></body> </Action>
<Action id="48292" issue="31892" author="ashcherbakov" type="comment" created="2018-08-02 12:29:30.0" updateauthor="ashcherbakov" updated="2018-08-02 12:29:30.0"> <body><! CDATA The nodes crashed at 10:12 have Uncommitted State persisted, and it looks like they were not able to recover it.  It will be investigated and fix in the scope of INDY-1547  ></body> </Action>
