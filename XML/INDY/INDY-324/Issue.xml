<Issue id="18609" key="INDY-324" number="324" project="10303" reporter="aleksey-roldugin" assignee="danielhardman" creator="aleksey-roldugin" type="10004" summary=" POOL_UPGRADE  Node1 was broken after sending upgrade command" priority="3" resolution="10000" status="10001" created="2017-06-23 14:16:46.0" updated="2019-03-29 20:34:41.0" resolutiondate="2019-03-29 20:34:41.0" votes="0" watches="3" workflowId="18609"> <description><! CDATA h6. BUILD  sovrin-node 0.3.154 sovrin-client 0.3.145  PRECONDITIONS Issue was found on  Pool 3|https://docs.google.com/spreadsheets/d/1dQs2101Xcb9HMJQufLgtmiHxA-apbjnbXn8CGiCDHp0/edit#gid=0 . h6. STEPS TO REPRODUCE # Send upgrade command from the client:  {code:java} sovrin@test> send POOL_UPGRADE name=update_to_node_155 version=0.3.155 sha256=aad1143 action=start schedule={'Gw6pDLhcBcoQesN72qfotTgFa7cbuqZpkX3Xo6pLhPhv':'2017-06-23T09:20:00.258870+00:00', '8ECVSk179mjsjKRLWiQtssMLgp6EPhWXtaYyStWPSGAb':'2017-06-23T09:25:00.258870+00:00', 'DKVxG2fXXTU8yT5N7hGEbXB3dfdAnYv1JczDUHpmDxya':'2017-06-23T09:30:00.258870+00:00','4PS3EDQ3dW1tci1Bp6543CfuuebjFrg36kLAUcskGfaA':'2017-06-23T09:35:00.258870+00:00','C7Ts1WoZwBfq1VmRUE9vUtj9XGBp1EZfySh5mhMWsTPp':'2017-06-23T09:40:00.258870+00:00'} timeout=10 {code} h6. ACTUAL RESULT - Node 1 wasn't upgraded (please see logs from node) - After upgrade of of Node4, Node1 was disconnected for some reason and crashed (2017-06-23 09:35:51,002 | INFO | looper.py ( 267) | shutdown | Looper shutting down now...) - At the same time Node1 has "active (running)" status.  h6. ADDITIONAL INFORMATION {code:java} Jun 23 09:35:51 saopauloShakeP3.qatest.evernym.com start_sovrin_node 14154 : Traceback (most recent call last): Jun 23 09:35:51 saopauloShakeP3.qatest.evernym.com start_sovrin_node 14154 :   File "/usr/local/bin/start_sovrin_node", line 50, in <module> Jun 23 09:35:51 saopauloShakeP3.qatest.evernym.com start_sovrin_node 14154 :     looper.run() Jun 23 09:35:51 saopauloShakeP3.qatest.evernym.com start_sovrin_node 14154 :   File "/usr/local/lib/python3.5/dist-packages/stp_core/loop/looper.py", line 284, in __exit__ Jun 23 09:35:51 saopauloShakeP3.qatest.evernym.com start_sovrin_node 14154 :     self.shutdownSync() Jun 23 09:35:51 saopauloShakeP3.qatest.evernym.com start_sovrin_node 14154 :   File "/usr/local/lib/python3.5/dist-packages/stp_core/loop/looper.py", line 280, in shutdownSync Jun 23 09:35:51 saopauloShakeP3.qatest.evernym.com start_sovrin_node 14154 :     self.loop.run_until_complete(self.shutdown()) Jun 23 09:35:51 saopauloShakeP3.qatest.evernym.com start_sovrin_node 14154 :   File "/usr/lib/python3.5/asyncio/base_events.py", line 387, in run_until_complete Jun 23 09:35:51 saopauloShakeP3.qatest.evernym.com start_sovrin_node 14154 :     return future.result() Jun 23 09:35:51 saopauloShakeP3.qatest.evernym.com start_sovrin_node 14154 :   File "/usr/lib/python3.5/asyncio/futures.py", line 274, in result Jun 23 09:35:51 saopauloShakeP3.qatest.evernym.com start_sovrin_node 14154 :     raise self._exception Jun 23 09:35:51 saopauloShakeP3.qatest.evernym.com start_sovrin_node 14154 :   File "/usr/lib/python3.5/asyncio/tasks.py", line 239, in _step Jun 23 09:35:51 saopauloShakeP3.qatest.evernym.com start_sovrin_node 14154 :     result = coro.send(None) Jun 23 09:35:51 saopauloShakeP3.qatest.evernym.com start_sovrin_node 14154 :   File "/usr/local/lib/python3.5/dist-packages/stp_core/loop/looper.py", line 270, in shutdown Jun 23 09:35:51 saopauloShakeP3.qatest.evernym.com start_sovrin_node 14154 :     await self.runFut Jun 23 09:35:51 saopauloShakeP3.qatest.evernym.com start_sovrin_node 14154 :   File "/usr/lib/python3.5/asyncio/futures.py", line 363, in __iter__ Jun 23 09:35:51 saopauloShakeP3.qatest.evernym.com start_sovrin_node 14154 :     return self.result()  # May raise too. Jun 23 09:35:51 saopauloShakeP3.qatest.evernym.com start_sovrin_node 14154 :   File "/usr/lib/python3.5/asyncio/futures.py", line 274, in result Jun 23 09:35:51 saopauloShakeP3.qatest.evernym.com start_sovrin_node 14154 :     raise self._exception {code}  ></description> </Issue>
