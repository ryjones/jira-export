<Action id="27891" issue="18030" author="ozheregelya" type="comment" created="2017-07-05 16:19:36.0" updateauthor="ozheregelya" updated="2017-07-06 17:07:01.0"> <body><! CDATA After exploration of INDY-280 I can see following cases in this ticket:  Case 1: Scheduling upgrade to future date does not work at all. Upgrade is happened in specified time, but date is today or tomorrow. This problem is described in INDY-382.  Case 2: Some nodes of pool were not upgraded by some reason. This problem is described in description of this ticket.  ></body> </Action>
<Action id="30496" issue="18030" author="andkononykhin" type="comment" created="2017-09-05 08:31:22.0" updateauthor="andkononykhin" updated="2017-09-05 08:31:22.0"> <body><! CDATA Seems I found possible reason of the issue: incorrect usage of timedelta object API usage  https://github.com/hyperledger/indy-node/blob/1.1.131-master/sovrin_node/server/upgrader.py#L373   timedelta.seconds not declared in  docs|https://docs.python.org/3.5/library/datetime.html#timedelta-objects  and it actually returns only seconds part of time diff.  As a fix  total_seconds()|https://docs.python.org/3.5/library/datetime.html#datetime.timedelta.total_seconds  should be used.  ></body> </Action>
<Action id="30497" issue="18030" author="andkononykhin" type="comment" created="2017-09-05 08:51:23.0" updateauthor="andkononykhin" updated="2017-09-05 08:51:23.0"> <body><! CDATA Also I think it's better to switch to use absolute timestamp *when* instead of relative *delay* in Upgrader.scheduledUpgrade attribute: https://github.com/hyperledger/indy-node/blob/1.1.131-master/sovrin_node/server/upgrader.py#L374  It will be helpful if we need to get scheduled timestamp later without parsing ledger. Also current semantic of that part (delay/when) of the attribute varies in different methods of Upgrader class and it seems buggy.  ></body> </Action>
<Action id="31965" issue="18030" author="spivachuk" type="comment" created="2017-10-10 09:04:29.0" updateauthor="spivachuk" updated="2017-10-10 09:11:41.0"> <body><! CDATA Problem reason:  - {{seconds}} property of {{timedelta}} class was previously used instead of its method {{total_seconds}} for converting node upgrade delay from {{timedelta}} to seconds in {{Upgrader}} class. So only seconds part of days-seconds-microseconds representation was used to schedule node upgrade (and due to that the node upgrade delay did not exceed one day).  Changes:  - Fixed the bug in conversion of node upgrade delay from {{timedelta}} to seconds in {{Upgrader}} class. - Added a test for the fix.  Committed into: - https://github.com/hyperledger/indy-node/pull/390  Risk factors: - Nothing is expected.  Risk: - Low  Covered with tests: - {{indy_client.test.cli.test_pool_upgrade_schedule.testPoolUpgradeScheduledOnProperDate}}   ></body> </Action>
<Action id="33221" issue="18030" author="mgbailey" type="comment" body=" ~krw910 , will this be included in the next indy release?" created="2017-10-26 15:08:55.0" updateauthor="mgbailey" updated="2017-10-26 15:08:55.0"/>
<Action id="33352" issue="18030" author="krw910" type="comment" body=" ~mgbailey  Yes it should be in the next release." created="2017-10-30 04:42:11.0" updateauthor="krw910" updated="2017-10-30 04:42:11.0"/>
<Action id="34452" issue="18030" author="ozheregelya" type="comment" created="2017-11-08 13:51:16.0" updateauthor="ozheregelya" updated="2017-11-08 13:51:16.0"> <body><! CDATA Build Info: sovrin 1.1.31 indy-node 1.1.165 indy-anoncreds 1.0.32 indy-plenum 1.1.145  Steps to Validate: 1. Schedule upgrade for future (more than 24h since current moment). 2. Check that upgrade was happened in specified date.  Actual Results: Upgrade happened in accordance with the schedule.  ></body> </Action>
