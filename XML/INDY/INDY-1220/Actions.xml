<Action id="41511" issue="28439" author="ashcherbakov" type="comment" body=" ~mgbailey  I think it should not be a blocker for the live pool Upgrade." created="2018-03-13 08:30:58.0" updateauthor="ashcherbakov" updated="2018-03-13 08:30:58.0"/>
<Action id="41550" issue="28439" author="mgbailey" type="comment" body=" ~Toktar  I am attaching logs provided by stewards of digitalbazaar and BIGAWSUSEAST1-001. They are quite small, actually." created="2018-03-13 18:14:18.0" updateauthor="mgbailey" updated="2018-03-13 18:14:18.0"/>
<Action id="41579" issue="28439" author="ashcherbakov" type="comment" created="2018-03-14 09:18:45.0" updateauthor="ashcherbakov" updated="2018-03-14 09:18:45.0"> <body><! CDATA  ~mgbailey  What we can see from this logs is that ev1's *viewNo=0*, while Digitalbazaar's *viewNo=114.* It looks like all PRE-PREPARES sent by the Primary (ev1) are discarded by other nodes because they have a higher viewNo.  We need more logs (ideally logs from all nodes) to say something more clear.  Actually I suggest sending forced NODE_UPGRADE which can update the code and restart the pool at the same time. Hopefully restart will help in recovering of inconsistent views.     ></body> </Action>
<Action id="41580" issue="28439" author="toktar" type="comment" created="2018-03-14 10:07:59.0" updateauthor="toktar" updated="2018-03-14 10:07:59.0"> <body><! CDATA The problem is in the incorrect data in the following nodes: * zaValidator * danube * digitalbazaar * OASFCU * BIGAWSUSEAST1 * prosovito  The problem can be fixed by making the live pool Upgrade or by stopping nodes from the list and then running them one at a time.  ></body> </Action>
<Action id="41642" issue="28439" author="mgbailey" type="comment" body=" ~ashcherbakov ,  ~Toktar , do we know how it got into this state and how to prevent it?  Is it possibly a known problem that is fixed in 1.3.55?" created="2018-03-14 19:29:57.0" updateauthor="mgbailey" updated="2018-03-14 19:29:57.0"/>
<Action id="41644" issue="28439" author="krw910" type="comment" created="2018-03-14 19:40:09.0" updateauthor="krw910" updated="2018-03-14 19:40:09.0"> <body><! CDATA  ~Toktar  Can you explain what you mean by "incorrect data"? Mike meantime something about viewNo=114. Did we get into a state where we have two primary nodes and the nodes are not sure who they should be talking to?   ></body> </Action>
<Action id="41666" issue="28439" author="ashcherbakov" type="comment" created="2018-03-15 08:43:58.0" updateauthor="ashcherbakov" updated="2018-03-15 08:43:58.0"> <body><! CDATA  ~mgbailey   ~krw910  We think it got into that state because of individual restarts of nodes.   Unfortunately, we can't say too much from the current logs. We logs from 3 nodes only. And some of these logs rotated, so we don't have the full history...  I think we need to change how logs are rotated. I created INDY-1225 for this.  ></body> </Action>
<Action id="41667" issue="28439" author="ashcherbakov" type="comment" body="If we want to continue debug of the issue, we need to have log files from all nodes." created="2018-03-15 08:44:29.0" updateauthor="ashcherbakov" updated="2018-03-15 08:44:29.0"/>
<Action id="41699" issue="28439" author="mgbailey" type="comment" created="2018-03-15 19:54:17.0" updateauthor="mgbailey" updated="2018-03-15 19:54:17.0"> <body><! CDATA  ~ashcherbakov   ~Toktar  I had BIGAWSUSEAST1-001 and digitalbazaar restart their services, and they sent me new logs: {code:java} 2018-03-15 19:38:18,757 | DISPLAY | primary_selector.py ( 327) | _start_selection | PRIMARY SELECTION: BIGAWSUSEAST1-001:0 selected primary ev1:0 for instance 0 (view 0) 2018-03-15 19:38:18,757 | INFO | node.py ( 532) | start_participating | BIGAWSUSEAST1-001 started participating 2018-03-15 19:38:18,757 | DISPLAY | primary_selector.py ( 351) | _start_selection | VIEW CHANGE: BIGAWSUSEAST1-001:0 declares view change 0 as completed for instance 0, new primary is ev1:0, ledger info is  (0, 33, 'BafagSgueFyWwzgUYocoeefS7qgGVFzS3ihPb57Rr6jS'), (1, 43, '2b61e2wdgufCSwyzB9CoGjiPKVkD5R7NbLmV3jHxigHL'), (2, 114, 'EFEMkAaNCQMGenatx4M11qDVLwABCLCkjmaWd1P2XDo6')  2018-03-15 19:38:18,757 | DISPLAY | primary_selector.py ( 327) | _start_selection | PRIMARY SELECTION: BIGAWSUSEAST1-001:1 selected primary zaValidator:1 for instance 1 (view 0) 2018-03-15 19:38:18,758 | DISPLAY | primary_selector.py ( 351) | _start_selection | VIEW CHANGE: BIGAWSUSEAST1-001:1 declares view change 0 as completed for instance 1, new primary is zaValidator:1, ledger info is  (0, 33, 'BafagSgueFyWwzgUYocoeefS7qgGVFzS3ihPb57Rr6jS'), (1, 43, '2b61e2wdgufCSwyzB9CoGjiPKVkD5R7NbLmV3jHxigHL'), (2, 114, 'EFEMkAaNCQMGenatx4M11qDVLwABCLCkjmaWd1P2XDo6')  2018-03-15 19:38:18,758 | DISPLAY | primary_selector.py ( 327) | _start_selection | PRIMARY SELECTION: BIGAWSUSEAST1-001:2 selected primary danube:2 for instance 2 (view 0) 2018-03-15 19:38:18,758 | DISPLAY | primary_selector.py ( 351) | _start_selection | VIEW CHANGE: BIGAWSUSEAST1-001:2 declares view change 0 as completed for instance 2, new primary is danube:2, ledger info is  (0, 33, 'BafagSgueFyWwzgUYocoeefS7qgGVFzS3ihPb57Rr6jS'), (1, 43, '2b61e2wdgufCSwyzB9CoGjiPKVkD5R7NbLmV3jHxigHL'), (2, 114, 'EFEMkAaNCQMGenatx4M11qDVLwABCLCkjmaWd1P2XDo6')  2018-03-15 19:38:18,758 | DISPLAY | primary_selector.py ( 327) | _start_selection | PRIMARY SELECTION: BIGAWSUSEAST1-001:3 selected primary royal_sovrin:3 for instance 3 (view 0) 2018-03-15 19:38:18,759 | DISPLAY | primary_selector.py ( 351) | _start_selection | VIEW CHANGE: BIGAWSUSEAST1-001:3 declares view change 0 as completed for instance 3, new primary is royal_sovrin:3, ledger info is  (0, 33, 'BafagSgueFyWwzgUYocoeefS7qgGVFzS3ihPb57Rr6jS'), (1, 43, '2b61e2wdgufCSwyzB9CoGjiPKVkD5R7NbLmV3jHxigHL'), (2, 114, 'EFEMkAaNCQMGenatx4M11qDVLwABCLCkjmaWd1P2XDo6')  2018-03-15 19:38:18,759 | DISPLAY | primary_selector.py ( 327) | _start_selection | PRIMARY SELECTION: BIGAWSUSEAST1-001:4 selected primary digitalbazaar:4 for instance 4 (view 0) 2018-03-15 19:38:18,759 | DISPLAY | primary_selector.py ( 351) | _start_selection | VIEW CHANGE: BIGAWSUSEAST1-001:4 declares view change 0 as completed for instance 4, new primary is digitalbazaar:4, ledger info is  (0, 33, 'BafagSgueFyWwzgUYocoeefS7qgGVFzS3ihPb57Rr6jS'), (1, 43, '2b61e2wdgufCSwyzB9CoGjiPKVkD5R7NbLmV3jHxigHL'), (2, 114, 'EFEMkAaNCQMGenatx4M11qDVLwABCLCkjmaWd1P2XDo6')  2018-03-15 19:38:18,759 | INFO | ledger_manager.py ( 865) | catchupCompleted | CATCH-UP: BIGAWSUSEAST1-001 completed catching up ledger 2, caught up 0 in total 2018-03-15 19:38:18,759 | INFO | node.py (1598) | allLedgersCaughtUp | CATCH-UP: BIGAWSUSEAST1-001 does not need any more catchups 2018-03-15 19:38:18,760 | INFO | node.py (1685) | no_more_catchups_needed | BIGAWSUSEAST1-001 starting to participate since catchup is done, primaries are selected but mode was not set to participating 2018-03-15 19:38:18,760 | INFO | node.py ( 532) | start_participating | BIGAWSUSEAST1-001 started participating {code} and, {code:java} 2018-03-14 19:48:04,568 | DISPLAY | primary_selector.py ( 327) | _start_selection | PRIMARY SELECTION: digitalbazaar:0 selected primary ev1:0 for instance 0 (view 0) 2018-03-14 19:48:04,568 | INFO | node.py ( 532) | start_participating | digitalbazaar started participating 2018-03-14 19:48:04,569 | DISPLAY | primary_selector.py ( 351) | _start_selection | VIEW CHANGE: digitalbazaar:0 declares view change 0 as completed for instance 0, new primary is ev1:0, ledger info is  (0, 33, 'BafagSgueFyWwzgUYocoeefS7qgGVFzS3ihPb57Rr6jS'), (1, 43, '2b61e2wdgufCSwyzB9CoGjiPKVkD5R7NbLmV3jHxigHL'), (2, 114, 'EFEMkAaNCQMGenatx4M11qDVLwABCLCkjmaWd1P2XDo6')  2018-03-14 19:48:04,569 | DISPLAY | primary_selector.py ( 327) | _start_selection | PRIMARY SELECTION: digitalbazaar:1 selected primary zaValidator:1 for instance 1 (view 0) 2018-03-14 19:48:04,569 | DISPLAY | primary_selector.py ( 351) | _start_selection | VIEW CHANGE: digitalbazaar:1 declares view change 0 as completed for instance 1, new primary is zaValidator:1, ledger info is  (0, 33, 'BafagSgueFyWwzgUYocoeefS7qgGVFzS3ihPb57Rr6jS'), (1, 43, '2b61e2wdgufCSwyzB9CoGjiPKVkD5R7NbLmV3jHxigHL'), (2, 114, 'EFEMkAaNCQMGenatx4M11qDVLwABCLCkjmaWd1P2XDo6')  2018-03-14 19:48:04,570 | DISPLAY | primary_selector.py ( 327) | _start_selection | PRIMARY SELECTION: digitalbazaar:2 selected primary danube:2 for instance 2 (view 0) 2018-03-14 19:48:04,570 | DISPLAY | primary_selector.py ( 351) | _start_selection | VIEW CHANGE: digitalbazaar:2 declares view change 0 as completed for instance 2, new primary is danube:2, ledger info is  (0, 33, 'BafagSgueFyWwzgUYocoeefS7qgGVFzS3ihPb57Rr6jS'), (1, 43, '2b61e2wdgufCSwyzB9CoGjiPKVkD5R7NbLmV3jHxigHL'), (2, 114, 'EFEMkAaNCQMGenatx4M11qDVLwABCLCkjmaWd1P2XDo6')  2018-03-14 19:48:04,570 | DISPLAY | primary_selector.py ( 327) | _start_selection | PRIMARY SELECTION: digitalbazaar:3 selected primary royal_sovrin:3 for instance 3 (view 0) 2018-03-14 19:48:04,570 | DISPLAY | primary_selector.py ( 351) | _start_selection | VIEW CHANGE: digitalbazaar:3 declares view change 0 as completed for instance 3, new primary is royal_sovrin:3, ledger info is  (0, 33, 'BafagSgueFyWwzgUYocoeefS7qgGVFzS3ihPb57Rr6jS'), (1, 43, '2b61e2wdgufCSwyzB9CoGjiPKVkD5R7NbLmV3jHxigHL'), (2, 114, 'EFEMkAaNCQMGenatx4M11qDVLwABCLCkjmaWd1P2XDo6')  2018-03-14 19:48:04,570 | DISPLAY | primary_selector.py ( 327) | _start_selection | PRIMARY SELECTION: digitalbazaar:4 selected primary digitalbazaar:4 for instance 4 (view 0) 2018-03-14 19:48:04,571 | DISPLAY | primary_selector.py ( 351) | _start_selection | VIEW CHANGE: digitalbazaar:4 declares view change 0 as completed for instance 4, new primary is digitalbazaar:4, ledger info is  (0, 33, 'BafagSgueFyWwzgUYocoeefS7qgGVFzS3ihPb57Rr6jS'), (1, 43, '2b61e2wdgufCSwyzB9CoGjiPKVkD5R7NbLmV3jHxigHL'), (2, 114, 'EFEMkAaNCQMGenatx4M11qDVLwABCLCkjmaWd1P2XDo6')  2018-03-14 19:48:04,571 | INFO | ledger_manager.py ( 865) | catchupCompleted | CATCH-UP: digitalbazaar completed catching up ledger 2, caught up 0 in total 2018-03-14 19:48:04,571 | INFO | node.py (1598) | allLedgersCaughtUp | CATCH-UP: digitalbazaar does not need any more catchups 2018-03-14 19:48:04,572 | INFO | node.py (1685) | no_more_catchups_needed | digitalbazaar starting to participate since catchup is done, primaries are selected but mode was not set to participating 2018-03-14 19:48:04,572 | INFO | node.py ( 532) | start_participating | digitalbazaar started participating {code} It looks like these nodes are set to view 0 with primary ev1, right?  Does this mean that these nodes are now operating properly?     ></body> </Action>
<Action id="41724" issue="28439" author="ashcherbakov" type="comment" body="Most probably yes, they should operate properly now." created="2018-03-16 06:40:17.0" updateauthor="ashcherbakov" updated="2018-03-16 06:40:17.0"/>
<Action id="41798" issue="28439" author="ashcherbakov" type="comment" body="Let&apos;s see whether live pool Upgrade helps." created="2018-03-19 16:04:03.0" updateauthor="ashcherbakov" updated="2018-03-19 16:04:03.0"/>
<Action id="42209" issue="28439" author="ashcherbakov" type="comment" body="We can reopen any that reappear, but all is good on the live pool now." created="2018-03-27 13:48:04.0" updateauthor="ashcherbakov" updated="2018-03-27 13:48:04.0"/>
