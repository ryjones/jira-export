<Issue id="18362" key="INDY-279" number="279" project="10303" reporter="krw910" assignee="krw910" creator="krw910" type="10002" summary="Upgrade: submit another upgrade when some nodes have already upgraded and some of them have not" priority="3" resolution="10000" status="10001" created="2017-06-19 22:24:11.0" updated="2019-03-29 20:32:52.0" resolutiondate="2019-03-29 20:32:52.0" votes="0" watches="1" timeoriginalestimate="3600" timeestimate="3600" workflowId="18367"> <description><! CDATA Upgrade: submit another upgrade when some nodes have already upgraded and some of them have not h6.  Things tried * Schedule upgrade to existent version, wait until 2 nodes did upgrade, schedule upgrade to nonexistent version on time greater than time of the 1st scheduled upgrade => upgrade loop after 2nd upgrade ( INDY-316|https://jira.hyperledger.org/browse/INDY-316 ). {code:java} sovrin@test> send POOL_UPGRADE name=update_to_node_160 version=0.3.160 sha256=aad1143 action=start schedule={'Gw6pDLhcBcoQesN72qfotTgFa7cbuqZpkX3Xo6pLhPhv':'2017-06-24T15:15:00.2 58870+00:00', '8ECVSk179mjsjKRLWiQtssMLgp6EPhWXtaYyStWPSGAb':'2017-06-24T15:20:00.258870+00:00', 'DKVxG2fXXTU8yT5N7hGEbXB3dfdAnYv1JczDUHpmDxya':'2017-06-24T16:25:00.258870+00:00' ,'4PS3EDQ3dW1tci1Bp6543CfuuebjFrg36kLAUcskGfaA':'2017-06-24T16:30:00.258870+00:00',} timeout=10 Sending pool upgrade update_to_node_160 for version 0.3.160 Pool upgrade successful{code} {code:java}  sovrin@test> send POOL_UPGRADE name=update_to_node_161 version=0.3.161 sha256=aad1143 action=start schedule={'Gw6pDLhcBcoQesN72qfotTgFa7cbuqZpkX3Xo6pLhPhv':'2017-06-24T17:15:00.2 58870+00:00', '8ECVSk179mjsjKRLWiQtssMLgp6EPhWXtaYyStWPSGAb':'2017-06-24T17:20:00.258870+00:00', 'DKVxG2fXXTU8yT5N7hGEbXB3dfdAnYv1JczDUHpmDxya':'2017-06-24T17:25:00.258870+00:00' ,'4PS3EDQ3dW1tci1Bp6543CfuuebjFrg36kLAUcskGfaA':'2017-06-24T17:30:00.258870+00:00',} timeout=10 Sending pool upgrade update_to_node_161 for version 0.3.161 Pool upgrade successful 8Jk2v4GEoUhrH5GkiyeFh5zK8GnDJR4mW11qVfsRzKmQ disconnected from Node1C 8Jk2v4GEoUhrH5GkiyeFh5zK8GnDJR4mW11qVfsRzKmQ now connected to Node1C 8Jk2v4GEoUhrH5GkiyeFh5zK8GnDJR4mW11qVfsRzKmQ disconnected from Node1C 8Jk2v4GEoUhrH5GkiyeFh5zK8GnDJR4mW11qVfsRzKmQ now connected to Node1C 8Jk2v4GEoUhrH5GkiyeFh5zK8GnDJR4mW11qVfsRzKmQ disconnected from Node1C 8Jk2v4GEoUhrH5GkiyeFh5zK8GnDJR4mW11qVfsRzKmQ now connected to Node1C 8Jk2v4GEoUhrH5GkiyeFh5zK8GnDJR4mW11qVfsRzKmQ disconnected from Node1C{code}    * Schedule upgrade to existent version, immediately schedule upgrade to same version and same time but with another name => successful upgrade (I didn't determine which scheduled upgrade, 1st or 2nd, caused it)   {code:java} sovrin@test> send POOL_UPGRADE name=update_to_node_160 version=0.3.160 sha256=aad1443 action=start schedule={'Gw6pDLhcBcoQesN72qfotTgFa7cbuqZpkX3Xo6pLhPhv':'2017-06- 25T20:25:00.258870+00:00', '8ECVSk179mjsjKRLWiQtssMLgp6EPhWXtaYyStWPSGAb':'2017-06-30T20:30:00.258870+00:00', 'DKVxG2fXXTU8yT5N7hGEbXB3dfdAnYv1JczDUHpmDxya':'2017-06 -25T20:35:00.258870+00:00','4PS3EDQ3dW1tci1Bp6543CfuuebjFrg36kLAUcskGfaA':'2017-06-25T20:40:00.258870+00:00',} timeout=10 Sending pool upgrade update_to_node_160 for version 0.3.160 Pool upgrade successful{code} {code:java} sovrin@test> send POOL_UPGRADE name=update_to_node_160_1 version=0.3.160 sha256=aad1443 action=start schedule={'Gw6pDLhcBcoQesN72qfotTgFa7cbuqZpkX3Xo6pLhPhv':'2017-0 6-25T20:25:00.258870+00:00', '8ECVSk179mjsjKRLWiQtssMLgp6EPhWXtaYyStWPSGAb':'2017-06-30T20:30:00.258870+00:00', 'DKVxG2fXXTU8yT5N7hGEbXB3dfdAnYv1JczDUHpmDxya':'2017- 06-25T20:35:00.258870+00:00','4PS3EDQ3dW1tci1Bp6543CfuuebjFrg36kLAUcskGfaA':'2017-06-25T20:40:00.258870+00:00',} timeout=10 Sending pool upgrade update_to_node_160_1 for version 0.3.160 Pool upgrade successful {code}  * Schedule upgrade to existent version, wait until 2 nodes did upgrade, schedule upgrade to same version but on time greater than time of the 1st scheduled upgrade and with another name => successful upgrade after 1st scheduled upgrade, 2nd upgrade didn't lead to upgrade. {code:java} sovrin@test> send POOL_UPGRADE name=update_to_node_161 version=0.3.161 sha256=aad1443 action=start schedule={'Gw6pDLhcBcoQesN72qfotTgFa7cbuqZpkX3Xo6pLhPhv':'2017-06-26T11:40:00.2 58870+00:00', '8ECVSk179mjsjKRLWiQtssMLgp6EPhWXtaYyStWPSGAb':'2017-06-26T11:45:00.258870+00:00', 'DKVxG2fXXTU8yT5N7hGEbXB3dfdAnYv1JczDUHpmDxya':'2017-06-26T12:00:00.258870+00:00' ,'4PS3EDQ3dW1tci1Bp6543CfuuebjFrg36kLAUcskGfaA':'2017-06-26T12:10:00.258870+00:00',} timeout=10 Sending pool upgrade update_to_node_161 for version 0.3.161 Pool upgrade successful 3iERzawXTAvW8wJvsKfSNxnwnuKYwxHcWgxyZLV7eUf4 disconnected from Node1C 3iERzawXTAvW8wJvsKfSNxnwnuKYwxHcWgxyZLV7eUf4 now connected to Node1C 3iERzawXTAvW8wJvsKfSNxnwnuKYwxHcWgxyZLV7eUf4 disconnected from Node2C 3iERzawXTAvW8wJvsKfSNxnwnuKYwxHcWgxyZLV7eUf4 now connected to Node2C{code} {code:java} sovrin@test> send POOL_UPGRADE name=update_to_node_161_1 version=0.3.161 sha256=aad1443 action=start schedule={'Gw6pDLhcBcoQesN72qfotTgFa7cbuqZpkX3Xo6pLhPhv':'2017-06-26T12:10:00 .258870+00:00', '8ECVSk179mjsjKRLWiQtssMLgp6EPhWXtaYyStWPSGAb':'2017-06-26T12:15:00.258870+00:00', 'DKVxG2fXXTU8yT5N7hGEbXB3dfdAnYv1JczDUHpmDxya':'2017-06-26T12:20:00.258870+00:0 0','4PS3EDQ3dW1tci1Bp6543CfuuebjFrg36kLAUcskGfaA':'2017-06-26T12:25:00.258870+00:00',} timeout=10 Sending pool upgrade update_to_node_161_1 for version 0.3.161 Pool upgrade successful 3iERzawXTAvW8wJvsKfSNxnwnuKYwxHcWgxyZLV7eUf4 disconnected from Node3C 3iERzawXTAvW8wJvsKfSNxnwnuKYwxHcWgxyZLV7eUf4 now connected to Node3C 3iERzawXTAvW8wJvsKfSNxnwnuKYwxHcWgxyZLV7eUf4 disconnected from Node4C 3iERzawXTAvW8wJvsKfSNxnwnuKYwxHcWgxyZLV7eUf4 now connected to Node4C {code}  h6. Summary Scheduling 2nd upgrade to the same existing version does not leave to problems. Probably node discarding 2nd upgrade but there is no information about it in logs.  ></description> </Issue>
