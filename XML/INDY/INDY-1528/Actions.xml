<Action id="47920" issue="32241" author="ashcherbakov" type="comment" created="2018-07-26 15:51:17.0" updateauthor="ashcherbakov" updated="2018-07-26 15:51:17.0"> <body><! CDATA Options: 1) Use config ledger for permissions (a long-term option that solves everything) 2) Do the change in plugins, not in Indy code. It may be not so trivial and may require changes in both plugins and plugins support in general. 3) Have a flag (configuration) in config which defines whether trustAnchor role is required for Schema and ClaimDef. True by default. Custom products (with fees support) may set it to False during installation. A possible vulnerability if n-f Stewards set this flag to not require TrustAnchor role (but on the other hand if n-f malicious Stewards collaborated, they can do a lot of other awful things and break the system at all)  ></body> </Action>
<Action id="48244" issue="32241" author="derashe" type="comment" created="2018-08-01 11:28:22.0" updateauthor="derashe" updated="2018-08-03 08:45:04.0"> <body><! CDATA Problem reason: * We need to have config switcher to choose wether client can write requests to domain ledger  Changes: * Created config flag which allows to choose wich permission mode you want to use * Class Authoriser was modified to support switchable permissions.  Committed into: *  https://github.com/hyperledger/indy-node/pull/854  *  https://github.com/sovrin-foundation/sovrin/pull/76  * https://github.com/hyperledger/indy-node/pull/860  Risk: * Low  Covered with tests: * 4 integraton tests at indy-node/ indy_client/test/cli * 4 unit tests to test authorizer module  Recommendations for QA:  * Try to run pool with default config. Check that client can not send requests to domain ledger. * Try to run pool with config flag ANYONE_CAN_WRITE set to TRUE. Check that client can send requests to domain ledger.  ></body> </Action>
<Action id="48252" issue="32241" author="esplinr" type="comment" body="Thank you for making fast progress on this issue. After discussion with the Sovrin Foundation, we changed the policy to not require a Trust Anchor for any write. We updated the description to reflect this change." created="2018-08-01 13:58:07.0" updateauthor="esplinr" updated="2018-08-01 13:58:07.0"/>
<Action id="48334" issue="32241" author="derashe" type="comment" created="2018-08-03 09:03:42.0" updateauthor="derashe" updated="2018-08-03 12:30:02.0"> <body><! CDATA  ~esplinr , can you clarify some questions: * Can client send NYM transactions to create trust_anchor, steward, trustee? Or should he have permission to create only another client NYMs? * Should ATTRIB txn depends on config flag? Or should client be allowed to write ATTRIB in any case? * Should revocation txns also be depended on config flag?  ></body> </Action>
<Action id="48365" issue="32241" author="esplinr" type="comment" created="2018-08-03 13:35:24.0" updateauthor="esplinr" updated="2018-08-03 13:35:24.0"> <body><! CDATA Q. Can client send NYM transactions to create trust_anchor, steward, trustee? Or should he have permission to create only another client NYMs?  A. No. The ability to create a trust_anchor, steward, or trustee should be restricted from clients.   Q. Should ATTRIB txn depends on config flag? Or should client be allowed to write ATTRIB in any case?  A. A client should only be able to assign ATTRIBs to a NYM if the client is the owner of the NYM.   Q. Should revocation txns also be depended on config flag?  A. Only the issuer of a credential should be able to revoke the credential.  ></body> </Action>
<Action id="48435" issue="32241" author="ashcherbakov" type="comment" created="2018-08-06 12:30:09.0" updateauthor="esplinr" updated="2018-08-07 12:44:29.0"> <body><! CDATA  ~esplinr  To summarize, we propose the following rules:  *ANYONE_CAN_WRITE=True* * NYM: ** NYMs for common user (no role) can be created by anyone ** NYMs for Trustees/Stewards/TrustAnchor are controlled by roles (see permissions table) ** Only owner can edit existing NYMs * ATTRIB: ** Only owners can create and edit ATTRIBs * CLAIM_DEF: ** Anyone can create new CLAIM_DEFS ** Only owners can edit existing CLAIM_DEFs * SCHEMA: ** Anyone can create new SCHEMA ** No one can edit SCHEMAs * REVOC_REG_DEF: ** Anyone can create new REVOC_REG_DEF ** Only owners can edit existing REVOC_REG_DEF * REVOC_REG_ENTRY: ** Only the owner of the corresponding REVOC_REG_DEF can create new REVOC_REG_ENTRY (will be done in the scope of INDY-1554) ** Only owners can edit existing REVOC_REG_ENTRY * NODE: ** No changes (only Stewards can create and edit) * POOL_UPGRADE: ** No changes (only Trustees can create)  *Default Indy-Node behaviour (ANYONE_CAN_WRITE=False)*: There are some deviations from the existing behaviour, will be addressed in a separate ticket INDY-1554  * NYM: ** New NYMs can be created by Trustee/Steward/TrustAnchor only (see permissions table) ** Only owner can edit existing NYMs * ATTRIB: ** Only owners can create and edit ATTRIBs * CLAIM_DEF: ** Only Trustee/Steward/TrustAnchor can create new CLAIM_DEFS ** Only owners can edit existing CLAIM_DEFs * SCHEMA: ** Only Trustee/Steward/TrustAnchor can create new SCHEMA ** No one can edit SCHEMAs * REVOC_REG_DEF (will be done in the scope of INDY-1554): ** Only Trustee/Steward/TrustAnchor can create new REVOC_REG_DEF (will be done in the scope of INDY-1554) ** Only owners can edit existing REVOC_REG_DEF * REVOC_REG_ENTRY (will be done in the scope of INDY-1554): ** Only the owner of the corresponding REVOC_REG_DEF can create new REVOC_REG_ENTRY ** Only owners can edit existing REVOC_REG_ENTRY * NODE: ** Only Stewards can create and edit * POOL_UPGRADE: ** Only Trustees can create  ></body> </Action>
<Action id="48442" issue="32241" author="ashcherbakov" type="comment" body="We can update Acceptance Criteria if this looks OK" created="2018-08-06 13:28:40.0" updateauthor="ashcherbakov" updated="2018-08-06 13:28:40.0"/>
<Action id="48444" issue="32241" author="ashcherbakov" type="comment" body="Part of the items affects existing behaviour (for Revocation txns). Will be fixed in the scope of a separate issued INDY-1554." created="2018-08-06 14:10:02.0" updateauthor="ashcherbakov" updated="2018-08-06 14:10:02.0"/>
<Action id="48489" issue="32241" author="esplinr" type="comment" body="These permissions look great. Thank you." created="2018-08-07 12:43:42.0" updateauthor="esplinr" updated="2018-08-07 12:43:42.0"/>
<Action id="48496" issue="32241" author="ashcherbakov" type="comment" body="Build: 1.5.546" created="2018-08-07 15:01:27.0" updateauthor="ashcherbakov" updated="2018-08-07 15:01:27.0"/>
<Action id="48755" issue="32241" author="ozheregelya" type="comment" created="2018-08-11 11:24:10.0" updateauthor="ozheregelya" updated="2018-08-11 11:24:10.0"> <body><! CDATA {quote}*Acceptance Criteria* * Create a configuration setting: "writes-require-trust-anchor", default to True{quote} Parameter name is ANYONE_CAN_WRITE. It has the opposite meaning, so default value is False and roles behavior is not changed by default.  ></body> </Action>
<Action id="48761" issue="32241" author="ozheregelya" type="comment" created="2018-08-11 18:22:07.0" updateauthor="ozheregelya" updated="2018-08-11 18:22:07.0"> <body><! CDATA *Environment:* indy-node 1.6.558 libindy|indy-cli 1.6.1~701  *Steps to Validate:* 0. Make  sure that ANYONE_CAN_WRITE is False by default. 1. Run batches from attachment on pool with ANYONE_CAN_WRITE=True. 2. Run batches from attachment on pool with ANYONE_CAN_WRITE=False. 3. Compare outputs. => Identity Owner can write nym, schema, cred_def with ANYONE_CAN_WRITE=True and can't do this with ANYONE_CAN_WRITE=False. For the rest roles behavior is the same in both of cases. 4. Try to run _ledger node_ command as each user. => Only Steward can *add* new node and *edit* existing one (IP, porst, etc). Existing node can be *demoted* and *promoted* back by Steward of this node and by Trustee. 5. Try to run _ledger pool-upgrade_ command as each user. => Only Trustee can run pool upgrade.  *Actual Results:* New parameter was added, it's set to false by default and works correctly if it was set to True.  Pull request with changes in batches for acceptance testing:  https://github.com/hyperledger/indy-node/pull/890   *Additional Information:* {quote} * NODE: ** Only Stewards can create and edit{quote}  ~ashcherbakov , note that Trustee also can send NODE for node demotion/promotion. As far as I understand, this behavior should not be changed.  ></body> </Action>
