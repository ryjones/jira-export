<Issue id="20061" key="INDY-723" number="723" project="10303" reporter="vladimirwork" assignee="danielhardman" creator="vladimirwork" type="10004" summary=" POOL_UPGRADE  Upgrade to the same version doesn&apos;t work" priority="2" resolution="10000" status="10001" created="2017-08-09 11:32:21.0" updated="2019-03-29 20:35:10.0" resolutiondate="2019-03-29 20:35:10.0" votes="0" watches="2" workflowId="20061"> <description><! CDATA Build Info: indy-node 1.0.83  Overview: Upgrade to the same version doesn't work.  Preconditions: There is a pool of 1.0.83 version installed.  Steps to Reproduce: 1. Send "send POOL_UPGRADE name=upgrade83 version=1.0.83 sha256=ed0a366b4ef36d40c055672a8b83679e99246fec71a706b4ae4cb7958feace3f action=start schedule={'Gw6pDLhcBcoQesN72qfotTgFa7cbuqZpkX3Xo6pLhPhv': '2017-08-09T09:20:00.258870+00:00', '8ECVSk179mjsjKRLWiQtssMLgp6EPhWXtaYyStWPSGAb': '2017-08-09T09:25:00.258870+00:00', 'DKVxG2fXXTU8yT5N7hGEbXB3dfdAnYv1JczDUHpmDxya': '2017-08-09T09:30:00.258870+00:00', '4PS3EDQ3dW1tci1Bp6543CfuuebjFrg36kLAUcskGfaA': '2017-08-09T09:35:00.258870+00:00'} timeout=10 force=False reinstall=True"  Actual Results: Version is not reinstalled, there is a traceback in journalctl:  Aug 09 09:19:59 9f42abbfd607 env 187 : Traceback (most recent call last): Aug 09 09:19:59 9f42abbfd607 env 187 :   File "/usr/local/bin/start_sovrin_node", line 19, in <module> Aug 09 09:19:59 9f42abbfd607 env 187 :     run_node(config, self_name, int(sys.argv 2 ), int(sys.argv 3 )) Aug 09 09:19:59 9f42abbfd607 env 187 :   File "/usr/local/lib/python3.5/dist-packages/sovrin_node/utils/node_runner.py", line 29, in run_node Aug 09 09:19:59 9f42abbfd607 env 187 :     looper.run() Aug 09 09:19:59 9f42abbfd607 env 187 :   File "/usr/local/lib/python3.5/dist-packages/stp_core/loop/looper.py", line 284, in __exit__ Aug 09 09:19:59 9f42abbfd607 env 187 :     self.shutdownSync() Aug 09 09:19:59 9f42abbfd607 env 187 :   File "/usr/local/lib/python3.5/dist-packages/stp_core/loop/looper.py", line 280, in shutdownSync Aug 09 09:19:59 9f42abbfd607 env 187 :     self.loop.run_until_complete(self.shutdown()) Aug 09 09:19:59 9f42abbfd607 env 187 :   File "/usr/lib/python3.5/asyncio/base_events.py", line 387, in run_until_complete Aug 09 09:19:59 9f42abbfd607 env 187 :     return future.result() Aug 09 09:19:59 9f42abbfd607 env 187 :   File "/usr/lib/python3.5/asyncio/futures.py", line 274, in result Aug 09 09:19:59 9f42abbfd607 env 187 :     raise self._exception Aug 09 09:19:59 9f42abbfd607 env 187 :   File "/usr/lib/python3.5/asyncio/tasks.py", line 239, in _step Aug 09 09:19:59 9f42abbfd607 env 187 :     result = coro.send(None) Aug 09 09:19:59 9f42abbfd607 env 187 :   File "/usr/local/lib/python3.5/dist-packages/stp_core/loop/looper.py", line 270, in shutdown Aug 09 09:19:59 9f42abbfd607 env 187 :     await self.runFut Aug 09 09:19:59 9f42abbfd607 env 187 :   File "/usr/lib/python3.5/asyncio/futures.py", line 363, in __iter__ Aug 09 09:19:59 9f42abbfd607 env 187 :     return self.result()  # May raise too. Aug 09 09:19:59 9f42abbfd607 env 187 :   File "/usr/lib/python3.5/asyncio/futures.py", line 274, in result Aug 09 09:19:59 9f42abbfd607 env 187 :     raise self._exception Aug 09 09:19:59 9f42abbfd607 env 187 :   File "/usr/local/lib/python3.5/dist-packages/sovrin_node/utils/node_runner.py", line 29, in run_node Aug 09 09:19:59 9f42abbfd607 env 187 :     looper.run() Aug 09 09:19:59 9f42abbfd607 env 187 :   File "/usr/local/lib/python3.5/dist-packages/stp_core/loop/looper.py", line 254, in run Aug 09 09:19:59 9f42abbfd607 env 187 :     return self.loop.run_until_complete(what) Aug 09 09:19:59 9f42abbfd607 env 187 :   File "/usr/lib/python3.5/asyncio/base_events.py", line 387, in run_until_complete Aug 09 09:19:59 9f42abbfd607 env 187 :     return future.result() Aug 09 09:19:59 9f42abbfd607 env 187 :   File "/usr/lib/python3.5/asyncio/futures.py", line 274, in result Aug 09 09:19:59 9f42abbfd607 env 187 :     raise self._exception Aug 09 09:19:59 9f42abbfd607 env 187 :   File "/usr/lib/python3.5/asyncio/tasks.py", line 239, in _step Aug 09 09:19:59 9f42abbfd607 env 187 :     result = coro.send(None) Aug 09 09:19:59 9f42abbfd607 env 187 :   File "/usr/local/lib/python3.5/dist-packages/stp_core/loop/looper.py", line 218, in runForever Aug 09 09:19:59 9f42abbfd607 env 187 :     await self.runOnceNicely() Aug 09 09:19:59 9f42abbfd607 env 187 :   File "/usr/lib/python3.5/asyncio/coroutines.py", line 105, in __next__ Aug 09 09:19:59 9f42abbfd607 env 187 :     return self.gen.send(None) Aug 09 09:19:59 9f42abbfd607 env 187 :   File "/usr/local/lib/python3.5/dist-packages/stp_core/loop/looper.py", line 202, in runOnceNicely Aug 09 09:19:59 9f42abbfd607 env 187 :     msgsProcessed = await self.prodAllOnce() Aug 09 09:19:59 9f42abbfd607 env 187 :   File "/usr/lib/python3.5/asyncio/coroutines.py", line 105, in __next__ Aug 09 09:19:59 9f42abbfd607 env 187 :     return self.gen.send(None) Aug 09 09:19:59 9f42abbfd607 env 187 :   File "/usr/local/lib/python3.5/dist-packages/stp_core/loop/looper.py", line 147, in prodAllOnce Aug 09 09:19:59 9f42abbfd607 env 187 :     s += await n.prod(limit) Aug 09 09:19:59 9f42abbfd607 env 187 :   File "/usr/lib/python3.5/asyncio/coroutines.py", line 105, in __next__ Aug 09 09:19:59 9f42abbfd607 env 187 :     return self.gen.send(None) Aug 09 09:19:59 9f42abbfd607 env 187 :   File "/usr/local/lib/python3.5/dist-packages/sovrin_node/server/node.py", line 366, in prod Aug 09 09:19:59 9f42abbfd607 env 187 :     c += self.upgrader.service() Aug 09 09:19:59 9f42abbfd607 env 187 :   File "/usr/local/lib/python3.5/dist-packages/sovrin_node/server/upgrader.py", line 134, in service Aug 09 09:19:59 9f42abbfd607 env 187 :     return self._serviceActions() Aug 09 09:19:59 9f42abbfd607 env 187 :   File "/usr/local/lib/python3.5/dist-packages/plenum/server/has_action_queue.py", line 65, in _serviceActions Aug 09 09:19:59 9f42abbfd607 env 187 :     action() Aug 09 09:19:59 9f42abbfd607 env 187 :   File "/usr/local/lib/python3.5/dist-packages/sovrin_node/server/upgrader.py", line 433, in _callUpgradeAgent Aug 09 09:19:59 9f42abbfd607 env 187 :     self._upgrade_start_callback() Aug 09 09:19:59 9f42abbfd607 env 187 :   File "/usr/local/lib/python3.5/dist-packages/sovrin_node/server/node.py", line 260, in notify_upgrade_start Aug 09 09:19:59 9f42abbfd607 env 187 :     scheduled_upgrade_version = self.upgrader.scheduledUpgrade 0  Aug 09 09:19:59 9f42abbfd607 env 187 : TypeError: 'NoneType' object is not subscriptable  Expected Results: Upgrader should reinstall the current version.  Additional Info: systemctl status sovrin-node.service displays the same traceback above after the upgrade.  ></description> </Issue>
