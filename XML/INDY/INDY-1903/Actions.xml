<Action id="54557" issue="36019" author="sergey.khoroshavin" type="comment" created="2018-12-10 10:47:59.0" updateauthor="sergey.khoroshavin" updated="2018-12-10 11:29:44.0"> <body><! CDATA Investigation of log files from _ev1_ node showed the following: * ordering was performed on all instances except 3 and 5 until 2018-12-08 05:24:43 * 05:25:37: first INSTANCE_CHANGE(viewNo: 3, reason: 26) messages started to appear signaling that nodes lost connection to master primary * 05:25:54: _ev1_ also lost connection to master primary (which was _danube_) * 05:25:56: first message requests of LEDGER_STATUS started to appear, which could be indication that some nodes started view change with following catch up * 05:25:56: _ev1_ also decided to send INSTANCE_CHANGE(viewNo: 3, reason: 26), but quorum still wasn't reached * 05:25:57: first VIEW_CHANGE_DONE(viewNo: 3, name 'royal_sovrin') messages started to appear signaling that nodes are trying to finish view change * 05:26:00: there was single INSTANCE_CHANGE(viewNo: 4, reason: 26) from _iRespond_, which means that _iRespond_ lost connection to new master primary which is _royal_sovrin_ * 05:26:12: connection to _danube_ was reestablished, and _danube_ was seemingly restored to have viewNo 2 * 05:29:43: request from client was received (seems like it was monitoring ATTRIB transaction), and there was attempt to order it in view 2, but quorum wasn't reached * 05:32:56: INSTANCE_CHANGE(viewNo: 4, reason: 28) messages started to appear signaling that nodes that started view change to view 3 were not able to finish it (most probably due to lack of quorum of VIEW_CHANGE_DONE messages) and trying to move to next view, but quorum wasn't reached * after that nothing happened except periodic failed attempts to order incoming requests  Seems like there are *24* active validator nodes, so *f=7* and *n-f=17* Before view change 3PC consensus messages were coming from all nodes. Instance change request to view 3 was received from following 15 nodes (16 if counting _ev1_, *1 less than needed to reach quorum*): * Aalto * amihan-sovrin (18 seconds earlier than others) * atbsovrin * BIGAWSUSEAST1-001 * digitalbazaar (18 seconds earlier than others) * DustStorm * ibm * icenode * NewtonD (18 seconds earlier than others) * prosovitor (simultaneous with ledger status request) * ServerVS * Stuard * TNO * VeridiumIDC * zaValidator  Ledger status requests and view change done messages were received from following nodes 16 nodes (*1 less than needed to reach quorum*): * Aalto * atbsovrin * BIGAWSUSEAST1-001 * digitalbazaar * esatus_AG * findentity * icenode * iRespond (later than others, simultaneous with IC(4, 26)) * OASFCU * pcValidator01 * prosovitor * royal_sovrin * ServerVS * Stuard * trustscience-validator02 * VeridiumIDC  When trying to order new incoming requests following 7 (8 if counting _ev1_) nodes were sending 3PC consensus messages related to view 2 (so they were definitely not in view change): * amihan-sovrin * danube * DustStorm * ibm * NewtonD * TNO * zaValidator   ></body> </Action>
<Action id="54628" issue="36019" author="mgbailey" type="comment" body="Uploading updated ev1 logs:  ^ev1_log_20181210.tgz " created="2018-12-10 21:35:55.0" updateauthor="mgbailey" updated="2018-12-10 21:35:55.0"/>
<Action id="54656" issue="36019" author="sergey.khoroshavin" type="comment" created="2018-12-11 11:32:47.0" updateauthor="sergey.khoroshavin" updated="2018-12-11 11:32:47.0"> <body><! CDATA Analysis of logs from *danube* showed that it was indeed a short network outage and not a restart, as originally thought. Also not all connections were disrupted long enough, so just 16 nodes (which is less than _n-f_) should have sent INSTANCE_CHANGE(3, 26), which *correlates with previous observations*. {code} 2018-12-08 05:25:53,947|NOTIFICATION|keep_in_touch.py|CONNECTION: danube disconnected from VeridiumIDC 2018-12-08 05:25:54,059|NOTIFICATION|keep_in_touch.py|CONNECTION: danube disconnected from Aalto 2018-12-08 05:25:54,059|NOTIFICATION|keep_in_touch.py|CONNECTION: danube disconnected from Stuard 2018-12-08 05:25:54,059|NOTIFICATION|keep_in_touch.py|CONNECTION: danube disconnected from icenode 2018-12-08 05:25:54,059|NOTIFICATION|keep_in_touch.py|CONNECTION: danube disconnected from TNO 2018-12-08 05:25:54,059|NOTIFICATION|keep_in_touch.py|CONNECTION: danube disconnected from ServerVS 2018-12-08 05:25:54,240|NOTIFICATION|keep_in_touch.py|CONNECTION: danube disconnected from BIGAWSUSEAST1-001 2018-12-08 05:25:54,260|NOTIFICATION|keep_in_touch.py|CONNECTION: danube disconnected from digitalbazaar 2018-12-08 05:25:54,314|NOTIFICATION|keep_in_touch.py|CONNECTION: danube disconnected from ibm 2018-12-08 05:25:54,435|NOTIFICATION|keep_in_touch.py|CONNECTION: danube disconnected from zaValidator 2018-12-08 05:25:54,435|NOTIFICATION|keep_in_touch.py|CONNECTION: danube disconnected from iRespond 2018-12-08 05:25:54,435|NOTIFICATION|keep_in_touch.py|CONNECTION: danube disconnected from prosovitor 2018-12-08 05:25:54,435|NOTIFICATION|keep_in_touch.py|CONNECTION: danube disconnected from DustStorm 2018-12-08 05:25:54,453|NOTIFICATION|keep_in_touch.py|CONNECTION: danube disconnected from atbsovrin 2018-12-08 05:25:54,566|NOTIFICATION|keep_in_touch.py|CONNECTION: danube disconnected from ev1 2018-12-08 05:25:54,819|NOTIFICATION|keep_in_touch.py|CONNECTION: danube disconnected from amihan-sovrin 2018-12-08 05:26:18,926|NOTIFICATION|keep_in_touch.py|CONNECTION: danube now connected to digitalbazaar 2018-12-08 05:26:18,926|NOTIFICATION|keep_in_touch.py|CONNECTION: danube now connected to BIGAWSUSEAST1-001 2018-12-08 05:26:19,356|NOTIFICATION|keep_in_touch.py|CONNECTION: danube now connected to atbsovrin 2018-12-08 05:26:19,448|NOTIFICATION|keep_in_touch.py|CONNECTION: danube now connected to iRespond 2018-12-08 05:26:21,475|NOTIFICATION|keep_in_touch.py|CONNECTION: danube now connected to zaValidator 2018-12-08 05:26:21,476|NOTIFICATION|keep_in_touch.py|CONNECTION: danube now connected to TNO 2018-12-08 05:26:21,703|NOTIFICATION|keep_in_touch.py|CONNECTION: danube now connected to Aalto 2018-12-08 05:26:22,177|NOTIFICATION|keep_in_touch.py|CONNECTION: danube now connected to ibm 2018-12-08 05:26:25,929|NOTIFICATION|keep_in_touch.py|CONNECTION: danube now connected to Stuard 2018-12-08 05:26:26,357|NOTIFICATION|keep_in_touch.py|CONNECTION: danube now connected to DustStorm 2018-12-08 05:26:28,119|NOTIFICATION|keep_in_touch.py|CONNECTION: danube now connected to icenode 2018-12-08 05:26:29,191|NOTIFICATION|keep_in_touch.py|CONNECTION: danube now connected to ev1 2018-12-08 05:26:33,294|NOTIFICATION|keep_in_touch.py|CONNECTION: danube now connected to VeridiumIDC 2018-12-08 05:26:33,324|NOTIFICATION|keep_in_touch.py|CONNECTION: danube now connected to ServerVS 2018-12-08 05:26:33,442|NOTIFICATION|keep_in_touch.py|CONNECTION: danube now connected to prosovitor 2018-12-08 05:26:33,593|NOTIFICATION|keep_in_touch.py|CONNECTION: danube now connected to amihan-sovrin {code}  Analysis of logs from *trustscience-validator02* showed that there were some INSTANCE_CHANGE messages stashed on this node since last restart and view change, which led to reaching INSTANCE_CHANGE quorum even though number of nodes affected by connectivity issues with *danube* was less than _n-f_. {code} 2018-11-16 17:28:45,626|INFO|node.py|trustscience-validator02 started participating 2018-11-20 02:04:47,908|INFO|view_changer.py|trustscience-validator02 received instance change request: INSTANCE_CHANGE{'reason': 26, 'viewNo': 3} from esatus_AG 2018-11-21 06:28:59,483|INFO|view_changer.py|trustscience-validator02 received instance change request: INSTANCE_CHANGE{'reason': 26, 'viewNo': 3} from amihan-sovrin 2018-11-21 06:29:39,192|INFO|view_changer.py|trustscience-validator02 received instance change request: INSTANCE_CHANGE{'reason': 26, 'viewNo': 3} from amihan-sovrin 2018-11-21 06:57:02,945|INFO|view_changer.py|trustscience-validator02 received instance change request: INSTANCE_CHANGE{'reason': 26, 'viewNo': 3} from amihan-sovrin 2018-11-21 12:18:49,536|INFO|view_changer.py|trustscience-validator02 received instance change request: INSTANCE_CHANGE{'reason': 26, 'viewNo': 3} from DustStorm 2018-11-21 12:35:25,731|INFO|view_changer.py|trustscience-validator02 received instance change request: INSTANCE_CHANGE{'reason': 26, 'viewNo': 3} from DustStorm 2018-11-21 12:37:24,494|INFO|view_changer.py|trustscience-validator02 received instance change request: INSTANCE_CHANGE{'reason': 26, 'viewNo': 3} from DustStorm 2018-11-21 12:38:36,052|INFO|view_changer.py|trustscience-validator02 received instance change request: INSTANCE_CHANGE{'reason': 26, 'viewNo': 3} from DustStorm 2018-11-21 13:10:56,172|INFO|view_changer.py|trustscience-validator02 received instance change request: INSTANCE_CHANGE{'reason': 26, 'viewNo': 3} from DustStorm 2018-11-21 13:11:56,186|INFO|view_changer.py|trustscience-validator02 received instance change request: INSTANCE_CHANGE{'reason': 26, 'viewNo': 3} from DustStorm 2018-11-21 13:12:33,498|INFO|view_changer.py|trustscience-validator02 received instance change request: INSTANCE_CHANGE{'reason': 26, 'viewNo': 3} from DustStorm 2018-11-21 13:12:36,527|INFO|view_changer.py|trustscience-validator02 received instance change request: INSTANCE_CHANGE{'reason': 26, 'viewNo': 3} from atbsovrin 2018-11-21 17:37:41,063|INFO|view_changer.py|trustscience-validator02 received instance change request: INSTANCE_CHANGE{'reason': 26, 'viewNo': 3} from icenode 2018-11-21 20:47:27,820|INFO|view_changer.py|trustscience-validator02 received instance change request: INSTANCE_CHANGE{'reason': 26, 'viewNo': 3} from icenode 2018-11-21 20:47:31,092|INFO|view_changer.py|trustscience-validator02 received instance change request: INSTANCE_CHANGE{'reason': 26, 'viewNo': 3} from Stuard 2018-11-21 20:48:27,838|INFO|view_changer.py|trustscience-validator02 received instance change request: INSTANCE_CHANGE{'reason': 26, 'viewNo': 3} from icenode 2018-11-21 20:48:31,106|INFO|view_changer.py|trustscience-validator02 received instance change request: INSTANCE_CHANGE{'reason': 26, 'viewNo': 3} from Stuard 2018-11-21 21:28:17,666|INFO|view_changer.py|trustscience-validator02 received instance change request: INSTANCE_CHANGE{'reason': 26, 'viewNo': 3} from icenode 2018-11-21 21:28:37,668|INFO|view_changer.py|trustscience-validator02 received instance change request: INSTANCE_CHANGE{'reason': 26, 'viewNo': 3} from Stuard 2018-11-21 21:29:17,676|INFO|view_changer.py|trustscience-validator02 received instance change request: INSTANCE_CHANGE{'reason': 26, 'viewNo': 3} from icenode 2018-11-21 21:29:37,698|INFO|view_changer.py|trustscience-validator02 received instance change request: INSTANCE_CHANGE{'reason': 26, 'viewNo': 3} from Stuard 2018-11-25 06:30:49,558|INFO|view_changer.py|trustscience-validator02 received instance change request: INSTANCE_CHANGE{'reason': 26, 'viewNo': 3} from icenode 2018-11-27 19:13:48,993|INFO|view_changer.py|trustscience-validator02 received instance change request: INSTANCE_CHANGE{'reason': 26, 'viewNo': 3} from zaValidator 2018-11-27 19:14:49,002|INFO|view_changer.py|trustscience-validator02 received instance change request: INSTANCE_CHANGE{'reason': 26, 'viewNo': 3} from zaValidator 2018-11-29 00:17:27,639|INFO|view_changer.py|trustscience-validator02 received instance change request: INSTANCE_CHANGE{'reason': 26, 'viewNo': 3} from icenode 2018-11-29 00:17:35,991|INFO|view_changer.py|trustscience-validator02 received instance change request: INSTANCE_CHANGE{'reason': 26, 'viewNo': 3} from OASFCU 2018-11-29 00:17:35,993|INFO|view_changer.py|trustscience-validator02 received instance change request: INSTANCE_CHANGE{'reason': 26, 'viewNo': 3} from esatus_AG 2018-11-29 00:18:27,647|INFO|view_changer.py|trustscience-validator02 received instance change request: INSTANCE_CHANGE{'reason': 26, 'viewNo': 3} from icenode 2018-11-29 00:18:35,998|INFO|view_changer.py|trustscience-validator02 received instance change request: INSTANCE_CHANGE{'reason': 26, 'viewNo': 3} from OASFCU 2018-11-29 00:18:36,019|INFO|view_changer.py|trustscience-validator02 received instance change request: INSTANCE_CHANGE{'reason': 26, 'viewNo': 3} from esatus_AG 2018-11-29 00:19:27,662|INFO|view_changer.py|trustscience-validator02 received instance change request: INSTANCE_CHANGE{'reason': 26, 'viewNo': 3} from icenode 2018-11-29 00:19:36,015|INFO|view_changer.py|trustscience-validator02 received instance change request: INSTANCE_CHANGE{'reason': 26, 'viewNo': 3} from OASFCU 2018-11-29 06:31:55,613|INFO|view_changer.py|trustscience-validator02 received instance change request: INSTANCE_CHANGE{'reason': 26, 'viewNo': 3} from esatus_AG 2018-12-01 06:31:36,454|INFO|view_changer.py|trustscience-validator02 received instance change request: INSTANCE_CHANGE{'reason': 26, 'viewNo': 3} from icenode 2018-12-01 22:03:59,513|INFO|view_changer.py|trustscience-validator02 received instance change request: INSTANCE_CHANGE{'reason': 26, 'viewNo': 3} from TNO 2018-12-02 07:24:45,461|INFO|view_changer.py|trustscience-validator02 received instance change request: INSTANCE_CHANGE{'reason': 26, 'viewNo': 3} from digitalbazaar 2018-12-07 02:26:32,277|INFO|view_changer.py|trustscience-validator02 received instance change request: INSTANCE_CHANGE{'reason': 26, 'viewNo': 3} from amihan-sovrin 2018-12-08 05:27:21,267|INFO|view_changer.py|trustscience-validator02 received instance change request: INSTANCE_CHANGE{'reason': 26, 'viewNo': 3} from digitalbazaar 2018-12-08 05:27:21,777|INFO|view_changer.py|trustscience-validator02 received instance change request: INSTANCE_CHANGE{'reason': 26, 'viewNo': 3} from amihan-sovrin 2018-12-08 05:27:22,018|INFO|view_changer.py|trustscience-validator02 received instance change request: INSTANCE_CHANGE{'reason': 26, 'viewNo': 3} from NewtonD 2018-12-08 05:27:39,892|INFO|view_changer.py|trustscience-validator02 received instance change request: INSTANCE_CHANGE{'reason': 26, 'viewNo': 3} from ServerVS 2018-12-08 05:27:39,913|INFO|view_changer.py|trustscience-validator02 received instance change request: INSTANCE_CHANGE{'reason': 26, 'viewNo': 3} from VeridiumIDC 2018-12-08 05:27:39,949|INFO|view_changer.py|trustscience-validator02 received instance change request: INSTANCE_CHANGE{'reason': 26, 'viewNo': 3} from TNO 2018-12-08 05:27:39,998|INFO|view_changer.py|trustscience-validator02 received instance change request: INSTANCE_CHANGE{'reason': 26, 'viewNo': 3} from Stuard 2018-12-08 05:27:40,004|INFO|view_changer.py|trustscience-validator02 received instance change request: INSTANCE_CHANGE{'reason': 26, 'viewNo': 3} from icenode 2018-12-08 05:27:40,010|INFO|view_changer.py|trustscience-validator02 received instance change request: INSTANCE_CHANGE{'reason': 26, 'viewNo': 3} from Aalto 2018-12-08 05:27:40,045|INFO|view_changer.py|trustscience-validator02 received instance change request: INSTANCE_CHANGE{'reason': 26, 'viewNo': 3} from BIGAWSUSEAST1-001 2018-12-08 05:27:40,185|INFO|view_changer.py|trustscience-validator02 received instance change request: INSTANCE_CHANGE{'reason': 26, 'viewNo': 3} from ibm 2018-12-08 05:27:40,192|INFO|view_changer.py|trustscience-validator02 received instance change request: INSTANCE_CHANGE{'reason': 26, 'viewNo': 3} from atbsovrin 2018-12-08 05:27:40,284|INFO|view_changer.py|trustscience-validator02 received instance change request: INSTANCE_CHANGE{'reason': 26, 'viewNo': 3} from DustStorm 2018-12-08 05:27:40,291|INFO|view_changer.py|trustscience-validator02 received instance change request: INSTANCE_CHANGE{'reason': 26, 'viewNo': 3} from prosovitor 2018-12-08 05:27:40,291|NOTIFICATION|view_changer.py|VIEW CHANGE: trustscience-validator02 initiating a view change to 3 from 2 {code}   ></body> </Action>
<Action id="54659" issue="36019" author="sergey.khoroshavin" type="comment" created="2018-12-11 12:27:12.0" updateauthor="sergey.khoroshavin" updated="2018-12-11 12:27:12.0"> <body><! CDATA Logs from *findentity* show same situation as in *trustsience-validator02*: {code} 2018-11-16 17:27:19,684|INFO|node.py|findentity started participating 2018-11-20 02:03:19,330|INFO|view_changer.py|findentity received instance change request: INSTANCE_CHANGE{'reason': 26, 'viewNo': 3} from esatus_AG 2018-11-21 06:27:29,974|INFO|view_changer.py|findentity received instance change request: INSTANCE_CHANGE{'reason': 26, 'viewNo': 3} from amihan-sovrin 2018-11-21 06:28:09,679|INFO|view_changer.py|findentity received instance change request: INSTANCE_CHANGE{'reason': 26, 'viewNo': 3} from amihan-sovrin 2018-11-21 06:55:33,420|INFO|view_changer.py|findentity received instance change request: INSTANCE_CHANGE{'reason': 26, 'viewNo': 3} from amihan-sovrin 2018-11-21 12:17:19,822|INFO|view_changer.py|findentity received instance change request: INSTANCE_CHANGE{'reason': 26, 'viewNo': 3} from DustStorm 2018-11-21 12:33:56,012|INFO|view_changer.py|findentity received instance change request: INSTANCE_CHANGE{'reason': 26, 'viewNo': 3} from DustStorm 2018-11-21 12:35:54,763|INFO|view_changer.py|findentity received instance change request: INSTANCE_CHANGE{'reason': 26, 'viewNo': 3} from DustStorm 2018-11-21 12:37:06,324|INFO|view_changer.py|findentity received instance change request: INSTANCE_CHANGE{'reason': 26, 'viewNo': 3} from DustStorm 2018-11-21 13:09:26,438|INFO|view_changer.py|findentity received instance change request: INSTANCE_CHANGE{'reason': 26, 'viewNo': 3} from DustStorm 2018-11-21 13:10:26,454|INFO|view_changer.py|findentity received instance change request: INSTANCE_CHANGE{'reason': 26, 'viewNo': 3} from DustStorm 2018-11-21 13:11:03,754|INFO|view_changer.py|findentity received instance change request: INSTANCE_CHANGE{'reason': 26, 'viewNo': 3} from DustStorm 2018-11-21 13:11:06,791|INFO|view_changer.py|findentity received instance change request: INSTANCE_CHANGE{'reason': 26, 'viewNo': 3} from atbsovrin 2018-11-21 17:36:11,182|INFO|view_changer.py|findentity received instance change request: INSTANCE_CHANGE{'reason': 26, 'viewNo': 3} from icenode 2018-11-21 20:45:57,821|INFO|view_changer.py|findentity received instance change request: INSTANCE_CHANGE{'reason': 26, 'viewNo': 3} from icenode 2018-11-21 20:46:01,091|INFO|view_changer.py|findentity received instance change request: INSTANCE_CHANGE{'reason': 26, 'viewNo': 3} from Stuard 2018-11-21 20:46:57,832|INFO|view_changer.py|findentity received instance change request: INSTANCE_CHANGE{'reason': 26, 'viewNo': 3} from icenode 2018-11-21 20:47:01,103|INFO|view_changer.py|findentity received instance change request: INSTANCE_CHANGE{'reason': 26, 'viewNo': 3} from Stuard 2018-11-21 21:26:47,644|INFO|view_changer.py|findentity received instance change request: INSTANCE_CHANGE{'reason': 26, 'viewNo': 3} from icenode 2018-11-21 21:27:07,643|INFO|view_changer.py|findentity received instance change request: INSTANCE_CHANGE{'reason': 26, 'viewNo': 3} from Stuard 2018-11-21 21:27:47,658|INFO|view_changer.py|findentity received instance change request: INSTANCE_CHANGE{'reason': 26, 'viewNo': 3} from icenode 2018-11-21 21:28:07,668|INFO|view_changer.py|findentity received instance change request: INSTANCE_CHANGE{'reason': 26, 'viewNo': 3} from Stuard 2018-11-25 06:29:16,664|INFO|view_changer.py|findentity received instance change request: INSTANCE_CHANGE{'reason': 26, 'viewNo': 3} from icenode 2018-11-27 19:12:13,956|INFO|view_changer.py|findentity received instance change request: INSTANCE_CHANGE{'reason': 26, 'viewNo': 3} from zaValidator 2018-11-27 19:13:13,976|INFO|view_changer.py|findentity received instance change request: INSTANCE_CHANGE{'reason': 26, 'viewNo': 3} from zaValidator 2018-11-29 00:15:51,589|INFO|view_changer.py|findentity received instance change request: INSTANCE_CHANGE{'reason': 26, 'viewNo': 3} from icenode 2018-11-29 00:15:59,942|INFO|view_changer.py|findentity received instance change request: INSTANCE_CHANGE{'reason': 26, 'viewNo': 3} from esatus_AG 2018-11-29 00:15:59,944|INFO|view_changer.py|findentity received instance change request: INSTANCE_CHANGE{'reason': 26, 'viewNo': 3} from OASFCU 2018-11-29 00:16:51,616|INFO|view_changer.py|findentity received instance change request: INSTANCE_CHANGE{'reason': 26, 'viewNo': 3} from icenode 2018-11-29 00:16:59,955|INFO|view_changer.py|findentity received instance change request: INSTANCE_CHANGE{'reason': 26, 'viewNo': 3} from OASFCU 2018-11-29 00:16:59,974|INFO|view_changer.py|findentity received instance change request: INSTANCE_CHANGE{'reason': 26, 'viewNo': 3} from esatus_AG 2018-11-29 00:17:51,612|INFO|view_changer.py|findentity received instance change request: INSTANCE_CHANGE{'reason': 26, 'viewNo': 3} from icenode 2018-11-29 00:17:59,969|INFO|view_changer.py|findentity received instance change request: INSTANCE_CHANGE{'reason': 26, 'viewNo': 3} from OASFCU 2018-11-29 06:30:19,339|INFO|view_changer.py|findentity received instance change request: INSTANCE_CHANGE{'reason': 26, 'viewNo': 3} from esatus_AG 2018-12-01 06:29:58,517|INFO|view_changer.py|findentity received instance change request: INSTANCE_CHANGE{'reason': 26, 'viewNo': 3} from icenode 2018-12-01 22:02:21,007|INFO|view_changer.py|findentity received instance change request: INSTANCE_CHANGE{'reason': 26, 'viewNo': 3} from TNO 2018-12-02 07:23:06,645|INFO|view_changer.py|findentity received instance change request: INSTANCE_CHANGE{'reason': 26, 'viewNo': 3} from digitalbazaar 2018-12-07 02:24:24,415|INFO|view_changer.py|findentity received instance change request: INSTANCE_CHANGE{'reason': 26, 'viewNo': 3} from amihan-sovrin 2018-12-08 05:25:37,465|INFO|view_changer.py|findentity received instance change request: INSTANCE_CHANGE{'reason': 26, 'viewNo': 3} from digitalbazaar 2018-12-08 05:25:37,976|INFO|view_changer.py|findentity received instance change request: INSTANCE_CHANGE{'reason': 26, 'viewNo': 3} from amihan-sovrin 2018-12-08 05:25:38,208|INFO|view_changer.py|findentity received instance change request: INSTANCE_CHANGE{'reason': 26, 'viewNo': 3} from NewtonD 2018-12-08 05:25:56,101|INFO|view_changer.py|findentity received instance change request: INSTANCE_CHANGE{'reason': 26, 'viewNo': 3} from ServerVS 2018-12-08 05:25:56,106|INFO|view_changer.py|findentity received instance change request: INSTANCE_CHANGE{'reason': 26, 'viewNo': 3} from VeridiumIDC 2018-12-08 05:25:56,165|INFO|view_changer.py|findentity received instance change request: INSTANCE_CHANGE{'reason': 26, 'viewNo': 3} from TNO 2018-12-08 05:25:56,183|INFO|view_changer.py|findentity received instance change request: INSTANCE_CHANGE{'reason': 26, 'viewNo': 3} from Stuard 2018-12-08 05:25:56,202|INFO|view_changer.py|findentity received instance change request: INSTANCE_CHANGE{'reason': 26, 'viewNo': 3} from icenode 2018-12-08 05:25:56,220|INFO|view_changer.py|findentity received instance change request: INSTANCE_CHANGE{'reason': 26, 'viewNo': 3} from Aalto 2018-12-08 05:25:56,239|INFO|view_changer.py|findentity received instance change request: INSTANCE_CHANGE{'reason': 26, 'viewNo': 3} from BIGAWSUSEAST1-001 2018-12-08 05:25:56,367|INFO|view_changer.py|findentity received instance change request: INSTANCE_CHANGE{'reason': 26, 'viewNo': 3} from ibm 2018-12-08 05:25:56,386|INFO|view_changer.py|findentity received instance change request: INSTANCE_CHANGE{'reason': 26, 'viewNo': 3} from atbsovrin 2018-12-08 05:25:56,471|INFO|view_changer.py|findentity received instance change request: INSTANCE_CHANGE{'reason': 26, 'viewNo': 3} from DustStorm 2018-12-08 05:25:56,491|INFO|view_changer.py|findentity received instance change request: INSTANCE_CHANGE{'reason': 26, 'viewNo': 3} from prosovitor 2018-12-08 05:25:56,491|NOTIFICATION|view_changer.py|VIEW CHANGE: findentity initiating a view change to 3 from 2 {code}  ></body> </Action>
<Action id="54680" issue="36019" author="mgbailey" type="comment" body=" ~sergey.khoroshavin  More ev1 logs are  here|https://drive.google.com/file/d/1AiCbNrEY5ONsy73ppE3AU9bnN-5Msis4/view?usp=sharing " created="2018-12-11 16:52:56.0" updateauthor="mgbailey" updated="2018-12-11 16:52:56.0"/>
<Action id="54681" issue="36019" author="mgbailey" type="comment" created="2018-12-11 17:08:20.0" updateauthor="mgbailey" updated="2018-12-11 17:14:14.0"> <body><! CDATA  ~sergey.khoroshavin  attached are the logs for one of the nodes that did not come into consensus. This is for ibm, which is a non-standard node running supervisord (docker) instead of systemd. It is likely that the restart command malfunctioned on this node because of that.  ^ibm-mainnet-validator-logs.tar.gz   P.S. They have restarted their node, and it is in consensus now.   ></body> </Action>
<Action id="54704" issue="36019" author="peacekeeper" type="comment" body="All this was caused by a network outage of less than 1 minute? If it helps, I can say that we certainly didn&apos;t restart or otherwise do anything special on the *danube* node around that time." created="2018-12-12 03:36:20.0" updateauthor="peacekeeper" updated="2018-12-12 03:36:20.0"/>
<Action id="54707" issue="36019" author="sergey.khoroshavin" type="comment" created="2018-12-12 11:12:33.0" updateauthor="sergey.khoroshavin" updated="2018-12-12 12:09:42.0"> <body><! CDATA  ~peacekeeper  Well, actually this was caused by different events that were happening throughout 3 weeks period (more precisely 2018-11-16 17:27 UTC till 2018-12-08 05:25 UTC), and last network outage was just a final trigger for the incident. Also from my point of view incident happened not because *danube* was somewhat misbehaving (on purpose or not), but because there is a serious shortcoming in current protocol implementation that was there from the very beginning, and it was just a big misfortune that it was uncovered only now and in such unpleasant circumstances. More information can be found in already posted  incident report|https://forum.sovrin.org/t/sovrin-main-net-outage-december-2018/1010 , and I'm going to add some more details here soon.  ></body> </Action>
<Action id="54709" issue="36019" author="sergey.khoroshavin" type="comment" created="2018-12-12 12:15:38.0" updateauthor="sergey.khoroshavin" updated="2018-12-12 12:15:38.0"> <body><! CDATA Analysis of logs from *TNO* (which was one of nodes that didn't enter view change) showed that it was indeed restarted during timeframe when *danube* was master primary, so it flushed previously accumulated INSTANCE_CHANGE messages, which resulted in  not achieving quorum during last network outage {code} 2018-11-30 21:33:02,311|INFO|node.py|TNO reseting... 2018-11-30 21:33:13,913|INFO|node.py|TNO started participating 2018-12-01 06:30:15,711|INFO|view_changer.py|TNO received instance change request: INSTANCE_CHANGE{'reason': 26, 'viewNo': 3} from icenode 2018-12-02 07:23:20,155|INFO|view_changer.py|TNO received instance change request: INSTANCE_CHANGE{'reason': 26, 'viewNo': 3} from digitalbazaar 2018-12-08 05:25:52,239|INFO|view_changer.py|TNO received instance change request: INSTANCE_CHANGE{'reason': 26, 'viewNo': 3} from digitalbazaar 2018-12-08 05:25:52,796|INFO|view_changer.py|TNO received instance change request: INSTANCE_CHANGE{'reason': 26, 'viewNo': 3} from amihan-sovrin 2018-12-08 05:25:53,008|INFO|view_changer.py|TNO received instance change request: INSTANCE_CHANGE{'reason': 26, 'viewNo': 3} from NewtonD 2018-12-08 05:26:10,785|INFO|view_changer.py|TNO received instance change request: INSTANCE_CHANGE{'reason': 26, 'viewNo': 3} from ServerVS 2018-12-08 05:26:10,798|INFO|view_changer.py|TNO received instance change request: INSTANCE_CHANGE{'reason': 26, 'viewNo': 3} from VeridiumIDC 2018-12-08 05:26:10,876|INFO|view_changer.py|TNO received instance change request: INSTANCE_CHANGE{'reason': 26, 'viewNo': 3} from Stuard 2018-12-08 05:26:10,903|INFO|view_changer.py|TNO received instance change request: INSTANCE_CHANGE{'reason': 26, 'viewNo': 3} from icenode 2018-12-08 05:26:10,906|INFO|view_changer.py|TNO received instance change request: INSTANCE_CHANGE{'reason': 26, 'viewNo': 3} from Aalto 2018-12-08 05:26:11,021|INFO|view_changer.py|TNO received instance change request: INSTANCE_CHANGE{'reason': 26, 'viewNo': 3} from BIGAWSUSEAST1-001 2018-12-08 05:26:11,182|INFO|view_changer.py|TNO received instance change request: INSTANCE_CHANGE{'reason': 26, 'viewNo': 3} from ibm 2018-12-08 05:26:11,223|INFO|view_changer.py|TNO received instance change request: INSTANCE_CHANGE{'reason': 26, 'viewNo': 3} from atbsovrin 2018-12-08 05:26:11,296|INFO|view_changer.py|TNO received instance change request: INSTANCE_CHANGE{'reason': 26, 'viewNo': 3} from DustStorm 2018-12-08 05:26:11,323|INFO|view_changer.py|TNO received instance change request: INSTANCE_CHANGE{'reason': 26, 'viewNo': 3} from prosovitor 2018-12-08 05:26:11,363|INFO|view_changer.py|TNO received instance change request: INSTANCE_CHANGE{'reason': 26, 'viewNo': 3} from zaValidator 2018-12-08 05:26:11,516|INFO|view_changer.py|TNO received instance change request: INSTANCE_CHANGE{'reason': 26, 'viewNo': 3} from ev1 {code}  ></body> </Action>
<Action id="54713" issue="36019" author="sergey.khoroshavin" type="comment" created="2018-12-12 12:57:58.0" updateauthor="sergey.khoroshavin" updated="2018-12-12 14:20:58.0"> <body><! CDATA *Conclusion* There is serious protocol shortcoming which allows situations where less than _n-f_ nodes enter view change, basically bringing pool into read-only state until manual emergency restart of all nodes. *Steps to reproduce* basically boils down to following: # Given working pool # Make randomly selected half of nodes broadcast INSTANCE_CHANGE (for example, by selectively limiting their connectivity to primary node) # Restart another randomly selected set of half nodes (but not including current master primary) # Make another half of nodes that were not selected in (2) to broadcast INSTANCE_CHANGE messages # This will lead to nodes that were not restarted in (3) to enter a view change, with their number not enough to finish it # At the same time number of remaining nodes that didn't enter a view change will be not enough to continue normal request processing # So pool is non operational until manual restart of all nodes  The problem is basically the same as found in INDY-1893.  There are several possible *options to fix this*: * Discard old INSTANCE_CHANGE messages on some predefined timeout. It won't fix issue, just reduce probability of running into this problem, but it can be done really quickly. This will be addressed in INDY-1909. * Introduce some unique _ID_ into INSTANCE_CHANGE messages and come up with a way to assign it in a way that will prevent this problem altogether. It's not yet known whether such protocol exists and if it is really simple to implement, but research (which includes writing tests for checking different hypothesis) is already ongoing and results will be provided in INDY-1897 * As per original PBFT paper (not an RBFT, on which Indy Plenum is based) nodes should start view change when they detect that some transactions are not ordered for long enough time. While it can be quickly implemented almost as is and it will definitely fix this issue it will make pool much more susceptible to DDoS. This will be addressed in INDY-1910. * Following previous idea, if INDY-933 gets implemented nodes can vote for view change if state doesn't get updated long enough. I believe this option is actually the most robust solution in the long run, however it will take some time to implement it. Also it increases probability of view change, and given that Indy Plenum has problems (INDY-1296 and all related issues) with current implementation it introduces additional risks until these problems get fixed. This will be addressed in INDY-1911.   ></body> </Action>
