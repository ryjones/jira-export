<Issue id="26162" key="INDY-1061" number="1061" project="10303" reporter="spivachuk" creator="spivachuk" type="10004" summary="Replica.lastPrePrepareSeqNo may not be reset on view change" environment="STN network, running 1.1.43." priority="3" resolution="10000" status="10001" created="2017-12-19 16:01:05.0" updated="2019-03-29 20:33:17.0" resolutiondate="2019-03-29 20:33:17.0" votes="0" watches="3" workflowId="26162"> <description><! CDATA During investigation of the bug INDY-959, on the master replica of the node "korea" a 3PC-batch was observed with a key with {{ppSeqNo}} generated using {{Replica.lastPrePrepareSeqNo}} counter that was not reset after the previous view, while it must be reset. The corresponding 3PC-batches on the backup replicas of this node had keys with expected {{ppSeqNo}} (generated using the counter reset after the previous view). The {{PrePrepare}} (initial message for 3PC-batch) on the master replica was postponed to {{Replica.prePreparesPendingPrevPP}} due to unavailability of previous {{PrePrepares}} while the 3PC-batches on all the backup replicas were successfully ordered by them.  This 3PC-batch on the master replica and the corresponding 3PC-batches on the backup replicas were the 3PC-batches with {{viewNo}} 2 containing the single request with {{reqId}} 1509109895321705 from {{identifier}} Fvy1AsYgrpkjmTE7KsD4CY. On the master replica {{ppSeqNo}} was 76 and on the backup replicas {{ppSeqNo}} was 1.  Also it's worth to note that later on the master replica there was a 3PC-batch with the same single request and with {{viewNo}} 3. It had {{ppSeqNo}} 1 and was successfully ordered by the replica and eventually by the node.  The node log has been attached. Also this log and other logs from the pool can be found in INDY-959.  ></description> </Issue>
