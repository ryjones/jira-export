<Action id="28012" issue="18582" author="ozheregelya" type="comment" body="Please, pay attention that check of version should not be ignored when the force=True option is used in POOL_UPGRADE command." created="2017-07-07 13:59:57.0" updateauthor="ozheregelya" updated="2017-07-07 13:59:57.0"/>
<Action id="28102" issue="18582" author="aleksey-roldugin" type="comment" created="2017-07-10 16:52:30.0" updateauthor="aleksey-roldugin" updated="2017-07-10 16:52:30.0"> <body><! CDATA The same situation occurs when version for upgrade exists but Node cannot upgrade to it for some reason: {code:java} 2017-07-10 15:50:34,910 | ERROR    | upgrader.py          ( 109) | __init__ | Failed to upgrade node 'Node1' to version 1.8.4 {code} After upgrade attempt Node rolls back to installed version and performs next upgrade attempt. It continues endlessly. Please find more info in _sustemctl -u sovrin-node.service.log_ and _Node1.log_. h6. EXPECTED RESULT  Node stops attempting to upgrade after some time.  ></body> </Action>
<Action id="29555" issue="18582" author="andrey.goncharov" type="comment" created="2017-08-08 15:34:40.0" updateauthor="andrey.goncharov" updated="2017-08-08 15:34:40.0"> <body><! CDATA Problem reason:   - Missing condition, complex logic  Changes:  - Logic simplified, missing conditions added  Committed into: https://github.com/hyperledger/indy-node/commit/e55a99a94aa90e34e22f5d9008446a5c9231fcbd sovrin-node/master 1.0.82  Risk factors: Upgrade functionality might get affected.  Risk: Medium  Covered with tests: https://github.com/hyperledger/indy-node/commit/e55a99a94aa90e34e22f5d9008446a5c9231fcbd#diff-1f0c4e3f1f9f8b812891c08040f351caR1  Recommendations for QA (optional): Run several different scenarios to test POOL_UPGRADE still works as expected  ></body> </Action>
<Action id="29640" issue="18582" author="vladimirwork" type="comment" created="2017-08-10 08:52:13.0" updateauthor="vladimirwork" updated="2017-08-10 10:25:57.0"> <body><! CDATA Build Info: indy-node 1.0.86  Steps to Reproduce - Case 1 (reinstall with force=True): 1. Setup 1.0.86 pool. 2. Send "send POOL_UPGRADE name=upgrade86 version=1.0.86 sha256=ed0a366b4ef36d40c055672a8b83679e99246fec71a706b4ae4cb7958feace3f action=start schedule={'Gw6pDLhcBcoQesN72qfotTgFa7cbuqZpkX3Xo6pLhPhv': '2017-08-10T07:30:00.258870+00:00', '8ECVSk179mjsjKRLWiQtssMLgp6EPhWXtaYyStWPSGAb': '2017-08-10T07:35:00.258870+00:00', 'DKVxG2fXXTU8yT5N7hGEbXB3dfdAnYv1JczDUHpmDxya': '2017-08-10T07:40:00.258870+00:00', '4PS3EDQ3dW1tci1Bp6543CfuuebjFrg36kLAUcskGfaA': '2017-08-10T07:45:00.258870+00:00'} timeout=10 force=True reinstall=True ".  Actual Results: Some nodes get disconnected and after ~1 minute get connected again. Upgrade to the same version is *not* performed. Pool fails to send NYMs after nodes connecting.  Expected Results: Upgrade should schedule with *any* time (so you can use exact command in step 2) when force=True and perform immediately if scheduled time is less than current time.   Steps to Reproduce - Case 2 (reinstall or upgrade with force=False): 1. Setup 1.0.86 pool. 2. Send "send POOL_UPGRADE name=upgrade86 version=1.0.86 sha256=ed0a366b4ef36d40c055672a8b83679e99246fec71a706b4ae4cb7958feace3f action=start schedule={'Gw6pDLhcBcoQesN72qfotTgFa7cbuqZpkX3Xo6pLhPhv': '2017-08-10T08:40:00.258870+00:00', '8ECVSk179mjsjKRLWiQtssMLgp6EPhWXtaYyStWPSGAb': '2017-08-10T08:45:00.258870+00:00', 'DKVxG2fXXTU8yT5N7hGEbXB3dfdAnYv1JczDUHpmDxya': '2017-08-10T08:50:00.258870+00:00', '4PS3EDQ3dW1tci1Bp6543CfuuebjFrg36kLAUcskGfaA': '2017-08-10T08:55:00.258870+00:00'} timeout=10 force=False reinstall=True".  Actual Results: Upgrade is performed but nodes reconnect spontaneously and in fact cannot start correctly (so pool is breaked after upgrade).  Expected Results: Upgrade shoul work normally.  ^_journalctl_case1.txt    ^_journalctl_case2.txt   !CASE1.PNG|thumbnail!  !CASE2.PNG|thumbnail!    ></body> </Action>
<Action id="29654" issue="18582" author="andrey.goncharov" type="comment" created="2017-08-10 14:25:41.0" updateauthor="andrey.goncharov" updated="2017-08-10 15:36:44.0"> <body><! CDATA  ~VladimirWork   Fixed in    sovrin/master 1.0.2|https://github.com/sovrin-foundation/sovrin/commit/0ffb03e38fcb410fbfff280fb905f3a5bb7bd6c5 2   indy-node/master 1.0.|https://github.com/hyperledger/indy-node/commit/9f1ee314f60ad0e7c3f07c79d0007c733147e728 92  Please try the new build and get back with results  ></body> </Action>
<Action id="29685" issue="18582" author="vladimirwork" type="comment" created="2017-08-11 09:42:33.0" updateauthor="vladimirwork" updated="2017-08-11 09:42:33.0"> <body><! CDATA Build Info: indy-node 1.0.94  Steps to Validate: 1. Send pool upgrade command with nonexistent version parameter.  Actual Results: Current version is reinstalled due to unable to find nonexistent version. This works well with both force parameter values.  Additional Info: Upgrading and reinstallation with any combinations of schedule/force/reinstall parameters are also checked during regression testing of pool upgrade command.  ></body> </Action>
<Action id="29706" issue="18582" author="ozheregelya" type="comment" created="2017-08-11 13:07:51.0" updateauthor="ozheregelya" updated="2017-08-11 13:07:51.0"> <body><! CDATA {code:java} root@37da9dab847e:/home/sovrin# systemctl status sovrin-node ● sovrin-node.service - Sovrin Node Loaded: loaded (/etc/systemd/system/sovrin-node.service; disabled; vendor preset: enabled) Active: inactive (dead) Aug 11 11:07:11 37da9dab847e env 1387 : File "/usr/local/lib/python3.5/dist-packages/sovrin_node/server/upgrade_log.py", line 34, in Aug 11 11:07:11 37da9dab847e env 1387 : upgrade_id = item 4  Aug 11 11:07:11 37da9dab847e env 1387 : IndexError: list index out of range Aug 11 11:07:12 37da9dab847e systemd 1 : sovrin-node.service: Main process exited, code=exited, status=1/FAILURE Aug 11 11:07:12 37da9dab847e systemd 1 : sovrin-node.service: Unit entered failed state. Aug 11 11:07:12 37da9dab847e systemd 1 : sovrin-node.service: Failed with result 'exit-code'. Aug 11 11:07:22 37da9dab847e systemd 1 : sovrin-node.service: Service hold-off time over, scheduling restart. Aug 11 11:07:22 37da9dab847e systemd 1 : Stopped Sovrin Node. Aug 11 11:07:22 37da9dab847e systemd 1 : sovrin-node.service: Start request repeated too quickly. Aug 11 11:07:22 37da9dab847e systemd 1 : Failed to start Sovrin Node. {code}    ></body> </Action>
<Action id="29724" issue="18582" author="andrey.goncharov" type="comment" created="2017-08-11 14:10:23.0" updateauthor="andrey.goncharov" updated="2017-08-11 14:10:23.0"> <body><! CDATA  ~ozheregelya   Fixed in indy-node/master 1.0.98 https://github.com/hyperledger/indy-node/commit/8ef345123fe2f1cd14d89bb9c70bd8130bbb364d  ></body> </Action>
<Action id="29734" issue="18582" author="vladimirwork" type="comment" body="Special case with upgrade from old version (1.0.78) is checked. Nodes start normally after the upgrade. !_Screenshot.PNG|thumbnail! " created="2017-08-11 15:50:05.0" updateauthor="vladimirwork" updated="2017-08-11 15:50:05.0"/>
