<Issue id="40241" key="INDY-2122" number="2122" project="10303" reporter="ashcherbakov" assignee="sergey.khoroshavin" creator="ashcherbakov" type="10004" summary="A client may receive NACK for a payment transfer request, but the transaction will be eventually ordered (payment transferred)" priority="3" resolution="10000" status="10001" created="2019-05-31 13:45:58.0" updated="2019-06-05 15:04:45.0" resolutiondate="2019-06-04 16:19:32.0" votes="0" watches="2" workflowId="53146"> <description><! CDATA *Issue* * A client sends a request, and receives NACK: `Client request is discarded since view change is in progress` which means that Pool can not process the request since view change is in progress. * The client would think that the request is discarded and not ordered (for example, the payment wasn't transferred) * However, after the view change is finished, the request may be silently ordered.  *What it can lead to* * The client may think that the payment didn't happen, while it actually happened.   *Expected behavior* # It would be great not to NACK requests during view change. However, we need to implement PBFT view change first to make it happen. # If a client receives NACK, then the request must never be ordered # Having timeout for requests received during view change may be acceptable.  *Issue cause* * A client sends a request X to all the nodes in the pool * Pool starts the view change not on all nodes ** View change is started on nodes A, C, D ** View change hasn't been started yet on node B * Nodes A, C, D reply with NACK => the client has f+1 equal NACKs =>client reports NACK * Node B accepts the request X and propagates it to all the other nodes * Propagate is not disabled during view change, so that the request X will be propagated, put into requests queue and finalized on all the nodes * View change is finished, and a new primary is selected * The new primary gets requests from the request queue to create a new 3PC batch (PrePrepare) * It gets the the request X and put into 3PC batch * The request X is ordered on all the nodes * Client is not aware of this (since he already received NACK before).  *Fix options* * Do not send NACK if view change is in progress. Nevertheless do not process them, so that for the client it will look like a timeout.  ></description> </Issue>
