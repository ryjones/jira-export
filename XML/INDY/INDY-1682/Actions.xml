<Action id="52565" issue="33504" author="toktar" type="comment" created="2018-10-24 08:05:52.0" updateauthor="toktar" updated="2018-10-24 08:05:52.0"> <body><! CDATA *Problem reason:* If a backup primary node is disconnected, all replicas on this backup instance store all new requests and other replicas can't remove already ordered messages.  *Changes:* * Added configuration parameters REPLICAS_REMOVING_WITH_DEGRADATION = "local" (None/local/quorum) REPLICAS_REMOVING_WITH_PRIMARY_DISCONNECTED = "local"(None/local/quorum).Â  With "local" when backup replica degradation will found, replicas will removed * Was switched on parameter ACC_MONITOR_ENABLED  *PR:* *  https://github.com/hyperledger/indy-plenum/pull/948  *  https://github.com/hyperledger/indy-node/pull/996    *Version:*  indy-node 1.6.643 -master indy-plenum 1.6.570 -master   *Risk factors:* * This feature should solve memory leak problem but not in all cases. * A problem with master degraded View Change can be found.  *Risk:*  Low  *Covered with tests:*   test_replica_removing_with_backup_degraded.py|https://github.com/hyperledger/indy-plenum/pull/948/files#diff-4f7376795ddaf94804fd3efc795afe2d   *Recommendations for QA:*  Test this feature in scope of a load testing.  ></body> </Action>
<Action id="52619" issue="33504" author="vladimirwork" type="comment" created="2018-10-25 08:39:01.0" updateauthor="vladimirwork" updated="2018-10-25 08:39:01.0"> <body><! CDATA Build Info: indy-node 1.6.643 indy-perf-load 1.0.16  Steps to Reproduce: 1. Run load test with half of target load rate (5 writing txns per second) with all txn types (except revoc_reg_entry) and fees for all txns (config.yml): {noformat} clients: 250 genesis_path: ~/live_transactions_genesis seed:  000000000000000000000000Trustee1, 000000000000000000000000Trustee2, 000000000000000000000000Trustee3, 000000000000000000000000Trustee4  batch_size: 1 buff_req: 100 req_kind: ' {"nym":{"count": 4}}, {"schema":{"count": 1}}, {"attrib":{"count": 3}}, {"cred_def":{"count": 1}}, {"revoc_reg_def":{"count": 1}}, {"payment":{"count": 9}} ' ext_set: '{"payment_addrs_count":100,"addr_mint_limit":10000,"payment_method":"sov","plugin_lib":"libsovtoken.so","plugin_init":"sovtoken_init","trustees_num":4, "mint_by": 100, "set_fees":{"1":1,"100":1,"101":1,"102":1,"113":1,"10001":1}}' mode: t load_rate: 0.01 sync_mode: freeflow load_time: 0 {noformat} {code:java} x2 client machines {code} 2. Check metrics and logs.  Actual Results: We have nearly expected throughput only during initial ~15 minutes then it falls close to zero. !INDY-1682-all-txns-fees.PNG|thumbnail!  After 1.5 hours of load test run we have more than 2k txns in token ledger and only 150 txns in domain ledger. So it looks like we have some issues with txns ordering or with load script output rate. FYI  ~Toktar   ~dsurnin   Logs/journals/info from all nodes: ev@evernymr33:logs/1682_1.tar.gz Load script full output:   ^load_test_results.tar.gz    ></body> </Action>
<Action id="52646" issue="33504" author="vladimirwork" type="comment" created="2018-10-25 15:41:22.0" updateauthor="vladimirwork" updated="2018-10-25 15:41:22.0"> <body><! CDATA Build Info: indy-node 1.6.643 indy-perf-load 1.0.16  Steps to Reproduce: 1. Run writing load test with ~40 NYMs/second without fees. 2. Check metrics, logs and nodes' ledgers.  Actual Results: 1. We have 19 writing nodes with ~300k txns in ledger and 6 (4, 7, 8, 9, 22, 25) broken with 90..100k txns in ledger (unable to write or catch up) at the end of load test run. 2. 5th node (good) is on view 2 with RAM consumption growing up to ~7 GB: !Figure_node5_300k.png|thumbnail!  3. 25th node (bad after 13:00) is on view 1 with OOM near 14:00: !Figure_node25_90k.png|thumbnail!   Logs and all info: ev@evernymr33:logs/1682_2.tar.gz  ></body> </Action>
<Action id="52677" issue="33504" author="vladimirwork" type="comment" body="The same figures with `max_replica_request_queues_backup`.  !Figure_5th+max_replica_request_queues_backup.png|thumbnail!  !Figure_25th+max_replica_request_queues_backup.png|thumbnail! " created="2018-10-26 09:40:37.0" updateauthor="vladimirwork" updated="2018-10-26 09:40:37.0"/>
<Action id="52680" issue="33504" author="vladimirwork" type="comment" body="Development and bugfixing will be continued in scope of INDY-1685." created="2018-10-26 10:01:11.0" updateauthor="vladimirwork" updated="2018-10-26 10:01:11.0"/>
