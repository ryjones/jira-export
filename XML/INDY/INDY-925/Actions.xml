<Action id="33371" issue="22822" author="spivachuk" type="comment" created="2017-10-30 15:48:09.0" updateauthor="spivachuk" updated="2017-10-30 15:50:15.0"> <body><! CDATA  ~danielhardman ,  ~nage ,  ~tharmon ,  ~krw910 , we have a question on upgrade of agents. Agents may be run in CLI mode as well as in non-CLI mode. If an agent is run in non-CLI mode, it should not ask the user about anything interactively.  So to keep it simple we propose the following two options for the rebranding upgrade of agents: * provide unconditional app data migration for agents (i.e. don't ask the user for confirmation in case {{.indy}} is untouched and {{.sovrin}} has been found); * don't provide app data migration for agents.  Which option should we choose? Or should we use some other workflow for agents?  ></body> </Action>
<Action id="33394" issue="22822" author="krw910" type="comment" created="2017-10-30 22:10:02.0" updateauthor="krw910" updated="2017-10-30 22:10:02.0"> <body><! CDATA  ~spivachuk  # If its interactive then prompt. # If it is not interactive and there is no .indy folder error out and tell them how to give the command line option to trigger the migration. # If there is already a .indy folder just use it.  ></body> </Action>
<Action id="33619" issue="22822" author="spivachuk" type="comment" created="2017-10-31 15:21:46.0" updateauthor="spivachuk" updated="2017-10-31 15:21:46.0"> <body><! CDATA  ~krw910 , do we understand right that non-libindy-based agents (which we are talking about here) are used for Getting Started Tutorial demo agents only?  If this is the case then non-libindy-based agents don't store any worth data in their wallets and so after rebranding upgrade they can be just restarted with a clean {{.indy}} directories and re-create wallets there from scratch without any negative effect for users.  ></body> </Action>
<Action id="34003" issue="22822" author="spivachuk" type="comment" body=" ~tharmon ,  ~mgbailey , could you please help us with clarifying the question from the previous comment?" created="2017-11-01 15:40:20.0" updateauthor="spivachuk" updated="2017-11-01 15:40:20.0"/>
<Action id="34219" issue="22822" author="mgbailey" type="comment" created="2017-11-01 21:33:58.0" updateauthor="mgbailey" updated="2017-11-01 21:35:16.0"> <body><! CDATA  ~spivachuk , we do have customers that are using python-based agents, however, not many.  Since there are few, I think that detailed instructions for migration will be sufficient.  With this, here are my votes: # If interactive (i.e. CLI) prompt and upgrade if response is yes # If not interactive (i.e. agents), no automated upgrade.  Just provide instructions  ></body> </Action>
<Action id="34413" issue="22822" author="ashcherbakov" type="comment" created="2017-11-07 13:33:51.0" updateauthor="ashcherbakov" updated="2017-11-07 13:42:01.0"> <body><! CDATA Changes: - fixed migration of wallets after re-branding; - added migration of data from one dir to another after rebranding and file folder re-factoring (CLI asks if the user wants to apply the migration)  PR: - https://github.com/hyperledger/indy-plenum/pull/437 - https://github.com/hyperledger/indy-node/pull/429  Build: - 1.2.201  For QA: - Check that migration works from the latest stable version (on the pool) - Check that wallets from Getting Started can be migrated successfully - Check that Agents can be migrated successfully (see instructions below)   ></body> </Action>
<Action id="34427" issue="22822" author="vladimirwork" type="comment" created="2017-11-07 16:55:16.0" updateauthor="vladimirwork" updated="2017-11-08 12:15:53.0"> <body><! CDATA Build Info: indy-node 1.2.201  Steps to Reproduce: 1. Place old wallet (1.1.43) in /home/indy/.sovrin directory (e.g. /home/indy/.sovrin/wallets/test/default.wallet). 2. Run CLI as indy user. 3. Type Y to migrate client data.  Actual Results: {quote}Application data from previous Indy version has been found Do you want to migrate it?  Y/n  Y Error occurred when trying to migrate application data:  Errno 18  Invalid cross-device link: '/home/indy/.indy-cli' -> '/home/indy/.indy-cli.backup' Traceback (most recent call last): File "/usr/local/lib/python3.5/dist-packages/indy_client/cli/cli.py", line 136, in _migrate_legacy_app_data_if_just_upgraded_and_user_agrees combined_migration.migrate() File "/usr/local/lib/python3.5/dist-packages/indy_client/utils/migration/combined_migration.py", line 68, in migrate raise e File "/usr/local/lib/python3.5/dist-packages/indy_client/utils/migration/combined_migration.py", line 53, in migrate os.rename(_CLI_BASE_DIR, _CLI_BASE_BACKUP_DIR) OSError:  Errno 18  Invalid cross-device link: '/home/indy/.indy-cli' -> '/home/indy/.indy-cli.backup' Application data has not been migrated  Indy-CLI (c) 2017 Evernym, Inc. Type 'help' for more information. Running Indy 1.2.201{quote}  Expected Results: Client data should migrate normally.  Additional Info: Test /home/ directory for indy user with needed folder structure and old wallet is in attachment.  ^home_.tar.gz    *Not reproducing on 1.2.202.*  ></body> </Action>
<Action id="34450" issue="22822" author="vladimirwork" type="comment" created="2017-11-08 12:15:02.0" updateauthor="vladimirwork" updated="2017-11-09 11:04:50.0"> <body><! CDATA Build Info: indy-node 1.2.202  Steps to Reproduce: 1. Place .sovrin directory (1.1.43) to /home/indy/. 2. Run CLI as indy user. 3. Type Y to migrate client data. 4. Try to connect sandbox network. !CLI_after_wallet_migration.PNG|thumbnail!   Actual Results: Exception in callback PosixAsyncioEventLoop.run_as_coroutine.<locals>.stdin_ready() at /usr/lib/python3/dist-packages/prompt_toolkit/eventloop/asyncio_posix.py:65 handle: <Handle PosixAsyncioEventLoop.run_as_coroutine.<locals>.stdin_ready() at /usr/lib/python3/dist-packages/prompt_toolkit/eventloop/asyncio_posix.py:65>  Expected Results: CLI should work normally.  Additional Info: *Issue reproduces in docker only.*  ></body> </Action>
<Action id="34457" issue="22822" author="ashcherbakov" type="comment" created="2017-11-08 15:49:09.0" updateauthor="ashcherbakov" updated="2017-11-08 15:49:09.0"> <body><! CDATA In order to migrate agent's wallets, once can manually copy `/home/user/.sovrin/wallets/agnets/<agent_name>` to `home/user/.indy-cli/wallets/agnets/<agent_name>`.  But actually as for faber, acme and thrift (and probably for other wallets as well), it just doesn't make sense, because the only private information they can have is Issuer secret keys, and they are re-created (with the same values) on each startup of the Agent.  ></body> </Action>
<Action id="34494" issue="22822" author="vladimirwork" type="comment" created="2017-11-09 11:04:04.0" updateauthor="vladimirwork" updated="2017-11-09 11:04:04.0"> <body><! CDATA Build Info: indy-node 1.2.203  Steps to Validate: 1. Install 1.1.43 (stable) pool. 2. Make some NYMs and run through Getting Started Tutorial. 3. Upgrade client to 1.2.203 manually. 4. Move /home/sovrin/.sovrin folder to /home/indy folder. 4. Upgrade the pool to 1.2.203 (master) version (or connect client to another 1.2.203 pool and copy old agents' wallets to it). 5. Start CLI and perform client migration. 6. Use DIDs that were made in initial pool. 7. Request claims (that were accepted on 1.1.43) from agents (that were connected on 1.1.43) (in other words, run the *last 3 steps* of GST with migrated wallet).  Actual Results: Migrated wallet connects to network, can use DIDs and requests all claims successfully. !wallet_migrated_request_claims_before_and_after_old_agents_wallets_using.PNG|thumbnail!  !wallet_migrated_use_DID.PNG|thumbnail!   ></body> </Action>
