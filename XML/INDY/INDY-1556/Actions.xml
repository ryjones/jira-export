<Action id="48445" issue="32578" author="sergey.khoroshavin" type="comment" body="During testing of INDY-1475 there was a moment of simultaneous load test agent crash and a view change. It might be just coincidence, but we&apos;d better check it. Logs are located in `~/logs/1475` on internal log processing machine." created="2018-08-06 14:29:02.0" updateauthor="sergey.khoroshavin" updated="2018-08-06 14:29:14.0"/>
<Action id="48740" issue="32578" author="spivachuk" type="comment" created="2018-08-10 21:42:11.0" updateauthor="spivachuk" updated="2018-08-10 22:06:22.0"> <body><! CDATA The view change to the view 3 was caused by going below the threshold ratio between the master and the average backup throughput.  In the view 2 there was load about 11 reqs/sec during several hours. Then at 20:59:50 the primary of the instance 3 (Node6) detected that it had lagged in master instance for 2 checkpoints from other nodes and so started a catch-up. Thus the primary of the instance 3 stopped to produce new 3PC-batches. At 21:11 the load was stopped and ordering in other instances was stopped. Then the primary of the instance 3 completed the catch-up at 21:16:07 and produced a 3PC-batch of maximum size (10000) of queued requests in the instance 3. When this 3PC-batch had been ordered by nodes in the pool, they detected that the ratio between the master throughput and the average backup throughput became below the threshold value. So the nodes sent INSTANCE_CHANGE messages with the next view_no 3 with the reason "Primary of master protocol instance degraded the performance". Then the nodes gathered quorums of these INSTANCE_CHANGE messages and performed a view change to the view 3.  Below there are messages related to sending of INSTANCE_CHANGE with view_no 3 from the log of one of the nodes: {code:java} 2018-08-02 21:16:32.161000 | Node11:- | NOTIFICATION | monitor.py | MONITORING: Node11 master throughput ratio 0.051357800613378635 is lower than Delta 0.1. 2018-08-02 21:16:32.161000 | Node11:- | NOTIFICATION | node.py | Node11 master instance performance degraded 2018-08-02 21:16:32.161000 | Node11:- | NOTIFICATION | view_changer.py | Node11 sending instance with view_no = 3 and trying to start view change since performance of master instance degraded 2018-08-02 21:16:32.162000 | Node11:- | INFO | view_changer.py | MONITORING: Node11 metrics for monitor: Node11 Monitor metrics:: None Delta: 0.1 Lambda: 240 Omega: 20 avg backup throughput: 10.265750156631821 client avg request latencies: {0: {'V4SGRU86Z58d6TV7PBUe6f': 0.7126782652300148}, 1: {'V4SGRU86Z58d6TV7PBUe6f': 1.1258689948787894}, 2: {'V4SGRU86Z58d6TV7PBUe6f': 0.5550786061575981}, 3: {'V4SGRU86Z58d6TV7PBUe6f': 400.42709273566936}, 4: {'V4SGRU86Z58d6TV7PBUe6f': 0.6006979011295902}, 5: {'V4SGRU86Z58d6TV7PBUe6f': 0.7638420664324053}, 6: {'V4SGRU86Z58d6TV7PBUe6f': 0.9826751445647405}, 7: {'V4SGRU86Z58d6TV7PBUe6f': 1.0497014596251761}, 8: {'V4SGRU86Z58d6TV7PBUe6f': 0.8390144533225338}} instances started:  8251520.265940722, 8251520.266395832, 8251520.266789038, 8251520.267155353, 8251520.267602983, 8251520.267978794, 8251520.268382167, 8251520.268808046, 8251520.269186649  master request latencies: {} master throughput ratio: 0.051357800613378635 master throughput: 0.5272263496910575 ordered request counts: {0: 163875, 1: 163875, 2: 163875, 3: 163348, 4: 163875, 5: 163875, 6: 163875, 7: 163875, 8: 163875} ordered request durations: {0: 260343.76566756424, 1: 220833.90625354275, 2: 255480.54343646485, 3: 14945681.386451773, 4: 212150.0821664296, 5: 223643.44628215395, 6: 240507.8876771126, 7: 230157.68799525965, 8: 226719.50231549423} throughput: {0: 0.5272263496910575, 1: 0.5269553407300632, 2: 0.5286142685190659, 3: 78.43376998672488, 4: 0.5269196328292368, 5: 0.5271971235256135, 6: 0.5270468743104585, 7: 0.5272933082675938, 8: 0.5282047181476643} total requests: 171596 {code}  ></body> </Action>
<Action id="48777" issue="32578" author="ashcherbakov" type="comment" created="2018-08-13 06:39:03.0" updateauthor="ashcherbakov" updated="2018-08-13 06:39:03.0"> <body><! CDATA So, the problems are not related to the fact that load script was stopped.  However, some issues with throughput calculations were found (that caused view change). This will be addressed in https://jira.hyperledger.org/browse/INDY-1565.  ></body> </Action>
