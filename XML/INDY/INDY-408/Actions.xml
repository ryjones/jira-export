<Action id="28165" issue="19166" author="aleksey-roldugin" type="comment" body="FYI  ~krw910 ,  ~stevetolman ,  ~danielhardman ,  ~ashcherbakov " created="2017-07-11 16:26:52.0" updateauthor="aleksey-roldugin" updated="2017-07-11 16:26:52.0"/>
<Action id="28167" issue="19166" author="andrey.goncharov" type="comment" created="2017-07-11 16:39:09.0" updateauthor="andrey.goncharov" updated="2017-07-11 16:39:09.0"> <body><! CDATA Short overview:  If an exception is thrown in one of applied migrations .sovrin is not recovered from a backup ZIP file, though it should.  ></body> </Action>
<Action id="28285" issue="19166" author="krw910" type="comment" body=" ~andrey.goncharov  could we get into an infinite loop where restoring the .sovrin folder makes us believe we need to try the upgrade again? " created="2017-07-12 21:30:33.0" updateauthor="krw910" updated="2017-07-12 21:30:33.0"/>
<Action id="28300" issue="19166" author="andrey.goncharov" type="comment" body=" ~krw910  it could indeed." created="2017-07-13 09:39:49.0" updateauthor="andrey.goncharov" updated="2017-07-13 09:39:49.0"/>
<Action id="28457" issue="19166" author="danielhardman" type="comment" created="2017-07-15 21:41:31.0" updateauthor="danielhardman" updated="2017-07-15 21:41:31.0"> <body><! CDATA If we could get into an infinite loop, then perhaps it's best to never do anything automated with a backup of .sovrin; instead, if the migration script fails, we need to write a message to the screen and to syslog announcing the failure of the migration, and reporting that the backup of .sovrin is available for manual recovery if needed. (We'd need to specify the path to it.)  It feels like we could timebox this to an hour or so and be done.  ></body> </Action>
<Action id="28474" issue="19166" author="andrey.goncharov" type="comment" created="2017-07-17 07:37:21.0" updateauthor="andrey.goncharov" updated="2017-07-18 15:43:07.0"> <body><! CDATA  ~danielhardman  we could restore everything except upgrade log. This way we will avoid going into infinite loop. Leaving instructions for manual recovery opens us up to a human error.A steward could replace upgrade log and there will be the same loop.  I proceed with this option unless you tell me otherwise.  ></body> </Action>
<Action id="28601" issue="19166" author="danielhardman" type="comment" body="Okay, proceed." created="2017-07-18 19:30:19.0" updateauthor="danielhardman" updated="2017-07-18 19:30:19.0"/>
<Action id="28662" issue="19166" author="andrey.goncharov" type="comment" created="2017-07-19 14:30:11.0" updateauthor="andrey.goncharov" updated="2017-07-19 14:30:11.0"> <body><! CDATA Problem reason:  - incorrect dependency resolving  Changes:  - dependency resolving fixed  Committed into: https://github.com/hyperledger/indy-node/commit/994a3301df7e87ae503cc88405fc4c9a1a3d89cd indy-node 0.4.49  Risk factors: Upgrade functionality could be affected.  Risk: Low  Covered with tests: https://github.com/hyperledger/indy-node/blob/master/sovrin_node/test/upgrade/test_node_control_tool.py#L35  Recommendations for QA (optional): How to test: # Set up a pool from indy-node=1.9.18 (sovrin repo: migrations-test, evernym repo: master) # Submit a pool upgrade # The migration should raise an exception with text '1.5.6test'. # The upgrade should fail and it should rollback. # Check journalctl logs to find out if the exception was thrown and rollback happened. # Check: - there's '.sovrin_test' directory in /home/sovrin # Check there's 'migration_proof' file in the directory with content '1.5.6' # Check there's no 'migration_proof' file in your /home/sovrin/.sovrin # Check there's no 'sovrin_backup_1.8.2.zip' file in you /home/sovrin folder   ></body> </Action>
<Action id="28723" issue="19166" author="vladimirwork" type="comment" created="2017-07-20 14:28:20.0" updateauthor="vladimirwork" updated="2017-07-20 14:28:20.0"> <body><! CDATA The case above is passed. Issue with upgrade loop that appears due to this case execution will be fixed in INDY-316.  ></body> </Action>
