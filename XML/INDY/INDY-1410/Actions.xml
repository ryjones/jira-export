<Action id="45963" issue="31027" author="spivachuk" type="comment" created="2018-06-15 09:28:12.0" updateauthor="spivachuk" updated="2018-06-15 09:28:12.0"> <body><! CDATA *Problem reason:* - There was a bug in {{Replica.processStashedCheckpoints}} method with removal of entries from {{Replica.stashedRecvdCheckpoints}} map. Actually consumed messages were removed from the map only after processing of all the stashed messages for the given key. But at that moment these messages might have already been removed from the map due to checkpoint stabilization and so the attempt to remove them in {{Replica.processStashedCheckpoints}} method resulted in {{KeyError}}. Also during iteration over checkpoint messages for the given key from different senders we might process messages that had already been removed from {{Replica.processStashedCheckpoints}} map due to checkpoint stabilization.  *Changes:* - Fixed the bug in {{Replica.processStashedCheckpoints}} method with repeated removal of entries from {{Replica.stashedRecvdCheckpoints}} map. Now when iterating over a snapshot of checkpoint messages for the given key {{Replica.processStashedCheckpoints}} method checks if the message is still in the map before processing it and if the message is still in the map then removes it from there and then processes it. - Added a test that verifies processing of stashed checkpoints from all other nodes and own checkpoint stabilization on own checkpoint completion. - Added a test that verifies processing of stashed checkpoints from other nodes on own checkpoint completion and own checkpoint stabilization on reception of more checkpoints from other nodes.  *PRs:* - https://github.com/hyperledger/indy-plenum/pull/743 - https://github.com/hyperledger/indy-node/pull/766  *Version:* - indy-node 1.4.462-master - indy-plenum 1.4.403-master  *Risk factors:* - Nothing is expected  *Risk:* - Low  *Covered with tests:* - {{test_lagged_checkpoint_completion}} - {{test_stashed_checkpoint_processing}}  ></body> </Action>
<Action id="46131" issue="31027" author="ozheregelya" type="comment" created="2018-06-18 17:27:44.0" updateauthor="ozheregelya" updated="2018-06-18 17:27:44.0"> <body><! CDATA Environment: indy-node 1.4.463 libindyÂ 1.4.0~565  Steps to Validate: 1. Setup the pool. 2. Run the load test from 10 clients with 1 txn/sec.  Actual Results: Pool successfully reached 800K txns without errors in status.  ></body> </Action>
