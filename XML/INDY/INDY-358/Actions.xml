<Action id="27612" issue="18819" author="krw910" type="comment" body="SOV-887" created="2017-06-29 14:42:01.0" updateauthor="krw910" updated="2017-06-29 14:42:01.0"/>
<Action id="27613" issue="18819" author="krw910" type="comment" created="2017-06-29 14:42:52.0" updateauthor="krw910" updated="2017-06-29 14:42:52.0"> <body><! CDATA From Trev Harmon  On a "clean" system, the process appears to be taking between 10-11% CPU usage at idle: {code} top - 23:14:26 up  1:39,  6 users,  load average: 0.77, 0.39, 0.15 Tasks: 116 total,   3 running, 113 sleeping,   0 stopped,   0 zombie %Cpu(s): 37.2 us,  1.8 sy,  0.0 ni, 61.0 id,  0.0 wa,  0.0 hi,  0.0 si,  0.0 st KiB Mem :   498296 total,     6104 free,   243028 used,   249164 buff/cache KiB Swap:        0 total,        0 free,        0 used.   222408 avail Mem  PID USER      PR  NI    VIRT    RES    SHR S %CPU %MEM     TIME+ COMMAND 1997 agent     20   0  129348  52692   7520 R 11.3 10.6   0:14.90 python3 1980 agent     20   0  130368  52564   6484 R 10.6 10.5   0:17.82 python3 2013 agent     20   0  129428  53676   8248 S 10.6 10.8   0:11.55 python3 1949 agent     20   0  130016  52804   6608 S 10.3 10.6   0:31.59 python3 1813 agent     20   0   40524   2964   2324 R  0.3  0.6   0:00.46 top {code}  The above is the top output on a system running four copies of the agent that have reached steady state.  ></body> </Action>
<Action id="27614" issue="18819" author="krw910" type="comment" body="We are also seeing this with the sovrin-node. We are using 10% CPU at idle just like sovrin-client. My guess is that what will fix one will fix the other. If this is not the case then please log a separate ticket for the node or let me know and I can do it." created="2017-06-29 14:43:04.0" updateauthor="krw910" updated="2017-06-29 14:43:04.0"/>
<Action id="28311" issue="18819" author="andkononykhin" type="comment" created="2017-07-13 13:51:46.0" updateauthor="andkononykhin" updated="2017-07-13 13:51:46.0"> <body><! CDATA Testing the problem  -------------------   Env:     - sovrin-client=0.4.19, sovrin-node=0.4.10 (master)     - nodes pool and client started locally inside docker   Testing results:     - didn't reproduce logs issue mentioed in description     - did reproduce issue with high CPU usage         about 25% for node         about 8% for client   Why that happens:     it is caused by current logic of asyncio couroutine processing. In particular, it grows up     from logic of Prodables utilization in stp_core/loop/looper.py:        - runForever() calls runOnceNicely() in infinite loop       - runOnceNicely() calls all Prodables to do their stuff with conditional async sleep for 0.01 secs in case all Prodable haven't done anything in last round  What does it mean:     - we don't wait any events, we constantly check if they have happend     - we process all Prodables coroutines constantly even nothing to process -> CPU usage waste   I tried to tune sleep timeout and checked CPU usage by sovrin client process in idle state inside my test docker container:     0.1s     1% CPU    0.01s    8%  CPU    0.001 s  41%  CPU  On real machine numbers could differ but I think the behaviour will be the same.  I don't think that current task could be resolved with some easy fix but instead the whole architecture should be reviewed and adjusted for real event driven behavior.  I've created a task INDY-414 for that and attached a document with more details and proposals: https://docs.google.com/document/d/1m0pLAMKWRVdAxZN4ardDKGh_xV0J-0SBP-LCDOeN0M8/edit#heading=h.qapj7lclfhub  ></body> </Action>
