<Action id="47455" issue="31906" author="toktar" type="comment" created="2018-07-18 10:28:39.0" updateauthor="toktar" updated="2018-07-18 10:34:51.0"> <body><! CDATA On different nodes view changes switch about 25 viewNo to 0. It happened on most of nodes from 19:29 14 July to 00:25 15 July because more then f nodes restarted in this time. In the moment situation in logs looks like a problem with a connection then node tries to send message to another. {code:java} Remote Node16 is not connected - message will not be sent immediately.If this problem does not resolve itself - check your firewall settings{code}  ></body> </Action>
<Action id="47598" issue="31906" author="anikitindsr" type="comment" created="2018-07-20 14:47:35.0" updateauthor="anikitindsr" updated="2018-07-20 14:47:35.0"> <body><! CDATA After log analizing was noted that (for example for Node15): # Node15 start up after "out of memory" crash # After getting LEDGER_STATUS from other nodes and check, that all ledgers are the same, compliting first catchup (getting LEDGER_STATUS for all of ledger), allLedgersCaughtUp was called. Then, _start_selection in on_cacthup_complete return error, because there is no any ViewChangeDone msgs. But after this, select_primaries() was called (view_change_in_progress is False now). # Therefore, because primaryName is None for all replicas, select_primaries method will elect new primary by round robin (Node1 will be primary). Primary was selected without view_change procedure.  # Then, propagate_primary logic will used for view_change and will need only f+1 view_change_done messages with propagated view_no and restarted node can complete view change before others  ></body> </Action>
<Action id="47792" issue="31906" author="anikitindsr" type="comment" body="Also, after code analizing was found, that CurrentState message is building with viewNo (usually it&apos;s a proposed viewNo. For example when view change is in progress, then viewNo would be proposed/future viewNo instead of last completed). In that case, if node send  a CurrentState message, then it will include not last completed viewNo and in ViewChangeDone message too. The fix is using view_changer.last_completed_view_no instead of view_changer.view_no (or node.viewNo which is linked into view_changer)" created="2018-07-25 11:10:18.0" updateauthor="anikitindsr" updated="2018-07-25 11:10:18.0"/>
<Action id="48023" issue="31906" author="anikitindsr" type="comment" created="2018-07-27 08:56:46.0" updateauthor="anikitindsr" updated="2018-07-27 08:56:46.0"> <body><! CDATA Reasons: * needs to fix CurrentState building and initial propagate primary logic  Changes: * For now, CurrentState messages are building using last_completed_view_no, instead of just viewNo (which is proposed) * Also, FutureViewChangeDone messages were divided to initial_propagate_primary and ViewChangeDone message for future view  Versions: * indy-node: 1.5.527  How to validate: * setup pool of 6 nodes * ensure, that current view is 0 * stop 6'th node * force view_change * ensure that current view is 1 * stop 5'th node * force view_change and ensure, that is not complete * start 6'th node and ensure, that last_completed_view_no would be set to 1  ></body> </Action>
<Action id="48327" issue="31906" author="zhigunenko.dsr" type="comment" created="2018-08-03 07:37:46.0" updateauthor="zhigunenko.dsr" updated="2018-08-03 12:25:17.0"> <body><! CDATA This case cannot be validated manually by proposed steps. There is the same autotest in source code, so it is reasonable to repeat load test and check the results  ></body> </Action>
