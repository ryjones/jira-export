<Issue id="41898" key="INDY-2211" number="2211" project="10303" reporter="lbendixsen" assignee="vladimirwork" creator="lbendixsen" type="10004" summary="New nodes added after last upgrade (1.9.1) are not in consensus" priority="1" resolution="10000" status="10001" created="2019-08-19 22:57:24.0" updated="2019-08-29 08:03:45.0" resolutiondate="2019-08-27 15:48:24.0" votes="0" watches="8" workflowId="54939"> <description><! CDATA The upgrade of the buildernet to 1.9.1 (or possibly earlier) seems to have caused a consensus issue. The new nodes have all of their ledgers up to date except for the audit ledger, but all ledgers are showing "False" for consensus in validator-info results for nodes that were recently added.  Logs attached for 3 "bad" nodes recently added and 1 "good" node (FoundationBuilder) that has been there since the beginning of the BuilderNet.     Environment:  BuilderNet, current, Sovrin 1.1.52, indy-node 1.9.1.  Steps to reproduce: # All new nodes since Aug 5 buildernet upgrade show the listed issue, and it is possible that this has been the case since a previous upgrade. # Multiple new nodes added for the past several months have shown connectivity issues also, so we are seeing possible general "add node to existing network" issues since ~indy-node version 1.8.0 (perhaps not an exact version, just a general feel to give you an idea of how long we have seen issues that might be related to adding new nodes to an existing network)  Expected Behavior:       When adding a new node, the new node should catch up and remain in consensus over time.  Observed Behavior:      1. New nodes come onboard and appear to be working fine for some time (unknown whether it is hours or days that they work fine) then at some point they all go out of consensus and standard procedures to return them to consensus fail.  Standard procedures currently include restarting the node, and restarting the whole network.      2. This comment might be unrelated to the current ticket, but the mitrecorp node onboarded prior to 8-5-2019 had numerous issues with client and node connections that went unexplained and unrepaired.      Notes:  The following logs show that all of the "bad" nodes have the following, or similar, entries in them that the "good" node(Foundation Builder) does not have:  2019-08-19 16:37:15,658|WARNING|replica.py|cpqd:0 missing PRE-PREPAREs from 5521 to 5528, going to request 2019-08-19 16:37:15,666|INFO|replica.py|Queueing pre-prepares due to unavailability of previous pre-prepares. PREPREPARE{'ppTime': 1566232635, 'instId': 0, 'digest': 'e3b0c44298fc1c149afbf4c8996fb92427ae41e4649b934ca495991b7852b855', 'poolStateRootHash': 'BizBrS1S9x4jQcxiPiSRC3gaVoW6MsByWrZ5Ywk2VBPX', 'viewNo': 19, 'stateRootHash': 'BJMXmahaPEnF1skqqnqFcShWCci2ebf9r3q9q4xDCtvK', 'txnRootHash': 'DRkNKUmQK5ZxyLkx7tGaKuYaQzJZtZquWmeFXXfAtUuq', 'discarded': '  ', 'final': True, 'sub_seq_no': 0, 'reqIdr': (), 'ppSeqNo': 5529, 'auditTxnRootHash': 'Qziz6HDW7mLH8ci2ZhQqFYG6P1KZzxNpZhqEFMKtg5G', 'ledgerId': 2} from danube:0  Here is a list of recent nodes added, when they were added, and issues encountered:  OG Node - May 10 - no issues  fetch-AI - May 14 - Connectivity issues (resolved and possibly unrelated to this issue)  certisign - May 24 - no issues  mitrecorp - June 24 - Connectivity, consensus, and uptime issues, logs not yet attached  cpqd - Aug 8 - PREPREPARE issue  blockscale - Aug 14 - PREPREPARE issue  spaceman - Aug 15 - PREPREPARE issue     Recent upgrades to BuilderNet and the indy-node version:  May 6 - 1.7.1  June 3 - 1.8.0 (followed by 1.8.1 a week later)  July 8 - 1.9.0  Aug 5 - 1.9.1  ></description> </Issue>
