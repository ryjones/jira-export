<Issue id="17557" key="INDY-158" number="158" project="10303" reporter="spivachuk" assignee="danielhardman" creator="spivachuk" type="10004" summary="If view change is caused by demoting master&apos;s primary then primary re-election is performed only in master instance" priority="3" resolution="10000" status="10001" created="2017-06-06 12:34:15.0" updated="2019-03-29 20:32:49.0" resolutiondate="2019-03-29 20:32:49.0" votes="0" watches="10" timeoriginalestimate="10800" timeestimate="10800" workflowId="17561"> <description><! CDATA The behavior of a view change depends on its trigger: * If the primary of the master protocol instance is stopped then primary re-election is done in all the protocol instances as it must. * If the primary of the master protocol instance is demoted then primary re-election is done only in the master protocol instance while it must be done in all the protocol instances.  The bug was reproduced on the following versions: * sovrin-node 0.3.129 master deb package, * sovrin-client 0.3.125 master deb package.  Steps to reproduce and actual results: # Install a local pool from Vagrant script with changed APT repositories from {{xenial stable}} to {{xenial master}} in {{sovrin-environments/vagrant/training/vb-multi-vm/scripts/agent.sh}} and {{sovrin-environments/vagrant/training/vb-multi-vm/scripts/validator.sh}}. # Connect via SSH to the client VM and launch {{sovrin}}. # In CLI execute: {{connect test}} # In CLI execute: {{new key with seed 000000000000000000000000Trustee1}} # Connect via SSH to any of the node VMs, open the node log and detect which node has been selected as the primary in the master protocol instance (search for the string "selected primary" through the log). # Stop the VM with the primary of the master protocol instance. # Wait half a minute. # Connect via SSH to any of the remaining node VMs, open the node log and search for results of election (search for the string "selected primary") for the last view change ({{view 1}}). *  New primaries have been selected in all the protocol instances.  * # Detect which node has been selected as the primary in the master protocol instance for the last view ({{view 1}}). # Find the identifier of this node in {{pool_transactions_sandbox}}. Copy it to the clipboard for further use. # Start the VM that was previously stopped. # Wait a minute. # In CLI execute:  {noformat} send NODE dest=<PRIMARY_OF_MASTER_INSTANCE_ID> data= {"alias": "<PRIMARY_OF_MASTER_INSTANCE_ALIAS>", "services":   }{noformat}  # Wait half a minute. # Connect via SSH to any of the remaining node VMs, open the node log and search for results of election (search for the string "selected primary") for the last view change ({{view 2}}). *  New primary has been selected only in the master protocol instance.  *  Expected results: * Primary re-election must be performed in all the protocol instances regardless of the cause of the view change.  ></description> </Issue>
