<Action id="47699" issue="31969" author="dsurnin" type="comment" created="2018-07-24 09:57:58.0" updateauthor="dsurnin" updated="2018-07-24 09:57:58.0"> <body><! CDATA After team discussion we decided to add a target packet name in config - indy-node or sovrin. Current POOL_UPGRADE command syntax will not be modified.  PoA updated the same way   ></body> </Action>
<Action id="48226" issue="31969" author="ashcherbakov" type="comment" body="We will also need a migration script that should set the config parameter for top-level package to Sovrin." created="2018-08-01 07:24:59.0" updateauthor="ashcherbakov" updated="2018-08-01 07:24:59.0"/>
<Action id="48255" issue="31969" author="dsurnin" type="comment" created="2018-08-01 14:27:56.0" updateauthor="dsurnin" updated="2018-08-01 14:28:28.0"> <body><! CDATA PRs https://github.com/sovrin-foundation/sovrin/pull/77 https://github.com/hyperledger/indy-node/pull/843  for now pool_upgrade command will update packages starting from the top level package from the config parameter UPGRADE_ENTRY for node default is "indy-node" for sovrin default is "sovrin"  also sovrin pkg now depends from particular node version  for QA: 1 check that clean indy-node upgrade (without sovrin) is wrorking  2 install old sovrin cmd pool_upgrade requires indy-node version run pool_upgrade to upgrade indy-node to version >= 536 two case: manually install sovrin or in indy node config add UPGRADE_ENTRY = 'sovrin' now pool_upgrade command requires sovrin package version run pool_upgrade to latest and check that all the packages updated (plenum, node, sovrin)    ></body> </Action>
<Action id="48360" issue="31969" author="vladimirwork" type="comment" body="Ticket is waiting for additional fixes." created="2018-08-03 13:07:52.0" updateauthor="vladimirwork" updated="2018-08-03 13:07:52.0"/>
<Action id="48540" issue="31969" author="dsurnin" type="comment" created="2018-08-08 08:59:45.0" updateauthor="dsurnin" updated="2018-08-08 08:59:45.0"> <body><! CDATA New optional param "package" is added to upgrade command. Package mentioned in "package" parameter must be installed and must has node as a dependency. "version" param should correspond to package being updated. In case of "indy-node" upgrade any top level packages that has node as a dependency are not updated. If param is omitted "indy-node" is assumed. Old cli also modified to support new param. PR: https://github.com/hyperledger/indy-node/pull/869  ></body> </Action>
<Action id="48698" issue="31969" author="vladimirwork" type="comment" created="2018-08-10 10:01:49.0" updateauthor="vladimirwork" updated="2018-08-10 11:31:01.0"> <body><! CDATA Build Info: sovrin 1.1.67 indy-node 1.5.555  Steps to Reproduce: 1. Send pool upgrade command with reinstall via old CLI: {noformat} send POOL_UPGRADE name=upgrade67cancel version=1.1.67 sha256=ed0a366b4ef36d40c055672a8b83679e99246fec71a706b4ae4cb7958feace3f action=start schedule={'Gw6pDLhcBcoQesN72qfotTgFa7cbuqZpkX3Xo6pL hPhv':'2018-08-10T10:00:00.258870+00:00','8ECVSk179mjsjKRLWiQtssMLgp6EPhWXtaYyStWPSGAb': '2018-08-10T10:05:00.258870+00:00', 'DKVxG2fXXTU8yT5N7hGEbXB3dfdAnYv1JczDUHpmDxya': '2018-08-10T10:10:00.258870+00: 00', '4PS3EDQ3dW1tci1Bp6543CfuuebjFrg36kLAUcskGfaA': '2018-08-10T10:15:00.258870+00:00'} timeout=10 force=False reinstall=True package=sovrin Sending pool upgrade upgrade67cancel for version 1.1.67 {noformat} 2. Try to cancel it via old CLI: {noformat} send POOL_UPGRADE name=upgrade67cancel version=1.1.67 sha256=ed0a366b4ef36d40c055672a8b83679e99246fec71a706b4ae4cb7958feace3f action=cancel schedule={'Gw6pDLhcBcoQesN72qfotTgFa7cbuqZpkX3Xo6p LhPhv':'2018-08-10T10:00:00.258870+00:00','8ECVSk179mjsjKRLWiQtssMLgp6EPhWXtaYyStWPSGAb': '2018-08-10T10:05:00.258870+00:00', 'DKVxG2fXXTU8yT5N7hGEbXB3dfdAnYv1JczDUHpmDxya': '2018-08-10T10:10:00.258870+00 :00', '4PS3EDQ3dW1tci1Bp6543CfuuebjFrg36kLAUcskGfaA': '2018-08-10T10:15:00.258870+00:00'} timeout=10 force=False reinstall=True package=sovrin {noformat}  Actual Result: {color:red}Pool upgrade failed: client request invalid: InvalidClientRequest('Version is not upgradable',){color}  Expected Results: Pool upgrade should be cancelled.  Additioanl Info: We have the same behavior with indy-node upgrade cancelling with the same version (e.g. 1.5.555 -> 1.5.555).  ></body> </Action>
<Action id="48705" issue="31969" author="dsurnin" type="comment" created="2018-08-10 11:27:43.0" updateauthor="dsurnin" updated="2018-08-10 11:27:43.0"> <body><! CDATA this it old cli issue  PR https://github.com/hyperledger/indy-node/pull/887  ></body> </Action>
<Action id="48754" issue="31969" author="vladimirwork" type="comment" created="2018-08-11 10:50:14.0" updateauthor="vladimirwork" updated="2018-08-11 10:52:31.0"> <body><! CDATA Build Info: indy-node 1.6.70 sovrin 1.1.13  Steps to Validate: 1. Send pool upgrade command with reinstall via old CLI: {noformat} send POOL_UPGRADE name=upgrade10_13_re version=1.1.13 sha256=ed0a366b4ef36d40c055672a8b83679e99246fec71a706b4ae4cb7958feace3f action=start schedule={'Gw6pDLhcBcoQesN72qfotTgFa7cbuqZpkX3Xo6pLhPhv':'2018-08-11T10:45:00.258870+00:00','8ECVSk179mjsjKRLWiQtssMLgp6EPhWXtaYyStWPSGAb': '2018-08-11T10:50:00.258870+00:00', 'DKVxG2fXXTU8yT5N7hGEbXB3dfdAnYv1JczDUHpmDxya': '2018-08-11T10:55:00.258870+00:00', '4PS3EDQ3dW1tci1Bp6543CfuuebjFrg36kLAUcskGfaA': '2018-08-11T11:00:00.258870+00:00'} timeout=10 force=False reinstall=True package=sovrin {noformat}  2. Try to cancel it via old CLI: {noformat} send POOL_UPGRADE name=upgrade10_13_re version=1.1.13 sha256=ed0a366b4ef36d40c055672a8b83679e99246fec71a706b4ae4cb7958feace3f action=cancel schedule={'Gw6pDLhcBcoQesN72qfotTgFa7cbuqZpkX3Xo6pLhPhv':'2018-08-11T10:45:00.258870+00:00','8ECVSk179mjsjKRLWiQtssMLgp6EPhWXtaYyStWPSGAb': '2018-08-11T10:50:00.258870+00:00', 'DKVxG2fXXTU8yT5N7hGEbXB3dfdAnYv1JczDUHpmDxya': '2018-08-11T10:55:00.258870+00:00', '4PS3EDQ3dW1tci1Bp6543CfuuebjFrg36kLAUcskGfaA': '2018-08-11T11:00:00.258870+00:00'} timeout=10 force=False reinstall=True package=sovrin {noformat}   Actual Result: Pool upgrade is cancelled successfully.  Additional Info: Regression testing of upgrade procedure also was performed in scope of this ticket against both indy-node and sovrin packages: - force=False upgrades - force=True upgrades - reinstallation - cancellation - downgrading (forbidden) - upgrade to nonexistent version (rollback) - upgrade indy-node *without* sovrin installed - upgrade indy-node *with* sovrin installed (rollback) - upgrade logging - archive backups  ></body> </Action>
