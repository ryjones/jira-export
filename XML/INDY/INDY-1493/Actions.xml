<Action id="47482" issue="32008" author="zhigunenko.dsr" type="comment" created="2018-07-18 13:48:41.0" updateauthor="zhigunenko.dsr" updated="2018-07-18 13:55:01.0"> <body><! CDATA ||types ||   â„– objects ||   total size|| |                                          <class 'str |      630578 |     71.93 MB | |                                         <class 'dict |      200976 |     55.78 MB | |                                        <class 'tuple |      141700 |     13.78 MB | |                                         <class 'list |       21904 |     11.25 MB | |                <class 'indy_common.types.SafeRequest |      133809 |      7.15 MB | |                                          <class 'int |      142333 |      4.83 MB | |                                          <class 'set |        5363 |      2.00 MB | |                                         <class 'type |        1895 |      1.91 MB | |                                         <class 'code |       13584 |      1.87 MB | |                      <class 'collections.OrderedDict |        1598 |      1.37 MB | |            <class 'plenum.server.propagator.Requests |           1 |      1.18 MB | |                 <class 'orderedset._orderedset.entry |       16130 |   1008.12 KB | |                                      <class 'weakref |        5363 |    418.98 KB | |            <class 'plenum.server.propagator.ReqState |        5754 |    314.67 KB | |                <class 'plenum.common.request.Request |        5754 |    314.67 KB | |                                  <class 'abc.ABCMeta |         274 |    281.45 KB | |       <class 'sortedcontainers.sorteddict.SortedDict |          37 |    214.23 KB | |                           <class 'typing.GenericMeta |         218 |    209.17 KB | |                                   function (_remove) |        1512 |    200.81 KB | |                            <class 'getset_descriptor |        2018 |    141.89 KB | |                                  function (__init__) |        1054 |    139.98 KB | |                                    <class 'frozenset |         250 |    112.69 KB | |                 <class 'plenum.server.models.Commits |           9 |    108.98 KB | |                <class 'plenum.server.models.Prepares |           9 |    108.98 KB | |                           <class 'wrapper_descriptor |        1276 |     99.69 KB | |                   <class 'builtin_function_or_method |        1260 |     88.59 KB | |                            <class 'method_descriptor |        1231 |     86.55 KB | |                             <class '_sre.SRE_Pattern |         196 |     84.66 KB | |                          <class '_weakrefset.WeakSet |        1512 |     82.69 KB | |                            <class 'collections.deque |         131 |     80.85 KB | |                                     <class 'property |         981 |     76.64 KB | |                             <class 'typing.UnionMeta |          71 |     70.45 KB | |               <class 'intervaltree.interval.Interval |        1000 |     70.31 KB | |         <class 'plenum.server.models.ThreePhaseVotes |         985 |     61.56 KB | |                       <class 'intervaltree.node.Node |        1000 |     54.69 KB | |                                       <class 'method |         823 |     51.44 KB | |                 <class '_frozen_importlib.ModuleSpec |         852 |     46.59 KB | |                                        <class 'float |        1775 |     41.60 KB | |                                  function (__repr__) |         296 |     39.31 KB | |                                <class 'enum.EnumMeta |          38 |     37.98 KB | |                             <class 'typing.TupleMeta |          40 |     34.69 KB | |                                         <class 'cell |         716 |     33.56 KB | |  <class '_frozen_importlib_external.SourceFileLoader |         611 |     33.41 KB | |                            <class 'member_descriptor |         457 |     32.13 KB | |      plenum.common.messages.node_messages.PrePrepare |         492 |     26.91 KB | |          plenum.common.messages.node_messages.Commit |         492 |     26.91 KB | |         plenum.common.messages.node_messages.Prepare |         492 |     26.91 KB | |                        <class '_ctypes.PyCSimpleType |          26 |     25.80 KB | |                                        <class 'bytes |         429 |     25.00 KB | |                                      <class 'StgDict |          41 |     23.86 KB |  Memory consumption after 100k writings !before.png!   Memory consumption after service restart !after.png!  ></body> </Action>
<Action id="48175" issue="32008" author="anikitindsr" type="comment" created="2018-07-31 10:25:48.0" updateauthor="anikitindsr" updated="2018-07-31 10:25:48.0"> <body><! CDATA After several experiments was noticed that: # Memory usage of internal python's structure is not high. During load it was around 1Gb (string, dicts and list is in the top) with all RAM usage by python process is about 5-6 Gb # Also, in process "start_indy_node" we have threads with rocksdb and zeroMQ. Rocksdb use in-memory conception and store all data in RAM by blocks. In other words, under load, it can allocate too much RAM for internal usage. # ZeroMQ get data from socket buffers, store it into internal queue and return to python layer when it needed. Therefore, we need to increase count of extracted packages or limit size of internal zeroMQ queues. # Potentially, after allLedgersCaughtUp internal queue with preprepares, sentPreprepares, prepares, commit and etc will be cleaned only if replica isMaster or if not isPrimary. In other words, for backup replicas, in the case if this replica is primary, internal queues was not cleaned.  ></body> </Action>
<Action id="48279" issue="32008" author="anikitindsr" type="comment" created="2018-08-02 09:05:07.0" updateauthor="anikitindsr" updated="2018-08-02 09:05:07.0"> <body><! CDATA Status of last experiments: # In case with sending "all txns (NYM, ATTRIB, SCHEMA, CLAIM_DEF, REVOC_REG_DEF, REVOC_ENTRY)" we got "out of memory" errors after ~ 30k txns. RAM was not freed after stopping load test. Internal structures, like dicts, lists, str were taken ~ 2GB from ~7Gb for whole indy-node's process. # In case with sendin "only revocations" memory usage was similar as in step 1. # In case with sending "all txns except revocations (REVOC_REG_DEF, REVOC_ENTRY, read/write)" memory usage is acceptable. After about 30 k txns rss usage was ~400 Mb.  Therefore, we need to continue investigating memory usage problems in case with revocation transactions.  ></body> </Action>
<Action id="48280" issue="32008" author="ashcherbakov" type="comment" body="Further investigation will be continued in the scope of INDY-1546" created="2018-08-02 09:10:50.0" updateauthor="ashcherbakov" updated="2018-08-02 09:10:50.0"/>
