<Issue id="40362" key="INDY-2129" number="2129" project="10303" reporter="ashcherbakov" assignee="andkononykhin" creator="ashcherbakov" type="10004" summary="Primaries are not updated in audit ledger if one of the primaries is demoted" priority="1" resolution="10000" status="10001" created="2019-06-04 09:13:51.0" updated="2019-06-06 07:05:34.0" resolutiondate="2019-06-06 07:05:34.0" votes="0" watches="1" workflowId="53277"> <description><! CDATA *Issue Reason:* * The primaries are not changed (updated) if one of them is demoted and F (number of replicas) is not changed. ** For example, we had 6 nodes (F=1), and demoting 1 (F is still 1) * The list of primaries is stored in the audit ledger for recovering after restart. If a node (or a pool) is restarted, then the primaries will be restored from the audit ledger. So, if one of the primaries is demoted, it will not be found, and the pool raises `LogicError('Audit ledger has inconsistent names of nodes')`.        *How to fix the issue* * Integration test must be written * The primaries in audit ledger needs to be updated if a demoted node is in the list of current primaries * A view change needs to be triggered if a demoted node is in the list of current primaries * Non-critical (recoverable) cases during node start-up (catch-up, post-catchup, primary selection) should not raise the LogicErrors. ** in particular, in `on_catchup_complete` method in `PrimarySelector`  ></description> </Issue>
