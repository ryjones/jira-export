<Issue id="18572" key="INDY-313" number="313" project="10303" reporter="krw910" assignee="danielhardman" creator="krw910" type="10002" summary="Catch Up: When a demoted node is added back to the pool will it do a catch up" priority="3" resolution="10000" status="10001" created="2017-06-22 15:49:07.0" updated="2019-03-29 20:34:42.0" resolutiondate="2019-03-29 20:34:42.0" votes="0" watches="2" timeoriginalestimate="10800" timeestimate="10800" workflowId="18572"> <description><! CDATA Take a node in the pool and as a Trustee demote that node so it does not take part in consensus.  Run several transactions on the pool to make sure it is not taking part in consensus or committing transactions to its ledger. Now promote the node back into the pool.  Does the catch up process happen correctly?  Another test would be to just restart a demoted node and see if it not only catches up but does it also get added back into the pool for consensus by default.  *Things tried:* *Case 1:* Promoting node (as Trustee). This case duplicates valid steps of scenarios 7-8: 1. Add 2 more nodes to pool. 2. Demote them as Trustee. 3. Send several NYMs. 4. Promote the Nodes as Trustee. 5. Check the transactions files.  *Case 2:* Restart demoted node. 1. Add 2 more nodes to pool. 2. Demote them as Trustee. 4. Send several NYMs. 5. Restart sovrin-node on the demoted node. 6. Compare  wc -l .sovrin/data/nodes/Node4/transactions_sandbox/1 wc -l .sovrin/data/nodes/Node5/transactions_sandbox/1  *Case 3:* This problem was discussed with developers. Probably it make sense to play with turned on / turned off view change.  1. Turn off view change. 2. Restart services on Node1 - Node4. 3. Reset Node5 and Node6. 4. Perform steps of Case 1 and Case 2.  *Findings:*  Case 1: after promoting the node, there no messages about catch up in node logs. Files data/nodes/Node5/transactions_sandbox/1 and data/nodes/Node4/transactions_sandbox/1 are still different. Ticket for this problem is INDY-314.  Case 2: count of transactions for demoted and not demoted node are different. So, restart does not affect demotion of node.  Case 3: after several reset of pool, problem with catch up stopped to reproduce. Now catch up works for both of turned on and turned off view change. Probably there were some problems with configuration of pool, or there were more tricky steps to reproduce. According comment and new logs were added to INDY-314. There is no updates regarding Case2 with turned off view changes, the system works as expected.  ></description> </Issue>
