<Issue id="43142" key="INDY-2285" number="2285" project="10303" reporter="ashcherbakov" assignee="vladimirwork" creator="ashcherbakov" type="10002" summary="PrePrepare&apos;s Digest need to take into account all PrePrepare&apos;s fields" priority="3" resolution="10000" status="10001" created="2019-11-06 13:18:45.0" updated="2019-11-28 08:33:56.0" resolutiondate="2019-11-28 08:31:44.0" votes="0" watches="3" workflowId="56248"> <description><! CDATA As of now, PrePrepare's digest is created over a list of requests proposed by this PrePrepare. It doesn't take into account other fields such as txn roots, timestamp, etc.  So, a malicious Primary may send PrePrepare with the same requests (that is the same digest in the current implementation) but with different other fields (audit roots, timestamp, etc.) to every Node.  This is not so big problem for common ordering since ViewChange will be triggered.  But this is a problem for View Change when we do re-ordering, since nodes may have different PrePrepares for the same digest and will not be able to finish re-ordering (and hence finish view change).  *Accepted criteria:* * Write an integration test: ** Test 1: *** Malicious Primary sends correct and equal PrePrepares to F+1 Npdes, and sends PrePrepares with the same list of requests but with different audit txn roots to other nodes  *** Make sure that view change is started and successfully finished in this case. The requests sent in the PrePrepare above are expected to be ordered.   ** Test 2: *** Malicious Primary sends PrePrepares with the same list of requests but with different audit txn roots to all nodes *** Make sure that view change is started and successfully finished in this case. The requests sent in the PrePrepare above are expected to NOT be ordered.   * Do a fix: ** Calculate PrePrepares' digest against all PrePrepare's fields     ></description> </Issue>
