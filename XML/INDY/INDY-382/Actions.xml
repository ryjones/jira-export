<Action id="27941" issue="18983" author="ozheregelya" type="comment" created="2017-07-06 13:54:25.0" updateauthor="ozheregelya" updated="2017-07-06 13:54:25.0"> <body><! CDATA On the next day this pool looks like this:  !2017-07-06 16_29_23-.png|thumbnail! Node 1 and Node 2 were upgraded yesterday (as described in description of this ticket). But really strange thing happened with Node 3 and Node 4. They either tried to upgrade out of schedule (but upgrade was failed because of problems with dependencies). So, it looks like upgrade scheduling to future date does not work at all. New logs are attached:  ^new_logs.tar.gz   ></body> </Action>
<Action id="32990" issue="18983" author="spivachuk" type="comment" created="2017-10-23 15:45:17.0" updateauthor="spivachuk" updated="2017-10-23 15:48:32.0"> <body><! CDATA *Problem status:* - The issue described in the ticket description is not reproduced on the current {{master}} version. The issue might be earlier caused by INDY-231 which has already been fixed. - Found another issue: node upgrade is scheduled twice in case pool upgrade is made in force mode. This can be seen in the upgrade log: 3 messages are added for the same upgrade: {{scheduled}}, {{cancelled}} and {{scheduled}}.  *Changes:* - Fixed the issue with repeated scheduling of node upgrade in case pool upgrade is made in force mode.  *Committed into:* - https://github.com/hyperledger/indy-plenum/pull/424 - https://github.com/hyperledger/indy-node/pull/408 - indy-plenum 1.1.147 master - indy-node 1.1.174 master  *Risk factors:* - Handling of {{POOL_UPGRADE}} and {{POOL_CONFIG}} transactions with {{force=True}}, with {{force=False}} and without {{force}} flag.  *Risk:* - Low  *Covered with tests:* - The absence of the issue described in the ticket is verified by {{test_node_reschedules_upgrade_for_proper_datetime}}. - The absence of the issue with repeated scheduling of node upgrade in case pool upgrade is made in force mode is verified by {{test_pool_upgrade_force_scheduled_only_once}}.  *Recommendations for QA:* * It should be tested that: - the issue described in the ticket description is not reproduced on the current {{master}} version; - the issue with repeated scheduling of node upgrade in case pool upgrade is made in force mode has been fixed.  ></body> </Action>
<Action id="33210" issue="18983" author="vladimirwork" type="comment" created="2017-10-26 12:24:36.0" updateauthor="vladimirwork" updated="2017-10-26 12:25:39.0"> <body><! CDATA Build Info: indy-node 1.2.185  Steps to Reproduce - Case 1: 1. Send POOL_UPGRADE to one or several nodes. Node1 upgrade is scheduled to 2017-10-29 10:00: {code:java} send POOL_UPGRADE name=upgrade-1 version=1.2.186 sha256=f6f2ea8f45d8a057c9566a33f99474da2e5c6a6604d736121650e2730c6fb0a3 action=start schedule={'Gw6pDLhcBcoQesN72qfotTgFa7cbuqZpkX3Xo6pLhPhv': '2017-10-29T10:00:00.000000+00:00'} timeout=10 force=True{code} Node2 upgrade is scheduled to 2017-10-27 10:10: {code:java} send POOL_UPGRADE name=upgrade-2 version=1.2.186 sha256=f6f2ea8f45d8a057c9566a33f99474da2e5c6a6604d736121650e2730c6fb0a3 action=start schedule={'8ECVSk179mjsjKRLWiQtssMLgp6EPhWXtaYyStWPSGAb': '2017-10-27T10:10:00.000000+00:00'} timeout=10 force=True{code} 2. Send POOL_UPGRADE to all nodes. All nodes upgrade is scheduled to 2017-10-28: {code:java} send POOL_UPGRADE name=upgrade-3 version=1.2.186 sha256=f6f2ea8f45d8a057c9566a33f99474da2e5c6a6604d736121650e2730c6fb0a3 action=start schedule={'Gw6pDLhcBcoQesN72qfotTgFa7cbuqZpkX3Xo6pLhPhv': '2017-10-28T10:20:00.000000+00:00', '8ECVSk179mjsjKRLWiQtssMLgp6EPhWXtaYyStWPSGAb': '2017-10-28T10:25:00.000000+00:00', 'DKVxG2fXXTU8yT5N7hGEbXB3dfdAnYv1JczDUHpmDxya': '2017-10-28T10:30:00.000000+00:00', '4PS3EDQ3dW1tci1Bp6543CfuuebjFrg36kLAUcskGfaA': '2017-10-28T10:35:00.000000+00:00'} timeout=10 force=False{code}  Actual Results: The last upgrade txn on each node cancels previous upgrade txn for this node. Upgrades scheduled on future date are not performed at current date.  Steps to Reproduce - Case 2: 1. Send POOL_UPGRADE to one or several nodes. Node1 upgrade is scheduled to 2017-10-26 11:00: {code:java} send POOL_UPGRADE name=upgrade--1 version=1.2.186 sha256=f6f2ea8f45d8a057c9566a33f99474da2e5c6a6604d736121650e2730c6fb0a3 action=start schedule={'Gw6pDLhcBcoQesN72qfotTgFa7cbuqZpkX3Xo6pLhPhv': '2017-10-26T11:00:00.000000+00:00'} timeout=10 force=True{code} Node2 upgrade is scheduled to 2017-10-26 11:10: {code:java} send POOL_UPGRADE name=upgrade--2 version=1.2.186 sha256=f6f2ea8f45d8a057c9566a33f99474da2e5c6a6604d736121650e2730c6fb0a3 action=start schedule={'8ECVSk179mjsjKRLWiQtssMLgp6EPhWXtaYyStWPSGAb': '2017-10-26T11:10:00.000000+00:00'} timeout=10 force=True{code} 2. Send POOL_UPGRADE to all nodes. All nodes upgrade is scheduled to 2017-10-26: {code:java} send POOL_UPGRADE name=upgrade--3 version=1.2.186 sha256=f6f2ea8f45d8a057c9566a33f99474da2e5c6a6604d736121650e2730c6fb0a3 action=start schedule={'Gw6pDLhcBcoQesN72qfotTgFa7cbuqZpkX3Xo6pLhPhv': '2017-10-26T11:20:00.000000+00:00', '8ECVSk179mjsjKRLWiQtssMLgp6EPhWXtaYyStWPSGAb': '2017-10-26T11:25:00.000000+00:00', 'DKVxG2fXXTU8yT5N7hGEbXB3dfdAnYv1JczDUHpmDxya': '2017-10-26T11:30:00.000000+00:00', '4PS3EDQ3dW1tci1Bp6543CfuuebjFrg36kLAUcskGfaA': '2017-11-26T10:35:00.000000+00:00'} timeout=10 force=False{code}  Actual Results: The last upgrade txn on each node cancels previous upgrade txn for this node. All nodes are upgraded in accordance with the schedule.  ></body> </Action>
