<Issue id="42607" key="INDY-2237" number="2237" project="10303" reporter="ashcherbakov" creator="ashcherbakov" type="10002" summary="Start catch-up before processing NewView if the node is behind the NewView&apos;s checkpoint" priority="3" status="10200" created="2019-10-03 08:57:16.0" updated="2020-01-08 08:55:30.0" votes="0" watches="1" workflowId="55675"> <description><! CDATA *Problem* * According to Fig 4 in  https://www.microsoft.com/en-us/research/wp-content/uploads/2017/01/p398-castro-bft-tocs.pdf,  we select the highest Checkpoint that has a weak certificate (F+1 nodes) for NewView. * The requests will be re-ordered only after this checkpoint * So, there can be N-F-1 nodes that can not re-order requests (and since view change will not finish correctly) because they haven't ordered yet all requests before the chosen in NewView checkpoint * As a workaround, we now require a strong certificate (N-F nodes) when calculating the checkpoint (see INDY-2231). This may increase the number of requests to be re-ordered. * If a new Primary doesn't have the selected checkpoint, than according to INDY-2230 we just don't send a NewView and will wait till timeout to select the next Primary  *References* *  https://www.microsoft.com/en-us/research/wp-content/uploads/2017/01/p398-castro-bft-tocs.pdf  * INDY-2231 * INDY-2230  *The fix*  Quote from `New-View Message Processing` in  https://www.microsoft.com/en-us/research/wp-content/uploads/2017/01/p398-castro-bft-tocs.pdf  {quote}It obtains any requests in X that it is missing and if it does not have thecheckpoint with sequence numberh, it also initiates the protocol to fetch themissing state {quote} So, we need to start a catch-up till the checkpoint in NewView before going forward.  *Acceptance criteria* * Start a catchup if the node receives a NewView and doesn't have a checkpoint selected in NewView  *  ** F+1 nodes are enough to finish the catch-up * Do not finish View Change (wait_for_new_view should still be True) until this catch-up is finished * Catch-up needs to be done till checkpoint from NewView * Go back to weak certificate in `NewViewBuilder`'s `calc_checkpoint`  Â   ></description> </Issue>
