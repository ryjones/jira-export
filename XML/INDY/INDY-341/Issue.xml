<Issue id="18738" key="INDY-341" number="341" project="10303" reporter="aleksey-roldugin" assignee="anikitindsr" creator="aleksey-roldugin" type="10004" summary=" POOL_UPGRADE  NYMs cannot be added after upgrade with specific conditions and force=True flag " priority="3" resolution="10000" status="10001" created="2017-06-28 09:32:17.0" updated="2019-03-29 20:33:35.0" resolutiondate="2019-03-29 20:33:35.0" votes="0" watches="2" workflowId="18738"> <description><! CDATA h6. BUILD  sovrin-node 0.3.161 sovrin-client 0.3.150 h6. PRECONDITIONS * 4-nodes pool * 1 node is blacklisted * 1 node is turned off (by command _sudo systemctl stop sovrin-node_)  h6. STEPS TO REPRODUCE # Run sovrin-client and connect to test (connected only to 2 nodes). # Run POOL_UPGRADE ** Schedule contains identifiers of all nodes except turned off node. ** Time for all identifiers is in the past (near 5 minutes before current moment) ** Force=True # RESULT: ** 2 running nodes is upgraded immediately, blacklisted node is not upgraded. ** NYM cannot be added since f+1 condition is not met (2 nodes are running in 4 nodes pool) # Run _sudo systemctl restart sovrin-node_ on turned off node => RESULT: node is turned on, client connected to it. # Try to add NYM => RESULT: NYM is not added (but f+1 condition is met). # Run POOL_UPGRADE with force=True flag specifying only recently turned on node => Result: node is upgraded. # Try to add NYM.  h6. ACTUAL RESULT  NYM is not added. Lines count check (wc -l .sovrin/data/nodes/<Node number>/transactions_sandbox/1) shows different count on all 4 nodes but the last transaction is the same on every node except blacklisted. However file from blacklisted node and from turned on node contains near 1000 empty strings. h6. ADDITIONAL INFORMATION  Restart services on nodes fixes that issue. Attachment contains logs of all 4 nodes.  ></description> </Issue>
