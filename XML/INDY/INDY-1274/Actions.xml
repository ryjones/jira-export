<Action id="43024" issue="29420" author="seanbohan_sovrin" type="comment" body=" ~ashcherbakov   ~nage  - can you both take a look at this and give this some consideration?" created="2018-04-16 20:55:08.0" updateauthor="seanbohan_sovrin" updated="2018-04-16 20:55:08.0"/>
<Action id="43025" issue="29420" author="esplinr" type="comment" created="2018-04-16 20:56:24.0" updateauthor="esplinr" updated="2018-04-16 20:57:15.0"> <body><! CDATA  ~dsurnin  raises a useful usability / administration concern. I think this is more of a feature request than a task.  We should consider the right way to give feedback on slow responses, whether that's to the requestor or to the node admin in the logs. The right approach will not create a vulnerability to denial of service attacks.  ></body> </Action>
<Action id="43447" issue="29420" author="esplinr" type="comment" body=" ~mgbailey  considers this critical for taking the network into a production state in order to diagnose problems with the network." created="2018-04-25 22:26:18.0" updateauthor="esplinr" updated="2018-04-25 22:27:19.0"/>
<Action id="43587" issue="29420" author="esplinr" type="comment" created="2018-04-27 21:20:51.0" updateauthor="esplinr" updated="2018-04-27 21:20:51.0"> <body><! CDATA Trev suggests two improvements. As much as possible, log output should be contextualized to assist administrators in understanding what is going on, and how they should respond.  1. It is unlikely that an admin will know that a "Primary node" should match the "Pre-Prepare node". So it is only useful to show the Pre-Prepare node when they do not match. {noformat} Display Primary node is  Node ID .  Pre-Prepare received from  node_id  does not match.  {noformat}  2. Trevor and I are both unclear as to the usefulness of knowing "Received  N  Prepares from  ... ". Should we just drop this line?  Because the work has already been taken into a sprint, I did not edit the description of the issue. If the architect and developer agree with the suggestions, then it would be good to incorporate the improvements in this comment. But if you do not agree or if they significantly change the size of the story, then we can proceed with the current specification and decide later if more changes are necessary.  ></body> </Action>
<Action id="43593" issue="29420" author="ashcherbakov" type="comment" created="2018-04-28 07:43:24.0" updateauthor="ashcherbakov" updated="2018-04-28 07:43:24.0"> <body><! CDATA  ~esplinr   ~tharmon   As for 1: We may not receive PrePrepare at all, so it's always useful to display information whether we receive PrePrepare.  As for 2: This is the most essential part of this ticket. Without these lines I do not see much value in the ticket at all (we can just display that we do not reach consensus). This information is the only one allowing to provide more info about why we didn't have consensus.  ></body> </Action>
<Action id="43594" issue="29420" author="ashcherbakov" type="comment" created="2018-04-28 07:48:08.0" updateauthor="ashcherbakov" updated="2018-04-28 07:48:08.0"> <body><! CDATA I would rather suggest more extensions to the message as follows: - mention whether the PrePrepare was suspicious - mention whether Prepare/Commit was invalid  {code} Consensus for ReqId:    was not achieved within  Timeout  seconds: Primary node is  Node ID  Received valid Pre-Prepare from  node_id  | Didn't receive a Pre-Prepare Received invalid Pre-Prepare from  node_id1 : <short desc of validation error>, Received invalid Pre-Prepare from  node_id2 : <short desc of validation error>, ..... Received  N  valid Prepares from  nodes_id1, node_id2, ...  Received invalid Prepare from  node_id1 : <short desc of validation error>, Received invalid Prepare from  node_id2 : <short desc of validation error>, ...  Received  M  valid Commits from  nodes_id1, node_id2, ...  Received invalid Commit from  node_id1 : <short desc of validation error>, Received invalid Commit from  node_id2 : <short desc of validation error>, ...  Transaction contents:  Contents  {code}  ></body> </Action>
<Action id="43785" issue="29420" author="derashe" type="comment" created="2018-05-03 16:33:09.0" updateauthor="derashe" updated="2018-05-03 16:33:09.0"> <body><! CDATA Problem reason: - We need to add log information when request have not been ordered for a while.  Changes: - Logging functionality added to the monitor class in form of a handler.  - Timeout is configurable with UnorderedCheckFreq in plenum/config.py.  PR: - https://github.com/hyperledger/indy-plenum/pull/663  Version: - master, 346  Risk factors: - No  Risk: - Low  Covered with tests: - There are tests that cause this message appear in  plenum/test/monitoring/test_warn_unordered_log_msg.py|https://github.com/hyperledger/indy-plenum/pull/663/files#diff-008e1a17f6d7a88b51b579007b117893   Recommendations for QA  Reproduce situation when txn have not been ordered and check that log message present. You can try to start 4-nodes pool, dissconnect two of them and send request.  ></body> </Action>
<Action id="43790" issue="29420" author="esplinr" type="comment" created="2018-05-03 17:30:40.0" updateauthor="esplinr" updated="2018-05-03 17:30:40.0"> <body><! CDATA Sorry for the delay in responding to Alex's feedback. I spoke with  ~mgbailey . We want to provide admins with the information they need without drowning them in verbosity. Once Mike understood that messages about the status of the Pre-Prepare and Prepare will only be given as a summary of the node state when an error is received, and are not emitted each time a Pre-Prepare or Prepare message is received, he felt like we are hitting the right balance.  1. As you recommend, we will keep the Pre-Prepare message.  2. As you recommend, we will keep the message about Received N Prepares from . . .  3. We would like to defer your suggestion to report on whether the PrePrepare was suspicious.  4. We would like to defer your suggestion to report on whether the Prepare/Commit was invalid.  5. The message counts  N  and  M  in the description should only refer to valid messages (it might help to add the word "valid" to those lines of the log output): "Received  N  valid Prepares from . . . ".  It seems to us that invalid messages should be extremely rare, and would be the results of bugs in Indy Node rather than something that an administrator can address. Validation failures might be reported as separate messages, but Mike doesn't think they improve an admins understanding of how their node fits into the rest of the network which is the goal of this story.  ></body> </Action>
<Action id="43806" issue="29420" author="ashcherbakov" type="comment" created="2018-05-04 09:00:06.0" updateauthor="ashcherbakov" updated="2018-05-04 09:00:06.0"> <body><! CDATA {quote} 3. We would like to defer your suggestion to report on whether the PrePrepare was suspicious. 4. We would like to defer your suggestion to report on whether the Prepare/Commit was invalid. {quote} I agree that we can defer it for now, but I would create a separate ticket.  {quote} 5. The message counts  N  and  M  in the description should only refer to valid messages (it might help to add the word "valid" to those lines of the log output): "Received  N  valid Prepares from . . . ". {quote}  ~Derashe  I think we already show only valid messages, but can we please double-check this and add 'valid' to the message?  {quote} It seems to us that invalid messages should be extremely rare, and would be the results of bugs in Indy Node rather than something that an administrator can address. Validation failures might be reported as separate messages, but Mike doesn't think they improve an admins understanding of how their node fits into the rest of the network which is the goal of this story. {quote} No, this is not necessary bugs. For example, a Primary may have wrong clocks, and Pre-Prepares from this Primary will be discarded. Also Pre-Prepare can be discarded if the Node's ledger doesn't match the rest of the Network (we can consider this as a bug in the code, but I think that this is possible in theory; for example, someone may edit the ledger manually). Another example of invalid Messages (Pre-Prepare and Commit): wrong BLS signature. So, we can identify that either our node has wrong BLS keys, or another node has.  I think we already log such validation errors, so this is most probably not a high priority to show this info in the scope of the ticket, but we may consider create a separate ticket for this.  ></body> </Action>
<Action id="43812" issue="29420" author="derashe" type="comment" created="2018-05-04 11:03:20.0" updateauthor="derashe" updated="2018-05-04 11:03:20.0"> <body><! CDATA Ok, then for now log message should looks like that:  _Consensus for ReqId:    was not achieved within  Timeout  seconds:_   _Primary node is  Node ID _   _Received Pre-Prepare from  node_id _   _Received  N  valid Prepares from  nodes_id1, node_id2, ... _  _Received  M  valid Commits from  nodes_id1, node_id2, ... _   _Transaction contents:  Contents _   ~esplinr  is this right?  ></body> </Action>
<Action id="44084" issue="29420" author="ozheregelya" type="comment" created="2018-05-08 17:00:01.0" updateauthor="ozheregelya" updated="2018-05-08 17:00:01.0"> <body><! CDATA Following warnings appear for not ordered transactions: {code:java} 2018-05-08 15:55:30,529 | WARNING | replicas.py ( 193) | unordered_request_handler_logging | Consensus for ReqId: 1525794469250069 was not achieved within 461.2516935040003 seconds. Primary node is Node1. Received Pre-Prepare from Node1:0. Received 3 Prepares from Node2:0, Node3:0, Node4:0. Received 0 Commits from noone. Transaction contents: {'protocolVersion': 1, 'reqId': 1525794469250069, 'identifier': 'V4SGRU86Z58d6TV7PBUe6f', 'signature': '3nCSDWLkUsvbgphuesim1nRqWeB5N1E9hHgk34tfe3PLdYmSFF99EKeA9BCcaN56Yud8RxNfURkXKarf3wFfzPnp', 'operation': {'dest': 'V4SGRU86Z58d6TV7PBUe64', 'type': '1'}}. {code}    This massage appears every minute.   ~esplinr , is it ok? After implementation of INDY-465 it was shown only once for each transaction. As an option, we can show this message when transaction was not ordered during  timeout  (60 sec by default) and another message when transaction will be ordered (if it will).  ></body> </Action>
<Action id="44348" issue="29420" author="esplinr" type="comment" created="2018-05-14 16:44:38.0" updateauthor="esplinr" updated="2018-05-14 16:44:38.0"> <body><! CDATA Thank you  ~ozheregelya  and  ~Derashe  for the suggested improvement.  I spoke with  ~mgbailey . The message looks great. We would prefer it to only be sent once per transaction, as suggested, with a follow up message if a transaction that had exceeded the timeout does eventually become ordered.  Sorry about the delay in responding.  ></body> </Action>
<Action id="44582" issue="29420" author="derashe" type="comment" created="2018-05-17 15:23:30.0" updateauthor="ashcherbakov" updated="2018-05-17 16:51:07.0"> <body><! CDATA Problem reason: - Log message of unordered txn appears regulary  Changes: * Log message about unordered txn appears once. Another message will appear when txn will be ordered  PR: -  https://github.com/hyperledger/indy-plenum/pull/675   Version: - master, 1.3.416  Risk factors: - No  Risk: - Low  Covered with tests: - There are test that cause this message appear in  plenum/test/monitoring/test_warn_unordered_log_msg.py|https://github.com/hyperledger/indy-plenum/pull/663/files#diff-008e1a17f6d7a88b51b579007b117893   Recommendations for QA:  Reproduce situation when txn have not been ordered and check that both log message present.  ></body> </Action>
<Action id="44800" issue="29420" author="ozheregelya" type="comment" created="2018-05-21 21:56:55.0" updateauthor="ozheregelya" updated="2018-05-21 21:58:20.0"> <body><! CDATA *Environment:* indy-node 1.3.420 docker pool  *Steps to Validate:* 1. Setup the pool. 2. Send txns to make sure that pool works. 3. Stop several nodes to lose consensus. 4. Send txn. => ERROR message appears after timeout. 5. Start stopped nodes. 6. Send one more txn. => txn was written, INFO message appear.  *Actual Results:* {code:java} root@aa5cc4fc5831:/home/indy# tail -f /var/log/indy/sandbox/Node3.log | grep "Consensus for ReqId" 2018-05-21 21:51:35,894 | ERROR | replicas.py ( 194) | unordered_request_handler_logging | Consensus for ReqId: 1526939404507905 was not achieved within 91.35529555899984 seconds. Primary node is Node1. Received Pre-Prepare from Node1:0. Received 3 valid Prepares from Node3:0, Node2:0, Node4:0. Received 0 valid Commits from noone. Transaction contents: {'identifier': 'V4SGRU86Z58d6TV7PBUe6f', 'protocolVersion': 1, 'reqId': 1526939404507905, 'signature': '2gG482E4dDk2XL4uzXpFibLwAX25JcrVSwb3KSTPwLcrCYjcbmWERmziqVked4erd5djF3FK6vpwARsV6tjcx7bu', 'operation': {'type': '1', 'dest': 'V4SGRU86Z58d6TV7PBUe63'}}.  2018-05-21 21:52:30,662 | INFO | monitor.py ( 318) | requestOrdered | Consensus for ReqId: 1526939404507905 was achieved by Node3:0 in 146.12384285400003 seconds.{code}  ></body> </Action>
