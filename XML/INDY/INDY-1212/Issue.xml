<Issue id="28325" key="INDY-1212" number="1212" project="10303" reporter="mgbailey" assignee="mgbailey" creator="mgbailey" type="10004" summary="indy-node process crashed without terminating the indy-node service" environment="Provisional network running 1.2.50" priority="2" resolution="10000" status="10001" created="2018-03-08 23:32:47.0" updated="2019-03-29 20:33:40.0" resolutiondate="2019-03-29 20:33:40.0" votes="0" watches="2" workflowId="28328"> <description><! CDATA A steward reports that his node, esatus_AG, says that indy-node is up (as reported by validator-info and systemctl status), but it is actually crashed.  The other nodes are unable to connect to it.  Based on the symptoms, this may have occurred on other nodes as well. This is what he has provided us:   {code:java} $ sudo systemctl status indy-node  indy-node.service - Indy Node    Loaded: loaded (/etc/systemd/system/indy-node.service; enabled; vendor preset: enabled)     Active: active (running) since Do 2018-02-08 07:24:46 CET; 3 weeks 5 days ago  Main PID: 1011 (python3)      Tasks: 4     Memory: 67.7M        CPU: 13h 52min 48.816s     CGroup: /system.slice/indy-node.service             └─1011 python3 -O /usr/local/bin/start_indy_node esatus_AG 9700 9710     Feb 10 02:02:46 esatusValidatorNode env 1011 :     sum(replica.serviceQueues(limit) for replica in self._replicas)  Feb 10 02:02:46 esatusValidatorNode env 1011 :   File "/usr/local/lib/python3.5/dist-packages/plenum/server/replica.py", line 768, in serviceQueues  Feb 10 02:02:46 esatusValidatorNode env 1011 :     r += self._serviceActions()  Feb 10 02:02:46 esatusValidatorNode env 1011 :   File "/usr/local/lib/python3.5/dist-packages/plenum/server/has_action_queue.py", line 100, in _serviceActions  Feb 10 02:02:46 esatusValidatorNode env 1011 :     action()  Feb 10 02:02:46 esatusValidatorNode env 1011 :   File "/usr/local/lib/python3.5/dist-packages/plenum/server/has_action_queue.py", line 110, in wrapper  Feb 10 02:02:46 esatusValidatorNode env 1011 :     action()  Feb 10 02:02:46 esatusValidatorNode env 1011 :   File "/usr/local/lib/python3.5/dist-packages/plenum/server/replica.py", line 1535, in process_stashed_out_of_order_commits  Feb 10 02:02:46 esatusValidatorNode env 1011 :     self, self.stashed_out_of_order_commits v , v, lastOrdered))  Feb 10 02:02:46 esatusValidatorNode env 1011 : RuntimeError: esatus_AG:0 found commits {2: COMMIT{'viewNo': 0, 'ppSeqNo': 2, 'instId': 0}} from previous view 0 that were not ordered but last ordered is (114, 2) {code} I asked for the relevant part of journalctl and he provided:  {code:java} Feb 10 02:02:46 esatusValidatorNode env 1011 : Traceback (most recent call last):  Feb 10 02:02:46 esatusValidatorNode env 1011 :   File "/usr/local/bin/start_indy_node", line 18, in <module>  Feb 10 02:02:46 esatusValidatorNode env 1011 :     run_node(config, self_name, int(sys.argv 2 ), int(sys.argv 3 ))  Feb 10 02:02:46 esatusValidatorNode env 1011 :   File "/usr/local/lib/python3.5/dist-packages/indy_node/utils/node_runner.py", line 33, in run_node  Feb 10 02:02:46 esatusValidatorNode env 1011 :     looper.run()  Feb 10 02:02:46 esatusValidatorNode env 1011 :   File "/usr/local/lib/python3.5/dist-packages/stp_core/loop/looper.py", line 289, in __exit__  Feb 10 02:02:46 esatusValidatorNode env 1011 :     self.shutdownSync()  Feb 10 02:02:46 esatusValidatorNode env 1011 :   File "/usr/local/lib/python3.5/dist-packages/stp_core/loop/looper.py", line 285, in shutdownSync  Feb 10 02:02:46 esatusValidatorNode env 1011 :     self.loop.run_until_complete(self.shutdown())  Feb 10 02:02:46 esatusValidatorNode env 1011 :   File "/usr/lib/python3.5/asyncio/base_events.py", line 387, in run_until_complete  Feb 10 02:02:46 esatusValidatorNode env 1011 :     return future.result()  Feb 10 02:02:46 esatusValidatorNode env 1011 :   File "/usr/lib/python3.5/asyncio/futures.py", line 274, in result  Feb 10 02:02:46 esatusValidatorNode env 1011 :     raise self._exception  Feb 10 02:02:46 esatusValidatorNode env 1011 :   File "/usr/lib/python3.5/asyncio/tasks.py", line 239, in _step  Feb 10 02:02:46 esatusValidatorNode env 1011 :     result = coro.send(None)  Feb 10 02:02:46 esatusValidatorNode env 1011 :   File "/usr/local/lib/python3.5/dist-packages/stp_core/loop/looper.py", line 275, in shutdown  Feb 10 02:02:46 esatusValidatorNode env 1011 :     await self.runFut  Feb 10 02:02:46 esatusValidatorNode env 1011 :   File "/usr/lib/python3.5/asyncio/futures.py", line 363, in __iter__  Feb 10 02:02:46 esatusValidatorNode env 1011 :     return self.result()  # May raise too.  Feb 10 02:02:46 esatusValidatorNode env 1011 :   File "/usr/lib/python3.5/asyncio/futures.py", line 274, in result  Feb 10 02:02:46 esatusValidatorNode env 1011 :     raise self._exception  Feb 10 02:02:46 esatusValidatorNode env 1011 :   File "/usr/local/lib/python3.5/dist-packages/indy_node/utils/node_runner.py", line 33, in run_node  Feb 10 02:02:46 esatusValidatorNode env 1011 :     looper.run()  Feb 10 02:02:46 esatusValidatorNode env 1011 :   File "/usr/local/lib/python3.5/dist-packages/stp_core/loop/looper.py", line 259, in run  Feb 10 02:02:46 esatusValidatorNode env 1011 :     return self.loop.run_until_complete(what)  Feb 10 02:02:46 esatusValidatorNode env 1011 :   File "/usr/lib/python3.5/asyncio/base_events.py", line 387, in run_until_complete  Feb 10 02:02:46 esatusValidatorNode env 1011 :     return future.result()  Feb 10 02:02:46 esatusValidatorNode env 1011 :   File "/usr/lib/python3.5/asyncio/futures.py", line 274, in result  Feb 10 02:02:46 esatusValidatorNode env 1011 :     raise self._exception  Feb 10 02:02:46 esatusValidatorNode env 1011 :   File "/usr/lib/python3.5/asyncio/tasks.py", line 239, in _step  Feb 10 02:02:46 esatusValidatorNode env 1011 :     result = coro.send(None)  Feb 10 02:02:46 esatusValidatorNode env 1011 :   File "/usr/local/lib/python3.5/dist-packages/stp_core/loop/looper.py", line 222, in runForever  Feb 10 02:02:46 esatusValidatorNode env 1011 :     await self.runOnceNicely()  Feb 10 02:02:46 esatusValidatorNode env 1011 :   File "/usr/local/lib/python3.5/dist-packages/stp_core/loop/looper.py", line 205, in runOnceNicely  Feb 10 02:02:46 esatusValidatorNode env 1011 :     msgsProcessed = await self.prodAllOnce()  Feb 10 02:02:46 esatusValidatorNode env 1011 :   File "/usr/local/lib/python3.5/dist-packages/stp_core/loop/looper.py", line 150, in prodAllOnce  Feb 10 02:02:46 esatusValidatorNode env 1011 :     s += await n.prod(limit)  Feb 10 02:02:46 esatusValidatorNode env 1011 :   File "/usr/local/lib/python3.5/dist-packages/indy_node/server/node.py", line 373, in prod  Feb 10 02:02:46 esatusValidatorNode env 1011 :     c = await super().prod(limit)  Feb 10 02:02:46 esatusValidatorNode env 1011 :   File "/usr/local/lib/python3.5/dist-packages/plenum/server/node.py", line 800, in prod  Feb 10 02:02:46 esatusValidatorNode env 1011 :     c += await self.serviceReplicas(limit)  Feb 10 02:02:46 esatusValidatorNode env 1011 :   File "/usr/local/lib/python3.5/dist-packages/plenum/server/node.py", line 821, in serviceReplicas  Feb 10 02:02:46 esatusValidatorNode env 1011 :     inbox_processed = self.replicas.service_inboxes(limit)  Feb 10 02:02:46 esatusValidatorNode env 1011 :   File "/usr/local/lib/python3.5/dist-packages/plenum/server/replicas.py", line 70, in service_inboxes  Feb 10 02:02:46 esatusValidatorNode env 1011 :     sum(replica.serviceQueues(limit) for replica in self._replicas)  Feb 10 02:02:46 esatusValidatorNode env 1011 :   File "/usr/local/lib/python3.5/dist-packages/plenum/server/replicas.py", line 70, in <genexpr>  Feb 10 02:02:46 esatusValidatorNode env 1011 :     sum(replica.serviceQueues(limit) for replica in self._replicas)  Feb 10 02:02:46 esatusValidatorNode env 1011 :   File "/usr/local/lib/python3.5/dist-packages/plenum/server/replica.py", line 768, in serviceQueues  Feb 10 02:02:46 esatusValidatorNode env 1011 :     r += self._serviceActions()  Feb 10 02:02:46 esatusValidatorNode env 1011 :   File "/usr/local/lib/python3.5/dist-packages/plenum/server/has_action_queue.py", line 100, in _serviceActions  Feb 10 02:02:46 esatusValidatorNode env 1011 :     action()  Feb 10 02:02:46 esatusValidatorNode env 1011 :   File "/usr/local/lib/python3.5/dist-packages/plenum/server/has_action_queue.py", line 110, in wrapper  Feb 10 02:02:46 esatusValidatorNode env 1011 :     action()  Feb 10 02:02:46 esatusValidatorNode env 1011 :   File "/usr/local/lib/python3.5/dist-packages/plenum/server/replica.py", line 1535, in process_stashed_out_of_order_commits  Feb 10 02:02:46 esatusValidatorNode env 1011 :     self, self.stashed_out_of_order_commits v , v, lastOrdered))  Feb 10 02:02:46 esatusValidatorNode env 1011 : RuntimeError: esatus_AG:0 found commits {2: COMMIT{'viewNo': 0, 'ppSeqNo': 2, 'instId': 0}} from previous view 0 that were not ordered but last ordered is (114, 2) {code} He says there is nothing more that is relevant.  The corresponding part of the indy log is: {code:java} 2018-02-10 02:02:45,643 | INFO     | node.py              ( 532) | start_participating | esatus_AG started participating  2018-02-10 02:02:45,644 | DISPLAY  | primary_selector.py  ( 351) | _start_selection | VIEW CHANGE: esatus_AG:0 declares view change 114 as completed for instance 0, new primary is danube:0, ledger info is  (0, 32, '61KhLvvLcfu1XRbuWLABt$  2018-02-10 02:02:45,644 | DISPLAY  | primary_selector.py  ( 327) | _start_selection | PRIMARY SELECTION: esatus_AG:1 selected primary royal_sovrin:1 for instance 1 (view 114)  2018-02-10 02:02:45,645 | DISPLAY  | primary_selector.py  ( 351) | _start_selection | VIEW CHANGE: esatus_AG:1 declares view change 114 as completed for instance 1, new primary is royal_sovrin:1, ledger info is  (0, 32, '61KhLvvLcfu1XRb$  2018-02-10 02:02:45,645 | DISPLAY  | primary_selector.py  ( 327) | _start_selection | PRIMARY SELECTION: esatus_AG:2 selected primary digitalbazaar:2 for instance 2 (view 114)  2018-02-10 02:02:45,646 | DISPLAY  | primary_selector.py  ( 351) | _start_selection | VIEW CHANGE: esatus_AG:2 declares view change 114 as completed for instance 2, new primary is digitalbazaar:2, ledger info is  (0, 32, '61KhLvvLcfu1XR$  2018-02-10 02:02:45,646 | DISPLAY  | primary_selector.py  ( 327) | _start_selection | PRIMARY SELECTION: esatus_AG:3 selected primary OASFCU:3 for instance 3 (view 114)  2018-02-10 02:02:45,647 | DISPLAY  | primary_selector.py  ( 351) | _start_selection | VIEW CHANGE: esatus_AG:3 declares view change 114 as completed for instance 3, new primary is OASFCU:3, ledger info is  (0, 32, '61KhLvvLcfu1XRbuWLABt$  2018-02-10 02:02:45,647 | DISPLAY  | primary_selector.py  ( 327) | _start_selection | PRIMARY SELECTION: esatus_AG:4 selected primary BIGAWSUSEAST1-001:4 for instance 4 (view 114)  2018-02-10 02:02:45,647 | DISPLAY  | primary_selector.py  ( 351) | _start_selection | VIEW CHANGE: esatus_AG:4 declares view change 114 as completed for instance 4, new primary is BIGAWSUSEAST1-001:4, ledger info is  (0, 32, '61KhLvvLcf$  2018-02-10 02:02:45,928 | WARNING  | node.py              (2591) | reportSuspiciousNode | esatus_AG raised suspicion on node ServerVS for Commit message has invalid BLS signature; suspicion code is 31  2018-02-10 02:02:46,037 | INFO     | replica.py           (1619) | order_3pc_key | esatus_AG:2 ordered batch request, view no 114, ppSeqNo 1, ledger 0, state root None, txn root None, requests ordered  ('J4N1K1SEB8uY2muwmecY5q', 1518208$  2018-02-10 02:02:46,038 | INFO     | replica.py           (1619) | order_3pc_key | esatus_AG:2 ordered batch request, view no 114, ppSeqNo 2, ledger 1, state root None, txn root None, requests ordered  ('J4N1K1SEB8uY2muwmecY5q', 1518102$  2018-02-10 02:02:46,038 | INFO     | replica.py           (1619) | order_3pc_key | esatus_AG:3 ordered batch request, view no 114, ppSeqNo 1, ledger 0, state root None, txn root None, requests ordered  ('J4N1K1SEB8uY2muwmecY5q', 1518208$  2018-02-10 02:02:46,039 | INFO     | replica.py           (1619) | order_3pc_key | esatus_AG:3 ordered batch request, view no 114, ppSeqNo 2, ledger 1, state root None, txn root None, requests ordered  ('J4N1K1SEB8uY2muwmecY5q', 1518102$  2018-02-10 02:02:46,050 | INFO     | replica.py           (1619) | order_3pc_key | esatus_AG:0 ordered batch request, view no 114, ppSeqNo 1, ledger 0, state root 8YY6MQEPTEovN3YPuihAhvdCga4eXiwFGP8p1Skh5RvU, txn root BafagSgueFyWwzgUYo$  2018-02-10 02:02:46,073 | INFO     | replica.py           (1619) | order_3pc_key | esatus_AG:0 ordered batch request, view no 114, ppSeqNo 2, ledger 1, state root 2ErAr1SDd8K3qREkCWMKCzdsRwZp7aCeCoQMFs8MrzsT, txn root 2b61e2wdgufCSwyzB9$  2018-02-10 02:02:46,076 | INFO     | node.py              (2374) | executeBatch | esatus_AG committed batch request, view no 114, ppSeqNo 1, ledger 0, state root 8YY6MQEPTEovN3YPuihAhvdCga4eXiwFGP8p1Skh5RvU, txn root BafagSgueFyWwzgUYoc$  2018-02-10 02:02:46,078 | INFO     | node.py              (2374) | executeBatch | esatus_AG committed batch request, view no 114, ppSeqNo 2, ledger 1, state root 2ErAr1SDd8K3qREkCWMKCzdsRwZp7aCeCoQMFs8MrzsT, txn root 2b61e2wdgufCSwyzB9C$  2018-02-10 02:02:46,148 | INFO     | replica.py           (1619) | order_3pc_key | esatus_AG:4 ordered batch request, view no 114, ppSeqNo 1, ledger 0, state root None, txn root None, requests ordered  ('J4N1K1SEB8uY2muwmecY5q', 1518208$  2018-02-10 02:02:46,148 | INFO     | replica.py           (1619) | order_3pc_key | esatus_AG:4 ordered batch request, view no 114, ppSeqNo 2, ledger 1, state root None, txn root None, requests ordered  ('J4N1K1SEB8uY2muwmecY5q', 1518102$  2018-02-10 02:02:46,262 | INFO     | looper.py            ( 272) | shutdown | Looper shutting down now... {code}  ></description> </Issue>
