<Issue id="37374" key="INDY-1983" number="1983" project="10303" reporter="ashcherbakov" creator="ashcherbakov" type="10002" summary="A Node need to be able to order stashed requests after long catch-ups" priority="3" resolution="10000" status="10001" created="2019-02-01 10:09:55.0" updated="2019-04-15 08:01:54.0" resolutiondate="2019-04-15 08:01:49.0" votes="0" watches="3" workflowId="48975"> <description><! CDATA *Problem* * A node is doing a long catchup (>10mins) whike the pool continues ordering * The node successfully stashes all 3PC messages received during catch-up and tries to re-apply them once catch-up is finished * However, since catch-up took more than 10 mins, the current time on the node will be at least 10 mins greater than the one in stashed PrePrepares. * So, the PrePrepare will be discarded as having incorrect time.  *Acceptance criteria* * Write tests simulating the issue * The PrePrepares processed (unstashed) after the catch-up should be discarded or applied because of incorrect time the same way as if there were no catch-up.  *Possible fix* * Create a map PrePrepare -> receiving_time * Every PrePrepare stashed during the catch-up will be put there * Once a PrePrepare is being processed, we need to have a look if there is received time for it in the map, and, if so, pop it and use for the ppTime validation * Make sure that the map is cleared properly in GC. so there is no OOM  ></description> </Issue>
