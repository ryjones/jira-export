<Issue id="46203" key="FABN-1652" number="1652" project="10604" reporter="balaji.viswanathan" creator="balaji.viswanathan" type="10004" summary="fabric-network: TypeError: Illegal Invocation on transaction submit" priority="3" resolution="10203" status="6" created="2020-10-13 12:17:25.0" updated="2020-10-22 08:30:31.0" resolutiondate="2020-10-22 08:30:31.0" votes="0" watches="2" workflowId="60115" archived="N"> <description><! CDATA fabric-network module: v1.4.13  Node version: v12.15.0  HLF Network: IBP, v1.4.7-2  when using the fabric-networks higher level node sdk (version 1.4.13) to submit transactions, we are seeing a weird issue, where the 1st request succeeds but every subsequent request fails with the following error: TypeError: Illegal Invocation the stack trace is    {code:java} 2020-10-09T10:14:10.579Z - debug:  DiscoveryEndorsementHandler : _endorse - starting layout plan 0 2020-10-09T10:14:10.579Z - debug:  DiscoveryEndorsementHandler : _endorse_layout - start 2020-10-09T10:14:10.580Z - warn:  DiscoveryEndorsementHandler : _build_endorse_group_member >> G0:0 - endorsement failed - TypeError: Illegal invocation 2020-10-09T10:14:10.579Z - debug:  DiscoveryEndorsementHandler : _build_endorse_group_member >> G0:0 - start 2020-10-09T10:14:10.579Z - debug:  DiscoveryEndorsementHandler : _build_endorse_group_member >> G0:0 - send endorsement to peer1.example.org:7051 2020-10-09T10:14:10.579Z - debug:  Remote.js : getUrl::grpcs://peer1.example.org:7051 2020-10-09T10:14:10.579Z - debug:  Peer.js : sendProposal - Start ----peer1.example.org:7051 grpcs://peer1.example.org:7051 2020-10-09T10:14:10.580Z - debug:  DiscoveryEndorsementHandler : _build_endorse_group_member >> G0:0 - send endorsement to peer2.example.org:7051 2020-10-09T10:14:10.580Z - debug:  Remote.js : getUrl::grpcs://peer2.example.org:7051 2020-10-09T10:14:10.580Z - debug:  Peer.js : sendProposal - Start ----peer2.example.org:7051 grpcs://peer2.example.org:7051 2020-10-09T10:14:10.581Z - debug:  DiscoveryEndorsementHandler : _build_endorse_group_member >> G0:0 - not able to get a completed endorsement 2020-10-09T10:14:10.584Z - debug:  DiscoveryEndorsementHandler : _execute_endorsements - endorsement failed: TypeError: Illegal invocation at getCall (node_modules/grpc/src/client_interceptors.js:655:22) at node_modules/grpc/src/client_interceptors.js:789:16 at node_modules/grpc/src/client_interceptors.js:1402:14 at _buildChain (node_modules/grpc/src/client_interceptors.js:1405:33) at Object.getInterceptingCall (node_modules/grpc/src/client_interceptors.js:1367:10) at ServiceClient.Client.makeUnaryRequest (node_modules/grpc/src/client.js:568:47) at ServiceClient.method_func (node_modules/grpc/src/client.js:1000:43) at node_modules/fabric-client/lib/Peer.js:127:25 at new Promise (<anonymous>) at Peer.sendProposal (node_modules/fabric-client/lib/Peer.js:120:10) at ChannelPeer.sendProposal (node_modules/fabric-client/lib/Channel.js:4052:21) at node_modules/fabric-client/lib/impl/DiscoveryEndorsementHandler.js:287:39 at processTicksAndRejections (internal/process/task_queues.js:94:5) 2020-10-09T10:14:10.584Z - debug:  DiscoveryEndorsementHandler : _endorse - layout plan 0 did not complete successfully, try another layout plan   {code}    {{Subsequent invocations see the same error, but thrown from different places. For instance, post discovery_cache_time (5mins), the same error is thrown on discovery}}     {{We are caching Gateway, Network and Contract objects. Also accessing the underlying Channel object for txn id checks.}}     {{The above behaviour is seen per-channel. i.e., once an invoke starts failing for a channel, subsequent invocations to the same channel fail. However, at this point - an invocation to a new channel succeeds (and then follows the same behaviour of failures).}}  ></description> </Issue>
