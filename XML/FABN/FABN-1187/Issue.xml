<Issue id="38406" key="FABN-1187" number="1187" project="10604" reporter="dhuseby" assignee="mastersingh24" creator="dhuseby" type="10004" summary="Crash if CA returns empty result" priority="3" resolution="10000" status="6" created="2019-03-13 00:43:55.0" updated="2019-04-02 00:07:08.0" resolutiondate="2019-03-22 20:09:12.0" votes="0" watches="2" workflowId="50043" security="10000"> <description><! CDATA If a CA server responds with an empty response during enrollment, an exception is thrown in the event emitter on {{end}}. This is an uncaughtException and causes the containing node process to exit. h1. To replicate:  With the attached files, run:   {{npm install}} {{ node badCa.js &}} {{ node index.js}}   This starts a simple malicious CA server that provides a response that triggers the exception. The {{index.js}} script tries 2 different scenarios: * 1. With a known bad URL, which throws an exception which can be caught by the client application * 2. With a malicious CA, which throws an exception which cannot be caught by the client application because of the EventEmitted behaviour in node.  {quote}From  https://nodejs.org/api/events.html#events_error_events|https://hackerone.com/redirect?signature=9cbc93a972a2b91893ce72a623eb289fcfca0a82&url=https%3A%2F%2Fnodejs.org%2Fapi%2Fevents.html%23events_error_events  If an EventEmitter does not have at least one listener registered for the 'error' event, and an 'error' event is emitted, the error is thrown, a stack trace is printed, and the Node.js process exits. {quote} h1. Fix  Replace  https://github.com/hyperledger/fabric-sdk-node/blob/c10865cfb20d063fdef4c7d96c25c1581f309e84/fabric-ca-client/lib/FabricCAClient.js#L457|https://hackerone.com/redirect?signature=6d9e7d47b53a5d730880eaf23ca3db3fb383ad22&url=https%3A%2F%2Fgithub.com%2Fhyperledger%2Ffabric-sdk-node%2Fblob%2Fc10865cfb20d063fdef4c7d96c25c1581f309e84%2Ffabric-ca-client%2Flib%2FFabricCAClient.js%23L457  {{util.format('Enrollment failed with HTTP status code', JSON.parse(data).statusCode)));}} with  {{util.format('Enrollment failed with HTTP status code', response.statusCode)));}}  The same issue is present at  https://github.com/hyperledger/fabric-sdk-node/blob/0d24cec10f7a3e0153fcf3f0158a89c5eaa0cfab/fabric-ca-client/lib/FabricCAClient.js#L318|https://hackerone.com/redirect?signature=21593c15b0f8996bd4822be3a7e70f65bbb358a8&url=https%3A%2F%2Fgithub.com%2Fhyperledger%2Ffabric-sdk-node%2Fblob%2F0d24cec10f7a3e0153fcf3f0158a89c5eaa0cfab%2Ffabric-ca-client%2Flib%2FFabricCAClient.js%23L318  h2. Impact  This attack allows an attacker to cause any node client application using the fabric-ca-node SDK to exit. In scenarios where the SDK is used in a server-side application, this will have the effect of denying the use of that server to other users.  *Attachments:* *  ^index.js  *  ^badCa.js  *  ^package.json   ></description> </Issue>
