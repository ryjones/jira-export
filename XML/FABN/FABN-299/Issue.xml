<Issue id="17671" key="FABN-299" number="299" project="10604" reporter="harrisob@us.ibm.com" assignee="harrisob@us.ibm.com" creator="harrisob@us.ibm.com" type="10004" summary="NodeSDK - intermittent errors in Event testing" priority="3" resolution="10000" status="6" created="2017-06-08 18:51:18.0" updated="2018-07-19 00:53:33.0" resolutiondate="2017-06-13 14:42:03.0" votes="0" watches="2" workflowId="34030" security="10001"> <description><! CDATA This failure never happens on our development environments and is only seen in the CI build.  Step one will be to clean up the promise handling and messages produced and add some more debug to the SDK. Then keep 'reverify' till we hit the error and hopefully see the cause.  The test case `test/integration/events.js` fails with the following logged messages {color:#5f8787}*4:03:51* # {color}*14:03:51* *14:03:51* ** Test chaincode install using chaincodePackage byte  ***14:03:51* *14:03:51*  *{color:#00cd00}14:03:51 ok 772 using chaincodePackage - Successfully enrolled user 'admin'{color}* *{color:#00cd00}14:03:51 ok 773 using chaincodePackage - success{color}* *{color:#00cd00}14:03:51 ok 774 using chaincodePackage0 - Successfully enrolled user 'admin'{color}* *{color:#00cd00}14:03:51 ok 775 passed check for exists same code again{color}* {color:#5f8787}*14:03:51* # Test chaincode instantiate with event, transaction invocation with chaincode event, and query number of chaincode events{color} *{color:#00cd00}14:03:51 ok 776 Successfully enrolled user 'admin'{color}* *{color:#00cd00}14:03:56 ok 777 this error function should be called Error: Connect Failed{color}* *{color:#00cd00}14:03:56 ok 778 this error function should be called Error: EventHub has been shutdown due to new Peer address assignment{color}* *{color:#00cd00}14:04:26 ok 779 Successfully initialized the channel{color}* *{color:#ff0000}14:04:26 not ok 780 (unnamed assert){color}* {color:#5f8787}*14:04:26*   ---{color}*14:04:26*     operator: fail*14:04:26*     at: Client.newDefaultKeyValueStore.then.then.then.then.then.then.then (/w/workspace/fabric-sdk-node-verify-x86_64/gopath/src/github.com/hyperledger/fabric-sdk-node/test/integration/events.js:237:5){color:#5f8787}*14:04:26*   ...{color} *{color:#ff0000}14:04:26 not ok 781 Failed to receive chaincode event: TypeError: Cannot read property '0' of undefined{color}* {color:#5f8787}*14:04:26*   ---{color}*14:04:26*     operator: fail*14:04:26*     at: Client.newDefaultKeyValueStore.then.then.then.then.then.then.then.then.then (/w/workspace/fabric-sdk-node-verify-x86_64/gopath/src/github.com/hyperledger/fabric-sdk-node/test/integration/events.js:255:5){color:#5f8787}*14:04:26*   ...{color} *{color:#ff0000}14:04:26 not ok 782 Expecting a rejected promise from the 2nd transaction should be invalid{color}* {color:#5f8787}*14:04:26*   ---{color}*14:04:26*     operator: equal*14:04:26*     expected: |-*14:04:26*       'invalid'*14:04:26*     actual: |-*14:04:26*        TypeError: Cannot read property 'length' of undefined *14:04:26*     at: Client.newDefaultKeyValueStore.then.then.then.then.then.then.then.then.then.then.then.then (/w/workspace/fabric-sdk-node-verify-x86_64/gopath/src/github.com/hyperledger/fabric-sdk-node/test/integration/events.js:286:5){color:#5f8787}*14:04:26*   ...{color}  ></description> </Issue>
