<Issue id="31200" key="FABN-166" number="166" project="10604" reporter="ratnakar" creator="ratnakar" type="10004" summary=" Interoperability test   Integration Tests Fail When Using Node SDK 1.1 APIs with SDK/fabric/fabric-ca are at v1.2" priority="2" resolution="10000" status="6" created="2018-06-19 22:22:39.0" updated="2018-09-21 14:50:08.0" resolutiondate="2018-06-20 20:26:57.0" votes="0" watches="2" workflowId="33897"> <description><! CDATA Refer the case 4 of FAB-10161  Gist of failures (added a work around to remove the failures seen in FAB-10731 ) {code:java} 450:not ok 223 Error: Failed to create Channel. channel name should match Regex /^ a-z  a-z0-9.- *$/, but got "testChannel-orderer-member2" 475:not ok 224 Error: Failed to create Channel. channel name should match Regex /^ a-z  a-z0-9.- *$/, but got "testChannel-orderer-member3" 500:not ok 225 Error: Failed to create Channel. channel name should match Regex /^ a-z  a-z0-9.- *$/, but got "testChannel-orderer-member4" 545:not ok 241 install reject: Error: Error: Failed to create Channel. channel name should match Regex /^ a-z  a-z0-9.- *$/, but got "testInstall" at new Channel (/Users/ratnakar/workspace/compatibility/fabric-sdk-node/node_modules/fabric-client/lib/Channel.js:96:11) at Client.newChannel (/Users/ratnakar/workspace/compatibility/fabric-sdk-node/node_modules/fabric-client/lib/Client.js:203:19) at installChaincode (/Users/ratnakar/workspace/compatibility/fabric-sdk-node/test/integration/install.js:158:24) at test (/Users/ratnakar/workspace/compatibility/fabric-sdk-node/test/integration/install.js:59:2) at Test.<anonymous> (/Users/ratnakar/workspace/compatibility/fabric-sdk-node/node_modules/tape-promise/index.es5.js:21:13) at Test.bound  as _cb  (/Users/ratnakar/workspace/compatibility/fabric-sdk-node/node_modules/tape/lib/test.js:76:32) at Test.run (/Users/ratnakar/workspace/compatibility/fabric-sdk-node/node_modules/tape/lib/test.js:95:10) at Test.bound  as run  (/Users/ratnakar/workspace/compatibility/fabric-sdk-node/node_modules/tape/lib/test.js:76:32) at Immediate.next (/Users/ratnakar/workspace/compatibility/fabric-sdk-node/node_modules/tape/lib/results.js:71:15) at runCallback (timers.js:789:20) at tryOnImmediate (timers.js:751:5) at processImmediate  as _immediateCallback  (timers.js:722:5) 573:not ok 242 install reject: Error: Error: Failed to create Channel. channel name should match Regex /^ a-z  a-z0-9.- *$/, but got "testInstall0" at new Channel (/Users/ratnakar/workspace/compatibility/fabric-sdk-node/node_modules/fabric-client/lib/Channel.js:96:11) at Client.newChannel (/Users/ratnakar/workspace/compatibility/fabric-sdk-node/node_modules/fabric-client/lib/Client.js:203:19) at installChaincode (/Users/ratnakar/workspace/compatibility/fabric-sdk-node/test/integration/install.js:158:24) at installChaincode.then.catch.then (/Users/ratnakar/workspace/compatibility/fabric-sdk-node/test/integration/install.js:78:3) at <anonymous> at runMicrotasksCallback (internal/process/next_tick.js:121:5) at _combinedTickCallback (internal/process/next_tick.js:131:7) at process._tickCallback (internal/process/next_tick.js:180:9) 602:not ok 243 using chaincodePackage - install reject: Error: Error: Failed to create Channel. channel name should match Regex /^ a-z  a-z0-9.- *$/, but got "testInstallPackage" at new Channel (/Users/ratnakar/workspace/compatibility/fabric-sdk-node/node_modules/fabric-client/lib/Channel.js:96:11) at Client.newChannel (/Users/ratnakar/workspace/compatibility/fabric-sdk-node/node_modules/fabric-client/lib/Client.js:203:19) at installChaincode (/Users/ratnakar/workspace/compatibility/fabric-sdk-node/test/integration/install.js:158:24) at Packager.package.then (/Users/ratnakar/workspace/compatibility/fabric-sdk-node/test/integration/install.js:112:3) at <anonymous> at process._tickCallback (internal/process/next_tick.js:188:7)  622:not ok 244 using chaincodePackage0 - install same chaincode again - reject, error 828:not ok 341 Failed to get an error returned :: No Error returned , should have had an error with chaincode exists end2endnodesdk 843:not ok 342 Failed to get an error returned :: No Error returned , should have had an error with chaincode exists end2endnodesdk   667:not ok 259 Timeout - Failed to receive the event for instantiate 966:not ok 386 Failed to send transaction and get notifications within the timeout period. 979:not ok 387 Error: Failed to send transaction and get notifications within the timeout period. at Promise.all.then.catch (/Users/ratnakar/workspace/compatibility/fabric-sdk-node/test/integration/invoke.js:302:11) at <anonymous> 910:not ok 373 Failed to send transaction and get notifications within the timeout period. 923:not ok 374 Error: Failed to send transaction and get notifications within the timeout period. at Promise.all.then.catch (/Users/ratnakar/workspace/compatibility/fabric-sdk-node/test/integration/invoke.js:302:11) at <anonymous>  382:not ok 217 TypeError: Cannot read property 'EC' of undefined 409:not ok 218 Failed to enroll 'testUser'. Error: Enrollment failed with errors   {"code":20,"message":"Authorization failure"}   1007:not ok 391 Test failed with TypeError: Cannot read property '_caName' of undefined   644:not ok 252 Expecting a rejected promise from the 2nd transaction should be invalid 682:not ok 260 (unnamed assert) 707:not ok 267 Error: Failed to send install Proposal or receive valid response: Error: 8 RESOURCE_EXHAUSTED: Sent message larger than max (1052367 vs. 1048576) at e2eUtils.tlsEnroll.then.then.then.then (/Users/ratnakar/workspace/compatibility/fabric-sdk-node/test/integration/e2e/e2eUtils.js:166:10) at <anonymous> at process._tickCallback (internal/process/next_tick.js:188:7) 938:not ok 375 Failed to invoke transaction chaincode   {code} For Quick reference given the steps to reproduce the issue as following *Nodejs Integration Test Suite at 1.1 , Node.js SDK at 1.2, Fabric is at 1.2 & Fabric-CA is at 1.2* {code:java} Step 1 : Clone the repo (Default it points to release-1.1 branch) git clone https://github.com/hyperledger/fabric-sdk-node cd fabric-sdk-node  Step 2: Install the node modules npm install make sure to use latest 1.2 node modules for the clients fabric-client and fabric-ca-client (As of this testing used the version: 1.2.0-snapshot.62) rm -rf node_modules/fabric-c* npm install fabric-client@1.2.0-snapshot.62 npm install fabric-ca-client@1.2.0-snapshot.62  Step 3: Commentout the following lines from build/tasks/test.js  //process.env.DOCKER_IMG_TAG = dockerImageTag; //process.env.THIRDPARTY_IMG_TAG = thirdpartyImageTag;  please refer https://github.com/hyperledger/fabric-sdk-node/blob/release-1.1/build/tasks/test.js#L64-L65  Step 4: As part of this compatibility tests we wouldn't want to run the unit tests Remove the unit test section (see following) from gulp task i.e, from build/tasks/test.js https://github.com/hyperledger/fabric-sdk-node/blob/release-1.1/build/tasks/test.js#L121-L125  Step 5: Export the following environment varibles to let your docker-compose use the docker tags. (Make sure replace with the right TAG ) export DOCKER_IMG_TAG=:amd64-1.2.0-snapshot-3436f454f export DOCKER_IMG_CA_TAG=:amd64-1.2.0-snapshot-744e032 export THIRDPARTY_IMG_TAG=:amd64-0.4.8  Step 6: replace the test/fixtures folder with test/fixtures folder of fabric-sdk-node master branch (Fabric 1.2 network needs all the required crypto/channel artifacts that are available in master branch)   Step 7: There needs a tweaking on the test/fixtures/docker-compose.yaml  change the lines hyperledger/fabric-ca${DOCKER_IMG_TAG} to hyperledger/fabric-ca${DOCKER_IMG_CA_TAG}  Step 8: Execute the following command and make sure all the tests are passing now   "gulp test" {code}  ></description> </Issue>
