<Issue id="14716" key="FABN-379" number="379" project="10604" reporter="yuki-kon" assignee="cdaughtr" creator="yuki-kon" type="10004" summary="&quot;gulp test&quot; fails with default fabric-ca docker image" priority="3" resolution="10000" status="6" created="2017-02-10 01:13:16.0" updated="2018-07-19 00:53:51.0" resolutiondate="2017-03-09 15:22:51.0" votes="0" watches="2" workflowId="34110"> <description><! CDATA "gulp test" with default fabri-ca Docker fails due to bug in test/unit/chain-fabriccop-tests.js. The following error occurs when running "chain-fabriccop-tests.js". The fabric-ca docker image uses server-config.json that has only one user: "admin". "chain-fabriccop-tests.js" must use that user in order to run successfully.  {noformat} ****************************************************************** $ cd fabric-sdk-node $ HFC_LOGGING='{"debug":"console"}' node test/unit/chain-fabriccop-tests.js  ^  32minfo^  39m: Successfully constructed a winston logger with configurations debug=console TAP version 13 # Attempt to use FabricCAServices ^  34mdebug^  39m:  FileKeyValueStore.js : FileKeyValueStore.js - constructor ^  34mdebug^  39m:  crypto_ecdsa_aes : Hash algorithm: SHA2, hash output size: 256 ^  32minfo^  39m:  FabricCAClientImpl.js : Successfully constructed Fabric CA service client: endpoint - {"protocol":"http","hostname":"localhost","port":7054} ^  32minfo^  39m:  crypto_ecdsa_aes : This class requires a CryptoKeyStore to save keys, using the store at %s ^  34mdebug^  39m:  FileKeyValueStore.js : FileKeyValueStore.js - constructor ^  34mdebug^  39m:  crypto_ecdsa_aes : _getKeyStore returning ks ^  34mdebug^  39m:  crypto_ecdsa_aes : generateKey, store.setValue ^  34mdebug^  39m:  ecdsa/key.js : ECDSA curve param X: d50b1bbe5ceadaa69e84e74ab660fb53082b081c0cd142dddd6b9c7b3a58d683 ^  34mdebug^  39m:  ecdsa/key.js : ECDSA curve param Y: b3e066b40e712de5b4f3ead8d8ba4b3e61277fda497c85db47015b1102f8119d ^  34mdebug^  39m:  FileKeyValueStore.js : FileKeyValueStore -- setValue not ok 1 Failed to use returned private key and certificate to construct a user object. Error: Error: Enrollment failed with errors   {"code":0,"message":"sql: no rows in result set"}   --- operator: fail at: process._tickCallback (internal/process/next_tick.js:103:7) ... ^  34mdebug^  39m:  Client.js : setUserContext, user: undefined, skipPersistence: undefined ^  34mdebug^  39m:  Client.js : setUserContext, Cannot save null userContext not ok 2 Failed to load the user testUser from key value store. Error: Error: Cannot save null userContext. --- operator: fail at: process._tickCallback (internal/process/next_tick.js:103:7) ...  1..2 # tests 2 # pass  0 # fail  2   ****************************************************************** {noformat}  ></description> </Issue>
