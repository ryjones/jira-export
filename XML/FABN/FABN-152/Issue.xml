<Issue id="15369" key="FABN-152" number="152" project="10604" reporter="jjjjibm" assignee="rameshthoomu" creator="jjjjibm" type="10004" summary=" node-SDK  Using apt-get install softhsm2, node pkcs11.js fails but sudo node pkcs11.js succeeds " priority="3" resolution="10000" status="6" created="2017-03-15 18:51:46.0" updated="2018-07-19 00:53:02.0" resolutiondate="2017-05-11 02:40:14.0" votes="0" watches="2" workflowId="33883"> <environment><! CDATA fabric-sdk-node: commit e2edc9bae777b9b12418da2a2c33dce7da33e340 fabric commit d7920a9c3fa0b3fe96ed8e4dde86795de97ae1e2 fabric-ca  commit c73ce65eaa9732dcf51930e75ed99adfb4edce85  Vlaunch VM running Ubuntu 16  softhsm2 installed via apt-get  ></environment> <description><! CDATA I installed softhsm2 on an Ubuntu 16 vlaunch VM like this: apt-get install softhsm2  This is consistent with the way CI installs softhsm2.  The goal is to enable fabric-sdk-node/test/unit/pkcs11.js to run in the CI environment.   Having installed softhsm2, the command 'node pkcs11.js' fails in C_Initialize with the rc 'GENERAL ERROR':  Error: CKR_GENERAL_ERROR:5 at Error (native) C_Initialize:152  at: Test.onetime  as end  (/home/ibmadmin/gopath/src/github.com/hyperledger/fabric-sdk-node/node_modules/onetime/index.js:22:12) stack: |- Error: CKR_GENERAL_ERROR:5 at Error (native) C_Initialize:152 at Error (native) at CryptoSuite_PKCS11._pkcs11OpenSession (/home/ibmadmin/gopath/src/github.com/hyperledger/fabric-sdk-node/node_modules/fabric-client/lib/impl/bccsp_pkcs11.js:157:10) at new CryptoSuite_PKCS11 (/home/ibmadmin/gopath/src/github.com/hyperledger/fabric-sdk-node/node_modules/fabric-client/lib/impl/bccsp_pkcs11.js:110:8) at Object.module.exports.getCryptoSuite    However, adding sudo enables all pkcs11.js tests to pass:  sudo node pkcs11.js  So, 'sudo' is one fix.  Unfortunately, it is probably not possible to sudo in the CI environment.  ~vpaprots  suggested two commands that enable me to call 'node pkcs11.js' successfully, even though I am not running as root.   Ramesh requested this issue is to work out how we can issue these commands in CI  so we can add pkcs11.js to the node SDK CI test bucket.   I'm appending a transcript of my conversation with Ramesh beginning from the time I told him I had a break through with pkcs11.js.  The commands suggested by  ~vpaprots  are in the transcript.   ></description> </Issue>
