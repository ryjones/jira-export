<Issue id="34427" key="FABN-954" number="954" project="10604" reporter="caroline-church" creator="caroline-church" type="10004" summary=" fabric-network  Event handler sometimes doesn&apos;t unblock" priority="2" resolution="10202" status="6" created="2018-10-04 13:17:31.0" updated="2018-11-14 14:04:50.0" resolutiondate="2018-11-14 14:04:50.0" votes="0" watches="2" workflowId="45828"> <description><! CDATA When trying to do an upgrade proposal the event handler doesn't always unblock. This only happens intermittently but the upgrade is always successful. Here is the code i am using:    let proposalResponseObject:Client.ProposalResponseObject;   proposalResponseObject=await channel.sendUpgradeProposal(instantiateRequest);     const contract:Contract=network.getContract(name);   const responses:any=contract '_validatePeerResponses' (proposalResponseObject 0 );   const eventHandler:any=contract 'eventHandlerFactory' .createTxEventHandler(transactionId.getTransactionID());   if (!eventHandler) { throw newError('Failed to create an event handler'); }   await eventHandler.startListening();   const transactionRequest:Client.TransactionRequest= { proposalResponses:proposalResponseObject 0 , proposal:proposalResponseObject 1 , txId:transactionId };   // Submit the endorsed transaction to the primary orderers. const response:Client.BroadcastResponse=await network.getChannel().sendTransaction(transactionRequest);   if (response.status!=='SUCCESS') { const msg=`Failed to send peer responses for transaction ${transactionId.getTransactionID()} to orderer. Response status: ${response.status}`; eventHandler.cancelListening(); throw newError(msg); }    // GETS STUCK ON THIS LINE await eventHandler.waitForEvents(); // return the payload from the invoked chaincode let result:any=null;  ></description> </Issue>
