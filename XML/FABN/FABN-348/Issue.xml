<Issue id="15502" key="FABN-348" number="348" project="10604" reporter="kraemer" assignee="cdaughtr" creator="kraemer" type="10004" summary="Using custom state store not working and to complicated" priority="2" resolution="10000" status="6" created="2017-03-29 18:22:01.0" updated="2018-07-19 00:53:44.0" resolutiondate="2017-05-10 05:01:20.0" votes="0" watches="3" workflowId="34079"> <description><! CDATA Hi,  I'm trying to use our custom implementation of a key value store. The FileKeyValueStore is only for development and should not be used in production so we want to store the credentials in a secure store. Unfortunately, at the moment (version 1.0.0-snapshot.6) this is not straightforward and also not working the way it is implemented at the moment.  *Issue 1:*  First I need to set the implementation at multiple places. # {{client.setStateStore(storeInstance)}} on the Client instance # {{new CAClient(url, null, null, StateStore, opts}} when I instantiate the CA client. Here the class and the opts are passed in # {{user.setEnrollment(key, certificate, msp, {obj}}} here an object with the properties {{KVSImplClass}} and {{kvsOpts}} is passed in  This is very inconsistent, there should be an aligned way to pass a store to the different classes. Also for users of the API it is not very convenient to pass in the store so often.  *Issue 2:*  This is actually the bigger issue: When a user is stored in the state store (called by Client.js saveUserToStateStore)  {{setValue}} is called with a string version of the user object. Within the {{toString}} {{JSON.stringify}} is executed on all properties +including+ the {{this._kvsCryptoOpts}} object. This leads to the {{KVSImplClass}} not being stored in the string (a function cannot be stringified). When I restart my application I try to receive the user from the state store. The JSON object returned does not include the value {{KVSImplClass}} because it was not stored. This results in an error, because the user information cannot be read. Because of the missing {{KVSImplClass}} a new FileKeyValueStore is instantiated from which nothing can be read. This is because of the fallback if no {{KVSImplClass}} is set.  ></description> </Issue>
