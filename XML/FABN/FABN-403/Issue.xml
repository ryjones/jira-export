<Issue id="31691" key="FABN-403" number="403" project="10604" reporter="yunu_kim" assignee="harrisob@us.ibm.com" creator="yunu_kim" type="10004" summary="fabric-client/lib/Client.js getPeersForOrgOnChannel return peers having empty role information" priority="3" resolution="10000" status="6" created="2018-07-06 01:53:23.0" updated="2018-07-19 00:53:57.0" resolutiondate="2018-07-13 18:00:05.0" votes="0" watches="2" workflowId="34134"> <description><! CDATA   fabric-client/lib/Client.js|https://github.com/hyperledger/fabric-sdk-node/blob/release-1.1/fabric-client/lib/Client.js#L1826  getPeersForOrgOnChannel :line 1825~ {code:javascript} if(org_peer.getName() === channel_peer.getName()) { found_peers org_peer.getName()  = org_peer;//to avoid Duplicate Peers logger.debug('%s - adding peer to list:%s',method,org_peer.getName()); } {code} this accumulates org_peers to return, but org_peer doen't have role information.      composer-connector-hlfv1/hlfconnection.js|https://github.com/hyperledger/composer/blob/master/packages/composer-connector-hlfv1/lib/hlfconnection.js#L1198  getChannelPeersInOrg {code:javascript} getChannelPeersInOrg(peerRoles) { let peers = this.client.getPeersForOrgOnChannel(this.channel.getName()); return peers.filter((cPeer) => { return peerRoles.every((peerRole) => { return cPeer.isInRole(peerRole); }); }); } {code}  this code expects that fabric-client's getPeersForOrgOnChannel will return peers having role information, but that expectation won't come true.     I suggest that getPeersForOrgOnChannel return channel_peer, not org_peer. {code:javascript} if(org_peer.getName() === channel_peer.getName()) { found_peers org_peer.getName()  = channel_peer; //to avoid Duplicate Peers logger.debug('%s - adding peer to list:%s',method,org_peer.getName()); } {code}  channel_peer has role information and compatibility with org_peer.  ></description> </Issue>
