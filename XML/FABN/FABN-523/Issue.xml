<Issue id="18843" key="FABN-523" number="523" project="10604" reporter="latitiah" assignee="harrisob@us.ibm.com" creator="latitiah" type="10004" summary="Message Size Incorrect" priority="2" resolution="10000" status="6" created="2017-06-29 22:26:51.0" updated="2019-03-19 11:13:24.0" resolutiondate="2017-11-24 20:07:12.0" votes="0" watches="7" workflowId="34254"> <description><! CDATA *commit:* RC1 *api:* sdk-node  *Steps:* Scenario: FAB-3851: Message Payloads Greater than 1MB 1.    Given I have a bootstrapped fabric network of type kafka 2.    When a user deploys chaincode at path "github.com/hyperledger/fabric/examples/chaincode/go/test" with  ""  #Keystore chaincode 3.    And I wait "30" seconds 4.    And a user invokes on the chaincode named "mycc" with random args  "put","a","{random}"  of length 1048576 5.    And I wait "30" seconds 6.    And a user queries on the chaincode named "mycc" with args  "get","a"  7.    Then a user receives response containing set length value 8.    And a user invokes on the chaincode named "mycc" with random args  "put","a","{random}"  of length 2097152 9.    And I wait "30" seconds 10.    And a user queries on the chaincode named "mycc" with args  "get","a"  11.    Then a user receives response containing set length value  On Kafka (setting the KAFKA environment variables), 1MB, 1.5MB works fine. Kafka environment variables set to: - KAFKA_MESSAGE_MAX_BYTES=103809024 - KAFKA_REPLICA_FETCH_MAX_BYTES=103809024 - KAFKA_REPLICA_FETCH_RESPONSE_MAX_BYTES=103809024  2MB has problems on the query. When looking through the peer and orderer logs, there are no errors. The error comes from the sdk during a query.  {code} error:  client-utils.js : sendPeersProposal - Promise is rejected: Error: Received message larger than max (4195347 vs. 4194304) at /home/itpc/experims/fabric-sdk-node/node_modules/grpc/src/node/src/client.js:434:17 error:  client-utils.js : sendPeersProposal - Promise is rejected: Error: Received message larger than max (4195347 vs. 4194304) at /home/itpc/experims/fabric-sdk-node/node_modules/grpc/src/node/src/client.js:434:17 Error: Received message larger than max (4195347 vs. 4194304) Error: Received message larger than max (4195347 vs. 4194304) {code}  What is strange is the message size reported is twice as much as the actual payload.  ></description> </Issue>
