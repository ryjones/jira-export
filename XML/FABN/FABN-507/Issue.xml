<Issue id="31732" key="FABN-507" number="507" project="10604" reporter="yuki-kon" assignee="yuki-kon" creator="yuki-kon" type="10004" summary="NodeSDK Wrong test scenario for service discovery" priority="3" resolution="10000" status="6" created="2018-07-06 23:43:27.0" updated="2018-07-19 00:54:20.0" resolutiondate="2018-07-10 16:42:40.0" votes="0" watches="1" workflowId="34238"> <description><! CDATA A test scenario for service discovery is wrong in fabric-sdk-node/test/integration/discovery.js. This is a test case to check if service discovery works by using the parameter `discover` on the Channel.initialize() call. https://github.com/hyperledger/fabric-sdk-node/blob/master/test/integration/discovery.js#L104-L113  This test case has two problems.  1. Wrong parameter in request message. Current test code uses a wrong named parameter "discovery" in a request object. Channel.initialize() requires a parameter named "discover". We need to update the parameter correctly.  2. 'initialize-with-discovery' is set to true. We have two options to enable the use of the service discovery. (a) Set the config setting; Client.setConfigSetting('initialize-with-discovery', true); (b) Use the parameter `discover` on the Channel.initialize() call.  This test case is intended for the usage (b). To avoid the contamination with the usage (a), we should set 'initialize-with-discovery' to false. However, the current test code sets 'initialize-with-discovery' to true at the beginning of a test function and the flag is not changed to false for this test case. Despite that Channel.initialize() canâ€™t enable to use service discovery due to the incorrect parameter, service discovery is activated because the config setting is still true. As a result, the test looks passed successfully. We need to change the config setting flag to false before calling Channel.initialize().   ></description> </Issue>
