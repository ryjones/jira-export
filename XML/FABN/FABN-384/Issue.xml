<Issue id="17153" key="FABN-384" number="384" project="10604" reporter="yuki-kon" assignee="yuki-kon" creator="yuki-kon" type="10004" summary="Fix gulp test to remove chaincode&apos;s containers" environment="fabric-sdk-node: commit 183a619c6f22d8b3946ed6ccf54e28f309eb0ee0" priority="3" resolution="10000" status="6" created="2017-05-25 22:56:43.0" updated="2018-07-19 00:53:52.0" resolutiondate="2017-05-30 19:15:58.0" votes="0" watches="1" workflowId="34115" security="10001"> <description><! CDATA When running "gulp test" twice, gulp script "build/tasks/test.js" doesn't remove chaincode's docker containers which were generated by previous test.  Steps to reproduce  -------------------------- 1. move to fabric-sdk-node root directly 2. start blockchain network docker-compose -f test/fixtures/docker-compose.yaml up -d --force-recreate 3. run gulp test gulp test 4. restart blockchain network docker-compose -f test/fixtures/docker-compose.yaml up -d --force-recreate 5. rerun gulp test gulp test  Expected Results -------------------------- Docker containers which was generated previous test (step3) are killed and removed.  Actual Results -------------------------- Docker containers are not killed and removed. The following is the log message.  {code:java} …(snip)… "docker kill" requires at least 1 argument(s). See 'docker kill --help'.  Usage:  docker kill  OPTIONS  CONTAINER  CONTAINER...   Kill one or more running containers  20:58:37  docker rm $(docker ps -a|grep "^dev-peer0.org 12 .example.com-e" |awk "{print $1}") "docker rm" requires at least 1 argument(s). See 'docker rm --help'.  Usage:  docker rm  OPTIONS  CONTAINER  CONTAINER...   Remove one or more containers  20:58:37  docker rmi $(docker images | grep "^dev-peer0.org 12 .example.com-e" | awk "{print $3}") Error response from daemon: conflict: unable to remove repository reference "dev-peer0.org1.example.com-events_unit_test1495745646899-v1495745646899" (must force) - container 3e76dc0aa3b4 is using its referenced image 59e3bf897620 Error response from daemon: No such image: latest:latest Error response from daemon: conflict: unable to delete 59e3bf897620 (must be forced) - image is being used by stopped container 3e76dc0aa3b4 Error response from daemon: No such image: 2:latest Error response from daemon: No such image: minutes:latest Error response from daemon: No such image: ago:latest Error response from daemon: invalid reference format: repository name must be lowercase Error response from daemon: conflict: unable to remove repository reference "dev-peer0.org1.example.com-end2endnodesdk-v1" (must force) - container e215e87c74ee is using its referenced image c5d7e5bba05d Error response from daemon: No such image: latest:latest Error response from daemon: conflict: unable to delete c5d7e5bba05d (must be forced) - image is being used by stopped container e215e87c74ee Error response from daemon: No such image: 2:latest Error response from daemon: No such image: minutes:latest Error response from daemon: No such image: ago:latest Error response from daemon: invalid reference format: repository name must be lowercase Error response from daemon: conflict: unable to remove repository reference "dev-peer0.org2.example.com-end2endnodesdk-v1" (must force) - container 24528d6e9134 is using its referenced image 625cbbbd94f7 Error response from daemon: No such image: latest:latest Error response from daemon: conflict: unable to delete 625cbbbd94f7 (must be forced) - image is being used by stopped container 24528d6e9134 Error response from daemon: No such image: 2:latest Error response from daemon: No such image: minutes:latest Error response from daemon: No such image: ago:latest Error response from daemon: invalid reference format: repository name must be lowercase Error response from daemon: conflict: unable to remove repository reference "dev-peer0.org2.example.com-end2endnodesdk-v0" (must force) - container 6f40ec4d0852 is using its referenced image 81be06d390fd Error response from daemon: No such image: latest:latest Error response from daemon: conflict: unable to delete 81be06d390fd (must be forced) - image is being used by stopped container 6f40ec4d0852 Error response from daemon: No such image: 3:latest Error response from daemon: No such image: minutes:latest Error response from daemon: No such image: ago:latest Error response from daemon: invalid reference format: repository name must be lowercase Error response from daemon: conflict: unable to remove repository reference "dev-peer0.org1.example.com-end2endnodesdk-v0" (must force) - container 76b64531a055 is using its referenced image b00cd325b536 Error response from daemon: No such image: latest:latest Error response from daemon: conflict: unable to delete b00cd325b536 (must be forced) - image is being used by stopped container 76b64531a055 Error response from daemon: No such image: 3:latest Error response from daemon: No such image: minutes:latest Error response from daemon: No such image: ago:latest Error response from daemon: invalid reference format: repository name must be lowercase  20:58:38  Finished 'docker-clean' after 1.19 s …(snip)… {code}  ></description> </Issue>
