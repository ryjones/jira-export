<Issue id="46888" key="FABN-1712" number="1712" project="10604" reporter="JIRAUSER21940" creator="JIRAUSER21940" type="10004" summary="First invoke failing when discovery is enabled" priority="3" status="10701" created="2021-06-02 13:36:47.0" updated="2021-09-02 13:48:17.0" votes="0" watches="3" workflowId="60791" archived="N"> <description><! CDATA Versions: * fabric-network 2.2.5 * fabric-peer 2.3.0 * fabric-orderer 2.3.0  With a single peer network, when *Discovery* is *enabled*, the first invoke transaction sent from the SDK always fails with an error: {code:java} 'Error: DiscoveryService: test-chaincode error: failed constructing descriptor for chaincodes:<name:"test-chaincode" > '{code}   After this first error, all other invoke transactions succeed without an issue.  Every time a new Gateway is created (i.e. our client is restarted) this problem appears again (first invoke transaction fails, and all others after this one work).   We found a workaround to this bug for when we are using a valid chaincode id, but have since seen it reappear when testing using an invalid chaincode id.  We attempt to perform an invoke transaction with a chaincode id that does not exist. The first time it will fail with the error: {code:java} 'error:  DiscoveryService : send foo  - Channel:default received discovery error:failed constructing descriptor for chaincodes:<name:"foo" >' {code}  Logs from the peer show: {code:java} peer 2021-06-01 12:07:28.787 UTC  discovery.lifecycle  DeployedChaincodes -> INFO 107 Chaincode foo isn't instantiated' peer 2021-06-01 12:07:28.787 UTC  discovery.lifecycle  Metadata -> INFO 108 Chaincode foo isn't defined in channel default couchdb  notice  2021-06-01T12:07:28.787084Z nonode@nohost <0.18422.0> 57a08a15bc 127.0.0.1:5984 127.0.0.1 user GET /default_lscc/foo?attachments=true 404 ok 8  peer 2021-06-01 12:07:28.787 UTC  discovery  chaincodeQuery -> ERRO 109 Failed constructing descriptor for chaincode chaincodes:<name:"foo" > ,: No metadata was found for chaincode foo in channel default{code}    After this first run, all further attempts to perform an invoke with the same invalid id result in the correct error being thrown (make sure the chaincode foo has been successfully defined on channel default and try again: chaincode foo not found)  ></description> </Issue>
