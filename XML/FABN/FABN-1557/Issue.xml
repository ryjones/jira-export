<Issue id="45069" key="FABN-1557" number="1557" project="10604" reporter="ycarmel" assignee="harrisob@us.ibm.com" creator="ycarmel" type="10004" summary="SubmitTransaction fails once peer restarts" priority="2" resolution="10000" status="6" created="2020-05-14 11:37:09.0" updated="2020-05-20 11:33:54.0" resolutiondate="2020-05-20 11:33:54.0" votes="0" watches="1" workflowId="58977" archived="N"> <description><! CDATA A client application connected to Fabric using a long running Gateway connection, fails to submitTransaction once the underlying endorsing peer restarts.  The transaction itself it sent to the orderer, but the TransactionEventHandler using AllForTxStrategy marks the peer as fails and returns: "Error: No successful events received"     SDK Debug logs when peer disconnects:  ```\{"level":"debug","fabric_node_sdk":true,"time":"2020-05-14T11:09:46.026Z","msg":" EventService : on.error - block peer:grpc://hlf-peer--karga--peer0:7051 - 1"} {"level":"debug","fabric_node_sdk":true,"time":"2020-05-14T11:09:46.030Z","msg":" EventService : _startService hlf-peer--karga--peer0  - #1 - on.error is an Error - Error: 2 UNKNOW N: Stream removed"} {"level":"debug","fabric_node_sdk":true,"time":"2020-05-14T11:09:46.030Z","msg":" EventService : _startService hlf-peer--karga--peer0  - #1 - close all application listeners - Erro r: 2 UNKNOWN: Stream removed"} {"level":"debug","fabric_node_sdk":true,"time":"2020-05-14T11:09:46.031Z","msg":" EventService : _close hlf-peer--karga--peer0  - #1 - start - called due to:: 2 UNKNOWN: Stream rem oved"} {"level":"debug","fabric_node_sdk":true,"time":"2020-05-14T11:09:46.033Z","msg":" EventService : _closeAllCallbacks hlf-peer--karga--peer0  - #1 - start"} {"level":"debug","fabric_node_sdk":true,"time":"2020-05-14T11:09:46.034Z","msg":" EventService : _closeAllCallbacks hlf-peer--karga--peer0  - #1 - event registrations 0"} {"level":"debug","fabric_node_sdk":true,"time":"2020-05-14T11:09:46.034Z","msg":" EventService : _closeAllCallbacks hlf-peer--karga--peer0  - #1 - clear out the listener list"} {"level":"debug","fabric_node_sdk":true,"time":"2020-05-14T11:09:46.034Z","msg":" EventService : _closeAllCallbacks hlf-peer--karga--peer0  - #1 - end"} {"level":"debug","fabric_node_sdk":true,"time":"2020-05-14T11:09:46.035Z","msg":" Eventer : disconnect hlf-peer--karga--peer0  - start - hub"} {"level":"debug","fabric_node_sdk":true,"time":"2020-05-14T11:09:46.035Z","msg":" Eventer : disconnect hlf-peer--karga--peer0  - shutdown existing stream"} {"level":"debug","fabric_node_sdk":true,"time":"2020-05-14T11:09:46.035Z","msg":" ServiceEndpoint : disconnect Eventer-hlf-peer--karga--peer0  - start "} {"level":"debug","fabric_node_sdk":true,"time":"2020-05-14T11:09:46.035Z","msg":" ServiceEndpoint : disconnect Eventer-hlf-peer--karga--peer0  Eventer hlf-peer--karga--peer0 - clos ing grpc service connection hlf-peer--karga--peer0:7051"} {"level":"debug","fabric_node_sdk":true,"time":"2020-05-14T11:09:46.035Z","msg":" Eventer : disconnect hlf-peer--karga--peer0  - end"} {"level":"debug","fabric_node_sdk":true,"time":"2020-05-14T11:09:46.035Z","msg":" EventService : _close hlf-peer--karga--peer0  - #1 - closing stream 1"} {"level":"debug","fabric_node_sdk":true,"time":"2020-05-14T11:09:46.035Z","msg":" EventService : _close hlf-peer--karga--peer0  - #1 - end"} {"level":"debug","fabric_node_sdk":true,"time":"2020-05-14T11:09:46.036Z","msg":" EventService : on status - status received: {\"code\":2,\"details\":\"Stream removed\",\"metadata\ ":\{\"_internal_repr\":{},\"flags\":0}} peer:grpc://hlf-peer--karga--peer0:7051 - 1"}  ```      SDK Debug logs when "Error: No successful events received" occurs:  ``` b5f5e75398abd9bc8d98779c328c2ead31b75b03d0fd"} {"level":"debug","fabric_node_sdk":true,"time":"2020-05-14T11:10:38.128Z","msg":" Client : getClientCertHash: gateway client - start"} {"level":"debug","fabric_node_sdk":true,"time":"2020-05-14T11:10:38.128Z","msg":" IdentityContext : serializeIdentity - start"} {"level":"debug","fabric_node_sdk":true,"time":"2020-05-14T11:10:38.130Z","msg":" ServiceAction : sign EventService:hlf-peer--karga--peer0  - start"} {"level":"debug","fabric_node_sdk":true,"time":"2020-05-14T11:10:38.130Z","msg":" IdentityContext : sign - start"} {"level":"debug","fabric_node_sdk":true,"time":"2020-05-14T11:10:38.134Z","msg":" crypto_ecdsa_aes : ecdsa signature: Signature \{\n r:\n <BN: f92f5d97d7a38fe3b5de29b8f073039d386e617364c34bf03a3cb98d0e92b727>,\n s:\n <BN: 4f57515a4c0698dbebc8a40a3b2cb3c0add2b686a822827e9571baa181241ecb>,\n recoveryParam: 1 }"} {"level":"debug","fabric_node_sdk":true,"time":"2020-05-14T11:10:38.134Z","msg":" EventService : send hlf-peer--karga--peer0  - #1 - start"} {"level":"debug","fabric_node_sdk":true,"time":"2020-05-14T11:10:38.134Z","msg":" EventService : send hlf-peer--karga--peer0  - #1 - using preassigned targets"} {"level":"debug","fabric_node_sdk":true,"time":"2020-05-14T11:10:38.134Z","msg":" ServiceAction : getSignedEnvelope EventService:hlf-peer--karga--peer0  - start"} {"level":"debug","fabric_node_sdk":true,"time":"2020-05-14T11:10:38.134Z","msg":" ServiceEndpoint : isConnectable Eventer-hlf-peer--karga--peer0  - start "} {"level":"debug","fabric_node_sdk":true,"time":"2020-05-14T11:10:38.134Z","msg":" Eventer : checkConnection hlf-peer--karga--peer0  - start"} {"level":"debug","fabric_node_sdk":true,"time":"2020-05-14T11:10:38.134Z","msg":" Eventer : checkConnection hlf-peer--karga--peer0  - end"} {"level":"debug","fabric_node_sdk":true,"time":"2020-05-14T11:10:38.135Z","msg":" AllForTxStrategy : checkCompletion:\{\"success\":0,\"fail\":1,\"expected\":1}"} {"level":"warn","fabric_node_sdk":true,"time":"2020-05-14T11:10:38.135Z","msg":" TransactionEventHandler : strategyFail: commit failure for transaction \"8213e7bd922a9b4dc9ce0fb44650fddfeefd2f5a5abf6128e6920e488d4acb1e\": Error: No successful events received"} {"level":"debug","fabric_node_sdk":true,"time":"2020-05-14T11:10:38.135Z","msg":" TransactionEventHandler : cancelListening called"} {"level":"debug","fabric_node_sdk":true,"time":"2020-05-14T11:10:38.136Z","msg":" Transaction : submit SearchApp  - use the orderers assigned to the channel"} {"level":"debug","fabric_node_sdk":true,"time":"2020-05-14T11:10:38.136Z","msg":" Channel : getCommitters identities  - start"} {"level":"debug","fabric_node_sdk":true,"time":"2020-05-14T11:10:38.137Z","msg":" Channel : _getServiceEndpoints - start - undefined"} {"level":"debug","fabric_node_sdk":true,"time":"2020-05-14T11:10:38.137Z","msg":" Channel : _getServiceEndpoints - Committer added groeifabriek"} {"level":"debug","fabric_node_sdk":true,"time":"2020-05-14T11:10:38.137Z","msg":" Endorsement : newCommit rascc  - start"} {"level":"debug","fabric_node_sdk":true,"time":"2020-05-14T11:10:38.137Z","msg":" ServiceAction : ServiceAction.constructor - start  rascc"} {"level":"debug","fabric_node_sdk":true,"time":"2020-05-14T11:10:38.137Z","msg":" Proposal : Proposal.constructor rascc  - start "} ```   ></description> </Issue>
