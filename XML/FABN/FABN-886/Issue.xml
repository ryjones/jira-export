<Issue id="33168" key="FABN-886" number="886" project="10604" reporter="yuki-kon" assignee="yuki-kon" creator="yuki-kon" type="10002" summary="Fix gulp test to remove Chaincode&apos;s docker containers and images of network-e2enodecc" priority="3" resolution="10000" status="6" created="2018-08-23 16:52:49.0" updated="2018-08-24 14:29:42.0" resolutiondate="2018-08-24 14:29:42.0" votes="0" watches="1" workflowId="44379"> <description><! CDATA `gulp test` doesn’t remove Chaincode's docker containers and images of network-e2enodecc.  After running `gulp test`, I executed `gulp docker-clean` to remove containers and images related to Chaincode. However, some containers and images created for the end-to-end test of fabric-network were not removed.  {noformat} $ gulp test $ gulp docker-clean $ docker ps -a CONTAINER ID        IMAGE                                                                                                              COMMAND                  CREATED             STATUS                      PORTS               NAMES 6175cf17e84a        dev-peer0.org2.example.com-network-e2enodecc-v0-4455dbec9c22dd92f91f6edf98f990c4b9207d94ae03c70899e485e5b616afd9   "/bin/sh -c 'cd /u..."   32 minutes ago      Exited (0) 15 seconds ago                       dev-peer0.org2.example.com-network-e2enodecc-v0 db73a03d03f1        dev-peer0.org1.example.com-network-e2enodecc-v0-f0ea899496760854d411765e3885a78e2a00d1e8419edb4a5a730033933b1f35   "/bin/sh -c 'cd /u..."   32 minutes ago      Exited (0) 15 seconds ago                       dev-peer0.org1.example.com-network-e2enodecc-v0 $ docker images REPOSITORY                                                                                                         TAG                            IMAGE ID            CREATED             SIZE dev-peer0.org1.example.com-network-e2enodecc-v0-f0ea899496760854d411765e3885a78e2a00d1e8419edb4a5a730033933b1f35   latest                         483da48298e1        9 hours ago         1.45GB dev-peer0.org2.example.com-network-e2enodecc-v0-4455dbec9c22dd92f91f6edf98f990c4b9207d94ae03c70899e485e5b616afd9   latest                         c2c4d5860f7d        9 hours ago         1.45GB {noformat}  The script (fabric-sdk-node/build/task/test.js) runs `grep` command to search docker containers and images containing Chaincode’s name. The current `grep` command below can’t find Chaincode named `network-e2enodecc`, which is used for the end-to-end test of fabric-network. We need to update the regular expression to search and remove the remaining containers and images.  {noformat} // stop and remove chaincode docker instances 'docker kill $(docker ps | grep "dev-peer0.org 12 .example.com-e" | awk \'{print $1}\')', 'docker rm $(docker ps -a | grep "dev-peer0.org 12 .example.com-e" | awk \'{print $1}\')',  // remove chaincode images so that they get rebuilt during test 'docker rmi $(docker images | grep "^dev-peer0.org 12 .example.com-e" | awk \'{print $3}\')', {noformat}   ></description> </Issue>
