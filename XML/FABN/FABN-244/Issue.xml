<Issue id="14715" key="FABN-244" number="244" project="10604" reporter="jjjjibm" assignee="jjjjibm" creator="jjjjibm" type="10004" summary=" node-SDK  pkcs11-tests.js not ok 2 Error: /usr/lib/libacsp-pkcs11.so: cannot open shared obry at Error (native) Load:129" environment="vlaunch VM running Ubuntu. " priority="2" resolution="10000" status="6" created="2017-02-09 23:43:06.0" updated="2018-07-19 00:53:21.0" resolutiondate="2017-02-23 18:24:36.0" votes="0" watches="1" workflowId="33975"> <description><! CDATA Running the test cases  fabric-sdk-node/test/unit/pkcs11-tests.js requires either special hardware, or the software product softHSM-2*.    So I installed softHSM-2.2.0 and created tokens:  softhsm2-util --init-token --slot 0 --label "My token 1" so pin abcd  user pin 1234 since that is what is coded in pkcs11-tests.js   Slot 2089908031 Slot info: Description:      SoftHSM slot ID 0x7c91773f Manufacturer ID:  SoftHSM project Hardware version: 2.2 Firmware version: 2.2 Token present:    yes Token info: Manufacturer ID:  SoftHSM project Model:            SoftHSM v2 Hardware version: 2.2 Firmware version: 2.2 Serial number:    17671c0d7c91773f Initialized:      yes User PIN init.:   yes Label:            JCW token 1  I set the User PIN to '1234' because that is the value hard coded in pkcs11-tests.js.  Nonetheless, the test case fails: ibmadmin@jcwNodeSDK:~/work/src/github.com/hyperledger/fabric-sdk-js TAP version 13 #  **PKCS11 - generate an ephemeral key   ok 1 Verify that the HSM based key management module has been ena info: Returning a new winston logger with default configurations info:  crypto_pkcs11 : CryptoSuite_PKCS11 69 : keySize: 256 info:  crypto_pkcs11 : CryptoSuite_PKCS11 79 : PKCS11 library: /u info:  crypto_pkcs11 : CryptoSuite_PKCS11 91 : PKCS11 slot: 0 not ok 2 Error: /usr/lib/libacsp-pkcs11.so: cannot open shared obry at Error (native) Load:129 --- operator: error expected: |- undefined actual: |-  Error: /usr/lib/libacsp-pkcs11.so: cannot open shared obje at Error (native) Load:129  at: Test.onetime  as end  (/home/ibmadmin/work/src/github.commodules/onetime/index.js:22:12) stack: |- Error: /usr/lib/libacsp-pkcs11.so: cannot open shared objec at Error (native) Load:129 at Error (native) at CryptoSuite_PKCS11._pkcs11OpenSession (/home/ibmadmifabric-sdk-node/node_modules/fabric-client/lib/impl/bccsp_pkcs11. at new CryptoSuite_PKCS11 (/home/ibmadmin/work/src/gith/node_modules/fabric-client/lib/impl/bccsp_pkcs11.js:110:8) at Object.module.exports.getCryptoSuite (/home/ibmadminabric-sdk-node/node_modules/fabric-client/lib/utils.js:85:11) at test (/home/ibmadmin/work/src/github.com/hyperledgertests.js:52:22) at Test.<anonymous> (/home/ibmadmin/work/src/github.commodules/tape-promise/index.es5.js:21:13) at Test.bound  as _cb  (/home/ibmadmin/work/src/github.de_modules/tape/lib/test.js:66:32) at Test.run (/home/ibmadmin/work/src/github.com/hyperletape/lib/test.js:85:10) at Test.bound  as run  (/home/ibmadmin/work/src/github.de_modules/tape/lib/test.js:66:32) at Immediate.next (/home/ibmadmin/work/src/github.com/hdules/tape/lib/results.js:71:15) ... # <more errors follow>  The problem is that the code is looking for the softHSM libraries at libpath = '/usr/lib/libacsp-pkcs11.so';  based on the process.platform value of 'default' (anything but Darwin).   SoftHSM installs the libraries at /usr/local/lib/softhsm/libsofthsm2.so''.     On the Ubuntu vlaunch VM I am using, process.platform is set to 'linux'.  The fix is to use the same location as 'darwin' when process.platform is set to 'linux'.   How to recreate: 1.Install softHSM on Ubuntu VM.  Instsructions are in the test case pkcs11-tests.js.  2.Create token(s).  Set the user PIN to '1234' (or change source code in pkcs11-tests.js 3.Run the test case.      ></description> </Issue>
