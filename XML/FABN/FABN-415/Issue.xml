<Issue id="26663" key="FABN-415" number="415" project="10604" reporter="antoniovassell" assignee="mastersingh24" creator="antoniovassell" type="10004" summary="Fabric SDK Node unit tests configured with HSM are failing on master branch" priority="2" resolution="10000" status="6" created="2018-01-08 20:31:11.0" updated="2018-07-19 00:54:00.0" resolutiondate="2018-02-18 16:16:12.0" votes="0" watches="5" workflowId="34146"> <description><! CDATA This is to track the progress of fabric-sdk-node test cases to become green with hsm configured.  Currently running the test cases of fabric sdk node with HSM turned on is currently failing. The instructions were followed here:  https://github.com/hyperledger/fabric-sdk-node#special-tests-for-hardware-security-module-support-experimental-via-pkcs11-interface   The unit tests for test/unit/pkcs11.js does pass (which includes generating and importing some keys). However configuring the sdk cryptosuite with hsm settings like below: {code:java}   ... "crypto-hsm": true, "crypto-pkcs11-lib": "/usr/local/lib/softhsm/libsofthsm2.so", "crypto-pkcs11-slot": "0", "crypto-pkcs11-pin": "1234", // My configured pin ... {code}   ... throws the following error multiple times: {code:java} not ok 19 TypeError: Cannot read property 'slot' of null --- operator: error expected: |- undefined actual: |-  TypeError: Cannot read property 'slot' of null  at: Test.onetime  as end  (/home/antonio/development/blockchains/fabric-sdk-node/node_modules/tape-promise/node_modules/onetime/index.js:22:12) stack: |- TypeError: Cannot read property 'slot' of null at new CryptoSuite_PKCS11 (/home/antonio/development/blockchains/fabric-sdk-node/node_modules/fabric-client/lib/impl/bccsp_pkcs11.js:91:25) at Object.module.exports.newCryptoSuite (/home/antonio/development/blockchains/fabric-sdk-node/node_modules/fabric-client/lib/utils.js:94:9) at Function.newCryptoSuite (/home/antonio/development/blockchains/fabric-sdk-node/node_modules/fabric-client/lib/BaseClient.js:41:19) at Object.queryChaincode (/home/antonio/development/blockchains/fabric-sdk-node/test/integration/e2e/e2eUtils.js:776:27) at test (/home/antonio/development/blockchains/fabric-sdk-node/test/integration/e2e/upgrade.js:91:11) at Test.<anonymous> (/home/antonio/development/blockchains/fabric-sdk-node/node_modules/tape-promise/index.es5.js:21:13) at Test.bound  as _cb  (/home/antonio/development/blockchains/fabric-sdk-node/node_modules/tape/lib/test.js:64:32) at Test.run (/home/antonio/development/blockchains/fabric-sdk-node/node_modules/tape/lib/test.js:83:10) at Test.bound  as run  (/home/antonio/development/blockchains/fabric-sdk-node/node_modules/tape/lib/test.js:64:32) at Immediate.next  as _onImmediate  (/home/antonio/development/blockchains/fabric-sdk-node/node_modules/tape/lib/results.js:71:15) {code} Just to note. The following change set was created that solves that 'slot' issue,  https://gerrit.hyperledger.org/r/#/c/16401/  (not merged as yet), but this also gives another issue "CKR_CRYPTOKI_ALREADY_INITIALIZED" and "CKR_USER_ALREADY_LOGGED_IN" that is fatal.  Again this task is to track the test cases passing on master.  Given an Admin user, I would like to be able to enroll a user using the fabric-sdk-node, and have the user keys generated stored successfully on a HSM and not in a local folder.  ></description> </Issue>
