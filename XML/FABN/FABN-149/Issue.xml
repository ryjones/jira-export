<Issue id="14964" key="FABN-149" number="149" project="10604" reporter="aliblackwell" assignee="mastersingh24" creator="aliblackwell" type="10004" summary="HFC 0.6.5 fails to connect to membersrvc when running in Docker" priority="3" resolution="10000" status="6" created="2017-02-21 10:24:03.0" updated="2018-07-19 00:53:01.0" resolutiondate="2017-02-21 10:59:01.0" votes="0" watches="2" workflowId="33880"> <description><! CDATA Member enrolment hangs indefinitely with no debug output provided to diagnose the error.  GRPC has protocol buffers & native code inside it, which may be responsible. It may also be due to a problem with the crypto module as some others seem to override it.  Does not appear to be limited to enrollment only as getTCertBatch and other method calls using GRPC also fail.  We have tried base images {{node:6.9}} and {{bitnami/node:6.9.0-r0}}   {noformat} crypto Using sha3-256 +6ms hfc Enrolling  req={"enrollmentID":"admin","enrollmentSecret":"Xurw3yU9zI0l"}  +206ms hfc  MemberServicesImpl.enroll   {"enrollmentID":"admin","enrollmentSecret":"Xurw3yU9zI0l"}  +0ms hfc  MemberServicesImpl.enroll  Generating keys... +0ms hfc  MemberServicesImpl.enroll  Generating keys...done! +185ms hfc  MemberServicesImpl.enroll  Generating request! "3059301306072a8648ce3d020106082a8648ce3d03010703420004482a38893a6f4f45874e9a22d305ec170f9ec92c0d68495980b9daaa73a194b40c8ad16f57aa7298c0e3fbb6e93fde1be6109df6e2328dd82c68e5758eaed783" +3ms hfc  MemberServicesImpl.enroll  Adding signing key! +0ms hfc  MemberServicesImpl.enroll  Assding encryption key! +0ms hfc  MemberServicesImpl.enroll   Contact ECA  {"ts":{"seconds":{"low":1487672577,"high":0,"unsigned":false},"nanos":0},"id":{"id":"admin"},"tok":{"tok":{"buffer":{"type":"Buffer","data": 88,117,114,119,51,121,85,57,122,73,48,108 },"offset":0,"markedOffset":-1,"limit":12,"littleEndian":false,"noAssert":false}},"sign":{"type":0,"key":{"buffer":{"type":"Buffer","data": 48,89,48,19,6,7,42,134,72,206,61,2,1,6,8,42,134,72,206,61,3,1,7,3,66,0,4,72,42,56,137,58,111,79,69,135,78,154,34,211,5,236,23,15,158,201,44,13,104,73,89,128,185,218,170,115,161,148,180,12,138,209,111,87,170,114,152,192,227,251,182,233,63,222,27,230,16,157,246,226,50,141,216,44,104,229,117,142,174,215,131 },"offset":0,"markedOffset":-1,"limit":91,"littleEndian":false,"noAssert":false}},"enc":{"type":0,"key":{"buffer":{"type":"Buffer","data": 48,89,48,19,6,7,42,134,72,206,61,2,1,6,8,42,134,72,206,61,3,1,7,3,66,0,4,211,9,95,87,73,179,0,90,184,14,75,76,34,141,122,67,142,16,41,198,162,70,250,106,137,164,215,6,3,159,28,166,123,44,221,178,154,189,62,174,198,74,164,171,151,103,124,48,1,107,255,194,233,212,75,47,9,86,117,224,88,183,183,146 },"offset":0,"markedOffset":-1,"limit":91,"littleEndian":false,"noAssert":false}},"sig":null}  +0ms  (hangs indefinitely) {noformat}  This is the output when running with GRPC debug  {{GRPC_VERBOSITY=DEBUG GRPC_TRACE=all node yourapp.js}}  {noformat}  I0221 10:32:06.259892515    1849 channel.c:231               grpc_channel_create_call(channel=0x36e61a0, parent_call=(nil), propagation_mask=ffff, cq=0x36ffda0, method=/protos.ECAP/CreateCertificatePair, host=(null), deadline=gpr_timespec { tv_sec: 9223372036854775807, tv_nsec: 0, clock_type: 1 }, reserved=(nil)) I0221 10:32:06.262332450    1849 metadata_array.c:42         grpc_metadata_array_init(array=0x7ffdd68d9560) I0221 10:32:06.262382575    1849 metadata_array.c:42         grpc_metadata_array_init(array=0x36ff648) I0221 10:32:06.262392720    1849 metadata_array.c:42         grpc_metadata_array_init(array=0x354d858) I0221 10:32:06.262406165    1849 call.c:1690                 grpc_call_start_batch(call=0x35e1a10, ops=0x36062d0, nops=6, tag=0x36659a0, reserved=(nil)) I0221 10:32:06.262433118    1849 call.c:1366                 ops 0 : SEND_INITIAL_METADATA I0221 10:32:06.262440332    1849 call.c:1366                 ops 1 : SEND_MESSAGE ptr=0x36e48e0 I0221 10:32:06.262446388    1849 call.c:1366                 ops 2 : SEND_CLOSE_FROM_CLIENT I0221 10:32:06.262452997    1849 call.c:1366                 ops 3 : RECV_INITIAL_METADATA ptr=0x36ff648 I0221 10:32:06.262459165    1849 call.c:1366                 ops 4 : RECV_MESSAGE ptr=0x35ef7a8 I0221 10:32:06.262465746    1849 call.c:1366                 ops 5 : RECV_STATUS_ON_CLIENT metadata=0x354d858 status=0x354d870 details=0x354d878 I0221 10:32:06.262530992    1849 client_channel.c:109        OP client-channel:0x35e2018 : SEND_INITIAL_METADATA{key=3a 70 61 74 68 ':path' value=2f 70 72 6f 74 6f 73 2e 45 43 41 50 2f 43 72 65 61 74 65 43 65 72 74 69 66 69 63 61 74 65 50 61 69 72 '/protos.ECAP/CreateCertificatePair', key=3a 61 75 74 68 6f 72 69 74 79 ':authority' value=, key=67 72 70 63 2d 65 6e 63 6f 64 69 6e 67 'grpc-encoding' value=69 64 65 6e 74 69 74 79 'identity', key=67 72 70 63 2d 61 63 63 65 70 74 2d 65 6e 63 6f 64 69 6e 67 'grpc-accept-encoding' value=69 64 65 6e 74 69 74 79 2c 64 65 66 6c 61 74 65 2c 67 7a 69 70 'identity,deflate,gzip'} SEND_MESSAGE:flags=0x00000000:len=223 SEND_TRAILING_METADATA{} RECV_INITIAL_METADATA RECV_MESSAGE RECV_TRAILING_METADATA I0221 10:32:06.262690022    1856 completion_queue.c:333      grpc_completion_queue_next(cc=0x36ffda0, deadline=gpr_timespec { tv_sec: 9223372036854775807, tv_nsec: 0, clock_type: 1 }, reserved=(nil)) D0221 10:32:06.279838252    1859 dns_resolver.c:192          dns resolution failed: {"created":"@1487673126.279796172","description":"OS Error","errno":-5,"file":"../src/core/lib/iomgr/resolve_address_posix.c","file_line":115,"os_error":"No address associated with hostname","syscall":"getaddrinfo","target_address":""} D0221 10:32:06.279860795    1859 dns_resolver.c:201          retrying immediately D0221 10:32:06.279880214    1859 connectivity_state.c:156    SET: 0x36e62e8 client_channel: IDLE --> TRANSIENT_FAILURE  new_lb+resolver  error=0x7fd2f0001730 {"created":"@1487673126.279870831","description":"No load balancing policy","file":"../src/core/ext/client_config/client_channel.c","file_line":188} D0221 10:32:07.297370847    1860 dns_resolver.c:192          dns resolution failed: {"created":"@1487673127.297344897","description":"OS Error","errno":-5,"file":"../src/core/lib/iomgr/resolve_address_posix.c","file_line":115,"os_error":"No address associated with hostname","syscall":"getaddrinfo","target_address":""} D0221 10:32:07.297390643    1860 dns_resolver.c:201          retrying immediately D0221 10:32:07.297412393    1860 connectivity_state.c:156    SET: 0x36e62e8 client_channel: TRANSIENT_FAILURE --> TRANSIENT_FAILURE  new_lb+resolver  error=0x7fd2f00018b0 {"created":"@1487673127.297401869","description":"No load balancing policy","file":"../src/core/ext/client_config/client_channel.c","file_line":188} D0221 10:32:09.121116790    1861 dns_resolver.c:192          dns resolution failed: {"created":"@1487673129.121083749","description":"OS Error","errno":-5,"file":"../src/core/lib/iomgr/resolve_address_posix.c","file_line":115,"os_error":"No address associated with hostname","syscall":"getaddrinfo","target_address":""} D0221 10:32:09.121139809    1861 dns_resolver.c:201          retrying immediately D0221 10:32:09.121160988    1861 connectivity_state.c:156    SET: 0x36e62e8 client_channel: TRANSIENT_FAILURE --> TRANSIENT_FAILURE  new_lb+resolver  error=0x7fd2f0001cf0 {"created":"@1487673129.121151085","description":"No load balancing policy","file":"../src/core/ext/client_config/client_channel.c","file_line":188}  {noformat}     ></description> </Issue>
