<Issue id="17594" key="FABN-360" number="360" project="10604" reporter="shimos" assignee="shimos" creator="shimos" type="10004" summary="&quot;gulp test&quot; should rebuild containers" environment="fabric-sdk-node commit 4f03644dcee9eb8f80b9bfa4a5e3b760bab2d926" priority="3" resolution="10000" status="6" created="2017-06-06 21:26:28.0" updated="2018-07-19 00:53:47.0" resolutiondate="2017-06-09 15:38:19.0" votes="0" watches="1" workflowId="34091" security="10001"> <description><! CDATA Some tests in test/integration fail when “gulp test” is executed twice.  For example, joining a channel and installing a chaincode fail (see below) because they are already done in the previous run of “gulp test.” {noformat} # Calling peers in organization "org1" to join the channel ok 592 Successfully enrolled orderer 'admin' ok 593 Successfully got the genesis block ok 594 Successfully enrolled org:org1 'admin' not ok 595 Failed to join peers in organization "peerOrg1" to the channel. TypeError: Cannot read property 'stack' of undefined at Client.newDefaultKeyValueStore.then.then.then.then.then (/opt/go/src/github.com/hyperledger/fabric-sdk-node/test/integration/e2e/join-chann\ el.js:217:55) --- operator: fail at: joinChannel.then (/opt/go/src/github.com/hyperledger/fabric-sdk-node/test/integration/e2e/join-channel.js:67:5) ... ok 596 Successfully joined peers in organization "peerOrg2" to the channel #  ***** End-to-end flow: chaincode install *****  ok 597 Successfully enrolled user 'admin' not ok 598 Error: Failed to send install Proposal or receive valid response: Error: chaincode error (status: 500, message: Error installing chaincode code end2endnodesdk:v0(chaincode /var/hyperledger/production/chaincodes/end2endnodesdk.v0 exists)) at Client.newDefaultKeyValueStore.then.then.then (/opt/go/src/github.com/hyperledger/fabric-sdk-node/test/integration/e2e/e2eUtils.js:142:10) at process._tickDomainCallback (internal/process/next_tick.js:135:7) --- operator: fail at: e2eUtils.installChaincode.then (/opt/go/src/github.com/hyperledger/fabric-sdk-node/test/integration/e2e/install-chaincode.js:39:5) ... {noformat}  It seems to be because the “docker-clean” task, which is also called from “test” task, cleans up only chaincode images, but not the containers created by docker-compose (orderers, peers, etc.). Since cleaning up these containers is required every time before we run the “test” task, it should be done automatically when “gulp task” is executed.   ></description> </Issue>
